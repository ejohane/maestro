{"id":"maestro-fyp","title":"Issue Discussion: Chat Interface with GitHub Issue Persistence","description":"## Overview\n\nImplement the Issue Discussion view - a split-panel interface where users explore and refine GitHub Issues with an AI agent, using the GitHub issue itself as the persistent source of truth.\n\n## Architectural Philosophy\n\nThis feature embodies a key architectural principle: **GitHub Issues ARE the persistent artifact**. Unlike traditional chat applications where conversation history is stored separately, we use GitHub Issues as the canonical source of truth. OpenCode sessions are transient - they can be recreated at any time by re-injecting the issue context.\n\n### Key Design Decisions\n\n1. **No git branch/worktree during discussion** - Agent operates on main branch in read-only exploration mode\n2. **GitHub Issue IS persistence** - Not local files, not OpenCode session state\n3. **Sessions are ephemeral** - Can be recreated by injecting issue context\n4. **Summary persistence is on-demand** - User explicitly saves conversation summaries as GitHub comments\n5. **No new concepts** - We work directly with GitHub Issues\n\n## Why This Matters\n\nThe Issue Discussion phase is the first step in the Maestro workflow:\n\n```\nIssue Discussion → Planning → Execution (Swarm/Solo) → Completion\n```\n\nUsers need a space to:\n- Explore ideas with AI assistance\n- Understand codebase implications\n- Refine requirements before committing to implementation\n- Build shared context that persists beyond any single conversation\n\n## Technical Context\n\n### Already Implemented\n- NewIssueDialog component (creates GitHub issues)\n- Issue View page (basic split panel, but chat is mocked)\n- Issues API endpoints (list, create, get single)\n- Mobile tabbed interface\n- Desktop split panel (fixed 400px width)\n\n### Needs Implementation\n- OpenCode SDK integration (replacing mock setTimeout)\n- Session storage service (~/.maestro/sessions.json)\n- Comments display in issue panel\n- Add comment API endpoint\n- Session management API endpoints\n- SSE streaming for real-time responses\n- Save Summary modal\n- Error handling infrastructure\n- Panel resizing (polish)\n\n## Dependencies\n\nExternal:\n- OpenCode server running locally (`opencode serve`)\n- @opencode-ai/sdk npm package\n- GitHub CLI (`gh`) authenticated\n\nInternal:\n- ConfigService (for project paths) - EXISTS\n- TanStack Query hooks pattern - EXISTS\n- UI component library - EXISTS\n\n## Success Criteria\n\n1. User can chat with AI about a GitHub issue\n2. AI has full issue context (title, body, comments)\n3. AI can read codebase but cannot modify files\n4. Conversation summaries can be saved to GitHub\n5. Sessions reconnect gracefully if interrupted\n6. Works on both desktop and mobile layouts\n\n## Reference\n\nGitHub Issue: https://github.com/ejohane/maestro/issues/3\nOpenCode SDK Docs: https://opencode.ai/docs/sdk","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-30T10:33:34.352275-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:33:34.352275-06:00"}
{"id":"maestro-fyp.1","title":"Phase 1: Core Infrastructure","description":"## Phase 1: Core Infrastructure\n\nThis phase establishes the foundational services and API endpoints that all subsequent phases depend on. Without this infrastructure, we cannot connect to OpenCode or manage sessions.\n\n### Why This Phase First?\n\nThe Issue Discussion feature is fundamentally about connecting the Maestro UI to the OpenCode AI backend. Before we can build any user-facing chat functionality, we need:\n\n1. **SDK Integration** - The bridge between our frontend and OpenCode\n2. **Session Management** - Tracking which OpenCode session belongs to which GitHub issue\n3. **Health Monitoring** - Knowing when OpenCode is available\n\n### Technical Decisions\n\n**Session Storage Location: `~/.maestro/sessions.json`**\n- Chosen to match existing config pattern (`~/.maestro/config.json`)\n- JSON file is simple, human-readable, and sufficient for local use\n- Cross-device support via shared filesystem (Tailscale)\n- No database overhead for this MVP\n\n**One Session Per Issue (Singleton Pattern)**\n- Simplifies reasoning about state\n- Prevents duplicate sessions consuming resources\n- If session dies, we recreate with context injection\n\n**Lazy Session Cleanup**\n- Don't proactively garbage collect sessions\n- Check if alive when requested, recreate if dead\n- Simple and robust for MVP\n\n### API Design\n\nFollowing existing patterns in the codebase:\n- Use Next.js 15 async params pattern\n- Return `{ error: \"message\" }` on failures\n- Execute `gh` commands with `cwd: project.path`\n\n### Deliverables\n\n1. OpenCode SDK installed and typed\n2. OpenCodeService wrapper with error handling\n3. SessionStorage service for JSON persistence\n4. Session management API endpoints\n5. Health check endpoint\n\n### Dependencies\n\nNone - this is the foundation.","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-30T10:33:34.407677-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:33:51.154475-06:00","dependencies":[{"issue_id":"maestro-fyp.1","depends_on_id":"maestro-fyp","type":"parent-child","created_at":"2025-12-30T10:33:34.409693-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.1.1","title":"Install and configure @opencode-ai/sdk","description":"## Task\n\nInstall the OpenCode SDK and configure TypeScript types.\n\n## Why\n\nThe SDK is the foundation for all OpenCode communication. Without it, we cannot create sessions, send messages, or stream responses.\n\n## Implementation\n\n```bash\nbun add @opencode-ai/sdk\n```\n\n## Verification\n\n1. Import works: `import { createOpencodeClient } from \"@opencode-ai/sdk\"`\n2. TypeScript types are available\n3. No build errors\n\n## Files to Create/Modify\n\n- `package.json` - Add dependency\n- `bun.lock` - Updated automatically\n\n## Notes\n\nSDK documentation: https://opencode.ai/docs/sdk\n\nThe SDK provides:\n- `createOpencodeClient()` - Factory function\n- `client.session.create()` - Create new session\n- `client.session.prompt()` - Send message\n- `client.event.subscribe()` - SSE streaming\n- Full TypeScript types\n\n## Acceptance Criteria\n\n- [ ] SDK installed via bun\n- [ ] Imports work without errors\n- [ ] Types are available in IDE","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-30T10:34:38.849563-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:34:38.849563-06:00","dependencies":[{"issue_id":"maestro-fyp.1.1","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:34:38.851496-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.1.2","title":"Create OpenCodeService wrapper","description":"## Task\n\nCreate `src/lib/services/opencode.ts` - A service wrapper around the OpenCode SDK with error handling and helper methods.\n\n## Why\n\nDirect SDK usage scatters OpenCode-specific logic across the codebase. A service wrapper:\n- Centralizes configuration (base URL)\n- Provides typed helper methods\n- Handles common error patterns\n- Makes testing easier (can mock the service)\n\n## Implementation\n\n```typescript\n// src/lib/services/opencode.ts\nimport { createOpencodeClient } from \"@opencode-ai/sdk\"\n\nexport interface OpenCodeConfig {\n  baseUrl: string\n}\n\nexport class OpenCodeService {\n  private client: ReturnType\u003ctypeof createOpencodeClient\u003e\n  \n  constructor(config?: Partial\u003cOpenCodeConfig\u003e) {\n    this.client = createOpencodeClient({\n      baseUrl: config?.baseUrl || process.env.OPENCODE_URL || \"http://localhost:4096\"\n    })\n  }\n\n  // Create a new session\n  async createSession(title: string): Promise\u003c{ id: string }\u003e { ... }\n\n  // Check if session is alive\n  async isSessionAlive(sessionId: string): Promise\u003cboolean\u003e { ... }\n\n  // Inject context without AI response\n  async injectContext(sessionId: string, context: string): Promise\u003cvoid\u003e { ... }\n\n  // Send message in read-only mode (no write/edit/bash tools)\n  async sendReadOnlyMessage(sessionId: string, message: string): Promise\u003c...\u003e { ... }\n\n  // Request conversation summary\n  async generateSummary(sessionId: string): Promise\u003cstring\u003e { ... }\n\n  // Health check\n  async isHealthy(): Promise\u003cboolean\u003e { ... }\n\n  // Get SSE event stream\n  async subscribeToEvents(): Promise\u003cAsyncIterable\u003c...\u003e\u003e { ... }\n}\n\n// Singleton instance for server-side use\nexport const openCodeService = new OpenCodeService()\n```\n\n## Key Design Decisions\n\n1. **Singleton pattern** - One instance per server, consistent config\n2. **Environment variable** - `OPENCODE_URL` for different environments\n3. **Read-only mode** - `sendReadOnlyMessage` enforces tool restrictions\n4. **Health check** - Simple ping to verify connectivity\n\n## Files to Create\n\n- `src/lib/services/opencode.ts`\n\n## Dependencies\n\n- `@opencode-ai/sdk` installed (previous task)\n\n## Acceptance Criteria\n\n- [ ] Service compiles without errors\n- [ ] createSession returns session ID\n- [ ] isSessionAlive correctly detects dead sessions\n- [ ] injectContext uses noReply: true, synthetic: true\n- [ ] sendReadOnlyMessage disables bash/write/edit tools\n- [ ] isHealthy returns boolean\n- [ ] Error handling for network failures","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-30T10:34:49.521334-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:34:49.521334-06:00","dependencies":[{"issue_id":"maestro-fyp.1.2","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:34:49.523394-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.1.2","depends_on_id":"maestro-fyp.1.1","type":"blocks","created_at":"2025-12-30T10:39:14.329104-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.1.3","title":"Create SessionStorage service","description":"## Task\n\nCreate `src/lib/services/sessions.ts` - A service for persisting session-to-issue mappings in `~/.maestro/sessions.json`.\n\n## Why\n\nWe need to track which OpenCode session belongs to which GitHub issue:\n- Resume sessions when user returns to an issue\n- Avoid creating duplicate sessions\n- Cross-device support (file on server, not localStorage)\n\n## Data Model\n\n```typescript\ninterface SessionMapping {\n  projectId: string       // Project UUID\n  issueNumber: number     // GitHub issue number\n  sessionId: string       // OpenCode session ID\n  createdAt: string       // ISO timestamp\n  lastAccessedAt: string  // ISO timestamp (updated on access)\n}\n\ninterface SessionStore {\n  version: 1              // For future migrations\n  mappings: SessionMapping[]\n}\n```\n\n## Implementation\n\n```typescript\n// src/lib/services/sessions.ts\nimport { promises as fs } from \"fs\"\nimport path from \"path\"\nimport os from \"os\"\n\nconst SESSIONS_PATH = path.join(os.homedir(), \".maestro\", \"sessions.json\")\n\nexport class SessionStorageService {\n  // Get session for issue (or null if none)\n  async getSession(projectId: string, issueNumber: number): Promise\u003cstring | null\u003e { ... }\n\n  // Save session mapping\n  async saveSession(projectId: string, issueNumber: number, sessionId: string): Promise\u003cvoid\u003e { ... }\n\n  // Remove session mapping (when session dies)\n  async removeSession(projectId: string, issueNumber: number): Promise\u003cvoid\u003e { ... }\n\n  // Update lastAccessedAt timestamp\n  async touchSession(projectId: string, issueNumber: number): Promise\u003cvoid\u003e { ... }\n\n  // Internal: read file, handle missing/corrupt\n  private async readStore(): Promise\u003cSessionStore\u003e { ... }\n\n  // Internal: write file atomically\n  private async writeStore(store: SessionStore): Promise\u003cvoid\u003e { ... }\n}\n\nexport const sessionStorage = new SessionStorageService()\n```\n\n## Key Design Decisions\n\n1. **File-based storage** - Matches config pattern, simple and sufficient\n2. **Atomic writes** - Write to temp file, then rename (prevents corruption)\n3. **Auto-create directory** - Create ~/.maestro if missing\n4. **Graceful degradation** - Return empty store if file missing/corrupt\n5. **lastAccessedAt** - For potential future cleanup of stale sessions\n\n## Files to Create\n\n- `src/lib/services/sessions.ts`\n\n## Dependencies\n\nNone - uses Node.js fs module.\n\n## Acceptance Criteria\n\n- [ ] Creates ~/.maestro directory if missing\n- [ ] Reads existing sessions.json correctly\n- [ ] Handles missing file gracefully (returns empty)\n- [ ] Handles corrupt JSON gracefully (resets to empty)\n- [ ] Saves session mappings correctly\n- [ ] Removes session mappings correctly\n- [ ] Atomic file writes (no partial writes)\n- [ ] Updates lastAccessedAt on touch","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-30T10:35:00.119368-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:35:00.119368-06:00","dependencies":[{"issue_id":"maestro-fyp.1.3","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:35:00.121484-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.1.4","title":"Create session management API endpoints","description":"## Task\n\nCreate API endpoints for managing OpenCode sessions tied to GitHub issues:\n- `POST /api/projects/[id]/issues/[issueNumber]/session` - Create/resume session\n- `GET /api/projects/[id]/issues/[issueNumber]/session` - Get existing session ID\n\n## Why\n\nThe frontend needs a way to:\n1. Get or create a session when opening an issue\n2. Know which session ID to use for chat\n\n## Implementation\n\n### GET /api/projects/[id]/issues/[issueNumber]/session\n\nReturns existing session ID if alive, or null.\n\n```typescript\n// Response (200)\n{ sessionId: string | null }\n\n// Response (404)\n{ error: \"Issue not found\" }\n```\n\n**Logic:**\n1. Get project from config\n2. Check sessionStorage for existing mapping\n3. If mapping exists, verify session is alive via OpenCodeService\n4. If alive, return sessionId\n5. If dead, remove mapping, return null\n\n### POST /api/projects/[id]/issues/[issueNumber]/session\n\nCreates new session with context injection.\n\n```typescript\n// Response (201)\n{ sessionId: string }\n\n// Response (500)\n{ error: \"Failed to create session\" }\n```\n\n**Logic:**\n1. Get project from config\n2. Fetch issue details (title, body, comments) via gh CLI\n3. Create new OpenCode session\n4. Inject issue context (noReply: true, synthetic: true)\n5. Save session mapping\n6. Return sessionId\n\n## Context Injection Format\n\n```typescript\nfunction buildIssueContext(issue: GitHubIssue): string {\n  const comments = issue.comments?.length\n    ? issue.comments.map(c =\u003e\n        `**@${c.author.login}** (${new Date(c.createdAt).toLocaleDateString()}):\\n${c.body}`\n      ).join(\"\\n\\n\")\n    : \"No comments yet.\"\n\n  return `## GitHub Issue #${issue.number}\n\n**Title:** ${issue.title}\n**State:** ${issue.state}\n**Author:** @${issue.author.login}\n**Labels:** ${issue.labels.map(l =\u003e l.name).join(\", \") || \"None\"}\n**Created:** ${new Date(issue.createdAt).toLocaleDateString()}\n\n### Description\n${issue.body || \"No description provided.\"}\n\n### Comments\n${comments}\n\n---\nYou are helping discuss this GitHub issue. You can read the codebase to answer questions and suggest approaches, but you cannot modify any files. Focus on exploration and understanding.`\n}\n```\n\n## Files to Create\n\n- `src/app/api/projects/[id]/issues/[issueNumber]/session/route.ts`\n\n## Dependencies\n\n- OpenCodeService (previous task)\n- SessionStorageService (previous task)\n- Existing issue detail API (for fetching issue data)\n\n## Acceptance Criteria\n\n- [ ] GET returns sessionId if session exists and alive\n- [ ] GET returns null if no session\n- [ ] GET removes stale mappings for dead sessions\n- [ ] POST creates new session\n- [ ] POST injects full issue context\n- [ ] POST saves mapping to sessionStorage\n- [ ] Proper error handling for missing project/issue\n- [ ] Follows Next.js 15 async params pattern","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-30T10:35:12.798714-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:35:12.798714-06:00","dependencies":[{"issue_id":"maestro-fyp.1.4","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:35:12.80093-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.1.4","depends_on_id":"maestro-fyp.1.2","type":"blocks","created_at":"2025-12-30T10:39:14.362071-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.1.4","depends_on_id":"maestro-fyp.1.3","type":"blocks","created_at":"2025-12-30T10:39:14.39511-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.1.5","title":"Create OpenCode health check API endpoint","description":"## Task\n\nCreate `GET /api/health/opencode` - An endpoint to check if the OpenCode server is reachable.\n\n## Why\n\nThe frontend needs to know if OpenCode is available before attempting to use it. This enables:\n- Showing helpful error messages (\"Start opencode serve\")\n- Disabling chat UI when OpenCode is down\n- Periodic connectivity checks\n\n## Implementation\n\n```typescript\n// src/app/api/health/opencode/route.ts\n\nimport { openCodeService } from \"@/lib/services/opencode\"\nimport { NextResponse } from \"next/server\"\n\nexport async function GET() {\n  try {\n    const healthy = await openCodeService.isHealthy()\n    \n    if (healthy) {\n      return NextResponse.json({\n        status: \"healthy\",\n        url: process.env.OPENCODE_URL || \"http://localhost:4096\"\n      })\n    } else {\n      return NextResponse.json({\n        status: \"unhealthy\",\n        error: \"OpenCode server not responding\"\n      }, { status: 503 })\n    }\n  } catch (error) {\n    return NextResponse.json({\n      status: \"unhealthy\",\n      error: error instanceof Error ? error.message : \"Unknown error\"\n    }, { status: 503 })\n  }\n}\n```\n\n## Response Format\n\n```typescript\n// Success (200)\n{\n  status: \"healthy\",\n  url: \"http://localhost:4096\"\n}\n\n// Failure (503)\n{\n  status: \"unhealthy\",\n  error: \"Connection refused\" // or similar\n}\n```\n\n## Usage in Frontend\n\n```typescript\n// Poll health periodically\nconst { data: health } = useQuery({\n  queryKey: [\"opencode-health\"],\n  queryFn: () =\u003e fetch(\"/api/health/opencode\").then(r =\u003e r.json()),\n  refetchInterval: 30000, // Every 30 seconds\n})\n\nif (health?.status !== \"healthy\") {\n  // Show error banner\n}\n```\n\n## Files to Create\n\n- `src/app/api/health/opencode/route.ts`\n\n## Dependencies\n\n- OpenCodeService.isHealthy() method\n\n## Acceptance Criteria\n\n- [ ] Returns 200 with status: \"healthy\" when OpenCode is running\n- [ ] Returns 503 with status: \"unhealthy\" when OpenCode is down\n- [ ] Includes error message for debugging\n- [ ] Fast response (timeout after 5 seconds)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T10:35:20.199271-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:35:20.199271-06:00","dependencies":[{"issue_id":"maestro-fyp.1.5","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:35:20.201679-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.1.5","depends_on_id":"maestro-fyp.1.2","type":"blocks","created_at":"2025-12-30T10:39:14.427245-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.2","title":"Phase 2: Chat Integration","description":"## Phase 2: Chat Integration\n\nThis phase connects the existing Issue View UI to the OpenCode backend, replacing mock responses with real AI conversations.\n\n### Why This Phase Second?\n\nWith infrastructure in place (Phase 1), we can now wire up the actual chat experience. This is the core user value - being able to discuss GitHub issues with an AI that understands the codebase.\n\n### Key Behaviors\n\n**Context Injection**\nWhen a session starts, we inject the full GitHub issue context:\n- Issue title, body, state, author\n- All comments with authors and timestamps\n- Labels and metadata\n- Clear instructions that agent is in read-only mode\n\nThis ensures the AI has full context even if the session was just created.\n\n**Read-Only Mode**\nThe agent MUST NOT modify files during issue discussion. We enforce this by disabling tools:\n```typescript\ntools: {\n  bash: false,\n  write: false,\n  edit: false\n}\n```\n\nThe agent can still read files, search, and explore - just not change anything.\n\n**SSE Streaming**\nReal-time response streaming is critical for UX:\n- User sees text appear as it's generated\n- Can gauge response length\n- Feels interactive, not stuck\n\n### Session Lifecycle\n\n1. User opens issue → Check for existing session\n2. If session exists and alive → Resume it\n3. If no session or dead → Create new, inject context\n4. User sends message → Stream response\n5. Session dies mid-conversation → Auto-recreate, show toast\n\n### UI Updates\n\nThe existing Issue View page (`src/app/project/[id]/issue/[issueNumber]/page.tsx`) has:\n- Split panel layout (desktop)\n- Tabbed interface (mobile)\n- Mock chat with setTimeout\n\nWe need to:\n- Replace mock with OpenCode SDK calls\n- Add streaming text display\n- Add typing indicator\n- Handle reconnection gracefully\n\n### Dependencies\n\n- Phase 1 complete (OpenCodeService, SessionStorage, APIs)","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-30T10:33:34.463131-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:34:01.395728-06:00","dependencies":[{"issue_id":"maestro-fyp.2","depends_on_id":"maestro-fyp","type":"parent-child","created_at":"2025-12-30T10:33:34.463652-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2","depends_on_id":"maestro-fyp.1","type":"blocks","created_at":"2025-12-30T10:39:15.586636-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.2.1","title":"Connect Issue View to OpenCode SDK","description":"## Task\n\nReplace the mock setTimeout-based chat in the Issue View page with real OpenCode SDK calls.\n\n## Why\n\nCurrently the Issue View page at `src/app/project/[id]/issue/[issueNumber]/page.tsx` uses mock responses. This task connects it to the real OpenCode backend.\n\n## Current Implementation\n\n```typescript\n// Current mock pattern (to be replaced)\nconst handleSendMessage = async (content: string) =\u003e {\n  // Add user message\n  setMessages(prev =\u003e [...prev, { role: \"user\", content }])\n  \n  // Mock AI response with setTimeout\n  setTimeout(() =\u003e {\n    setMessages(prev =\u003e [...prev, { \n      role: \"assistant\", \n      content: \"This is a mock response...\" \n    }])\n  }, 1500)\n}\n```\n\n## New Implementation\n\n```typescript\nconst handleSendMessage = async (content: string) =\u003e {\n  // Add user message\n  setMessages(prev =\u003e [...prev, { role: \"user\", content }])\n  setIsLoading(true)\n  \n  try {\n    // Get or create session\n    let sessionId = await getSessionId()\n    if (!sessionId) {\n      sessionId = await createSession()\n    }\n    \n    // Send message in read-only mode\n    const response = await fetch(`/api/projects/${projectId}/issues/${issueNumber}/chat`, {\n      method: \"POST\",\n      body: JSON.stringify({ message: content, sessionId })\n    })\n    \n    // Handle streaming response (see SSE task)\n  } catch (error) {\n    // Handle error (see error handling phase)\n  } finally {\n    setIsLoading(false)\n  }\n}\n```\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Phase 1 complete (session APIs exist)\n\n## Acceptance Criteria\n\n- [ ] Chat sends real messages to OpenCode\n- [ ] Responses display correctly\n- [ ] Loading state shown while waiting\n- [ ] Input disabled during response\n- [ ] Session created automatically on first message","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-30T10:35:47.836573-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:35:47.836573-06:00","dependencies":[{"issue_id":"maestro-fyp.2.1","depends_on_id":"maestro-fyp.2","type":"parent-child","created_at":"2025-12-30T10:35:47.837216-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.1","depends_on_id":"maestro-fyp.1.4","type":"blocks","created_at":"2025-12-30T10:39:18.393914-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.2.2","title":"Implement context injection on session start","description":"## Task\n\nWhen a new session is created, inject the full GitHub issue context so the AI understands what is being discussed.\n\n## Why\n\nWithout context injection, the AI would have no idea what issue the user is discussing. By injecting title, body, comments, and instructions upfront, every message benefits from this context.\n\n## How Context Injection Works\n\nOpenCode SDK supports `synthetic: true` messages that appear in the context but were not typed by the user:\n\n```typescript\nawait client.session.prompt({\n  path: { id: sessionId },\n  body: {\n    noReply: true,      // Do not generate AI response\n    parts: [{\n      type: \"text\",\n      text: buildIssueContext(issue),\n      synthetic: true   // Mark as system-injected, not user message\n    }]\n  }\n})\n```\n\n## Context Format\n\n```markdown\n## GitHub Issue #42\n\n**Title:** Add user authentication flow\n**State:** open\n**Author:** @erikjohansson\n**Labels:** feature, authentication\n**Created:** 12/30/2024\n\n### Description\nWe need to implement OAuth2 authentication using Google and GitHub providers.\n\n### Comments\n**@alice** (12/29/2024):\nShould we also support email/password login?\n\n**@bob** (12/30/2024):\nI think OAuth only is fine for MVP.\n\n---\nYou are helping discuss this GitHub issue. You can read the codebase to answer questions and suggest approaches, but you cannot modify any files. Focus on exploration and understanding.\n```\n\n## Key Points\n\n1. **noReply: true** - We do not want AI to respond to context injection\n2. **synthetic: true** - Marks this as system context, not user message\n3. **Read-only instructions** - Clearly state the agent cannot modify files\n4. **Full context** - Include all comments so AI has complete picture\n\n## Files to Modify\n\n- `src/app/api/projects/[id]/issues/[issueNumber]/session/route.ts` (POST handler)\n\n## Dependencies\n\n- Session creation API exists (Phase 1)\n\n## Acceptance Criteria\n\n- [ ] Context injected uses noReply: true\n- [ ] Context injected uses synthetic: true\n- [ ] All issue metadata included (title, state, author, labels, created)\n- [ ] Full body text included\n- [ ] All comments included with authors and dates\n- [ ] Read-only instructions included\n- [ ] No AI response generated from injection","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-30T10:36:03.538445-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:36:03.538445-06:00","dependencies":[{"issue_id":"maestro-fyp.2.2","depends_on_id":"maestro-fyp.2","type":"parent-child","created_at":"2025-12-30T10:36:03.542055-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.2","depends_on_id":"maestro-fyp.1.4","type":"blocks","created_at":"2025-12-30T10:39:18.427815-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.2.3","title":"Add SSE streaming for responses","description":"## Task\n\nImplement Server-Sent Events (SSE) streaming so AI responses appear progressively as they are generated.\n\n## Why\n\nWithout streaming:\n- User stares at spinner for 10+ seconds\n- No feedback on response length\n- Feels unresponsive\n\nWith streaming:\n- Text appears word-by-word\n- User can start reading immediately\n- Feels interactive and fast\n\n## OpenCode SSE Events\n\n```typescript\nconst events = await client.event.subscribe()\n\nfor await (const event of events.stream) {\n  switch (event.type) {\n    case \"session.status\":\n      // { status: \"busy\" | \"idle\" }\n      break\n    case \"message.part.updated\":\n      // { delta: \"new text chunk\" }\n      break\n    case \"session.error\":\n      // { error: \"description\" }\n      break\n  }\n}\n```\n\n## Frontend Implementation\n\nCreate a chat API endpoint that streams:\n\n```typescript\n// src/app/api/projects/[id]/issues/[issueNumber]/chat/route.ts\n\nexport async function POST(request: Request, { params }) {\n  const { message, sessionId } = await request.json()\n  \n  // Create readable stream for SSE\n  const stream = new ReadableStream({\n    async start(controller) {\n      // Send message to OpenCode\n      const prompt = await openCodeService.sendReadOnlyMessage(sessionId, message)\n      \n      // Subscribe to events\n      const events = await openCodeService.subscribeToEvents()\n      \n      for await (const event of events) {\n        if (event.type === \"message.part.updated\") {\n          const data = `data: ${JSON.stringify({ delta: event.delta })}\\n\\n`\n          controller.enqueue(new TextEncoder().encode(data))\n        }\n        if (event.type === \"session.status\" \u0026\u0026 event.status === \"idle\") {\n          controller.close()\n          break\n        }\n      }\n    }\n  })\n  \n  return new Response(stream, {\n    headers: {\n      \"Content-Type\": \"text/event-stream\",\n      \"Cache-Control\": \"no-cache\",\n      \"Connection\": \"keep-alive\"\n    }\n  })\n}\n```\n\n## Frontend Consumption\n\n```typescript\nconst response = await fetch(`/api/.../chat`, {\n  method: \"POST\",\n  body: JSON.stringify({ message, sessionId })\n})\n\nconst reader = response.body.getReader()\nconst decoder = new TextDecoder()\n\nwhile (true) {\n  const { done, value } = await reader.read()\n  if (done) break\n  \n  const text = decoder.decode(value)\n  const lines = text.split(\"\\n\\n\")\n  \n  for (const line of lines) {\n    if (line.startsWith(\"data: \")) {\n      const { delta } = JSON.parse(line.slice(6))\n      setCurrentMessage(prev =\u003e prev + delta)\n    }\n  }\n}\n```\n\n## Files to Create/Modify\n\n- `src/app/api/projects/[id]/issues/[issueNumber]/chat/route.ts` (new)\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx` (consume stream)\n\n## Dependencies\n\n- OpenCodeService with event subscription\n\n## Acceptance Criteria\n\n- [ ] API endpoint returns SSE stream\n- [ ] Frontend consumes stream correctly\n- [ ] Text appears incrementally as generated\n- [ ] Stream closes when response complete\n- [ ] Error events handled gracefully","status":"open","priority":0,"issue_type":"task","created_at":"2025-12-30T10:36:18.457188-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:36:18.457188-06:00","dependencies":[{"issue_id":"maestro-fyp.2.3","depends_on_id":"maestro-fyp.2","type":"parent-child","created_at":"2025-12-30T10:36:18.459443-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.3","depends_on_id":"maestro-fyp.1.2","type":"blocks","created_at":"2025-12-30T10:39:18.461563-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.2.4","title":"Handle session reconnection","description":"## Task\n\nGracefully handle scenarios where an OpenCode session dies mid-conversation and needs to be recreated.\n\n## Why\n\nSessions can die for various reasons:\n- OpenCode server restart\n- Network interruption\n- Session timeout (if implemented)\n- Server crash\n\nUsers should not lose their conversation context or have to manually intervene.\n\n## Reconnection Flow\n\n1. User sends message\n2. Request fails with session error\n3. Detect session is dead\n4. Remove stale mapping from sessionStorage\n5. Create new session with context injection\n6. Retry the failed message\n7. Show brief toast: \"Reconnecting...\"\n\n## Implementation\n\n```typescript\nconst sendMessage = async (content: string) =\u003e {\n  try {\n    await sendToSession(sessionId, content)\n  } catch (error) {\n    if (isSessionDead(error)) {\n      // Show reconnecting toast\n      toast(\"Reconnecting to AI...\", { duration: 2000 })\n      \n      // Remove dead session\n      await fetch(`/api/.../session`, { method: \"DELETE\" })\n      \n      // Create new session (auto-injects context)\n      const { sessionId: newId } = await fetch(`/api/.../session`, {\n        method: \"POST\"\n      }).then(r =\u003e r.json())\n      \n      // Update local state\n      setSessionId(newId)\n      \n      // Retry message\n      await sendToSession(newId, content)\n    } else {\n      throw error // Other errors bubble up\n    }\n  }\n}\n\nfunction isSessionDead(error: unknown): boolean {\n  // Check for specific error codes/messages from OpenCode\n  // that indicate session no longer exists\n  return error.message?.includes(\"session not found\") ||\n         error.status === 404\n}\n```\n\n## UX Considerations\n\n1. **Transparent to user** - They should barely notice reconnection\n2. **Brief interruption** - Show toast, not blocking modal\n3. **No context loss** - New session gets full issue context\n4. **Retry automatic** - Do not make user resend message\n\n## Limitation\n\nThe new session will not have prior chat history (only the issue context). This is by design - chat history is ephemeral, summaries should be saved to GitHub if important.\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n- Possibly add DELETE handler to session route\n\n## Dependencies\n\n- Session creation with context injection (previous task)\n\n## Acceptance Criteria\n\n- [ ] Dead session detected automatically\n- [ ] New session created with context\n- [ ] Failed message retried on new session\n- [ ] User sees brief \"Reconnecting...\" toast\n- [ ] No user intervention required\n- [ ] Works for network interruptions too","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T10:36:33.657835-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:36:33.657835-06:00","dependencies":[{"issue_id":"maestro-fyp.2.4","depends_on_id":"maestro-fyp.2","type":"parent-child","created_at":"2025-12-30T10:36:33.659782-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.4","depends_on_id":"maestro-fyp.2.1","type":"blocks","created_at":"2025-12-30T10:39:18.494352-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.4","depends_on_id":"maestro-fyp.2.3","type":"blocks","created_at":"2025-12-30T10:39:18.526762-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.3","title":"Phase 3: GitHub Integration","description":"## Phase 3: GitHub Integration\n\nThis phase completes the bidirectional GitHub integration, allowing conversation context to flow back into the issue as persistent comments.\n\n### Why This Phase Third?\n\nWith chat working (Phase 2), users can have productive discussions. But those discussions are ephemeral - if the session dies, the conversation is lost. By enabling summary persistence to GitHub, we create lasting value from each discussion.\n\n### Design Philosophy\n\n**On-Demand, Not Automatic**\nWe explicitly chose NOT to auto-save conversations because:\n- Not every conversation is worth persisting\n- Users should curate what goes into the issue\n- Avoids cluttering issues with noise\n- Keeps user in control\n\n**Summary Generation**\nInstead of dumping raw chat logs, we ask the AI to summarize:\n- Key decisions made\n- Open questions identified\n- Suggested next steps\n- Relevant code references\n\nThis creates higher-quality GitHub comments that future readers can understand.\n\n### User Flow\n\n1. User clicks \"Save Summary\" button in chat footer\n2. Modal opens with auto-generated summary\n3. User can edit/refine the summary\n4. Preview shows how it will appear as GitHub comment\n5. User clicks \"Post to Issue\" → Comment added via `gh issue comment`\n6. Success toast, modal closes\n\n### Comment Format\n\n```markdown\n## Discussion Summary\n\n[Agent-generated summary, user-edited]\n\n---\n*Generated from Maestro discussion on [date]*\n```\n\nThe footer provides attribution and context for why this comment exists.\n\n### Comments Display\n\nThe existing API already fetches comments (`GET /api/projects/[id]/issues/[issueNumber]`), but the UI doesn't render them. This phase adds:\n- Comments thread in Issue Details panel\n- Author avatars/names\n- Timestamps\n- Markdown rendering\n\n### Dependencies\n\n- Phase 2 complete (working chat)\n- Existing issue detail API (already fetches comments)","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T10:33:34.51701-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:34:12.247408-06:00","dependencies":[{"issue_id":"maestro-fyp.3","depends_on_id":"maestro-fyp","type":"parent-child","created_at":"2025-12-30T10:33:34.5175-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.3","depends_on_id":"maestro-fyp.2","type":"blocks","created_at":"2025-12-30T10:39:24.1577-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.3.1","title":"Display comments in Issue Details panel","description":"## Task\n\nRender GitHub issue comments in the Issue Details panel (left side of split view).\n\n## Why\n\nThe existing API (`GET /api/projects/[id]/issues/[issueNumber]`) already fetches comments, but the UI does not render them. Comments provide important context:\n- Previous discussions\n- Decisions made\n- Questions raised\n\nUsers need to see this alongside the chat to have full context.\n\n## Current State\n\nThe API response already includes:\n```typescript\n{\n  number: 42,\n  title: \"...\",\n  body: \"...\",\n  state: \"open\",\n  comments: [\n    {\n      author: { login: \"alice\" },\n      body: \"Should we support email/password?\",\n      createdAt: \"2024-12-29T...\"\n    }\n  ]\n}\n```\n\nBut the UI only renders title, state, and body.\n\n## Implementation\n\n```tsx\n// In Issue Details panel\n{issue.comments \u0026\u0026 issue.comments.length \u003e 0 \u0026\u0026 (\n  \u003cdiv className=\"mt-6\"\u003e\n    \u003ch3 className=\"text-sm font-medium text-muted-foreground mb-3\"\u003e\n      Comments ({issue.comments.length})\n    \u003c/h3\u003e\n    \u003cdiv className=\"space-y-4\"\u003e\n      {issue.comments.map((comment, i) =\u003e (\n        \u003cdiv key={i} className=\"border-l-2 border-muted pl-4\"\u003e\n          \u003cdiv className=\"flex items-center gap-2 text-sm text-muted-foreground\"\u003e\n            \u003cspan className=\"font-medium\"\u003e@{comment.author.login}\u003c/span\u003e\n            \u003cspan\u003e•\u003c/span\u003e\n            \u003cspan\u003e{formatDate(comment.createdAt)}\u003c/span\u003e\n          \u003c/div\u003e\n          \u003cdiv className=\"mt-1 text-sm\"\u003e\n            {/* Render markdown or plain text */}\n            {comment.body}\n          \u003c/div\u003e\n        \u003c/div\u003e\n      ))}\n    \u003c/div\u003e\n  \u003c/div\u003e\n)}\n```\n\n## Markdown Rendering\n\nFor MVP, plain text is acceptable. Consider adding `react-markdown` later for proper rendering. The comment body might contain:\n- Code blocks\n- Links\n- Lists\n- Bold/italic\n\n## Empty State\n\nIf no comments:\n```tsx\n\u003cp className=\"text-sm text-muted-foreground italic\"\u003eNo comments yet.\u003c/p\u003e\n```\n\nOr simply omit the Comments section entirely.\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Issue API already returns comments (complete)\n\n## Acceptance Criteria\n\n- [ ] Comments section appears in Issue Details panel\n- [ ] Each comment shows author name\n- [ ] Each comment shows creation date (formatted)\n- [ ] Comment body is displayed\n- [ ] Comments count shown in header\n- [ ] Empty state handled gracefully\n- [ ] Scrollable if many comments","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T10:36:51.418663-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:36:51.418663-06:00","dependencies":[{"issue_id":"maestro-fyp.3.1","depends_on_id":"maestro-fyp.3","type":"parent-child","created_at":"2025-12-30T10:36:51.420767-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.3.2","title":"Add comment posting API endpoint","description":"## Task\n\nCreate `POST /api/projects/[id]/issues/[issueNumber]/comment` - An endpoint to add comments to GitHub issues.\n\n## Why\n\nThe \"Save Summary\" feature needs a way to post conversation summaries as GitHub comments. This endpoint provides that capability.\n\n## Implementation\n\n```typescript\n// src/app/api/projects/[id]/issues/[issueNumber]/comment/route.ts\n\nimport { exec } from \"child_process\"\nimport { promisify } from \"util\"\nimport { configService } from \"@/lib/services/config\"\nimport { NextResponse } from \"next/server\"\n\nconst execAsync = promisify(exec)\n\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise\u003c{ id: string; issueNumber: string }\u003e }\n) {\n  const { id, issueNumber } = await params\n  const { body } = await request.json()\n\n  if (!body || typeof body !== \"string\") {\n    return NextResponse.json(\n      { error: \"Comment body is required\" },\n      { status: 400 }\n    )\n  }\n\n  const project = await configService.getProject(id)\n  if (!project) {\n    return NextResponse.json(\n      { error: \"Project not found\" },\n      { status: 404 }\n    )\n  }\n\n  try {\n    // Use gh CLI to add comment\n    // Escape the body for shell safety\n    const escapedBody = body.replace(/\"/g, \"\\\\\\\"\")\n    \n    await execAsync(\n      `gh issue comment ${issueNumber} --body \"${escapedBody}\"`,\n      { cwd: project.path }\n    )\n\n    return NextResponse.json({ success: true }, { status: 201 })\n  } catch (error) {\n    console.error(\"Failed to post comment:\", error)\n    return NextResponse.json(\n      { error: \"Failed to post comment to GitHub\" },\n      { status: 500 }\n    )\n  }\n}\n```\n\n## Shell Escaping Consideration\n\nThe comment body might contain:\n- Quotes\n- Backticks  \n- Newlines\n- Special characters\n\nA safer approach might use stdin:\n```bash\necho \"$body\" | gh issue comment 42 --body-file -\n```\n\nOr write to temp file first.\n\n## Request/Response\n\n```typescript\n// Request\nPOST /api/projects/abc123/issues/42/comment\n{ \"body\": \"## Summary\\n\\nThis is the discussion summary...\" }\n\n// Success (201)\n{ \"success\": true }\n\n// Error (400)\n{ \"error\": \"Comment body is required\" }\n\n// Error (500)\n{ \"error\": \"Failed to post comment to GitHub\" }\n```\n\n## Files to Create\n\n- `src/app/api/projects/[id]/issues/[issueNumber]/comment/route.ts`\n\n## Dependencies\n\n- Project config service (exists)\n- gh CLI authenticated (prerequisite)\n\n## Acceptance Criteria\n\n- [ ] POST creates comment on GitHub issue\n- [ ] Handles multiline body correctly\n- [ ] Handles special characters safely\n- [ ] Returns 201 on success\n- [ ] Returns 400 if body missing\n- [ ] Returns 404 if project not found\n- [ ] Returns 500 on gh CLI error","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T10:37:05.505163-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:37:05.505163-06:00","dependencies":[{"issue_id":"maestro-fyp.3.2","depends_on_id":"maestro-fyp.3","type":"parent-child","created_at":"2025-12-30T10:37:05.507115-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.3.2","depends_on_id":"maestro-fyp.2.1","type":"blocks","created_at":"2025-12-30T10:39:24.188788-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.3.3","title":"Implement Save Summary modal","description":"## Task\n\nCreate a modal dialog that generates a conversation summary and allows the user to edit and post it to the GitHub issue.\n\n## Why\n\nConversations are ephemeral - when the session ends, they are gone. By saving summaries to GitHub:\n- Key decisions are preserved\n- Future sessions have context\n- Other team members can see discussions\n- Issues become richer documentation\n\n## User Flow\n\n1. User clicks \"Save Summary\" button in chat footer\n2. Modal opens, shows \"Generating summary...\" spinner\n3. AI generates summary of conversation\n4. Summary displayed in editable textarea\n5. Preview shows how it appears as GitHub comment\n6. User can edit the summary\n7. User clicks \"Post to Issue\" \n8. Comment posted via API\n9. Success toast, modal closes\n10. Comments list refreshes (optional)\n\n## Summary Generation\n\nAsk the AI to summarize:\n```typescript\nconst summary = await openCodeService.generateSummary(sessionId)\n\n// Uses prompt like:\n\"Summarize our discussion so far in 2-3 paragraphs. Focus on:\n- Key decisions made\n- Open questions identified\n- Suggested next steps\nFormat as markdown.\"\n```\n\n## UI Design\n\n```\n┌────────────────────────────────────────────────────────┐\n│ Save Discussion Summary                           [X]  │\n├────────────────────────────────────────────────────────┤\n│                                                        │\n│  The AI has summarized your discussion:                │\n│                                                        │\n│  ┌──────────────────────────────────────────────────┐  │\n│  │ ## Summary                                       │  │\n│  │                                                  │  │\n│  │ We discussed implementing OAuth2 authentication │  │\n│  │ using Google and GitHub providers. Key decision:│  │\n│  │ - Start with Google OAuth only for MVP          │  │\n│  │ - Add GitHub OAuth in v2                        │  │\n│  │                                                  │  │\n│  │ Open questions:                                  │  │\n│  │ - Should we support email/password later?       │  │\n│  │                                                  │  │\n│  │ Next steps:                                      │  │\n│  │ 1. Set up Google OAuth credentials              │  │\n│  │ 2. Implement auth middleware                    │  │\n│  └──────────────────────────────────────────────────┘  │\n│                                                        │\n│  Preview:                                              │\n│  ┌──────────────────────────────────────────────────┐  │\n│  │ (rendered markdown preview)                      │  │\n│  │ ---                                              │  │\n│  │ Generated from Maestro discussion on 12/30/2024 │  │\n│  └──────────────────────────────────────────────────┘  │\n│                                                        │\n├────────────────────────────────────────────────────────┤\n│                        [Cancel]  [Post to Issue]       │\n└────────────────────────────────────────────────────────┘\n```\n\n## Component Structure\n\n```typescript\n// src/components/save-summary-modal/SaveSummaryModal.tsx\n\ninterface SaveSummaryModalProps {\n  open: boolean\n  onOpenChange: (open: boolean) =\u003e void\n  projectId: string\n  issueNumber: number\n  sessionId: string\n  onSuccess?: () =\u003e void\n}\n\nexport function SaveSummaryModal({ ... }: SaveSummaryModalProps) {\n  const [summary, setSummary] = useState(\"\")\n  const [isGenerating, setIsGenerating] = useState(true)\n  const [isPosting, setIsPosting] = useState(false)\n\n  // Generate summary on open\n  useEffect(() =\u003e {\n    if (open) {\n      generateSummary()\n    }\n  }, [open])\n\n  const generateSummary = async () =\u003e { ... }\n  const handlePost = async () =\u003e { ... }\n\n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent\u003e\n        {/* ... */}\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  )\n}\n```\n\n## Comment Format\n\n```markdown\n## Discussion Summary\n\n[User-edited summary text]\n\n---\n*Generated from Maestro discussion on [date]*\n```\n\n## Files to Create\n\n- `src/components/save-summary-modal/SaveSummaryModal.tsx`\n- `src/components/save-summary-modal/index.ts`\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx` (add button + modal)\n\n## Dependencies\n\n- Comment posting API (previous task)\n- OpenCodeService.generateSummary() method (Phase 1)\n\n## Acceptance Criteria\n\n- [ ] Modal opens from \"Save Summary\" button\n- [ ] Summary auto-generated on open\n- [ ] Loading state while generating\n- [ ] Summary editable in textarea\n- [ ] Preview shows rendered markdown + footer\n- [ ] Cancel closes without posting\n- [ ] Post creates GitHub comment\n- [ ] Success toast shown\n- [ ] Modal closes on success\n- [ ] Error handling for generation/posting failures","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-30T10:37:30.225662-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:37:30.225662-06:00","dependencies":[{"issue_id":"maestro-fyp.3.3","depends_on_id":"maestro-fyp.3","type":"parent-child","created_at":"2025-12-30T10:37:30.228062-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.3.3","depends_on_id":"maestro-fyp.3.2","type":"blocks","created_at":"2025-12-30T10:39:24.222617-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.3.3","depends_on_id":"maestro-fyp.2.3","type":"blocks","created_at":"2025-12-30T10:39:24.255451-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.4","title":"Phase 4: Polish \u0026 Error Handling","description":"## Phase 4: Polish \u0026 Error Handling\n\nThis phase adds robustness, better UX, and handles edge cases that make the difference between a prototype and a production-quality feature.\n\n### Why This Phase Last?\n\nCore functionality must work first (Phases 1-3). Polish is important but not blocking. Users can use a working feature with rough edges; they can't use a polished feature that doesn't work.\n\n### Error Handling Strategy\n\n**Hierarchy of Errors**\n```\n┌─────────────────────────────────────────────┐\n│ [Global Banner - server connectivity]       │  ← Persistent until resolved\n├─────────────────────────────────────────────┤\n│   Issue Details        │  Chat Area         │\n│   [Inline error if     │  [Inline error if  │  ← Contextual errors\n│    issue fetch fails]  │   session fails]   │\n│                        │  [Toast for        │  ← Transient notifications\n│                        │   minor issues]    │\n└─────────────────────────────────────────────┘\n```\n\n**Specific Error Scenarios**\n| Scenario | UI Behavior |\n|----------|-------------|\n| OpenCode unreachable | Banner: \"Cannot connect to OpenCode server\" + Retry |\n| GitHub API failure | Inline error + Retry button |\n| Rate limit | Banner with reset time |\n| Session dies | Auto-recreate with \"Reconnecting...\" toast |\n| Message send fails | Keep message in input, show error, enable retry |\n| Issue not found | 404 page with link back |\n\n### UX Polish\n\n**Panel Resizing**\nCurrently hardcoded at 400px. Should be draggable with:\n- Mouse drag handle\n- Min/max constraints (200px - 50% of viewport)\n- Persist preference to localStorage\n\n**Mobile Unread Indicator**\nWhen on Details tab and agent responds:\n- Show badge on Chat tab\n- Clear badge when user switches to Chat tab\n\n**Loading States**\n- Skeleton loader for issue details\n- \"Starting conversation...\" spinner\n- Typing indicator (pulsing dots)\n- Streaming text (progressive reveal)\n- \"Creating...\" states for buttons\n\n**Empty States**\n- No description: italic \"No description provided.\"\n- No comments: section hidden or subtle message\n- No chat: \"Ask the agent about this issue to start exploring.\"\n\n### Dependencies\n\n- Phases 1-3 complete (all core functionality working)\n- Can be worked on incrementally after MVP launch","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-30T10:33:34.56895-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:34:26.086679-06:00","dependencies":[{"issue_id":"maestro-fyp.4","depends_on_id":"maestro-fyp","type":"parent-child","created_at":"2025-12-30T10:33:34.569389-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4","depends_on_id":"maestro-fyp.3","type":"blocks","created_at":"2025-12-30T10:39:26.262701-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.4.1","title":"Create global error banner component","description":"## Task\n\nCreate an ErrorBanner component that displays persistent connectivity errors at the top of the application.\n\n## Why\n\nWhen critical services are unavailable (OpenCode server, GitHub), users need clear, persistent feedback - not just momentary toasts that disappear. The banner:\n- Stays visible until issue resolved\n- Provides actionable guidance\n- Does not block UI interaction\n\n## Design\n\n```\n┌─────────────────────────────────────────────────────────────────────┐\n│ ⚠ Cannot connect to OpenCode server. Run `opencode serve` [Retry]  │\n└─────────────────────────────────────────────────────────────────────┘\n│                                                                     │\n│  (rest of application)                                              │\n```\n\n## Error Types\n\n| Error | Message | Action |\n|-------|---------|--------|\n| OpenCode down | \"Cannot connect to OpenCode server. Make sure `opencode serve` is running.\" | Retry button |\n| GitHub rate limit | \"GitHub rate limit exceeded. Resets at 3:45 PM.\" | Shows countdown |\n| gh not authenticated | \"GitHub CLI not authenticated. Run `gh auth login` in terminal.\" | No retry (user action needed) |\n\n## Implementation\n\n```typescript\n// src/components/error-banner/ErrorBanner.tsx\n\ninterface ErrorBannerProps {\n  type: \"opencode\" | \"github-rate-limit\" | \"github-auth\"\n  message: string\n  onRetry?: () =\u003e void\n  retryLabel?: string\n  rateLimitReset?: Date  // For rate limit errors\n}\n\nexport function ErrorBanner({ type, message, onRetry, rateLimitReset }: ErrorBannerProps) {\n  return (\n    \u003cdiv className=\"bg-destructive/10 border-b border-destructive/20 px-4 py-2 text-sm\"\u003e\n      \u003cdiv className=\"flex items-center justify-between max-w-screen-xl mx-auto\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cAlertTriangle className=\"h-4 w-4 text-destructive\" /\u003e\n          \u003cspan className=\"text-destructive\"\u003e{message}\u003c/span\u003e\n          {rateLimitReset \u0026\u0026 (\n            \u003cspan className=\"text-muted-foreground\"\u003e\n              Resets in {formatTimeUntil(rateLimitReset)}\n            \u003c/span\u003e\n          )}\n        \u003c/div\u003e\n        {onRetry \u0026\u0026 (\n          \u003cButton variant=\"ghost\" size=\"sm\" onClick={onRetry}\u003e\n            {retryLabel || \"Retry\"}\n          \u003c/Button\u003e\n        )}\n      \u003c/div\u003e\n    \u003c/div\u003e\n  )\n}\n```\n\n## Context Provider\n\nFor global error state:\n\n```typescript\n// src/lib/contexts/error-context.tsx\n\ninterface ErrorState {\n  opencodeError: string | null\n  githubError: string | null\n  rateLimitReset: Date | null\n}\n\nexport const ErrorContext = createContext\u003c{\n  errors: ErrorState\n  setOpenCodeError: (error: string | null) =\u003e void\n  setGitHubError: (error: string | null) =\u003e void\n  checkOpenCodeHealth: () =\u003e Promise\u003cvoid\u003e\n}\u003e()\n```\n\n## Integration Points\n\n- Check OpenCode health on app load\n- Check GitHub auth on first API call\n- Parse rate limit headers from GitHub responses\n- Clear errors when connectivity restored\n\n## Files to Create\n\n- `src/components/error-banner/ErrorBanner.tsx`\n- `src/components/error-banner/index.ts`\n- `src/lib/contexts/error-context.tsx` (or add to providers.tsx)\n\n## Files to Modify\n\n- `src/app/layout.tsx` or providers - Add error banner at top\n- API routes - Return rate limit info in headers\n\n## Dependencies\n\n- Health check API (Phase 1)\n\n## Acceptance Criteria\n\n- [ ] Banner appears when OpenCode unreachable\n- [ ] Banner appears for GitHub rate limit\n- [ ] Banner appears for gh auth errors\n- [ ] Retry button triggers health check\n- [ ] Banner dismisses when error resolved\n- [ ] Does not block page interaction\n- [ ] Rate limit shows countdown\n- [ ] Consistent styling with app theme","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-30T10:37:54.707057-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:37:54.707057-06:00","dependencies":[{"issue_id":"maestro-fyp.4.1","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:37:54.709051-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4.1","depends_on_id":"maestro-fyp.1.5","type":"blocks","created_at":"2025-12-30T10:39:26.299505-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.4.2","title":"Add panel resizing for Issue View","description":"## Task\n\nMake the Issue Details panel width adjustable via drag handle, replacing the current fixed 400px width.\n\n## Why\n\nDifferent users have different preferences:\n- Some want more space for long issue descriptions\n- Some prefer larger chat area\n- Content width varies per issue\n\nA fixed width forces everyone into the same experience.\n\n## Current Implementation\n\n```tsx\n// Current fixed width\n\u003cdiv className=\"w-[400px] border-r\"\u003e\n  {/* Issue Details */}\n\u003c/div\u003e\n\u003cdiv className=\"flex-1\"\u003e\n  {/* Chat */}\n\u003c/div\u003e\n```\n\n## New Implementation\n\n```tsx\nconst [panelWidth, setPanelWidth] = useState(() =\u003e {\n  // Load from localStorage or default\n  return parseInt(localStorage.getItem(\"issue-panel-width\") || \"400\")\n})\n\nconst handleDrag = (e: MouseEvent) =\u003e {\n  const newWidth = Math.max(200, Math.min(e.clientX, window.innerWidth * 0.5))\n  setPanelWidth(newWidth)\n}\n\nconst handleDragEnd = () =\u003e {\n  localStorage.setItem(\"issue-panel-width\", panelWidth.toString())\n}\n\nreturn (\n  \u003cdiv className=\"flex h-full\"\u003e\n    \u003cdiv style={{ width: panelWidth }} className=\"border-r relative\"\u003e\n      {/* Issue Details */}\n      \n      {/* Drag handle */}\n      \u003cdiv \n        className=\"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-primary/20\"\n        onMouseDown={startDrag}\n      /\u003e\n    \u003c/div\u003e\n    \u003cdiv className=\"flex-1\"\u003e\n      {/* Chat */}\n    \u003c/div\u003e\n  \u003c/div\u003e\n)\n```\n\n## Drag Handle UX\n\n1. **Visual feedback** - Handle highlights on hover\n2. **Cursor change** - `cursor-col-resize` indicates draggable\n3. **Smooth dragging** - Update width on mousemove\n4. **Persist on release** - Save to localStorage on mouseup\n5. **Constraints** - Min 200px, max 50% of viewport\n\n## Considerations\n\n- **Mobile** - No resizing on mobile (tabbed interface)\n- **Performance** - Debounce localStorage writes\n- **Accessibility** - Consider keyboard-based resizing (optional)\n- **Reset** - Double-click handle to reset to default? (optional)\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Optional: Reusable Hook\n\n```typescript\n// src/lib/hooks/useResizablePanel.ts\nexport function useResizablePanel(storageKey: string, defaultWidth: number) {\n  const [width, setWidth] = useState(defaultWidth)\n  const isDragging = useRef(false)\n  \n  // ... drag logic\n  \n  return { width, dragHandleProps }\n}\n```\n\n## Dependencies\n\nNone - can be implemented independently\n\n## Acceptance Criteria\n\n- [ ] Drag handle visible on right edge of panel\n- [ ] Handle highlights on hover\n- [ ] Cursor changes to resize cursor\n- [ ] Width updates while dragging\n- [ ] Width saved to localStorage on release\n- [ ] Width restored on page reload\n- [ ] Min width enforced (200px)\n- [ ] Max width enforced (50% viewport)\n- [ ] Only active on desktop (\u003e768px)\n- [ ] Smooth, performant dragging","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-30T10:38:11.191988-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:38:11.191988-06:00","dependencies":[{"issue_id":"maestro-fyp.4.2","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:38:11.194109-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.4.3","title":"Add mobile unread indicator","description":"## Task\n\nShow a badge on the Chat tab when the user is viewing the Details tab and the AI responds with new messages.\n\n## Why\n\nOn mobile, users switch between Details and Chat tabs. If they are reading details while the AI responds, they have no indication that new messages arrived. The unread indicator:\n- Signals new activity\n- Encourages tab switch\n- Prevents user from wondering if AI responded\n\n## Design\n\n```\n┌─────────────────────────────────────────┐\n│ ←  #42: Add auth flow              [···]│\n├─────────────────────────────────────────┤\n│   Details    │    Chat ●                │  ← Red dot = unread\n├─────────────────────────────────────────┤\n```\n\n## Implementation\n\n```tsx\nconst [activeTab, setActiveTab] = useState\u003c\"details\" | \"chat\"\u003e(\"chat\")\nconst [hasUnread, setHasUnread] = useState(false)\n\n// When new message arrives\nconst handleNewMessage = (message) =\u003e {\n  setMessages(prev =\u003e [...prev, message])\n  \n  // Mark unread if not on chat tab\n  if (activeTab !== \"chat\") {\n    setHasUnread(true)\n  }\n}\n\n// Clear unread when switching to chat\nconst handleTabChange = (tab) =\u003e {\n  setActiveTab(tab)\n  if (tab === \"chat\") {\n    setHasUnread(false)\n  }\n}\n\n// Tab bar rendering\n\u003cdiv className=\"flex border-b\"\u003e\n  \u003cbutton\n    className={cn(\"flex-1 py-2\", activeTab === \"details\" \u0026\u0026 \"border-b-2\")}\n    onClick={() =\u003e handleTabChange(\"details\")}\n  \u003e\n    Details\n  \u003c/button\u003e\n  \u003cbutton\n    className={cn(\"flex-1 py-2 relative\", activeTab === \"chat\" \u0026\u0026 \"border-b-2\")}\n    onClick={() =\u003e handleTabChange(\"chat\")}\n  \u003e\n    Chat\n    {hasUnread \u0026\u0026 (\n      \u003cspan className=\"absolute top-1 right-1/4 h-2 w-2 bg-destructive rounded-full\" /\u003e\n    )}\n  \u003c/button\u003e\n\u003c/div\u003e\n```\n\n## Behavior Details\n\n| State | Action | Result |\n|-------|--------|--------|\n| On Chat tab | AI responds | No badge (user sees it) |\n| On Details tab | AI responds | Badge appears |\n| Badge visible | Switch to Chat | Badge clears |\n| Badge visible | Switch to Details | Badge stays |\n| On Chat tab | Switch to Details then back | No badge |\n\n## Visual Design\n\n- Small red dot (not a number badge)\n- Positioned near tab text\n- Matches destructive color for visibility\n- Animates in with slight fade/scale? (optional)\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Streaming messages working (Phase 2)\n- Only relevant on mobile (already have tab UI)\n\n## Acceptance Criteria\n\n- [ ] Badge appears when AI responds on Details tab\n- [ ] Badge clears when switching to Chat tab\n- [ ] Badge only shows on mobile layout\n- [ ] Badge positioned correctly relative to tab\n- [ ] Badge uses consistent styling (red dot)\n- [ ] No badge when already on Chat tab","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-30T10:38:27.794788-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:38:27.794788-06:00","dependencies":[{"issue_id":"maestro-fyp.4.3","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:38:27.796975-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4.3","depends_on_id":"maestro-fyp.2.3","type":"blocks","created_at":"2025-12-30T10:39:26.333965-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.4.4","title":"Improve loading and empty states","description":"## Task\n\nAdd comprehensive loading states and empty states throughout the Issue View.\n\n## Why\n\nUsers need feedback about what is happening:\n- Is data loading?\n- Is the AI thinking?\n- Why is this section empty?\n\nGood loading/empty states reduce confusion and perceived wait time.\n\n## Loading States to Add\n\n### 1. Issue Details Loading\nCurrently: Nothing while fetching\nGoal: Skeleton loader\n\n```tsx\n{isLoading ? (\n  \u003cdiv className=\"space-y-4\"\u003e\n    \u003cSkeleton className=\"h-6 w-3/4\" /\u003e  {/* Title */}\n    \u003cSkeleton className=\"h-4 w-1/4\" /\u003e  {/* Metadata */}\n    \u003cSkeleton className=\"h-24 w-full\" /\u003e {/* Body */}\n  \u003c/div\u003e\n) : (\n  \u003cIssueDetails issue={issue} /\u003e\n)}\n```\n\n### 2. Session Starting\nCurrently: Nothing\nGoal: \"Starting conversation...\" with spinner\n\n```tsx\n{isCreatingSession \u0026\u0026 (\n  \u003cdiv className=\"flex items-center justify-center py-8\"\u003e\n    \u003cLoader2 className=\"h-4 w-4 animate-spin mr-2\" /\u003e\n    \u003cspan className=\"text-muted-foreground\"\u003eStarting conversation...\u003c/span\u003e\n  \u003c/div\u003e\n)}\n```\n\n### 3. AI Responding\nCurrently: Nothing (or basic spinner)\nGoal: Typing indicator (pulsing dots)\n\n```tsx\n{isTyping \u0026\u0026 (\n  \u003cdiv className=\"flex items-center gap-1 text-muted-foreground\"\u003e\n    \u003cspan className=\"animate-pulse\"\u003e●\u003c/span\u003e\n    \u003cspan className=\"animate-pulse delay-100\"\u003e●\u003c/span\u003e\n    \u003cspan className=\"animate-pulse delay-200\"\u003e●\u003c/span\u003e\n  \u003c/div\u003e\n)}\n```\n\n### 4. Streaming Response\nAlready streaming text, but should:\n- Disable input while streaming\n- Show cursor at end of text\n\n## Empty States to Add\n\n### 1. No Issue Description\n```tsx\n\u003cp className=\"text-sm text-muted-foreground italic\"\u003e\n  No description provided.\n\u003c/p\u003e\n```\n\n### 2. No Comments\nEither hide section or:\n```tsx\n\u003cp className=\"text-sm text-muted-foreground\"\u003e\n  No comments yet.\n\u003c/p\u003e\n```\n\n### 3. No Chat History (New Session)\n```tsx\n\u003cdiv className=\"flex flex-col items-center justify-center h-full text-center p-8\"\u003e\n  \u003cMessageSquare className=\"h-12 w-12 text-muted-foreground/50 mb-4\" /\u003e\n  \u003ch3 className=\"font-medium\"\u003eStart a conversation\u003c/h3\u003e\n  \u003cp className=\"text-sm text-muted-foreground mt-1\"\u003e\n    Ask the agent about this issue to start exploring.\n  \u003c/p\u003e\n\u003c/div\u003e\n```\n\n## Button Loading States\n\n### Create Issue\n```tsx\n\u003cButton disabled={isCreating}\u003e\n  {isCreating ? (\n    \u003c\u003e\n      \u003cLoader2 className=\"h-4 w-4 animate-spin mr-2\" /\u003e\n      Creating...\n    \u003c/\u003e\n  ) : (\n    \"Create Issue\"\n  )}\n\u003c/Button\u003e\n```\n\n### Send Message\nInput disabled, button shows spinner\n\n### Save Summary (in modal)\n```tsx\n\u003cButton disabled={isPosting}\u003e\n  {isPosting ? \"Posting...\" : \"Post to Issue\"}\n\u003c/Button\u003e\n```\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n- Possibly create `src/components/ui/skeleton.tsx` if not exists\n\n## Dependencies\n\n- Chat integration working (Phase 2) for typing states\n\n## Acceptance Criteria\n\n- [ ] Issue details show skeleton while loading\n- [ ] \"Starting conversation...\" shown during session creation\n- [ ] Typing indicator shown while AI generating\n- [ ] Input disabled during streaming\n- [ ] No description shows placeholder text\n- [ ] No comments handled gracefully\n- [ ] Empty chat shows helpful prompt\n- [ ] All buttons show loading state when appropriate\n- [ ] Loading states match app visual style","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-30T10:38:48.027519-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:38:48.027519-06:00","dependencies":[{"issue_id":"maestro-fyp.4.4","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:38:48.030715-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4.4","depends_on_id":"maestro-fyp.2.1","type":"blocks","created_at":"2025-12-30T10:39:26.367831-06:00","created_by":"daemon"}]}
{"id":"maestro-fyp.4.5","title":"Add contextual error handling","description":"## Task\n\nAdd inline error handling for specific failure scenarios that do not warrant a global banner.\n\n## Why\n\nNot all errors are equal:\n- OpenCode server down = global banner (affects all features)\n- Single API call failed = contextual inline error\n- Network hiccup = toast with retry\n\nMatching error severity to UI treatment reduces alarm fatigue.\n\n## Error Scenarios\n\n### Issue Fetch Failed\nShow inline error in Issue Details panel:\n\n```tsx\n{issueError \u0026\u0026 (\n  \u003cdiv className=\"rounded-md bg-destructive/10 p-4\"\u003e\n    \u003cdiv className=\"flex items-start gap-3\"\u003e\n      \u003cAlertCircle className=\"h-5 w-5 text-destructive mt-0.5\" /\u003e\n      \u003cdiv className=\"flex-1\"\u003e\n        \u003cp className=\"text-sm font-medium text-destructive\"\u003e\n          Failed to load issue\n        \u003c/p\u003e\n        \u003cp className=\"text-sm text-muted-foreground mt-1\"\u003e\n          {issueError.message}\n        \u003c/p\u003e\n        \u003cButton \n          variant=\"outline\" \n          size=\"sm\" \n          className=\"mt-3\"\n          onClick={refetchIssue}\n        \u003e\n          Try again\n        \u003c/Button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n)}\n```\n\n### Session Creation Failed\nShow inline error in Chat area:\n\n```tsx\n{sessionError \u0026\u0026 (\n  \u003cdiv className=\"flex flex-col items-center justify-center h-full p-8\"\u003e\n    \u003cAlertCircle className=\"h-12 w-12 text-destructive/50 mb-4\" /\u003e\n    \u003ch3 className=\"font-medium\"\u003eCould not start conversation\u003c/h3\u003e\n    \u003cp className=\"text-sm text-muted-foreground mt-1 text-center\"\u003e\n      {sessionError.message}\n    \u003c/p\u003e\n    \u003cButton className=\"mt-4\" onClick={retrySession}\u003e\n      Try again\n    \u003c/Button\u003e\n  \u003c/div\u003e\n)}\n```\n\n### Message Send Failed\nKeep message in input, show toast with retry:\n\n```tsx\ntry {\n  await sendMessage(content)\n  setInput(\"\")\n} catch (error) {\n  // Do NOT clear input\n  toast({\n    variant: \"destructive\",\n    title: \"Message failed to send\",\n    description: \"Check your connection and try again.\",\n    action: (\n      \u003cButton size=\"sm\" variant=\"outline\" onClick={() =\u003e sendMessage(content)}\u003e\n        Retry\n      \u003c/Button\u003e\n    ),\n  })\n}\n```\n\n### Issue Not Found (404)\nNavigate to 404 page with helpful link:\n\n```tsx\n// src/app/project/[id]/issue/[issueNumber]/not-found.tsx\n\nexport default function IssueNotFound() {\n  return (\n    \u003cdiv className=\"flex flex-col items-center justify-center min-h-screen\"\u003e\n      \u003ch1 className=\"text-4xl font-bold\"\u003eIssue Not Found\u003c/h1\u003e\n      \u003cp className=\"text-muted-foreground mt-2\"\u003e\n        This issue may have been deleted or you do not have access.\n      \u003c/p\u003e\n      \u003cButton asChild className=\"mt-4\"\u003e\n        \u003cLink href={`/project/${projectId}`}\u003e\n          Back to Project\n        \u003c/Link\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  )\n}\n```\n\n### Comment Post Failed\nError toast with the comment preserved:\n\n```tsx\ntry {\n  await postComment(summary)\n  closeModal()\n  toast({ title: \"Summary posted to issue\" })\n} catch (error) {\n  toast({\n    variant: \"destructive\",\n    title: \"Failed to post comment\",\n    description: error.message,\n  })\n  // Modal stays open with content preserved\n}\n```\n\n## Error Recovery Patterns\n\n1. **Inline + Retry** - For fetch failures (issue, session)\n2. **Toast + Retry** - For transient failures (send message)\n3. **Preserve Input** - Never lose user-typed content\n4. **Navigate Away** - For unrecoverable (404, auth)\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n- Create `src/app/project/[id]/issue/[issueNumber]/not-found.tsx`\n- Possibly add toast component if not exists\n\n## Dependencies\n\n- Basic functionality working (Phase 2-3)\n\n## Acceptance Criteria\n\n- [ ] Issue fetch error shows inline with retry\n- [ ] Session error shows centered with retry\n- [ ] Message send error keeps input, shows toast\n- [ ] 404 issue shows helpful page\n- [ ] Comment post error keeps modal open\n- [ ] All errors have actionable next steps\n- [ ] No user input ever lost on error","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-30T10:39:08.713154-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T10:39:08.713154-06:00","dependencies":[{"issue_id":"maestro-fyp.4.5","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:39:08.716595-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4.5","depends_on_id":"maestro-fyp.2.1","type":"blocks","created_at":"2025-12-30T10:39:26.401642-06:00","created_by":"daemon"}]}
{"id":"maestro-slm","title":"Project List: Add and Manage Projects via Remote Filesystem Browser","description":"## Overview\n\nImplement the project list view - the main entry point to Maestro. This replaces the current mock data with a real persistence layer and adds a custom folder browser for adding projects from the server's filesystem.\n\n## Background \u0026 Context\n\n### Why This Matters\nMaestro is a mobile-friendly web frontend for OpenCode that runs on a user's dev machine and is accessed remotely via Tailscale. The project list is the **first screen users see** and the **foundation for all other features**. Without real project persistence, nothing else in Maestro can function.\n\n### Technical Constraint: Remote Access\nBecause Maestro runs as a Next.js server on the dev machine but is accessed from remote clients (phone, tablet, another laptop via Tailscale):\n- **Browser file picker APIs won't work** - they open on the client device, not the server\n- **We need a custom server-side folder browser** that exposes the server's filesystem\n- **All storage is server-side** - config lives at `~/.maestro/config.json` on the dev machine\n\n### Current State\n- `src/app/page.tsx` displays mock projects from `src/lib/data/mock.ts`\n- `src/components/ui/sidebar.tsx` also uses mock data\n- No API routes exist yet\n- No persistence layer exists\n\n### Target State\n- Real project storage in `~/.maestro/config.json`\n- Full CRUD API for projects\n- Filesystem browsing API (constrained to home directory)\n- Folder browser modal for adding projects\n- Project card management (edit name, remove, relocate missing)\n- Proper loading/error states throughout\n\n## Task Structure (10 Tasks)\n\n### Foundation Layer (P0) - Sequential start\n1. **Foundation: Dependencies \u0026 React Query Setup** - Install dependencies, add shadcn components, set up QueryClientProvider\n2. **Config Service** - Create `~/.maestro/config.json` persistence layer with type-safe CRUD operations\n\n### API Layer (P0) - Can parallelize after Config Service\n3. **Projects API** - All 4 endpoints: GET, POST, PATCH, DELETE /api/projects\n4. **Filesystem Browse API** - GET /api/filesystem/browse endpoint for folder picker\n\n### Data Layer (P1) - Bridges backend to frontend\n5. **React Query Hooks** - useProjects, useAddProject, useUpdateProject, useDeleteProject, useFilesystem\n\n### UI Layer (P1) - Core user-facing features\n6. **FolderBrowserModal** - Complete modal with directory list, breadcrumbs, and add project form\n7. **Project List Page** - Replace mock data, add loading/error/empty states, header Add button\n\n### Polish Layer (P2) - Enhanced UX (can parallelize 28 \u0026 31)\n8. **ProjectCard Component** - Extract card with dropdown menu, edit name dialog\n9. **Missing Project Detection \u0026 Relocate** - Warning UI for missing projects, relocate dialog\n10. **Sidebar Integration** - Fetch from API, wire + button to folder browser\n\n## Dependency Graph (Corrected)\n```\n[22. Foundation] \n      |\n      v\n[23. Config Service]\n      |\n      +---------------+\n      |               |\n      v               v\n[24. Projects API] [25. Filesystem API]\n      |               |\n      +-------+-------+\n              |\n              v\n      [26. React Query Hooks]\n              |\n              v\n      [27. FolderBrowserModal]\n              |\n      +-------+-------+\n      |               |\n      v               v\n[28. Project List] [31. Sidebar]\n      |\n      v\n[29. ProjectCard]\n      |\n      v\n[30. Missing/Relocate]\n```\n\n## Parallelization Opportunities\n- **Wave 3**: Tasks 24 and 25 can run in parallel (both depend only on 23)\n- **Wave 6**: Tasks 28 and 31 can run in parallel (both depend on 26 and 27)\n\n## Key Design Decisions\n\n### UUID-based Project IDs\nProjects get UUID v4 identifiers used in routing (`/project/[id]`). This decouples the URL from the filesystem path, allowing projects to be relocated without breaking links.\n\n### Display Name Derivation\nWhen no custom name is set, derive from path: `/Users/erik/dev/my-project` -\u003e `my-project`.\n\n### Security Boundary\nAll filesystem operations constrained to user's home directory. No browsing `/etc`, `/usr`, etc.\n\n### FolderBrowserModal Reuse\nThe modal supports both \"Add Project\" and \"Relocate Project\" modes via props, avoiding code duplication.\n\n### Symlink Resolution\nPaths are resolved via `fs.realpath()` before storing to avoid issues when symlinks change.\n\n## References\n- GitHub Issue: #1\n- SCOPE.md: Project overview and architecture\n- AGENTS.md: Development workflow guidelines","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-30T07:55:02.722791-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"All 10 subtasks completed: Foundation setup, Config Service, Projects API, Filesystem API, React Query Hooks, FolderBrowserModal, Project List Page, Sidebar Integration, ProjectCard Component, and Missing Project Relocate Flow. Full project list functionality with add, edit, remove, and relocate features implemented.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-slm.1","title":"1.1 Create config service for ~/.maestro/config.json","description":"## Purpose\nCreate the persistence layer for Maestro's project configuration. This service handles reading/writing `~/.maestro/config.json` and provides type-safe access to project data.\n\n## Why a Dedicated Service?\n1. **Single source of truth** - All config access goes through one place\n2. **Auto-initialization** - Creates `~/.maestro/` and `config.json` on first use\n3. **Type safety** - TypeScript interfaces for all data structures\n4. **Error handling** - Graceful handling of missing/corrupted files\n5. **Path utilities** - Centralized logic for home directory, path display, etc.\n\n## Config File Location\n```\n~/.maestro/config.json\n```\nUse `os.homedir()` to resolve `~`. This is the home of the user running the Next.js server.\n\n## Config Schema\n```typescript\n// src/lib/types/config.ts\ninterface MaestroConfig {\n  projects: ProjectConfig[];\n}\n\ninterface ProjectConfig {\n  id: string;          // UUID v4\n  path: string;        // Absolute path: /Users/erik/dev/project\n  name: string | null; // Custom display name, null = derive from path\n  addedAt: string;     // ISO 8601 timestamp\n}\n```\n\n## Service API\n```typescript\n// src/lib/services/config.ts\nclass ConfigService {\n  // Core operations\n  async getConfig(): Promise\u003cMaestroConfig\u003e\n  async saveConfig(config: MaestroConfig): Promise\u003cvoid\u003e\n  \n  // Project helpers\n  async getProjects(): Promise\u003cProjectConfig[]\u003e\n  async getProject(id: string): Promise\u003cProjectConfig | null\u003e\n  async addProject(path: string, name?: string): Promise\u003cProjectConfig\u003e\n  async updateProject(id: string, updates: Partial\u003cProjectConfig\u003e): Promise\u003cProjectConfig\u003e\n  async deleteProject(id: string): Promise\u003cvoid\u003e\n  \n  // Path utilities\n  getHomeDir(): string\n  toDisplayPath(absolutePath: string): string  // /Users/erik/dev → ~/dev\n  toAbsolutePath(displayPath: string): string  // ~/dev → /Users/erik/dev\n  deriveDisplayName(path: string): string      // /Users/erik/dev/foo → foo\n  isWithinHome(path: string): boolean          // Security check\n}\n```\n\n## Implementation Notes\n\n### Auto-initialization\n```typescript\nasync getConfig(): Promise\u003cMaestroConfig\u003e {\n  const configPath = path.join(os.homedir(), '.maestro', 'config.json');\n  try {\n    const content = await fs.readFile(configPath, 'utf-8');\n    return JSON.parse(content);\n  } catch (err) {\n    if (err.code === 'ENOENT') {\n      // First run - create default config\n      const defaultConfig = { projects: [] };\n      await this.saveConfig(defaultConfig);\n      return defaultConfig;\n    }\n    throw err;\n  }\n}\n```\n\n### Directory Creation\n```typescript\nasync saveConfig(config: MaestroConfig): Promise\u003cvoid\u003e {\n  const dir = path.join(os.homedir(), '.maestro');\n  await fs.mkdir(dir, { recursive: true }); // No-op if exists\n  await fs.writeFile(\n    path.join(dir, 'config.json'),\n    JSON.stringify(config, null, 2)\n  );\n}\n```\n\n### UUID Generation\nUse `crypto.randomUUID()` (built into Node.js 19+) or install `uuid` package.\n\n## Edge Cases\n- **Corrupted JSON**: Throw clear error, let API layer handle (could offer reset option later)\n- **Permission denied**: Throw, user needs to fix permissions\n- **Concurrent writes**: Last write wins (acceptable for v1, single user)\n- **Symlinks in path**: Resolve with `fs.realpath()` before storing\n\n## Acceptance Criteria\n- [ ] `~/.maestro/` directory created automatically\n- [ ] `config.json` created with empty projects array on first access\n- [ ] All CRUD operations work correctly\n- [ ] Path utility functions work correctly\n- [ ] Security check rejects paths outside home directory\n- [ ] Type definitions exported for use by API routes\n\n## Dependencies\n- Task 7.2 (React Query) should ideally be done first, but this can proceed in parallel as it's server-side only\n\n## Files\n- `src/lib/types/config.ts` (new) - Type definitions\n- `src/lib/services/config.ts` (new) - Service implementation","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:02.793402-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: consolidated into new task structure for better cohesion","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.10","title":"4.1 Update project list page to fetch from API","description":"## Purpose\nUpdate the project list page (`src/app/page.tsx`) to fetch real data from the API instead of using mock data. This is the core integration that makes the project list functional.\n\n## Current State\n```typescript\n// Current - uses mock data\nimport { mockProjects } from \"@/lib/data/mock\";\n// ...\n{mockProjects.map((project) =\u003e (\n```\n\n## Target State\n```typescript\n// Target - fetches from API\nimport { useProjects } from \"@/lib/hooks/useProjects\";\n// ...\nconst { data: projects, isLoading, error } = useProjects();\n// Handle loading, error, empty states\n// Map over real projects\n```\n\n## Changes Required\n\n### 1. Import useProjects hook\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\n```\n\n### 2. Replace mock data with hook\n```typescript\nexport default function ProjectListPage() {\n  const { data: projects, isLoading, error, refetch } = useProjects();\n  \n  // ... render based on state\n}\n```\n\n### 3. Update project card rendering\nThe API returns a slightly different shape than mock data:\n- `displayName` instead of `name` (computed field)\n- `displayPath` instead of `path` for display\n- `status` field for missing detection\n- No `activeSwarms`, `inProgress`, `lastActivity` yet (placeholders)\n\n```typescript\n{projects?.map((project) =\u003e (\n  \u003cLink \n    key={project.id} \n    href={`/project/${project.id}`}\n    className={cn(\n      \"flex items-center gap-3 px-3 py-2.5 hover:bg-secondary/50 transition-colors\",\n      project.status === \"missing\" \u0026\u0026 \"opacity-60\"\n    )}\n  \u003e\n    {/* ... */}\n    \u003cspan className=\"font-medium text-sm\"\u003e{project.displayName}\u003c/span\u003e\n    \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n      {project.displayPath}\n    \u003c/p\u003e\n    {/* ... */}\n  \u003c/Link\u003e\n))}\n```\n\n### 4. Handle loading state\nShow skeleton cards while loading:\n```typescript\nif (isLoading) {\n  return (\n    \u003cdiv className=\"border border-border rounded-md overflow-hidden divide-y divide-border\"\u003e\n      {[1, 2, 3].map((i) =\u003e (\n        \u003cProjectCardSkeleton key={i} /\u003e\n      ))}\n    \u003c/div\u003e\n  );\n}\n```\n\n### 5. Handle error state\nShow error with retry:\n```typescript\nif (error) {\n  return (\n    \u003cdiv className=\"text-center py-8\"\u003e\n      \u003cp className=\"text-destructive mb-2\"\u003eFailed to load projects\u003c/p\u003e\n      \u003cButton variant=\"outline\" onClick={() =\u003e refetch()}\u003e\n        Retry\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### 6. Handle empty state\nWhen no projects exist:\n```typescript\nif (!projects?.length) {\n  return \u003cNoProjectsEmptyState onAddProject={openFolderBrowser} /\u003e;\n}\n```\n\n(Empty state component is separate task 4.2)\n\n## Placeholder Data\nUntil we integrate with OpenCode for activity data, use static placeholders:\n- `activeSwarms`: 0 (or hide indicator)\n- `inProgress`: 0 (or hide indicator)\n- `lastActivity`: Show `addedAt` date formatted, or hide\n\n## Type Updates\nCreate or update types to match API response:\n```typescript\n// Can use types from useProjects hook\ninterface Project {\n  id: string;\n  path: string;\n  displayPath: string;\n  name: string | null;\n  displayName: string;\n  addedAt: string;\n  status: \"active\" | \"missing\";\n}\n```\n\n## Acceptance Criteria\n- [ ] Fetches projects from GET /api/projects\n- [ ] Renders project cards with displayName and displayPath\n- [ ] Handles loading state with skeletons\n- [ ] Handles error state with retry button\n- [ ] Empty check (for task 4.2 empty state)\n- [ ] Clicking project navigates to /project/[id]\n- [ ] Missing projects shown with different styling\n- [ ] Remove import of mockProjects\n\n## Dependencies\n- **Requires**: Task 7.1 (useProjects hook)\n- **Requires**: Task 7.2 (React Query provider)\n- **Requires**: Tasks 1.2 (GET /api/projects endpoint)\n\n## Files\n- `src/app/page.tsx` (modify)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.30898-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Project List Page task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.11","title":"4.2 Add empty state to project list page","description":"## Purpose\nCreate a compelling empty state for when users first open Maestro with no projects configured. This is the first impression for new users and should guide them to add their first project.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────┐\n│                                                 │\n│                   [folder icon]                 │\n│                                                 │\n│              No projects yet                    │\n│                                                 │\n│     Add a project folder to get started         │\n│                                                 │\n│            [ + Add Project ]                    │\n│                                                 │\n└─────────────────────────────────────────────────┘\n```\n\n## Component\n```typescript\n// src/components/empty-states/NoProjects.tsx\nimport { Folder, Plus } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface NoProjectsProps {\n  onAddProject: () =\u003e void;\n}\n\nexport function NoProjects({ onAddProject }: NoProjectsProps) {\n  return (\n    \u003cdiv className=\"flex flex-col items-center justify-center py-16 px-4 text-center\"\u003e\n      {/* Icon */}\n      \u003cdiv className=\"w-16 h-16 rounded-full bg-secondary flex items-center justify-center mb-6\"\u003e\n        \u003cFolder className=\"h-8 w-8 text-muted-foreground\" /\u003e\n      \u003c/div\u003e\n      \n      {/* Heading */}\n      \u003ch2 className=\"text-lg font-semibold mb-2\"\u003eNo projects yet\u003c/h2\u003e\n      \n      {/* Description */}\n      \u003cp className=\"text-sm text-muted-foreground mb-6 max-w-sm\"\u003e\n        Add a project folder to get started. Maestro will help you manage ideas, \n        plan tasks, and run agent swarms.\n      \u003c/p\u003e\n      \n      {/* CTA */}\n      \u003cButton onClick={onAddProject}\u003e\n        \u003cPlus className=\"h-4 w-4 mr-2\" /\u003e\n        Add Project\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Integration with page.tsx\n```typescript\n// In ProjectListPage\nconst [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n\n// ...\n\nif (!projects?.length) {\n  return (\n    \u003c\u003e\n      \u003cNoProjects onAddProject={() =\u003e setFolderBrowserOpen(true)} /\u003e\n      \u003cFolderBrowserModal \n        open={folderBrowserOpen} \n        onOpenChange={setFolderBrowserOpen}\n      /\u003e\n    \u003c/\u003e\n  );\n}\n```\n\n## Design Considerations\n\n### Illustration vs Icon\nFor v1, use a simple folder icon. Could upgrade to a custom illustration later, but icon is faster to implement and still looks good.\n\n### Copy\n- Keep it short and friendly\n- \"No projects yet\" - clear state\n- \"Add a project folder to get started\" - clear action\n- Additional context about what Maestro does - helps new users understand value\n\n### Button\n- Use primary button for strong CTA\n- Include icon for visual clarity\n- Same action as header \"Add Project\" button\n\n## Mobile Behavior\n- Centered layout works well on all screen sizes\n- Adequate padding on mobile\n- Touch-friendly button\n\n## Accessibility\n- Heading hierarchy (h2)\n- Button has clear label\n- Icon is decorative (no aria-label needed)\n\n## Acceptance Criteria\n- [ ] Shows when projects array is empty\n- [ ] Displays folder icon\n- [ ] Shows \"No projects yet\" heading\n- [ ] Shows helpful description text\n- [ ] \"Add Project\" button opens folder browser modal\n- [ ] Centered layout\n- [ ] Mobile-friendly\n\n## Dependencies\n- **Requires**: Task 3.3 (FolderBrowserModal)\n- **Used by**: Task 4.1 (project list page integration)\n\n## Files\n- `src/components/empty-states/NoProjects.tsx` (new)\n- `src/app/page.tsx` (integrate)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.369725-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Project List Page task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.12","title":"4.3 Add loading and error states to project list","description":"## Purpose\nAdd proper loading and error states to the project list page. Good loading/error UX is essential for a polished feel and helps users understand system state.\n\n## Loading State\n\n### Skeleton Cards\nShow placeholder cards that match the shape of real project cards:\n```typescript\nfunction ProjectCardSkeleton() {\n  return (\n    \u003cdiv className=\"flex items-center gap-3 px-3 py-2.5 animate-pulse\"\u003e\n      {/* Icon placeholder */}\n      \u003cdiv className=\"w-8 h-8 rounded-md bg-secondary\" /\u003e\n      \n      {/* Content placeholder */}\n      \u003cdiv className=\"flex-1 space-y-2\"\u003e\n        \u003cdiv className=\"h-4 w-32 bg-secondary rounded\" /\u003e\n        \u003cdiv className=\"h-3 w-48 bg-secondary rounded\" /\u003e\n      \u003c/div\u003e\n      \n      {/* Right side placeholder */}\n      \u003cdiv className=\"h-4 w-4 bg-secondary rounded\" /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Integration\n```typescript\nif (isLoading) {\n  return (\n    \u003cdiv className=\"border border-border rounded-md overflow-hidden divide-y divide-border\"\u003e\n      \u003cProjectCardSkeleton /\u003e\n      \u003cProjectCardSkeleton /\u003e\n      \u003cProjectCardSkeleton /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nShow 3 skeleton cards as a reasonable default. This provides visual structure while loading without being jarring.\n\n## Error State\n\n### Error Display\n```typescript\nfunction ProjectListError({ message, onRetry }: { message: string; onRetry: () =\u003e void }) {\n  return (\n    \u003cdiv className=\"border border-border rounded-md p-8 text-center\"\u003e\n      {/* Error icon */}\n      \u003cdiv className=\"w-12 h-12 rounded-full bg-destructive/10 flex items-center justify-center mx-auto mb-4\"\u003e\n        \u003cAlertCircle className=\"h-6 w-6 text-destructive\" /\u003e\n      \u003c/div\u003e\n      \n      {/* Message */}\n      \u003ch3 className=\"font-medium mb-1\"\u003eFailed to load projects\u003c/h3\u003e\n      \u003cp className=\"text-sm text-muted-foreground mb-4\"\u003e{message}\u003c/p\u003e\n      \n      {/* Retry */}\n      \u003cButton variant=\"outline\" onClick={onRetry}\u003e\n        \u003cRefreshCw className=\"h-4 w-4 mr-2\" /\u003e\n        Try Again\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Integration\n```typescript\nif (error) {\n  return (\n    \u003cProjectListError \n      message={error.message} \n      onRetry={() =\u003e refetch()} \n    /\u003e\n  );\n}\n```\n\n## Error Scenarios\n- **Network error**: \"Failed to fetch\" - server might be down\n- **Server error**: 500 response - show generic message\n- **Config error**: Could indicate corrupted config file\n\nFor all cases, the retry button is the primary action. If errors persist, users should check the server logs.\n\n## Refetching State\nWhen data exists but is being refetched (background refresh), don't show loading state - keep showing current data. React Query handles this automatically with `isLoading` (initial load) vs `isFetching` (refetch).\n\n```typescript\n// Only show skeleton on initial load, not refetch\nif (isLoading) {\n  return \u003cSkeletonState /\u003e;\n}\n\n// Show error only if no cached data\nif (error \u0026\u0026 !projects) {\n  return \u003cErrorState /\u003e;\n}\n```\n\n## Page-Level Integration\n```typescript\nexport default function ProjectListPage() {\n  const { data: projects, isLoading, error, refetch } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n\n  return (\n    \u003cdiv className=\"min-h-screen bg-background\"\u003e\n      {/* Header - always shown */}\n      \u003cheader\u003e...\u003c/header\u003e\n      \n      \u003cmain className=\"max-w-3xl mx-auto p-4\"\u003e\n        \u003cdiv className=\"mb-6\"\u003e\n          \u003ch1\u003eProjects\u003c/h1\u003e\n          \u003cp\u003eSelect a project to view swarms and sessions\u003c/p\u003e\n        \u003c/div\u003e\n        \n        {isLoading ? (\n          \u003cProjectListSkeleton /\u003e\n        ) : error \u0026\u0026 !projects ? (\n          \u003cProjectListError message={error.message} onRetry={refetch} /\u003e\n        ) : !projects?.length ? (\n          \u003cNoProjects onAddProject={() =\u003e setFolderBrowserOpen(true)} /\u003e\n        ) : (\n          \u003cProjectList projects={projects} /\u003e\n        )}\n      \u003c/main\u003e\n      \n      \u003cFolderBrowserModal \n        open={folderBrowserOpen}\n        onOpenChange={setFolderBrowserOpen}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Acceptance Criteria\n- [ ] Loading skeleton shown during initial fetch\n- [ ] Skeleton matches shape of real cards\n- [ ] Error state shown when API fails\n- [ ] Error message displayed\n- [ ] Retry button triggers refetch\n- [ ] Refetch doesn't show loading state (keeps stale data)\n- [ ] Proper state hierarchy: loading → error → empty → data\n\n## Dependencies\n- **Requires**: Task 4.1 (page using useProjects)\n- **Related**: Task 4.2 (empty state)\n\n## Files\n- `src/app/page.tsx` (add loading/error states)\n- Could extract: `src/components/project-list/ProjectCardSkeleton.tsx`\n- Could extract: `src/components/project-list/ProjectListError.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.429006-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Project List Page task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.13","title":"4.4 Add 'Add Project' button to header - opens folder browser modal","description":"## Purpose\nAdd an \"Add Project\" button to the project list page header that opens the folder browser modal. This provides a consistent, always-visible entry point for adding projects.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────────────────┐\n│  ⚡ Maestro                              [Search] [+ Add]   │\n└─────────────────────────────────────────────────────────────┘\n```\n\nThe button should be:\n- Visible in the header at all times\n- Compact but recognizable\n- Consistent with the empty state CTA\n\n## Current Header\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b border-border bg-card\"\u003e\n  \u003cdiv className=\"flex h-12 items-center justify-between px-4\"\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cZap /\u003e\n      \u003cspan\u003eMaestro\u003c/span\u003e\n    \u003c/div\u003e\n    \u003cdiv className=\"flex items-center gap-1\"\u003e\n      \u003cbutton\u003e[Search]\u003c/button\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\u003c/header\u003e\n```\n\n## Updated Header\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b border-border bg-card\"\u003e\n  \u003cdiv className=\"flex h-12 items-center justify-between px-4\"\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cZap /\u003e\n      \u003cspan\u003eMaestro\u003c/span\u003e\n    \u003c/div\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cbutton className=\"search-button\"\u003e[Search]\u003c/button\u003e\n      \u003cButton \n        size=\"sm\" \n        onClick={() =\u003e setFolderBrowserOpen(true)}\n      \u003e\n        \u003cPlus className=\"h-4 w-4 mr-1\" /\u003e\n        \u003cspan className=\"hidden sm:inline\"\u003eAdd\u003c/span\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\u003c/header\u003e\n```\n\n## Button Design\n- **Size**: Small (`size=\"sm\"`) to fit header\n- **Icon**: Plus icon always visible\n- **Text**: \"Add\" visible on larger screens, hidden on mobile (icon only)\n- **Style**: Primary button for emphasis\n\n## Mobile Behavior\nOn mobile:\n- Button shows only icon (plus)\n- Maintains adequate touch target (min 44x44 via padding)\n- Positioned where thumb can reach\n\n```typescript\n\u003cButton \n  size=\"sm\" \n  onClick={() =\u003e setFolderBrowserOpen(true)}\n  className=\"h-8 px-2 sm:px-3\"\n\u003e\n  \u003cPlus className=\"h-4 w-4\" /\u003e\n  \u003cspan className=\"hidden sm:inline ml-1\"\u003eAdd\u003c/span\u003e\n\u003c/Button\u003e\n```\n\n## State Management\nThe folder browser modal state is managed at the page level:\n```typescript\nexport default function ProjectListPage() {\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  \n  return (\n    \u003c\u003e\n      \u003cheader\u003e\n        {/* ... */}\n        \u003cButton onClick={() =\u003e setFolderBrowserOpen(true)}\u003e\n          Add\n        \u003c/Button\u003e\n      \u003c/header\u003e\n      \n      {/* ... main content ... */}\n      \n      \u003cFolderBrowserModal \n        open={folderBrowserOpen}\n        onOpenChange={setFolderBrowserOpen}\n        onSuccess={() =\u003e {\n          // Optionally scroll to new project, show toast, etc.\n        }}\n      /\u003e\n    \u003c/\u003e\n  );\n}\n```\n\n## Success Callback\nAfter successfully adding a project:\n- Modal closes automatically\n- Projects list refetches (React Query invalidation)\n- Optionally show a success toast\n- New project appears at top of list (sorted by addedAt)\n\n## Acceptance Criteria\n- [ ] \"Add\" button visible in header\n- [ ] Button shows icon + text on desktop\n- [ ] Button shows icon only on mobile\n- [ ] Clicking opens folder browser modal\n- [ ] Modal closes on successful add\n- [ ] Project list updates after add\n- [ ] Button accessible via keyboard\n\n## Dependencies\n- **Requires**: Task 3.3 (FolderBrowserModal)\n- **Requires**: Task 7.1 (hooks for refetch after add)\n- **Part of**: Task 4.1 (overall page update)\n\n## Files\n- `src/app/page.tsx` (update header)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.487865-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Project List Page task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.14","title":"5.1 Add project card dropdown menu (edit name, remove)","description":"## Purpose\nAdd a dropdown menu to each project card that provides actions: \"Edit Name\" and \"Remove\". This enables users to manage existing projects without navigating away from the list.\n\n## Visual Design\n```\n┌──────────────────────────────────────────────────────────────┐\n│  📁 my-project                                          [⋮] │\n│     ~/dev/my-project                                        │\n└──────────────────────────────────────────────────────────────┘\n                                                           │\n                                                  ┌────────┴────────┐\n                                                  │  ✏️ Edit Name   │\n                                                  │  🗑️ Remove      │\n                                                  └─────────────────┘\n```\n\n## Component Structure\n```\nproject-card/\n├── ProjectCard.tsx       # Main card component\n├── ProjectCardMenu.tsx   # Dropdown menu\n├── EditNameDialog.tsx    # Edit dialog (Task 5.2)\n└── RelocateDialog.tsx    # Relocate dialog (Task 5.4)\n```\n\n## ProjectCard Component\nExtract the project card from page.tsx into a reusable component:\n```typescript\n// src/components/project-card/ProjectCard.tsx\ninterface ProjectCardProps {\n  project: Project;\n  onEdit: () =\u003e void;\n  onRemove: () =\u003e void;\n  onRelocate?: () =\u003e void;  // Only for missing projects\n}\n\nexport function ProjectCard({ project, onEdit, onRemove, onRelocate }: ProjectCardProps) {\n  const isMissing = project.status === \"missing\";\n  \n  return (\n    \u003cdiv className={cn(\n      \"flex items-center gap-3 px-3 py-2.5 transition-colors\",\n      isMissing ? \"opacity-60\" : \"hover:bg-secondary/50\"\n    )}\u003e\n      {/* Card content as link (except menu) */}\n      \u003cLink \n        href={isMissing ? \"#\" : `/project/${project.id}`}\n        className=\"flex items-center gap-3 flex-1 min-w-0\"\n        onClick={isMissing ? (e) =\u003e e.preventDefault() : undefined}\n      \u003e\n        \u003cdiv className=\"flex items-center justify-center w-8 h-8 rounded-md bg-secondary\"\u003e\n          \u003cFolder className=\"h-4 w-4 text-muted-foreground\" /\u003e\n        \u003c/div\u003e\n        \n        \u003cdiv className=\"flex-1 min-w-0\"\u003e\n          \u003cdiv className=\"flex items-center gap-2\"\u003e\n            \u003cspan className=\"font-medium text-sm\"\u003e{project.displayName}\u003c/span\u003e\n            {isMissing \u0026\u0026 (\n              \u003cspan className=\"text-xs text-warning\"\u003eMissing\u003c/span\u003e\n            )}\n          \u003c/div\u003e\n          \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n            {project.displayPath}\n          \u003c/p\u003e\n        \u003c/div\u003e\n      \u003c/Link\u003e\n      \n      {/* Menu - not part of link */}\n      \u003cProjectCardMenu \n        project={project}\n        onEdit={onEdit}\n        onRemove={onRemove}\n        onRelocate={onRelocate}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## ProjectCardMenu Component\n```typescript\n// src/components/project-card/ProjectCardMenu.tsx\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { MoreVertical, Pencil, Trash2, FolderSearch } from \"lucide-react\";\n\ninterface ProjectCardMenuProps {\n  project: Project;\n  onEdit: () =\u003e void;\n  onRemove: () =\u003e void;\n  onRelocate?: () =\u003e void;\n}\n\nexport function ProjectCardMenu({ project, onEdit, onRemove, onRelocate }: ProjectCardMenuProps) {\n  const isMissing = project.status === \"missing\";\n  \n  return (\n    \u003cDropdownMenu\u003e\n      \u003cDropdownMenuTrigger asChild\u003e\n        \u003cbutton \n          className=\"h-8 w-8 flex items-center justify-center rounded-md hover:bg-secondary transition-colors\"\n          onClick={(e) =\u003e e.preventDefault()}  // Don't trigger card link\n        \u003e\n          \u003cMoreVertical className=\"h-4 w-4 text-muted-foreground\" /\u003e\n        \u003c/button\u003e\n      \u003c/DropdownMenuTrigger\u003e\n      \u003cDropdownMenuContent align=\"end\"\u003e\n        {isMissing \u0026\u0026 onRelocate \u0026\u0026 (\n          \u003cDropdownMenuItem onClick={onRelocate}\u003e\n            \u003cFolderSearch className=\"h-4 w-4 mr-2\" /\u003e\n            Relocate\n          \u003c/DropdownMenuItem\u003e\n        )}\n        \u003cDropdownMenuItem onClick={onEdit}\u003e\n          \u003cPencil className=\"h-4 w-4 mr-2\" /\u003e\n          Edit Name\n        \u003c/DropdownMenuItem\u003e\n        \u003cDropdownMenuItem \n          onClick={onRemove}\n          className=\"text-destructive focus:text-destructive\"\n        \u003e\n          \u003cTrash2 className=\"h-4 w-4 mr-2\" /\u003e\n          Remove\n        \u003c/DropdownMenuItem\u003e\n      \u003c/DropdownMenuContent\u003e\n    \u003c/DropdownMenu\u003e\n  );\n}\n```\n\n## Menu Actions\n| Action | Condition | Behavior |\n|--------|-----------|----------|\n| Relocate | Missing projects only | Opens folder browser to select new location |\n| Edit Name | Always | Opens edit dialog |\n| Remove | Always | Immediately removes (no confirmation) |\n\n## No Confirmation for Remove\nRemove doesn't require confirmation because:\n1. **Non-destructive** - Only removes from Maestro, not from disk\n2. **Easily reversible** - Can re-add the project immediately\n3. **Reduces friction** - One click to clean up\n\n## shadcn Components Needed\nThis task requires the DropdownMenu component from shadcn/ui:\n```bash\nnpx shadcn-ui@latest add dropdown-menu\n```\n\n## Integration with Page\n```typescript\n// In page.tsx\nconst [editingProject, setEditingProject] = useState\u003cProject | null\u003e(null);\nconst [relocatingProject, setRelocatingProject] = useState\u003cProject | null\u003e(null);\nconst deleteProject = useDeleteProject();\n\n// ...\n\n{projects?.map((project) =\u003e (\n  \u003cProjectCard\n    key={project.id}\n    project={project}\n    onEdit={() =\u003e setEditingProject(project)}\n    onRemove={() =\u003e deleteProject.mutate(project.id)}\n    onRelocate={project.status === \"missing\" ? () =\u003e setRelocatingProject(project) : undefined}\n  /\u003e\n))}\n\n{/* Edit dialog */}\n\u003cEditNameDialog \n  project={editingProject}\n  open={!!editingProject}\n  onOpenChange={(open) =\u003e !open \u0026\u0026 setEditingProject(null)}\n/\u003e\n\n{/* Relocate dialog */}\n\u003cRelocateDialog\n  project={relocatingProject}\n  open={!!relocatingProject}\n  onOpenChange={(open) =\u003e !open \u0026\u0026 setRelocatingProject(null)}\n/\u003e\n```\n\n## Acceptance Criteria\n- [ ] Three-dot menu icon on each project card\n- [ ] Menu opens on click without navigating to project\n- [ ] \"Edit Name\" option present for all projects\n- [ ] \"Remove\" option present for all projects\n- [ ] \"Relocate\" option present only for missing projects\n- [ ] Remove immediately deletes (no confirmation)\n- [ ] Menu closes after action\n- [ ] Touch-friendly (adequate tap target)\n\n## Dependencies\n- **Requires**: Task 7.1 (useDeleteProject hook)\n- **Requires**: shadcn DropdownMenu component\n- **Enables**: Tasks 5.2, 5.3, 5.4 (dialogs)\n\n## Files\n- `src/components/project-card/ProjectCard.tsx` (new)\n- `src/components/project-card/ProjectCardMenu.tsx` (new)\n- `src/components/ui/dropdown-menu.tsx` (shadcn - may need to add)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.54657-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into ProjectCard component task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.15","title":"5.2 Implement edit project name functionality","description":"## Purpose\nImplement the edit project name dialog that allows users to change a project's display name. This is a simple modal with a text input and save/cancel buttons.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────┐\n│  Edit Project Name                          [X] │\n├─────────────────────────────────────────────────┤\n│                                                 │\n│  Display Name                                   │\n│  ┌─────────────────────────────────────────┐   │\n│  │ My Custom Name                          │   │\n│  └─────────────────────────────────────────┘   │\n│                                                 │\n│  Leave empty to use folder name                 │\n│                                                 │\n├─────────────────────────────────────────────────┤\n│                    [Cancel]  [Save]             │\n└─────────────────────────────────────────────────┘\n```\n\n## Props\n```typescript\ninterface EditNameDialogProps {\n  project: Project | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n}\n```\n\n## Implementation\n```typescript\n// src/components/project-card/EditNameDialog.tsx\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useUpdateProject } from \"@/lib/hooks/useProjects\";\nimport { useState, useEffect } from \"react\";\n\nexport function EditNameDialog({ project, open, onOpenChange }: EditNameDialogProps) {\n  const [name, setName] = useState(\"\");\n  const [error, setError] = useState\u003cstring | null\u003e(null);\n  const updateProject = useUpdateProject();\n  \n  // Initialize with current name when dialog opens\n  useEffect(() =\u003e {\n    if (project \u0026\u0026 open) {\n      // Use custom name if set, otherwise show derived name as placeholder\n      setName(project.name || \"\");\n      setError(null);\n    }\n  }, [project, open]);\n  \n  const handleSave = async () =\u003e {\n    if (!project) return;\n    \n    setError(null);\n    try {\n      await updateProject.mutateAsync({\n        id: project.id,\n        name: name.trim() || null,  // Empty string → null (use derived)\n      });\n      onOpenChange(false);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Failed to update name\");\n    }\n  };\n  \n  const derivedName = project?.path.split(\"/\").pop() || \"\";\n  \n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent className=\"sm:max-w-md\"\u003e\n        \u003cDialogHeader\u003e\n          \u003cDialogTitle\u003eEdit Project Name\u003c/DialogTitle\u003e\n        \u003c/DialogHeader\u003e\n        \n        \u003cdiv className=\"space-y-4 py-4\"\u003e\n          \u003cdiv className=\"space-y-2\"\u003e\n            \u003cLabel htmlFor=\"name\"\u003eDisplay Name\u003c/Label\u003e\n            \u003cInput\n              id=\"name\"\n              value={name}\n              onChange={(e) =\u003e setName(e.target.value)}\n              placeholder={derivedName}\n            /\u003e\n            \u003cp className=\"text-xs text-muted-foreground\"\u003e\n              Leave empty to use folder name ({derivedName})\n            \u003c/p\u003e\n          \u003c/div\u003e\n          \n          {error \u0026\u0026 (\n            \u003cp className=\"text-sm text-destructive\"\u003e{error}\u003c/p\u003e\n          )}\n        \u003c/div\u003e\n        \n        \u003cDialogFooter\u003e\n          \u003cButton variant=\"outline\" onClick={() =\u003e onOpenChange(false)}\u003e\n            Cancel\n          \u003c/Button\u003e\n          \u003cButton \n            onClick={handleSave}\n            disabled={updateProject.isPending}\n          \u003e\n            {updateProject.isPending ? \"Saving...\" : \"Save\"}\n          \u003c/Button\u003e\n        \u003c/DialogFooter\u003e\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  );\n}\n```\n\n## Behavior Details\n\n### Name Initialization\n- If project has custom name: Show it in input\n- If project uses derived name: Show empty input with derived name as placeholder\n\n### Saving Empty Name\n- Empty string or whitespace-only → sets `name: null` in API\n- This reverts to derived name from path\n- Clear UX: \"Leave empty to use folder name\"\n\n### Validation\n- No client-side validation needed (any string is valid)\n- Server validates and returns error if needed\n- Show error message inline\n\n### Keyboard Support\n- Enter to save\n- Escape to cancel\n- Auto-focus input on open\n\n## shadcn Components Needed\n- Dialog (may already have from FolderBrowserModal)\n- Input\n- Label\n- Button\n\n## Acceptance Criteria\n- [ ] Dialog opens with current name pre-filled\n- [ ] Placeholder shows derived name\n- [ ] Can save custom name\n- [ ] Can clear name to revert to derived\n- [ ] Shows loading state while saving\n- [ ] Shows error messages inline\n- [ ] Closes on successful save\n- [ ] Cancel closes without saving\n- [ ] Enter key submits form\n\n## Dependencies\n- **Requires**: Task 7.1 (useUpdateProject hook)\n- **Requires**: Task 1.4 (PATCH endpoint)\n- **Used by**: Task 5.1 (ProjectCardMenu)\n\n## Files\n- `src/components/project-card/EditNameDialog.tsx` (new)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.603572-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into ProjectCard component task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.16","title":"5.3 Implement missing project detection and warning UI","description":"## Purpose\nDetect and visually indicate when a project's path no longer exists on the filesystem. This helps users understand why a project might not be accessible and guides them to fix it.\n\n## Why Projects Go Missing\n- Project directory was moved or renamed\n- External drive was disconnected\n- Project was deleted from disk\n- Path was changed outside of Maestro\n\n## Visual Treatment\nMissing projects should be clearly distinguished from active ones:\n\n```\nActive project:\n┌──────────────────────────────────────────────────────────────┐\n│  📁 my-project                                          [⋮] │\n│     ~/dev/my-project                              2 min ago │\n└──────────────────────────────────────────────────────────────┘\n\nMissing project:\n┌──────────────────────────────────────────────────────────────┐\n│  📁 old-project                      ⚠️ Missing         [⋮] │\n│     ~/dev/old-project                                       │\n└──────────────────────────────────────────────────────────────┘\n  (dimmed/muted styling)\n```\n\n## Implementation\n\n### API Already Handles Detection\nThe GET /api/projects endpoint already validates each path and returns `status: \"active\" | \"missing\"`. No additional API work needed.\n\n### ProjectCard Updates\n```typescript\n// In ProjectCard.tsx\nconst isMissing = project.status === \"missing\";\n\nreturn (\n  \u003cdiv className={cn(\n    \"flex items-center gap-3 px-3 py-2.5 transition-colors\",\n    isMissing \n      ? \"opacity-60 bg-secondary/20\" \n      : \"hover:bg-secondary/50\"\n  )}\u003e\n    {/* Icon with warning indicator */}\n    \u003cdiv className=\"relative\"\u003e\n      \u003cdiv className={cn(\n        \"flex items-center justify-center w-8 h-8 rounded-md\",\n        isMissing ? \"bg-warning/10\" : \"bg-secondary\"\n      )}\u003e\n        \u003cFolder className={cn(\n          \"h-4 w-4\",\n          isMissing ? \"text-warning\" : \"text-muted-foreground\"\n        )} /\u003e\n      \u003c/div\u003e\n      {isMissing \u0026\u0026 (\n        \u003cAlertTriangle className=\"h-3 w-3 text-warning absolute -top-1 -right-1\" /\u003e\n      )}\n    \u003c/div\u003e\n    \n    \u003cdiv className=\"flex-1 min-w-0\"\u003e\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cspan className={cn(\n          \"font-medium text-sm\",\n          isMissing \u0026\u0026 \"text-muted-foreground\"\n        )}\u003e\n          {project.displayName}\n        \u003c/span\u003e\n        {isMissing \u0026\u0026 (\n          \u003cspan className=\"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-warning/10 text-warning\"\u003e\n            \u003cAlertTriangle className=\"h-3 w-3\" /\u003e\n            Missing\n          \u003c/span\u003e\n        )}\n      \u003c/div\u003e\n      \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n        {project.displayPath}\n      \u003c/p\u003e\n    \u003c/div\u003e\n    \n    {/* ... rest of card ... */}\n  \u003c/div\u003e\n);\n```\n\n### Click Behavior\nMissing projects should NOT navigate to `/project/[id]` - there's nothing to show. Instead:\n- Click on card content: Does nothing or shows inline message\n- Click on menu: Opens menu with Relocate/Remove options\n\n```typescript\n// Prevent navigation for missing projects\n\u003cLink\n  href={isMissing ? \"#\" : `/project/${project.id}`}\n  onClick={isMissing ? (e) =\u003e e.preventDefault() : undefined}\n  className={cn(isMissing \u0026\u0026 \"cursor-default\")}\n\u003e\n```\n\n### Menu Options for Missing Projects\nThe menu should show \"Relocate\" as the primary action for missing projects:\n```typescript\n// In ProjectCardMenu\n{isMissing \u0026\u0026 (\n  \u003cDropdownMenuItem onClick={onRelocate} className=\"font-medium\"\u003e\n    \u003cFolderSearch className=\"h-4 w-4 mr-2\" /\u003e\n    Relocate\n  \u003c/DropdownMenuItem\u003e\n)}\n```\n\n## Alternative Approaches Considered\n\n### Inline Relocate Button\nCould show a \"Relocate\" button directly on the card instead of in the menu. Decided against because:\n- Clutters the UI\n- Inconsistent with active project cards\n- Menu works well for infrequent action\n\n### Auto-hide Missing Projects\nCould hide missing projects by default. Decided against because:\n- User might not realize project is gone\n- No way to know something needs fixing\n- Better to show problem and offer fix\n\n### Toast on Detection\nCould show toast when missing project detected. Decided against because:\n- Could be annoying on every page load\n- Visual indicator is sufficient\n- User can fix when they want to\n\n## Acceptance Criteria\n- [ ] Missing projects have dimmed/muted styling\n- [ ] Warning icon or badge indicates \"Missing\" status\n- [ ] Click doesn't navigate to project page\n- [ ] Menu shows \"Relocate\" option prominently\n- [ ] Menu still shows \"Remove\" option\n- [ ] Clear visual distinction from active projects\n\n## Dependencies\n- **Requires**: Task 1.2 (API returns status field)\n- **Part of**: Task 5.1 (ProjectCard component)\n- **Enables**: Task 5.4 (Relocate functionality)\n\n## Files\n- `src/components/project-card/ProjectCard.tsx` (update)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.662499-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Missing Project Detection task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.17","title":"5.4 Implement relocate project functionality for missing projects","description":"## Purpose\nAllow users to \"relocate\" a missing project by selecting a new path via the folder browser. This preserves the project's ID and any associated data while updating where Maestro looks for it.\n\n## Use Case\n1. User moved `~/dev/my-project` to `~/dev/projects/my-project`\n2. Maestro shows project as \"Missing\"\n3. User clicks Relocate\n4. Folder browser opens, navigated to `~/dev` (parent of old path, or default if parent gone)\n5. User navigates to `~/dev/projects/my-project`\n6. User clicks \"Update Location\"\n7. Project is now tracked at new path, same ID preserved\n\n## Why Preserve ID?\nThe project ID is a UUID used in routing (`/project/[id]`). By keeping the same ID:\n- Bookmarks to the project still work\n- Any future features using project ID (settings, history) stay linked\n- Cleaner than delete + re-add\n\n## Visual Design\nThe relocate dialog is similar to the add project modal, but:\n- Different title: \"Relocate Project\" instead of \"Select Project Folder\"\n- Shows the old path for context\n- Button says \"Update Location\" instead of \"Add Project\"\n- No custom name input (keep existing name)\n\n```\n┌─────────────────────────────────────────────────┐\n│  Relocate Project                           [X] │\n├─────────────────────────────────────────────────┤\n│  Current path (missing):                        │\n│  ~/dev/old-location/my-project                  │\n├─────────────────────────────────────────────────┤\n│  ~ / dev / projects / my-project            [↑] │  ← Breadcrumbs\n├─────────────────────────────────────────────────┤\n│  📁 api-gateway              git                │\n│  📁 frontend                 git                │\n│                                                 │\n├─────────────────────────────────────────────────┤\n│                [Cancel]  [Update Location]      │\n└─────────────────────────────────────────────────┘\n```\n\n## Implementation\n```typescript\n// src/components/project-card/RelocateDialog.tsx\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { FolderBrowser } from \"@/components/folder-browser/FolderBrowser\";\nimport { Breadcrumbs } from \"@/components/folder-browser/Breadcrumbs\";\nimport { useUpdateProject } from \"@/lib/hooks/useProjects\";\nimport { useFilesystem } from \"@/lib/hooks/useFilesystem\";\nimport { AlertTriangle } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport path from \"path\";\n\ninterface RelocateDialogProps {\n  project: Project | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n}\n\nexport function RelocateDialog({ project, open, onOpenChange }: RelocateDialogProps) {\n  const [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e();\n  const [error, setError] = useState\u003cstring | null\u003e(null);\n  \n  const updateProject = useUpdateProject();\n  const { data: filesystem, isLoading } = useFilesystem(currentPath);\n  \n  // Set initial path when dialog opens\n  useEffect(() =\u003e {\n    if (project \u0026\u0026 open) {\n      // Try to start at parent of old path\n      // API will fall back to ~/dev or ~ if parent doesn't exist\n      const parentPath = project.path.split(\"/\").slice(0, -1).join(\"/\");\n      setCurrentPath(parentPath || undefined);\n      setError(null);\n    }\n  }, [project, open]);\n  \n  const handleRelocate = async () =\u003e {\n    if (!project || !filesystem?.currentPath) return;\n    \n    setError(null);\n    try {\n      await updateProject.mutateAsync({\n        id: project.id,\n        path: filesystem.currentPath,\n      });\n      onOpenChange(false);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Failed to relocate project\");\n    }\n  };\n  \n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent className=\"max-w-lg max-h-[80vh] flex flex-col p-0\"\u003e\n        \u003cDialogHeader className=\"px-4 py-3 border-b\"\u003e\n          \u003cDialogTitle\u003eRelocate Project\u003c/DialogTitle\u003e\n        \u003c/DialogHeader\u003e\n        \n        {/* Old path context */}\n        {project \u0026\u0026 (\n          \u003cdiv className=\"px-4 py-3 bg-secondary/30 border-b\"\u003e\n            \u003cdiv className=\"flex items-center gap-2 text-sm text-muted-foreground\"\u003e\n              \u003cAlertTriangle className=\"h-4 w-4 text-warning\" /\u003e\n              \u003cspan\u003eCurrent path (missing):\u003c/span\u003e\n            \u003c/div\u003e\n            \u003cp className=\"text-sm font-mono mt-1\"\u003e{project.displayPath}\u003c/p\u003e\n          \u003c/div\u003e\n        )}\n        \n        {/* Breadcrumbs */}\n        {filesystem \u0026\u0026 (\n          \u003cBreadcrumbs\n            currentPath={filesystem.currentPath}\n            displayPath={filesystem.displayPath}\n            onNavigate={setCurrentPath}\n            parent={filesystem.parent}\n            canGoUp={filesystem.canGoUp}\n          /\u003e\n        )}\n        \n        {/* Directory List */}\n        \u003cdiv className=\"flex-1 overflow-y-auto min-h-[200px]\"\u003e\n          \u003cFolderBrowser\n            currentPath={currentPath}\n            onNavigate={setCurrentPath}\n          /\u003e\n        \u003c/div\u003e\n        \n        {/* Error */}\n        {error \u0026\u0026 (\n          \u003cdiv className=\"px-4 py-2 text-sm text-destructive border-t\"\u003e\n            {error}\n          \u003c/div\u003e\n        )}\n        \n        {/* Actions */}\n        \u003cdiv className=\"flex justify-end gap-2 px-4 py-3 border-t\"\u003e\n          \u003cButton variant=\"outline\" onClick={() =\u003e onOpenChange(false)}\u003e\n            Cancel\n          \u003c/Button\u003e\n          \u003cButton \n            onClick={handleRelocate}\n            disabled={!filesystem?.currentPath || updateProject.isPending}\n          \u003e\n            {updateProject.isPending ? \"Updating...\" : \"Update Location\"}\n          \u003c/Button\u003e\n        \u003c/div\u003e\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  );\n}\n```\n\n## Error Handling\nThe PATCH endpoint handles validation:\n- **404**: New path doesn't exist → show error, stay in dialog\n- **400**: New path is not a directory → show error\n- **403**: New path outside home → show error\n- **409**: New path already tracked by another project → show error\n\nShow all errors inline, keep dialog open for retry.\n\n## Reusability Note\nThis dialog is very similar to FolderBrowserModal. Consider:\n1. Keep separate (clearer code, slightly different UX)\n2. Create shared base component (DRYer, more complex)\n\nFor v1, keeping separate is fine. Can refactor later if needed.\n\n## Acceptance Criteria\n- [ ] Opens from \"Relocate\" menu item on missing projects\n- [ ] Shows old path for context\n- [ ] Starts navigation at parent of old path (if exists)\n- [ ] Can navigate filesystem to find new location\n- [ ] \"Update Location\" calls PATCH API with new path\n- [ ] Shows loading state during update\n- [ ] Shows error messages inline\n- [ ] Closes on successful update\n- [ ] Project list refreshes with new path\n- [ ] Project status changes to \"active\" if path valid\n\n## Dependencies\n- **Requires**: Task 7.1 (useUpdateProject hook)\n- **Requires**: Task 1.4 (PATCH /api/projects/:id endpoint)\n- **Requires**: Task 3.1, 3.2 (FolderBrowser, Breadcrumbs components)\n- **Used by**: Task 5.1, 5.3 (ProjectCard menu)\n\n## Files\n- `src/components/project-card/RelocateDialog.tsx` (new)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.719655-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Missing Project Detection task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.18","title":"6.1 Update sidebar to fetch projects from API","description":"## Purpose\nUpdate the sidebar to fetch projects from the API instead of using mock data. The sidebar shows all projects in the left navigation, allowing users to switch between projects.\n\n## Current State\n```typescript\n// In sidebar.tsx\nimport { mockProjects } from \"@/lib/data/mock\";\n// ...\n{mockProjects.map((project) =\u003e (\n```\n\n## Target State\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\n// ...\nconst { data: projects } = useProjects();\n// ...\n{projects?.map((project) =\u003e (\n```\n\n## Changes Required\n\n### 1. Import and use hook\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\n\nexport function Sidebar() {\n  const { data: projects, isLoading } = useProjects();\n  // ...\n}\n```\n\n### 2. Update project mapping\n```typescript\n{projects?.map((project) =\u003e {\n  const isCurrentProject = project.id === currentProjectId;\n  const isMissing = project.status === \"missing\";\n\n  return (\n    \u003cTreeItem\n      key={project.id}\n      icon={\n        isCurrentProject ? (\n          \u003cFolderOpen className=\"h-4 w-4 text-primary\" /\u003e\n        ) : isMissing ? (\n          \u003cFolder className=\"h-4 w-4 text-warning\" /\u003e\n        ) : (\n          \u003cFolder className=\"h-4 w-4\" /\u003e\n        )\n      }\n      label={project.displayName}\n      defaultOpen={isCurrentProject}\n      statusIndicator={isMissing ? \"warning\" : hasActiveSwarm ? \"active\" : undefined}\n    \u003e\n      {/* ... epics and sessions for current project ... */}\n    \u003c/TreeItem\u003e\n  );\n})}\n```\n\n### 3. Handle loading state\nFor sidebar, a subtle loading state is appropriate:\n```typescript\n{isLoading ? (\n  // Show minimal skeleton or loading indicator\n  \u003cdiv className=\"px-4 py-2 text-xs text-muted-foreground\"\u003e\n    Loading projects...\n  \u003c/div\u003e\n) : projects?.length ? (\n  // Show projects\n) : (\n  // Empty state - maybe just show nothing, or prompt to add\n  \u003cdiv className=\"px-4 py-2 text-xs text-muted-foreground\"\u003e\n    No projects\n  \u003c/div\u003e\n)}\n```\n\n### 4. Show missing projects with warning\nMissing projects should be visible in sidebar with a visual indicator so users know to fix them:\n```typescript\nstatusIndicator={isMissing ? \"warning\" : /* ... */}\n```\n\nThe TreeItem component already supports a \"warning\" status indicator.\n\n## Missing Projects in Sidebar\nDecision: **Show missing projects** with warning indicator.\n\nRationale:\n- User should be aware of the problem\n- Can click and see \"Missing\" state, then fix\n- Hiding would make the problem invisible\n\n## Activity Data\nThe sidebar currently shows:\n- Active swarms count (from mock)\n- In progress count (from mock)\n\nUntil OpenCode integration is complete, these will show 0 or be hidden:\n```typescript\nconst hasActiveSwarm = false; // TODO: Get from OpenCode\n```\n\n## Epics and Sessions\nThe sidebar shows epics and sessions for the current project. These still use mock data for now (separate feature work). This task only updates the project list portion.\n\n## Acceptance Criteria\n- [ ] Fetches projects from API using useProjects hook\n- [ ] Renders project tree items with displayName\n- [ ] Current project is highlighted and expanded\n- [ ] Missing projects show warning indicator\n- [ ] Loading state while fetching\n- [ ] Empty state when no projects\n- [ ] Remove mockProjects import\n\n## Dependencies\n- **Requires**: Task 7.1 (useProjects hook)\n- **Requires**: Task 7.2 (React Query provider)\n- **Requires**: Task 1.2 (GET /api/projects endpoint)\n\n## Files\n- `src/components/ui/sidebar.tsx` (modify)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.779159-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Sidebar Integration task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.19","title":"6.2 Wire sidebar '+' button to open folder browser modal","description":"## Purpose\nWire the \"+\" button in the sidebar's Projects header to open the folder browser modal. This provides a consistent entry point for adding projects from anywhere in the app.\n\n## Current State\n```typescript\n// In sidebar.tsx\n\u003cdiv className=\"flex items-center justify-between px-2 py-1\"\u003e\n  \u003cspan className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\"\u003e\n    Projects\n  \u003c/span\u003e\n  \u003cbutton className=\"h-5 w-5 rounded hover:bg-secondary flex items-center justify-center\"\u003e\n    \u003cPlus className=\"h-3 w-3 text-muted-foreground\" /\u003e\n  \u003c/button\u003e\n\u003c/div\u003e\n```\n\nThe button exists but does nothing.\n\n## Challenge: Modal State Across Components\nThe FolderBrowserModal is rendered at the page level (in page.tsx), but the sidebar is a separate component. We need a way to open the modal from the sidebar.\n\n## Solutions\n\n### Option 1: Context (Recommended)\nCreate a context to manage the folder browser modal state:\n```typescript\n// src/contexts/FolderBrowserContext.tsx\ninterface FolderBrowserContextType {\n  openFolderBrowser: () =\u003e void;\n}\n\nconst FolderBrowserContext = createContext\u003cFolderBrowserContextType | null\u003e(null);\n\nexport function useFolderBrowser() {\n  const context = useContext(FolderBrowserContext);\n  if (!context) throw new Error(\"useFolderBrowser must be used within FolderBrowserProvider\");\n  return context;\n}\n\n// In layout or page\n\u003cFolderBrowserContext.Provider value={{ openFolderBrowser: () =\u003e setModalOpen(true) }}\u003e\n  \u003cSidebar /\u003e\n  {/* ... */}\n  \u003cFolderBrowserModal open={modalOpen} onOpenChange={setModalOpen} /\u003e\n\u003c/FolderBrowserContext.Provider\u003e\n```\n\n### Option 2: Callback Prop\nPass a callback through component hierarchy:\n```typescript\n// In layout\n\u003cSidebar onAddProject={() =\u003e setModalOpen(true)} /\u003e\n```\n\nThis works but requires prop drilling through layout → sidebar.\n\n### Option 3: Portal Modal in Sidebar\nRender the modal from within the sidebar:\n```typescript\n// In sidebar.tsx\nconst [modalOpen, setModalOpen] = useState(false);\n\nreturn (\n  \u003c\u003e\n    {/* sidebar content */}\n    \u003cFolderBrowserModal open={modalOpen} onOpenChange={setModalOpen} /\u003e\n  \u003c/\u003e\n);\n```\n\nThis is simplest but means multiple modal instances if main page also has one.\n\n## Recommended Approach: Option 3 (Simple)\nFor v1, render the modal directly in the sidebar. Multiple modal instances aren't a problem since only one is open at a time, and they share the same React Query cache for instant updates.\n\n```typescript\n// src/components/ui/sidebar.tsx\nimport { FolderBrowserModal } from \"@/components/folder-browser/FolderBrowserModal\";\nimport { useState } from \"react\";\n\nexport function Sidebar() {\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  const { data: projects } = useProjects();\n  \n  return (\n    \u003cdiv className=\"w-64 h-screen flex flex-col border-r border-border bg-card\"\u003e\n      {/* ... header, search ... */}\n      \n      \u003cnav className=\"flex-1 overflow-y-auto px-2 py-2\"\u003e\n        {/* Projects Section */}\n        \u003cdiv className=\"mb-2\"\u003e\n          \u003cdiv className=\"flex items-center justify-between px-2 py-1\"\u003e\n            \u003cspan className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\"\u003e\n              Projects\n            \u003c/span\u003e\n            \u003cbutton \n              onClick={() =\u003e setFolderBrowserOpen(true)}\n              className=\"h-5 w-5 rounded hover:bg-secondary flex items-center justify-center\"\n            \u003e\n              \u003cPlus className=\"h-3 w-3 text-muted-foreground\" /\u003e\n            \u003c/button\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n        \n        {/* ... project tree ... */}\n      \u003c/nav\u003e\n      \n      {/* ... bottom actions ... */}\n      \n      {/* Folder Browser Modal */}\n      \u003cFolderBrowserModal \n        open={folderBrowserOpen} \n        onOpenChange={setFolderBrowserOpen}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Accessibility\nThe \"+\" button should be properly labeled:\n```typescript\n\u003cbutton \n  onClick={() =\u003e setFolderBrowserOpen(true)}\n  className=\"...\"\n  aria-label=\"Add project\"\n\u003e\n  \u003cPlus className=\"h-3 w-3 text-muted-foreground\" /\u003e\n\u003c/button\u003e\n```\n\n## Success Behavior\nAfter adding a project:\n1. Modal closes\n2. useProjects hook refetches (React Query invalidation)\n3. New project appears in sidebar immediately\n4. No need to refresh page\n\n## Acceptance Criteria\n- [ ] \"+\" button in sidebar opens folder browser modal\n- [ ] Can add project from sidebar\n- [ ] Project list updates after add\n- [ ] Modal closes on success\n- [ ] Button has proper aria-label\n- [ ] Works consistently with main page add button\n\n## Dependencies\n- **Requires**: Task 3.3 (FolderBrowserModal)\n- **Requires**: Task 6.1 (Sidebar fetches from API)\n\n## Files\n- `src/components/ui/sidebar.tsx` (update)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.837573-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Sidebar Integration task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.2","title":"1.2 Implement GET /api/projects endpoint","description":"## Purpose\nImplement the `GET /api/projects` endpoint that returns all saved projects with computed fields and validation status.\n\n## Why This Endpoint?\nThis is the primary data source for the project list UI. It must:\n1. Return all projects from config\n2. Compute display-friendly fields (displayPath, displayName)\n3. Validate each project's path still exists\n4. Sort by most recently added\n\n## Response Schema\n```typescript\ninterface ProjectsResponse {\n  projects: Project[];\n}\n\ninterface Project {\n  id: string;\n  path: string;              // Absolute: /Users/erik/dev/project\n  displayPath: string;       // Friendly: ~/dev/project\n  name: string | null;       // Custom name or null\n  displayName: string;       // name ?? derived from path\n  addedAt: string;           // ISO 8601\n  status: \"active\" | \"missing\";\n}\n```\n\n## Implementation\n```typescript\n// src/app/api/projects/route.ts\nimport { NextResponse } from \"next/server\";\nimport { configService } from \"@/lib/services/config\";\nimport fs from \"fs/promises\";\n\nexport async function GET() {\n  try {\n    const projects = await configService.getProjects();\n    \n    const enrichedProjects = await Promise.all(\n      projects.map(async (p) =\u003e {\n        // Check if path exists\n        let status: \"active\" | \"missing\" = \"active\";\n        try {\n          await fs.access(p.path);\n        } catch {\n          status = \"missing\";\n        }\n        \n        return {\n          id: p.id,\n          path: p.path,\n          displayPath: configService.toDisplayPath(p.path),\n          name: p.name,\n          displayName: p.name ?? configService.deriveDisplayName(p.path),\n          addedAt: p.addedAt,\n          status,\n        };\n      })\n    );\n    \n    // Sort by addedAt descending (most recent first)\n    enrichedProjects.sort((a, b) =\u003e \n      new Date(b.addedAt).getTime() - new Date(a.addedAt).getTime()\n    );\n    \n    return NextResponse.json({ projects: enrichedProjects });\n  } catch (error) {\n    console.error(\"Failed to fetch projects:\", error);\n    return NextResponse.json(\n      { error: \"Failed to fetch projects\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\n## Performance Note\nPath validation (`fs.access`) is done for each project on every request. For typical use cases (\u003c 20 projects), this is fine. If it becomes slow, we could:\n- Cache validation results briefly\n- Validate asynchronously and update status in background\n- Only validate on explicit refresh\n\nFor v1, keep it simple - validate on every request.\n\n## Acceptance Criteria\n- [ ] Returns all projects from config\n- [ ] Computes displayPath correctly (~ notation)\n- [ ] Computes displayName correctly (custom or derived)\n- [ ] Detects missing projects (path doesn't exist)\n- [ ] Sorts by addedAt descending\n- [ ] Returns empty array when no projects (not error)\n- [ ] Returns 500 on unexpected errors\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service)\n\n## Files\n- `src/app/api/projects/route.ts` (new)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:02.851831-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into consolidated Projects API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.20","title":"7.1 Create shared React Query hooks for projects API","description":"## Purpose\nCreate shared React Query hooks that encapsulate all API interactions for projects and filesystem browsing. These hooks provide a consistent, type-safe interface for components to fetch and mutate data.\n\n## Why Custom Hooks?\n1. **DRY** - Don't repeat query keys, fetch logic, error handling\n2. **Type safety** - Return types match API response schemas\n3. **Optimistic updates** - Centralized cache invalidation logic\n4. **Testing** - Easy to mock in component tests\n\n## Hook API Design\n\n### useProjects\n```typescript\n// src/lib/hooks/useProjects.ts\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\n\ninterface Project {\n  id: string;\n  path: string;\n  displayPath: string;\n  name: string | null;\n  displayName: string;\n  addedAt: string;\n  status: \"active\" | \"missing\";\n}\n\nexport function useProjects() {\n  return useQuery({\n    queryKey: [\"projects\"],\n    queryFn: async (): Promise\u003cProject[]\u003e =\u003e {\n      const res = await fetch(\"/api/projects\");\n      if (!res.ok) throw new Error(\"Failed to fetch projects\");\n      const data = await res.json();\n      return data.projects;\n    },\n  });\n}\n\nexport function useProject(id: string) {\n  const { data: projects } = useProjects();\n  return projects?.find(p =\u003e p.id === id);\n}\n```\n\n### useAddProject\n```typescript\nexport function useAddProject() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (input: { path: string; name?: string }) =\u003e {\n      const res = await fetch(\"/api/projects\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(input),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to add project\");\n      }\n      return res.json();\n    },\n    onSuccess: () =\u003e {\n      queryClient.invalidateQueries({ queryKey: [\"projects\"] });\n    },\n  });\n}\n```\n\n### useUpdateProject\n```typescript\nexport function useUpdateProject() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ id, ...updates }: { id: string; name?: string | null; path?: string }) =\u003e {\n      const res = await fetch(`/api/projects/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(updates),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to update project\");\n      }\n      return res.json();\n    },\n    onSuccess: () =\u003e {\n      queryClient.invalidateQueries({ queryKey: [\"projects\"] });\n    },\n  });\n}\n```\n\n### useDeleteProject\n```typescript\nexport function useDeleteProject() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (id: string) =\u003e {\n      const res = await fetch(`/api/projects/${id}`, {\n        method: \"DELETE\",\n      });\n      if (!res.ok \u0026\u0026 res.status !== 204) {\n        throw new Error(\"Failed to delete project\");\n      }\n    },\n    onSuccess: () =\u003e {\n      queryClient.invalidateQueries({ queryKey: [\"projects\"] });\n    },\n  });\n}\n```\n\n### useFilesystem\n```typescript\n// src/lib/hooks/useFilesystem.ts\ninterface Directory {\n  name: string;\n  path: string;\n  isGitRepo: boolean;\n}\n\ninterface BrowseResult {\n  currentPath: string;\n  displayPath: string;\n  parent: string | null;\n  canGoUp: boolean;\n  directories: Directory[];\n}\n\nexport function useFilesystem(path?: string) {\n  return useQuery({\n    queryKey: [\"filesystem\", path],\n    queryFn: async (): Promise\u003cBrowseResult\u003e =\u003e {\n      const url = path \n        ? `/api/filesystem/browse?path=${encodeURIComponent(path)}`\n        : \"/api/filesystem/browse\";\n      const res = await fetch(url);\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to browse directory\");\n      }\n      return res.json();\n    },\n    // Keep previous data while navigating to avoid flash\n    placeholderData: (previousData) =\u003e previousData,\n  });\n}\n```\n\n## Error Handling Pattern\nAll hooks throw errors that can be caught by error boundaries or handled by the component:\n```typescript\nconst { data, error, isLoading } = useProjects();\n\nif (error) {\n  return \u003cErrorState message={error.message} onRetry={() =\u003e refetch()} /\u003e;\n}\n```\n\n## Cache Invalidation Strategy\n- After add/update/delete, invalidate the entire projects list\n- For filesystem browsing, each path is cached independently\n- Use `placeholderData` to keep showing old data while new data loads\n\n## Type Exports\nExport all types so components have full type safety:\n```typescript\nexport type { Project, Directory, BrowseResult };\n```\n\n## Acceptance Criteria\n- [ ] useProjects fetches and returns project list\n- [ ] useProject(id) returns single project from cache\n- [ ] useAddProject mutation works with cache invalidation\n- [ ] useUpdateProject mutation works with cache invalidation\n- [ ] useDeleteProject mutation works with cache invalidation\n- [ ] useFilesystem fetches directory contents\n- [ ] All hooks have proper TypeScript types\n- [ ] Error messages propagate from API responses\n\n## Dependencies\n- **Requires**: Task 7.2 (React Query provider)\n- **Requires**: Tasks 1.2, 1.3, 2.1 (API endpoints must exist)\n\n## Files\n- `src/lib/hooks/useProjects.ts` (new)\n- `src/lib/hooks/useFilesystem.ts` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.894727-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: now standalone React Query Hooks task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.21","title":"7.2 Set up React Query provider","description":"## Purpose\nSet up React Query (TanStack Query) as the data fetching and caching layer for all API interactions. This is a foundational task that must be completed before any UI components can consume API data.\n\n## Why React Query?\n1. **Automatic caching** - Projects list is fetched once and cached; subsequent navigations are instant\n2. **Background refetching** - Stale data is refreshed automatically when window regains focus\n3. **Optimistic updates** - Edit/delete operations feel instant while we sync with server\n4. **Loading/error states** - Standardized handling across all API calls\n5. **Request deduplication** - Multiple components requesting same data = one network call\n\n## Implementation Details\n\n### Install dependencies\n```bash\nbun add @tanstack/react-query\n```\n\n### Create providers.tsx\n```typescript\n// src/app/providers.tsx\n\"use client\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\n\nexport function Providers({ children }: { children: React.ReactNode }) {\n  const [queryClient] = useState(() =\u003e new QueryClient({\n    defaultOptions: {\n      queries: {\n        staleTime: 60 * 1000, // 1 minute before refetch\n        retry: 1,\n      },\n    },\n  }));\n  \n  return (\n    \u003cQueryClientProvider client={queryClient}\u003e\n      {children}\n    \u003c/QueryClientProvider\u003e\n  );\n}\n```\n\n### Update layout.tsx\nWrap the app with Providers in the root layout.\n\n## Considerations\n- Use `useState` for QueryClient to avoid recreating on each render (App Router requirement)\n- Set reasonable `staleTime` - projects don't change often, but we want fresh data on focus\n- Single retry is enough - if server is down, failing fast is better than hanging\n\n## Acceptance Criteria\n- [ ] @tanstack/react-query installed\n- [ ] Providers component created with QueryClientProvider\n- [ ] Root layout wraps children with Providers\n- [ ] Can use `useQuery` in any client component\n\n## Dependencies\nNone - this is a foundational task.\n\n## Files\n- `src/app/providers.tsx` (new)\n- `src/app/layout.tsx` (modify)\n- `package.json` (dependency added)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:03.954086-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Foundation task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.22","title":"1. Foundation: Dependencies \u0026 React Query Setup","description":"## Purpose\nSet up the foundational dependencies and infrastructure needed by all other tasks. This is the first task to complete.\n\n## Dependencies to Install\n```bash\nbun add @tanstack/react-query\n```\n\n## shadcn Components to Add\n```bash\nnpx shadcn@latest add dialog dropdown-menu input label scroll-area alert\n```\n\nThese components are used by:\n- **Dialog**: FolderBrowserModal, EditNameDialog, RelocateDialog\n- **DropdownMenu**: ProjectCard menu\n- **Input**: Name input in dialogs, path input in folder browser\n- **Label**: Form labels in dialogs\n- **ScrollArea**: Mobile-friendly scrollable directory list in folder browser\n- **Alert**: Error state displays\n\n## React Query Provider Setup\n\n### Create providers.tsx\n```typescript\n// src/app/providers.tsx\n\"use client\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\n\nexport function Providers({ children }: { children: React.ReactNode }) {\n  const [queryClient] = useState(() =\u003e new QueryClient({\n    defaultOptions: {\n      queries: {\n        staleTime: 5 * 60 * 1000, // 5 minutes - projects change rarely\n        retry: 1,\n        refetchOnWindowFocus: true, // Refetch when user switches back from file operations\n      },\n    },\n  }));\n  \n  return (\n    \u003cQueryClientProvider client={queryClient}\u003e\n      {children}\n    \u003c/QueryClientProvider\u003e\n  );\n}\n```\n\n### Update layout.tsx\nWrap the app with Providers in the root layout:\n```typescript\nimport { Providers } from \"./providers\";\n\nexport default function RootLayout({ children }) {\n  return (\n    \u003chtml\u003e\n      \u003cbody\u003e\n        \u003cProviders\u003e{children}\u003c/Providers\u003e\n      \u003c/body\u003e\n    \u003c/html\u003e\n  );\n}\n```\n\n## Why These Choices\n- **React Query**: Automatic caching, background refetching, optimistic updates, request deduplication\n- **useState for QueryClient**: Required for App Router to avoid recreating on each render\n- **staleTime 5 minutes**: Projects change rarely; no need for frequent refetching\n- **refetchOnWindowFocus**: Ensures fresh data when user returns from filesystem operations\n- **retry 1**: Fail fast if server is down\n\n## Acceptance Criteria\n- [ ] @tanstack/react-query installed\n- [ ] shadcn Dialog component added\n- [ ] shadcn DropdownMenu component added  \n- [ ] shadcn Input component added\n- [ ] shadcn Label component added\n- [ ] shadcn ScrollArea component added\n- [ ] shadcn Alert component added\n- [ ] Providers component created with QueryClientProvider\n- [ ] Root layout wraps children with Providers\n- [ ] Can use `useQuery` in any client component\n\n## Files\n- `package.json` (dependencies)\n- `src/app/providers.tsx` (new)\n- `src/app/layout.tsx` (modify)\n- `src/components/ui/dialog.tsx` (new - shadcn)\n- `src/components/ui/dropdown-menu.tsx` (new - shadcn)\n- `src/components/ui/input.tsx` (new - shadcn)\n- `src/components/ui/label.tsx` (new - shadcn)\n- `src/components/ui/scroll-area.tsx` (new - shadcn)\n- `src/components/ui/alert.tsx` (new - shadcn)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T08:13:15.413668-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Installed @tanstack/react-query, added shadcn components (dialog, dropdown-menu, input, label, scroll-area, alert), created Providers component with QueryClientProvider, updated root layout to wrap children with Providers. Build passes.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.23","title":"2. Config Service for ~/.maestro/config.json","description":"## Purpose\nCreate the persistence layer for Maestro's project configuration. This service handles reading/writing `~/.maestro/config.json` and provides type-safe access to project data.\n\n## Config File Location\n```\n~/.maestro/config.json\n```\nUse `os.homedir()` to resolve `~`. This is the home of the user running the Next.js server.\n\n## Config Schema\n```typescript\n// src/lib/types/config.ts\ninterface MaestroConfig {\n  projects: ProjectConfig[];\n}\n\ninterface ProjectConfig {\n  id: string;          // UUID v4\n  path: string;        // Absolute path: /Users/erik/dev/project\n  name: string | null; // Custom display name, null = derive from path\n  addedAt: string;     // ISO 8601 timestamp\n}\n```\n\n## Service API\n```typescript\n// src/lib/services/config.ts\nclass ConfigService {\n  // Core operations\n  async getConfig(): Promise\u003cMaestroConfig\u003e\n  async saveConfig(config: MaestroConfig): Promise\u003cvoid\u003e\n  \n  // Project helpers\n  async getProjects(): Promise\u003cProjectConfig[]\u003e\n  async getProject(id: string): Promise\u003cProjectConfig | null\u003e\n  async projectExists(id: string): Promise\u003cboolean\u003e  // Quick existence check\n  async addProject(path: string, name?: string): Promise\u003cProjectConfig\u003e\n  async updateProject(id: string, updates: Partial\u003cPick\u003cProjectConfig, \"name\" | \"path\"\u003e\u003e): Promise\u003cProjectConfig\u003e\n  async deleteProject(id: string): Promise\u003cvoid\u003e\n  \n  // Path utilities\n  getHomeDir(): string\n  toDisplayPath(absolutePath: string): string  // /Users/erik/dev -\u003e ~/dev\n  toAbsolutePath(displayPath: string): string  // ~/dev -\u003e /Users/erik/dev\n  deriveDisplayName(path: string): string      // /Users/erik/dev/foo -\u003e foo\n  isWithinHome(path: string): boolean          // Security check\n  getParentPath(path: string): string | null   // Get parent directory, null if at home\n}\n\n// Export singleton instance\nexport const configService = new ConfigService();\n```\n\n## Implementation Notes\n\n### Auto-initialization\n```typescript\nasync getConfig(): Promise\u003cMaestroConfig\u003e {\n  const configPath = path.join(os.homedir(), \".maestro\", \"config.json\");\n  try {\n    const content = await fs.readFile(configPath, \"utf-8\");\n    return JSON.parse(content);\n  } catch (err) {\n    if (err.code === \"ENOENT\") {\n      const defaultConfig = { projects: [] };\n      await this.saveConfig(defaultConfig);\n      return defaultConfig;\n    }\n    throw err;\n  }\n}\n```\n\n### Directory Creation\n```typescript\nasync saveConfig(config: MaestroConfig): Promise\u003cvoid\u003e {\n  const dir = path.join(os.homedir(), \".maestro\");\n  await fs.mkdir(dir, { recursive: true });\n  await fs.writeFile(\n    path.join(dir, \"config.json\"),\n    JSON.stringify(config, null, 2)\n  );\n}\n```\n\n### UUID Generation\nUse `crypto.randomUUID()` (built into Node.js).\n\n### Symlink Resolution\n**IMPORTANT**: Resolve symlinks BEFORE storing paths to avoid issues when symlinks change:\n```typescript\nasync addProject(inputPath: string, name?: string): Promise\u003cProjectConfig\u003e {\n  // Resolve symlinks to get the real path\n  const realPath = await fs.realpath(inputPath);\n  // Then validate and store realPath\n}\n```\n\n### Path Utilities\n```typescript\ntoDisplayPath(absolutePath: string): string {\n  const home = this.getHomeDir();\n  if (absolutePath.startsWith(home)) {\n    return \"~\" + absolutePath.slice(home.length);\n  }\n  return absolutePath;\n}\n\ntoAbsolutePath(displayPath: string): string {\n  if (displayPath.startsWith(\"~/\") || displayPath === \"~\") {\n    return path.join(this.getHomeDir(), displayPath.slice(1));\n  }\n  return displayPath;\n}\n\nisWithinHome(testPath: string): boolean {\n  const resolved = path.resolve(testPath);\n  const home = this.getHomeDir();\n  // Handle both with and without trailing separator\n  return resolved === home || resolved.startsWith(home + path.sep);\n}\n\ngetParentPath(filePath: string): string | null {\n  const parent = path.dirname(filePath);\n  // Stop at home directory\n  if (!this.isWithinHome(parent) || parent === filePath) {\n    return null;\n  }\n  return parent;\n}\n```\n\n## Error Handling\nDefine specific error types for clear API responses:\n```typescript\nexport class ConfigError extends Error {\n  constructor(\n    message: string,\n    public code: \"ENOENT\" | \"EACCES\" | \"PARSE_ERROR\" | \"VALIDATION\"\n  ) {\n    super(message);\n    this.name = \"ConfigError\";\n  }\n}\n```\n\n## Edge Cases\n- **Corrupted JSON**: Throw ConfigError with code \"PARSE_ERROR\", let API layer handle\n- **Permission denied**: Throw ConfigError with code \"EACCES\", user needs to fix permissions\n- **Concurrent writes**: Last write wins (acceptable for v1, single user)\n- **Symlinks in path**: Resolve with `fs.realpath()` before storing\n\n## Acceptance Criteria\n- [ ] `~/.maestro/` directory created automatically on first access\n- [ ] `config.json` created with empty projects array on first access\n- [ ] All CRUD operations work correctly (add, get, update, delete)\n- [ ] `projectExists()` helper for quick validation\n- [ ] Path utility functions work correctly (toDisplayPath, toAbsolutePath, deriveDisplayName)\n- [ ] `getParentPath()` utility for relocate flow navigation\n- [ ] Security check rejects paths outside home directory\n- [ ] Symlinks resolved before storing\n- [ ] Type definitions exported for use by API routes\n- [ ] Singleton instance exported as `configService`\n- [ ] Clear error types for different failure modes\n\n## Files\n- `src/lib/types/config.ts` (new)\n- `src/lib/services/config.ts` (new)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T08:13:36.967567-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Created config types (MaestroConfig, ProjectConfig, ConfigError) and ConfigService class with full CRUD operations, path utilities, and security checks. Singleton instance exported as configService. TypeScript checks pass.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.24","title":"3. Projects API: GET, POST, PATCH, DELETE endpoints","description":"## Purpose\nImplement all four CRUD endpoints for projects. These are the backbone of the project management feature.\n\n## Endpoints Overview\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | /api/projects | List all projects with computed fields |\n| POST | /api/projects | Add a new project |\n| PATCH | /api/projects/[id] | Update name or relocate path |\n| DELETE | /api/projects/[id] | Remove project from tracking |\n\n---\n\n## GET /api/projects\n\nReturns all projects with computed fields and validation status.\n\n### Response Schema\n```typescript\ninterface ProjectsResponse {\n  projects: Project[];\n}\n\ninterface Project {\n  id: string;\n  path: string;              // Absolute: /Users/erik/dev/project\n  displayPath: string;       // Friendly: ~/dev/project\n  name: string | null;       // Custom name or null\n  displayName: string;       // name ?? derived from path\n  addedAt: string;           // ISO 8601\n  status: \"active\" | \"missing\";\n}\n```\n\n### Implementation\n- Fetch all projects from config service\n- For each project, check if path exists (`fs.access`)\n- Compute displayPath, displayName, status\n- Sort by addedAt descending (most recent first)\n- Return empty array when no projects (not error)\n\n---\n\n## POST /api/projects\n\nAdd a new project.\n\n### Request\n```json\n{\n  \"path\": \"/Users/erik/dev/my-project\",\n  \"name\": \"My Project\"\n}\n```\n\n`name` is optional (omit or set to null to derive from path).\n\n### Validation (in order)\n1. `path` required and non-empty string\n2. Path must be within home directory (security) -\u003e 403\n3. Resolve symlinks with `fs.realpath()`\n4. Path must exist -\u003e 404\n5. Path must be a directory -\u003e 400\n6. Path must not already be tracked -\u003e 409\n\n### Response\n- 201 with created project object on success\n- Error responses with `{ error: \"message\" }`\n\n---\n\n## PATCH /api/projects/[id]\n\nUpdate name or relocate path.\n\n### Request\n```json\n{\n  \"name\": \"New Name\",\n  \"path\": \"/new/path\"\n}\n```\n\nAt least one field required. Both optional.\n\n### Validation\n- Project must exist -\u003e 404\n- If path provided: same validation as POST (exists, is directory, in home, not duplicate)\n- If path is same as current: no-op (not an error, just return current state)\n- Empty name or whitespace-only -\u003e treat as null (use derived)\n\n### Response\n- 200 with updated project object\n- Error responses with `{ error: \"message\" }`\n\n---\n\n## DELETE /api/projects/[id]\n\nRemove project from tracking (not from disk).\n\n### Response\n- 204 No Content on success\n- 204 even if project doesn't exist (idempotent)\n\n---\n\n## Shared Response Type\n```typescript\n// Used in GET list item, POST response, PATCH response\ninterface Project {\n  id: string;\n  path: string;\n  displayPath: string;\n  name: string | null;\n  displayName: string;\n  addedAt: string;\n  status: \"active\" | \"missing\";\n}\n```\n\n## Error Response Format\nAll errors return:\n```json\n{\n  \"error\": \"Human-readable error message\"\n}\n```\n\n## Acceptance Criteria\n- [ ] GET /api/projects returns all projects with computed fields\n- [ ] GET returns empty array (not error) when no projects\n- [ ] GET detects missing projects (status: \"missing\")\n- [ ] POST validates all requirements (path exists, is directory, in home, not duplicate)\n- [ ] POST resolves symlinks before storing\n- [ ] POST returns 201 with created project\n- [ ] PATCH can update name only\n- [ ] PATCH can update path only (relocate)\n- [ ] PATCH can update both\n- [ ] PATCH with same path value is a no-op (not error)\n- [ ] PATCH returns 404 for unknown ID\n- [ ] DELETE returns 204 (idempotent)\n- [ ] All error responses have consistent format\n\n## Files\n- `src/app/api/projects/route.ts` (new) - GET, POST\n- `src/app/api/projects/[id]/route.ts` (new) - PATCH, DELETE","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T08:13:58.737043-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Implemented GET, POST /api/projects and PATCH, DELETE /api/projects/[id] endpoints with computed fields (displayPath, displayName, status), path validation, symlink resolution, missing project detection, and consistent error format.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.25","title":"4. Filesystem Browse API endpoint","description":"## Purpose\nImplement the `GET /api/filesystem/browse` endpoint for the folder picker UI. This enables users to navigate the server's filesystem to select project directories.\n\n## Why Custom Browsing?\nMaestro runs on the dev machine but is accessed remotely (via Tailscale). Browser file picker APIs open on the **client** device, not the server. We need a custom API that exposes the server's filesystem in a controlled way.\n\n## Security Constraints\n**Critical**: This endpoint exposes the filesystem. Security measures:\n1. **Home directory only** - Cannot browse outside `~`\n2. **Directories only** - Don't list files\n3. **Hidden directories filtered** - No `.git`, `.config`, `.ssh`, etc.\n4. **Permission errors handled gracefully** - Skip unreadable dirs\n\n## Query Parameters\n| Param | Required | Default | Description |\n|-------|----------|---------|-------------|\n| `path` | No | `~/dev` or `~` | Directory to list |\n\nIf `path` not provided:\n- Try `~/dev` first (common convention)\n- Fall back to `~` if `~/dev` doesn't exist\n\n## Response Schema\n```typescript\ninterface BrowseResponse {\n  currentPath: string;    // Absolute: /Users/erik/dev\n  displayPath: string;    // Friendly: ~/dev\n  parent: string | null;  // Parent path, null if at home\n  canGoUp: boolean;       // false if at home directory\n  directories: Directory[];\n}\n\ninterface Directory {\n  name: string;           // Directory name\n  path: string;           // Absolute path\n  isGitRepo: boolean;     // Has .git subdirectory\n}\n```\n\n## Implementation\n```typescript\n// src/app/api/filesystem/browse/route.ts\nconst HIDDEN_PATTERNS = [\n  /^\\./,                 // Hidden dirs (., .git, .config, etc)\n  /^node_modules$/,\n  /^__pycache__$/,\n  /^\\.cache$/,\n  /^vendor$/,\n  /^\\.?venv$/,\n  /^.next$/,            // Next.js build output\n  /^dist$/,             // Common build output\n  /^build$/,            // Common build output\n  /^target$/,           // Rust/Maven build output\n  /^coverage$/,         // Test coverage\n  /^\\.nyc_output$/,    // NYC coverage\n];\n\nfunction shouldHide(name: string): boolean {\n  return HIDDEN_PATTERNS.some(pattern =\u003e pattern.test(name));\n}\n\n// Add timeout wrapper for filesystem operations\nasync function withTimeout\u003cT\u003e(promise: Promise\u003cT\u003e, ms: number): Promise\u003cT\u003e {\n  const timeout = new Promise\u003cnever\u003e((_, reject) =\u003e\n    setTimeout(() =\u003e reject(new Error('Filesystem timeout')), ms)\n  );\n  return Promise.race([promise, timeout]);\n}\n\nexport async function GET(request: Request) {\n  // 1. Determine path (from query or default)\n  // 2. Security check: must be within home\n  // 3. Validate path exists and is directory (with 5s timeout)\n  // 4. Read directory entries (with 5s timeout)\n  // 5. Filter to visible directories\n  // 6. Check each for .git subdirectory\n  // 7. Sort alphabetically (case-insensitive)\n  // 8. Compute parent/canGoUp using configService.getParentPath()\n  // 9. Return response\n}\n```\n\n## Git Repo Detection\nCheck for `.git` subdirectory to identify git repos. This helps users visually distinguish project directories from regular folders.\n\n## Error Responses\n| Status | Condition |\n|--------|-----------|\n| 400 | Invalid path parameter |\n| 403 | Path outside home directory |\n| 404 | Path does not exist |\n| 500 | Filesystem timeout (network drive issues) |\n\n## Edge Cases\n- **Permission denied on subdirectory**: Skip it, don't fail request\n- **Symlink directory**: Follow it, check resolved path is within home\n- **Race condition (dir deleted while reading)**: Skip missing entries\n- **Network drive timeout**: Fail after 5 seconds with clear error\n\n## Acceptance Criteria\n- [ ] Returns directories at requested path\n- [ ] Defaults to ~/dev (or ~ if no ~/dev)\n- [ ] Hides hidden directories (starting with .)\n- [ ] Hides node_modules, __pycache__, vendor, venv\n- [ ] Hides build output directories (.next, dist, build, target, coverage)\n- [ ] Shows isGitRepo indicator for git repos\n- [ ] Provides parent path for navigation (using configService.getParentPath())\n- [ ] Returns canGoUp: false at home directory\n- [ ] Returns 403 for paths outside home\n- [ ] Returns 404 for non-existent paths\n- [ ] Handles permission errors gracefully (skips unreadable)\n- [ ] Directories sorted alphabetically (case-insensitive)\n- [ ] 5 second timeout for filesystem operations\n\n## Files\n- `src/app/api/filesystem/browse/route.ts` (new)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T08:14:22.590412-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Implemented GET /api/filesystem/browse endpoint with security constraints (home directory only), hidden directory filtering, git repo detection, 5s timeout, and proper error handling.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.26","title":"5. React Query Hooks for Projects and Filesystem","description":"Completed: Created React Query hooks for Projects and Filesystem APIs","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T08:14:44.110157-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Created api.ts types (Project, Directory, BrowseResult), useProjects.ts hooks (useProjects, useProject, useAddProject, useUpdateProject, useDeleteProject), and useFilesystem.ts hook. All with proper TypeScript types, error handling, and cache invalidation.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.27","title":"6. FolderBrowserModal with Directory List and Breadcrumbs","description":"## Purpose\nCreate the complete folder browser modal for adding projects (and later, relocating). This is a cohesive UI component that includes the modal wrapper, directory list, breadcrumb navigation, and add project form.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────┐\n│  Select Project Folder                      [X] │\n├─────────────────────────────────────────────────┤\n│  ~ / dev / my-project                       [↑] │  \u003c- Breadcrumbs\n├─────────────────────────────────────────────────┤\n│  📁 api-gateway              git                │\n│  📁 frontend                 git                │\n│  📁 scripts                                     │\n│                                                 │\n│              (ScrollArea - scrollable)          │\n├─────────────────────────────────────────────────┤\n│  Name: [my-project              ] (optional)    │\n├─────────────────────────────────────────────────┤\n│                    [Cancel]  [Add Project]      │\n└─────────────────────────────────────────────────┘\n```\n\n## Component Structure\n```\nfolder-browser/\n├── FolderBrowserModal.tsx   # Main modal with state management\n├── DirectoryList.tsx        # Scrollable directory list (uses ScrollArea)\n├── Breadcrumbs.tsx          # Path navigation\n└── index.ts                 # Exports\n```\n\n## Props - FolderBrowserModal\n```typescript\ninterface FolderBrowserModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n  \n  // For \"Relocate\" mode (Task 9)\n  mode?: \"add\" | \"relocate\";\n  initialPath?: string;\n  projectToRelocate?: Project;\n  \n  onSuccess?: () =\u003e void;\n}\n```\n\n## State Management\nThe modal manages navigation state and calls the API:\n```typescript\nconst [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e(initialPath);\nconst [customName, setCustomName] = useState(\"\");\nconst [error, setError] = useState\u003cstring | null\u003e(null);\n\nconst { data: filesystem, isLoading, error: fetchError } = useFilesystem(currentPath);\nconst addProject = useAddProject();\nconst updateProject = useUpdateProject();\n```\n\n## DirectoryList Component\n```typescript\ninterface DirectoryListProps {\n  directories: Directory[];\n  onNavigate: (path: string) =\u003e void;\n  isLoading?: boolean;\n}\n```\n\nFeatures:\n- Wrapped in `\u003cScrollArea\u003e` for mobile-friendly scrolling\n- Click directory -\u003e navigate into it\n- Git indicator badge for repos\n- Loading skeleton while fetching\n- Empty state when no subdirectories\n- 44px+ touch targets for mobile\n\n## Breadcrumbs Component\n```typescript\ninterface BreadcrumbsProps {\n  currentPath: string;       // Absolute path for building segment paths\n  displayPath: string;       // ~/dev/project for display\n  onNavigate: (path: string) =\u003e void;\n  parent: string | null;\n  canGoUp: boolean;\n}\n```\n\nFeatures:\n- Clickable path segments (except current)\n- Up button (disabled at home)\n- Horizontal scroll on mobile with overflow-x-auto\n- Home icon for ~ segment\n\n## Mobile-Responsive Dialog\n```typescript\n\u003cDialogContent className=\"max-w-none h-full sm:max-w-lg sm:h-auto sm:max-h-[80vh]\"\u003e\n```\n\nThis makes the modal full-screen on mobile, constrained on desktop.\n\n## Keyboard Accessibility\n- **Enter** on directory item: Navigate into it\n- **Escape**: Close modal (default Dialog behavior)\n- **Arrow keys**: Navigate directory list items\n- **Tab**: Move between interactive elements\n\n## Dual Mode Support\nThe modal supports both adding and relocating:\n\n**Add Mode (default)**:\n- Title: \"Select Project Folder\"\n- Shows name input\n- Button: \"Add Project\" (disabled until directory selected)\n- Calls useAddProject\n\n**Relocate Mode**:\n- Title: \"Relocate Project\"\n- Shows old path context (warning banner)\n- No name input (keep existing)\n- Button: \"Update Location\"\n- Calls useUpdateProject with new path\n\n```typescript\n// In modal\nconst handleSubmit = async () =\u003e {\n  if (!filesystem?.currentPath) return;\n  \n  setError(null);\n  try {\n    if (mode === \"relocate\" \u0026\u0026 projectToRelocate) {\n      await updateProject.mutateAsync({\n        id: projectToRelocate.id,\n        path: filesystem.currentPath,\n      });\n    } else {\n      await addProject.mutateAsync({\n        path: filesystem.currentPath,\n        name: customName.trim() || undefined,\n      });\n    }\n    onOpenChange(false);\n    onSuccess?.();\n  } catch (err) {\n    setError(err instanceof Error ? err.message : \"An error occurred\");\n  }\n};\n```\n\n## Button States\n- **Add/Update button disabled when**: No directory selected, or mutation in progress\n- **Show loading spinner**: When mutation is pending\n\n## Error Handling\n- Browse errors: Show in directory list area with retry button\n- Add/Update errors: Show inline below form (red Alert component)\n- Clear error when navigating or retrying\n\n## Acceptance Criteria\n- [ ] Modal opens/closes correctly\n- [ ] Full-screen on mobile, constrained on desktop\n- [ ] Breadcrumbs show current path with clickable segments\n- [ ] Up button navigates to parent (disabled at home)\n- [ ] Directory list wrapped in ScrollArea\n- [ ] Directory list shows folders with git indicators\n- [ ] Click directory navigates into it\n- [ ] Loading skeleton while fetching directories\n- [ ] Empty state when no subdirectories\n- [ ] Name input with folder name as placeholder (add mode only)\n- [ ] Add button disabled until directory selected\n- [ ] Add mode: calls POST /api/projects\n- [ ] Relocate mode: calls PATCH /api/projects/[id] with path\n- [ ] Shows loading state on submit button\n- [ ] Shows errors inline (Alert component)\n- [ ] Closes on success\n- [ ] Keyboard accessible (Enter, Escape, Tab)\n\n## Files\n- `src/components/folder-browser/FolderBrowserModal.tsx` (new)\n- `src/components/folder-browser/DirectoryList.tsx` (new)\n- `src/components/folder-browser/Breadcrumbs.tsx` (new)\n- `src/components/folder-browser/index.ts` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T08:15:12.42384-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Created FolderBrowserModal, DirectoryList, and Breadcrumbs components with full functionality including add/relocate modes, navigation, loading states, error handling, and mobile-responsive design. TypeScript and build pass.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.28","title":"7. Project List Page: API Integration and States","description":"## Purpose\nUpdate the main project list page to fetch real data from the API, replacing mock data. This includes all UI states: loading, error, empty, and the \"Add Project\" button.\n\n## Current State\n```typescript\n// src/app/page.tsx\nimport { mockProjects } from \"@/lib/data/mock\";\n// Uses mockProjects.map(...)\n```\n\n## Target State\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\nimport { FolderBrowserModal } from \"@/components/folder-browser\";\n\nexport default function ProjectListPage() {\n  const { data: projects, isLoading, error, refetch } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  \n  // Render based on state...\n}\n```\n\n## Page Structure\n```\n┌─────────────────────────────────────────────────────────────┐\n│  ⚡ Maestro                              [Search] [+ Add]   │  \u003c- Header\n├─────────────────────────────────────────────────────────────┤\n│  Projects                                                   │\n│  Select a project to view swarms and sessions               │\n├─────────────────────────────────────────────────────────────┤\n│  ┌─────────────────────────────────────────────────────┐   │\n│  │  📁 my-project                                  [⋮] │   │  \u003c- Project cards\n│  │     ~/dev/my-project                                │   │\n│  ├─────────────────────────────────────────────────────┤   │\n│  │  📁 another-project                             [⋮] │   │\n│  │     ~/dev/another                                   │   │\n│  └─────────────────────────────────────────────────────┘   │\n└─────────────────────────────────────────────────────────────┘\n```\n\n## State Rendering Logic\n```typescript\nif (isLoading) {\n  return \u003cProjectListSkeleton /\u003e;\n}\n\nif (error \u0026\u0026 !projects) {\n  return \u003cProjectListError message={error.message} onRetry={refetch} /\u003e;\n}\n\nif (!projects?.length) {\n  return \u003cNoProjectsEmptyState onAddProject={() =\u003e setFolderBrowserOpen(true)} /\u003e;\n}\n\nreturn \u003cProjectList projects={projects} /\u003e;\n```\n\n## Loading State - Skeleton Cards\n```typescript\nfunction ProjectCardSkeleton() {\n  return (\n    \u003cdiv className=\"flex items-center gap-3 px-3 py-2.5 animate-pulse\"\u003e\n      \u003cdiv className=\"w-8 h-8 rounded-md bg-secondary\" /\u003e\n      \u003cdiv className=\"flex-1 space-y-2\"\u003e\n        \u003cdiv className=\"h-4 w-32 bg-secondary rounded\" /\u003e\n        \u003cdiv className=\"h-3 w-48 bg-secondary rounded\" /\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nShow 3 skeletons as default.\n\n## Error State\n```typescript\nfunction ProjectListError({ message, onRetry }) {\n  return (\n    \u003cdiv className=\"border rounded-md p-8 text-center\"\u003e\n      \u003cAlertCircle className=\"h-6 w-6 text-destructive mx-auto mb-4\" /\u003e\n      \u003ch3 className=\"font-medium mb-1\"\u003eFailed to load projects\u003c/h3\u003e\n      \u003cp className=\"text-sm text-muted-foreground mb-4\"\u003e{message}\u003c/p\u003e\n      \u003cButton variant=\"outline\" onClick={onRetry}\u003e\n        \u003cRefreshCw className=\"h-4 w-4 mr-2\" /\u003e\n        Try Again\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Empty State\n```typescript\nfunction NoProjectsEmptyState({ onAddProject }) {\n  return (\n    \u003cdiv className=\"flex flex-col items-center py-16 text-center\"\u003e\n      \u003cdiv className=\"w-16 h-16 rounded-full bg-secondary flex items-center justify-center mb-6\"\u003e\n        \u003cFolder className=\"h-8 w-8 text-muted-foreground\" /\u003e\n      \u003c/div\u003e\n      \u003ch2 className=\"text-lg font-semibold mb-2\"\u003eNo projects yet\u003c/h2\u003e\n      \u003cp className=\"text-sm text-muted-foreground mb-6 max-w-sm\"\u003e\n        Add a project folder to get started.\n      \u003c/p\u003e\n      \u003cButton onClick={onAddProject}\u003e\n        \u003cPlus className=\"h-4 w-4 mr-2\" /\u003e\n        Add Project\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Header Add Button\nUpdate header to include Add button:\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b bg-card\"\u003e\n  \u003cdiv className=\"flex h-12 items-center justify-between px-4\"\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cZap /\u003e\n      \u003cspan\u003eMaestro\u003c/span\u003e\n    \u003c/div\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cbutton className=\"search-button\"\u003e...\u003c/button\u003e\n      \u003cButton size=\"sm\" onClick={() =\u003e setFolderBrowserOpen(true)}\u003e\n        \u003cPlus className=\"h-4 w-4\" /\u003e\n        \u003cspan className=\"hidden sm:inline ml-1\"\u003eAdd\u003c/span\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\u003c/header\u003e\n```\n\nMobile: Icon only. Desktop: Icon + \"Add\".\n\n## Interim Project Cards\nFor this task, render simple cards inline. The full ProjectCard component with menu will replace this in Task 8.\n\n```typescript\n{projects.map((project) =\u003e {\n  const isMissing = project.status === \"missing\";\n  return (\n    \u003cLink \n      key={project.id}\n      href={isMissing ? undefined : `/project/${project.id}`}\n      className={cn(\n        \"flex items-center gap-3 px-3 py-2.5\",\n        isMissing ? \"opacity-60 cursor-default\" : \"hover:bg-secondary/50\"\n      )}\n    \u003e\n      \u003cFolder className={cn(\"h-4 w-4\", isMissing \u0026\u0026 \"text-warning\")} /\u003e\n      \u003cdiv className=\"flex-1 min-w-0\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cspan className=\"font-medium text-sm\"\u003e{project.displayName}\u003c/span\u003e\n          {isMissing \u0026\u0026 (\n            \u003cspan className=\"text-xs px-1.5 py-0.5 rounded bg-warning/10 text-warning\"\u003e\n              Missing\n            \u003c/span\u003e\n          )}\n        \u003c/div\u003e\n        \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n          {project.displayPath}\n        \u003c/p\u003e\n      \u003c/div\u003e\n      {!isMissing \u0026\u0026 \u003cChevronRight className=\"h-4 w-4 text-muted-foreground\" /\u003e}\n    \u003c/Link\u003e\n  );\n})}\n```\n\nNote: Missing projects show warning badge but no navigation. The menu and edit functionality comes in Task 8.\n\n## Modal Placement\nThe FolderBrowserModal lives inside the page component:\n```typescript\nreturn (\n  \u003cdiv\u003e\n    {/* ... page content ... */}\n    \u003cFolderBrowserModal \n      open={folderBrowserOpen}\n      onOpenChange={setFolderBrowserOpen}\n    /\u003e\n  \u003c/div\u003e\n);\n```\n\n## Acceptance Criteria\n- [ ] Fetches projects from API using useProjects\n- [ ] Loading skeleton shown during initial fetch (3 cards)\n- [ ] Error state with retry button\n- [ ] Empty state with Add Project CTA\n- [ ] Projects rendered with displayName and displayPath\n- [ ] Missing projects show warning badge and dimmed styling\n- [ ] Clicking active project navigates to /project/[id]\n- [ ] Clicking missing project does NOT navigate\n- [ ] Header has Add button (icon-only on mobile, icon+text on desktop)\n- [ ] Add button opens FolderBrowserModal\n- [ ] Project list updates after adding project\n- [ ] Remove mockProjects import\n\n## Files\n- `src/app/page.tsx` (major update)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T08:15:42.972344-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Updated page.tsx to use useProjects hook, added loading skeleton, error state with retry, empty state with Add CTA, missing project handling (yellow badge, not clickable), and integrated FolderBrowserModal. Removed mockProjects import.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.29","title":"8. ProjectCard Component with Menu and Edit Name","description":"## Purpose\nExtract the project card into a reusable component with a dropdown menu for actions: Edit Name and Remove. This enables inline project management.\n\n## Visual Design\n```\n┌──────────────────────────────────────────────────────────────┐\n│  📁 my-project                                          [⋮] │\n│     ~/dev/my-project                                        │\n└──────────────────────────────────────────────────────────────┘\n                                                           │\n                                                  ┌────────┴────────┐\n                                                  │  ✏️ Edit Name   │\n                                                  │  🗑️ Remove      │\n                                                  └─────────────────┘\n```\n\n## Component Structure\n```\nproject-card/\n├── ProjectCard.tsx       # Main card component\n├── ProjectCardMenu.tsx   # Dropdown menu\n├── EditNameDialog.tsx    # Edit name modal\n└── index.ts\n```\n\n## ProjectCard Props\n```typescript\ninterface ProjectCardProps {\n  project: Project;\n  onEdit: () =\u003e void;\n  onRemove: () =\u003e void;\n  onRelocate?: () =\u003e void;  // Only for missing projects (Task 9)\n}\n```\n\n## ProjectCard Implementation\nThe card content is a Link, but the menu button sits outside the Link to prevent navigation when clicking the menu.\n\n```typescript\nexport function ProjectCard({ project, onEdit, onRemove, onRelocate }: ProjectCardProps) {\n  const isMissing = project.status === \"missing\";\n  \n  return (\n    \u003cdiv className={cn(\n      \"flex items-center gap-3 px-3 py-2.5 transition-colors\",\n      isMissing ? \"opacity-60\" : \"hover:bg-secondary/50\"\n    )}\u003e\n      {/* Card content as conditional link */}\n      {isMissing ? (\n        \u003cdiv className=\"flex items-center gap-3 flex-1 min-w-0\"\u003e\n          {/* content */}\n        \u003c/div\u003e\n      ) : (\n        \u003cLink \n          href={`/project/${project.id}`}\n          className=\"flex items-center gap-3 flex-1 min-w-0\"\n        \u003e\n          {/* same content */}\n        \u003c/Link\u003e\n      )}\n      \n      {/* Menu - NOT part of link */}\n      \u003cProjectCardMenu\n        isMissing={isMissing}\n        onEdit={onEdit}\n        onRemove={onRemove}\n        onRelocate={onRelocate}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## ProjectCardMenu\n```typescript\ninterface ProjectCardMenuProps {\n  isMissing: boolean;\n  onEdit: () =\u003e void;\n  onRemove: () =\u003e void;\n  onRelocate?: () =\u003e void;\n}\n\nfunction ProjectCardMenu({ isMissing, onEdit, onRemove, onRelocate }) {\n  return (\n    \u003cDropdownMenu\u003e\n      \u003cDropdownMenuTrigger asChild\u003e\n        \u003cbutton \n          className=\"h-8 w-8 flex items-center justify-center rounded-md hover:bg-secondary\"\n          onClick={(e) =\u003e e.stopPropagation()}\n        \u003e\n          \u003cMoreVertical className=\"h-4 w-4 text-muted-foreground\" /\u003e\n        \u003c/button\u003e\n      \u003c/DropdownMenuTrigger\u003e\n      \u003cDropdownMenuContent align=\"end\"\u003e\n        {isMissing \u0026\u0026 onRelocate \u0026\u0026 (\n          \u003cDropdownMenuItem onClick={onRelocate} className=\"font-medium\"\u003e\n            \u003cFolderSearch className=\"h-4 w-4 mr-2\" /\u003e\n            Relocate\n          \u003c/DropdownMenuItem\u003e\n        )}\n        \u003cDropdownMenuItem onClick={onEdit}\u003e\n          \u003cPencil className=\"h-4 w-4 mr-2\" /\u003e\n          Edit Name\n        \u003c/DropdownMenuItem\u003e\n        \u003cDropdownMenuItem onClick={onRemove} className=\"text-destructive\"\u003e\n          \u003cTrash2 className=\"h-4 w-4 mr-2\" /\u003e\n          Remove\n        \u003c/DropdownMenuItem\u003e\n      \u003c/DropdownMenuContent\u003e\n    \u003c/DropdownMenu\u003e\n  );\n}\n```\n\n## EditNameDialog\n```typescript\ninterface EditNameDialogProps {\n  project: Project | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n}\n\nfunction EditNameDialog({ project, open, onOpenChange }) {\n  const [name, setName] = useState(\"\");\n  const updateProject = useUpdateProject();\n  \n  useEffect(() =\u003e {\n    if (project \u0026\u0026 open) {\n      setName(project.name || \"\");\n    }\n  }, [project, open]);\n  \n  const handleSave = async () =\u003e {\n    if (!project) return;\n    await updateProject.mutateAsync({\n      id: project.id,\n      name: name.trim() || null,  // null reverts to derived name\n    });\n    onOpenChange(false);\n  };\n  \n  const derivedName = project?.path.split(\"/\").pop() || \"\";\n  \n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent className=\"sm:max-w-md\"\u003e\n        \u003cDialogHeader\u003e\n          \u003cDialogTitle\u003eEdit Project Name\u003c/DialogTitle\u003e\n        \u003c/DialogHeader\u003e\n        \u003cdiv className=\"space-y-4 py-4\"\u003e\n          \u003cdiv className=\"space-y-2\"\u003e\n            \u003cLabel htmlFor=\"name\"\u003eDisplay Name\u003c/Label\u003e\n            \u003cInput\n              id=\"name\"\n              value={name}\n              onChange={(e) =\u003e setName(e.target.value)}\n              placeholder={derivedName}\n            /\u003e\n            \u003cp className=\"text-xs text-muted-foreground\"\u003e\n              Leave empty to use folder name ({derivedName})\n            \u003c/p\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n        \u003cDialogFooter\u003e\n          \u003cButton variant=\"outline\" onClick={() =\u003e onOpenChange(false)}\u003e\n            Cancel\n          \u003c/Button\u003e\n          \u003cButton onClick={handleSave} disabled={updateProject.isPending}\u003e\n            {updateProject.isPending ? \"Saving...\" : \"Save\"}\n          \u003c/Button\u003e\n        \u003c/DialogFooter\u003e\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  );\n}\n```\n\n## Remove Action\nRemove calls useDeleteProject directly - no confirmation needed (non-destructive, only removes from tracking):\n```typescript\nconst deleteProject = useDeleteProject();\n// ...\nonRemove={() =\u003e deleteProject.mutate(project.id)}\n```\n\nThe project is removed from the list immediately when the mutation succeeds (React Query invalidates the cache).\n\n## Integration with Page\n```typescript\n// In page.tsx\nconst [editingProject, setEditingProject] = useState\u003cProject | null\u003e(null);\nconst deleteProject = useDeleteProject();\n\n{projects.map((project) =\u003e (\n  \u003cProjectCard\n    key={project.id}\n    project={project}\n    onEdit={() =\u003e setEditingProject(project)}\n    onRemove={() =\u003e deleteProject.mutate(project.id)}\n    // onRelocate handled in Task 9\n  /\u003e\n))}\n\n\u003cEditNameDialog \n  project={editingProject}\n  open={!!editingProject}\n  onOpenChange={(open) =\u003e !open \u0026\u0026 setEditingProject(null)}\n/\u003e\n```\n\n## Acceptance Criteria\n- [ ] ProjectCard renders project info (displayName, displayPath)\n- [ ] Active projects are clickable links\n- [ ] Missing projects are NOT clickable (handled in Task 9 for full styling)\n- [ ] Three-dot menu icon on each card\n- [ ] Menu opens without navigating to project (e.stopPropagation)\n- [ ] Menu shows \"Edit Name\" and \"Remove\" options\n- [ ] \"Edit Name\" opens EditNameDialog\n- [ ] EditNameDialog pre-fills current name (or empty if using derived)\n- [ ] Can save new name\n- [ ] Empty name input reverts to derived name\n- [ ] \"Remove\" immediately deletes (no confirmation)\n- [ ] Project list updates after edit/remove\n- [ ] Menu closes after action\n- [ ] Touch-friendly tap targets (8x8 minimum for menu button)\n\n## Files\n- `src/components/project-card/ProjectCard.tsx` (new)\n- `src/components/project-card/ProjectCardMenu.tsx` (new)\n- `src/components/project-card/EditNameDialog.tsx` (new)\n- `src/components/project-card/index.ts` (new)\n- `src/app/page.tsx` (integrate - replace inline cards with ProjectCard)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T08:16:08.491404-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Created ProjectCard, ProjectCardMenu, and EditNameDialog components. Updated page.tsx to use them. Menu has Edit Name and Remove options, supports Relocate for missing projects. Edit dialog pre-fills and updates via useUpdateProject. Build passes.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.3","title":"1.3 Implement POST /api/projects endpoint","description":"## Purpose\nImplement the `POST /api/projects` endpoint for adding new projects to Maestro.\n\n## Why Validation Matters\nThis endpoint is the gatekeeper for project integrity. It must validate:\n1. Path is provided and non-empty\n2. Path exists on the filesystem\n3. Path is a directory (not a file)\n4. Path is within user's home directory (security)\n5. Path isn't already tracked (no duplicates)\n\n## Request Schema\n```typescript\ninterface AddProjectRequest {\n  path: string;       // Required: absolute path\n  name?: string;      // Optional: custom display name\n}\n```\n\n## Response Schema\nOn success, returns the created project (same shape as GET response item):\n```typescript\ninterface Project {\n  id: string;\n  path: string;\n  displayPath: string;\n  name: string | null;\n  displayName: string;\n  addedAt: string;\n  status: \"active\";\n}\n```\n\n## Error Responses\n| Status | Condition | Response |\n|--------|-----------|----------|\n| 400 | Missing or empty path | `{ error: \"Path is required\" }` |\n| 400 | Path is not a directory | `{ error: \"Path is not a directory\" }` |\n| 403 | Path outside home directory | `{ error: \"Path must be within home directory\" }` |\n| 404 | Path does not exist | `{ error: \"Path does not exist\" }` |\n| 409 | Duplicate path | `{ error: \"Project already exists\" }` |\n\n## Implementation\n```typescript\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const { path: inputPath, name } = body;\n    \n    // Validate path provided\n    if (!inputPath || typeof inputPath !== \"string\" || !inputPath.trim()) {\n      return NextResponse.json(\n        { error: \"Path is required\" },\n        { status: 400 }\n      );\n    }\n    \n    const absolutePath = configService.toAbsolutePath(inputPath.trim());\n    \n    // Security: must be within home\n    if (!configService.isWithinHome(absolutePath)) {\n      return NextResponse.json(\n        { error: \"Path must be within home directory\" },\n        { status: 403 }\n      );\n    }\n    \n    // Check path exists\n    try {\n      await fs.access(absolutePath);\n    } catch {\n      return NextResponse.json(\n        { error: \"Path does not exist\" },\n        { status: 404 }\n      );\n    }\n    \n    // Check it's a directory\n    const stat = await fs.stat(absolutePath);\n    if (!stat.isDirectory()) {\n      return NextResponse.json(\n        { error: \"Path is not a directory\" },\n        { status: 400 }\n      );\n    }\n    \n    // Check for duplicates\n    const existing = await configService.getProjects();\n    if (existing.some(p =\u003e p.path === absolutePath)) {\n      return NextResponse.json(\n        { error: \"Project already exists\" },\n        { status: 409 }\n      );\n    }\n    \n    // Add project\n    const project = await configService.addProject(\n      absolutePath,\n      name?.trim() || undefined\n    );\n    \n    return NextResponse.json({\n      id: project.id,\n      path: project.path,\n      displayPath: configService.toDisplayPath(project.path),\n      name: project.name,\n      displayName: project.name ?? configService.deriveDisplayName(project.path),\n      addedAt: project.addedAt,\n      status: \"active\",\n    }, { status: 201 });\n    \n  } catch (error) {\n    console.error(\"Failed to add project:\", error);\n    return NextResponse.json(\n      { error: \"Failed to add project\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\n## Edge Cases\n- **Path with trailing slash**: Normalize before storing\n- **Path with ~**: Expand to absolute before validation/storage\n- **Symlink path**: Follow symlink, check resolved path is within home\n- **Empty name string**: Treat as null (use derived name)\n- **Whitespace-only name**: Treat as null\n\n## Acceptance Criteria\n- [ ] Validates all required fields\n- [ ] Returns 400 for missing/invalid path\n- [ ] Returns 403 for paths outside home directory\n- [ ] Returns 404 for non-existent paths\n- [ ] Returns 400 for file paths (not directories)\n- [ ] Returns 409 for duplicate paths\n- [ ] Returns 201 with created project on success\n- [ ] Generated UUID is used in response\n- [ ] Timestamp is set correctly\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service)\n- **Can parallel with**: Task 1.2 (GET endpoint)\n\n## Files\n- `src/app/api/projects/route.ts` (add POST handler)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:02.92336-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into consolidated Projects API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.30","title":"9. Missing Project Detection and Relocate Flow","description":"## Purpose\nEnhance the project card to show warning status for missing projects (path no longer exists) and provide a \"Relocate\" action to point Maestro to the project's new location.\n\n## Why Projects Go Missing\n- Directory was moved or renamed\n- External drive disconnected\n- Project deleted from disk\n- Path changed outside Maestro\n\n## Visual Treatment - Missing Projects\n```\nActive project:\n┌──────────────────────────────────────────────────────────────┐\n│  📁 my-project                                          [⋮] │\n│     ~/dev/my-project                                        │\n└──────────────────────────────────────────────────────────────┘\n\nMissing project:\n┌──────────────────────────────────────────────────────────────┐\n│  📁 old-project                    ⚠️ Missing           [⋮] │\n│     ~/dev/old-project                                       │\n└──────────────────────────────────────────────────────────────┘\n  (dimmed styling, warning colors)\n```\n\n## ProjectCard Updates for Missing Status\nExtend the ProjectCard component from Task 8:\n\n```typescript\nconst isMissing = project.status === \"missing\";\n\nreturn (\n  \u003cdiv className={cn(\n    \"flex items-center gap-3 px-3 py-2.5 transition-colors\",\n    isMissing \n      ? \"opacity-60 bg-secondary/20\" \n      : \"hover:bg-secondary/50\"\n  )}\u003e\n    {/* Icon with warning indicator */}\n    \u003cdiv className=\"relative\"\u003e\n      \u003cdiv className={cn(\n        \"flex items-center justify-center w-8 h-8 rounded-md\",\n        isMissing ? \"bg-warning/10\" : \"bg-secondary\"\n      )}\u003e\n        \u003cFolder className={cn(\n          \"h-4 w-4\",\n          isMissing ? \"text-warning\" : \"text-muted-foreground\"\n        )} /\u003e\n      \u003c/div\u003e\n      {isMissing \u0026\u0026 (\n        \u003cAlertTriangle className=\"h-3 w-3 text-warning absolute -top-1 -right-1\" /\u003e\n      )}\n    \u003c/div\u003e\n    \n    \u003cdiv className=\"flex-1 min-w-0\"\u003e\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cspan className={cn(\"font-medium text-sm\", isMissing \u0026\u0026 \"text-muted-foreground\")}\u003e\n          {project.displayName}\n        \u003c/span\u003e\n        {isMissing \u0026\u0026 (\n          \u003cspan className=\"text-xs px-1.5 py-0.5 rounded bg-warning/10 text-warning\"\u003e\n            Missing\n          \u003c/span\u003e\n        )}\n      \u003c/div\u003e\n      \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n        {project.displayPath}\n      \u003c/p\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n);\n```\n\n## Click Behavior for Missing Projects\nMissing projects do NOT navigate to `/project/[id]`. The content is not wrapped in a Link:\n\n```typescript\n// In ProjectCard - already handled via conditional Link in Task 8\n{isMissing ? (\n  \u003cdiv className=\"flex items-center gap-3 flex-1 min-w-0 cursor-default\"\u003e\n    {/* content */}\n  \u003c/div\u003e\n) : (\n  \u003cLink href={`/project/${project.id}`} className=\"...\"\u003e\n    {/* content */}\n  \u003c/Link\u003e\n)}\n```\n\n## Menu Updates for Missing Projects\nThe \"Relocate\" option is shown for missing projects (already stubbed in Task 8):\n\n```typescript\n{isMissing \u0026\u0026 onRelocate \u0026\u0026 (\n  \u003cDropdownMenuItem onClick={onRelocate} className=\"font-medium\"\u003e\n    \u003cFolderSearch className=\"h-4 w-4 mr-2\" /\u003e\n    Relocate\n  \u003c/DropdownMenuItem\u003e\n)}\n```\n\n## Relocate Using FolderBrowserModal\nReuse FolderBrowserModal in \"relocate\" mode:\n\n```typescript\n// In page.tsx\nconst [relocatingProject, setRelocatingProject] = useState\u003cProject | null\u003e(null);\n\n{projects.map((project) =\u003e (\n  \u003cProjectCard\n    project={project}\n    onEdit={() =\u003e setEditingProject(project)}\n    onRemove={() =\u003e deleteProject.mutate(project.id)}\n    onRelocate={project.status === \"missing\" \n      ? () =\u003e setRelocatingProject(project) \n      : undefined}\n  /\u003e\n))}\n\n// FolderBrowserModal for relocation\n\u003cFolderBrowserModal\n  open={!!relocatingProject}\n  onOpenChange={(open) =\u003e !open \u0026\u0026 setRelocatingProject(null)}\n  mode=\"relocate\"\n  projectToRelocate={relocatingProject ?? undefined}\n  initialPath={getRelocateInitialPath(relocatingProject)}\n/\u003e\n```\n\n## getRelocateInitialPath Helper\nUse configService.getParentPath() with fallback chain:\n```typescript\nfunction getRelocateInitialPath(project: Project | null): string | undefined {\n  if (!project) return undefined;\n  \n  // Try parent of old path, then ~/dev, then ~ \n  // This is handled server-side by the browse API default\n  // Just pass the parent path, API will handle fallbacks\n  const parts = project.path.split('/');\n  parts.pop();\n  return parts.join('/') || undefined;\n}\n```\n\nNote: If the parent path doesn't exist, the filesystem browse API will fall back to ~/dev or ~.\n\n## Relocate Mode in FolderBrowserModal\n(Specified in Task 6, but summarized here for context)\n\nWhen `mode=\"relocate\"`:\n- Title: \"Relocate Project\"\n- Shows old path context with warning banner:\n```typescript\n{projectToRelocate \u0026\u0026 (\n  \u003cdiv className=\"px-4 py-3 bg-warning/10 border-b\"\u003e\n    \u003cdiv className=\"flex items-center gap-2 text-sm\"\u003e\n      \u003cAlertTriangle className=\"h-4 w-4 text-warning\" /\u003e\n      \u003cspan\u003eCurrent path (missing):\u003c/span\u003e\n    \u003c/div\u003e\n    \u003cp className=\"text-sm font-mono mt-1\"\u003e{projectToRelocate.displayPath}\u003c/p\u003e\n  \u003c/div\u003e\n)}\n```\n- No name input\n- Button: \"Update Location\"\n- Calls PATCH with new path\n\n## Acceptance Criteria\n- [ ] Missing projects have dimmed/muted styling (opacity-60, bg-secondary/20)\n- [ ] Warning icon overlay on folder icon for missing projects\n- [ ] \"Missing\" badge next to project name\n- [ ] Click on missing project does NOT navigate\n- [ ] Menu shows \"Relocate\" as first option for missing projects\n- [ ] Relocate opens FolderBrowserModal in relocate mode\n- [ ] Modal shows old path context with warning styling\n- [ ] Modal starts navigated to parent of old path (or fallback)\n- [ ] Can navigate and select new location\n- [ ] \"Update Location\" calls PATCH API with new path\n- [ ] Project becomes active after successful relocate\n- [ ] Error messages shown inline in modal\n\n## Files\n- `src/components/project-card/ProjectCard.tsx` (update with full missing styling)\n- `src/app/page.tsx` (integrate relocate state and modal)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T08:16:38.407937-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Wired up relocate flow in page.tsx with getRelocateInitialPath helper, relocatingProject state, onRelocate callback for missing projects, and FolderBrowserModal in relocate mode. Build passes.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.31","title":"10. Sidebar: API Integration and Add Project Button","description":"## Purpose\nUpdate the sidebar to fetch projects from the API instead of mock data, and wire the \"+\" button to open the folder browser modal.\n\n## Current State\n```typescript\n// In sidebar.tsx\nimport { mockProjects } from \"@/lib/data/mock\";\n// Uses mockProjects.map(...)\n```\n\n## Target State\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\nimport { FolderBrowserModal } from \"@/components/folder-browser\";\n\nexport function Sidebar() {\n  const { data: projects, isLoading } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  // ...\n}\n```\n\n## Sidebar Structure\n```\n┌─────────────────────────────────────┐\n│  ⚡ Maestro                         │\n├─────────────────────────────────────┤\n│  [🔍 Search...]                     │\n├─────────────────────────────────────┤\n│  PROJECTS                       [+] │  \u003c- Wire this button\n│  ▶ my-project                       │\n│  ▶ another-project                  │\n│  ▶ old-project          ⚠️         │  \u003c- Missing indicator\n├─────────────────────────────────────┤\n│  ...                                │\n└─────────────────────────────────────┘\n```\n\n## Changes Required\n\n### 1. Import and use hooks\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\nimport { FolderBrowserModal } from \"@/components/folder-browser\";\n\nexport function Sidebar() {\n  const { data: projects, isLoading } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  // ...\n}\n```\n\n### 2. Update project rendering\n```typescript\n{isLoading ? (\n  \u003cdiv className=\"px-4 py-2 text-xs text-muted-foreground\"\u003e\n    Loading...\n  \u003c/div\u003e\n) : projects?.length ? (\n  projects.map((project) =\u003e {\n    const isMissing = project.status === \"missing\";\n    return (\n      \u003cTreeItem\n        key={project.id}\n        icon={\u003cFolder className={cn(\"h-4 w-4\", isMissing \u0026\u0026 \"text-warning\")} /\u003e}\n        label={project.displayName}\n        href={isMissing ? undefined : `/project/${project.id}`}\n        statusIndicator={isMissing ? \"warning\" : undefined}\n      /\u003e\n    );\n  })\n) : (\n  \u003cdiv className=\"px-4 py-2 text-xs text-muted-foreground\"\u003e\n    No projects\n  \u003c/div\u003e\n)}\n```\n\n### 3. Update TreeItem to handle undefined href\nThe TreeItem component needs to gracefully handle `href={undefined}`:\n```typescript\n// In TreeItem component\n{href ? (\n  \u003cLink href={href}\u003e{content}\u003c/Link\u003e\n) : (\n  \u003cdiv className=\"cursor-default\"\u003e{content}\u003c/div\u003e\n)}\n```\n\n### 4. Wire \"+\" button\n```typescript\nconst [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n\n// In the Projects header\n\u003cdiv className=\"flex items-center justify-between px-2 py-1\"\u003e\n  \u003cspan className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\"\u003e\n    Projects\n  \u003c/span\u003e\n  \u003cbutton \n    onClick={() =\u003e setFolderBrowserOpen(true)}\n    className=\"h-5 w-5 rounded hover:bg-secondary flex items-center justify-center\"\n    aria-label=\"Add project\"\n  \u003e\n    \u003cPlus className=\"h-3 w-3 text-muted-foreground\" /\u003e\n  \u003c/button\u003e\n\u003c/div\u003e\n\n// At end of sidebar component, inside the return\n\u003cFolderBrowserModal \n  open={folderBrowserOpen} \n  onOpenChange={setFolderBrowserOpen}\n/\u003e\n```\n\n### 5. Show missing projects with warning\nMissing projects are visible in sidebar with warning indicator so users know to fix them:\n```typescript\nstatusIndicator={isMissing ? \"warning\" : undefined}\n```\n\nThe existing TreeItem component already supports `statusIndicator=\"warning\"`.\n\n## Multiple Modal Instances\nThe sidebar renders its own FolderBrowserModal instance, separate from the page's modal. This is acceptable because:\n- Only one modal is open at a time (user can only click one button)\n- They share the same React Query cache\n- Updates reflect everywhere immediately via cache invalidation\n\nIf we wanted to ensure exactly one modal instance, we could lift state to a context provider. But for v1, separate instances work fine.\n\n## Epics and Sessions\nThe sidebar shows epics/sessions for the current project. These still use mock data (separate feature). This task only updates the **project list** portion of the sidebar.\n\n## Acceptance Criteria\n- [ ] Fetches projects from API using useProjects hook\n- [ ] Shows \"Loading...\" text while fetching\n- [ ] Shows \"No projects\" when empty\n- [ ] Renders projects with displayName\n- [ ] Missing projects show warning indicator\n- [ ] Missing projects are not clickable (no navigation)\n- [ ] TreeItem handles href={undefined} gracefully\n- [ ] \"+\" button opens folder browser modal\n- [ ] Can add project from sidebar\n- [ ] Project list updates after adding\n- [ ] Remove mockProjects import\n- [ ] Button has aria-label=\"Add project\" for accessibility\n\n## Files\n- `src/components/ui/sidebar.tsx` (update)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T08:17:01.971053-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Updated sidebar to use useProjects hook, added loading/empty states, wired + button to FolderBrowserModal, missing projects show warning indicator and are not clickable. Kept mockEpics/mockSoloSessions for epic/session features.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.4","title":"1.4 Implement PATCH /api/projects/[id] endpoint","description":"## Purpose\nImplement the `PATCH /api/projects/[id]` endpoint for updating project name or relocating its path.\n\n## Use Cases\n1. **Rename**: User wants to change the display name\n2. **Revert to derived name**: User sets name to null\n3. **Relocate**: Project was moved on disk, user points Maestro to new location\n\n## Request Schema\n```typescript\ninterface UpdateProjectRequest {\n  name?: string | null;  // New display name, null to use derived\n  path?: string;         // New path (for relocation)\n}\n```\n\nAt least one field must be provided.\n\n## Response Schema\nReturns the updated project (same shape as GET response item).\n\n## Error Responses\n| Status | Condition | Response |\n|--------|-----------|----------|\n| 400 | No fields to update | `{ error: \"No fields to update\" }` |\n| 400 | Invalid path (if provided) | `{ error: \"Path is not a directory\" }` |\n| 403 | Path outside home (if provided) | `{ error: \"Path must be within home directory\" }` |\n| 404 | Project ID not found | `{ error: \"Project not found\" }` |\n| 404 | New path doesn't exist | `{ error: \"Path does not exist\" }` |\n| 409 | New path already tracked | `{ error: \"A project with this path already exists\" }` |\n\n## Implementation\n```typescript\n// src/app/api/projects/[id]/route.ts\nimport { NextResponse } from \"next/server\";\nimport { configService } from \"@/lib/services/config\";\nimport fs from \"fs/promises\";\n\nexport async function PATCH(\n  request: Request,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { id } = params;\n    const body = await request.json();\n    const { name, path: newPath } = body;\n    \n    // Check project exists\n    const project = await configService.getProject(id);\n    if (!project) {\n      return NextResponse.json(\n        { error: \"Project not found\" },\n        { status: 404 }\n      );\n    }\n    \n    // Build updates\n    const updates: Partial\u003cProjectConfig\u003e = {};\n    \n    // Handle name update\n    if (\"name\" in body) {\n      // Explicit null or empty string → null (use derived)\n      updates.name = name?.trim() || null;\n    }\n    \n    // Handle path update (relocation)\n    if (newPath) {\n      const absolutePath = configService.toAbsolutePath(newPath.trim());\n      \n      if (!configService.isWithinHome(absolutePath)) {\n        return NextResponse.json(\n          { error: \"Path must be within home directory\" },\n          { status: 403 }\n        );\n      }\n      \n      try {\n        await fs.access(absolutePath);\n      } catch {\n        return NextResponse.json(\n          { error: \"Path does not exist\" },\n          { status: 404 }\n        );\n      }\n      \n      const stat = await fs.stat(absolutePath);\n      if (!stat.isDirectory()) {\n        return NextResponse.json(\n          { error: \"Path is not a directory\" },\n          { status: 400 }\n        );\n      }\n      \n      // Check not duplicate (unless it's the same project)\n      const existing = await configService.getProjects();\n      const duplicate = existing.find(p =\u003e p.path === absolutePath \u0026\u0026 p.id !== id);\n      if (duplicate) {\n        return NextResponse.json(\n          { error: \"A project with this path already exists\" },\n          { status: 409 }\n        );\n      }\n      \n      updates.path = absolutePath;\n    }\n    \n    if (Object.keys(updates).length === 0) {\n      return NextResponse.json(\n        { error: \"No fields to update\" },\n        { status: 400 }\n      );\n    }\n    \n    const updated = await configService.updateProject(id, updates);\n    \n    return NextResponse.json({\n      id: updated.id,\n      path: updated.path,\n      displayPath: configService.toDisplayPath(updated.path),\n      name: updated.name,\n      displayName: updated.name ?? configService.deriveDisplayName(updated.path),\n      addedAt: updated.addedAt,\n      status: \"active\",\n    });\n    \n  } catch (error) {\n    console.error(\"Failed to update project:\", error);\n    return NextResponse.json(\n      { error: \"Failed to update project\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\n## Relocation Workflow\nWhen a project goes missing:\n1. User sees warning in UI\n2. User clicks \"Relocate\"\n3. Folder browser opens (ideally at parent of old path if it exists, else ~/dev)\n4. User selects new location\n5. PATCH request with new path\n6. Project is now tracked at new location with same ID\n\nThe ID stays constant, preserving any bookmarks or links to `/project/[id]`.\n\n## Acceptance Criteria\n- [ ] Can update name only\n- [ ] Can update path only\n- [ ] Can update both name and path\n- [ ] Setting name to null reverts to derived name\n- [ ] Path validation (exists, is directory, in home, not duplicate)\n- [ ] Returns 404 for unknown project ID\n- [ ] Returns 400 when no updates provided\n- [ ] ID and addedAt are preserved on update\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service)\n- **Requires**: Tasks 1.2 \u0026 1.3 (to have projects to update)\n\n## Files\n- `src/app/api/projects/[id]/route.ts` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:02.980937-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into consolidated Projects API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.5","title":"1.5 Implement DELETE /api/projects/[id] endpoint","description":"## Purpose\nImplement the `DELETE /api/projects/[id]` endpoint for removing projects from Maestro's tracking.\n\n## Important: Non-Destructive\nThis endpoint **only removes the project from Maestro's config**. It does NOT:\n- Delete any files on disk\n- Remove git history\n- Affect the project in any way\n\nThis is why no confirmation is required in the UI - it's trivially reversible by re-adding the project.\n\n## Response\n- **204 No Content**: Project successfully removed\n- **404 Not Found**: Project ID doesn't exist (still return 204 for idempotency? Design choice.)\n\nFor simplicity, return 204 even if project doesn't exist. This makes the operation idempotent - calling delete multiple times has the same effect as calling it once.\n\n## Implementation\n```typescript\n// src/app/api/projects/[id]/route.ts (add to existing file)\n\nexport async function DELETE(\n  request: Request,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { id } = params;\n    \n    await configService.deleteProject(id);\n    \n    return new NextResponse(null, { status: 204 });\n    \n  } catch (error) {\n    console.error(\"Failed to delete project:\", error);\n    return NextResponse.json(\n      { error: \"Failed to delete project\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\nThe `configService.deleteProject(id)` should be idempotent - if project doesn't exist, it simply does nothing.\n\n## Use Cases\n1. **User removes a project they no longer want to track**\n2. **User removes a missing project** (can't relocate, just wants it gone)\n3. **Cleanup after project was deleted from disk** (via terminal, not Maestro)\n\n## Acceptance Criteria\n- [ ] Returns 204 on successful deletion\n- [ ] Returns 204 even if project doesn't exist (idempotent)\n- [ ] Project is removed from config.json\n- [ ] No files are deleted from disk\n- [ ] Returns 500 on unexpected errors (disk full, permissions, etc.)\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service)\n- **Can parallel with**: Task 1.4 (PATCH endpoint)\n\n## Files\n- `src/app/api/projects/[id]/route.ts` (add DELETE handler)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.038099-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into consolidated Projects API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.6","title":"2.1 Implement GET /api/filesystem/browse endpoint","description":"## Purpose\nImplement the `GET /api/filesystem/browse` endpoint for the folder picker UI. This enables users to navigate the server's filesystem to select project directories.\n\n## Why Custom Browsing?\nMaestro runs on the dev machine but is accessed remotely (via Tailscale from phone/tablet). Browser file picker APIs (`\u003cinput type=\"file\"\u003e`) open on the **client** device, not the server. We need a custom API that exposes the server's filesystem in a controlled way.\n\n## Security Constraints\n**Critical**: This endpoint exposes the filesystem. Security measures:\n1. **Home directory only** - Cannot browse outside `~`\n2. **Directories only** - Don't list files (irrelevant for project selection)\n3. **Hidden directories filtered** - No `.git`, `.config`, `.ssh`, etc.\n4. **Permission errors handled gracefully** - Skip unreadable dirs, don't fail\n\n## Query Parameters\n| Param | Required | Default | Description |\n|-------|----------|---------|-------------|\n| `path` | No | `~/dev` or `~` | Directory to list |\n\nIf `path` is not provided:\n- Try `~/dev` first (common convention)\n- Fall back to `~` if `~/dev` doesn't exist\n\n## Response Schema\n```typescript\ninterface BrowseResponse {\n  currentPath: string;    // Absolute: /Users/erik/dev\n  displayPath: string;    // Friendly: ~/dev\n  parent: string | null;  // Parent path, null if at home\n  canGoUp: boolean;       // false if at home directory\n  directories: Directory[];\n}\n\ninterface Directory {\n  name: string;           // Directory name\n  path: string;           // Absolute path\n  isGitRepo: boolean;     // Has .git subdirectory\n}\n```\n\n## Implementation\n```typescript\n// src/app/api/filesystem/browse/route.ts\nimport { NextResponse } from \"next/server\";\nimport { configService } from \"@/lib/services/config\";\nimport fs from \"fs/promises\";\nimport path from \"path\";\n\n// Directories to hide from listing\nconst HIDDEN_PATTERNS = [\n  /^\\./, // Hidden files/dirs (., .git, .config, etc.)\n  /^node_modules$/,\n  /^__pycache__$/,\n  /^\\.cache$/,\n  /^vendor$/,\n  /^\\.venv$/,\n  /^venv$/,\n];\n\nfunction shouldHide(name: string): boolean {\n  return HIDDEN_PATTERNS.some(pattern =\u003e pattern.test(name));\n}\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const homeDir = configService.getHomeDir();\n    \n    // Determine path to browse\n    let browsePath = searchParams.get(\"path\");\n    \n    if (!browsePath) {\n      // Default: ~/dev if exists, else ~\n      const devPath = path.join(homeDir, \"dev\");\n      try {\n        await fs.access(devPath);\n        browsePath = devPath;\n      } catch {\n        browsePath = homeDir;\n      }\n    } else {\n      browsePath = configService.toAbsolutePath(browsePath);\n    }\n    \n    // Security: must be within home\n    if (!configService.isWithinHome(browsePath)) {\n      return NextResponse.json(\n        { error: \"Path must be within home directory\" },\n        { status: 403 }\n      );\n    }\n    \n    // Check path exists\n    try {\n      await fs.access(browsePath);\n    } catch {\n      return NextResponse.json(\n        { error: \"Path does not exist\" },\n        { status: 404 }\n      );\n    }\n    \n    // Check it's a directory\n    const stat = await fs.stat(browsePath);\n    if (!stat.isDirectory()) {\n      return NextResponse.json(\n        { error: \"Path is not a directory\" },\n        { status: 400 }\n      );\n    }\n    \n    // Read directory contents\n    const entries = await fs.readdir(browsePath, { withFileTypes: true });\n    \n    // Filter to visible directories only\n    const directories: Directory[] = [];\n    \n    for (const entry of entries) {\n      if (!entry.isDirectory()) continue;\n      if (shouldHide(entry.name)) continue;\n      \n      const entryPath = path.join(browsePath, entry.name);\n      \n      // Check if it's a git repo\n      let isGitRepo = false;\n      try {\n        await fs.access(path.join(entryPath, \".git\"));\n        isGitRepo = true;\n      } catch {\n        // Not a git repo, that's fine\n      }\n      \n      directories.push({\n        name: entry.name,\n        path: entryPath,\n        isGitRepo,\n      });\n    }\n    \n    // Sort alphabetically\n    directories.sort((a, b) =\u003e a.name.localeCompare(b.name));\n    \n    // Compute parent info\n    const parentPath = path.dirname(browsePath);\n    const isAtHome = browsePath === homeDir;\n    \n    return NextResponse.json({\n      currentPath: browsePath,\n      displayPath: configService.toDisplayPath(browsePath),\n      parent: isAtHome ? null : parentPath,\n      canGoUp: !isAtHome,\n      directories,\n    });\n    \n  } catch (error) {\n    console.error(\"Failed to browse filesystem:\", error);\n    return NextResponse.json(\n      { error: \"Failed to browse directory\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\n## Git Repo Detection\nWe check for `.git` subdirectory to identify git repos. This helps users visually distinguish project directories from regular folders in the picker.\n\nNote: We intentionally skip `.git` in the listing (hidden pattern) but check for its existence to set `isGitRepo`.\n\n## Performance Considerations\n- Most dev directories have \u003c 50 items after filtering - performance is fine\n- Git detection adds one `fs.access` per directory - negligible overhead\n- For directories with many items, consider pagination (future enhancement)\n\n## Edge Cases\n- **Permission denied on subdirectory**: Skip it, don't fail the whole request\n- **Symlink directory**: Follow it, check resolved path is within home\n- **Race condition (dir deleted while reading)**: Skip missing entries gracefully\n- **Very deep nesting**: No limit enforced, but UI should handle long paths\n\n## Acceptance Criteria\n- [ ] Returns directories at requested path\n- [ ] Defaults to ~/dev (or ~ if no ~/dev)\n- [ ] Hides hidden directories (starting with .)\n- [ ] Hides node_modules, __pycache__, etc.\n- [ ] Shows isGitRepo indicator for git repos\n- [ ] Provides parent path for navigation\n- [ ] Returns canGoUp: false at home directory\n- [ ] Returns 403 for paths outside home\n- [ ] Returns 404 for non-existent paths\n- [ ] Handles permission errors gracefully\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service for path utilities)\n- **Independent from**: Project CRUD endpoints\n\n## Files\n- `src/app/api/filesystem/browse/route.ts` (new)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:03.095579-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: now standalone Filesystem API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.7","title":"3.1 Create FolderBrowser component - directory list with navigation","description":"## Purpose\nCreate the core FolderBrowser component that displays a navigable list of directories from the server filesystem. This is the main content area of the folder browser modal.\n\n## Component Structure\n```\nFolderBrowser/\n├── FolderBrowser.tsx      # Main component, manages navigation state\n├── DirectoryList.tsx      # Renders list of directories\n└── (Breadcrumbs.tsx)      # Separate task\n```\n\n## FolderBrowser Props\n```typescript\ninterface FolderBrowserProps {\n  onSelect?: (path: string) =\u003e void;  // Called when user clicks \"Select\" \n  initialPath?: string;               // Starting path (default: ~/dev or ~)\n}\n```\n\n## State Management\n```typescript\nconst [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e(initialPath);\nconst { data, isLoading, error } = useFilesystem(currentPath);\n```\n\nThe component maintains the current path and uses the useFilesystem hook to fetch directory contents. Navigation is handled by updating the currentPath state.\n\n## DirectoryList Component\n```typescript\ninterface DirectoryListProps {\n  directories: Directory[];\n  onNavigate: (path: string) =\u003e void;\n  isLoading?: boolean;\n}\n\nfunction DirectoryList({ directories, onNavigate, isLoading }: DirectoryListProps) {\n  if (isLoading) {\n    return \u003cDirectoryListSkeleton /\u003e;\n  }\n  \n  if (directories.length === 0) {\n    return (\n      \u003cdiv className=\"text-center py-8 text-muted-foreground\"\u003e\n        No subdirectories found\n      \u003c/div\u003e\n    );\n  }\n  \n  return (\n    \u003cdiv className=\"divide-y divide-border\"\u003e\n      {directories.map((dir) =\u003e (\n        \u003cbutton\n          key={dir.path}\n          onClick={() =\u003e onNavigate(dir.path)}\n          className=\"w-full flex items-center gap-3 px-3 py-2.5 hover:bg-secondary/50 transition-colors text-left\"\n        \u003e\n          \u003cFolder className=\"h-4 w-4 text-muted-foreground\" /\u003e\n          \u003cspan className=\"flex-1 truncate\"\u003e{dir.name}\u003c/span\u003e\n          {dir.isGitRepo \u0026\u0026 (\n            \u003cspan className=\"text-xs text-muted-foreground bg-secondary px-1.5 py-0.5 rounded\"\u003e\n              git\n            \u003c/span\u003e\n          )}\n          \u003cChevronRight className=\"h-4 w-4 text-muted-foreground\" /\u003e\n        \u003c/button\u003e\n      ))}\n    \u003c/div\u003e\n  );\n}\n```\n\n## Navigation Flow\n1. User clicks a directory → `onNavigate(dir.path)` → updates `currentPath`\n2. useFilesystem refetches with new path\n3. UI updates to show new directory contents\n4. Breadcrumbs update (separate component, same currentPath state)\n\n## Mobile Considerations\n- **Touch targets**: Minimum 44px height for directory items\n- **Scroll area**: Directory list should scroll independently, not the whole modal\n- **Loading state**: Show skeleton while navigating to prevent layout shift\n\n## Error Handling\n```typescript\nif (error) {\n  return (\n    \u003cdiv className=\"p-4 text-center\"\u003e\n      \u003cp className=\"text-destructive mb-2\"\u003eFailed to load directory\u003c/p\u003e\n      \u003cp className=\"text-sm text-muted-foreground mb-4\"\u003e{error.message}\u003c/p\u003e\n      \u003cButton variant=\"outline\" onClick={() =\u003e refetch()}\u003e\n        Retry\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Git Repo Indicator\nDirectories with `isGitRepo: true` show a small \"git\" badge. This helps users identify project directories vs regular folders.\n\n## Accessibility\n- Directory items are buttons with proper focus states\n- Keyboard navigation works (Tab, Enter)\n- Screen reader announces directory names and git status\n\n## Acceptance Criteria\n- [ ] Displays directories from useFilesystem hook\n- [ ] Clicking a directory navigates into it\n- [ ] Shows git repo indicator for git directories\n- [ ] Shows loading skeleton while fetching\n- [ ] Shows empty state when no subdirectories\n- [ ] Shows error state with retry option\n- [ ] Touch-friendly (44px+ tap targets)\n- [ ] Scrollable directory list\n\n## Dependencies\n- **Requires**: Task 7.1 (useFilesystem hook)\n- **Requires**: Task 2.1 (filesystem API endpoint)\n\n## Files\n- `src/components/folder-browser/FolderBrowser.tsx` (new)\n- `src/components/folder-browser/DirectoryList.tsx` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.14827-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into FolderBrowserModal task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.8","title":"3.2 Create FolderBrowser breadcrumb navigation","description":"## Purpose\nCreate the breadcrumb navigation component for the folder browser. Shows the current path as clickable segments, allowing users to jump to any parent directory.\n\n## Visual Design\n```\n┌─────────────────────────────────────────┐\n│  ~ / dev / projects / my-app        [↑] │\n└─────────────────────────────────────────┘\n```\n\n- Each segment is clickable\n- Current directory (last segment) is not clickable, just highlighted\n- \"Up\" button navigates to parent (same as clicking second-to-last segment)\n- On mobile, breadcrumbs scroll horizontally\n\n## Props\n```typescript\ninterface BreadcrumbsProps {\n  displayPath: string;       // e.g., \"~/dev/projects/my-app\"\n  onNavigate: (path: string) =\u003e void;\n  parent: string | null;     // Absolute path of parent, null if at home\n  canGoUp: boolean;\n}\n```\n\n## Implementation\n```typescript\n// src/components/folder-browser/Breadcrumbs.tsx\nimport { ChevronUp, Home } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nexport function Breadcrumbs({ displayPath, onNavigate, parent, canGoUp }: BreadcrumbsProps) {\n  // Parse displayPath into segments\n  // \"~/dev/projects\" → [\"~\", \"dev\", \"projects\"]\n  const segments = displayPath.split(\"/\").filter(Boolean);\n  \n  // Build absolute paths for each segment\n  // We need to map display paths back to absolute paths for navigation\n  // This requires knowing the home directory or receiving absolute paths\n  // For simplicity, receive absolutePath as well or compute from displayPath\n  \n  return (\n    \u003cdiv className=\"flex items-center gap-1 px-3 py-2 border-b border-border overflow-x-auto\"\u003e\n      {/* Scrollable breadcrumb container */}\n      \u003cdiv className=\"flex items-center gap-1 min-w-0 flex-1\"\u003e\n        {segments.map((segment, index) =\u003e {\n          const isLast = index === segments.length - 1;\n          const isHome = segment === \"~\";\n          \n          // Compute path for this segment\n          // \"~/dev/projects\" at index 1 (\"dev\") → \"~/dev\" → need absolute\n          // This is tricky - see implementation note below\n          \n          return (\n            \u003cdiv key={index} className=\"flex items-center\"\u003e\n              {index \u003e 0 \u0026\u0026 (\n                \u003cspan className=\"text-muted-foreground mx-1\"\u003e/\u003c/span\u003e\n              )}\n              {isLast ? (\n                \u003cspan className=\"font-medium truncate\"\u003e{segment}\u003c/span\u003e\n              ) : (\n                \u003cbutton\n                  onClick={() =\u003e onNavigate(pathForSegment)}\n                  className=\"text-muted-foreground hover:text-foreground transition-colors truncate\"\n                \u003e\n                  {isHome ? \u003cHome className=\"h-3.5 w-3.5\" /\u003e : segment}\n                \u003c/button\u003e\n              )}\n            \u003c/div\u003e\n          );\n        })}\n      \u003c/div\u003e\n      \n      {/* Up button */}\n      \u003cbutton\n        onClick={() =\u003e parent \u0026\u0026 onNavigate(parent)}\n        disabled={!canGoUp}\n        className={cn(\n          \"h-8 w-8 flex items-center justify-center rounded-md transition-colors\",\n          canGoUp \n            ? \"hover:bg-secondary text-muted-foreground hover:text-foreground\" \n            : \"text-muted-foreground/30 cursor-not-allowed\"\n        )}\n        aria-label=\"Go to parent directory\"\n      \u003e\n        \u003cChevronUp className=\"h-4 w-4\" /\u003e\n      \u003c/button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Path Mapping Challenge\nThe displayPath is `~/dev/projects` but we need absolute paths for navigation. Solutions:\n\n1. **Pass absolutePath as prop** (recommended)\n   - FolderBrowser has both from useFilesystem response\n   - Breadcrumbs receives both and uses absolute for onClick\n\n2. **Reconstruct from segments**\n   - Replace `~` with home directory\n   - Join segments with `/`\n   - More brittle, assumes path format\n\nGoing with option 1:\n```typescript\ninterface BreadcrumbsProps {\n  currentPath: string;       // Absolute: /Users/erik/dev/projects\n  displayPath: string;       // Display: ~/dev/projects\n  onNavigate: (path: string) =\u003e void;\n  parent: string | null;\n  canGoUp: boolean;\n}\n```\n\nThen compute segment paths by walking back from currentPath.\n\n## Mobile Behavior\n- Container has `overflow-x-auto` for horizontal scroll\n- No explicit scroll indicators (browser native)\n- Current directory (last segment) should be visible - consider `scrollIntoView` on mount\n- Minimum touch target height maintained\n\n## Accessibility\n- Each segment is a button with proper focus state\n- Up button has aria-label\n- Disabled state properly announced\n\n## Acceptance Criteria\n- [ ] Shows path segments from displayPath\n- [ ] Clicking segment navigates to that directory\n- [ ] Last segment (current dir) is not clickable\n- [ ] Up button navigates to parent\n- [ ] Up button disabled at home directory\n- [ ] Horizontally scrollable on narrow screens\n- [ ] Home icon for ~ segment (optional, can be text)\n\n## Dependencies\n- **Used by**: Task 3.1 (FolderBrowser component)\n- **Requires**: Task 7.1 (useFilesystem hook data)\n\n## Files\n- `src/components/folder-browser/Breadcrumbs.tsx` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.198729-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into FolderBrowserModal task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.9","title":"3.3 Create FolderBrowserModal with add project form","description":"## Purpose\nCreate the modal wrapper that contains the folder browser and the \"Add Project\" form. This is the complete UI for adding a new project to Maestro.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────┐\n│  Select Project Folder                      [X] │  ← Header with close button\n├─────────────────────────────────────────────────┤\n│  ~ / dev / my-project                       [↑] │  ← Breadcrumbs\n├─────────────────────────────────────────────────┤\n│  ┌─────────────────────────────────────────┐   │\n│  │ [Paste path here...                   ] │   │  ← Path input (power user)\n│  └─────────────────────────────────────────┘   │\n├─────────────────────────────────────────────────┤\n│  📁 api-gateway              git                │  ← Directory list\n│  📁 frontend                 git                │\n│  📁 scripts                                     │\n│                                                 │\n│              (scrollable area)                  │\n├─────────────────────────────────────────────────┤\n│  Name: [my-project              ] (optional)    │  ← Custom name input\n├─────────────────────────────────────────────────┤\n│                    [Cancel]  [Add Project]      │  ← Actions\n└─────────────────────────────────────────────────┘\n```\n\n## Props\n```typescript\ninterface FolderBrowserModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n  initialPath?: string;      // For \"Relocate\" flow, start at specific path\n  onSuccess?: () =\u003e void;    // Called after successful add\n}\n```\n\n## State\n```typescript\nconst [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e(initialPath);\nconst [selectedPath, setSelectedPath] = useState\u003cstring | null\u003e(null);\nconst [customName, setCustomName] = useState(\"\");\nconst [pathInput, setPathInput] = useState(\"\");\nconst [error, setError] = useState\u003cstring | null\u003e(null);\n\nconst { data: filesystem } = useFilesystem(currentPath);\nconst addProject = useAddProject();\n```\n\n## Interaction Flow\n\n### Navigating Directories\n1. User clicks directory in list\n2. `setCurrentPath(dir.path)` - navigates into directory\n3. useFilesystem refetches\n4. Breadcrumbs update\n\n### Selecting Current Directory\nThe current directory (shown in breadcrumbs) is implicitly selected. User can:\n1. Navigate to the project folder\n2. Optionally enter a custom name\n3. Click \"Add Project\"\n\n### Path Input (Power User Feature)\n- User can paste an absolute path directly\n- On Enter or blur, navigate to that path\n- Validates path via API (will show error if invalid)\n- Optional feature - can be omitted for v1\n\n### Custom Name\n- Text input pre-populated with current directory name\n- Empty → use derived name (no custom name stored)\n- User can edit to set custom display name\n\n## Implementation\n```typescript\n// src/components/folder-browser/FolderBrowserModal.tsx\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { FolderBrowser } from \"./FolderBrowser\";\nimport { Breadcrumbs } from \"./Breadcrumbs\";\nimport { useAddProject } from \"@/lib/hooks/useProjects\";\nimport { useFilesystem } from \"@/lib/hooks/useFilesystem\";\n\nexport function FolderBrowserModal({ open, onOpenChange, initialPath, onSuccess }: FolderBrowserModalProps) {\n  const [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e(initialPath);\n  const [customName, setCustomName] = useState(\"\");\n  const [error, setError] = useState\u003cstring | null\u003e(null);\n  \n  const { data: filesystem, isLoading, error: browseError } = useFilesystem(currentPath);\n  const addProject = useAddProject();\n  \n  // Update custom name placeholder when path changes\n  useEffect(() =\u003e {\n    if (filesystem?.currentPath) {\n      const dirName = filesystem.currentPath.split(\"/\").pop() || \"\";\n      setCustomName(dirName);\n    }\n  }, [filesystem?.currentPath]);\n  \n  const handleAddProject = async () =\u003e {\n    if (!filesystem?.currentPath) return;\n    \n    setError(null);\n    try {\n      await addProject.mutateAsync({\n        path: filesystem.currentPath,\n        name: customName.trim() || undefined,\n      });\n      onOpenChange(false);\n      onSuccess?.();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Failed to add project\");\n    }\n  };\n  \n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent className=\"max-w-lg max-h-[80vh] flex flex-col p-0\"\u003e\n        \u003cDialogHeader className=\"px-4 py-3 border-b\"\u003e\n          \u003cDialogTitle\u003eSelect Project Folder\u003c/DialogTitle\u003e\n        \u003c/DialogHeader\u003e\n        \n        {/* Breadcrumbs */}\n        {filesystem \u0026\u0026 (\n          \u003cBreadcrumbs\n            currentPath={filesystem.currentPath}\n            displayPath={filesystem.displayPath}\n            onNavigate={setCurrentPath}\n            parent={filesystem.parent}\n            canGoUp={filesystem.canGoUp}\n          /\u003e\n        )}\n        \n        {/* Directory List */}\n        \u003cdiv className=\"flex-1 overflow-y-auto min-h-[200px]\"\u003e\n          \u003cFolderBrowser\n            currentPath={currentPath}\n            onNavigate={setCurrentPath}\n          /\u003e\n        \u003c/div\u003e\n        \n        {/* Custom Name Input */}\n        \u003cdiv className=\"px-4 py-3 border-t\"\u003e\n          \u003clabel className=\"text-sm text-muted-foreground mb-1.5 block\"\u003e\n            Display name (optional)\n          \u003c/label\u003e\n          \u003cInput\n            value={customName}\n            onChange={(e) =\u003e setCustomName(e.target.value)}\n            placeholder=\"Use folder name\"\n          /\u003e\n        \u003c/div\u003e\n        \n        {/* Error */}\n        {error \u0026\u0026 (\n          \u003cdiv className=\"px-4 py-2 text-sm text-destructive\"\u003e\n            {error}\n          \u003c/div\u003e\n        )}\n        \n        {/* Actions */}\n        \u003cdiv className=\"flex justify-end gap-2 px-4 py-3 border-t\"\u003e\n          \u003cButton variant=\"outline\" onClick={() =\u003e onOpenChange(false)}\u003e\n            Cancel\n          \u003c/Button\u003e\n          \u003cButton \n            onClick={handleAddProject}\n            disabled={!filesystem?.currentPath || addProject.isPending}\n          \u003e\n            {addProject.isPending ? \"Adding...\" : \"Add Project\"}\n          \u003c/Button\u003e\n        \u003c/div\u003e\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  );\n}\n```\n\n## Mobile Behavior\n- Full screen modal on small screens (`sm:max-w-lg`)\n- Directory list takes available space, scrolls\n- Actions sticky at bottom\n- Touch-friendly inputs and buttons\n\n## Error Handling\n- Browse errors: Show in directory list area with retry\n- Add project errors: Show inline below name input\n- Clear error when navigating or retrying\n\n## Acceptance Criteria\n- [ ] Opens as modal dialog\n- [ ] Shows breadcrumbs with navigation\n- [ ] Shows directory list with navigation\n- [ ] Custom name input with folder name as placeholder\n- [ ] \"Add Project\" calls API with current path and name\n- [ ] Shows loading state during add\n- [ ] Shows error messages inline\n- [ ] Closes on success\n- [ ] Calls onSuccess callback on success\n- [ ] Cancel closes without action\n- [ ] Mobile-friendly layout\n\n## Dependencies\n- **Requires**: Task 3.1 (FolderBrowser component)\n- **Requires**: Task 3.2 (Breadcrumbs component)\n- **Requires**: Task 7.1 (useAddProject hook)\n- **Requires**: shadcn Dialog component (may need to add)\n\n## Files\n- `src/components/folder-browser/FolderBrowserModal.tsx` (new)\n- May need: `src/components/ui/dialog.tsx` (shadcn component)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.250446-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into FolderBrowserModal task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
