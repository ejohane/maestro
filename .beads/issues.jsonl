{"id":"maestro-141","title":"Test issue from worktree","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-31T09:01:25.255884-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","close_reason":"Test complete","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-2e2","title":"New Issue Prompt - Simplify modal to single prompt input (GH #7)","description":"Simplify the new issue modal to a single prompt input. The system will:\n1. Create a GitHub issue programmatically with a placeholder\n2. Inject context into the OpenCode session instructing the agent to update the issue title and description\n3. Send the user's prompt to the agent\n\nSee GitHub issue #7 for full details.","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-31T09:06:34.674719-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-2e2.1","title":"Replace title input with prompt textarea in NewIssueDialog","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T09:06:34.732542-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-2e2.2","title":"Update API route to handle prompt-based issue creation","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T09:06:34.787328-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-2e2.3","title":"Add OpenCode session creation and context injection","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T09:06:34.841915-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-2e2.4","title":"Implement session storage linking issue to OpenCode session","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T09:06:34.89525-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-2e2.5","title":"Verify agent updates issue title AND description via gh issue edit","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T09:06:34.949505-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-2e2.6","title":"Test end-to-end flow: prompt → issue creation → agent update → navigation","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T09:06:35.003677-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5sl","title":"Add Planning State to Filter Issues (GH #15)","description":"## Epic Overview\n\nThis epic implements a state mechanism to transition GitHub issues from \"open issues\" to \"planning\" phase, ensuring issues in planning are filtered out of issue lists and only appear in planning sections of the UI.\n\n## Business Value \u0026 Goals\n\n### Problem Statement\nCurrently, when a user starts planning an issue in Maestro, it still appears in the \"Open Issues\" section of the sidebar and kanban board. This creates significant UX problems:\n\n1. **Duplicate visibility**: The same issue appears in both \"Open Issues\" and \"Active Planning\" sections\n2. **Workflow confusion**: Issues being actively planned appear as \"available work\" - another developer might accidentally pick up an issue that is already being broken down\n3. **State ambiguity**: The separation between \"discussion/triage\" and \"active planning\" phases is unclear in the UI\n4. **Team coordination**: No way for team members using GitHub directly to see that an issue is in Maestro planning\n\n### Solution: GitHub Labels for State Management\nWe will use GitHub labels (`maestro:planning`) to mark issues that are in the planning phase. This approach provides:\n\n- **Team visibility**: Everyone sees planning status in GitHub UI, not just Maestro users\n- **Persistence**: Label survives even if `sessions.json` is cleared or corrupted\n- **Standard workflow**: Integrates with existing GitHub label-based workflows\n- **No extra API calls**: Labels are already fetched with the issue list\n- **Cross-instance**: Works across multiple Maestro instances/users on same repo\n\n### Label Specification\n- **Name**: `maestro:planning`\n- **Color**: `7057ff` (purple - distinguishes from standard GitHub labels)\n- **Description**: \"Issue is being planned in Maestro\"\n\n## Current Architecture Analysis\n\n### Session Storage (`/src/lib/services/sessions.ts`)\nPlanning sessions are tracked in `~/.maestro/sessions.json` with structure:\n- `projectId`: Project UUID (from Maestro config)\n- `issueNumber`: GitHub issue number\n- `sessionId`: OpenCode session ID\n- `worktreePath`: Git worktree path for isolated development\n- `sessionType: \"planning\"`: Distinguishes from discussion sessions\n\nThe `listPlanningSessions(projectId)` method already exists and returns all planning sessions for a project.\n\n### Issue Fetching (`/src/app/api/projects/[id]/issues/route.ts`)\nIssues are fetched via GitHub CLI:\n```bash\ngh issue list --state open --json number,title,body,state,url,createdAt,author,labels\n```\nLabels are returned as `{ name: string }[]` - we can filter based on label names.\n\n### Current Filtering Logic\n| Location | File | Current Logic |\n|----------|------|---------------|\n| Sidebar \"Open Issues\" | `app-sidebar.tsx:138` | `issues.filter(issue =\u003e issue.state === \"OPEN\")` |\n| Kanban \"Issues\" column | `page.tsx:216` | No filtering, shows all fetched issues |\n| Mobile accordion \"Issues\" | `page.tsx:111` | No filtering, shows all fetched issues |\n\n### Existing Planning Infrastructure (Already Implemented!)\n- Planning column in kanban: EXISTS (page.tsx lines 221-240)\n- `usePlanningSessions()` hook: EXISTS (returns planning sessions from sessions.json)\n- `PlanningSessionCard` component: EXISTS (renders planning session cards)\n- Planning sessions in sidebar: EXISTS (\"Active Planning\" section)\n\n**KEY INSIGHT**: The Planning column and session cards already exist. The work is primarily about **filtering issues with the label** and **adding/removing the label** at the right times.\n\n## Implementation Strategy\n\n### Phase 1: Label Infrastructure (Tasks 1-2)\nCreate shared constants and a service for managing the `maestro:planning` label. This provides a foundation for both adding labels (on planning start) and checking labels (for filtering).\n\n### Phase 2: Label Application (Task 3)\nModify the existing planning start endpoint to add the label after session creation. This is a small, surgical change to existing code.\n\n### Phase 3: Filtering (Tasks 4-5)\nUpdate all UI locations to exclude issues with the `maestro:planning` label:\n- Sidebar \"Open Issues\" section\n- Desktop kanban \"Issues\" column\n- Mobile accordion \"Issues\" section\n\n### Phase 4: End Planning Flow (Tasks 6-7)\nCreate the endpoint and UI to remove the label when planning ends. This allows issues to return to the \"Issues\" column when planning is complete or cancelled.\n\n### Phase 5: Verification (Task 8)\nTypeScript compilation, build verification, and integration testing.\n\n## Technical Decisions Made\n\n### Q1: What happens when planning is \"done\"?\n**Decision: Manual \"End Planning\" action**\nUsers explicitly end planning via a button. This removes the label and returns the issue to the Issues column. The worktree branch is preserved for potential PR creation.\n\n### Q2: What if label operations fail?\n**Decision: Non-fatal, log and continue**\nLabel operations are \"best effort\". If adding/removing a label fails (e.g., network issue, permissions), planning functionality still works - it just wont filter correctly until the label is manually fixed.\n\n### Q3: Cache invalidation strategy?\n**Decision: Invalidate on end planning**\nAfter ending planning, invalidate React Query caches for both `project-issues` and `planning-sessions` to ensure UI updates immediately.\n\n### Q4: Should we filter the API response or the UI?\n**Decision: UI filtering**\nFilter in the UI components rather than the API. This keeps the API response complete (useful for debugging) and allows flexibility in how different views handle the filtering.\n\n## Acceptance Criteria (Epic Level)\n- [ ] Starting planning on an issue adds `maestro:planning` label to GitHub\n- [ ] Label is created automatically if it doesnt exist\n- [ ] Issues with `maestro:planning` label are excluded from \"Open Issues\" everywhere\n- [ ] \"End Planning\" button appears in planning header\n- [ ] \"End Planning\" removes the label and returns issue to Issues column\n- [ ] Planning state persists across page refreshes (via GitHub label)\n- [ ] Works correctly for multiple concurrent planning sessions\n\n## Out of Scope\n- Automatic planning completion detection (too complex, requires understanding \"done\")\n- Multi-label workflow stages (maestro:executing, maestro:review) - future enhancement\n- Drag-and-drop between kanban columns - separate feature\n- Label color customization UI - not needed for MVP\n- Concurrent planning warnings - edge case, can add later\n\n## Related Files\n- `/src/lib/constants.ts` - NEW: Shared constants\n- `/src/lib/services/github-labels.ts` - NEW: Label management\n- `/src/app/api/projects/[id]/planning/[issueNumber]/start/route.ts` - MODIFY: Add label\n- `/src/app/api/projects/[id]/planning/[issueNumber]/end/route.ts` - NEW: End planning\n- `/src/components/app-sidebar.tsx` - MODIFY: Filter issues\n- `/src/app/project/[id]/page.tsx` - MODIFY: Filter kanban + mobile\n- `/src/components/planning/PlanningHeader.tsx` - MODIFY: Add end button","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2026-01-02T06:37:48.524148-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-5sl.1","title":"Create shared constants file for planning label","description":"## Task Overview\n\nCreate a new constants file at `/src/lib/constants.ts` that defines shared constants for the planning label. This file will be used by both client-side (React components) and server-side (API routes) code.\n\n## Background \u0026 Reasoning\n\n### Why a Separate Constants File?\n\n1. **Avoid circular imports**: Service files may import from each other; a standalone constants file prevents dependency cycles\n2. **Client/server compatibility**: This file must NOT import any Node.js-specific modules (fs, child_process) since it will be imported by client components\n3. **Single source of truth**: All code uses the same label name/color/description - no magic strings scattered across the codebase\n4. **Easy customization**: If we ever want to make the label configurable, this is the single place to change\n\n### Why These Specific Values?\n\n- **Label name `maestro:planning`**: The `maestro:` prefix creates a namespace that clearly identifies this as a Maestro-managed label, avoiding conflicts with user-created labels\n- **Color `7057ff` (purple)**: Distinct from common GitHub label colors (red for bugs, green for enhancements, blue for questions). Purple suggests \"in progress\" or \"workflow state\"\n- **Description**: Clear explanation for users who see the label in GitHub UI\n\n## Implementation\n\n**File**: `/src/lib/constants.ts` (NEW FILE)\n\n```typescript\n/**\n * Shared constants for use in both client and server components.\n * \n * IMPORTANT: Keep this file free of server-only imports (child_process, fs, etc.)\n * to ensure it can be safely imported by React client components.\n * \n * This file defines constants related to the planning workflow state management\n * using GitHub labels as the persistence mechanism.\n */\n\n/**\n * GitHub label applied to issues that are currently in the planning phase.\n * \n * When a user starts planning an issue in Maestro:\n * 1. This label is added to the GitHub issue\n * 2. Issue is filtered out of \"Open Issues\" sections\n * 3. Issue appears only in \"Planning\" sections\n * \n * When planning ends:\n * 1. This label is removed from the GitHub issue\n * 2. Issue returns to \"Open Issues\" sections\n */\nexport const PLANNING_LABEL = \"maestro:planning\";\n\n/**\n * Color for the planning label (GitHub hex format, without # prefix).\n * \n * Purple (7057ff) was chosen because:\n * - Distinct from common label colors (red=bug, green=enhancement, blue=question)\n * - Suggests \"in progress\" or \"workflow state\"\n * - Matches Maestros primary purple branding\n */\nexport const PLANNING_LABEL_COLOR = \"7057ff\";\n\n/**\n * Description text for the planning label.\n * Shown in GitHub UI when hovering over the label.\n */\nexport const PLANNING_LABEL_DESCRIPTION = \"Issue is being planned in Maestro\";\n```\n\n## File Location Rationale\n\nLocated at `/src/lib/constants.ts` because:\n- `/src/lib/` is for shared utilities and services\n- Follows existing pattern (types are in `/src/lib/types/`, services in `/src/lib/services/`)\n- Can be imported with `@/lib/constants` alias\n\n## Why Not Put This in the Service File?\n\nThe service file (`github-labels.ts`) will use Node.js `child_process` for executing `gh` commands. If we put constants there:\n- Client components couldnt import the constants without pulling in Node.js code\n- Next.js would throw \"Module not found: child_process\" errors on client bundle\n\n## Import Pattern\n\nAfter this file is created, code will import like:\n\n```typescript\n// In client component (e.g., app-sidebar.tsx):\nimport { PLANNING_LABEL } from \"@/lib/constants\";\n\n// In server service (e.g., github-labels.ts):\nimport { \n  PLANNING_LABEL, \n  PLANNING_LABEL_COLOR, \n  PLANNING_LABEL_DESCRIPTION \n} from \"@/lib/constants\";\n```\n\n## Dependencies\n\n- **None** - This is a foundational task with no dependencies\n\n## Dependents (Tasks That Depend on This)\n\n- Task 2: Create label service (needs constants)\n- Task 4: Filter sidebar issues (needs PLANNING_LABEL constant)\n- Task 5: Filter kanban issues (needs PLANNING_LABEL constant)\n\n## Acceptance Criteria\n\n- [ ] File `/src/lib/constants.ts` exists\n- [ ] `PLANNING_LABEL` constant equals `\"maestro:planning\"`\n- [ ] `PLANNING_LABEL_COLOR` constant equals `\"7057ff\"`\n- [ ] `PLANNING_LABEL_DESCRIPTION` constant equals `\"Issue is being planned in Maestro\"`\n- [ ] File contains NO imports (especially no Node.js modules)\n- [ ] File has JSDoc comments explaining each constant\n- [ ] TypeScript compiles without errors\n\n## Verification\n\n```bash\n# Check file exists\ncat src/lib/constants.ts\n\n# Verify no imports\n! grep -q \"^import\" src/lib/constants.ts \u0026\u0026 echo \"No imports - good!\"\n\n# TypeScript check\nnpx tsc --noEmit\n```","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T06:38:26.795543-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5sl.10","title":"Add cache invalidation after starting planning","description":"## Task Overview\n\nAfter the planning start endpoint adds the `maestro:planning` label to an issue, the frontend cache needs to be invalidated so the issue immediately disappears from the \"Issues\" column. Currently, users would have to manually refresh to see the filter take effect.\n\n## Background \u0026 Reasoning\n\n### The Problem\n\nThe flow is:\n1. User clicks \"Start Planning\" on issue #42\n2. Backend adds `maestro:planning` label to GitHub issue (Task 3)\n3. Frontend filter now SHOULD hide issue #42 from Issues column\n4. BUT: React Query cache still has the old issue list without the label\n5. User sees issue #42 in BOTH Issues column AND Planning column until they refresh\n\n### The Solution\n\nThe planning start response (SSE complete event) already returns to the frontend. We need to invalidate the `project-issues` query cache when planning starts successfully.\n\n## Implementation\n\n### Option A: Frontend Invalidation (Recommended)\n\nIn the component that initiates planning (likely where `StartPlanningModal` or similar is used), after receiving the SSE `complete` event, invalidate the cache:\n\n```typescript\n// In the handler for successful planning start\nqueryClient.invalidateQueries({ queryKey: [\"project-issues\", projectId] });\n```\n\n### Option B: Return label info in SSE response\n\nModify the start endpoint to include label status in the complete event:\n\n```typescript\n// In route.ts, modify sendCompleteEvent\nsendCompleteEvent({\n  sessionId,\n  worktreePath: worktreeInfo.path,\n  labelAdded: true, // New field\n});\n```\n\nThen frontend can decide whether to refresh based on this.\n\n## Location\n\nCheck where planning is initiated:\n- `/src/app/project/[id]/issue/[issueNumber]/page.tsx` - Issue detail page\n- `/src/components/planning/StartPlanningModal.tsx` - If exists\n\nLook for the SSE event handling code that processes the planning start pipeline.\n\n## Dependencies\n\n- **Task 3**: Add label on planning start (must be implemented first)\n\n## Dependents  \n\n- None - this is a polish task\n\n## Acceptance Criteria\n\n- [ ] After starting planning, issue immediately disappears from Issues column\n- [ ] No manual page refresh required\n- [ ] Planning column/section shows the session correctly\n\n## Note\n\nThis task may be optional if the polling interval for issues is short enough (e.g., 30 seconds), but for best UX, immediate cache invalidation is preferred.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T06:48:15.529259-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5sl.2","title":"Create GitHub labels service for planning state management","description":"## Task Overview\n\nCreate a new service file at `/src/lib/services/github-labels.ts` that provides functions for managing the `maestro:planning` GitHub label. This service handles creating, adding, removing, and checking the planning label on issues.\n\n## Background \u0026 Reasoning\n\n### Why a Dedicated Service?\n\n1. **Separation of concerns**: Label management is distinct from session management or issue fetching\n2. **Testability**: Isolated functions can be unit tested (mock exec calls)\n3. **Reusability**: Same functions used by start endpoint and end endpoint\n4. **Error handling**: Centralized error handling for GitHub CLI operations\n\n### GitHub CLI Approach\n\nWe use the `gh` CLI (GitHub CLI) rather than the GitHub REST API because:\n- Already available in the project (used by issue fetching)\n- Handles authentication automatically via `gh auth`\n- Simpler than managing OAuth tokens\n- Works offline with cached credentials\n\n### Error Handling Strategy\n\nGitHub label operations are \"best effort\" - they should not fail the overall planning operation:\n- If adding label fails when starting planning → planning still works, log warning\n- If removing label fails when ending planning → planning ends, log warning\n- The core functionality (worktree, session, etc.) continues regardless of label state\n\n## Implementation\n\n**File**: `/src/lib/services/github-labels.ts` (NEW FILE)\n\n```typescript\n/**\n * GitHub label management service for planning workflow state.\n * \n * This service provides functions to add/remove the maestro:planning label\n * on GitHub issues, which is used to filter issues out of \"Open Issues\" views\n * while they are in active planning.\n * \n * Uses the GitHub CLI (gh) for all operations. Requires gh to be installed\n * and authenticated.\n */\n\nimport { exec } from \"child_process\";\nimport { promisify } from \"util\";\nimport { \n  PLANNING_LABEL, \n  PLANNING_LABEL_COLOR, \n  PLANNING_LABEL_DESCRIPTION \n} from \"@/lib/constants\";\n\nconst execAsync = promisify(exec);\n\n// Re-export constants for server-side convenience\nexport { PLANNING_LABEL, PLANNING_LABEL_COLOR };\n\n/**\n * Ensure the maestro:planning label exists in the repository.\n * Creates the label with standard color/description if it doesnt exist.\n * \n * This is called before adding the label to an issue to ensure\n * the label exists. Its idempotent - safe to call multiple times.\n * \n * @param projectPath - Absolute path to the git repository\n * @throws Error if GitHub CLI fails (network, auth, etc.)\n */\nexport async function ensurePlanningLabel(projectPath: string): Promise\u003cvoid\u003e {\n  try {\n    // Check if label already exists\n    await execAsync(`gh label view \"${PLANNING_LABEL}\"`, { cwd: projectPath });\n    // Label exists, nothing to do\n  } catch {\n    // Label doesnt exist (gh label view returns non-zero), create it\n    await execAsync(\n      `gh label create \"${PLANNING_LABEL}\" --color \"${PLANNING_LABEL_COLOR}\" --description \"${PLANNING_LABEL_DESCRIPTION}\"`,\n      { cwd: projectPath }\n    );\n  }\n}\n\n/**\n * Add the planning label to a GitHub issue.\n * \n * This function:\n * 1. Ensures the label exists in the repository\n * 2. Adds the label to the specified issue\n * \n * If the label is already on the issue, GitHub CLI handles this gracefully\n * (no error, just a no-op).\n * \n * @param projectPath - Absolute path to the git repository\n * @param issueNumber - GitHub issue number to label\n * @throws Error if GitHub CLI fails\n * \n * @example\n * ```typescript\n * await addPlanningLabel(\"/Users/me/my-repo\", 42);\n * // Issue #42 now has the maestro:planning label\n * ```\n */\nexport async function addPlanningLabel(\n  projectPath: string,\n  issueNumber: number\n): Promise\u003cvoid\u003e {\n  // First ensure the label exists in the repo\n  await ensurePlanningLabel(projectPath);\n  \n  // Add the label to the issue\n  await execAsync(\n    `gh issue edit ${issueNumber} --add-label \"${PLANNING_LABEL}\"`,\n    { cwd: projectPath }\n  );\n}\n\n/**\n * Remove the planning label from a GitHub issue.\n * \n * Fails silently if:\n * - The label doesnt exist on the issue\n * - The label doesnt exist in the repository\n * \n * This is intentional - we care about the end state (no label), not\n * whether the label was there before.\n * \n * @param projectPath - Absolute path to the git repository\n * @param issueNumber - GitHub issue number to unlabel\n * @throws Error only for unexpected failures (network, auth)\n * \n * @example\n * ```typescript\n * await removePlanningLabel(\"/Users/me/my-repo\", 42);\n * // Issue #42 no longer has the maestro:planning label\n * ```\n */\nexport async function removePlanningLabel(\n  projectPath: string,\n  issueNumber: number\n): Promise\u003cvoid\u003e {\n  try {\n    await execAsync(\n      `gh issue edit ${issueNumber} --remove-label \"${PLANNING_LABEL}\"`,\n      { cwd: projectPath }\n    );\n  } catch (err) {\n    // Check if this is a \"label not found\" error - thats OK\n    const message = err instanceof Error ? err.message : String(err);\n    if (message.includes(\"not found\") || message.includes(\"does not exist\")) {\n      // Label wasnt on the issue or doesnt exist - this is fine\n      return;\n    }\n    // Re-throw other errors (network, auth, etc.)\n    throw err;\n  }\n}\n\n/**\n * Check if an issue has the planning label.\n * \n * This is a pure function that operates on the labels array from a GitHub issue.\n * It does NOT make any API calls - use this for filtering in UI components.\n * \n * @param labels - Array of label objects from GitHub issue (must have name property)\n * @returns true if the issue has the maestro:planning label\n * \n * @example\n * ```typescript\n * const issues = await fetchIssues();\n * const openIssues = issues.filter(issue =\u003e !hasPlanningLabel(issue.labels));\n * ```\n */\nexport function hasPlanningLabel(labels: { name: string }[]): boolean {\n  return labels.some(label =\u003e label.name === PLANNING_LABEL);\n}\n\n/**\n * Type guard to check if an issue is in planning state.\n * Alias for hasPlanningLabel with clearer intent.\n * \n * @param labels - Array of label objects from GitHub issue\n * @returns true if issue is currently being planned\n */\nexport function isInPlanning(labels: { name: string }[]): boolean {\n  return hasPlanningLabel(labels);\n}\n```\n\n## Key Design Decisions\n\n### 1. Async/Await Error Handling\n\n```typescript\ntry {\n  await execAsync(`gh label view \"${PLANNING_LABEL}\"`, { cwd: projectPath });\n} catch {\n  // Label doesnt exist\n}\n```\n\nWe catch errors from `gh label view` because it returns non-zero exit code when the label doesnt exist. This isnt an error condition - its expected when first using Maestro on a repo.\n\n### 2. hasPlanningLabel is Pure\n\nThe `hasPlanningLabel` function is intentionally pure (no side effects):\n- Takes labels array as input\n- Returns boolean\n- Makes no API calls\n- Can be used in client-side React components\n\nThis allows client code to import and use this function without pulling in Node.js dependencies.\n\n### 3. Error Recovery in removePlanningLabel\n\n```typescript\nif (message.includes(\"not found\") || message.includes(\"does not exist\")) {\n  return; // This is fine\n}\nthrow err; // Re-throw real errors\n```\n\nWe specifically catch \"not found\" errors because:\n- Label might not be on the issue (user manually removed it)\n- Label might not exist in repo (was deleted)\n- Either way, the goal (no label on issue) is achieved\n\n### 4. Project Path, Not Worktree Path\n\nFunctions take `projectPath` (main repo path) because:\n- Labels are repo-level, not worktree-level\n- The `gh` CLI needs to run in a valid git directory\n- Main repo path is always valid; worktree might be deleted\n\n## Dependencies\n\n- **Task 1**: Create constants file (this task imports constants)\n\n## Dependents\n\n- **Task 3**: Add label on planning start (uses addPlanningLabel)\n- **Task 6**: End planning endpoint (uses removePlanningLabel)\n\n## Files Changed\n\n- `/src/lib/services/github-labels.ts` - NEW FILE\n\n## Acceptance Criteria\n\n- [ ] File `/src/lib/services/github-labels.ts` exists\n- [ ] Exports `ensurePlanningLabel(projectPath)` function\n- [ ] Exports `addPlanningLabel(projectPath, issueNumber)` function\n- [ ] Exports `removePlanningLabel(projectPath, issueNumber)` function\n- [ ] Exports `hasPlanningLabel(labels)` function\n- [ ] Re-exports `PLANNING_LABEL` constant\n- [ ] All functions have JSDoc comments\n- [ ] TypeScript compiles without errors\n\n## Verification\n\n```bash\n# Check file exists and exports\ngrep -E \"export (async )?function\" src/lib/services/github-labels.ts\n\n# TypeScript check\nnpx tsc --noEmit\n\n# Verify imports from constants\ngrep \"from.*constants\" src/lib/services/github-labels.ts\n```","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T06:39:07.762959-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5sl.3","title":"Add planning label to issue when planning starts","description":"## Task Overview\n\nModify the planning start endpoint (`/src/app/api/projects/[id]/planning/[issueNumber]/start/route.ts`) to add the `maestro:planning` label to the GitHub issue after successfully creating the planning session.\n\n## Background \u0026 Reasoning\n\n### When Should the Label Be Added?\n\nThe label is added **after** the planning session is successfully saved (line ~279), not before. This order is intentional:\n\n1. **Session first**: If session creation fails, we dont want a label on an issue with no actual planning session\n2. **Non-blocking**: Label failure shouldnt prevent planning from working\n3. **Consistent state**: Label only exists when there is a valid planning session\n\n### Why After Session Save, Not Before?\n\nIf we add the label first and session creation fails:\n- User sees issue disappear from \"Open Issues\"\n- No planning session exists to work with\n- User confused: \"Where did my issue go?\"\n\nBy adding label after session save:\n- Session exists before label is added\n- If label fails, planning still works (just filtering wont work until manually fixed)\n- Worst case: issue appears in both places temporarily\n\n### Error Handling\n\nLabel operations are wrapped in try/catch and log warnings on failure:\n\n```typescript\ntry {\n  await addPlanningLabel(project.path, issueNumber);\n} catch (err) {\n  console.warn(`Failed to add planning label to issue #${issueNumber}:`, err);\n}\n```\n\nThis ensures:\n- Planning continues even if GitHub is temporarily unavailable\n- Label failures are visible in logs for debugging\n- Users arent blocked by label operations\n\n## Implementation\n\n### File: `/src/app/api/projects/[id]/planning/[issueNumber]/start/route.ts`\n\n**Step 1: Add Import**\n\nAdd to imports at top of file (around line 4):\n\n```typescript\nimport { addPlanningLabel } from \"@/lib/services/github-labels\";\n```\n\n**Step 2: Add Label After Session Save**\n\nAfter the `savePlanningSession` call (around line 279), add:\n\n```typescript\n// Save session mapping\nawait sessionStorage.savePlanningSession(\n  projectId,\n  project.path,\n  issueNumber,\n  sessionId,\n  worktreeInfo.path\n);\n\n// NEW: Add planning label to GitHub issue\n// This is non-fatal - planning works even if label fails\ntry {\n  await addPlanningLabel(project.path, issueNumber);\n} catch (err) {\n  // Log warning but dont fail the pipeline\n  // Label is for filtering convenience, not core functionality\n  console.warn(\n    `[Planning Start] Failed to add planning label to issue #${issueNumber}:`,\n    err instanceof Error ? err.message : err\n  );\n}\n```\n\n## Why project.path and Not worktreeInfo.path?\n\nThe GitHub CLI needs to run in a directory that is:\n1. A valid git repository\n2. Connected to the GitHub remote\n\nWhile worktrees are valid git repos, we use `project.path` (the main repo) because:\n- Its always present and valid\n- Label operations are repo-level, not worktree-specific\n- Avoids potential issues with newly-created worktrees\n\n## Existing Code Context\n\nThe relevant section of the file (around lines 270-310) currently looks like:\n\n```typescript\n// Create new session\nsendStepEvent({\n  id: \"create_session\",\n  status: \"in_progress\",\n  name: STEPS.create_session.name,\n});\n\ntry {\n  const sessionTitle = `Planning: Issue #${issueNumber} - ${issueTitle}`;\n  const result = await openCodeService.createPlanningSession(\n    worktreeInfo.path,\n    sessionTitle\n  );\n  sessionId = result.id;\n\n  // Save session mapping\n  await sessionStorage.savePlanningSession(\n    projectId,\n    project.path,\n    issueNumber,\n    sessionId,\n    worktreeInfo.path\n  );\n\n  // NEW CODE GOES HERE (after save, before injectContext)\n\n  // Inject worktree context into the session\n  const worktreeContext = `\u003csystem-reminder\u003e...`;\n  await openCodeService.injectContext(...);\n```\n\n## Dependencies\n\n- **Task 1**: Constants file (PLANNING_LABEL used by github-labels.ts)\n- **Task 2**: GitHub labels service (provides addPlanningLabel function)\n\n## Dependents\n\n- **Task 4**: Filter sidebar issues (depends on label being added)\n- **Task 5**: Filter kanban issues (depends on label being added)\n\n## Files Changed\n\n- `/src/app/api/projects/[id]/planning/[issueNumber]/start/route.ts` - MODIFY\n\n## Acceptance Criteria\n\n- [ ] Import statement for `addPlanningLabel` is added\n- [ ] `addPlanningLabel` is called after `savePlanningSession`\n- [ ] Call is wrapped in try/catch\n- [ ] Catch block logs warning but does not re-throw\n- [ ] Uses `project.path` (not `worktreeInfo.path`)\n- [ ] TypeScript compiles without errors\n- [ ] Planning still works if label operation fails\n\n## Testing\n\n### Manual Test Steps\n\n1. Start planning on an issue\n2. Check GitHub issue for `maestro:planning` label\n3. Verify label has purple color (7057ff)\n4. If repo didnt have the label before, verify it was created\n\n### Edge Cases\n\n1. **First time on repo**: Label should be auto-created\n2. **Label already exists**: Should succeed (no duplicate)\n3. **Offline/network error**: Planning continues, warning logged\n4. **Label already on issue**: GitHub handles gracefully (no-op)\n\n## Verification Commands\n\n```bash\n# Check import was added\ngrep \"addPlanningLabel\" src/app/api/projects/[[]id[]]/planning/[[]issueNumber[]]/start/route.ts\n\n# TypeScript check\nnpx tsc --noEmit\n\n# Check for try/catch around the call\ngrep -A5 \"addPlanningLabel\" src/app/api/projects/[[]id[]]/planning/[[]issueNumber[]]/start/route.ts | grep -q \"try\"\n```","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T06:39:48.638905-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5sl.4","title":"Filter planning issues from sidebar Open Issues section","description":"## Task Overview\n\nModify the sidebar component (`/src/components/app-sidebar.tsx`) to filter out issues that have the `maestro:planning` label from the \"Open Issues\" section. These issues should only appear in the \"Active Planning\" section (which already exists).\n\n## Background \u0026 Reasoning\n\n### Current Behavior (Problem)\n\nWhen a user starts planning on an issue:\n1. Issue appears in \"Active Planning\" section (correct)\n2. Issue ALSO appears in \"Open Issues\" section (incorrect - duplicate visibility)\n\nUsers see the same issue in two places, which is confusing and makes it appear as \"available work\" when its not.\n\n### Desired Behavior\n\nAfter filtering:\n1. Issue with `maestro:planning` label appears ONLY in \"Active Planning\" section\n2. \"Open Issues\" section shows only issues NOT in planning\n3. Count badge updates to reflect filtered count\n\n### Why Client-Side Filtering?\n\nWe filter in the UI component rather than the API for several reasons:\n1. **Debugging**: Full issue list available in network inspector\n2. **Flexibility**: Different views might want different filtering\n3. **Simplicity**: No API changes needed\n4. **Performance**: Filtering a few dozen issues is instant\n\n## Implementation\n\n### File: `/src/components/app-sidebar.tsx`\n\n**Step 1: Add Import**\n\nAdd to imports at top of file (around line 6):\n\n```typescript\nimport { PLANNING_LABEL } from \"@/lib/constants\";\n```\n\n**Step 2: Update Filter Logic**\n\nLocation: `ProjectIssuesSection` component (around line 138)\n\n**Current code:**\n```typescript\n// Filter to only open issues\nconst openIssues = issues.filter((issue) =\u003e issue.state === \"OPEN\" || issue.state === \"open\");\n```\n\n**New code:**\n```typescript\n// Filter to only open issues that are NOT in planning\n// Issues in planning should only appear in the \"Active Planning\" section\nconst openIssues = issues.filter(\n  (issue) =\u003e \n    (issue.state === \"OPEN\" || issue.state === \"open\") \u0026\u0026\n    !issue.labels?.some(label =\u003e label.name === PLANNING_LABEL)\n);\n```\n\n## Code Context\n\nThe `ProjectIssuesSection` component currently looks like (lines 124-201):\n\n```typescript\nfunction ProjectIssuesSection({ \n  project, \n  pathname,\n  onNavigate,\n}: { \n  project: Project; \n  pathname: string;\n  onNavigate: () =\u003e void;\n}) {\n  const { data: issues = [], isLoading } = useProjectIssues(project.id);\n  const [isOpen, setIsOpen] = useState(true);\n  \n  // THIS LINE CHANGES:\n  const openIssues = issues.filter((issue) =\u003e issue.state === \"OPEN\" || issue.state === \"open\");\n  \n  // Rest of component...\n}\n```\n\n## Why `issue.labels?.some()` (Optional Chaining)?\n\nThe optional chaining (`?.`) handles cases where:\n- `issue.labels` might be `undefined` (API inconsistency)\n- `issue.labels` might be `null` (data parsing issue)\n\nThis defensive coding prevents runtime errors.\n\n## Count Badge Update\n\nThe count badge already uses `openIssues.length` (line 165), so filtering the array automatically updates the count:\n\n```typescript\n\u003cspan className=\"text-xs text-muted-foreground\"\u003e{openIssues.length}\u003c/span\u003e\n```\n\nNo additional changes needed for the count.\n\n## Dependencies\n\n- **Task 1**: Constants file (provides PLANNING_LABEL constant)\n- **Task 3**: Add label on start (labels must be added for filtering to work)\n\nNote: Task 3 doesnt have to be complete for this task to work - we can deploy filtering first. It just wont filter anything until labels are being added.\n\n## Dependents\n\nNone - this is a leaf task\n\n## Files Changed\n\n- `/src/components/app-sidebar.tsx` - MODIFY\n\n## Acceptance Criteria\n\n- [ ] Import statement for `PLANNING_LABEL` is added\n- [ ] Filter logic excludes issues with `maestro:planning` label\n- [ ] Uses optional chaining on `issue.labels`\n- [ ] Count badge reflects filtered count\n- [ ] TypeScript compiles without errors\n- [ ] Issues in planning dont appear in \"Open Issues\" section\n\n## Testing\n\n### Manual Test Steps\n\n1. Have an issue with `maestro:planning` label (manually add in GitHub if needed)\n2. Refresh Maestro\n3. Verify issue does NOT appear in \"Open Issues\" section\n4. Verify issue count is correct (excludes planning issues)\n5. Remove label from issue in GitHub\n6. Refresh Maestro\n7. Verify issue now appears in \"Open Issues\" section\n\n### Edge Cases\n\n1. **No labels on issue**: Should appear in \"Open Issues\" (not filtered)\n2. **Multiple labels including maestro:planning**: Should be filtered out\n3. **Similar label name (e.g., \"planning\")**: Should NOT be filtered (exact match)\n4. **Empty issues array**: Should handle gracefully (no errors)\n\n## Visual Verification\n\nBefore filtering:\n```\nOpen Issues (5)\n├─ Issue #1: Add dark mode      [maestro:planning]\n├─ Issue #2: Fix login bug\n├─ Issue #3: Update docs\n├─ Issue #4: Refactor API       [maestro:planning]\n└─ Issue #5: Add tests\n```\n\nAfter filtering:\n```\nOpen Issues (3)\n├─ Issue #2: Fix login bug\n├─ Issue #3: Update docs\n└─ Issue #5: Add tests\n```\n\nIssues #1 and #4 now appear only in \"Active Planning\" section.\n\n## Verification Commands\n\n```bash\n# Check import was added\ngrep \"PLANNING_LABEL\" src/components/app-sidebar.tsx\n\n# Check filter logic includes label check\ngrep -A3 \"openIssues = issues.filter\" src/components/app-sidebar.tsx\n\n# TypeScript check\nnpx tsc --noEmit\n```","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T06:40:22.811967-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5sl.5","title":"Filter planning issues from kanban board and mobile accordion","description":"## Task Overview\n\nModify the project overview page (`/src/app/project/[id]/page.tsx`) to filter out issues that have the `maestro:planning` label from both:\n1. The desktop kanban \"Issues\" column\n2. The mobile accordion \"Issues\" section\n\nThese issues should only appear in the respective \"Planning\" sections (which already exist).\n\n## Background \u0026 Reasoning\n\n### Current Behavior (Problem)\n\nThe project overview page shows issues in two layouts:\n- **Desktop (\u003e= lg)**: Kanban board with Issues column\n- **Mobile (\u003c lg)**: Accordion with Issues section\n\nCurrently, issues with the `maestro:planning` label appear in both the Issues AND Planning sections, causing confusion.\n\n### Desired Behavior\n\nAfter filtering:\n1. Issues with `maestro:planning` label appear ONLY in Planning column/section\n2. Issues column/section shows only issues NOT in planning\n3. Count badges update to reflect filtered counts\n\n## Implementation\n\n### File: `/src/app/project/[id]/page.tsx`\n\n**Step 1: Add Import**\n\nAdd to imports at top of file (around line 13):\n\n```typescript\nimport { PLANNING_LABEL } from \"@/lib/constants\";\n```\n\n**Step 2: Create Filtered Array**\n\nAdd after the hooks (around line 33, after `usePlanningSessions`):\n\n```typescript\nconst { data: planningSessions = [], isLoading: planningLoading } = usePlanningSessions(projectId);\nconst [isNewIssueDialogOpen, setIsNewIssueDialogOpen] = useState(false);\n\n// NEW: Filter out issues that are in planning\n// These appear in the Planning column/section instead\nconst openIssues = issues.filter(\n  (issue) =\u003e !issue.labels?.some(label =\u003e label.name === PLANNING_LABEL)\n);\n```\n\n**Step 3: Update Desktop Kanban Column**\n\nLocation: Around line 211-219\n\n**Current code:**\n```typescript\n\u003cKanbanColumn\n  title=\"Issues\"\n  icon={\u003cCircleDot className=\"h-3.5 w-3.5\" /\u003e}\n  iconColor=\"text-[hsl(var(--orange))]\"\n  count={issues.length}\n  accentColor=\"bg-[hsl(var(--orange))]\"\n  onAddClick={() =\u003e setIsNewIssueDialogOpen(true)}\n  isLoading={issuesLoading}\n\u003e\n  {issues.map((issue) =\u003e (\n    \u003cIssueCard key={issue.number} issue={issue} projectId={projectId} /\u003e\n  ))}\n\u003c/KanbanColumn\u003e\n```\n\n**New code:**\n```typescript\n\u003cKanbanColumn\n  title=\"Issues\"\n  icon={\u003cCircleDot className=\"h-3.5 w-3.5\" /\u003e}\n  iconColor=\"text-[hsl(var(--orange))]\"\n  count={openIssues.length}  // CHANGED\n  accentColor=\"bg-[hsl(var(--orange))]\"\n  onAddClick={() =\u003e setIsNewIssueDialogOpen(true)}\n  isLoading={issuesLoading}\n\u003e\n  {openIssues.map((issue) =\u003e (  // CHANGED\n    \u003cIssueCard key={issue.number} issue={issue} projectId={projectId} /\u003e\n  ))}\n\u003c/KanbanColumn\u003e\n```\n\n**Step 4: Update Mobile Accordion**\n\nLocation: Around lines 85-118\n\n**Current code:**\n```typescript\n\u003cAccordionItem value=\"issues\"\u003e\n  \u003cAccordionTrigger className=\"py-3\"\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cCircleDot className=\"h-4 w-4 text-[hsl(var(--orange))]\" /\u003e\n      \u003cspan className=\"font-medium\"\u003eIssues\u003c/span\u003e\n      \u003cspan className=\"text-xs text-muted-foreground bg-secondary rounded-full px-2 py-0.5\"\u003e\n        {issues.length}\n      \u003c/span\u003e\n    \u003c/div\u003e\n  \u003c/AccordionTrigger\u003e\n  \u003cAccordionContent\u003e\n    \u003cdiv className=\"space-y-2\"\u003e\n      {/* New Issue Button */}\n      \u003cbutton onClick={() =\u003e setIsNewIssueDialogOpen(true)} ... /\u003e\n      {issuesLoading ? (\n        ...\n      ) : issues.length \u003e 0 ? (\n        issues.map((issue) =\u003e (\n          \u003cCompactIssueCard key={issue.number} issue={issue} projectId={projectId} /\u003e\n        ))\n      ) : (\n        \u003cp\u003eNo open issues\u003c/p\u003e\n      )}\n    \u003c/div\u003e\n  \u003c/AccordionContent\u003e\n\u003c/AccordionItem\u003e\n```\n\n**New code (changes marked):**\n```typescript\n\u003cAccordionItem value=\"issues\"\u003e\n  \u003cAccordionTrigger className=\"py-3\"\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cCircleDot className=\"h-4 w-4 text-[hsl(var(--orange))]\" /\u003e\n      \u003cspan className=\"font-medium\"\u003eIssues\u003c/span\u003e\n      \u003cspan className=\"text-xs text-muted-foreground bg-secondary rounded-full px-2 py-0.5\"\u003e\n        {openIssues.length}  {/* CHANGED */}\n      \u003c/span\u003e\n    \u003c/div\u003e\n  \u003c/AccordionTrigger\u003e\n  \u003cAccordionContent\u003e\n    \u003cdiv className=\"space-y-2\"\u003e\n      {/* New Issue Button - unchanged */}\n      \u003cbutton onClick={() =\u003e setIsNewIssueDialogOpen(true)} ... /\u003e\n      {issuesLoading ? (\n        ...\n      ) : openIssues.length \u003e 0 ? (  {/* CHANGED */}\n        openIssues.map((issue) =\u003e (  {/* CHANGED */}\n          \u003cCompactIssueCard key={issue.number} issue={issue} projectId={projectId} /\u003e\n        ))\n      ) : (\n        \u003cp\u003eNo open issues\u003c/p\u003e\n      )}\n    \u003c/div\u003e\n  \u003c/AccordionContent\u003e\n\u003c/AccordionItem\u003e\n```\n\n## Summary of Changes\n\n| Location | Variable | Before | After |\n|----------|----------|--------|-------|\n| Desktop count | count prop | `issues.length` | `openIssues.length` |\n| Desktop map | array | `issues.map` | `openIssues.map` |\n| Mobile count | badge text | `issues.length` | `openIssues.length` |\n| Mobile conditional | length check | `issues.length \u003e 0` | `openIssues.length \u003e 0` |\n| Mobile map | array | `issues.map` | `openIssues.map` |\n\n## Why Single Filter, Multiple Uses?\n\nWe define `openIssues` once and use it in multiple places:\n1. **DRY**: Filter logic in one place\n2. **Performance**: Array filtered once, not twice\n3. **Consistency**: Same data shown in both layouts\n\n## Dependencies\n\n- **Task 1**: Constants file (provides PLANNING_LABEL constant)\n- **Task 3**: Add label on start (labels must be added for filtering to work)\n\nNote: Can be deployed before Task 3 - just wont filter anything until labels exist.\n\n## Dependents\n\nNone - this is a leaf task\n\n## Files Changed\n\n- `/src/app/project/[id]/page.tsx` - MODIFY\n\n## Acceptance Criteria\n\n- [ ] Import statement for `PLANNING_LABEL` is added\n- [ ] `openIssues` filtered array is created\n- [ ] Desktop kanban column uses `openIssues` (count and map)\n- [ ] Mobile accordion uses `openIssues` (count, conditional, and map)\n- [ ] TypeScript compiles without errors\n- [ ] Issues in planning dont appear in Issues column/section\n- [ ] Issues in planning still appear in Planning column/section\n\n## Testing\n\n### Manual Test Steps (Desktop)\n\n1. Add `maestro:planning` label to an issue via GitHub\n2. Refresh Maestro project page\n3. Verify issue does NOT appear in Issues column\n4. Verify issue DOES appear in Planning column\n5. Verify Issues column count is correct\n\n### Manual Test Steps (Mobile)\n\n1. Same setup as desktop\n2. Resize browser to \u003c 1024px width\n3. Verify issue does NOT appear in Issues accordion\n4. Verify issue DOES appear in Planning accordion\n5. Verify counts are correct\n\n### Edge Cases\n\n1. **All issues in planning**: Issues column shows empty state\n2. **No issues in planning**: Filtering is no-op (all issues shown)\n3. **Label added mid-session**: Wont reflect until refresh (expected)\n\n## Verification Commands\n\n```bash\n# Check import was added\ngrep \"PLANNING_LABEL\" src/app/project/[[]id[]]/page.tsx\n\n# Check openIssues is defined\ngrep \"openIssues = issues.filter\" src/app/project/[[]id[]]/page.tsx\n\n# Check its used in KanbanColumn\ngrep -A2 \"title=\\\"Issues\\\"\" src/app/project/[[]id[]]/page.tsx | grep openIssues\n\n# TypeScript check\nnpx tsc --noEmit\n```","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T06:41:09.433038-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5sl.6","title":"Create end planning API endpoint","description":"## Task Overview\n\nCreate a new API endpoint at `/src/app/api/projects/[id]/planning/[issueNumber]/end/route.ts` that handles ending a planning session. This endpoint removes the `maestro:planning` label from the GitHub issue and optionally cleans up the session and worktree.\n\n## Background \u0026 Reasoning\n\n### Why an Endpoint Instead of Direct Client Call?\n\n1. **Server-side operations**: Removing GitHub labels requires `gh` CLI which runs on server\n2. **Consistent cleanup**: Single place to handle all end-planning logic\n3. **Future extensibility**: Can add more cleanup logic (webhooks, notifications, etc.)\n4. **Error handling**: Server can handle partial failures gracefully\n\n### Two Modes of Operation\n\nThe endpoint supports two modes via the `cleanup` flag:\n\n1. **cleanup: false (default)**: Only remove the label\n   - Issue returns to \"Open Issues\" section\n   - Worktree and branch preserved for PR creation\n   - Session data kept for potential resume\n   \n2. **cleanup: true**: Full cleanup\n   - Remove label\n   - Delete session from sessions.json\n   - Delete worktree and branch\n   - Use when completely abandoning planning\n\n## Implementation\n\n### File: `/src/app/api/projects/[id]/planning/[issueNumber]/end/route.ts` (NEW FILE)\n\n```typescript\nimport { NextResponse } from \"next/server\";\nimport { configService } from \"@/lib/services/config\";\nimport { sessionStorage } from \"@/lib/services/sessions\";\nimport { worktreeService } from \"@/lib/services/worktree\";\nimport { removePlanningLabel } from \"@/lib/services/github-labels\";\n\ninterface EndPlanningRequest {\n  cleanup?: boolean;\n}\n\ninterface EndPlanningResponse {\n  success: boolean;\n  labelRemoved: boolean;\n  sessionRemoved: boolean;\n  worktreeRemoved: boolean;\n  errors: string[];\n}\n\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise\u003c{ id: string; issueNumber: string }\u003e }\n) {\n  const { id: projectId, issueNumber: issueNumStr } = await params;\n  const issueNumber = parseInt(issueNumStr, 10);\n\n  if (isNaN(issueNumber) || issueNumber \u003c= 0) {\n    return NextResponse.json(\n      { error: \"Invalid issue number\" },\n      { status: 400 }\n    );\n  }\n\n  const project = await configService.getProject(projectId);\n  if (!project) {\n    return NextResponse.json(\n      { error: \"Project not found\" },\n      { status: 404 }\n    );\n  }\n\n  let cleanup = false;\n  try {\n    const body: EndPlanningRequest = await request.json();\n    cleanup = body.cleanup === true;\n  } catch {\n    // No body or invalid JSON - use defaults\n  }\n\n  const results: EndPlanningResponse = {\n    success: false,\n    labelRemoved: false,\n    sessionRemoved: false,\n    worktreeRemoved: false,\n    errors: [],\n  };\n\n  // 1. Remove planning label from GitHub issue\n  try {\n    await removePlanningLabel(project.path, issueNumber);\n    results.labelRemoved = true;\n  } catch (err) {\n    const msg = err instanceof Error ? err.message : String(err);\n    results.errors.push(`Failed to remove label: ${msg}`);\n  }\n\n  // 2. Optionally clean up session and worktree\n  if (cleanup) {\n    try {\n      const removed = await sessionStorage.removeSession(\n        projectId, \n        issueNumber, \n        \"planning\"\n      );\n      results.sessionRemoved = removed;\n    } catch (err) {\n      const msg = err instanceof Error ? err.message : String(err);\n      results.errors.push(`Failed to remove session: ${msg}`);\n    }\n\n    try {\n      await worktreeService.deleteWorktree(project.path, issueNumber);\n      results.worktreeRemoved = true;\n    } catch (err) {\n      const msg = err instanceof Error ? err.message : String(err);\n      if (!msg.includes(\"not found\") \u0026\u0026 !msg.includes(\"does not exist\")) {\n        results.errors.push(`Failed to remove worktree: ${msg}`);\n      } else {\n        results.worktreeRemoved = true;\n      }\n    }\n  }\n\n  // SUCCESS LOGIC (FIXED):\n  // Success if label was removed OR if label operation had no errors\n  // (meaning label was already gone, which is acceptable)\n  results.success = results.labelRemoved;\n\n  return NextResponse.json(results);\n}\n```\n\n## Dependencies\n\n- **Task 2**: GitHub labels service (provides removePlanningLabel function)\n\n## Dependents\n\n- **Task 7**: End planning UI button (calls this endpoint)\n\n## Acceptance Criteria\n\n- [ ] File exists at correct path\n- [ ] Exports POST function\n- [ ] Validates project ID and issue number\n- [ ] Removes planning label from GitHub issue\n- [ ] Respects cleanup flag for optional session/worktree removal\n- [ ] Returns structured response with operation results\n- [ ] TypeScript compiles without errors","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T06:42:07.678548-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5sl.7","title":"Add End Planning button and dialog to PlanningHeader","description":"## Task Overview\n\nModify the PlanningHeader component (`/src/components/planning/PlanningHeader.tsx`) to add an \"End Planning\" button that opens a confirmation dialog and calls the end planning endpoint.\n\n## Background \u0026 Reasoning\n\n### UX Flow\n\n1. User clicks \"End Planning\" button in header\n2. Confirmation dialog appears explaining what will happen\n3. User confirms → endpoint called → navigate back to project\n4. User cancels → dialog closes, nothing happens\n\n### Why a Confirmation Dialog?\n\nEnding planning removes the label and changes how the issue appears. Users should:\n- Understand what will happen before confirming\n- Have a way to cancel if clicked accidentally\n- See loading state while the operation runs\n\n### Design Decisions\n\n- **Button placement**: Right side of header, next to \"Back to Issue\"\n- **Button style**: `variant=\"outline\"` - secondary action, not destructive\n- **Icon**: `Square` (stop) - indicates \"stop this activity\"\n- **Dialog**: Uses shadcn AlertDialog for accessibility\n\n## Implementation\n\n### File: `/src/components/planning/PlanningHeader.tsx`\n\n**Complete replacement file:**\n\n```typescript\n\"use client\";\n\nimport { useState } from \"react\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { ChevronLeft, ChevronRight, Square, Loader2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { SidebarTrigger } from \"@/components/ui/sidebar\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { useQueryClient } from \"@tanstack/react-query\";\n\ninterface PlanningHeaderProps {\n  projectId: string;\n  issueNumber: number;\n  issueTitle: string;\n  projectName: string;\n}\n\nexport function PlanningHeader({\n  projectId,\n  issueNumber,\n  issueTitle,\n  projectName,\n}: PlanningHeaderProps) {\n  const router = useRouter();\n  const queryClient = useQueryClient();\n  const [isEnding, setIsEnding] = useState(false);\n  const [showDialog, setShowDialog] = useState(false);\n\n  const handleEndPlanning = async () =\u003e {\n    setIsEnding(true);\n    try {\n      const response = await fetch(\n        `/api/projects/${projectId}/planning/${issueNumber}/end`,\n        {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ cleanup: false }), // Preserve worktree\n        }\n      );\n\n      if (!response.ok) {\n        const error = await response.json();\n        console.error(\"Failed to end planning:\", error);\n        return;\n      }\n\n      // Invalidate caches so UI updates immediately\n      await queryClient.invalidateQueries({ \n        queryKey: [\"project-issues\", projectId] \n      });\n      await queryClient.invalidateQueries({ \n        queryKey: [\"planning-sessions\", projectId] \n      });\n\n      // Navigate back to project overview\n      router.push(`/project/${projectId}`);\n    } catch (err) {\n      console.error(\"Error ending planning:\", err);\n    } finally {\n      setIsEnding(false);\n      setShowDialog(false);\n    }\n  };\n\n  return (\n    \u003cheader className=\"sticky top-0 z-50 border-b border-border bg-card\"\u003e\n      \u003cdiv className=\"flex h-12 items-center gap-2 px-4\"\u003e\n        \u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n\n        {/* Breadcrumb navigation */}\n        \u003cnav className=\"flex items-center gap-1 text-sm min-w-0 flex-1\"\u003e\n          \u003cLink\n            href={`/project/${projectId}`}\n            className=\"text-muted-foreground hover:text-foreground transition-colors flex-shrink-0\"\n          \u003e\n            {projectName}\n          \u003c/Link\u003e\n          \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n          \u003cspan className=\"text-muted-foreground flex-shrink-0\"\u003ePlanning\u003c/span\u003e\n          \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n          \u003cspan className=\"font-medium truncate\"\u003e\n            #{issueNumber}\n            {issueTitle \u0026\u0026 (\n              \u003cspan className=\"text-muted-foreground font-normal ml-1\"\u003e\n                {issueTitle.length \u003e 40\n                  ? `${issueTitle.slice(0, 40)}...`\n                  : issueTitle}\n              \u003c/span\u003e\n            )}\n          \u003c/span\u003e\n        \u003c/nav\u003e\n\n        {/* Actions */}\n        \u003cdiv className=\"flex items-center gap-2 flex-shrink-0\"\u003e\n          {/* End Planning Button with Confirmation */}\n          \u003cAlertDialog open={showDialog} onOpenChange={setShowDialog}\u003e\n            \u003cAlertDialogTrigger asChild\u003e\n              \u003cButton \n                variant=\"outline\" \n                size=\"sm\" \n                className=\"gap-1.5\"\n                disabled={isEnding}\n              \u003e\n                {isEnding ? (\n                  \u003cLoader2 className=\"h-4 w-4 animate-spin\" /\u003e\n                ) : (\n                  \u003cSquare className=\"h-4 w-4\" /\u003e\n                )}\n                \u003cspan className=\"hidden sm:inline\"\u003eEnd Planning\u003c/span\u003e\n              \u003c/Button\u003e\n            \u003c/AlertDialogTrigger\u003e\n            \u003cAlertDialogContent\u003e\n              \u003cAlertDialogHeader\u003e\n                \u003cAlertDialogTitle\u003eEnd Planning Session\u003c/AlertDialogTitle\u003e\n                \u003cAlertDialogDescription\u003e\n                  This will remove the planning label from issue #{issueNumber} \n                  and move it back to the Issues column.\n                \u003c/AlertDialogDescription\u003e\n              \u003c/AlertDialogHeader\u003e\n              \u003cdiv className=\"py-4\"\u003e\n                \u003cp className=\"text-sm text-muted-foreground\"\u003e\n                  The worktree branch and any uncommitted changes will be preserved.\n                  You can clean these up manually or restart planning later.\n                \u003c/p\u003e\n              \u003c/div\u003e\n              \u003cAlertDialogFooter\u003e\n                \u003cAlertDialogCancel disabled={isEnding}\u003eCancel\u003c/AlertDialogCancel\u003e\n                \u003cAlertDialogAction\n                  onClick={handleEndPlanning}\n                  disabled={isEnding}\n                \u003e\n                  {isEnding ? (\n                    \u003c\u003e\n                      \u003cLoader2 className=\"h-4 w-4 animate-spin mr-2\" /\u003e\n                      Ending...\n                    \u003c/\u003e\n                  ) : (\n                    \"End Planning\"\n                  )}\n                \u003c/AlertDialogAction\u003e\n              \u003c/AlertDialogFooter\u003e\n            \u003c/AlertDialogContent\u003e\n          \u003c/AlertDialog\u003e\n\n          {/* Back to Issue Link */}\n          \u003cLink href={`/project/${projectId}/issue/${issueNumber}`}\u003e\n            \u003cButton variant=\"outline\" size=\"sm\" className=\"gap-1.5\"\u003e\n              \u003cChevronLeft className=\"h-4 w-4\" /\u003e\n              \u003cspan className=\"hidden sm:inline\"\u003eBack to Issue\u003c/span\u003e\n            \u003c/Button\u003e\n          \u003c/Link\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/header\u003e\n  );\n}\n```\n\n## Key Implementation Details\n\n### 1. Cache Invalidation\n\n```typescript\nawait queryClient.invalidateQueries({ queryKey: [\"project-issues\", projectId] });\nawait queryClient.invalidateQueries({ queryKey: [\"planning-sessions\", projectId] });\n```\n\nAfter ending planning:\n- Issue list needs refresh (issue now appears without label)\n- Planning sessions list needs refresh (session no longer active)\n\n### 2. Navigation After Success\n\n```typescript\nrouter.push(`/project/${projectId}`);\n```\n\nAfter successfully ending planning, navigate to project overview where user can:\n- See the issue back in the Issues column\n- Verify planning section no longer shows this session\n\n### 3. Loading State\n\n```typescript\n{isEnding ? (\n  \u003cLoader2 className=\"h-4 w-4 animate-spin\" /\u003e\n) : (\n  \u003cSquare className=\"h-4 w-4\" /\u003e\n)}\n```\n\nButton shows spinner while request is in flight, preventing double-clicks.\n\n### 4. Dialog Stays Open During Request\n\n```typescript\nfinally {\n  setIsEnding(false);\n  setShowDialog(false); // Close AFTER navigation initiated\n}\n```\n\nDialog stays open with loading state until operation completes.\n\n### 5. cleanup: false by Default\n\n```typescript\nbody: JSON.stringify({ cleanup: false }),\n```\n\nWe preserve the worktree and session data. User can:\n- Create a PR from the planning branch later\n- Resume planning if needed\n- Manually clean up when ready\n\n## AlertDialog Component Requirement\n\nThis task requires the `alert-dialog` component from shadcn/ui. Check if it exists:\n\n```bash\nls src/components/ui/alert-dialog.tsx\n```\n\nIf not present, install it:\n\n```bash\nnpx shadcn@latest add alert-dialog\n```\n\n## Dependencies\n\n- **Task 6**: End planning endpoint (this UI calls that endpoint)\n\n## Dependents\n\nNone - this is a leaf task\n\n## Files Changed\n\n- `/src/components/planning/PlanningHeader.tsx` - MAJOR MODIFICATION\n\n## Acceptance Criteria\n\n- [ ] \"End Planning\" button appears in header (right side)\n- [ ] Button shows Square icon normally, Loader2 when processing\n- [ ] Clicking button opens AlertDialog confirmation\n- [ ] Dialog explains what will happen\n- [ ] \"Cancel\" closes dialog, does nothing else\n- [ ] \"End Planning\" in dialog calls endpoint and navigates\n- [ ] Loading state shown during API call\n- [ ] Cache invalidation triggers UI refresh\n- [ ] TypeScript compiles without errors\n\n## UI/UX Details\n\n### Button States\n| State | Icon | Text | Disabled |\n|-------|------|------|----------|\n| Normal | Square | \"End Planning\" | No |\n| Loading | Loader2 (spinning) | \"End Planning\" | Yes |\n\n### Dialog Content\n```\n┌─────────────────────────────────────────┐\n│ End Planning Session                    │\n│─────────────────────────────────────────│\n│ This will remove the planning label     │\n│ from issue #42 and move it back to      │\n│ the Issues column.                      │\n│                                         │\n│ The worktree branch and any uncommitted │\n│ changes will be preserved. You can      │\n│ clean these up manually or restart      │\n│ planning later.                         │\n│                                         │\n│                    [Cancel] [End Planning] │\n└─────────────────────────────────────────┘\n```\n\n### Mobile Responsive\n- Button text \"End Planning\" hidden on small screens (sm:inline)\n- Icon always visible\n- Dialog is full-width on mobile (shadcn default)\n\n## Testing\n\n### Manual Test Steps\n\n1. Navigate to a planning session page\n2. Verify \"End Planning\" button is visible in header\n3. Click button, verify dialog appears\n4. Click \"Cancel\", verify dialog closes and nothing happens\n5. Click \"End Planning\" again\n6. Click \"End Planning\" in dialog\n7. Verify loading spinner appears\n8. Verify navigation to project overview\n9. Verify issue appears in Issues column (not Planning)\n10. Verify issue no longer has maestro:planning label in GitHub\n\n### Edge Cases\n\n1. **Network error**: Button returns to normal, error logged\n2. **Double click**: Disabled state prevents duplicate requests\n3. **Navigate away mid-request**: Request completes in background\n\n## Verification Commands\n\n```bash\n# Check AlertDialog component exists\nls src/components/ui/alert-dialog.tsx\n\n# Check for Square icon import\ngrep \"Square\" src/components/planning/PlanningHeader.tsx\n\n# Check for useQueryClient\ngrep \"useQueryClient\" src/components/planning/PlanningHeader.tsx\n\n# TypeScript check\nnpx tsc --noEmit\n```","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T06:43:04.084613-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5sl.8","title":"Verify TypeScript compilation and run integration tests","description":"## Task Overview\n\nRun TypeScript compilation and verify the build succeeds after all previous tasks are complete. This is a verification task that ensures all changes integrate correctly.\n\n## Implementation\n\n### Step 1: TypeScript Check\n\n```bash\nnpx tsc --noEmit\n```\n\n### Step 2: Next.js Build\n\n```bash\nnpm run build\n```\n\n### Step 3: Lint Check\n\n```bash\nnpm run lint\n```\n\n### Step 4: Verify New Files Exist\n\n```bash\n# Constants file\ntest -f src/lib/constants.ts \u0026\u0026 echo \"✓ constants.ts exists\"\n\n# GitHub labels service\ntest -f src/lib/services/github-labels.ts \u0026\u0026 echo \"✓ github-labels.ts exists\"\n\n# End planning endpoint\ntest -f \"src/app/api/projects/[id]/planning/[issueNumber]/end/route.ts\" \u0026\u0026 echo \"✓ end route exists\"\n\n# Alert dialog component\ntest -f src/components/ui/alert-dialog.tsx \u0026\u0026 echo \"✓ alert-dialog.tsx exists\"\n```\n\n## Checklist of Expected Changes\n\n### New Files (4)\n- [ ] `/src/lib/constants.ts`\n- [ ] `/src/lib/services/github-labels.ts`\n- [ ] `/src/app/api/projects/[id]/planning/[issueNumber]/end/route.ts`\n- [ ] `/src/components/ui/alert-dialog.tsx` (from shadcn)\n\n### Modified Files (4)\n- [ ] `/src/app/api/projects/[id]/planning/[issueNumber]/start/route.ts` - Added label\n- [ ] `/src/components/app-sidebar.tsx` - Filtering\n- [ ] `/src/app/project/[id]/page.tsx` - Filtering\n- [ ] `/src/components/planning/PlanningHeader.tsx` - End button\n\n## Dependencies\n\n- **Tasks 1-7, 9, 10**: All previous tasks must be complete\n\n## Acceptance Criteria\n\n- [ ] `npx tsc --noEmit` passes with no errors\n- [ ] `npm run build` completes successfully\n- [ ] `npm run lint` passes (warnings OK)\n- [ ] All 4 new files exist\n- [ ] All 4 modified files have expected changes\n\n## Manual Integration Test\n\nAfter all automated checks pass, perform a quick manual test:\n\n1. Start dev server: `npm run dev`\n2. Navigate to project with issues\n3. Verify issues display correctly\n4. Start planning on an issue\n5. Check GitHub for label\n6. Verify issue moves to Planning section\n7. Click \"End Planning\" in planning header\n8. Confirm dialog and proceed\n9. Verify issue returns to Issues section\n10. Check GitHub - label should be removed","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-02T06:43:39.316887-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5sl.9","title":"Install shadcn alert-dialog component","description":"## Task Overview\n\nInstall the `alert-dialog` component from shadcn/ui. This is a prerequisite for Task 7 (End Planning button).\n\n## Implementation\n\nRun this single command:\n\n```bash\nnpx shadcn@latest add alert-dialog\n```\n\nThis will create:\n- `/src/components/ui/alert-dialog.tsx`\n\n## Dependencies\n\n- **None** - This is a standalone installation task\n\n## Dependents\n\n- **Task 7**: Add End Planning button (uses AlertDialog component)\n\n## Verification\n\n```bash\n# Verify file was created\ntest -f src/components/ui/alert-dialog.tsx \u0026\u0026 echo '✓ alert-dialog.tsx exists'\n\n# Verify exports\ngrep -q 'AlertDialog' src/components/ui/alert-dialog.tsx \u0026\u0026 echo '✓ AlertDialog exported'\n```\n\n## Acceptance Criteria\n\n- [ ] File `src/components/ui/alert-dialog.tsx` exists\n- [ ] Component can be imported as shown in Task 7","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T06:47:21.461463-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh","title":"Issue #7: Prompt-First Issue Creation Flow","description":"# Overview\n\nTransform the \"New Issue\" dialog from a title-centric form to a prompt-first experience where users describe what they want to build, and an AI agent creates a properly-structured GitHub issue on their behalf.\n\n## Background \u0026 Motivation\n\nThe current flow requires users to craft a good issue title upfront - a cognitive burden that interrupts the creative flow. Users often know WHAT they want to build but struggle to articulate it as a concise title. This creates friction:\n\n1. **Cognitive overhead**: Users must mentally formalize their idea into a title before they can start\n2. **Title/description mismatch**: The title is written before the full context is explored, leading to vague or outdated titles\n3. **Lost context**: Users often have rich context in their heads that never makes it to the issue description\n\n## Proposed Solution\n\nInvert the flow: let users describe their idea naturally (as a prompt), then have an AI agent:\n1. Explore and understand the request in the context of the codebase\n2. Generate both a clear title AND comprehensive description\n3. Update the GitHub issue with proper structure\n\nThis aligns with Maestro's ideation-first philosophy (see SCOPE.md) where conversation leads to formalization, not the other way around.\n\n## Technical Approach\n\n### Frontend (NewIssueDialog.tsx)\n- Replace the single-line `Input` with a multi-line `Textarea`\n- Change state/props from `title` to `prompt`\n- Update placeholder text to guide natural language input\n- Send `{ prompt, projectPath }` to backend\n\n### Backend (issues/route.ts POST handler)\nThe backend orchestrates a multi-step flow:\n1. **Create placeholder issue** - Use `gh issue create` with truncated prompt as initial title\n2. **Create OpenCode session** - This becomes the \"discussion session\" for this issue\n3. **Inject context** - System instructions telling the agent to update the issue\n4. **Send user prompt** - Fire and forget via `sendMessageWithBashAsync`\n5. **Save session mapping** - Link session to issue for future access\n6. **Return immediately** - User navigates to issue page where they see live updates\n\n### Key Design Decisions\n\n1. **Why create issue BEFORE agent explores?**\n   - User can navigate immediately (shows progress)\n   - Issue number is available for agent instructions\n   - Failure path is clearer (issue exists but needs updating vs. nothing exists)\n\n2. **Why use `sendMessageWithBashAsync`?**\n   - Non-blocking: Backend returns immediately\n   - Bash enabled: Agent can run `gh issue edit`\n   - File editing disabled: Agent shouldn't modify code during this ideation phase\n\n3. **Why link session to issue?**\n   - Issue page can show the ongoing conversation\n   - User sees live streaming of agent's exploration\n   - Natural continuation when user wants to add more context\n\n## Acceptance Criteria\n- [ ] Modal shows single \"Prompt\" textarea instead of \"Title\" input\n- [ ] Prompt textarea has appropriate placeholder and minimum height\n- [ ] GitHub issue is created immediately with placeholder body\n- [ ] OpenCode session is created and linked to the issue\n- [ ] Agent receives context instructing it to update title AND description\n- [ ] Agent updates issue via `gh issue edit` with both `--title` and `--body`\n- [ ] User is navigated to issue page after creation\n- [ ] Session is saved so issue page shows the conversation\n\n## Dependencies\n- OpenCode service with `sendMessageWithBashAsync` (already exists)\n- Session storage service (already exists)\n- GitHub CLI installed and authenticated\n\n## Files Affected\n- `src/components/new-issue-dialog/NewIssueDialog.tsx`\n- `src/app/api/projects/[id]/issues/route.ts`","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-31T10:04:33.992386-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-5zh.1","title":"1.1 Update NewIssueDialog UI - Replace Input with Textarea","description":"# Task: Replace Input with Textarea in NewIssueDialog\n\n## What to Do\nReplace the single-line `Input` component with a multi-line `Textarea` component for the prompt field.\n\n## Why\nA prompt/description is typically longer than a title. Users need visual space to express their idea fully. A textarea signals \"write more\" while an input signals \"keep it short.\"\n\n## Implementation Details\n```tsx\n// Current (line ~97-105):\n\u003cInput\n  id=\"issue-title\"\n  value={title}\n  onChange={(e) =\u003e setTitle(e.target.value)}\n  placeholder=\"What would you like to explore?\"\n  className=\"mt-2\"\n  autoFocus\n  disabled={isCreating}\n/\u003e\n\n// Change to:\n\u003cTextarea\n  id=\"issue-prompt\"\n  value={prompt}\n  onChange={(e) =\u003e setPrompt(e.target.value)}\n  placeholder=\"Describe what you want to build or explore...\"\n  className=\"mt-2 min-h-[100px] resize-none\"\n  autoFocus\n  disabled={isCreating}\n/\u003e\n```\n\n## Considerations\n- Import `Textarea` from `@/components/ui/textarea`\n- Remove unused `Input` import if no longer needed\n- `min-h-[100px]` gives adequate initial size\n- `resize-none` prevents awkward dialog resizing (optional - may want to allow resize-y)\n\n## Acceptance\n- Textarea renders in place of Input\n- Textarea has appropriate minimum height\n- User can type multi-line content","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:04:34.046005-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.10","title":"2.7 Backend: Save session mapping for issue page access","description":"# Task: Backend - Save Session Mapping\n\n## What to Do\nUse `sessionStorage.saveSession()` to link the OpenCode session to the GitHub issue.\n\n## Why\n- Issue page needs to know which session to display\n- Enables \"continue conversation\" on the issue page\n- Persists across server restarts (stored in `~/.maestro/sessions.json`)\n\n## Implementation Details\n```typescript\n// Add import at top:\nimport { sessionStorage } from \"@/lib/services/sessions\";\n\n// After sending the prompt:\nawait sessionStorage.saveSession(\n  id,           // projectId (from params)\n  cwd,          // projectPath\n  issueNumber,  // GitHub issue number\n  session.id    // OpenCode session ID\n);\n```\n\n## Looking at sessions.ts\n\nThe `saveSession` method (lines 90-124):\n- Creates/updates a mapping in `~/.maestro/sessions.json`\n- Sets `sessionType: 'discussion'` (vs 'planning')\n- Records timestamps for auditing\n- Uses atomic writes (temp file + rename)\n\n## What Gets Stored\n```json\n{\n  \"projectId\": \"abc-123\",\n  \"projectPath\": \"/path/to/repo\",\n  \"issueNumber\": 42,\n  \"sessionId\": \"session-xyz\",\n  \"sessionType\": \"discussion\",\n  \"createdAt\": \"2024-...\",\n  \"lastAccessedAt\": \"2024-...\"\n}\n```\n\n## Issue Page Integration\n\nThe issue page (`page.tsx`) uses `useChatSession` hook which:\n1. Calls `GET /api/projects/[id]/issues/[issueNumber]/chat/session`\n2. That endpoint looks up the session via `sessionStorage.getSession()`\n3. Returns the session ID for SSE subscription\n\nThis is already implemented! We just need to save the mapping.\n\n## Acceptance\n- Session mapping is persisted to disk\n- Issue page can retrieve the session ID\n- Conversation displays on issue page","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:04:34.544006-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.11","title":"3.1 Verify issue page displays ongoing agent conversation","description":"# Task: Verify Issue Page Displays Conversation\n\n## What to Do\nManually test that the issue page shows the ongoing agent conversation after creating an issue.\n\n## Why\n- The issue page has existing infrastructure for displaying sessions\n- We need to verify the new flow integrates correctly\n- May uncover edge cases or bugs\n\n## Test Scenario\n1. Create a new issue using the updated prompt flow\n2. Get redirected to issue page\n3. Verify:\n   - Agent conversation streams in real-time\n   - Tool calls are visible (file reads, searches)\n   - Agent's `gh issue edit` command is visible\n   - Issue details panel updates when agent edits\n\n## What to Look For\n\n### Issue Page Behavior (from page.tsx analysis)\n- `useChatSession` hook connects to SSE stream\n- Messages render via `toAIElementsMessages()` adapter\n- Tool calls show with expand/collapse UI\n- `onIssueUpdated` callback refreshes issue details\n\n### Potential Issues\n1. Session not found → Empty chat, \"Start a conversation\" message\n2. SSE connection fails → Reconnecting toast shows\n3. Agent output too fast → Messages may batch/flicker\n\n## Code References\n- Issue page: `src/app/project/[id]/issue/[issueNumber]/page.tsx:157-183` (useChatSession hook)\n- Chat session endpoint: `src/app/api/projects/[id]/issues/[issueNumber]/chat/session/route.ts`\n\n## Acceptance\n- Conversation streams in real-time on issue page\n- Tool executions are visible\n- Issue updates reflect in the details panel","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T10:04:34.601375-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.12","title":"3.2 Test end-to-end flow: prompt → issue creation → agent update","description":"# Task: End-to-End Test\n\n## What to Do\nComprehensive manual test of the complete flow.\n\n## Test Script\n\n### Setup\n- OpenCode server running (`opencode serve`)\n- GitHub CLI authenticated (`gh auth status`)\n- Maestro dev server running (`npm run dev`)\n\n### Test Case 1: Basic Flow\n1. Open project in Maestro\n2. Click \"+ New Idea\" (or however the dialog is triggered)\n3. Enter prompt: \"Add a dark mode toggle to the settings page that persists the user's preference in localStorage\"\n4. Click \"Create Issue\"\n5. **Verify**: Redirected to issue page\n6. **Verify**: Issue shows with placeholder body (\"Generating description...\")\n7. **Verify**: Agent conversation streams in\n8. **Wait**: Agent explores and runs `gh issue edit`\n9. **Verify**: Issue title and body update to structured content\n\n### Test Case 2: Long Prompt\n1. Enter a very long prompt (200+ chars)\n2. Create issue\n3. **Verify**: Initial title is truncated with \"...\"\n4. **Verify**: Agent creates better title from full context\n\n### Test Case 3: Ambiguous Prompt\n1. Enter: \"make it faster\"\n2. Create issue\n3. **Verify**: Agent asks clarifying questions before updating issue\n\n### Test Case 4: Error Recovery\n1. Stop OpenCode server\n2. Try to create issue\n3. **Verify**: Error message displayed\n4. Start OpenCode server\n5. Retry\n6. **Verify**: Works correctly\n\n## Acceptance\n- All test cases pass\n- No regressions in existing functionality\n- UX feels smooth and responsive","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T10:04:34.656716-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.13","title":"3.3 Error handling: OpenCode service unavailable","description":"# Task: Error Handling - OpenCode Unavailable\n\n## What to Do\nHandle the case where OpenCode service is not running or unreachable.\n\n## Why\n- OpenCode is an external dependency that may not always be running\n- Users need clear feedback, not cryptic errors\n- System should degrade gracefully\n\n## Implementation Details\n\n### Option A: Pre-flight Health Check\n```typescript\n// Before creating issue:\nconst isHealthy = await openCodeService.isHealthy();\nif (!isHealthy) {\n  return NextResponse.json(\n    { error: \"OpenCode service is not running. Start it with 'opencode serve'.\" },\n    { status: 503 }\n  );\n}\n```\n\n### Option B: Catch and Handle (Preferred)\n```typescript\ntry {\n  const session = await openCodeService.createSession(cwd, sessionTitle);\n  // ... rest of flow\n} catch (err) {\n  // Issue was already created - return partial success\n  console.error(\"Failed to create OpenCode session:\", err);\n  \n  // Still return the issue, but with a warning\n  return NextResponse.json({\n    ...issue,\n    warning: \"Issue created but AI session failed. You can chat with the agent on the issue page.\",\n  }, { status: 201 });\n}\n```\n\n## Considerations\n\n### Why Option B?\n- Issue is already created - don't hide that success\n- User can still work with the issue\n- Issue page will handle session creation if needed\n\n### Frontend Handling\nThe frontend should display warnings if present:\n```tsx\nif (data.warning) {\n  // Show toast or banner\n}\n```\n\n## Acceptance\n- OpenCode unavailable doesn't block issue creation\n- User gets clear feedback about what worked/failed\n- System recovers gracefully when OpenCode comes back","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T10:04:34.712687-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.14","title":"3.4 Error handling: Session creation fails after issue created","description":"# Task: Error Handling - Session Creation Fails After Issue Created\n\n## What to Do\nHandle partial failure where issue is created but subsequent steps fail.\n\n## Why\n- The flow has multiple external calls that can fail independently\n- Users shouldn't lose work if one step fails\n- Clear error states enable recovery\n\n## Failure Points After Issue Creation\n\n1. **Session creation fails** → Handled in 3.3\n2. **Context injection fails** → Agent won't have instructions\n3. **Prompt sending fails** → Agent won't process\n4. **Session save fails** → Issue page won't find session\n\n## Implementation Strategy\n\nWrap the post-issue-creation steps in try/catch and return partial success:\n\n```typescript\n// After successful issue creation:\nlet sessionWarning: string | undefined;\n\ntry {\n  // Create session\n  const session = await openCodeService.createSession(cwd, sessionTitle);\n  \n  // Inject context\n  await openCodeService.injectContext(cwd, session.id, contextPrompt);\n  \n  // Send user prompt\n  await openCodeService.sendMessageWithBashAsync(cwd, session.id, userPrompt);\n  \n  // Save mapping\n  await sessionStorage.saveSession(id, cwd, issueNumber, session.id);\n} catch (err) {\n  console.error(\"Post-issue-creation error:\", err);\n  sessionWarning = \"Issue created but AI setup failed. Visit the issue page to start a conversation.\";\n}\n\n// Always return the issue\nreturn NextResponse.json({\n  ...issue,\n  ...(sessionWarning \u0026\u0026 { warning: sessionWarning }),\n}, { status: 201 });\n```\n\n## Frontend Behavior\n\nThe issue page has fallback behavior:\n- If no session exists, shows \"Start a conversation\" prompt\n- User can send first message, which creates a new session\n- Not ideal, but recoverable\n\n## Acceptance\n- Partial failures don't crash the request\n- Issue is always returned if created\n- Warning communicates what failed\n- User can recover via issue page","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T10:04:34.766797-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.15","title":"Frontend: Convert NewIssueDialog to prompt-first UX","description":"# Frontend: Convert NewIssueDialog to Prompt-First UX\n\n## Overview\nTransform the dialog from a title-input form to a prompt-textarea experience.\n\n## File to Modify\n`src/components/new-issue-dialog/NewIssueDialog.tsx`\n\n## Changes Required\n\n### 1. Import Changes\n```tsx\n// Remove:\nimport { Input } from \"@/components/ui/input\";\n\n// Add:\nimport { Textarea } from \"@/components/ui/textarea\";\n```\n\n### 2. State Rename\n```tsx\n// Line 32 - Change from:\nconst [title, setTitle] = useState(\"\");\n\n// To:\nconst [prompt, setPrompt] = useState(\"\");\n```\n\n### 3. Validation Update\n```tsx\n// Line 39 - Change from:\nif (!title.trim()) return;\n\n// To:\nif (!prompt.trim()) return;\n```\n\n### 4. Request Body\n```tsx\n// Lines 48-51 - Change from:\nbody: JSON.stringify({ \n  title: title.trim(),\n  projectPath,\n}),\n\n// To:\nbody: JSON.stringify({ \n  prompt: prompt.trim(),\n  projectPath,\n}),\n```\n\n### 5. Reset State\n```tsx\n// Line 63 and 77 - Change from:\nsetTitle(\"\");\n\n// To:\nsetPrompt(\"\");\n```\n\n### 6. Dialog Description\n```tsx\n// Line 88-89 - Change from:\n\u003cDialogDescription\u003e\n  Create a new GitHub issue to start exploring an idea with the agent.\n\u003c/DialogDescription\u003e\n\n// To:\n\u003cDialogDescription\u003e\n  Describe what you want to build. The agent will create a structured GitHub issue.\n\u003c/DialogDescription\u003e\n```\n\n### 7. Label\n```tsx\n// Line 94 - Change from:\n\u003cLabel htmlFor=\"issue-title\" className=\"text-sm font-medium\"\u003e\n  Title\n\u003c/Label\u003e\n\n// To:\n\u003cLabel htmlFor=\"issue-prompt\" className=\"text-sm font-medium\"\u003e\n  Prompt\n\u003c/Label\u003e\n```\n\n### 8. Input → Textarea\n```tsx\n// Lines 97-105 - Change from:\n\u003cInput\n  id=\"issue-title\"\n  value={title}\n  onChange={(e) =\u003e setTitle(e.target.value)}\n  placeholder=\"What would you like to explore?\"\n  className=\"mt-2\"\n  autoFocus\n  disabled={isCreating}\n/\u003e\n\n// To:\n\u003cTextarea\n  id=\"issue-prompt\"\n  value={prompt}\n  onChange={(e) =\u003e setPrompt(e.target.value)}\n  placeholder=\"Describe what you want to build or explore...\"\n  className=\"mt-2 min-h-[100px]\"\n  autoFocus\n  disabled={isCreating}\n/\u003e\n```\n\n### 9. Submit Button Validation\n```tsx\n// Line 120 - Change from:\ndisabled={!title.trim() || isCreating}\n\n// To:\ndisabled={!prompt.trim() || isCreating}\n```\n\n## Acceptance Criteria\n- [ ] Textarea displays instead of Input\n- [ ] Minimum height of 100px for comfortable multi-line input\n- [ ] Label says \"Prompt\" not \"Title\"\n- [ ] Dialog description guides user to describe their idea\n- [ ] Form submits `{ prompt, projectPath }` to backend\n- [ ] Empty prompt validation prevents submission","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:17:09.202103-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.16","title":"Backend: Implement prompt-to-issue flow with agent session","description":"# Backend: Implement Prompt-to-Issue Flow with Agent Session\n\n## Overview\nModify the POST `/api/projects/[id]/issues` endpoint to:\n1. Accept `prompt` instead of `title`\n2. Create a placeholder GitHub issue immediately\n3. Spawn an OpenCode agent session to refine the issue\n4. Return quickly so user can see live progress\n\n## File to Modify\n`src/app/api/projects/[id]/issues/route.ts`\n\n## Implementation\n\n### 1. Add Imports\n```typescript\nimport { openCodeService } from \"@/lib/services/opencode\";\nimport { sessionStorage } from \"@/lib/services/sessions\";\n```\n\n### 2. Helper Function - Generate Initial Title\n```typescript\n/**\n * Generate an initial issue title from the user's prompt.\n * Truncates to 80 chars max, breaking at word boundaries.\n */\nfunction generateInitialTitle(prompt: string): string {\n  const maxLength = 80;\n  const trimmed = prompt.trim();\n  \n  if (trimmed.length \u003c= maxLength) {\n    return trimmed;\n  }\n  \n  const truncated = trimmed.substring(0, maxLength);\n  const lastSpace = truncated.lastIndexOf(' ');\n  \n  // Break at word boundary if possible (in last 40%)\n  if (lastSpace \u003e maxLength * 0.6) {\n    return truncated.substring(0, lastSpace) + \"...\";\n  }\n  \n  return truncated.substring(0, maxLength - 3) + \"...\";\n}\n```\n\n### 3. Update POST Handler\n\nReplace the existing POST handler logic:\n\n```typescript\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise\u003c{ id: string }\u003e }\n) {\n  try {\n    const { id } = await params;\n    const body = await request.json();\n    \n    // Support both prompt (new) and title (backwards compat)\n    const { prompt, title } = body;\n    const userPrompt = prompt || title;\n\n    if (!userPrompt || typeof userPrompt !== \"string\") {\n      return NextResponse.json(\n        { error: \"Prompt is required\" }, \n        { status: 400 }\n      );\n    }\n\n    // Get project\n    const project = await configService.getProject(id);\n    if (!project) {\n      return NextResponse.json({ error: \"Project not found\" }, { status: 404 });\n    }\n    const cwd = project.path;\n\n    // Generate initial title from prompt\n    const initialTitle = generateInitialTitle(userPrompt);\n    const escapedTitle = initialTitle.replace(/\"/g, '\\\\\"');\n    const placeholderBody = \"_Generating description..._\";\n\n    // Create GitHub issue with placeholder\n    const { stdout: createStdout, stderr: createStderr } = await execAsync(\n      `gh issue create --title \"${escapedTitle}\" --body \"${placeholderBody}\"`,\n      { cwd }\n    );\n\n    // Extract issue number from URL\n    const output = createStdout || createStderr;\n    const urlMatch = output.match(/issues\\/(\\d+)/);\n    if (!urlMatch) {\n      throw new Error(\"Failed to parse created issue URL\");\n    }\n    const issueNumber = parseInt(urlMatch[1]);\n\n    // Fetch created issue details\n    const { stdout: issueStdout } = await execAsync(\n      `gh issue view ${issueNumber} --json number,title,body,state,url,createdAt,author,labels`,\n      { cwd }\n    );\n    const issue: GitHubIssue = JSON.parse(issueStdout);\n\n    // Create OpenCode session and send prompt (non-blocking errors)\n    let sessionWarning: string | undefined;\n    try {\n      const session = await openCodeService.createSession(\n        cwd,\n        `Issue #${issueNumber}: ${initialTitle.substring(0, 50)}`\n      );\n\n      // Inject context with instructions\n      await openCodeService.injectContext(cwd, session.id, `\nYou are helping with GitHub issue #${issueNumber} in this repository.\n\nThe user has described what they want. Your job is to:\n1. Understand their request (explore codebase if needed)\n2. Update the GitHub issue with a clear title and structured description\n\nWhen ready, run this command:\n\\`\\`\\`bash\ngh issue edit ${issueNumber} --title \"Clear, imperative title\" --body \"$(cat \u003c\u003c'ISSUE_BODY'\n## Summary\nBrief description of what this implements/fixes.\n\n## Requirements\n- Requirement 1\n- Requirement 2\n\n## Technical Approach\nHow this should be implemented.\n\n## Open Questions\nAny uncertainties to resolve.\nISSUE_BODY\n)\"\n\\`\\`\\`\n\nGuidelines:\n- Title: Short, imperative mood (e.g., \"Add dark mode toggle\")\n- Body: Use markdown sections as shown above\n- Ask clarifying questions if the request is ambiguous\n`);\n\n      // Send user's prompt (fire and forget)\n      await openCodeService.sendMessageWithBashAsync(cwd, session.id, userPrompt);\n\n      // Save session mapping for issue page\n      await sessionStorage.saveSession(id, cwd, issueNumber, session.id);\n      \n    } catch (err) {\n      console.error(\"Failed to setup AI session:\", err);\n      sessionWarning = \"Issue created but AI session setup failed. You can start a conversation on the issue page.\";\n    }\n\n    return NextResponse.json({\n      ...issue,\n      ...(sessionWarning \u0026\u0026 { warning: sessionWarning }),\n    }, { status: 201 });\n\n  } catch (error) {\n    // ... existing error handling ...\n  }\n}\n```\n\n## Key Design Decisions\n\n### Why create issue BEFORE agent?\n- User gets immediate feedback (navigates to issue page)\n- Issue number is known for agent instructions\n- Partial success is better than total failure\n\n### Why `sendMessageWithBashAsync`?\n- Non-blocking: API returns immediately\n- Bash enabled: Agent can run `gh issue edit`\n- Write/Edit disabled: No code changes during ideation\n\n### Why wrap session setup in try/catch?\n- Issue creation succeeding is the primary goal\n- Session failure is recoverable (user can chat on issue page)\n- Returns warning so frontend can inform user\n\n## Acceptance Criteria\n- [ ] `POST { prompt: \"...\" }` creates issue with truncated title\n- [ ] `POST { title: \"...\" }` still works (backwards compat)\n- [ ] Issue body shows \"_Generating description..._\"\n- [ ] OpenCode session is created and receives prompt\n- [ ] Session is saved for issue page access\n- [ ] API returns quickly (doesn't wait for agent)\n- [ ] Graceful degradation if OpenCode is unavailable","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:17:41.498821-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.17","title":"Verify: End-to-end flow and issue page integration","description":"# Verification: End-to-End Flow and Issue Page Integration\n\n## Purpose\nVerify the complete flow works as expected after frontend and backend changes.\n\n## Prerequisites\n- OpenCode server running (`opencode serve`)\n- GitHub CLI authenticated (`gh auth status`)\n- Maestro dev server running (`npm run dev`)\n\n## Test Cases\n\n### Test 1: Basic Flow\n1. Open a project in Maestro\n2. Click \"+ New Idea\" to open NewIssueDialog\n3. Enter: \"Add a dark mode toggle to the settings page\"\n4. Click \"Create Issue\"\n\n**Expected:**\n- [ ] Redirected to issue page immediately\n- [ ] Issue shows with body \"_Generating description..._\"\n- [ ] Agent conversation streams in the chat panel\n- [ ] Agent explores codebase (may see file read tool calls)\n- [ ] Agent runs `gh issue edit` (visible in tool calls)\n- [ ] Issue details panel refreshes to show updated title/body\n\n### Test 2: Long Prompt\n1. Enter a 200+ character prompt\n2. Create issue\n\n**Expected:**\n- [ ] Initial title is truncated with \"...\"\n- [ ] Agent creates a better title from full context\n\n### Test 3: Vague Prompt\n1. Enter: \"make it better\"\n2. Create issue\n\n**Expected:**\n- [ ] Agent asks clarifying questions instead of immediately updating\n- [ ] User can respond in the chat\n- [ ] Agent updates issue after getting clarity\n\n### Test 4: OpenCode Unavailable\n1. Stop OpenCode server (`pkill opencode` or Ctrl+C)\n2. Try to create an issue\n\n**Expected:**\n- [ ] Issue IS created (gh CLI still works)\n- [ ] Response includes `warning` field\n- [ ] User sees warning message\n- [ ] Issue page shows \"Start a conversation\" (no session found)\n- [ ] User can manually start chat which creates new session\n\n### Test 5: Session Persistence\n1. Create an issue with the new flow\n2. Refresh the page\n3. Navigate away and back to the issue\n\n**Expected:**\n- [ ] Conversation persists across refreshes\n- [ ] Session mapping in `~/.maestro/sessions.json` is correct\n\n## Code Paths to Verify\n\n### Frontend\n- `NewIssueDialog.tsx` submits `{ prompt, projectPath }`\n- Navigation to `/project/[id]/issue/[issueNumber]` works\n\n### Backend\n- `route.ts` POST handler extracts `prompt`\n- `generateInitialTitle()` truncates correctly\n- `gh issue create` uses placeholder body\n- OpenCode session created with correct context\n- `sessionStorage.saveSession()` persists mapping\n\n### Issue Page\n- `useChatSession` hook finds saved session\n- SSE stream connects and shows messages\n- `onIssueUpdated` callback refreshes issue details\n\n## Known Limitations\n- Agent may take 10-30 seconds to update issue (depends on model)\n- Very large codebases may slow down agent exploration\n- Rate limits on GitHub API could affect `gh issue edit`\n\n## Sign-off\n- [ ] All test cases pass\n- [ ] No console errors\n- [ ] UX feels responsive and clear","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2025-12-31T10:18:02.609089-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"chore"}
{"id":"maestro-5zh.2","title":"1.2 Update NewIssueDialog state - title → prompt","description":"# Task: Update State from title to prompt\n\n## What to Do\nRename the state variable from `title` to `prompt` throughout the component.\n\n## Why\nSemantic clarity. The variable name should reflect what it holds. A \"prompt\" is user input for an AI, while a \"title\" is a label for an issue.\n\n## Implementation Details\n```tsx\n// Current (line 32):\nconst [title, setTitle] = useState(\"\");\n\n// Change to:\nconst [prompt, setPrompt] = useState(\"\");\n```\n\nAlso update:\n- Line 39: `if (!title.trim()) return;` → `if (!prompt.trim()) return;`\n- Line 63: `setTitle(\"\");` → `setPrompt(\"\");`\n- Line 77: `setTitle(\"\");` → `setPrompt(\"\");`\n- Line 120: `disabled={!title.trim() || isCreating}` → `disabled={!prompt.trim() || isCreating}`\n\n## Considerations\n- This is a refactor - no behavioral change expected\n- The form validation logic remains the same (must have non-empty input)\n\n## Acceptance\n- No references to `title` or `setTitle` remain in the component\n- Form validation still prevents submission of empty input","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:04:34.102547-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.3","title":"1.3 Update form submission to send prompt in request body","description":"# Task: Update Form Submission to Send prompt\n\n## What to Do\nChange the request body from `{ title, projectPath }` to `{ prompt, projectPath }`.\n\n## Why\nThe backend will use `prompt` to:\n1. Generate an initial title (via truncation)\n2. Pass to the AI agent for exploration\n\n## Implementation Details\n```tsx\n// Current (lines 48-51):\nbody: JSON.stringify({ \n  title: title.trim(),\n  projectPath,\n}),\n\n// Change to:\nbody: JSON.stringify({ \n  prompt: prompt.trim(),\n  projectPath,\n}),\n```\n\n## Label Update\nAlso update the label text (line 94):\n```tsx\n// Current:\n\u003cLabel htmlFor=\"issue-title\" className=\"text-sm font-medium\"\u003e\n  Title\n\u003c/Label\u003e\n\n// Change to:\n\u003cLabel htmlFor=\"issue-prompt\" className=\"text-sm font-medium\"\u003e\n  Prompt\n\u003c/Label\u003e\n```\n\n## Dialog Description Update\nOptionally update the dialog description (line 88-89):\n```tsx\n// Current:\n\u003cDialogDescription\u003e\n  Create a new GitHub issue to start exploring an idea with the agent.\n\u003c/DialogDescription\u003e\n\n// Consider:\n\u003cDialogDescription\u003e\n  Describe what you want to build. The agent will create a structured issue.\n\u003c/DialogDescription\u003e\n```\n\n## Acceptance\n- Network request sends `prompt` instead of `title`\n- UI labels reflect the new field purpose","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:04:34.157322-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.4","title":"2.1 Backend: Extract prompt from request body (with backwards compat)","description":"# Task: Backend - Extract prompt from Request Body\n\n## What to Do\nUpdate the POST handler to extract `prompt` from the request body, with backwards compatibility for `title`.\n\n## Why\n- New frontend sends `prompt`\n- Old clients might still send `title`\n- Graceful migration prevents breaking changes\n\n## Implementation Details\n```typescript\n// Current (line 88):\nconst { title } = body;\n\n// Change to:\nconst { prompt, title } = body;\n\n// Use prompt if provided, fall back to title for backwards compatibility\nconst userPrompt = prompt || title;\n\nif (!userPrompt || typeof userPrompt !== \"string\") {\n  return NextResponse.json(\n    { error: \"Prompt or title is required\" }, \n    { status: 400 }\n  );\n}\n```\n\n## Considerations\n- This enables rolling deployments (frontend can update before backend or vice versa)\n- Once fully migrated, the `title` fallback can be removed (tech debt)\n\n## Acceptance\n- Request with `{ prompt: \"...\" }` works\n- Request with `{ title: \"...\" }` works (backwards compat)\n- Request with neither returns 400 error","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:04:34.21089-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.5","title":"2.2 Backend: Generate initial title from prompt (truncation logic)","description":"# Task: Backend - Generate Initial Title from Prompt\n\n## What to Do\nCreate a helper function to generate a sensible initial title from the user's prompt.\n\n## Why\nGitHub issues need a title. We create one immediately from the prompt so the issue exists before the agent finishes exploring. The agent will later update it with something better.\n\n## Implementation Details\n```typescript\n/**\n * Generate an initial issue title from the user's prompt.\n * Truncates to 80 chars max, breaking at word boundaries when possible.\n */\nfunction generateInitialTitle(prompt: string): string {\n  const maxLength = 80;\n  const trimmed = prompt.trim();\n  \n  // If short enough, use as-is\n  if (trimmed.length \u003c= maxLength) {\n    return trimmed;\n  }\n  \n  // Try to break at a word boundary\n  const truncated = trimmed.substring(0, maxLength);\n  const lastSpace = truncated.lastIndexOf(' ');\n  \n  if (lastSpace \u003e maxLength * 0.6) {\n    // Found a space in the last 40% - break there\n    return truncated.substring(0, lastSpace) + \"...\";\n  }\n  \n  // No good break point, hard truncate\n  return truncated.substring(0, maxLength - 3) + \"...\";\n}\n```\n\n## Usage\n```typescript\nconst initialTitle = generateInitialTitle(userPrompt);\n```\n\n## Considerations\n- 80 chars is a reasonable GitHub title length\n- Word boundary breaks look more natural than mid-word truncation\n- The \"...\" suffix signals incompleteness (agent will update)\n\n## Acceptance\n- Short prompts used as-is\n- Long prompts truncated at ~80 chars\n- Truncation prefers word boundaries","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:04:34.265888-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.6","title":"2.3 Backend: Create issue with placeholder body","description":"# Task: Backend - Create Issue with Placeholder Body\n\n## What to Do\nUpdate the `gh issue create` command to include a placeholder body that indicates work is in progress.\n\n## Why\n- Empty body looks broken\n- Placeholder communicates to anyone viewing the issue that content is coming\n- Sets expectations for the agent's upcoming edit\n\n## Implementation Details\n```typescript\n// Current (lines 105-109):\nconst escapedTitle = title.replace(/\"/g, '\\\\\"');\nconst { stdout: createStdout, stderr: createStderr } = await execAsync(\n  `gh issue create --title \"${escapedTitle}\" --body \"\"`,\n  { cwd }\n);\n\n// Change to:\nconst initialTitle = generateInitialTitle(userPrompt);\nconst escapedTitle = initialTitle.replace(/\"/g, '\\\\\"');\nconst placeholderBody = \"_Generating description..._\";\n\nconst { stdout: createStdout, stderr: createStderr } = await execAsync(\n  `gh issue create --title \"${escapedTitle}\" --body \"${placeholderBody}\"`,\n  { cwd }\n);\n```\n\n## Considerations\n- Markdown italics (`_..._`) for visual distinction\n- Keep placeholder brief - it will be replaced quickly\n- Alternative: Use a spinner emoji + text (but emojis can be problematic in some terminals)\n\n## Acceptance\n- Issue created with truncated prompt as title\n- Issue body shows \"Generating description...\" in italics","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:04:34.325993-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.7","title":"2.4 Backend: Create OpenCode session for the issue","description":"# Task: Backend - Create OpenCode Session for the Issue\n\n## What to Do\nAfter creating the GitHub issue, create an OpenCode session that will hold the agent conversation.\n\n## Why\n- The session is where the agent \"lives\"\n- It persists the conversation history\n- The issue page can display this conversation in real-time\n\n## Implementation Details\n```typescript\n// Add import at top:\nimport { openCodeService } from \"@/lib/services/opencode\";\n\n// After extracting issue number (around line 121):\nconst issueNumber = parseInt(urlMatch[1]);\n\n// Create OpenCode session\nconst session = await openCodeService.createSession(\n  cwd,\n  `Issue #${issueNumber}: ${initialTitle.substring(0, 50)}`\n);\n```\n\n## Considerations\n- Session title includes issue number for easy identification\n- Truncate title in session name to avoid overly long session titles\n- The `cwd` (project path) is the session's working directory\n\n## Error Handling\nIf session creation fails, we have two options:\n1. Delete the created issue and return error (clean rollback)\n2. Return partial success with a warning\n\nOption 2 is preferred - the issue exists and can be manually handled.\n\n## Acceptance\n- Session is created with descriptive title\n- Session ID is available for subsequent steps","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:04:34.379635-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.8","title":"2.5 Backend: Craft and inject context with gh issue edit instructions","description":"# Task: Backend - Craft and Inject Context\n\n## What to Do\nUse `openCodeService.injectContext()` to give the agent instructions about its task.\n\n## Why\n- Agent needs to know it's working on a specific GitHub issue\n- Agent needs clear instructions on HOW to update the issue\n- This is \"system context\" that shapes the agent's behavior\n\n## Implementation Details\n```typescript\n// After session creation:\nawait openCodeService.injectContext(cwd, session.id, `\nYou are helping with GitHub issue #${issueNumber} in this repository.\n\nThe user has described what they want to build or explore. After understanding their request:\n\n1. Explore the codebase if needed to understand the context\n2. Ask clarifying questions if the request is ambiguous\n3. When ready, update the GitHub issue with:\n   - A clear, concise title (imperative mood, e.g., \"Add dark mode toggle\")\n   - A well-structured description with these sections:\n     - Summary (2-3 sentences)\n     - Requirements or Goals (bullet points)\n     - Technical Approach (if applicable)\n     - Open Questions (if any remain)\n\nUse this command to update the issue:\n\\`\\`\\`bash\ngh issue edit ${issueNumber} --title \"Your concise title\" --body \"Your markdown description\"\n\\`\\`\\`\n\nImportant: The title should be SHORT and action-oriented. Put the details in the body.\n`);\n```\n\n## Context Design Considerations\n\n### Why not just send as a regular message?\n- `injectContext` uses `noReply: true` - agent won't respond to it\n- It's marked as `synthetic: true` - distinguishes from user messages\n- Clean separation between \"system instructions\" and \"user input\"\n\n### Why include the gh command template?\n- Explicit is better than implicit\n- Agent has concrete example to follow\n- Reduces chance of incorrect command usage\n\n### Why imperative mood for titles?\n- GitHub convention: \"Add X\", \"Fix Y\", \"Update Z\"\n- Reads naturally in a list of issues\n- More actionable than descriptive titles\n\n## Acceptance\n- Context is injected without triggering a response\n- Agent can see the issue number in its instructions\n- Agent has clear guidance on title vs body structure","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:04:34.433702-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-5zh.9","title":"2.6 Backend: Send user prompt via sendMessageWithBashAsync","description":"# Task: Backend - Send User Prompt via sendMessageWithBashAsync\n\n## What to Do\nSend the user's original prompt to the agent session using the async (fire-and-forget) method.\n\n## Why\n- `sendMessageWithBashAsync` doesn't block - backend returns immediately\n- Agent processes in background while user navigates to issue page\n- Bash is enabled so agent can run `gh issue edit`\n- File editing disabled - this is ideation, not implementation\n\n## Implementation Details\n```typescript\n// After injecting context:\nawait openCodeService.sendMessageWithBashAsync(cwd, session.id, userPrompt);\n```\n\nThat's it - one line. The heavy lifting was done in session creation and context injection.\n\n## Why This Method?\n\nLooking at `opencode.ts:121-139`, `sendMessageWithBashAsync`:\n- Uses `promptAsync` (non-blocking)\n- Sets `tools: { bash: true, write: false, edit: false }`\n- Perfect for exploration + gh commands without code changes\n\n## Flow After This Point\n1. Agent receives the prompt\n2. Agent may explore codebase (read files, search)\n3. Agent formulates title and description\n4. Agent runs `gh issue edit` to update the issue\n5. User sees updated issue (and conversation) on issue page\n\n## Acceptance\n- Prompt is sent to the agent\n- Backend doesn't wait for agent response\n- Agent starts processing in background","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:04:34.487663-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-7b4","title":"New Issue Prompt - Simplify Issue Creation with AI-Powered Elaboration","description":"## Overview\n\n**GitHub Issue:** #7 - New Issue Prompt\n\nThis epic transforms the issue creation workflow from a simple title-based input to an intelligent, prompt-driven experience. Instead of requiring users to craft a well-structured GitHub issue manually, the user provides a natural language prompt describing what they want to build or explore. The system then:\n\n1. **Immediately creates a GitHub issue** with a placeholder body (providing instant feedback and a trackable artifact)\n2. **Launches an OpenCode AI session** in the context of that issue\n3. **Injects system instructions** telling the agent to explore the codebase and elaborate the user's request into a well-structured issue\n4. **Sends the user's prompt** to the agent, which then autonomously updates the issue with a proper title and comprehensive description\n\n## Rationale \u0026 Goals\n\n### Why This Change?\n\nThe current workflow creates friction in two ways:\n\n1. **Front-loaded effort:** Users must formulate a clear title before they can even start discussing an idea. This discourages exploration and forces premature structuring.\n\n2. **Missed AI leverage:** The AI agent is capable of exploring the codebase and understanding context far better than a user quickly typing a title. We should leverage this capability.\n\n### Goals\n\n- **Reduce friction:** Single prompt input instead of title field\n- **Leverage AI:** Let the agent do what it's good at - exploring code and writing structured descriptions\n- **Instant feedback:** User gets a GitHub issue number immediately, can navigate to see the conversation\n- **Better issue quality:** AI-generated descriptions are typically more comprehensive, include technical context, and follow consistent formatting\n\n### Alignment with Maestro's Vision\n\nThis change directly supports the ideation-first workflow described in SCOPE.md:\n- Users start with a rough idea\n- They discuss it with an agent\n- The agent helps formalize it into a tracked GitHub issue\n\nBy making issue creation prompt-driven, we're aligning the \"New Issue\" action with the ideation flow - the user describes an intent, and the AI helps shape it into something actionable.\n\n## Technical Approach\n\n### Frontend Changes\n\n**File:** `src/components/new-issue-dialog/NewIssueDialog.tsx`\n\nThe dialog currently has a title input. We change it to:\n- A textarea for multi-line prompts (more room for natural language descriptions)\n- Updated labeling and placeholder text to guide the user\n- State variable renamed from `title` to `prompt`\n- Request body sends `prompt` instead of `title`\n\nThe UI change is intentionally minimal - we're not adding complexity, just changing the nature of the input.\n\n### Backend Changes\n\n**File:** `src/app/api/projects/[id]/issues/route.ts`\n\nThe POST handler needs substantial changes:\n\n1. **Extract prompt** from request body (instead of title)\n2. **Generate initial title** - First ~80 chars of prompt, or a truncated version\n3. **Create GitHub issue** with placeholder body: \"Generating description...\"\n4. **Create OpenCode session** - This becomes the \"discussion session\" for this issue\n5. **Inject context** - System instructions telling the agent:\n   - It's working on issue #N\n   - It should explore the codebase to understand the request\n   - It MUST update both title and description via `gh issue edit`\n   - Format guidelines for the description (sections like Summary, Requirements, Technical Approach, etc.)\n6. **Send prompt** via `sendMessageWithBashAsync` - fire-and-forget, the agent works asynchronously\n7. **Save session mapping** so the issue page can display the conversation\n8. **Return issue number** for frontend navigation\n\n### Session Storage\n\nWe need to ensure the session is linked to the issue so when the user navigates to the issue page, they see the ongoing conversation. The `sessionStorage.saveSession()` function already exists for this purpose.\n\n## User Experience Flow\n\n```\nUser clicks \"New Issue\" button on Project Overview\n                    ↓\nDialog opens with prompt textarea\n\"Describe what you want to build or explore...\"\n                    ↓\nUser types: \"Add dark mode toggle to the settings page with\nsystem preference detection and persistent storage\"\n                    ↓\nUser clicks \"Create Issue\"\n                    ↓\nFrontend shows loading state\nBackend creates GH issue #42: \n  Title: \"Add dark mode toggle to the settings page with...\"\n  Body: \"Generating description...\"\n                    ↓\nBackend creates OpenCode session, injects context, sends prompt\nReturns { number: 42 } to frontend\n                    ↓\nFrontend navigates to /project/{id}/issue/42\n                    ↓\nUser sees the issue details (with placeholder body)\nand the chat panel showing the AI exploring the codebase\n                    ↓\nAI finishes exploration, runs:\ngh issue edit 42 --title \"Add dark mode toggle to settings\" \n                 --body \"## Summary\\n...\"\n                    ↓\nIssue page auto-refreshes (via onIssueUpdated callback),\nshowing the AI-generated title and description\n```\n\n## Files Modified\n\n| File | Type | Changes |\n|------|------|---------|\n| `src/components/new-issue-dialog/NewIssueDialog.tsx` | Frontend | Replace title Input with prompt Textarea, update state/request |\n| `src/app/api/projects/[id]/issues/route.ts` | Backend | Full refactor of POST handler for prompt-based flow |\n\n## Dependencies\n\nNo external dependencies. All required services already exist:\n- `openCodeService.createSession()` - creates sessions\n- `openCodeService.injectContext()` - injects system messages\n- `openCodeService.sendMessageWithBashAsync()` - sends prompts\n- `sessionStorage.saveSession()` - persists session mappings\n- `gh issue create/edit` - GitHub CLI operations\n\n## Acceptance Criteria\n\n- [ ] Modal shows single \"Prompt\" textarea (min-height ~100px)\n- [ ] Textarea has appropriate placeholder text\n- [ ] Submit button text updated appropriately\n- [ ] GitHub issue created immediately with placeholder body\n- [ ] OpenCode session created and linked via sessionStorage\n- [ ] Agent receives context instructing title + description update\n- [ ] Agent receives user's original prompt\n- [ ] Agent successfully updates issue via `gh issue edit`\n- [ ] User navigated to issue page after creation\n- [ ] Issue page shows the conversation in the chat panel\n- [ ] Issue details panel updates when agent modifies the issue\n\n## Edge Cases \u0026 Error Handling\n\nThe error handling follows a **graceful degradation** philosophy:\n\n1. **Empty prompt:** Validation prevents submission (frontend)\n2. **GitHub issue creation fails:** Return error to user (cannot proceed)\n3. **OpenCode session creation fails:** Log error, but return the issue (user has the GH issue, can interact manually)\n4. **Context injection fails:** Log error, continue (agent works without explicit instructions)\n5. **Prompt sending fails:** Log error, continue (user can send messages manually from issue page)\n6. **Agent fails to update:** Issue remains with placeholder body, but conversation shows what happened\n\nThis approach ensures:\n- The primary artifact (GitHub issue) is created when possible\n- Users always have a path forward\n- Errors are visible for debugging but don't cascade unnecessarily\n\n## Future Considerations\n\n- Could add template selection (feature, bug, docs, etc.) that pre-fills prompt guidance\n- Could stream agent's progress to a toast notification\n- Could add \"Generate from conversation\" to create issue from solo chat history","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2026-01-01T07:26:42.635353-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T20:27:26.524557-06:00","close_reason":"Closed","deleted_at":"2026-01-01T20:27:26.524557-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-7b4.1","title":"Frontend: Replace title input with prompt textarea in NewIssueDialog","description":"## Task Overview\n\nTransform the NewIssueDialog from a title-based input to a prompt-based input by making these coordinated changes:\n\n1. Replace `\u003cInput\u003e` with `\u003cTextarea\u003e`\n2. Rename state from `title` to `prompt`\n3. Update labels, placeholders, and description text\n4. Update the API request body\n\n**This task consolidates what were previously separate tasks (.1, .2, .3) because they all touch the same file and should be done atomically.**\n\n## IMPORTANT: Coordinate with Backend\n\nThis is a **breaking change** - the frontend will send `{ prompt }` but the current backend expects `{ title }`. \n\n**Options:**\n1. Deploy frontend and backend changes together in the same PR\n2. Have backend accept both `prompt` and `title` temporarily (backwards compatible)\n\nFor simplicity, **implement this task AFTER bead .4 (backend)** or in the same commit/PR.\n\n## Background \u0026 Rationale\n\nThe current implementation uses an `\u003cInput\u003e` field for a title. The new prompt-driven flow encourages natural language descriptions that benefit from a multi-line textarea and different labeling.\n\n## Implementation Details\n\n**File:** `src/components/new-issue-dialog/NewIssueDialog.tsx`\n\n### 1. Update Imports (line 14)\n\n```tsx\n// Add Textarea import\nimport { Textarea } from \"@/components/ui/textarea\";\n```\n\n### 2. Rename State Variable (line 32)\n\n```tsx\n// Current\nconst [title, setTitle] = useState(\"\");\n\n// New\nconst [prompt, setPrompt] = useState(\"\");\n```\n\n### 3. Update All References to `title`\n\n- Line 39: `if (!title.trim())` → `if (!prompt.trim())`\n- Line 48-51: Request body `{ title: title.trim(), projectPath }` → `{ prompt: prompt.trim(), projectPath }`\n- Line 63, 77: `setTitle(\"\")` → `setPrompt(\"\")`\n- Line 120: `disabled={!title.trim()}` → `disabled={!prompt.trim()}`\n\n### 4. Update DialogDescription (line 88-90)\n\n```tsx\n\u003cDialogDescription\u003e\n  Describe what you want to build or explore. The agent will create a GitHub\n  issue and elaborate your request with relevant technical context.\n\u003c/DialogDescription\u003e\n```\n\n### 5. Replace Input with Textarea (line 97-105)\n\n```tsx\n// Current\n\u003cLabel htmlFor=\"issue-title\" className=\"text-sm font-medium\"\u003e\n  Title\n\u003c/Label\u003e\n\u003cInput\n  id=\"issue-title\"\n  value={title}\n  onChange={(e) =\u003e setTitle(e.target.value)}\n  placeholder=\"What would you like to explore?\"\n  className=\"mt-2\"\n  autoFocus\n  disabled={isCreating}\n/\u003e\n\n// New\n\u003cLabel htmlFor=\"issue-prompt\" className=\"text-sm font-medium\"\u003e\n  Prompt\n\u003c/Label\u003e\n\u003cTextarea\n  id=\"issue-prompt\"\n  value={prompt}\n  onChange={(e) =\u003e setPrompt(e.target.value)}\n  placeholder=\"Describe what you want to build or explore...\"\n  className=\"mt-2 min-h-[100px] resize-none\"\n  autoFocus\n  disabled={isCreating}\n/\u003e\n```\n\n## Testing Checklist\n\n- [ ] Textarea renders with correct minimum height (~100px)\n- [ ] Placeholder text is visible: \"Describe what you want to build or explore...\"\n- [ ] Label shows \"Prompt\" instead of \"Title\"\n- [ ] DialogDescription explains the AI-assisted flow\n- [ ] Auto-focus works on dialog open\n- [ ] Disabled state works during creation\n- [ ] Multi-line input works correctly\n- [ ] Submit button disabled when empty\n- [ ] State resets when dialog closes\n- [ ] Request body contains `{ prompt, projectPath }` (verify in Network tab)\n- [ ] No TypeScript/lint errors\n\n## Definition of Done\n\n- All UI and state changes implemented in a single commit\n- Frontend sends `{ prompt }` in request body\n- No references to old `title` variable remain\n- Dialog layout looks good with the larger textarea\n- Backend bead .4 is also complete (or done together)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T07:27:11.979723-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T20:27:26.524557-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-7b4.1","depends_on_id":"maestro-7b4","type":"parent-child","created_at":"2026-01-01T07:27:11.982342-06:00","created_by":"daemon"}],"deleted_at":"2026-01-01T20:27:26.524557-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-7b4.10","title":"Verify issue details panel auto-refreshes when agent updates issue","description":"## Task Overview\n\n**VERIFICATION ONLY** - Verify that when the agent runs `gh issue edit` to update the title and description, the issue details panel auto-refreshes to show the new content.\n\n## Important: The Code Already Exists!\n\nLooking at `src/lib/hooks/useChatSession.ts` lines 466-476, the detection logic is **already implemented**:\n\n```typescript\n// Detect GitHub issue modifications and trigger refresh\nif (tool === \"bash\" \u0026\u0026 state.status === \"completed\") {\n  const command = state.input?.command as string | undefined;\n  if (command \u0026\u0026 (\n    command.includes(\"gh issue edit\") ||\n    command.includes(\"gh issue close\") ||\n    command.includes(\"gh issue reopen\")\n  )) {\n    onIssueUpdatedRef.current?.();\n  }\n}\n```\n\nAnd in the issue page (`src/app/project/[id]/issue/[issueNumber]/page.tsx`), there's already an `onIssueUpdated` callback in the `useChatSession` hook that triggers a refetch.\n\n**This task is purely verification** - confirming the existing implementation works correctly with the new prompt-based issue creation flow.\n\n## Background \u0026 Rationale\n\nThe issue page has a two-panel layout:\n- Left: Issue details (title, body, labels, comments)\n- Right: Chat conversation\n\nWhen the agent updates the issue via `gh issue edit`, users should see the changes reflected in the details panel without manually refreshing the page.\n\n## Verification Procedure\n\n1. Create issue via new prompt flow\n2. Navigate to issue page\n3. Watch the details panel (left side)\n4. Wait for agent to run `gh issue edit`\n5. Observe: Does the panel update automatically?\n\n## What to Look For\n\n### Success Indicators\n- Title changes from truncated prompt to agent-generated title\n- Body changes from \"Generating description...\" to full markdown description\n- No manual refresh needed\n- Update happens within 1-2 seconds of agent completing the command\n\n### Potential Issues\n- If the callback isn't firing, check browser DevTools console for errors\n- If the API call fails, the update won't appear (network tab)\n- If there's a parsing issue in the agent's output, detection might fail\n\n## Edge Cases to Test\n\n1. **Agent updates issue multiple times:** Each update should trigger a refresh\n2. **Agent updates title only:** Should still trigger refresh\n3. **Agent updates body only:** Should still trigger refresh\n4. **Rapid updates:** Should handle gracefully (may coalesce)\n\n## Testing Checklist\n\n- [ ] Agent runs `gh issue edit` successfully\n- [ ] Details panel updates automatically (no manual refresh)\n- [ ] New title appears correctly\n- [ ] New body renders with proper markdown\n- [ ] Labels still display correctly (not affected)\n- [ ] No visual flicker or jarring updates\n- [ ] Works on mobile (tabbed view)\n\n## Definition of Done\n\n- Verified: Auto-refresh works when agent updates issue\n- Document any issues found\n- No code changes expected (verification only)\n\n## If Issues Are Found\n\nIf the auto-refresh doesn't work as expected, create a new bead to fix it. The existing implementation should work, but real-world testing may reveal edge cases.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T07:31:23.328617-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T20:27:26.524557-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-7b4.10","depends_on_id":"maestro-7b4","type":"parent-child","created_at":"2026-01-01T07:31:23.329345-06:00","created_by":"daemon"},{"issue_id":"maestro-7b4.10","depends_on_id":"maestro-7b4.9","type":"blocks","created_at":"2026-01-01T07:32:16.007817-06:00","created_by":"daemon"}],"deleted_at":"2026-01-01T20:27:26.524557-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-7b4.11","title":"End-to-end test: Create issue with prompt and verify full flow","description":"## Task Overview\n\nPerform a complete end-to-end test of the new issue creation flow, documenting results and any issues discovered.\n\n## Background \u0026 Rationale\n\nThis is the final verification task that tests the entire user journey:\n1. User opens \"New Issue\" dialog\n2. User enters a natural language prompt\n3. User clicks \"Create Issue\"\n4. System creates GitHub issue with placeholder\n5. System creates OpenCode session and sends prompt\n6. User is navigated to issue page\n7. User sees agent working in chat panel\n8. Agent explores codebase and updates issue\n9. Issue details panel shows updated title and description\n\nThis comprehensive test catches integration issues that unit tests might miss.\n\n## Test Scenarios\n\n### Scenario 1: Basic Happy Path\n\n**Prompt:** \"Add a button to export project data as JSON\"\n\n**Expected:**\n- Issue created with title: \"Add a button to export project data as JSON\"\n- Issue body: \"Generating description...\"\n- Navigated to issue page\n- Chat shows agent working\n- Agent runs `gh issue edit` with improved title + description\n- Issue details update to show:\n  - Clear title (e.g., \"Add JSON export functionality to project data\")\n  - Structured description with Summary, Requirements, Technical Approach, etc.\n\n### Scenario 2: Long Prompt\n\n**Prompt:** \"I want to add a dark mode toggle to the settings page. It should detect the user's system preference on first load, store the preference in localStorage, and apply the theme by toggling CSS classes on the body element. The toggle should be a nice animated switch component.\"\n\n**Expected:**\n- Title truncated appropriately with \"...\"\n- Full context preserved in the conversation\n- Agent produces comprehensive description covering all requirements\n\n### Scenario 3: Vague Prompt\n\n**Prompt:** \"Make the app faster\"\n\n**Expected:**\n- Agent explores codebase looking for performance issues\n- Agent asks clarifying questions OR makes assumptions documented in Open Questions\n- Issue description includes what the agent discovered\n\n### Scenario 4: Technical Prompt\n\n**Prompt:** \"Refactor the session storage service to use IndexedDB instead of localStorage for better performance with large datasets\"\n\n**Expected:**\n- Agent identifies `src/lib/services/sessions.ts`\n- Description references specific file paths and functions\n- Technical approach is concrete and actionable\n\n## Error Scenarios to Test\n\n### E1: OpenCode Service Unavailable\n\n1. Stop OpenCode server\n2. Try to create issue\n3. Expected: Issue is created on GitHub, but session creation fails\n4. User sees issue page but chat is empty\n\n### E2: GitHub CLI Not Authenticated\n\n1. Log out of `gh` CLI\n2. Try to create issue\n3. Expected: Clear error message about authentication\n\n### E3: Not a Git Repository\n\n1. Try with a non-git project path\n2. Expected: Clear error message\n\n## Testing Checklist\n\n### UI/UX\n- [ ] Dialog opens correctly\n- [ ] Textarea is comfortable to type in\n- [ ] Placeholder text is helpful\n- [ ] Submit button state changes appropriately\n- [ ] Loading indicator shows during creation\n- [ ] Dialog closes after successful creation\n- [ ] Navigation to issue page works\n\n### Backend\n- [ ] Issue appears on GitHub immediately\n- [ ] Issue has placeholder body initially\n- [ ] Session is created and linked\n- [ ] Agent starts working within a few seconds\n\n### Agent Behavior\n- [ ] Agent explores relevant files\n- [ ] Agent runs `gh issue edit` command\n- [ ] Updated title is clear and concise\n- [ ] Updated description has proper structure\n- [ ] Description references actual code/files\n\n### Integration\n- [ ] Chat panel shows conversation\n- [ ] Tool invocations display correctly\n- [ ] Issue details refresh when agent updates\n- [ ] Session persists on page refresh\n- [ ] Sending additional messages works\n\n## Documentation\n\n### Record Results\n\nFor each test scenario:\n1. Screenshot of dialog with prompt\n2. Screenshot of issue page during agent work\n3. Screenshot of final issue on GitHub\n4. Note any unexpected behavior\n\n### Issues Found\n\nCreate new beads issues for any bugs discovered during testing.\n\n## Definition of Done\n\n- All happy path scenarios tested and passing\n- At least one error scenario tested\n- Results documented with screenshots\n- Any bugs filed as separate issues\n- Sign-off that feature is ready for use","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T07:31:55.64227-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T20:27:26.524557-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-7b4.11","depends_on_id":"maestro-7b4","type":"parent-child","created_at":"2026-01-01T07:31:55.643063-06:00","created_by":"daemon"},{"issue_id":"maestro-7b4.11","depends_on_id":"maestro-7b4.8","type":"blocks","created_at":"2026-01-01T07:32:16.078473-06:00","created_by":"daemon"},{"issue_id":"maestro-7b4.11","depends_on_id":"maestro-7b4.10","type":"blocks","created_at":"2026-01-01T07:32:16.112851-06:00","created_by":"daemon"}],"deleted_at":"2026-01-01T20:27:26.524557-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-7b4.2","title":"Update state and request body from title to prompt","description":"## Task Overview\n\nRename the state variable from `title` to `prompt` throughout the NewIssueDialog component, and update the API request body to send `prompt` instead of `title`.\n\n## Background \u0026 Rationale\n\nThis is a semantic change that aligns the code with the new mental model:\n- **Old:** User provides a \"title\" for their issue\n- **New:** User provides a \"prompt\" that the AI will elaborate\n\nWhile functionally similar (both are strings the user types), the naming matters for:\n1. **Code clarity:** Future developers understand the intent\n2. **API contract:** Backend expects `prompt` not `title`\n3. **Error messages:** \"Prompt is required\" makes more sense than \"Title is required\"\n\n## Implementation Details\n\n**File:** `src/components/new-issue-dialog/NewIssueDialog.tsx`\n\n### Changes Required\n\n1. **State variable rename (line ~32):**\n```tsx\n// Current\nconst [title, setTitle] = useState(\"\");\n\n// New\nconst [prompt, setPrompt] = useState(\"\");\n```\n\n2. **Validation check (line ~39):**\n```tsx\n// Current\nif (!title.trim()) return;\n\n// New\nif (!prompt.trim()) return;\n```\n\n3. **Request body (line ~48-51):**\n```tsx\n// Current\nbody: JSON.stringify({ \n  title: title.trim(),\n  projectPath,\n}),\n\n// New\nbody: JSON.stringify({ \n  prompt: prompt.trim(),\n  projectPath,\n}),\n```\n\n4. **Reset on close (line ~63, ~77):**\n```tsx\n// Current\nsetTitle(\"\");\n\n// New\nsetPrompt(\"\");\n```\n\n5. **Submit button disabled check (line ~120):**\n```tsx\n// Current\ndisabled={!title.trim() || isCreating}\n\n// New\ndisabled={!prompt.trim() || isCreating}\n```\n\n6. **Already done in previous task:**\n- `value={prompt}` (in Textarea)\n- `onChange={(e) =\u003e setPrompt(e.target.value)}`\n\n## Why This Is a Separate Task\n\nWhile this could be combined with the UI task, separating them:\n- Makes code review easier (UI vs logic changes)\n- Allows parallel work if needed\n- Creates cleaner git history\n- Makes rollback more granular if issues arise\n\n## Testing Checklist\n\n- [ ] State correctly tracks user input\n- [ ] Validation prevents empty submission\n- [ ] Request body contains `prompt` key (verify in Network tab)\n- [ ] State resets when dialog closes\n- [ ] State resets after successful creation\n- [ ] No references to old `title` variable remain\n\n## Definition of Done\n\n- All references to `title` state renamed to `prompt`\n- Request body sends `{ prompt, projectPath }` \n- No TypeScript/lint errors\n- Component functions identically (just with new naming)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T07:27:31.569187-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T20:27:26.524557-06:00","close_reason":"Merged into maestro-7b4.1 - consolidated frontend task","dependencies":[{"issue_id":"maestro-7b4.2","depends_on_id":"maestro-7b4","type":"parent-child","created_at":"2026-01-01T07:27:31.571756-06:00","created_by":"daemon"},{"issue_id":"maestro-7b4.2","depends_on_id":"maestro-7b4.1","type":"blocks","created_at":"2026-01-01T07:32:15.711811-06:00","created_by":"daemon"},{"issue_id":"maestro-7b4.2","depends_on_id":"maestro-7b4.4","type":"blocks","created_at":"2026-01-01T07:32:15.935326-06:00","created_by":"daemon"}],"deleted_at":"2026-01-01T20:27:26.524557-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-7b4.3","title":"Update dialog description and button text for prompt-based flow","description":"## Task Overview\n\nUpdate the dialog's descriptive text and button labels to reflect the new prompt-based workflow.\n\n## Background \u0026 Rationale\n\nUI text should guide users toward the intended behavior. The current text implies a title-entry experience:\n- Dialog description: \"Create a new GitHub issue...\"\n\nThe new text should communicate:\n- You're describing an idea, not just entering a title\n- The agent will help elaborate your request\n- This is the start of a conversation, not just form submission\n\n## Implementation Details\n\n**File:** `src/components/new-issue-dialog/NewIssueDialog.tsx`\n\n### Changes Required\n\n1. **DialogDescription (line ~88-90):**\n```tsx\n// Current\n\u003cDialogDescription\u003e\n  Create a new GitHub issue to start exploring an idea with the agent.\n\u003c/DialogDescription\u003e\n\n// New\n\u003cDialogDescription\u003e\n  Describe what you want to build or explore. The agent will create a GitHub \n  issue and elaborate your request with relevant technical context.\n\u003c/DialogDescription\u003e\n```\n\n2. **Submit button text (line ~127):**\n\nThe current text changes between \"Create Issue\" and \"Creating...\". We should update to reflect the prompt-based nature:\n\n```tsx\n// Current\n{isCreating ? (\n  \u003c\u003e\n    \u003cLoader2 className=\"h-4 w-4 mr-2 animate-spin\" /\u003e\n    Creating...\n  \u003c/\u003e\n) : (\n  \"Create Issue\"\n)}\n\n// Could become\n{isCreating ? (\n  \u003c\u003e\n    \u003cLoader2 className=\"h-4 w-4 mr-2 animate-spin\" /\u003e\n    Creating...\n  \u003c/\u003e\n) : (\n  \"Create \u0026 Explore\"\n)}\n```\n\n**Alternative button texts considered:**\n- \"Create Issue\" - Original, still accurate\n- \"Create \u0026 Explore\" - Emphasizes the exploration aspect\n- \"Start Exploring\" - More action-oriented\n- \"Submit\" - Too generic\n\nRecommendation: Keep \"Create Issue\" for clarity. Users understand what clicking this does. The description above already sets expectations about the AI elaboration.\n\n## UX Considerations\n\n### Why Not Change the Button Text?\n\nThe button text \"Create Issue\" is:\n- Clear about the primary action (a GitHub issue is created)\n- Familiar to users\n- Accurate (an issue IS being created)\n\nAdding more to it like \"Create \u0026 Explore\" might:\n- Sound marketing-y\n- Be less clear about what happens\n- Add unnecessary complexity\n\nThe magic (AI elaboration) should feel natural, not over-promised in the UI.\n\n### Description Length\n\nThe new description is longer but still fits well in a dialog context. It:\n- Sets expectations (you describe, agent elaborates)\n- Mentions the outcome (GitHub issue with technical context)\n- Uses clear, non-technical language\n\n## Testing Checklist\n\n- [ ] Description text renders correctly\n- [ ] Text doesn't overflow or cause layout issues\n- [ ] Button text is clear and appropriate\n- [ ] Dialog title (\"New Issue\") still makes sense\n\n## Definition of Done\n\n- DialogDescription updated with new text\n- Button text evaluated and finalized\n- Dialog reads naturally as a cohesive experience\n- No text truncation or overflow issues","status":"tombstone","priority":3,"issue_type":"task","created_at":"2026-01-01T07:27:53.523461-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T20:27:26.524557-06:00","close_reason":"Merged into maestro-7b4.1 - consolidated frontend task","dependencies":[{"issue_id":"maestro-7b4.3","depends_on_id":"maestro-7b4","type":"parent-child","created_at":"2026-01-01T07:27:53.526315-06:00","created_by":"daemon"},{"issue_id":"maestro-7b4.3","depends_on_id":"maestro-7b4.2","type":"blocks","created_at":"2026-01-01T07:32:15.749557-06:00","created_by":"daemon"}],"deleted_at":"2026-01-01T20:27:26.524557-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-7b4.4","title":"Refactor POST handler to accept prompt instead of title","description":"## Task Overview\n\nModify the POST `/api/projects/[id]/issues` route to accept a `prompt` field instead of `title`, and generate an initial title from the prompt.\n\n## Background \u0026 Rationale\n\nThis is the foundational backend change. The current handler:\n1. Receives `{ title }` from the request\n2. Creates a GitHub issue with that title and empty body\n\nThe new handler:\n1. Receives `{ prompt }` from the request\n2. Generates an initial title (first ~80 chars of prompt, cleaned up)\n3. Creates a GitHub issue with that title and a placeholder body\n\nThis task focuses ONLY on the request parsing and initial issue creation. The OpenCode session orchestration is handled in subsequent tasks.\n\n## Implementation Details\n\n**File:** `src/app/api/projects/[id]/issues/route.ts`\n\n### Changes Required\n\n**1. Extract prompt instead of title (around line 88):**\n\n```typescript\n// Current (lines 88-91)\nconst { title } = body;\n\nif (!title || typeof title !== \"string\") {\n  return NextResponse.json({ error: \"Title is required\" }, { status: 400 });\n}\n\n// New\nconst { prompt } = body;\n\nif (!prompt || typeof prompt !== \"string\") {\n  return NextResponse.json({ error: \"Prompt is required\" }, { status: 400 });\n}\n```\n\n**2. Add generateInitialTitle helper function (add before POST handler or inside it):**\n\n```typescript\n/**\n * Generate a clean title from the user's prompt.\n * - Replaces newlines with spaces (prompts can be multi-line)\n * - Truncates to ~80 chars, breaking at word boundary\n * - Adds ellipsis if truncated\n */\nconst generateInitialTitle = (text: string): string =\u003e {\n  // Clean up: replace newlines and collapse whitespace\n  const cleaned = text.replace(/[\\r\\n]+/g, ' ').replace(/\\s+/g, ' ').trim();\n  \n  const maxLength = 80;\n  if (cleaned.length \u003c= maxLength) {\n    return cleaned;\n  }\n  \n  // Try to break at a word boundary\n  const truncated = cleaned.substring(0, maxLength);\n  const lastSpace = truncated.lastIndexOf(' ');\n  \n  if (lastSpace \u003e maxLength * 0.5) {\n    // Break at word boundary if we're not losing too much\n    return truncated.substring(0, lastSpace) + '...';\n  }\n  \n  // Otherwise just truncate\n  return truncated.substring(0, maxLength - 3) + '...';\n};\n\nconst initialTitle = generateInitialTitle(prompt);\n```\n\n**3. Update gh issue create command with proper escaping (around line 105-109):**\n\nThe current code does minimal escaping:\n```typescript\nconst escapedTitle = title.replace(/\"/g, '\\\\\"');\n```\n\nReplace with more robust escaping:\n```typescript\n// Escape shell special characters in the title\nconst escapedTitle = initialTitle\n  .replace(/\\\\/g, '\\\\\\\\')   // Escape backslashes first\n  .replace(/\"/g, '\\\\\"')     // Escape double quotes\n  .replace(/\\$/g, '\\\\$')    // Escape dollar signs (prevent shell expansion)\n  .replace(/\\`/g, '\\\\`');   // Escape backticks\n\nconst placeholderBody = 'Generating description...';\n\nconst { stdout: createStdout, stderr: createStderr } = await execAsync(\n  \\`gh issue create --title \"\\${escapedTitle}\" --body \"\\${placeholderBody}\"\\`,\n  { cwd }\n);\n```\n\n**Note:** The `generateInitialTitle` function already handles newlines by converting them to spaces, so we don't need to escape newlines separately.\n\n## Variable Clarification\n\nThe `issueNumber` variable is extracted from the GitHub CLI output AFTER issue creation:\n```typescript\nconst urlMatch = output.match(/issues\\/(\\d+)/);\nconst issueNumber = urlMatch[1];  // This is a string\n```\n\nThis is used later by beads .6, .7, .8 for session creation and context injection.\n\n## Edge Cases Handled\n\n1. **Multi-line prompt:** Newlines replaced with spaces for title\n2. **Very short prompt:** Used as-is (no truncation needed)\n3. **Long single word:** Truncated with ellipsis at position 77 + \"...\"\n4. **Special characters:** Shell-escaped (quotes, backticks, dollar signs, backslashes)\n5. **Whitespace normalization:** Multiple spaces/tabs collapsed to single space\n\n## Why These Specific Escaping Rules?\n\nThe `gh issue create` command runs in a shell, so we need to escape:\n- `\"` - Would terminate the title string\n- `\\\\` - Would escape the next character\n- `$` - Would trigger shell variable expansion\n- `` ` `` - Would trigger command substitution\n\nThe placeholder body is a fixed string with no special characters, so it's safe as-is.\n\n## Testing Checklist\n\n- [ ] Request with `{ prompt }` works\n- [ ] Request with `{ title }` returns 400 error (breaking change)\n- [ ] Empty prompt returns 400 error\n- [ ] Short prompt becomes full title\n- [ ] Long prompt is truncated appropriately with \"...\"\n- [ ] Multi-line prompt has newlines converted to spaces\n- [ ] Issue body contains \"Generating description...\"\n- [ ] Prompts with quotes work: `Add \"dark mode\" feature`\n- [ ] Prompts with backticks work: `Fix the \\`calculateTotal\\` function`\n- [ ] Prompts with dollar signs work: `Handle $100 transactions`\n- [ ] Response includes issue number for navigation\n\n## Definition of Done\n\n- POST handler accepts `prompt` field\n- `title` field is no longer accepted (breaking change - coordinate with frontend bead .1)\n- Initial title is generated with smart truncation and newline handling\n- Special characters are properly shell-escaped\n- Issue body contains placeholder text\n- All existing error handling preserved\n- No TypeScript errors","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T07:28:33.754683-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T20:27:26.524557-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-7b4.4","depends_on_id":"maestro-7b4","type":"parent-child","created_at":"2026-01-01T07:28:33.757121-06:00","created_by":"daemon"}],"deleted_at":"2026-01-01T20:27:26.524557-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-7b4.5","title":"Add OpenCode service imports to issues route","description":"## Task Overview\n\nAdd the necessary imports for OpenCode service and session storage to the issues route file, preparing for the session orchestration logic.\n\n## Background \u0026 Rationale\n\nBefore we can create OpenCode sessions and store mappings, we need to import the relevant services. This is a preparatory task that:\n1. Adds imports without changing behavior\n2. Allows subsequent tasks to use these services\n3. Keeps the \"add session creation\" task focused on logic, not setup\n\nSeparating import additions from logic changes is a pattern that:\n- Makes diffs cleaner and easier to review\n- Reduces risk of merge conflicts\n- Allows verification that imports work before using them\n\n## Implementation Details\n\n**File:** `src/app/api/projects/[id]/issues/route.ts`\n\n### Changes Required\n\n**Add imports at the top of the file (after existing imports, ~line 5):**\n\n```typescript\n// Existing imports\nimport { NextResponse } from \"next/server\";\nimport { exec } from \"child_process\";\nimport { promisify } from \"util\";\nimport { configService } from \"@/lib/services/config\";\n\n// Add these new imports\nimport { openCodeService } from \"@/lib/services/opencode\";\nimport { sessionStorage } from \"@/lib/services/sessions\";\n```\n\n## Why These Specific Imports?\n\n### `openCodeService`\n\nFrom `src/lib/services/opencode.ts`, this singleton provides:\n- `createSession(projectPath, title)` - Create a new OpenCode session\n- `injectContext(projectPath, sessionId, context)` - Inject system context\n- `sendMessageWithBashAsync(projectPath, sessionId, message)` - Send prompts with bash enabled\n\nAll methods we need for the issue creation flow.\n\n### `sessionStorage`\n\nFrom `src/lib/services/sessions.ts`, this singleton provides:\n- `saveSession(projectId, projectPath, issueNumber, sessionId)` - Persist the session mapping\n\nThis allows the issue page to find and display the conversation later.\n\n## Verification\n\nAfter adding imports, verify:\n1. No TypeScript errors\n2. No circular dependency issues  \n3. File still compiles/builds correctly\n\nThe imports should be unused at this point (which may trigger linter warnings). That's expected - they'll be used in the next task.\n\n## Linter Consideration\n\nIf ESLint complains about unused imports, you can either:\n1. Add `// eslint-disable-next-line @typescript-eslint/no-unused-vars` temporarily\n2. Combine this task with the next one during implementation\n3. Trust that the next task will use them immediately\n\nFor the cleanest git history, implementing this and the next task in the same commit is acceptable.\n\n## Testing Checklist\n\n- [ ] No TypeScript compilation errors\n- [ ] No circular dependency issues\n- [ ] Imports resolve correctly\n- [ ] Build still succeeds\n\n## Definition of Done\n\n- Both imports added to the file\n- File compiles without errors\n- Ready for session creation logic","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T07:28:55.795205-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T20:27:26.524557-06:00","close_reason":"Merged into maestro-7b4.6 - adding imports is part of the session creation task, not a standalone task","dependencies":[{"issue_id":"maestro-7b4.5","depends_on_id":"maestro-7b4","type":"parent-child","created_at":"2026-01-01T07:28:55.797992-06:00","created_by":"daemon"},{"issue_id":"maestro-7b4.5","depends_on_id":"maestro-7b4.4","type":"blocks","created_at":"2026-01-01T07:32:15.785568-06:00","created_by":"daemon"}],"deleted_at":"2026-01-01T20:27:26.524557-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-7b4.6","title":"Create OpenCode session after issue creation","description":"## Task Overview\n\nAfter creating the GitHub issue, create an OpenCode session that will be used for the AI-assisted elaboration of the issue.\n\nThis task includes adding the necessary imports (previously bead .5) since adding imports is not a standalone task.\n\n## Background \u0026 Rationale\n\nThe GitHub issue is just the artifact. The real value comes from the OpenCode session that:\n1. Provides a conversational interface\n2. Has access to the codebase\n3. Can run commands (like `gh issue edit`)\n4. Persists the conversation for the user to see\n\n## Implementation Details\n\n**File:** `src/app/api/projects/[id]/issues/route.ts`\n\n### 1. Add Imports (at top of file, after existing imports around line 4)\n\n```typescript\n// Existing imports\nimport { NextResponse } from \"next/server\";\nimport { exec } from \"child_process\";\nimport { promisify } from \"util\";\nimport { configService } from \"@/lib/services/config\";\n\n// Add these new imports\nimport { openCodeService } from \"@/lib/services/opencode\";\nimport { sessionStorage } from \"@/lib/services/sessions\";\n```\n\n### 2. Add Session Creation After Issue Creation\n\nAdd this code after the issue is parsed (after `const issue: GitHubIssue = JSON.parse(issueStdout);`, around line 129) and before the return statement:\n\n```typescript\n// Create OpenCode session for this issue\nlet sessionId: string | undefined;\ntry {\n  // Note: issueNumber is available from line 121 (from URL regex match)\n  // initialTitle is the truncated prompt from generateInitialTitle() in bead .4\n  const session = await openCodeService.createSession(\n    cwd,\n    \\`Issue #\\${issueNumber}: \\${initialTitle}\\`\n  );\n  sessionId = session.id;\n  \n  // Save session mapping for later retrieval\n  // Note: issueNumber is a string, but saveSession expects number\n  await sessionStorage.saveSession(id, cwd, parseInt(issueNumber), sessionId);\n} catch (sessionError) {\n  // Log but don't fail - issue was created successfully\n  // User can still interact with the issue, just won't have the AI session\n  console.error(\"Failed to create OpenCode session:\", sessionError);\n}\n\nreturn NextResponse.json(issue, { status: 201 });\n```\n\n## Error Handling Philosophy\n\nWe choose to NOT fail the entire request if session creation fails because:\n\n1. **The primary action succeeded:** GitHub issue was created\n2. **User has a path forward:** They can still see the issue, manually fill it in\n3. **Graceful degradation:** Better than losing the issue entirely\n4. **Debugging visibility:** Error is logged for investigation\n\n## Session Title Format\n\nThe session title `Issue #${issueNumber}: ${initialTitle}` follows the existing pattern in the codebase:\n- Identifies what issue the session is for\n- Shows a preview of the content\n- Makes sessions easy to find in OpenCode's session list\n\n## Session Storage\n\nThe `saveSession` call persists the mapping:\n- `id` - Project UUID (from URL params, available as `await params.id`)\n- `cwd` - Project path (from `project.path`)\n- `issueNumber` - GitHub issue number (parsed as int from the string)\n- `sessionId` - OpenCode session ID\n\nThis mapping is used by the issue page to:\n1. Check if a session already exists\n2. Display the ongoing conversation\n3. Send additional messages to the agent\n\n## Why `parseInt(issueNumber)`?\n\n`sessionStorage.saveSession` expects `issueNumber` as a number, but we have it as a string from the URL regex match (`const issueNumber = urlMatch[1]`). Hence `parseInt(issueNumber)`.\n\n## Variable Dependencies\n\nThis bead depends on variables created in bead .4:\n- `initialTitle` - The truncated prompt string\n- `issueNumber` - Already exists in current code (from URL regex match)\n- `cwd` - Already exists (from `project.path`)\n- `id` - Already exists (from `await params`)\n\n## Testing Checklist\n\n- [ ] Imports are added and resolve correctly\n- [ ] Session is created after issue creation\n- [ ] Session title includes issue number and title\n- [ ] Session mapping is saved to sessionStorage\n- [ ] If session creation fails, issue is still returned (201 status)\n- [ ] Session creation error is logged to console\n- [ ] No TypeScript errors\n\n## Definition of Done\n\n- Imports added: `openCodeService` and `sessionStorage`\n- Session created with descriptive title\n- Session mapping persisted via sessionStorage\n- Error handling logs but doesn't fail the request\n- Issue creation still works end-to-end","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T07:29:19.976047-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T20:27:26.524557-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-7b4.6","depends_on_id":"maestro-7b4","type":"parent-child","created_at":"2026-01-01T07:29:19.978604-06:00","created_by":"daemon"},{"issue_id":"maestro-7b4.6","depends_on_id":"maestro-7b4.4","type":"blocks","created_at":"2026-01-01T07:45:19.655827-06:00","created_by":"daemon"}],"deleted_at":"2026-01-01T20:27:26.524557-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-7b4.7","title":"Inject system context instructing agent to update issue","description":"## Task Overview\n\nAfter creating the OpenCode session, inject system context that tells the agent:\n1. What issue it's working on\n2. That it should explore the codebase\n3. That it MUST update the issue title and description\n4. How to format the description\n\n## Background \u0026 Rationale\n\nThe agent needs clear instructions to behave as expected. Without explicit guidance, it might:\n- Just answer the prompt conversationally\n- Forget to update the GitHub issue\n- Create a poorly formatted description\n\nThe injected context acts as a \"system prompt\" that shapes the agent's behavior for this specific use case.\n\n## Implementation Details\n\n**File:** `src/app/api/projects/[id]/issues/route.ts`\n\n### Changes Required\n\n**Add context injection inside the try block, after session creation and storage:**\n\n```typescript\n// After: await sessionStorage.saveSession(id, cwd, parseInt(issueNumber), sessionId);\n\n// Inject context instructing agent to update the issue\nconst contextText = \\`\nYou are helping with GitHub issue #\\${issueNumber} in this repository.\n\nThe user has provided a prompt describing what they want to build or explore. Your job is to:\n\n1. **Explore the codebase** to understand the relevant context, existing patterns, and potential impact areas.\n\n2. **Update the GitHub issue** with a clear title and comprehensive description. \n   \n   IMPORTANT: Use a heredoc or --body-file for the body to handle special characters safely:\n   \n   \\\\\\`\\\\\\`\\\\\\`bash\n   gh issue edit \\${issueNumber} --title \"\u003cimproved title\u003e\" --body-file /dev/stdin \u003c\u003c 'ISSUEBODY'\n   ## Summary\n   ...your markdown content...\n   ISSUEBODY\n   \\\\\\`\\\\\\`\\\\\\`\n   \n   Alternatively, for simpler content:\n   gh issue edit \\${issueNumber} --title \"\u003cimproved title\u003e\" --body \"\u003cmarkdown description\u003e\"\n\n3. **Format the description** with these sections as appropriate:\n   - **Summary**: 1-2 sentences explaining the goal\n   - **Background**: Why this is needed, what problem it solves\n   - **Requirements**: Specific things that need to be implemented\n   - **Technical Approach**: How to implement it, what files/components are involved\n   - **Acceptance Criteria**: How to verify the work is complete\n   - **Open Questions**: Any decisions that need to be made\n\n**Important:**\n- The title should be clear, concise, and in imperative mood (e.g., \"Add dark mode toggle to settings\")\n- The description should be comprehensive enough that another developer could implement it\n- Include file paths, function names, and other specific references discovered during exploration\n- If the prompt is vague, make reasonable assumptions and note them as open questions\n- Escape any special shell characters in your commands, or use heredocs for safety\n\nAfter you update the issue, briefly confirm what you did and ask if the user wants to refine anything.\n\\`;\n\nawait openCodeService.injectContext(cwd, sessionId, contextText);\n```\n\n## Context Injection API\n\nThe `injectContext` method uses:\n- `noReply: true` - Agent doesn't respond to this message\n- `synthetic: true` - Marks it as system context, not user message\n\nThis means the context appears in the session but isn't visible as a \"user message\" - it's more like a system prompt prepended to the conversation.\n\n## Why Heredoc Suggestion?\n\nThe agent will generate markdown with:\n- Code blocks containing backticks\n- Quotes and special characters\n- Multi-line content\n\nUsing heredoc (`\u003c\u003c 'ISSUEBODY'`) prevents shell interpretation issues. The single quotes around the delimiter prevent variable expansion inside the heredoc.\n\n## Why These Specific Instructions?\n\n### Explore the Codebase\n\nThe agent has access to file reading and searching. By explicitly asking it to explore, we:\n- Get more informed descriptions\n- Discover relevant file paths and patterns\n- Produce descriptions that reference actual code\n\n### Format Guidelines\n\nWithout format guidelines, agents produce inconsistent output. By specifying sections:\n- Descriptions are scannable and professional\n- Other developers know what to expect\n- Information is organized logically\n\n### Imperative Mood for Titles\n\n\"Add feature\" vs \"Adding feature\" vs \"Feature addition\"\n\nImperative mood is the convention for:\n- Git commit messages\n- GitHub PR titles\n- Issue titles\n\nIt reads as a command/action, which is what an issue represents.\n\n### \"After you update the issue...\"\n\nThis ensures the agent:\n- Confirms what it did (useful for user visibility)\n- Opens the door for refinement (makes it conversational)\n\n## Error Handling\n\nIf context injection fails, log and continue - the agent might still produce something useful without explicit instructions.\n\n```typescript\ntry {\n  await openCodeService.injectContext(cwd, sessionId, contextText);\n} catch (contextError) {\n  console.error(\"Failed to inject context:\", contextError);\n  // Continue anyway - agent will work without explicit instructions\n}\n```\n\n**Note:** This follows the graceful degradation philosophy - issue exists, session exists, user can still interact.\n\n## Testing Checklist\n\n- [ ] Context is injected after session storage save\n- [ ] Context includes issue number\n- [ ] Context includes heredoc instructions for safe shell escaping\n- [ ] Context includes formatting guidelines\n- [ ] Context injection failure is logged but doesn't fail request\n- [ ] Agent receives and follows the instructions (manual verification)\n\n## Definition of Done\n\n- Context injection added to the flow\n- Context includes all required guidance including shell safety tips\n- Error handling logs but doesn't fail\n- No TypeScript errors","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T07:29:54.428633-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T20:27:26.524557-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-7b4.7","depends_on_id":"maestro-7b4","type":"parent-child","created_at":"2026-01-01T07:29:54.429279-06:00","created_by":"daemon"},{"issue_id":"maestro-7b4.7","depends_on_id":"maestro-7b4.6","type":"blocks","created_at":"2026-01-01T07:32:15.860042-06:00","created_by":"daemon"}],"deleted_at":"2026-01-01T20:27:26.524557-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-7b4.8","title":"Send user prompt to agent via sendMessageWithBashAsync","description":"## Task Overview\n\nAfter injecting context, send the user's original prompt to the agent using `sendMessageWithBashAsync`, which triggers the agent to explore and update the issue.\n\n## Background \u0026 Rationale\n\nThis is the final step in the issue creation orchestration:\n1. Issue created ✓\n2. Session created ✓\n3. Context injected ✓\n4. **Send user prompt** ← This task\n\nThe prompt is sent asynchronously (\"fire and forget\") because:\n- We don't want the API request to wait for agent completion\n- Agent work can take 30+ seconds\n- User navigates to issue page and sees streaming updates\n\n## Implementation Details\n\n**File:** `src/app/api/projects/[id]/issues/route.ts`\n\n### Changes Required\n\n**Add prompt sending after context injection, still inside the try block:**\n\n```typescript\n// After: await openCodeService.injectContext(cwd, sessionId, contextText);\n\n// Send the user's prompt to the agent\n// This is fire-and-forget - agent will work asynchronously\nawait openCodeService.sendMessageWithBashAsync(cwd, sessionId, prompt.trim());\n```\n\n## Why `sendMessageWithBashAsync`?\n\nLooking at `src/lib/services/opencode.ts`, this method:\n- Uses `promptAsync` (non-blocking)\n- Enables `bash: true` (agent can run `gh issue edit`)\n- Disables `write: false` and `edit: false` (can't modify files)\n\nThe tool configuration is perfect for our use case:\n- Agent CAN run `gh issue edit` to update the issue\n- Agent CANNOT modify code files (not the purpose of this flow)\n- Request returns immediately, agent works in background\n\n## Async Behavior Explained\n\n```typescript\nawait openCodeService.sendMessageWithBashAsync(...)\n```\n\nThis `await` is slightly confusing - it waits for the **request to be sent**, not for the agent to complete. Under the hood:\n- `promptAsync` queues the work in OpenCode\n- Returns immediately after queuing\n- Agent processes asynchronously\n\nSo the API response returns to the client quickly, but the agent continues working.\n\n## Complete Orchestration Flow\n\nPutting it all together, the try block looks like:\n\n```typescript\ntry {\n  const session = await openCodeService.createSession(cwd, `Issue #${issueNumber}: ${initialTitle}`);\n  sessionId = session.id;\n  \n  await sessionStorage.saveSession(id, cwd, parseInt(issueNumber), sessionId);\n  \n  await openCodeService.injectContext(cwd, sessionId, contextText);\n  \n  await openCodeService.sendMessageWithBashAsync(cwd, sessionId, prompt.trim());\n} catch (sessionError) {\n  console.error(\"Failed to create OpenCode session:\", sessionError);\n}\n```\n\n## Error Handling Nuance\n\nIf `sendMessageWithBashAsync` fails, it means the prompt wasn't queued. But by this point:\n- Issue exists\n- Session exists\n- Session mapping saved\n\nThe user can still navigate to the issue page and send messages manually. The agent just won't have started automatically.\n\n## Testing Checklist\n\n- [ ] Prompt is sent after context injection\n- [ ] Prompt uses `.trim()` to clean whitespace\n- [ ] Agent receives the prompt (verify in OpenCode session list)\n- [ ] Agent starts working asynchronously\n- [ ] API response returns before agent completes\n- [ ] If prompt sending fails, error is logged\n\n## Definition of Done\n\n- `sendMessageWithBashAsync` called with user's prompt\n- Agent begins exploration and issue updating\n- API response time is quick (doesn't wait for agent)\n- Error handling consistent with other steps","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T07:30:19.530444-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T20:27:26.524557-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-7b4.8","depends_on_id":"maestro-7b4","type":"parent-child","created_at":"2026-01-01T07:30:19.531099-06:00","created_by":"daemon"},{"issue_id":"maestro-7b4.8","depends_on_id":"maestro-7b4.7","type":"blocks","created_at":"2026-01-01T07:32:15.897944-06:00","created_by":"daemon"}],"deleted_at":"2026-01-01T20:27:26.524557-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-7b4.9","title":"Verify issue page displays conversation from linked session","description":"## Task Overview\n\nVerify that when the user navigates to the issue page after creation, the ongoing conversation with the agent is displayed in the chat panel.\n\n## Background \u0026 Rationale\n\nThis is a verification task, not an implementation task. The issue page (`src/app/project/[id]/issue/[issueNumber]/page.tsx`) already has the machinery to:\n1. Look up the session mapping via `useChatSession` hook\n2. Connect to the SSE stream for that session\n3. Display messages in the chat panel\n\nWe need to verify this works correctly with the new flow where the session is created by the API route rather than initiated from the issue page.\n\n## What Should Happen\n\n1. User submits prompt in NewIssueDialog\n2. API creates issue + session + sends prompt\n3. User is navigated to `/project/{id}/issue/{issueNumber}`\n4. Issue page loads and calls `useChatSession`\n5. Hook finds existing session mapping via `sessionStorage.getSession()`\n6. Hook connects to that session\n7. Messages (including agent's work) appear in chat panel\n8. Real-time streaming works as agent continues working\n\n## Race Condition Analysis\n\n**Good news:** There is NO race condition here.\n\nLooking at the API flow:\n1. \\`saveSession()\\` is called with \\`await\\` BEFORE the response is returned\n2. Only then does the client receive the response and navigate\n\nSo by the time the issue page loads, the session mapping is guaranteed to exist.\n\n## Session Already Active\n\nWhen the session is already doing work (agent is streaming), the issue page needs to:\n- Connect to the existing SSE stream\n- Show messages that have already been sent\n- Continue receiving new messages\n\nThis should work via the existing `getSessionMessages` + SSE subscription pattern in `useChatSession`.\n\n## Message Order\n\nMessages should appear in order:\n1. The injected context (should be hidden as \"synthetic\" - not visible to user)\n2. The user's prompt\n3. The agent's exploration and response\n\n## Testing Procedure\n\n1. Create new issue via the dialog with a prompt\n2. Verify navigation happens to issue page\n3. Check chat panel shows:\n   - User's prompt (should appear quickly)\n   - Agent's streaming response (may take time to start)\n4. Verify real-time updates work\n5. Wait for agent to complete\n6. Check that \\`gh issue edit\\` command appears in tool usage\n7. Verify issue details panel updates (handled by separate bead .10)\n\n## Files to Review (Not Modify)\n\n- \\`src/lib/hooks/useChatSession.ts\\` - Session connection logic\n- \\`src/app/project/[id]/issue/[issueNumber]/page.tsx\\` - Issue page component\n- \\`src/lib/services/sessions.ts\\` - Session storage lookup\n\n## Edge Cases\n\n1. **Slow network:** Messages might take a moment to load initially\n2. **Agent error:** Should display error state in tool output, not break the page\n3. **Session not found:** Hook should gracefully offer to start new session (fallback)\n\n## Testing Checklist\n\n- [ ] Issue page loads after creation\n- [ ] Chat panel connects to existing session (no \"Create session\" prompt)\n- [ ] User's prompt appears in conversation\n- [ ] Agent's response streams in real-time\n- [ ] Tool invocations (like \\`gh issue edit\\`) display correctly\n- [ ] Page refresh preserves the conversation\n- [ ] Synthetic context message is NOT visible to user\n- [ ] Multiple browser tabs work independently\n\n## Definition of Done\n\n- Verified: Session created by API is accessible from issue page\n- Verified: Real-time streaming works\n- Verified: Conversation persists on refresh\n- Document any issues found for separate fixes","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T07:30:54.917636-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T20:27:26.524557-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-7b4.9","depends_on_id":"maestro-7b4","type":"parent-child","created_at":"2026-01-01T07:30:54.920715-06:00","created_by":"daemon"},{"issue_id":"maestro-7b4.9","depends_on_id":"maestro-7b4.8","type":"blocks","created_at":"2026-01-01T07:32:15.972042-06:00","created_by":"daemon"}],"deleted_at":"2026-01-01T20:27:26.524557-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-brz","title":"Make Planning Phase UI Responsive and Improve BeadDetail UX (GH #17)","description":"## Overview\n\nThis epic addresses comprehensive UI/UX improvements to the Planning phase interface, focusing on four main problem areas:\n\n1. **Breakpoint Inconsistency** - The codebase uses 768px in some places and 1024px in others, causing confusing \"mixed mode\" behavior on tablets\n2. **Header Overflow** - On narrower screens, header content extends beyond viewport, requiring horizontal scroll to access \"Back to Issue\" button\n3. **Layout Not Dynamic** - Unlike Issue view, Planning view can force horizontal scrolling\n4. **BeadDetail Panel UX on Desktop** - Current 320px side panel is too narrow, not resizable, and positioned awkwardly\n\n## Background \u0026 Context\n\n### Current State Analysis\n\nThe Planning UI serves as the primary workspace for breaking down GitHub issues into actionable tasks (\"beads\"). Users spend significant time here during the planning phase, so responsiveness and usability are critical.\n\n**What works well:**\n- Mobile bottom sheet pattern (tap bead → slides up from bottom, easy to dismiss)\n- Mobile tabbed interface separates \"Setup \u0026 Chat\" from \"Plan\"\n- Beads list rendering with tree structure\n\n**What does not work:**\n- Tablets (768-1023px) get inconsistent treatment - sidebar thinks \"desktop\", planning thinks \"mobile\"\n- Desktop BeadDetail panel at 320px is cramped for content with descriptions and dependencies\n- Header breadcrumb can overflow, hiding critical \"Back to Issue\" button\n\n### Technical Debt Being Addressed\n\n1. **Duplicate hooks**: `useIsMobile` defined in `/src/hooks/use-mobile.ts` (768px), but PlanningRightPane.tsx and page.tsx define their own local hooks with 1024px\n2. **CSS breakpoint mismatch**: Sidebar uses Tailwind `md:` (768px), planning uses hardcoded 1024px\n3. **No overflow protection**: Header nav has `min-w-0` but lacks `overflow-hidden`\n\n### Design Decisions\n\n| Decision | Choice | Rationale |\n|----------|--------|-----------|\n| Breakpoint | 1024px (lg) | Tablets get mobile experience (better touch targets), laptops+ get desktop |\n| Panel approach | Overlay, not push | Keeps context visible, simpler implementation, matches mobile mental model |\n| Panel width | 420px / max 50% | 30% wider than current, capped to prevent dominating on small screens |\n| Animation | 300ms ease-out | Matches Sheet close duration, feels snappy on desktop |\n\n### Success Criteria\n\n- [ ] Sidebar and planning pages share same breakpoint (1024px)\n- [ ] Header never causes horizontal scroll (tested 320px minimum)\n- [ ] Desktop BeadDetail panel is overlay-style, 420px wide\n- [ ] Mobile bottom sheet preserved unchanged\n- [ ] All existing functionality works (bead CRUD, chat about, navigation)\n\n## Implementation Phases\n\n### Phase 0: Breakpoint Unification (Foundation)\nUpdate global hook and sidebar CSS to use 1024px breakpoint, remove duplicate local hooks from planning components.\n\n### Phase 1: Header Fixes\nAdd overflow protection, implement graceful breadcrumb truncation with CSS, hide segments responsively on small screens.\n\n### Phase 2: Desktop BeadDetail Redesign  \nReplace inline 320px panel with slide-in overlay panel (420px, max 50%), add smooth animation, preserve mobile sheet.\n\n### Phase 3: Polish (Optional)\nFix double close button issue in mobile sheet (Sheet has built-in X, BeadDetail also has X).\n\n## Files Affected\n\n| File | Phase | Changes |\n|------|-------|---------|\n| `src/hooks/use-mobile.ts` | 0 | Change 768 → 1024 |\n| `src/components/ui/sidebar.tsx` | 0 | Change `md:` → `lg:` (~7 locations) |\n| `src/app/project/[id]/planning/[issueNumber]/page.tsx` | 0 | Remove local useIsDesktop, use global hook |\n| `src/components/planning/PlanningRightPane.tsx` | 0, 2 | Remove local hook, implement overlay panel |\n| `src/components/planning/PlanningHeader.tsx` | 1 | Add overflow protection, responsive breadcrumb |\n\n## Testing Strategy\n\nTest at these viewport widths:\n- 320px (small mobile)\n- 375px (iPhone SE)\n- 768px (tablet - should be MOBILE layout)\n- 1023px (just under breakpoint - MOBILE)\n- 1024px (breakpoint - DESKTOP starts)\n- 1440px (laptop)\n- 1920px (desktop)\n\nKey scenarios:\n1. Resize across 1024px boundary - both sidebar AND planning should transition together\n2. Select bead on desktop - panel slides in as overlay\n3. Select bead on mobile - bottom sheet appears\n4. Header at 320px width - no horizontal scroll, \"Back to Issue\" visible\n\n## Related Issues\n\n- This epic focuses solely on responsive UI; does NOT include end-planning functionality or label filtering (those are separate issues/epics if they exist)","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-02T06:56:24.243326-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T06:56:24.243326-06:00"}
{"id":"maestro-brz.1","title":"[Phase 0.1] Update use-mobile.ts breakpoint from 768px to 1024px","description":"## Task Overview\n\nUpdate the global `useIsMobile` hook to use 1024px as the mobile/desktop breakpoint instead of 768px.\n\n## Background \u0026 Reasoning\n\n### Why This Change?\n\nThe current 768px breakpoint creates a \"mixed mode\" problem:\n- At 900px viewport: Sidebar considers this \"desktop\" (shows fixed panel)\n- At 900px viewport: Planning page considers this \"mobile\" (shows tabbed interface)\n- Result: Confusing, inconsistent user experience on tablets\n\n### Why 1024px?\n\n1. **Tablet coverage**: Most tablets (768-1023px) get the mobile experience, which has better touch targets\n2. **Laptop threshold**: 1024px is where laptop screens typically start, better suited for side-by-side panels\n3. **Tailwind alignment**: 1024px matches Tailwind `lg:` breakpoint, making CSS classes predictable\n\n### Impact Analysis\n\nThis is a **global change** that affects ALL components using `useIsMobile()`. Current usages:\n- `sidebar.tsx` - Will now treat 768-1023px as mobile (shows sheet instead of fixed panel)\n- Any other component importing from `@/hooks/use-mobile`\n\n## Implementation\n\n### File: `/src/hooks/use-mobile.ts`\n\n**Current code (line 3):**\n```typescript\nconst MOBILE_BREAKPOINT = 768\n```\n\n**New code:**\n```typescript\nconst MOBILE_BREAKPOINT = 1024\n```\n\nThats the ONLY change needed in this file. The rest of the hook logic uses the constant correctly.\n\n### Full file after change:\n```typescript\nimport * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 1024\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState\u003cboolean | undefined\u003e(undefined)\n\n  React.useEffect(() =\u003e {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () =\u003e {\n      setIsMobile(window.innerWidth \u003c MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth \u003c MOBILE_BREAKPOINT)\n    return () =\u003e mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n```\n\n## Dependencies\n\n- **None** - This is the foundation task that other breakpoint tasks depend on\n\n## Dependents\n\n- Task 0.2 (sidebar CSS) - Must update CSS to match new JS breakpoint\n- Task 0.3 (remove duplicate from PlanningRightPane) - Can now use this global hook\n- Task 0.4 (remove duplicate from page.tsx) - Can now use this global hook\n\n## Acceptance Criteria\n\n- [ ] `MOBILE_BREAKPOINT` constant is changed from 768 to 1024\n- [ ] No other changes to the file\n- [ ] TypeScript compiles without errors\n- [ ] At 900px viewport, `useIsMobile()` returns `true` (was `false` before)\n- [ ] At 1024px viewport, `useIsMobile()` returns `false`\n- [ ] At 1023px viewport, `useIsMobile()` returns `true`\n\n## Testing\n\nManual verification:\n1. In browser dev tools, set viewport to 900px width\n2. Observe sidebar renders as Sheet (mobile mode) instead of fixed panel\n3. This confirms the breakpoint change is working\n\n## Risk Assessment\n\n**Low risk** - Simple constant change. However, this WILL change behavior for any viewport between 768-1023px. Ensure Task 0.2 (sidebar CSS update) is done immediately after to maintain visual consistency.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-02T06:56:46.127945-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T06:56:46.127945-06:00","dependencies":[{"issue_id":"maestro-brz.1","depends_on_id":"maestro-brz","type":"parent-child","created_at":"2026-01-02T06:56:46.128468-06:00","created_by":"daemon"}]}
{"id":"maestro-brz.2","title":"[Phase 0.2] Update sidebar.tsx CSS from md: to lg: breakpoints","description":"## Task Overview\n\nUpdate all Tailwind CSS breakpoint classes in `sidebar.tsx` from `md:` (768px) to `lg:` (1024px) to match the updated global breakpoint.\n\n## Background \u0026 Reasoning\n\n### Why This Change?\n\nAfter Task 0.1 updates the JS breakpoint to 1024px, the CSS must also use 1024px (`lg:`) for consistency. Otherwise:\n- JS says \"mobile\" at 900px → renders Sheet component\n- CSS says \"desktop\" at 900px → applies desktop styles to the Sheet\n- Result: Visual bugs and layout issues\n\n### CSS Breakpoint Reference\n\n| Tailwind Class | Pixel Value | Used For |\n|----------------|-------------|----------|\n| `sm:` | 640px | Small mobile → larger mobile |\n| `md:` | 768px | **OLD** desktop threshold |\n| `lg:` | 1024px | **NEW** desktop threshold |\n| `xl:` | 1280px | Large desktop |\n\n### What Were Changing\n\nThe sidebar uses `md:` classes to show/hide elements and apply desktop-specific styles. We need to change these to `lg:` so that the CSS transition happens at the same viewport width as the JS transition.\n\n## Implementation\n\n### File: `/src/components/ui/sidebar.tsx`\n\n**Changes needed (7 locations):**\n\n#### 1. Line 210 - Desktop sidebar visibility\n```tsx\n// BEFORE\nclassName=\"group peer text-sidebar-foreground hidden md:block\"\n\n// AFTER\nclassName=\"group peer text-sidebar-foreground hidden lg:block\"\n```\n\n#### 2. Line 232 - Sidebar container visibility  \n```tsx\n// BEFORE\nclassName=\"fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear md:flex\"\n\n// AFTER\nclassName=\"fixed inset-y-0 z-10 hidden h-svh w-(--sidebar-width) transition-[left,right,width] duration-200 ease-linear lg:flex\"\n```\n\n#### 3. Line 294 - SidebarRail visibility\n```tsx\n// BEFORE\nclassName=\"... hidden w-4 ... sm:flex\"\n\n// AFTER  \nclassName=\"... hidden w-4 ... lg:flex\"\n```\n\nNote: SidebarRail was using `sm:flex` which is incorrect - should match desktop breakpoint.\n\n#### 4. Line 313 - SidebarInset peer data styles\n```tsx\n// BEFORE\nclassName=\"... md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\"\n\n// AFTER\nclassName=\"... lg:peer-data-[variant=inset]:m-2 lg:peer-data-[variant=inset]:ml-0 lg:peer-data-[variant=inset]:rounded-xl lg:peer-data-[variant=inset]:shadow-sm lg:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\"\n```\n\n#### 5. Line 431 - SidebarGroupAction hit area\n```tsx\n// BEFORE\n\"after:absolute after:-inset-2 md:after:hidden\"\n\n// AFTER\n\"after:absolute after:-inset-2 lg:after:hidden\"\n```\n\n#### 6. Line 566 - SidebarMenuAction hit area\n```tsx\n// BEFORE\n\"after:absolute after:-inset-2 md:after:hidden\"\n\n// AFTER\n\"after:absolute after:-inset-2 lg:after:hidden\"\n```\n\n#### 7. Line 572 - SidebarMenuAction showOnHover opacity\n```tsx\n// BEFORE\nshowOnHover \u0026\u0026 \"... md:opacity-0\"\n\n// AFTER\nshowOnHover \u0026\u0026 \"... lg:opacity-0\"\n```\n\n## Summary of Find/Replace\n\nSearch for `md:` and replace with `lg:` at these line numbers:\n- 210, 232, 313 (multiple occurrences on line 313), 431, 566, 572\n\n**Also change line 294**: `sm:flex` → `lg:flex`\n\n## Dependencies\n\n- **Task 0.1**: Global breakpoint update (must be done first so JS and CSS match)\n\n## Dependents\n\n- Task 0.3 and 0.4 can proceed in parallel after this\n- Phase 1 and 2 tasks depend on breakpoint unification being complete\n\n## Acceptance Criteria\n\n- [ ] All `md:` classes in sidebar.tsx changed to `lg:`\n- [ ] Line 294 changed from `sm:flex` to `lg:flex`\n- [ ] TypeScript/ESLint pass with no errors\n- [ ] At 900px viewport:\n  - Sidebar renders as Sheet (overlay)\n  - No desktop sidebar styles visible\n- [ ] At 1024px viewport:\n  - Sidebar renders as fixed panel\n  - Desktop styles applied correctly\n\n## Testing\n\n1. Start dev server\n2. Navigate to any page with sidebar\n3. Set viewport to 900px\n4. Verify sidebar is a sheet/drawer (mobile)\n5. Set viewport to 1024px\n6. Verify sidebar is fixed panel (desktop)\n7. Resize across 1024px boundary multiple times - should transition smoothly\n\n## Risk Assessment\n\n**Medium risk** - Multiple changes in a core UI component. Test thoroughly:\n- Sidebar expand/collapse behavior\n- Sidebar trigger button visibility\n- Keyboard shortcut (Cmd+B) still works\n- Inset variant styling if used","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-02T06:57:14.244692-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T06:57:14.244692-06:00","dependencies":[{"issue_id":"maestro-brz.2","depends_on_id":"maestro-brz","type":"parent-child","created_at":"2026-01-02T06:57:14.246847-06:00","created_by":"daemon"},{"issue_id":"maestro-brz.2","depends_on_id":"maestro-brz.1","type":"blocks","created_at":"2026-01-02T07:00:37.073722-06:00","created_by":"daemon"}]}
{"id":"maestro-brz.3","title":"[Phase 0.3] Remove duplicate useIsMobile hook from PlanningRightPane.tsx","description":"## Task Overview\n\nRemove the locally-defined `useIsMobile` hook from `PlanningRightPane.tsx` and import the global hook from `@/hooks/use-mobile` instead.\n\n## Background \u0026 Reasoning\n\n### The Problem (Technical Debt)\n\n`PlanningRightPane.tsx` defines its own `useIsMobile` hook (lines 14-32):\n```typescript\nconst DESKTOP_BREAKPOINT = 1024;\n\nfunction useIsMobile() {\n  const subscribe = useCallback((callback: () =\u003e void) =\u003e {\n    const mql = window.matchMedia(`(max-width: ${DESKTOP_BREAKPOINT - 1}px)`);\n    // ...\n  }, []);\n  // ... useSyncExternalStore implementation\n}\n```\n\nThis is problematic because:\n1. **Code duplication** - Same logic exists in global hook\n2. **Maintenance burden** - Bug fixes need to be made in multiple places\n3. **Was using different breakpoint** - Local hook used 1024px while global used 768px (now fixed by Task 0.1)\n\n### Why This Is Now Safe\n\nAfter Task 0.1 updates the global hook to use 1024px, both hooks have the same breakpoint. We can safely consolidate.\n\n### Benefit\n\nSingle source of truth for mobile detection. If we ever need to adjust the breakpoint again, we only change one file.\n\n## Implementation\n\n### File: `/src/components/planning/PlanningRightPane.tsx`\n\n**Step 1: Add import (around line 6)**\n\nAdd to existing imports:\n```typescript\nimport { useIsMobile } from \"@/hooks/use-mobile\";\n```\n\n**Step 2: Remove local constant (line 14)**\n\nDelete:\n```typescript\n// Desktop breakpoint for mobile detection (matches page.tsx)\nconst DESKTOP_BREAKPOINT = 1024;\n```\n\n**Step 3: Remove local hook definition (lines 16-32)**\n\nDelete the entire `useIsMobile` function:\n```typescript\nfunction useIsMobile() {\n  const subscribe = useCallback((callback: () =\u003e void) =\u003e {\n    const mql = window.matchMedia(`(max-width: ${DESKTOP_BREAKPOINT - 1}px)`);\n    mql.addEventListener(\"change\", callback);\n    return () =\u003e mql.removeEventListener(\"change\", callback);\n  }, []);\n\n  const getSnapshot = useCallback(() =\u003e {\n    return window.innerWidth \u003c DESKTOP_BREAKPOINT;\n  }, []);\n\n  const getServerSnapshot = useCallback(() =\u003e {\n    return false; // Default to desktop on server\n  }, []);\n\n  return useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot);\n}\n```\n\n**Step 4: Clean up imports (line 1)**\n\nRemove `useSyncExternalStore` and `useCallback` from imports if no longer used:\n```typescript\n// BEFORE\nimport { useState, useMemo, useSyncExternalStore, useCallback } from \"react\";\n\n// AFTER (if neither are used elsewhere)\nimport { useState, useMemo } from \"react\";\n```\n\nNote: Check if `useCallback` is used elsewhere in the file before removing.\n\n### Complete import section after changes:\n\n```typescript\n\"use client\";\n\nimport { useState, useMemo } from \"react\";\nimport { List, Network, ListTodo, WifiOff } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport { useBeadsWatch } from \"@/lib/hooks/useBeadsWatch\";\n// ... rest of imports\n```\n\n## Dependencies\n\n- **Task 0.1**: Global hook must use 1024px first (otherwise behavior would change)\n- **Task 0.2**: Sidebar CSS update (not strictly required, but should be done for consistency)\n\n## Dependents\n\n- Task 2.1 (desktop overlay panel) - Will modify PlanningRightPane further\n\n## Acceptance Criteria\n\n- [ ] Local `DESKTOP_BREAKPOINT` constant removed\n- [ ] Local `useIsMobile` function removed\n- [ ] Global hook imported from `@/hooks/use-mobile`\n- [ ] Unused imports (`useSyncExternalStore`, possibly `useCallback`) cleaned up\n- [ ] TypeScript compiles without errors\n- [ ] Mobile/desktop detection still works correctly:\n  - At \u003c1024px: `isMobile` is `true`, bottom sheet used\n  - At \u003e=1024px: `isMobile` is `false`, side panel used\n\n## Testing\n\n1. Navigate to planning page on desktop (\u003e=1024px)\n2. Select a bead - verify side panel appears (not bottom sheet)\n3. Resize to mobile (\u003c1024px)\n4. Select a bead - verify bottom sheet appears\n5. Resize back to desktop - verify transitions correctly\n\n## Risk Assessment\n\n**Low risk** - After Task 0.1, the global hook uses the same breakpoint (1024px). This is a pure refactoring task with no behavior change.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-02T06:57:39.333649-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T06:57:39.333649-06:00","dependencies":[{"issue_id":"maestro-brz.3","depends_on_id":"maestro-brz","type":"parent-child","created_at":"2026-01-02T06:57:39.33447-06:00","created_by":"daemon"},{"issue_id":"maestro-brz.3","depends_on_id":"maestro-brz.1","type":"blocks","created_at":"2026-01-02T07:00:37.105345-06:00","created_by":"daemon"}]}
{"id":"maestro-brz.4","title":"[Phase 0.4] Remove duplicate useIsDesktop hook from planning page.tsx","description":"## Task Overview\n\nRemove the locally-defined `useIsDesktop` hook from the planning page (`page.tsx`) and derive the desktop state from the global `useIsMobile` hook instead.\n\n## Background \u0026 Reasoning\n\n### The Problem (Technical Debt)\n\n`page.tsx` defines its own `useIsDesktop` hook (lines 28-52):\n```typescript\nconst DESKTOP_BREAKPOINT = 1024;\n\nfunction useIsDesktop() {\n  const subscribe = useCallback((callback: () =\u003e void) =\u003e {\n    const mql = window.matchMedia(`(min-width: ${DESKTOP_BREAKPOINT}px)`);\n    // ...\n  }, []);\n  // ... useSyncExternalStore implementation\n}\n```\n\nThis creates:\n1. **Code duplication** - Similar logic to global hook but inverted\n2. **Two sources of truth** - Global has `useIsMobile`, local has `useIsDesktop`\n3. **Maintenance complexity** - Changes need to be made in multiple places\n\n### The Solution\n\nInstead of maintaining a separate `useIsDesktop` hook, simply derive it from `useIsMobile`:\n```typescript\nconst isMobile = useIsMobile();\nconst isDesktop = !isMobile;\n```\n\nThis is simpler and ensures consistency with the global breakpoint.\n\n### Note on Server-Side Rendering\n\nThe global `useIsMobile` returns `false` on first render (before hydration), meaning `isDesktop` will be `true`. This matches the current behavior where `getServerSnapshot` returns `true` for `useIsDesktop`.\n\n## Implementation\n\n### File: `/src/app/project/[id]/planning/[issueNumber]/page.tsx`\n\n**Step 1: Add import for global hook**\n\nAdd to imports (around line 3-4):\n```typescript\nimport { useIsMobile } from \"@/hooks/use-mobile\";\n```\n\n**Step 2: Remove local constant (line 28-29)**\n\nDelete:\n```typescript\n// Desktop breakpoint (lg: 1024px)\nconst DESKTOP_BREAKPOINT = 1024;\n```\n\n**Step 3: Remove local hook definition (lines 31-52)**\n\nDelete the entire `useIsDesktop` function:\n```typescript\nfunction useIsDesktop() {\n  const subscribe = useCallback((callback: () =\u003e void) =\u003e {\n    const mql = window.matchMedia(`(min-width: ${DESKTOP_BREAKPOINT}px)`);\n    mql.addEventListener(\"change\", callback);\n    window.addEventListener(\"resize\", callback);\n    return () =\u003e {\n      mql.removeEventListener(\"change\", callback);\n      window.removeEventListener(\"resize\", callback);\n    };\n  }, []);\n\n  const getSnapshot = useCallback(() =\u003e {\n    return window.innerWidth \u003e= DESKTOP_BREAKPOINT;\n  }, []);\n\n  const getServerSnapshot = useCallback(() =\u003e {\n    // Default to desktop on server\n    return true;\n  }, []);\n\n  return useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot);\n}\n```\n\n**Step 4: Update hook usage in component (around line 67)**\n\nChange:\n```typescript\n// BEFORE\nconst isDesktop = useIsDesktop();\n\n// AFTER\nconst isMobile = useIsMobile();\nconst isDesktop = !isMobile;\n```\n\n**Step 5: Clean up imports (line 1)**\n\nRemove `useSyncExternalStore` and `useCallback` from imports if no longer used elsewhere:\n```typescript\n// BEFORE\nimport { useState, useEffect, useCallback, useRef, useSyncExternalStore } from \"react\";\n\n// AFTER\nimport { useState, useEffect, useRef } from \"react\";\n```\n\nNote: `useCallback` IS used elsewhere in this file (line 89, 94, 125, 155), so dont remove it!\n\n### Complete import section after changes:\n\n```typescript\n\"use client\";\n\nimport { useState, useEffect, useCallback, useRef } from \"react\";\nimport { useParams, useSearchParams } from \"next/navigation\";\nimport { Loader2 } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useIsMobile } from \"@/hooks/use-mobile\";\nimport {\n  PlanningHeader,\n  PlanningLeftPane,\n  PlanningRightPane,\n} from \"@/components/planning\";\n// ... rest of imports\n```\n\n## Dependencies\n\n- **Task 0.1**: Global hook must use 1024px first (otherwise behavior would change)\n- **Task 0.2**: Sidebar CSS update (should be done for visual consistency)\n\n## Dependents\n\n- Phase 1 and 2 tasks (clean codebase foundation)\n\n## Acceptance Criteria\n\n- [ ] Local `DESKTOP_BREAKPOINT` constant removed\n- [ ] Local `useIsDesktop` function removed\n- [ ] Global hook imported from `@/hooks/use-mobile`\n- [ ] `isDesktop` derived as `!isMobile`\n- [ ] `useSyncExternalStore` removed from imports (but keep `useCallback`!)\n- [ ] TypeScript compiles without errors\n- [ ] Layout behavior unchanged:\n  - At \u003c1024px: Tabbed mobile layout\n  - At \u003e=1024px: Split-pane desktop layout\n\n## Testing\n\n1. Navigate to planning page at 1440px width\n2. Verify split-pane desktop layout renders\n3. Resize to 900px\n4. Verify tabbed mobile layout renders\n5. Resize back and forth - verify smooth transitions\n6. Hard refresh at 900px - verify mobile layout on initial render\n7. Hard refresh at 1440px - verify desktop layout on initial render\n\n## Risk Assessment\n\n**Low risk** - Pure refactoring. The global hook (after Task 0.1) uses the same 1024px breakpoint. Server-side rendering behavior is preserved (defaults to desktop).\n\n## Note on useCallback Handling\n\nThe component uses `useCallback` for:\n- `handleClearContext` (line 89)\n- `handleChatAbout` (line 94)  \n- `fetchIssue` (line 125)\n- `handleMouseDown` (line 155)\n\nSo `useCallback` must remain in imports!","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-02T06:58:03.453031-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T06:58:03.453031-06:00","dependencies":[{"issue_id":"maestro-brz.4","depends_on_id":"maestro-brz","type":"parent-child","created_at":"2026-01-02T06:58:03.455702-06:00","created_by":"daemon"},{"issue_id":"maestro-brz.4","depends_on_id":"maestro-brz.1","type":"blocks","created_at":"2026-01-02T07:00:37.133075-06:00","created_by":"daemon"}]}
{"id":"maestro-brz.5","title":"[Phase 1.1] Add overflow protection to PlanningHeader nav element","description":"## Task Overview\n\nAdd `overflow-hidden` to the breadcrumb `\u003cnav\u003e` element in PlanningHeader to prevent content from extending beyond the viewport.\n\n## Background \u0026 Reasoning\n\n### The Problem\n\nCurrent header nav element (line 27):\n```tsx\n\u003cnav className=\"flex items-center gap-1 text-sm min-w-0 flex-1\"\u003e\n```\n\nThe nav has `min-w-0` which allows flex items to shrink below their content size, but without `overflow-hidden`, content can still visually extend beyond the nav boundaries and cause horizontal scrolling.\n\n### Why This Matters\n\nOn narrow screens (320-400px), the header content can:\n1. Push the \"Back to Issue\" button out of view\n2. Cause the entire page to have horizontal scroll\n3. Create a poor mobile experience where users cant easily navigate back\n\n### The Fix\n\nAdding `overflow-hidden` ensures that any content that doesnt fit will be clipped, working with `truncate` classes on child elements.\n\n## Implementation\n\n### File: `/src/components/planning/PlanningHeader.tsx`\n\n**Line 27 - Add overflow-hidden:**\n\n```tsx\n// BEFORE\n\u003cnav className=\"flex items-center gap-1 text-sm min-w-0 flex-1\"\u003e\n\n// AFTER\n\u003cnav className=\"flex items-center gap-1 text-sm min-w-0 flex-1 overflow-hidden\"\u003e\n```\n\nThats the only change for this task. The `truncate` class on the last breadcrumb segment (line 37) will now properly truncate when the nav overflows.\n\n## Dependencies\n\n- **None** - Can be done independently (but logically part of Phase 1)\n\n## Dependents\n\n- **Task 1.2** (responsive breadcrumb) - Builds on this foundation\n\n## Acceptance Criteria\n\n- [ ] `overflow-hidden` class added to nav element\n- [ ] At 320px viewport, no horizontal scroll on page\n- [ ] Breadcrumb text clips instead of overflowing\n- [ ] \"Back to Issue\" button remains visible at all widths\n\n## Testing\n\n1. Navigate to planning page\n2. Set viewport to 320px width\n3. Verify:\n   - No horizontal scrollbar on page\n   - Header fits within viewport\n   - Breadcrumb is truncated if needed\n   - \"Back to Issue\" button is visible\n\n## Risk Assessment\n\n**Very low risk** - Single CSS class addition. No behavior change, just visual clipping when content is too long.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-02T06:58:33.080025-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T06:58:33.080025-06:00","dependencies":[{"issue_id":"maestro-brz.5","depends_on_id":"maestro-brz","type":"parent-child","created_at":"2026-01-02T06:58:33.080832-06:00","created_by":"daemon"}]}
{"id":"maestro-brz.6","title":"[Phase 1.2] Implement responsive breadcrumb truncation in PlanningHeader","description":"## Task Overview\n\nModify the breadcrumb elements in PlanningHeader to truncate gracefully at different screen sizes, using CSS instead of JavaScript truncation, and progressively hiding segments on smaller screens.\n\n## Background \u0026 Reasoning\n\n### Current Problems\n\n1. **JavaScript truncation** (line 41-43):\n```tsx\n{issueTitle.length \u003e 40 ? `${issueTitle.slice(0, 40)}...` : issueTitle}\n```\nThis happens BEFORE CSS can take effect, meaning:\n- Title is always max 40 chars even on large screens where theres room\n- CSS `truncate` class has no effect since content is already shortened\n\n2. **All elements have `flex-shrink-0`** (lines 30, 34, 35, 36):\n```tsx\nclassName=\"... flex-shrink-0\"\n```\nNothing can shrink when space is limited - they just overflow.\n\n3. **No progressive disclosure**:\nOn 320px screens, we dont need \"Planning\" segment - just project and issue number.\n\n### Design Goals\n\n| Screen Width | Visible Elements |\n|--------------|------------------|\n| \u003e= 640px (sm) | ProjectName \u003e Planning \u003e #42 Issue Title |\n| \u003c 640px | ProjectName \u003e #42 Issue Title (hide \"Planning\" segment) |\n| Very narrow | Truncation kicks in on project name and title |\n\n## Implementation\n\n### File: `/src/components/planning/PlanningHeader.tsx`\n\n**Replace the entire `\u003cnav\u003e` element (lines 27-47) with:**\n\n```tsx\n{/* Breadcrumb navigation */}\n\u003cnav className=\"flex items-center gap-1 text-sm min-w-0 flex-1 overflow-hidden\"\u003e\n  {/* Project name - can truncate on small screens */}\n  \u003cLink\n    href={`/project/${projectId}`}\n    className=\"text-muted-foreground hover:text-foreground transition-colors truncate max-w-[100px] sm:max-w-[150px] lg:max-w-none\"\n  \u003e\n    {projectName}\n  \u003c/Link\u003e\n  \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n  \n  {/* \"Planning\" segment - hidden on very small screens */}\n  \u003cspan className=\"text-muted-foreground flex-shrink-0 hidden sm:inline\"\u003e\n    Planning\n  \u003c/span\u003e\n  \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0 hidden sm:inline\" /\u003e\n  \n  {/* Issue number and title - always visible */}\n  \u003cspan className=\"font-medium truncate min-w-0\"\u003e\n    #{issueNumber}\n    {issueTitle \u0026\u0026 (\n      \u003cspan className=\"text-muted-foreground font-normal ml-1\"\u003e\n        {issueTitle}\n      \u003c/span\u003e\n    )}\n  \u003c/span\u003e\n\u003c/nav\u003e\n```\n\n### Key Changes Explained\n\n1. **Project name truncation with responsive max-width:**\n```tsx\nclassName=\"truncate max-w-[100px] sm:max-w-[150px] lg:max-w-none\"\n```\n- At \u003c640px: Max 100px (roughly 10-12 chars)\n- At 640-1023px: Max 150px (roughly 15-18 chars)  \n- At \u003e=1024px: No max (full name visible)\n\n2. **Removed `flex-shrink-0` from project link:**\nLet it shrink when needed (the `truncate` class handles overflow).\n\n3. **Hide \"Planning\" and its chevron on small screens:**\n```tsx\nclassName=\"... hidden sm:inline\"\n```\nBelow 640px, these elements dont render at all.\n\n4. **Removed JavaScript truncation:**\n```tsx\n// BEFORE - BAD\n{issueTitle.length \u003e 40 ? `${issueTitle.slice(0, 40)}...` : issueTitle}\n\n// AFTER - GOOD\n{issueTitle}\n```\nCSS `truncate` handles all truncation dynamically based on available space.\n\n5. **Issue title wrapper uses truncate:**\n```tsx\n\u003cspan className=\"font-medium truncate min-w-0\"\u003e\n```\nThe `min-w-0` is critical for flex truncation to work.\n\n## Dependencies\n\n- **Task 1.1**: Overflow protection (must be done first for truncation to visually work)\n\n## Dependents\n\n- None - this completes the header responsive work\n\n## Acceptance Criteria\n\n- [ ] JavaScript `slice()` truncation removed from issue title\n- [ ] Project name has responsive max-width constraints\n- [ ] \"Planning\" segment and chevron hidden below 640px\n- [ ] Issue title truncates via CSS when space is limited\n- [ ] At 320px viewport:\n  - Project name truncated if long\n  - No \"Planning\" visible\n  - Issue number always visible\n  - No horizontal scroll\n- [ ] At 640px viewport:\n  - Full breadcrumb visible if content fits\n- [ ] TypeScript compiles without errors\n\n## Testing\n\n### Test Matrix\n\n| Width | Expected Behavior |\n|-------|-------------------|\n| 320px | \"[Proj...] \u003e #42 [Title t...]\" - no Planning |\n| 400px | \"[ProjectNa...] \u003e #42 [Issue Title...]\" - no Planning |\n| 640px | \"[ProjectName...] \u003e Planning \u003e #42 [Issue Title...]\" |\n| 1024px | \"ProjectName \u003e Planning \u003e #42 Full Issue Title\" |\n| 1440px+ | Everything fully visible |\n\n### Manual Test Steps\n\n1. Navigate to planning page for issue with long title (40+ chars)\n2. Resize browser through each breakpoint\n3. Verify:\n   - No horizontal scroll at any width\n   - \"Back to Issue\" always visible\n   - Content truncates gracefully (... ellipsis)\n   - \"Planning\" appears/disappears at 640px boundary\n\n## Risk Assessment\n\n**Low risk** - Visual changes only. No functionality affected. The main risk is CSS specificity issues which would be visible during testing.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-02T06:59:03.684172-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T06:59:03.684172-06:00","dependencies":[{"issue_id":"maestro-brz.6","depends_on_id":"maestro-brz","type":"parent-child","created_at":"2026-01-02T06:59:03.684777-06:00","created_by":"daemon"},{"issue_id":"maestro-brz.6","depends_on_id":"maestro-brz.5","type":"blocks","created_at":"2026-01-02T07:00:37.160809-06:00","created_by":"daemon"}]}
{"id":"maestro-brz.7","title":"[Phase 2.1] Replace inline BeadDetail panel with slide-in overlay on desktop","description":"## Task Overview\n\nReplace the current 320px inline side panel for BeadDetail on desktop with a slide-in overlay panel that is wider (420px, max 50%), animated, and positioned as an absolute overlay rather than pushing content.\n\n## Background \u0026 Reasoning\n\n### Current State (Problem)\n\nIn `PlanningRightPane.tsx` (lines 232-245):\n```tsx\n{selectedBead \u0026\u0026 !isMobile \u0026\u0026 (\n  \u003cdiv className=\"w-80 border-l overflow-auto flex-shrink-0\"\u003e\n    \u003cBeadDetail ... /\u003e\n  \u003c/div\u003e\n)}\n```\n\nIssues:\n1. **Too narrow** - 320px (w-80) is cramped for content with descriptions and dependencies\n2. **Pushes content** - The `flex-shrink-0` means beads list shrinks when panel opens\n3. **No animation** - Panel just appears/disappears abruptly\n\n### Desired State\n\n```\n┌────────────────────────────────────────────────────────┐\n│ Plan Header                                            │\n├────────────────────────────┬───────────────────────────┤\n│                            │                           │\n│  Beads List                │   BeadDetail Panel        │\n│  (full width)              │   (420px overlay)         │\n│                            │   [slides in from right]  │\n│                            │                           │\n│  ─────────────             │   Header with close       │\n│  │ Epic: ...               │   Status/Priority         │\n│  └── Task 1 ◄── selected   │   Description             │\n│      └── Task 2            │   Dependencies            │\n│                            │   Actions                 │\n│                            │                           │\n└────────────────────────────┴───────────────────────────┘\n```\n\nKey differences:\n- Beads list stays full width (panel overlays it)\n- Panel slides in with animation\n- Shadow provides visual separation\n- 420px width (or 50% max on smaller screens)\n\n### Why Overlay Instead of Push?\n\n1. **Context preservation** - User can still see beads list underneath\n2. **Simpler implementation** - No layout recalculation needed\n3. **Matches mental model** - Like mobile bottom sheet, detail \"slides in over\" content\n4. **Better transition** - Smooth CSS animation vs jarring resize\n\n## Implementation\n\n### File: `/src/components/planning/PlanningRightPane.tsx`\n\n**Step 1: Modify the main content wrapper (around line 204)**\n\nAdd `relative` positioning to enable absolute child:\n\n```tsx\n// BEFORE\n\u003cdiv className=\"flex flex-1 overflow-hidden\"\u003e\n\n// AFTER  \n\u003cdiv className=\"flex flex-1 overflow-hidden relative\"\u003e\n```\n\n**Step 2: Replace the desktop panel (lines 231-245)**\n\n```tsx\n// BEFORE\n{selectedBead \u0026\u0026 !isMobile \u0026\u0026 (\n  \u003cdiv className=\"w-80 border-l overflow-auto flex-shrink-0\"\u003e\n    \u003cBeadDetail\n      bead={selectedBead}\n      onUpdate={handleUpdate}\n      onClose={() =\u003e setSelectedBeadId(null)}\n      onChatAbout={(beadId) =\u003e\n        onChatAbout?.(beadId, selectedBead.title)\n      }\n      onDelete={handleDelete}\n      onBeadClick={handleBeadClick}\n    /\u003e\n  \u003c/div\u003e\n)}\n\n// AFTER\n{!isMobile \u0026\u0026 (\n  \u003cdiv\n    className={cn(\n      \"absolute right-0 top-0 bottom-0 w-[420px] max-w-[50%]\",\n      \"bg-card border-l shadow-xl z-10\",\n      \"transition-transform duration-300 ease-out\",\n      selectedBead ? \"translate-x-0\" : \"translate-x-full\"\n    )}\n  \u003e\n    {selectedBead \u0026\u0026 (\n      \u003cBeadDetail\n        bead={selectedBead}\n        onUpdate={handleUpdate}\n        onClose={() =\u003e setSelectedBeadId(null)}\n        onChatAbout={(beadId) =\u003e\n          onChatAbout?.(beadId, selectedBead.title)\n        }\n        onDelete={handleDelete}\n        onBeadClick={handleBeadClick}\n      /\u003e\n    )}\n  \u003c/div\u003e\n)}\n```\n\n### Key Implementation Details\n\n#### 1. Panel always rendered (for animation)\n```tsx\n{!isMobile \u0026\u0026 (\n  \u003cdiv className={cn(\n    // ...\n    selectedBead ? \"translate-x-0\" : \"translate-x-full\"\n  )}\u003e\n```\nPanel is always in DOM when on desktop, but translated off-screen when no bead selected. This enables smooth slide animation.\n\n#### 2. BeadDetail conditionally rendered inside\n```tsx\n{selectedBead \u0026\u0026 (\n  \u003cBeadDetail ... /\u003e\n)}\n```\nBeadDetail content only renders when needed, but panel container stays for animation.\n\n#### 3. Width constraints\n```tsx\n\"w-[420px] max-w-[50%]\"\n```\n- Fixed 420px width (31% wider than 320px)\n- But never more than 50% of container\n- On a 1024px viewport: panel is 420px\n- On a 800px viewport (hypothetically): would be 400px (50%)\n\n#### 4. Visual separation\n```tsx\n\"bg-card border-l shadow-xl\"\n```\n- Background matches card color\n- Left border for definition\n- Large shadow for depth/separation\n\n#### 5. Animation\n```tsx\n\"transition-transform duration-300 ease-out\"\n```\n- 300ms duration matches Sheet close animation\n- `ease-out` for natural deceleration\n- Only `transform` animates (performant)\n\n#### 6. Stacking context\n```tsx\n\"z-10\"\n```\nPanel sits above beads list but below any modals/dialogs.\n\n## Dependencies\n\n- **Task 0.3**: Global hook import in PlanningRightPane (must be done first)\n\n## Dependents\n\n- **Task 3.1** (optional): Hide double close button in mobile sheet\n\n## Acceptance Criteria\n\n- [ ] Desktop panel uses absolute positioning (overlay)\n- [ ] Panel width is 420px with max-w-[50%] constraint\n- [ ] Panel has shadow-xl for visual separation\n- [ ] Smooth 300ms slide animation when opening/closing\n- [ ] Beads list remains full width (not pushed)\n- [ ] Close button (from BeadDetail) works correctly\n- [ ] Selecting different bead updates panel content (no animation needed)\n- [ ] Mobile behavior completely unchanged (still uses Sheet)\n- [ ] TypeScript compiles without errors\n\n## Testing\n\n### Desktop Tests\n\n1. Navigate to planning page at 1440px width\n2. Verify beads list takes full width (no side panel visible)\n3. Click a bead\n4. Verify panel slides in smoothly from right (300ms)\n5. Verify beads list is still visible underneath (dimmed by shadow)\n6. Click X button in panel\n7. Verify panel slides out smoothly\n8. Click different bead\n9. Verify panel content updates (no slide animation between beads)\n\n### Mobile Tests (Regression)\n\n1. Resize to 900px width\n2. Click a bead\n3. Verify bottom sheet appears (NOT the overlay panel)\n4. Sheet should work exactly as before\n\n### Edge Cases\n\n1. Rapidly click beads - no visual glitches\n2. Resize window while panel open - panel stays positioned correctly\n3. Panel at max-w-[50%] on smaller desktop - verify constraint works\n\n## Risk Assessment\n\n**Medium risk** - Significant visual change to desktop experience. Must thoroughly test:\n- Animation smoothness\n- Content visibility during transition\n- No layout shifts in beads list\n- All BeadDetail functionality preserved","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-02T06:59:44.865831-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T06:59:44.865831-06:00","dependencies":[{"issue_id":"maestro-brz.7","depends_on_id":"maestro-brz","type":"parent-child","created_at":"2026-01-02T06:59:44.866573-06:00","created_by":"daemon"},{"issue_id":"maestro-brz.7","depends_on_id":"maestro-brz.3","type":"blocks","created_at":"2026-01-02T07:00:37.187637-06:00","created_by":"daemon"}]}
{"id":"maestro-brz.8","title":"[Phase 3.1] Hide duplicate close button in mobile Sheet","description":"## Task Overview\n\nFix the duplicate close button issue in the mobile bottom sheet where both the Sheet component and BeadDetail component show their own close buttons.\n\n## Background \u0026 Reasoning\n\n### The Problem\n\nWhen viewing BeadDetail in mobile bottom sheet:\n\n```\n┌─────────────────────────────────────┐\n│ maestro-abc.1: Task Title        [X] ← BeadDetail X button\n│─────────────────────────────────────│\n│ Status: Open   Priority: P2  task   │\n│─────────────────────────────────────│\n│ Description...                      │\n│                                     │\n│ [Chat about this] [Delete]          │\n└─────────────────────────────────────┘\n                                    [X] ← Sheet built-in X button (top-4 right-4)\n```\n\nTwo close buttons:\n1. **BeadDetail X** (line 130-138 of BeadDetail.tsx) - In the header\n2. **Sheet X** (line 75-78 of sheet.tsx) - Built into SheetContent, positioned absolute top-4 right-4\n\n### Why This Happens\n\nThe Sheet component from shadcn/ui includes a built-in close button in `SheetContent`:\n```tsx\n\u003cSheetPrimitive.Close className=\"... absolute top-4 right-4 ...\"\u003e\n  \u003cXIcon className=\"size-4\" /\u003e\n\u003c/SheetPrimitive.Close\u003e\n```\n\nBeadDetail also has its own close button because its designed to work in both:\n- Desktop side panel (needs close button)\n- Mobile sheet (Sheet already has one)\n\n### Solution Options\n\n**Option A: Hide Sheets built-in close button via CSS** (Recommended)\n\nAdd a CSS class to hide the Sheet close button:\n```tsx\n\u003cSheetContent \n  side=\"bottom\" \n  className=\"h-[70vh] safe-bottom p-0 [\u0026\u003e[data-slot=sheet-close]]:hidden\"\n\u003e\n```\n\n**Why Option A:**\n- Single line change\n- No props changes to BeadDetail\n- BeadDetail remains self-contained\n- Works with shadcn/ui Sheet component as-is\n\n**Option B: Add prop to BeadDetail**\n\nAdd `showCloseButton` prop to BeadDetail:\n```tsx\ninterface BeadDetailProps {\n  showCloseButton?: boolean; // default true\n}\n\n// In render:\n{showCloseButton !== false \u0026\u0026 (\n  \u003cButton onClick={onClose}\u003e...\u003c/Button\u003e\n)}\n```\n\nThen in PlanningRightPane mobile usage:\n```tsx\n\u003cBeadDetail showCloseButton={false} ... /\u003e\n```\n\n**Why NOT Option B:**\n- Requires changes to two files\n- BeadDetail interface becomes more complex\n- Harder to understand which context uses which button\n\n## Implementation (Option A)\n\n### File: `/src/components/planning/PlanningRightPane.tsx`\n\n**Location: Around line 251**\n\n```tsx\n// BEFORE\n\u003cSheetContent side=\"bottom\" className=\"h-[70vh] safe-bottom p-0\"\u003e\n\n// AFTER\n\u003cSheetContent \n  side=\"bottom\" \n  className=\"h-[70vh] safe-bottom p-0 [\u0026\u003e[data-slot=sheet-close]]:hidden\"\n\u003e\n```\n\n### How This Works\n\nThe CSS selector `[\u0026\u003e[data-slot=sheet-close]]:hidden` means:\n- `\u0026` - This element (SheetContent)\n- `\u003e` - Direct child\n- `[data-slot=sheet-close]` - Element with this data attribute\n- `:hidden` - Apply `display: none`\n\nLooking at sheet.tsx (line 22), the close button has `data-slot=\"sheet-close\"`:\n```tsx\n\u003cSheetPrimitive.Close data-slot=\"sheet-close\" ...\u003e\n```\n\nSo this selector targets exactly and only the Sheets built-in close button.\n\n## Dependencies\n\n- **None** - Independent polish task\n\n## Dependents\n\n- **None** - This is a leaf task\n\n## Acceptance Criteria\n\n- [ ] Mobile bottom sheet shows only ONE close button (BeadDetails)\n- [ ] Close button in BeadDetail header still works\n- [ ] Swiping down to dismiss still works (Sheets gesture handling)\n- [ ] Tapping overlay outside sheet still closes (Sheets behavior)\n- [ ] Desktop panel unchanged (BeadDetail close button visible)\n- [ ] TypeScript compiles without errors\n\n## Testing\n\n### Mobile Tests\n\n1. Resize viewport to \u003c1024px (mobile mode)\n2. Select a bead to open bottom sheet\n3. Verify ONLY the X button in header is visible (not bottom-right corner)\n4. Click X button - sheet should close\n5. Open sheet again\n6. Swipe down - sheet should close\n7. Open sheet again\n8. Tap overlay area above sheet - sheet should close\n\n### Desktop Tests (Regression)\n\n1. Resize viewport to \u003e=1024px\n2. Select a bead\n3. Verify X button visible in overlay panel header\n4. Click X - panel should close\n\n## Risk Assessment\n\n**Very low risk** - Single CSS class addition. If it doesnt work, user just sees two close buttons (not broken, just redundant). Easy to verify and easy to revert.\n\n## Alternative Approaches Considered\n\n1. **Remove BeadDetails close button entirely** - Bad because desktop panel would have no close button\n2. **Pass onClose as undefined for mobile** - Would break functionality\n3. **Fork Sheet component** - Over-engineering for simple fix\n\nThe CSS approach is minimal, targeted, and non-breaking.","status":"open","priority":4,"issue_type":"task","created_at":"2026-01-02T07:00:16.42771-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:19:26.360377-06:00","dependencies":[{"issue_id":"maestro-brz.8","depends_on_id":"maestro-brz","type":"parent-child","created_at":"2026-01-02T07:00:16.429819-06:00","created_by":"daemon"}]}
{"id":"maestro-cc1","title":"Mark As Complete Feature (GH Issue #12)","description":"## Feature Overview\n\nImplement the \"Mark As Complete\" feature allowing users to mark items (inbox items or bookmarks) as \"completed/finished/read\". This indicates the user has consumed the content. Completed items should be filtered out of the Inbox view and Home page lists, but should still appear in the Library for reference.\n\n## Product Context \u0026 Philosophy\n\nPer Zine's Experience Architecture (`docs/zine-experience-architecture.md`), the app follows these principles:\n- **One primary job per screen**: Each screen has clear responsibility\n- **Decisions first, organization later**: Inbox is for triage, Library is for recall\n- **Low cognitive load**: Features should be intuitive and not interrupt flow\n\nThe \"Mark As Complete\" feature aligns with these principles by:\n1. Providing a simple toggle action (low cognitive load)\n2. Filtering completed items from decision surfaces (Inbox) while preserving them in recall surfaces (Library)\n3. Being orthogonal to existing state management (INBOX/BOOKMARKED/ARCHIVED) - completion is a separate dimension\n\n## Technical Context\n\n### Existing Infrastructure (What's Already Built)\nThe backend infrastructure is **partially complete**:\n\n1. **Database Schema** (`apps/worker/src/db/schema.ts`):\n   - `isFinished: integer('is_finished', { mode: 'boolean' }).notNull().default(false)`\n   - `finishedAt: text('finished_at')` // ISO8601 timestamp, null when not finished\n   - Migration `0005_add_is_finished.sql` already applied\n\n2. **Backend API** (`apps/worker/src/trpc/routers/items.ts`):\n   - `toggleFinished` mutation implemented (lines 488-526)\n   - Returns `{ success: true, isFinished: boolean, finishedAt: string | null }`\n   - `toItemView()` helper already includes `isFinished` and `finishedAt` in response (lines 104-106)\n\n3. **Frontend Hook** (`apps/mobile/hooks/use-items-trpc.ts`):\n   - `useToggleFinished()` hook implemented with optimistic updates (lines 455-479)\n   - Updates inbox, library, and single item caches optimistically\n   - Has correct toggle logic for `isFinished` and `finishedAt`\n\n4. **Icons** (`apps/mobile/components/icons/check-icon.tsx`):\n   - `CheckIcon` (filled) for completed state\n   - `CheckOutlineIcon` (outline) for incomplete state\n\n### What Needs To Be Implemented\n\n1. **UI Wiring**: Connect the check icon button on item detail page to the existing hook\n2. **Backend Filtering**: Add `isFinished = false` filter to inbox query\n3. **Type Updates**: Add `isFinished`/`finishedAt` to shared `UserItem` interface\n4. **Visual Indicators**: Show completion status on item cards\n\n## Behavioral Specification\n\n### State Model\n- `isFinished` is a **boolean flag** independent of the `state` field (INBOX/BOOKMARKED/ARCHIVED)\n- An item can be in ANY state AND be marked as finished\n- Examples:\n  - INBOX + finished = completed but not yet bookmarked/archived\n  - BOOKMARKED + finished = saved AND completed (most common)\n  - ARCHIVED + finished = dismissed AND completed\n\n### Filtering Behavior\n| View | Shows Finished Items? | Rationale |\n|------|----------------------|-----------|\n| Inbox | NO | Inbox is a decision queue; completed items are \"done\" |\n| Home \"Jump Back In\" | NO | Jump Back In is for resuming; completed = fully consumed |\n| Home \"Recent Inbox\" | NO | Mirrors Inbox behavior |\n| Library | YES | Library is permanent storage; completion is metadata |\n\n### User Interaction Flow\n1. User taps check icon on item detail page\n2. Icon fills in (optimistic update)\n3. Haptic feedback confirms action\n4. If in Inbox view, item disappears from list\n5. Item remains accessible in Library with completion indicator\n\n## Acceptance Criteria (from GH Issue)\n- [ ] Tapping check icon on item detail page toggles completion state\n- [ ] Completed items are hidden from Inbox tab\n- [ ] Completed items are hidden from Home page lists\n- [ ] Completed items still appear in Library view\n- [ ] Visual feedback shows completion status\n\n## Files Involved\n\n### Must Modify\n- `apps/mobile/app/item/[id].tsx` - Wire up toggle handler (line 212-214)\n- `apps/worker/src/trpc/routers/items.ts` - Add filter to inbox query (line 141)\n- `packages/shared/src/types/domain.ts` - Update UserItem interface\n- `apps/mobile/components/item-card.tsx` - Add completion indicator\n\n### May Need Updates\n- `apps/mobile/app/(tabs)/inbox.tsx` - Verify filtering works\n- `apps/mobile/app/(tabs)/index.tsx` - Verify home sections filter\n\n## Risk Assessment\n- **Low Risk**: Backend fully implemented, just needs frontend wiring\n- **Medium Risk**: Filtering logic must be consistent across all views\n- **Testing Required**: Optimistic updates, error rollback, edge cases\n\n## Related Documentation\n- GitHub Issue: #12\n- Experience Architecture: `docs/zine-experience-architecture.md`\n- Tech Stack: `docs/zine-tech-stack.md`","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-31T11:04:33.589147-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-cc1.1","title":"1.0 Foundation: Update shared types for isFinished/finishedAt","description":"## Task: Update Shared Types for isFinished/finishedAt\n\n### Purpose\nAdd `isFinished` and `finishedAt` fields to the `UserItem` interface in the shared types package. This ensures type safety across the monorepo and documents the contract between backend and frontend.\n\n### Current State\nThe fields exist in:\n- Database schema (`apps/worker/src/db/schema.ts`) - already defined\n- Backend `ItemView` type (`apps/worker/src/trpc/routers/items.ts:60-61`) - already includes these\n- But NOT in `packages/shared/src/types/domain.ts` UserItem interface\n\n### Implementation\nAdd to `UserItem` interface in `packages/shared/src/types/domain.ts`:\n```typescript\n/** Whether the user has finished/consumed this content */\nisFinished: boolean;\n\n/** When the item was marked as finished (ISO8601), null if not finished */\nfinishedAt?: string;\n```\n\n### Rationale\n- **Type Safety**: Ensures TypeScript catches missing fields at compile time\n- **Documentation**: The shared types serve as the single source of truth for the domain model\n- **Consistency**: All consumers (mobile, worker, future web) use the same types\n\n### Considerations\n- `isFinished` should be required (not optional) with default false, matching DB schema\n- `finishedAt` should be optional since it's null when not finished\n- Consider adding JSDoc comments explaining the field semantics\n\n### Files\n- `packages/shared/src/types/domain.ts` - Add fields to UserItem interface\n\n### Dependencies\nNone - this is a foundational task that other tasks depend on\n\n### Acceptance Criteria\n- [ ] `UserItem` interface includes `isFinished: boolean`\n- [ ] `UserItem` interface includes `finishedAt?: string`\n- [ ] TypeScript compiles without errors\n- [ ] Shared package exports updated types","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-31T11:04:33.649324-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-cc1.10","title":"5.0 Final: End-to-end testing and edge case verification","description":"## Task: End-to-End Testing and Edge Case Verification\n\n### Purpose\nFinal verification that all pieces work together correctly. This task covers integration testing and edge case handling.\n\n### End-to-End Test Scenarios\n\n**Scenario 1: Basic Completion Flow**\n1. Open app with items in Inbox\n2. Tap on an item to open detail\n3. Tap check icon to mark complete\n4. Verify icon fills in immediately\n5. Navigate back to Inbox\n6. Verify item is no longer in Inbox\n7. Navigate to Library\n8. Verify item is in Library with completion indicator\n\n**Scenario 2: Un-complete Flow**\n1. Find a completed item in Library\n2. Tap to open detail\n3. Tap check icon to un-complete\n4. Verify icon changes to outline\n5. If item was in INBOX state, verify it reappears in Inbox\n\n**Scenario 3: Home Page Filtering**\n1. Have items in \"Jump Back In\" (with progress)\n2. Mark one as complete\n3. Navigate to Home\n4. Verify item no longer in \"Jump Back In\"\n5. Verify \"Recent Inbox\" also excludes completed items\n\n**Scenario 4: Completion + Bookmark Flow**\n1. Start with item in Inbox\n2. Tap to open detail\n3. Mark as complete (check icon)\n4. Also bookmark (bookmark icon)\n5. Verify both states are saved\n6. Item should be in Library with completion indicator\n7. Item should NOT be in Inbox (filtered by completion)\n\n**Scenario 5: Completion + Archive Flow**\n1. Start with item in Inbox\n2. Mark as complete\n3. Archive the item\n4. Verify item is ARCHIVED + finished\n5. Verify item not in Inbox (archived)\n6. Verify item not in Library (archived, not bookmarked)\n\n### Edge Cases\n\n1. **New user with empty inbox**: Does completion toggle work?\n2. **Item deleted during completion**: Handle gracefully?\n3. **Session expiry during completion**: Auth error handling?\n4. **Slow network**: UI feedback during loading?\n5. **Offline mode**: Queue completion for later?\n\n### Cross-Platform Verification\n- [ ] Test on iOS simulator\n- [ ] Test on Android emulator\n- [ ] Test on physical iOS device\n- [ ] Test on physical Android device\n\n### Visual Verification\n- [ ] Check icon filled/outline states correct\n- [ ] Completion badge visible on cards\n- [ ] Colors correct (success green)\n- [ ] Animations smooth\n\n### Performance Verification\n- [ ] No visible lag on toggle\n- [ ] List updates without flicker\n- [ ] No memory leaks from subscriptions\n\n### Files to Review (All)\n- `apps/mobile/app/item/[id].tsx`\n- `apps/mobile/app/(tabs)/inbox.tsx`\n- `apps/mobile/app/(tabs)/index.tsx`\n- `apps/mobile/components/item-card.tsx`\n- `apps/mobile/hooks/use-items-trpc.ts`\n- `apps/worker/src/trpc/routers/items.ts`\n- `packages/shared/src/types/domain.ts`\n\n### Dependencies\nAll previous tasks must be complete\n\n### Acceptance Criteria (Final)\nAll acceptance criteria from GitHub Issue #12:\n- [ ] Tapping check icon on item detail page toggles completion state\n- [ ] Completed items are hidden from Inbox tab\n- [ ] Completed items are hidden from Home page lists\n- [ ] Completed items still appear in Library view\n- [ ] Visual feedback shows completion status\n\n### Sign-Off\n- [ ] All tests pass\n- [ ] No console errors\n- [ ] No TypeScript errors\n- [ ] PR ready for review","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T11:04:34.19629-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-cc1.2","title":"1.1 Backend: Add isFinished=false filter to inbox query","description":"## Task: Add isFinished=false Filter to Inbox Query\n\n### Purpose\nModify the `items.inbox` tRPC query to exclude items that have been marked as finished. This implements the core filtering behavior where completed items are hidden from the triage queue.\n\n### Current State\nThe inbox query at `apps/worker/src/trpc/routers/items.ts:136-191` filters by:\n- `userId` - user's items only\n- `state = INBOX` - items in inbox state\n- Cursor-based pagination\n- Optional provider/contentType filters\n\nMissing: `isFinished = false` filter\n\n### Implementation\nAdd to the `conditions` array at line 141:\n```typescript\nconst conditions = [\n  eq(userItems.userId, ctx.userId),\n  eq(userItems.state, UserItemState.INBOX),\n  eq(userItems.isFinished, false),  // \u003c-- Add this line\n];\n```\n\n### Rationale\nPer the Experience Architecture, Inbox is a \"decision queue\" (line 99-101 of zine-experience-architecture.md):\n\u003e \"What do I keep, and what do I discard?\"\n\nCompleted items have already been \"decided\" - the user consumed them. They should no longer clutter the decision surface. However, they remain accessible in Library for reference.\n\n### Edge Cases to Consider\n1. **Bulk completion**: If user marks many items as finished, inbox should update immediately (handled by optimistic updates on frontend)\n2. **Undo completion**: If user un-marks an item as finished, it should reappear in inbox (if state is still INBOX)\n3. **Completion + Archive**: If item is finished AND archived, it should not appear in inbox (filtered by both conditions)\n\n### Testing Approach\n1. Create inbox item\n2. Verify it appears in inbox query\n3. Mark as finished via toggleFinished mutation\n4. Verify it NO LONGER appears in inbox query\n5. Verify it STILL appears in library query\n\n### Files\n- `apps/worker/src/trpc/routers/items.ts` - Modify inbox procedure\n\n### Dependencies\nNone - the `isFinished` field already exists in the database and schema\n\n### Acceptance Criteria\n- [ ] Inbox query includes `isFinished = false` filter\n- [ ] Finished items do not appear in inbox results\n- [ ] Unfinished items continue to appear normally\n- [ ] Filter works correctly with pagination","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-31T11:04:33.712603-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-cc1.3","title":"1.2 Backend: Filter completed items from home.jumpBackIn query","description":"## Task: Filter Completed Items from home.jumpBackIn Query\n\n### Purpose\nModify the `items.home` tRPC query to exclude finished items from the \"Jump Back In\" section. Users should only see content they haven't finished when looking to resume.\n\n### Current State\nThe home query at `apps/worker/src/trpc/routers/items.ts:262-345` returns:\n- `recentBookmarks` - recent bookmarked items\n- `jumpBackIn` - items with progress (partially consumed)\n- `byContentType` - videos, podcasts, articles\n\nThe `jumpBackIn` query (lines 281-293) currently:\n- Filters for bookmarked items\n- Filters for items with `progressPosition` (started but not done)\n- Already filters: `isNotNull(userItems.progressPosition)`\n\nBut does NOT filter out `isFinished = true` items.\n\n### Implementation\nAdd `eq(userItems.isFinished, false)` to the jumpBackIn query conditions:\n\n```typescript\nconst jumpBackInQuery = ctx.db\n  .select()\n  .from(userItems)\n  .innerJoin(items, eq(userItems.itemId, items.id))\n  .where(\n    and(\n      ...baseConditions,\n      isNotNull(userItems.progressPosition),\n      eq(userItems.isFinished, false),  // \u003c-- Add this\n    )\n  )\n  .orderBy(desc(userItems.progressUpdatedAt))\n  .limit(SECTION_LIMIT);\n```\n\n### Rationale\n\"Jump Back In\" is for resuming content. If an item is marked as finished:\n- The user explicitly indicated they're done with it\n- Showing it in \"Jump Back In\" would be confusing and redundant\n- It would clutter the section with completed content\n\n### Edge Case: What About recentBookmarks?\nConsider whether `recentBookmarks` should also filter out finished items. Arguments:\n- **Filter**: Keep Home focused on \"what to engage with next\"\n- **Don't Filter**: Recent bookmarks is about what you saved, completion is separate\n\n**Decision**: For MVP, only filter `jumpBackIn`. `recentBookmarks` shows recent saves regardless of completion. This can be revisited based on user feedback.\n\n### Files\n- `apps/worker/src/trpc/routers/items.ts` - Modify home procedure\n\n### Dependencies\n- Depends on understanding from task 1.1 (inbox filtering pattern)\n\n### Acceptance Criteria\n- [ ] jumpBackIn section excludes items where isFinished = true\n- [ ] Items with progress but marked finished don't appear in Jump Back In\n- [ ] recentBookmarks continues to show all recent bookmarks (no change)\n- [ ] byContentType sections continue unchanged","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T11:04:33.773763-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-cc1.4","title":"2.0 Frontend: Wire up check icon to useToggleFinished on item detail page","description":"## Task: Wire Up Check Icon to useToggleFinished on Item Detail Page\n\n### Purpose\nConnect the existing check icon button on the item detail page to the `useToggleFinished()` hook, enabling users to mark items as complete.\n\n### Current State\nIn `apps/mobile/app/item/[id].tsx`:\n\n**Line 33**: Imports only useItem, useBookmarkItem, useUnbookmarkItem (NOT useToggleFinished)\n```typescript\nimport { useItem, useBookmarkItem, useUnbookmarkItem } from '@/hooks/use-items-trpc';\n```\n\n**Lines 212-214**: Handler is a placeholder:\n```typescript\nconst handleToggleFinished = () =\u003e {\n  logger.debug('Toggle finished - not yet implemented');\n};\n```\n\n**Lines 377-386**: Check icon button exists but uses placeholder:\n```typescript\n\u003cPressable\n  onPress={handleToggleFinished}\n  style={({ pressed }) =\u003e [...]}\n\u003e\n  \u003cCheckOutlineIcon size={24} color={colors.textSecondary} /\u003e\n\u003c/Pressable\u003e\n```\n\n### Implementation\n\n1. **Add import**:\n```typescript\nimport { useItem, useBookmarkItem, useUnbookmarkItem, useToggleFinished } from '@/hooks/use-items-trpc';\n```\n\n2. **Add hook call** (after bookmark mutations, ~line 160):\n```typescript\nconst toggleFinishedMutation = useToggleFinished();\n```\n\n3. **Update handler** (replace placeholder):\n```typescript\nconst handleToggleFinished = () =\u003e {\n  if (!item) return;\n  toggleFinishedMutation.mutate({ id: item.id });\n};\n```\n\n4. **Update icon rendering** (line 385):\n```typescript\n{item.isFinished ? (\n  \u003cCheckIcon size={24} color={colors.primary} /\u003e\n) : (\n  \u003cCheckOutlineIcon size={24} color={colors.textSecondary} /\u003e\n)}\n```\n\n5. **Add CheckIcon import** (line 45-50):\n```typescript\nimport {\n  ChevronRightIcon,\n  CheckIcon,       // \u003c-- Add this\n  CheckOutlineIcon,\n  ...\n} from '@/components/icons';\n```\n\n6. **Add disabled state during mutation**:\n```typescript\n\u003cPressable\n  onPress={handleToggleFinished}\n  disabled={toggleFinishedMutation.isPending}\n  style={({ pressed }) =\u003e [\n    styles.actionButton,\n    { backgroundColor: colors.backgroundSecondary },\n    pressed \u0026\u0026 { opacity: 0.7 },\n    toggleFinishedMutation.isPending \u0026\u0026 { opacity: 0.5 },\n  ]}\n\u003e\n```\n\n### Rationale\n- The hook (`useToggleFinished`) already handles:\n  - API call to backend\n  - Optimistic updates to all caches\n  - Error rollback\n- We just need to wire the UI to it\n\n### User Experience\n1. User taps check icon\n2. Icon immediately fills in (optimistic update)\n3. If in Inbox, item will disappear from inbox list when navigating back\n4. Item remains in Library with filled check indicator\n\n### Files\n- `apps/mobile/app/item/[id].tsx`\n- Verify `apps/mobile/components/icons/index.tsx` exports CheckIcon\n\n### Dependencies\n- Task 1.0 (shared types) should be done for type safety\n- Task 1.1 (inbox filter) should be done for full behavior\n\n### Acceptance Criteria\n- [ ] Check icon toggles between filled/outline based on isFinished state\n- [ ] Tapping icon calls toggleFinishedMutation\n- [ ] Button shows disabled state during mutation\n- [ ] Icon updates immediately (optimistic update)\n- [ ] No errors in console","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-31T11:04:33.831374-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-cc1.5","title":"2.1 Frontend: Add haptic feedback to completion toggle","description":"## Task: Add Haptic Feedback to Completion Toggle\n\n### Purpose\nProvide tactile feedback when users mark items as complete, improving the user experience and confirming the action.\n\n### Context\nHaptic feedback is a mobile UX best practice for confirming actions. The completion toggle is a meaningful action that benefits from physical confirmation.\n\n### Implementation\n\n1. **Import Haptics from expo-haptics**:\n```typescript\nimport * as Haptics from 'expo-haptics';\n```\n\n2. **Add haptic feedback in handler**:\n```typescript\nconst handleToggleFinished = async () =\u003e {\n  if (!item) return;\n  \n  // Trigger haptic feedback\n  await Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);\n  \n  toggleFinishedMutation.mutate({ id: item.id });\n};\n```\n\n### Haptic Style Choice\n- `Light` - too subtle for a meaningful action\n- `Medium` - good balance, confirms action without being jarring\n- `Heavy` - too strong for a simple toggle\n\nUsing `Medium` for consistency with other app interactions.\n\n### Platform Considerations\n- `expo-haptics` handles platform differences automatically\n- iOS: Uses UIImpactFeedbackGenerator\n- Android: Uses VibrationEffect (API 26+) or Vibrator\n- Web: Falls back gracefully (no-op)\n\n### Alternative: Selection Feedback\nCould also use `Haptics.selectionAsync()` which is even lighter. However, since this is a toggle that changes state (not just selection), impact feedback is more appropriate.\n\n### Files\n- `apps/mobile/app/item/[id].tsx`\n\n### Dependencies\n- Task 2.0 must be complete (toggle wiring exists)\n- `expo-haptics` should already be installed (it's part of Expo SDK)\n\n### Acceptance Criteria\n- [ ] Haptic feedback triggers when tapping check icon\n- [ ] Feedback feels appropriate (not too strong, not too weak)\n- [ ] Works on both iOS and Android\n- [ ] No errors if haptics unavailable\n\n### Notes\n- Check if expo-haptics is already in package.json\n- If not installed, run: `npx expo install expo-haptics`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T11:04:33.891378-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-cc1.6","title":"3.0 UI: Add completion indicator to ItemCard component","description":"## Task: Add Completion Indicator to ItemCard Component\n\n### Purpose\nDisplay a visual indicator on item cards when an item has been marked as complete. This provides at-a-glance feedback in list views.\n\n### Current State\n`apps/mobile/components/item-card.tsx` renders cards in three variants:\n- `compact` - Used in Library and some Home sections\n- `full` - Used in Inbox\n- `large` - Used in Home \"Jump Back In\"\n\nCurrently no visual indication of completion status.\n\n### Design Options\n\n**Option A: Checkmark Badge (Recommended)**\nAdd a small filled checkmark badge in the corner of completed items:\n```typescript\n{/* Completion indicator */}\n{item.isFinished \u0026\u0026 (\n  \u003cView style={[styles.completionBadge, { backgroundColor: colors.success }]}\u003e\n    \u003cCheckIcon size={12} color=\"#fff\" /\u003e\n  \u003c/View\u003e\n)}\n```\n\n**Option B: Opacity Reduction**\nReduce opacity of completed items:\n```typescript\nconst cardOpacity = item.isFinished ? 0.6 : 1;\n```\n\n**Option C: Border/Accent Color**\nAdd a colored border to completed items.\n\n### Recommendation: Option A (Checkmark Badge)\n- Clear, unambiguous indication\n- Doesn't reduce readability\n- Consistent with other apps (podcasts, videos)\n- Works well with all three variants\n\n### Implementation\n\n1. **Add to ItemCardData interface** (handled in task 3.1):\n```typescript\nisFinished?: boolean;\n```\n\n2. **Add badge styles**:\n```typescript\ncompletionBadge: {\n  position: 'absolute',\n  top: Spacing.xs,\n  right: Spacing.xs,\n  width: 20,\n  height: 20,\n  borderRadius: 10,\n  alignItems: 'center',\n  justifyContent: 'center',\n  backgroundColor: Colors.light.success, // Will be themed\n},\n```\n\n3. **Add to each variant's thumbnail section**:\nFor compact (line ~170):\n```typescript\n{/* Completion indicator */}\n{item.isFinished \u0026\u0026 (\n  \u003cView style={[styles.completionBadge, { backgroundColor: colors.success }]}\u003e\n    \u003cCheckIcon size={10} color=\"#fff\" /\u003e\n  \u003c/View\u003e\n)}\n```\n\n4. **Import CheckIcon**:\n```typescript\nimport { ArchiveIcon, BookmarkIcon, CheckIcon } from '@/components/icons';\n```\n\n### Positioning\n- **compact variant**: Top-right of thumbnail (like duration badge but opposite corner)\n- **full variant**: Top-right of thumbnail container\n- **large variant**: Top-right of thumbnail\n\n### Color\nUse `colors.success` (typically green) to indicate positive completion. This creates visual distinction from:\n- Provider dot (various colors)\n- Type indicator (content type colors)\n- Duration badge (black/dark)\n\n### Files\n- `apps/mobile/components/item-card.tsx`\n\n### Dependencies\n- Task 3.1 (ItemCardData interface update) should be done first\n- CheckIcon must be exported from icons\n\n### Acceptance Criteria\n- [ ] Completed items show checkmark badge in all three variants\n- [ ] Badge positioned consistently (top-right of thumbnail)\n- [ ] Badge color is success/green\n- [ ] Badge doesn't overlap with other indicators\n- [ ] Uncompleted items show no badge","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T11:04:33.951604-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-cc1.7","title":"3.1 UI: Update ItemCardData interface to include isFinished","description":"## Task: Update ItemCardData Interface to Include isFinished\n\n### Purpose\nExtend the `ItemCardData` interface and update all transform functions that create card data to include the `isFinished` field. This enables the ItemCard component to render completion indicators.\n\n### Current State\n\n**ItemCardData interface** (`apps/mobile/components/item-card.tsx:48-58`):\n```typescript\nexport interface ItemCardData {\n  id: string;\n  title: string;\n  creator: string;\n  thumbnailUrl: string | null;\n  contentType: ContentType;\n  provider: Provider;\n  duration?: number | null;\n  bookmarkedAt?: string | null;\n  publishedAt?: string | null;\n}\n```\n\nMissing: `isFinished?: boolean`\n\n### Files That Create ItemCardData\n\n1. **`apps/mobile/app/(tabs)/inbox.tsx`** (lines 109-119):\n```typescript\nconst inboxItems: ItemCardData[] = (data?.items ?? []).map((item) =\u003e ({\n  id: item.id,\n  title: item.title,\n  // ... other fields\n  // Missing: isFinished: item.isFinished,\n}));\n```\n\n2. **`apps/mobile/app/(tabs)/index.tsx`** (lines 61-82):\n```typescript\nfunction transformToItemCardData({ item, userItem }: ItemWithUserState): ItemCardData {\n  return {\n    id: userItem.id,\n    // ... other fields\n    // Missing: isFinished: ???\n  };\n}\n```\n\nNote: This function uses Replicache data which may not have isFinished. Need to handle.\n\n### Implementation\n\n1. **Update ItemCardData interface**:\n```typescript\nexport interface ItemCardData {\n  id: string;\n  title: string;\n  creator: string;\n  thumbnailUrl: string | null;\n  contentType: ContentType;\n  provider: Provider;\n  duration?: number | null;\n  bookmarkedAt?: string | null;\n  publishedAt?: string | null;\n  isFinished?: boolean;  // \u003c-- Add this\n}\n```\n\n2. **Update inbox.tsx transform** (line 119):\n```typescript\nisFinished: item.isFinished,\n```\n\n3. **Update index.tsx transform**:\nThis uses Replicache data which may not have isFinished tracked.\nFor now, default to false or omit:\n```typescript\nisFinished: false, // Replicache data doesn't track this yet\n```\n\nOr better, check if the data source provides it:\n```typescript\nisFinished: (userItem as any).isFinished ?? false,\n```\n\n### Data Flow Understanding\n\n**tRPC data** (inbox.tsx):\n- Comes from `useInboxItems()` → `items.inbox` query\n- Already includes `isFinished` in `ItemView` type\n- Just needs mapping\n\n**Replicache data** (index.tsx Home page):\n- Comes from `useBookmarkedItems()` which uses local Replicache store\n- Replicache schema may not include `isFinished`\n- Need to verify Replicache schema or handle gracefully\n\n### Replicache Consideration\nThe home page uses both:\n- Replicache hooks (`useBookmarkedItems`, `useInboxItems` from `use-items.ts`)\n- tRPC hooks (`useHomeData`, `useTRPCLibraryItems`)\n\nThe tRPC data already has `isFinished`. The Replicache data may not.\n\n**Recommendation**: Since we're incrementally moving from Replicache to tRPC, default `isFinished` to `false` for Replicache data. This prevents errors and provides correct behavior (unfinished items show no badge).\n\n### Files\n- `apps/mobile/components/item-card.tsx` - Interface update\n- `apps/mobile/app/(tabs)/inbox.tsx` - Transform update\n- `apps/mobile/app/(tabs)/index.tsx` - Transform update (with fallback)\n\n### Dependencies\n- Task 1.0 (shared types) for consistency\n- Should be done before Task 3.0 (visual indicator)\n\n### Acceptance Criteria\n- [ ] ItemCardData interface includes `isFinished?: boolean`\n- [ ] Inbox transform maps isFinished from API response\n- [ ] Home page transforms handle missing isFinished gracefully\n- [ ] TypeScript compiles without errors\n- [ ] No runtime errors when rendering cards","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T11:04:34.012066-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-cc1.8","title":"4.0 Testing: Verify inbox filtering excludes completed items","description":"## Task: Verify Inbox Filtering Excludes Completed Items\n\n### Purpose\nTest and verify that the inbox filtering (Task 1.1) correctly excludes completed items. This is a verification/testing task, not implementation.\n\n### Testing Approach\n\n**Manual Testing Steps**:\n1. Start with a user who has items in INBOX state\n2. Verify items appear in inbox via the app\n3. Mark an item as finished (using item detail page)\n4. Navigate back to inbox\n5. Verify the item no longer appears\n6. Navigate to Library\n7. Verify the item still appears there\n\n**API Testing**:\nUse the tRPC client or direct API calls:\n```typescript\n// 1. Get inbox items - note the count\nconst before = await trpc.items.inbox.query();\nconsole.log('Before:', before.items.length);\n\n// 2. Mark one as finished\nawait trpc.items.toggleFinished.mutate({ id: before.items[0].id });\n\n// 3. Get inbox items again\nconst after = await trpc.items.inbox.query();\nconsole.log('After:', after.items.length);\n\n// 4. Should be one less\nassert(after.items.length === before.items.length - 1);\n```\n\n### Edge Cases to Test\n\n1. **Pagination boundary**: What if the completed item was on a pagination boundary?\n   - Should work correctly as filtering happens at query level\n\n2. **Re-marking as incomplete**: Can a user un-complete an item?\n   - Toggle should work both ways\n   - Item should reappear in inbox if still in INBOX state\n\n3. **Completion + state change**: What if item is completed AND archived?\n   - Should not appear in inbox (filtered by both)\n\n4. **Empty inbox after completion**: If last item is completed\n   - Should show empty state gracefully\n\n### Database Verification\nQuery D1 directly to verify:\n```sql\nSELECT id, state, is_finished \nFROM user_items \nWHERE user_id = ? AND state = 'INBOX'\nORDER BY ingested_at DESC;\n```\n\nCompare with API response to ensure filtering is correct.\n\n### Files to Review\n- `apps/worker/src/trpc/routers/items.ts` - Verify filter implementation\n\n### Dependencies\n- Task 1.1 must be complete\n\n### Acceptance Criteria\n- [ ] Completed items do not appear in inbox query results\n- [ ] Uncompleted items continue to appear\n- [ ] Un-completing an item makes it reappear\n- [ ] Pagination works correctly with filter\n- [ ] Empty state handles edge case\n- [ ] No N+1 query issues","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T11:04:34.072931-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-cc1.9","title":"4.1 Testing: Verify optimistic updates and error rollback","description":"## Task: Verify Optimistic Updates and Error Rollback\n\n### Purpose\nTest and verify that the `useToggleFinished()` hook correctly handles optimistic updates and error rollback scenarios.\n\n### Current Implementation Review\nFrom `apps/mobile/hooks/use-items-trpc.ts:455-479`:\n\n```typescript\nexport function useToggleFinished() {\n  const utils = trpc.useUtils();\n\n  const toggleFinished = \u003cT extends { id: string; isFinished: boolean; finishedAt: string | null }\u003e(\n    item: T,\n    targetId: string\n  ): T =\u003e {\n    if (item.id !== targetId) return item;\n    const now = new Date().toISOString();\n    return {\n      ...item,\n      isFinished: !item.isFinished,\n      finishedAt: item.isFinished ? null : now,\n    };\n  };\n\n  return trpc.items.toggleFinished.useMutation(\n    createOptimisticConfig(utils, {\n      updateInbox: (items, { id }) =\u003e items.map((item) =\u003e toggleFinished(item, id)),\n      updateLibrary: (items, { id }) =\u003e items.map((item) =\u003e toggleFinished(item, id)),\n      updateSingleItem: (item, { id }) =\u003e toggleFinished(item, id),\n    })\n  );\n}\n```\n\n### What Should Happen\n\n**Optimistic Update (Success Path)**:\n1. User taps check icon\n2. UI immediately updates (icon fills, caches update)\n3. API call succeeds\n4. Caches invalidate and refetch with server data\n5. Final state matches optimistic state\n\n**Error Rollback (Failure Path)**:\n1. User taps check icon\n2. UI immediately updates (optimistic)\n3. API call fails (network error, server error, etc.)\n4. `onError` callback fires\n5. Previous cache state restored (rollback)\n6. UI reverts to original state\n\n### Testing Scenarios\n\n**1. Normal Success**:\n- Toggle item\n- Verify immediate UI update\n- Verify server confirms change\n- Verify final state is correct\n\n**2. Network Failure**:\n- Put device in airplane mode\n- Toggle item\n- Verify UI updates optimistically\n- Verify UI reverts when request fails\n- Verify error handling (toast, etc.)\n\n**3. Server Error**:\n- Simulate 500 error from server\n- Verify rollback occurs\n- Verify error message shown\n\n**4. Rapid Toggle**:\n- Toggle item on/off quickly\n- Verify no race conditions\n- Verify final state is correct\n\n**5. Multi-cache Consistency**:\n- View item in inbox\n- Toggle finished\n- Navigate to Library\n- Verify item shows correct state in Library\n- Navigate to item detail\n- Verify detail shows correct state\n\n### Implementation Verification\nCheck that `createOptimisticConfig` correctly:\n1. Cancels in-flight queries before mutation\n2. Snapshots previous state\n3. Applies optimistic update\n4. Rolls back on error\n5. Invalidates queries on settle\n\n### Files to Review\n- `apps/mobile/hooks/use-items-trpc.ts` - Hook implementation\n- Specifically the `createOptimisticConfig` factory function (lines 78-158)\n\n### Dependencies\n- Task 2.0 must be complete (toggle wired up)\n\n### Acceptance Criteria\n- [ ] UI updates immediately when toggling (optimistic)\n- [ ] UI reverts on error (rollback)\n- [ ] All caches stay in sync (inbox, library, single item)\n- [ ] Rapid toggling doesn't cause issues\n- [ ] Error states handled gracefully","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T11:04:34.137318-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ds3","title":"Issue #7: New Issue Prompt - Single-Prompt Issue Creation with AI-Generated Title/Description","description":"## Overview\n\nTransform the issue creation workflow from a traditional \"Title + Description\" form into a streamlined single-prompt experience where the user describes what they want, and an AI agent automatically generates a proper GitHub issue title and comprehensive description.\n\n## Background \u0026 Motivation\n\n### Current State\nThe existing `NewIssueDialog` component (`src/components/new-issue-dialog/NewIssueDialog.tsx`) requires users to manually enter an issue title. The backend creates an issue with an empty body. This creates friction because:\n1. Users have to think about proper issue formatting upfront\n2. The resulting issues often lack comprehensive descriptions\n3. There's no AI assistance in the issue creation process\n\n### Desired State\nUsers simply describe what they want to explore or build in natural language. The system:\n1. Creates a GitHub issue immediately (with placeholder content for instant feedback)\n2. Spawns an AI agent to explore the user's intent\n3. The agent updates the issue with a well-crafted title and detailed description\n4. The user sees live updates as the agent works\n\n### Why This Matters for Maestro\nMaestro's core philosophy is \"ideation-first\" (see SCOPE.md). This change aligns perfectly:\n- Reduces friction at the entry point of the ideation workflow\n- Demonstrates AI-assisted issue creation as a first-class feature\n- Sets up the pattern for AI agents to own and update GitHub issues\n- Creates a natural bridge from rough idea → formalized issue → planning → execution\n\n## Technical Approach\n\n### Data Flow\n```\nUser enters prompt → Frontend POSTs to /api/projects/[id]/issues\n                              ↓\nBackend creates GitHub issue with:\n  - Title: First ~80 chars of prompt (or \"New Issue\")\n  - Body: \"Generating description...\"\n                              ↓\nBackend creates OpenCode session\nBackend calls injectContext() with instructions\nBackend calls sendMessageWithBashAsync() with user's prompt\n                              ↓\nBackend returns issue number (fast response)\nFrontend navigates to /project/[id]/issue/[issueNumber]\n                              ↓\nAgent explores codebase based on prompt\nAgent runs: gh issue edit [number] --title \"...\" --body \"...\"\n                              ↓\nUser sees updated issue (via existing refresh mechanism)\n```\n\n### Key Design Decisions\n\n1. **Immediate Issue Creation**: Don't wait for AI to finish before creating the issue. Creates it with placeholder content so user has instant feedback and a stable URL to navigate to.\n\n2. **Async Agent Work**: Use `sendMessageWithBashAsync()` (already exists in opencode.ts) so the API returns quickly. The agent works in the background.\n\n3. **Bash-Only Tool Access**: Agent gets `bash: true, write: false, edit: false`. It can run `gh issue edit` but cannot modify project files. This is issue ideation, not implementation.\n\n4. **Session Persistence**: Save the session mapping so the issue page can show the conversation. Users can see the agent's reasoning about how it crafted the issue.\n\n5. **Title Truncation Strategy**: Use first 80 chars of prompt as initial title. Agent will craft a proper imperative-mood title. If prompt is too short, it becomes the title directly.\n\n## Acceptance Criteria\n\n- [ ] Modal shows single \"Prompt\" textarea instead of \"Title\" input\n- [ ] Prompt textarea has appropriate placeholder and minimum height\n- [ ] GitHub issue is created immediately with placeholder body\n- [ ] OpenCode session is created and linked to the issue\n- [ ] Agent receives context instructing it to update title AND description\n- [ ] Agent updates issue via `gh issue edit` with both `--title` and `--body`\n- [ ] User is navigated to issue page after creation\n- [ ] Session is saved so issue page shows the conversation\n- [ ] Error handling for gh CLI failures, OpenCode failures, etc.\n\n## Files Involved\n\n| File | Role |\n|------|------|\n| `src/components/new-issue-dialog/NewIssueDialog.tsx` | UI component - change from Input to Textarea |\n| `src/app/api/projects/[id]/issues/route.ts` | API handler - add session creation, context injection |\n| `src/lib/services/sessions.ts` | Session storage - already has saveSession() |\n| `src/lib/services/opencode.ts` | OpenCode client - already has required methods |\n\n## Dependencies\n\nThis epic depends on:\n- Existing OpenCode service methods (injectContext, sendMessageWithBashAsync)\n- Existing session storage service\n- gh CLI being configured on the user's machine\n\nThis epic enables future work:\n- Issue page showing the AI conversation alongside issue details\n- \"Regenerate description\" button on issue page\n- Multi-turn refinement of issue content","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-31T09:50:41.936982-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:56:50.75183-06:00","deleted_at":"2025-12-31T09:56:50.75183-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-ds3.1","title":"T1: Frontend - Replace title input with prompt textarea in NewIssueDialog","description":"## Task: Frontend UI Changes\n\nTransform the `NewIssueDialog` from a title-based input to a prompt-based textarea.\n\n### Current Implementation\n```tsx\nconst [title, setTitle] = useState(\"\");\n// ...\n\u003cLabel htmlFor=\"issue-title\"\u003eTitle\u003c/Label\u003e\n\u003cInput\n  id=\"issue-title\"\n  value={title}\n  onChange={(e) =\u003e setTitle(e.target.value)}\n  placeholder=\"What would you like to explore?\"\n  // ...\n/\u003e\n```\n\n### Required Changes\n\n1. **State Variable Rename**\n   - Change `title` → `prompt`\n   - Change `setTitle` → `setPrompt`\n\n2. **UI Component Swap**\n   - Replace `\u003cInput\u003e` with `\u003cTextarea\u003e` (already imported in shadcn/ui)\n   - Add `min-h-[100px]` for adequate vertical space\n   - Update `id` to `issue-prompt`\n\n3. **Label and Placeholder Updates**\n   - Label: \"Prompt\" or \"What do you want to build?\"\n   - Placeholder: \"Describe what you want to build or explore...\"\n\n4. **Request Body Change**\n   ```tsx\n   body: JSON.stringify({ \n     prompt: prompt.trim(),  // Changed from title\n     projectPath,\n   }),\n   ```\n\n5. **Button Text (Optional)**\n   - Consider changing \"Create Issue\" → \"Create\" or \"Start\" to be more action-oriented\n\n6. **Dialog Description Update**\n   - Update `\u003cDialogDescription\u003e` to reflect new flow:\n     \"Describe your idea and the agent will create a detailed GitHub issue.\"\n\n### Technical Notes\n- No new imports needed - `Textarea` should already be available from `@/components/ui/textarea`\n- Keep the form submission logic the same\n- Keep error handling the same (just different field name)\n\n### Acceptance Criteria\n- [ ] Textarea replaces Input\n- [ ] Minimum height of 100px\n- [ ] Appropriate placeholder text\n- [ ] Request body sends `prompt` instead of `title`\n- [ ] Dialog description updated to explain new flow","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T09:50:41.995449-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:56:50.75183-06:00","deleted_at":"2025-12-31T09:56:50.75183-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ds3.2","title":"T2: Backend - Extract prompt and generate initial title in POST handler","description":"## Task: Backend Prompt Extraction and Initial Title Generation\n\nUpdate the POST handler to accept a `prompt` field and generate an initial issue title.\n\n### Current Implementation\n```typescript\nconst { title } = body;\nif (!title || typeof title !== \"string\") {\n  return NextResponse.json({ error: \"Title is required\" }, { status: 400 });\n}\nconst escapedTitle = title.replace(/\"/g, '\\\\\"');\nawait execAsync(`gh issue create --title \"${escapedTitle}\" --body \"\"`);\n```\n\n### Required Changes\n\n1. **Extract Prompt Instead of Title**\n   ```typescript\n   const { prompt } = body;\n   if (!prompt || typeof prompt !== \"string\") {\n     return NextResponse.json({ error: \"Prompt is required\" }, { status: 400 });\n   }\n   ```\n\n2. **Generate Initial Title from Prompt**\n   ```typescript\n   // Generate initial title: truncate at 80 chars or use full prompt if shorter\n   const initialTitle = prompt.length \u003e 80 \n     ? prompt.substring(0, 77).trim() + \"...\" \n     : prompt;\n   ```\n\n3. **Create Issue with Placeholder Body**\n   ```typescript\n   const escapedTitle = initialTitle.replace(/\"/g, '\\\\\"');\n   const { stdout: createStdout } = await execAsync(\n     `gh issue create --title \"${escapedTitle}\" --body \"Generating description...\"`,\n     { cwd }\n   );\n   ```\n\n### Design Decisions\n\n**Why 80 characters for title truncation?**\n- GitHub allows up to 256 chars but recommends keeping titles concise\n- 80 chars is roughly one line in most GitHub UI views\n- Ellipsis indicates the full content is being processed\n\n**Why \"Generating description...\" as placeholder?**\n- Signals to the user that work is in progress\n- If the agent fails, users can still edit the issue manually\n- Better than an empty body which might confuse users\n\n### Technical Notes\n- Title escaping is critical for shell safety\n- Consider edge cases: very short prompts, prompts with special characters\n- The `--body` flag should use a simple string, no need for multiline\n\n### Acceptance Criteria\n- [ ] Handler extracts `prompt` from request body\n- [ ] Validation returns 400 if prompt is missing/invalid\n- [ ] Initial title is generated (truncated at 80 chars)\n- [ ] Issue is created with \"Generating description...\" body\n- [ ] Special characters in prompt are properly escaped","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T09:50:42.052942-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:56:50.75183-06:00","deleted_at":"2025-12-31T09:56:50.75183-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ds3.3","title":"T3: Backend - Create OpenCode session after issue creation","description":"## Task: Create OpenCode Session After Issue Creation\n\nAfter creating the GitHub issue, create an OpenCode session that will be used to generate the issue content.\n\n### Context\nThe OpenCode service already has the `createSession()` method we need:\n```typescript\nasync createSession(projectPath: string, title: string): Promise\u003c{ id: string }\u003e\n```\n\n### Required Changes\n\nAdd session creation after successfully parsing the issue number:\n\n```typescript\n// After extracting issueNumber from URL...\nconst issueNumber = urlMatch[1];\n\n// Import at top of file\nimport { openCodeService } from \"@/lib/services/opencode\";\n\n// Create OpenCode session for this issue\nconst session = await openCodeService.createSession(\n  cwd,\n  `Issue #${issueNumber} - Generation`\n);\n```\n\n### Design Decisions\n\n**Session Title Convention**\n- Format: `Issue #${issueNumber} - Generation`\n- Distinguishes from the discussion session that may be created later on the issue page\n- Clear indication of purpose when viewing session list\n\n**Error Handling Strategy**\n- If session creation fails, the issue is already created\n- We should log the error but still return the issue\n- The user can refresh the issue page to trigger a new session later\n\n### Technical Notes\n- The `cwd` variable (project.path) is already available in scope\n- Session creation is fast (just creates an ID)\n- No need to wait for any AI response yet\n\n### Acceptance Criteria\n- [ ] OpenCode service is imported\n- [ ] Session is created after issue creation succeeds\n- [ ] Session title includes issue number\n- [ ] Error in session creation doesn't fail the entire request","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T09:50:42.110527-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:56:50.75183-06:00","deleted_at":"2025-12-31T09:56:50.75183-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ds3.4","title":"T4: Backend - Inject context with issue update instructions","description":"## Task: Inject Context with Issue Update Instructions\n\nInject system context into the session that instructs the agent on how to update the GitHub issue.\n\n### Context\nThe OpenCode service has `injectContext()` which adds context without triggering a response:\n```typescript\nasync injectContext(projectPath: string, sessionId: string, context: string): Promise\u003cvoid\u003e\n```\n\n### Required Implementation\n\n```typescript\nawait openCodeService.injectContext(cwd, session.id, `\nYou are helping create GitHub issue #${issueNumber} in this repository.\n\nThe user has described what they want to build or explore. Your job is to:\n1. Understand their intent by exploring the codebase if needed\n2. Craft a clear, concise issue TITLE (imperative mood, e.g., \"Add dark mode toggle to settings\")\n3. Write a comprehensive issue DESCRIPTION with proper markdown formatting\n\n## Description Structure\nInclude relevant sections based on the request:\n- **Summary**: 1-2 sentence overview\n- **Background/Motivation**: Why this matters (if applicable)\n- **Requirements/Goals**: What needs to be accomplished\n- **Technical Approach**: High-level implementation strategy (if technical)\n- **Acceptance Criteria**: Checklist of what \"done\" looks like\n- **Files/Areas Affected**: Which parts of codebase are involved (if known)\n\n## Important Instructions\n- Use \\`gh issue edit ${issueNumber} --title \"your title\" --body \"your markdown body\"\\`\n- The body should be valid markdown\n- Be thorough but concise - this issue should be actionable\n- If the request is vague, make reasonable assumptions and state them\n- DO NOT modify any code files - this is ideation only\n\n## Shell Escaping\nWhen using gh issue edit, ensure proper escaping:\n- Use single quotes around the body if it contains double quotes\n- Or escape double quotes with backslash\n- Newlines in body should work directly in the command\n`);\n```\n\n### Design Decisions\n\n**Why Imperative Mood for Titles?**\n- GitHub convention: \"Add feature\" not \"Adding feature\" or \"Feature added\"\n- Reads as a command, which is what issues represent\n\n**Why Detailed Section Structure?**\n- Provides consistent issue quality across the project\n- Helps agents create actionable, well-organized issues\n- Users know what to expect when viewing issues\n\n**Why Explicit Shell Escaping Instructions?**\n- Multi-line bodies with special characters can fail `gh` commands\n- Agent needs guidance on proper escaping\n- Prevents common failure modes\n\n### Technical Notes\n- `injectContext()` uses `noReply: true` and `synthetic: true`\n- This context becomes part of the conversation but doesn't trigger a response\n- Agent sees this when processing the user's actual prompt\n\n### Acceptance Criteria\n- [ ] Context is injected with clear instructions\n- [ ] Instructions specify how to use `gh issue edit`\n- [ ] Description structure guidance is provided\n- [ ] Shell escaping guidance is included\n- [ ] Context emphasizes no code modification","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T09:50:42.167859-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:56:50.75183-06:00","deleted_at":"2025-12-31T09:56:50.75183-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ds3.5","title":"T5: Backend - Send user prompt via sendMessageWithBashAsync","description":"## Task: Send User Prompt via sendMessageWithBashAsync\n\nAfter injecting context, send the user's original prompt to trigger the agent to start working.\n\n### Context\nThe OpenCode service has `sendMessageWithBashAsync()` which is perfect for this use case:\n```typescript\nasync sendMessageWithBashAsync(\n  projectPath: string,\n  sessionId: string,\n  message: string\n): Promise\u003cvoid\u003e\n```\n\nThis method:\n- Uses `promptAsync` (fire-and-forget, returns immediately)\n- Enables `bash: true` (agent can run `gh issue edit`)\n- Disables `write: false, edit: false` (no code modifications)\n\n### Required Implementation\n\n```typescript\n// After injectContext...\n\n// Send the user's prompt - this triggers the agent to start working\nawait openCodeService.sendMessageWithBashAsync(cwd, session.id, prompt);\n```\n\n### What Happens Next (Not Our Concern Here)\n1. Agent receives the prompt\n2. Agent reads the injected context (instructions)\n3. Agent explores codebase if needed (`bash` commands like `ls`, `cat`, etc.)\n4. Agent crafts title and description\n5. Agent runs `gh issue edit ${issueNumber} --title \"...\" --body \"...\"`\n6. Issue is updated (user will see on refresh)\n\n### Design Decisions\n\n**Why Async?**\n- The API should return quickly (user sees issue page immediately)\n- Agent work happens in background\n- User can watch the conversation unfold on the issue page\n\n**Why sendMessageWithBashAsync Specifically?**\n- Matches our use case exactly: bash access, no file editing\n- Already exists and is tested\n- No need to create a new method\n\n**Order of Operations**\n1. Create issue (must succeed)\n2. Create session (should succeed, but handle failure gracefully)\n3. Inject context (should succeed)\n4. Send prompt (fire-and-forget)\n5. Return issue data to frontend\n\n### Technical Notes\n- `promptAsync` is truly async - it returns before agent processes\n- If this call fails, the session is still valid for later use\n- The prompt IS the user's intent, sent verbatim\n\n### Acceptance Criteria\n- [ ] User's prompt is sent via sendMessageWithBashAsync\n- [ ] Call happens after context injection\n- [ ] API returns immediately (doesn't wait for agent)\n- [ ] Errors don't fail the entire request","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T09:50:42.224498-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:56:50.75183-06:00","deleted_at":"2025-12-31T09:56:50.75183-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ds3.6","title":"T6: Backend - Save session mapping for issue page to display conversation","description":"## Task: Save Session Mapping for Issue Page\n\nPersist the session-to-issue mapping so the issue page can display the AI conversation.\n\n### Context\nThe session storage service already has `saveSession()`:\n```typescript\nasync saveSession(\n  projectId: string,\n  projectPath: string,\n  issueNumber: number,\n  sessionId: string\n): Promise\u003cSessionMapping\u003e\n```\n\nThis saves to `~/.maestro/sessions.json` and is used by the issue page to find existing sessions.\n\n### Required Implementation\n\n```typescript\n// Import at top\nimport { sessionStorage } from \"@/lib/services/sessions\";\n\n// After sending the prompt...\nawait sessionStorage.saveSession(\n  id,            // projectId from route params\n  cwd,           // project.path\n  parseInt(issueNumber),\n  session.id\n);\n```\n\n### Why This Matters\n\nWhen the user navigates to `/project/[id]/issue/[issueNumber]`:\n1. The issue page's `useChatSession` hook looks for an existing session\n2. It calls `sessionStorage.getSession(projectId, parseInt(issueNumber))`\n3. If found, it connects to that session and shows the conversation\n4. If not found, it creates a new session\n\nBy saving the session we created during issue creation:\n- User immediately sees the AI conversation that generated their issue\n- No duplicate sessions are created\n- The \"generation\" conversation is preserved for reference\n\n### Technical Notes\n- `issueNumber` is a string from URL parsing, needs `parseInt()`\n- `saveSession` handles both create and update\n- The session type defaults to 'discussion' which is what we want\n- This uses atomic file writes (temp file + rename)\n\n### Edge Cases\n- What if save fails? Log error, don't fail the request\n- The session is still valid, just won't be linked\n- User can still see the issue (just won't have pre-populated chat)\n\n### Acceptance Criteria\n- [ ] Session storage is imported\n- [ ] Session mapping is saved after prompt is sent\n- [ ] Uses correct types (parseInt for issueNumber)\n- [ ] Errors don't fail the request","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T09:50:42.281452-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:56:50.75183-06:00","deleted_at":"2025-12-31T09:56:50.75183-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ds3.7","title":"T7: Error Handling - Add comprehensive error handling for OpenCode and gh CLI failures","description":"## Task: Comprehensive Error Handling\n\nAdd proper error handling for the new session-related operations without breaking the core issue creation flow.\n\n### Error Handling Philosophy\n\n**Tier 1 - Critical (Must Succeed)**\n- GitHub issue creation\n- If this fails, return error to user\n\n**Tier 2 - Important but Non-Blocking**\n- OpenCode session creation\n- Context injection\n- Prompt sending\n- Session storage\n- If these fail, log error and continue\n\n### Backend Error Handling\n\n```typescript\n// POST handler structure\n\ntry {\n  // 1. Create GitHub issue (CRITICAL)\n  // If this fails, throw and return error\n\n  const issueNumber = urlMatch[1];\n\n  // 2. AI enhancement (NON-BLOCKING)\n  try {\n    const session = await openCodeService.createSession(cwd, `Issue #${issueNumber} - Generation`);\n    \n    await openCodeService.injectContext(cwd, session.id, contextInstructions);\n    await openCodeService.sendMessageWithBashAsync(cwd, session.id, prompt);\n    await sessionStorage.saveSession(id, cwd, parseInt(issueNumber), session.id);\n  } catch (sessionError) {\n    // Log but don't fail the request\n    console.error(`Failed to set up AI session for issue #${issueNumber}:`, sessionError);\n    // Issue is created, user can still use it\n  }\n\n  // 3. Return success\n  return NextResponse.json(issue, { status: 201 });\n\n} catch (error) {\n  // Handle GitHub issue creation failures\n  // (existing error handling)\n}\n```\n\n### Frontend Error Handling\n\nThe frontend already has error handling that displays messages to users:\n```tsx\n} catch (err) {\n  setError(err instanceof Error ? err.message : \"Failed to create issue\");\n}\n```\n\nThis should continue to work - we just need to ensure the backend returns appropriate error messages.\n\n### Specific Error Cases\n\n1. **OpenCode not running**\n   - Session creation fails\n   - Log error, issue still created\n   - User can discuss on issue page (new session will be created)\n\n2. **Context injection fails**\n   - Rare, but possible\n   - Agent won't have instructions, but session is valid\n   - Issue is still created\n\n3. **promptAsync fails**\n   - Agent won't start working\n   - Session exists but idle\n   - Issue has placeholder content\n\n4. **Session storage fails**\n   - Session exists but not linked\n   - Issue page will create a new session\n   - Duplicate sessions, but not broken\n\n### Technical Notes\n- Use try-catch around the session block, not individual calls\n- Log with enough context to debug (issue number, project id)\n- Consider adding a `warning` field to response if AI setup failed\n\n### Acceptance Criteria\n- [ ] Critical path (issue creation) fails properly with user feedback\n- [ ] Non-critical path (session setup) doesn't block issue creation\n- [ ] Errors are logged with context\n- [ ] User-facing error messages are helpful","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T09:50:42.337918-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:56:50.75183-06:00","deleted_at":"2025-12-31T09:56:50.75183-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ds3.8","title":"T8: Integration Testing - Verify end-to-end flow works correctly","description":"## Task: Integration Testing\n\nVerify the complete end-to-end flow works correctly in various scenarios.\n\n### Test Scenarios\n\n#### Happy Path\n1. Open project overview\n2. Click \"New Issue\" (or equivalent)\n3. Enter prompt: \"Add a dark mode toggle to the settings page\"\n4. Click Create\n5. Verify:\n   - Navigated to issue page immediately\n   - Issue exists in GitHub with placeholder body\n   - Chat panel shows AI conversation starting\n   - Agent eventually updates issue title and body\n   - Refreshing issue shows updated content\n\n#### Short Prompt\n1. Enter prompt: \"Fix bug\"\n2. Verify:\n   - Issue title is \"Fix bug\" (no truncation needed)\n   - Agent still generates comprehensive description\n\n#### Long Prompt\n1. Enter prompt with 200+ characters describing a complex feature\n2. Verify:\n   - Issue title is truncated to ~80 chars with ellipsis\n   - Full prompt visible in chat\n   - Agent understands full context\n\n#### Special Characters\n1. Enter prompt with quotes, newlines, backticks\n2. Verify:\n   - Issue is created without shell injection\n   - Agent handles escaping properly when updating\n\n#### OpenCode Not Running\n1. Stop OpenCode server\n2. Create issue\n3. Verify:\n   - Issue is still created in GitHub\n   - Error is logged (check console)\n   - User can still view issue\n   - Discussing on issue page creates new session\n\n#### Network Failure Mid-Request\n1. Simulate network issues\n2. Verify:\n   - Appropriate error message displayed\n   - User can retry\n   - No partial state left behind\n\n### Manual Verification Checklist\n- [ ] UI shows textarea instead of input\n- [ ] Placeholder text is appropriate\n- [ ] Create button is disabled when textarea is empty\n- [ ] Loading state shown during creation\n- [ ] Navigation to issue page works\n- [ ] Issue appears in GitHub (check github.com)\n- [ ] Chat shows agent's work\n- [ ] Issue is updated within reasonable time (~30-60 seconds)\n- [ ] Refreshing issue shows AI-generated content\n\n### Automated Testing (Future)\nConsider adding:\n- Unit tests for title truncation logic\n- Integration tests for API endpoint\n- E2E tests with Playwright/Cypress\n\n### Technical Notes\n- OpenCode needs to be running for full flow\n- gh CLI needs to be authenticated\n- May need to clean up test issues after testing\n\n### Acceptance Criteria\n- [ ] Happy path works end-to-end\n- [ ] Edge cases handled gracefully\n- [ ] Error scenarios don't leave broken state\n- [ ] User experience is smooth and intuitive","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T09:50:42.394029-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:56:50.75183-06:00","deleted_at":"2025-12-31T09:56:50.75183-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5","title":"Responsive Design Implementation (GH Issue #5)","description":"## Overview\n\nMake the Maestro app fully responsive across mobile, tablet, and desktop breakpoints with a primary breakpoint at `lg:` (1024px).\n\n### Background \u0026 Strategic Rationale\n\nThis initiative transforms Maestro from a desktop-only application into a responsive, mobile-first experience. The goal is to maintain the rich desktop functionality while providing an excellent mobile/tablet experience.\n\n**Why lg: (1024px) as the primary breakpoint?**\n- Most tablets in landscape mode exceed 1024px, allowing them to use the \"desktop\" layout\n- Phones and portrait tablets (typically \u003c1024px) get the mobile-optimized layout\n- This aligns with common industry practice and shadcn/ui defaults\n- Simplifies decision-making: everything uses ONE breakpoint for responsive logic\n\n**Current State Analysis:**\n| Component | Current State | Mobile Ready? |\n|-----------|---------------|---------------|\n| Sidebar | Custom 306-line component, fixed 256px, no collapse | No |\n| Issue View | Split panels with resize, tabs exist but use md: | Partial |\n| Dashboard | 4-column kanban with horizontal scroll | No |\n| Solo Pages | Full-width chat layouts | Mostly OK |\n| Epic/Swarm Pages | Full-width with sections | Mostly OK |\n\n---\n\n## OPTIMIZED PARALLELIZATION STRATEGY\n\n### Wave 1: Parallel Prep (P0 tasks - can ALL run simultaneously)\n```\nec5.1 ─┬─ Audit md: breakpoints\nec5.2 ─┼─ Audit other pages (solo/epic/swarm/ideate)  \nec5.3 ─┴─ Backup sidebar.tsx\n```\n**All 3 tasks are independent - assign to 3 parallel workers**\n\n### Wave 2: Sidebar + Issue View + Dashboard Prep (can run in parallel after Wave 1)\n```\nec5.4 → ec5.5 → ec5.6 → ec5.7 → ec5.8 → ec5.9  (Sidebar chain - sequential)\n        ↓\nec5.15 → ec5.17                                  (Issue View - can run parallel to sidebar)\n        ↓\nec5.10 ─┬─ Install accordion\nec5.11 ─┴─ Create compact cards (PARALLEL - no dependency on accordion!)\n```\n\n### Wave 3: Dashboard + Phase 4 (after their dependencies)\n```\nec5.12 ─┬─ RecentChatsSection (needs ec5.11)\nec5.13 ─┴─ Accordion layout (needs ec5.10 + ec5.11)\n        ↓\nec5.14    Test transitions (needs ec5.12 + ec5.13)\n\nec5.18 ─┬─ Solo pages (needs ec5.2 + ec5.7)\nec5.19 ─┼─ Epic page (needs ec5.2 + ec5.7)\nec5.20 ─┼─ Swarm page (needs ec5.2 + ec5.7)  \nec5.21 ─┴─ Ideate page (needs ec5.2 + ec5.7)\n```\n**Phase 4 tasks (18-21) can run in parallel with each other!**\n\n### Wave 4: Final Testing\n```\nec5.22 → ec5.23 ─┬─ 320px testing\n         ec5.24 ─┴─ Touch targets (parallel)\n                 ↓\n         ec5.25    Final regression\n```\n\n### Optional (P3)\n```\nec5.16    Toggle-group upgrade (after ec5.15, purely aesthetic)\n```\n\n---\n\n## KEY INSIGHT: Maximum Parallelism\n\n**With 3 workers, optimal assignment:**\n\n| Time | Worker A | Worker B | Worker C |\n|------|----------|----------|----------|\n| T1 | ec5.1 (audit md:) | ec5.2 (audit pages) | ec5.3 (backup) |\n| T2 | ec5.4 (install sidebar) | ec5.10 (install accordion) | ec5.15 (issue breakpoints) |\n| T3 | ec5.5 (app-sidebar.tsx) | ec5.11 (compact cards) | ec5.17 (verify resize) |\n| T4 | ec5.6 (layout.tsx) | ec5.12 (RecentChats) | ec5.18 (solo pages) |\n| T5 | ec5.7 (SidebarTrigger) | ec5.13 (accordion layout) | ec5.19 (epic page) |\n| T6 | ec5.8 (setOpenMobile) | ec5.14 (test transitions) | ec5.20 (swarm page) |\n| T7 | ec5.9 (test sidebar) | ec5.21 (ideate page) | ec5.22 (cross-browser) |\n| T8 | ec5.23 (320px) | ec5.24 (touch targets) | ec5.25 (final) |\n\n---\n\n## Acceptance Criteria\n\n**Sidebar:**\n- Uses shadcn Sidebar with `collapsible=\"offcanvas\"` mode\n- SidebarTrigger (hamburger) visible below lg: breakpoint\n- Sidebar closes on navigation item click (mobile)\n- Project tree structure preserved (expand/collapse)\n- FolderBrowserModal accessible from sidebar\n- Keyboard shortcut (cmd+b) works on desktop\n\n**Dashboard:**\n- Mobile (\u003c1024px): Accordion by status + vertical chat list\n- Desktop (\u003e=1024px): Kanban + horizontal chat carousel\n- \"New Chat\" action accessible in both layouts\n- Issue counts shown in accordion headers\n\n**Issue View:**\n- Breakpoint aligned to lg: (1024px)\n- Tab/toggle switching works on mobile\n- Split view with resize on desktop\n- Unread indicator works when on details tab\n\n**General:**\n- All views functional at 320px width minimum\n- No unintentional horizontal scroll\n- Touch-friendly tap targets (min 44px)\n- Consistent lg: breakpoint usage across entire app\n- SidebarTrigger visible in all page headers on mobile\n\n---\n\n## Files Summary\n\n**New Files to Create:**\n- src/components/app-sidebar.tsx - Extracted sidebar content\n- src/components/compact-cards.tsx - Mobile-optimized card variants\n- src/components/ui/accordion.tsx - shadcn accordion\n- src/components/ui/toggle-group.tsx - shadcn toggle-group (optional)\n\n**Files to Modify:**\n- src/components/ui/sidebar.tsx - Replaced by shadcn\n- src/app/project/[id]/layout.tsx - SidebarProvider wrapper\n- src/app/project/[id]/page.tsx - Mobile accordion layout\n- src/app/project/[id]/issue/[issueNumber]/page.tsx - Breakpoint alignment\n\n**Files to Audit:**\n- src/app/project/[id]/solo/page.tsx\n- src/app/project/[id]/solo/[sessionId]/page.tsx\n- src/app/project/[id]/epic/[epicId]/page.tsx\n- src/app/project/[id]/swarm/[epicId]/page.tsx\n- src/app/project/[id]/ideate/page.tsx\n\n---\n\n## Risk Assessment\n\n**Low Risk:**\n- Issue view breakpoint changes (minimal changes, 6 search-replace operations)\n- Solo/Ideate page audits (likely minimal changes needed)\n\n**Medium Risk:**\n- Dashboard accordion implementation (new components, layout changes)\n- Epic/Swarm page audits (may need layout adjustments for stats grid)\n\n**Higher Risk:**\n- Sidebar migration (largest change, replaces 306-line custom component)\n- Potential for regression in project tree expand/collapse behavior\n- FolderBrowserModal integration needs careful testing\n\n---\n\n## Testing Strategy\n\n1. Test at multiple viewport widths: 320px, 375px, 768px, 1024px, 1440px\n2. Test on actual devices (not just browser DevTools)\n3. Verify keyboard shortcuts still work\n4. Test navigation flows on mobile (sidebar close behavior)\n5. Performance testing (no layout shifts, smooth transitions)","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-30T21:11:42.781774-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:57.165223-06:00","close_reason":"Completed","deleted_at":"2025-12-31T08:43:57.165223-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-ec5.1","title":"Phase 0.1: Audit and document current md: breakpoint usage across codebase","description":"## Objective\nSearch the entire codebase for existing responsive breakpoint usage, specifically `md:` classes that will need to change to `lg:`.\n\n## Background\nThe issue view already has mobile tabs implemented using `md:` (768px) breakpoint. For consistency across the app, we need to standardize on `lg:` (1024px). This audit identifies all locations that need updating.\n\n## KNOWN FINDINGS (from pre-review)\n\n### issue/[issueNumber]/page.tsx - CONFIRMED md: usage\nThe following `md:` breakpoints exist and need changing:\n- Line 272: `md:flex` on skeleton details panel\n- Line 377: `md:hidden` on mobile tabs container\n- Line 410: `md:flex` on details panel\n- Line 413: `\u003e= 768` in JS conditional\n- Line 418: `md:block` on resize handle\n- Line 490: `md:flex` on chat panel\n\n### Other files to verify have NO md: usage:\n- `src/components/ui/sidebar.tsx` - Custom sidebar, no breakpoints (verified)\n- `src/app/project/[id]/page.tsx` - Dashboard, no breakpoints (verified)\n- `src/app/project/[id]/solo/page.tsx` - No breakpoints (verified)\n- `src/app/project/[id]/solo/[sessionId]/page.tsx` - No breakpoints (verified)\n- `src/app/project/[id]/epic/[epicId]/page.tsx` - No breakpoints (verified)\n- `src/app/project/[id]/swarm/[epicId]/page.tsx` - No breakpoints (verified)\n- `src/app/project/[id]/ideate/page.tsx` - No breakpoints (verified)\n\n## Tasks\n1. Run grep search for `md:` patterns in src/ directory\n2. Confirm the findings above\n3. Check for any OTHER breakpoint patterns (sm:, xl:, 2xl:, etc.)\n4. Document any unexpected findings\n\n## Commands to Run\n```bash\n# Find all md: breakpoint usage\ngrep -rn \"md:\" src/\n\n# Find all breakpoint patterns\ngrep -rn \"sm:\\|md:\\|lg:\\|xl:\\|2xl:\" src/\n\n# Find JS breakpoint conditionals\ngrep -rn \"\u003e= 768\\|\u003e= 1024\\|\u003c 768\\|\u003c 1024\" src/\n```\n\n## Expected Output\nA checklist or document confirming:\n- File: `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n  - Line 272: `md:flex` - CHANGE TO lg:flex\n  - Line 377: `md:hidden` - CHANGE TO lg:hidden\n  - Line 410: `md:flex` - CHANGE TO lg:flex\n  - Line 413: `\u003e= 768` - CHANGE TO \u003e= 1024\n  - Line 418: `md:block` - CHANGE TO lg:block\n  - Line 490: `md:flex` - CHANGE TO lg:flex\n\n## Parallelization\nThis task can run IN PARALLEL with ec5.2 and ec5.3 - they are all independent P0 audit/prep tasks.\n\n## Files to Check\nAll files in src/app/ and src/components/\n\nDepends on:\n- maestro-ec5 (parent epic only)\n\nBlocks:\n- Nothing directly (informational task)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T21:11:42.838205-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Audit complete. Confirmed 6 locations in issue/[issueNumber]/page.tsx need md: to lg: changes. No unexpected findings.","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.10","title":"Phase 2.1: Install shadcn accordion component","description":"## Objective\nInstall the shadcn accordion component for use in the mobile dashboard layout.\n\n## Background\nOn mobile, the 4-column kanban board doesn't fit. Instead, we'll use an accordion where each status (Issues, Ready, Active, Completed) is a collapsible section.\n\n## Command\n```bash\npnpm dlx shadcn@latest add accordion\n```\n\n## Expected Output\nCreates `src/components/ui/accordion.tsx` with:\n- Accordion (root)\n- AccordionItem (each collapsible section)\n- AccordionTrigger (the clickable header)\n- AccordionContent (the collapsible body)\n\n## Usage Pattern\n```typescript\nimport { \n  Accordion, \n  AccordionItem, \n  AccordionTrigger, \n  AccordionContent \n} from \"@/components/ui/accordion\";\n\n\u003cAccordion type=\"single\" collapsible defaultValue=\"issues\"\u003e\n  \u003cAccordionItem value=\"issues\"\u003e\n    \u003cAccordionTrigger\u003e\n      \u003cCircleDot /\u003e Issues \u003cBadge\u003e{count}\u003c/Badge\u003e\n    \u003c/AccordionTrigger\u003e\n    \u003cAccordionContent\u003e\n      {/* Issue cards */}\n    \u003c/AccordionContent\u003e\n  \u003c/AccordionItem\u003e\n  {/* More items... */}\n\u003c/Accordion\u003e\n```\n\n## Props to Know\n- `type=\"single\"` - Only one section open at a time\n- `type=\"multiple\"` - Multiple sections can be open\n- `collapsible` - Allows closing all sections (with type=\"single\")\n- `defaultValue` - Which section is open by default\n\n## For Dashboard\nWe'll use `type=\"single\" collapsible defaultValue=\"issues\"`:\n- One section at a time (cleaner on mobile)\n- Can close all if desired\n- Issues section open by default\n\n## Verification\nAfter installation:\n1. Check file exists: `src/components/ui/accordion.tsx`\n2. No TypeScript errors\n3. Can import from the component\n\n## Files\n- Creates: `src/components/ui/accordion.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.332224-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.11","title":"Phase 2.2: Create compact card components for mobile (CompactIssueCard, CompactEpicCard, CompactSessionCard)","description":"## Objective\nCreate mobile-optimized card components for use in the dashboard accordion view.\n\n## Background\nThe existing card components (IssueCard, EpicCard, SwarmCard, etc.) are designed for the desktop kanban with fixed width columns. For the mobile accordion, we need more compact, full-width variants that:\n- Use horizontal space efficiently\n- Show essential info at a glance\n- Have clear tap targets\n- Link to the correct detail pages\n\n## Components to Create\n\n### CompactIssueCard\n```typescript\ninterface CompactIssueCardProps {\n  issue: GitHubIssue;\n  projectId: string;\n}\n\nfunction CompactIssueCard({ issue, projectId }: CompactIssueCardProps) {\n  return (\n    \u003cLink\n      href={`/project/${projectId}/issue/${issue.number}`}\n      className=\"flex items-center gap-3 p-3 rounded-md bg-card border border-border hover:bg-secondary/50 active:bg-secondary\"\n    \u003e\n      \u003cCircleDot className=\"h-4 w-4 text-[hsl(var(--success))] flex-shrink-0\" /\u003e\n      \u003cdiv className=\"flex-1 min-w-0\"\u003e\n        \u003cp className=\"text-sm font-medium truncate\"\u003e{issue.title}\u003c/p\u003e\n        \u003cp className=\"text-xs text-muted-foreground\"\u003e#{issue.number}\u003c/p\u003e\n      \u003c/div\u003e\n      \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n    \u003c/Link\u003e\n  );\n}\n```\n\n### CompactEpicCard\n```typescript\ninterface CompactEpicCardProps {\n  epic: Epic;\n  projectId: string;\n}\n\nfunction CompactEpicCard({ epic, projectId }: CompactEpicCardProps) {\n  const taskCount = epic.subtasks.length;\n  \n  return (\n    \u003cLink\n      href={`/project/${projectId}/epic/${epic.id}`}\n      className=\"flex items-center gap-3 p-3 rounded-md bg-card border border-border hover:bg-secondary/50 active:bg-secondary\"\n    \u003e\n      \u003cCircle className=\"h-4 w-4 text-[hsl(var(--info))] flex-shrink-0\" /\u003e\n      \u003cdiv className=\"flex-1 min-w-0\"\u003e\n        \u003cp className=\"text-sm font-medium truncate\"\u003e{epic.title}\u003c/p\u003e\n        \u003cp className=\"text-xs text-muted-foreground\"\u003e{taskCount} tasks\u003c/p\u003e\n      \u003c/div\u003e\n      \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n    \u003c/Link\u003e\n  );\n}\n```\n\n### CompactSwarmCard (Active items with progress)\n```typescript\nfunction CompactSwarmCard({ epic, projectId }: CompactEpicCardProps) {\n  const done = epic.subtasks.filter(t =\u003e t.status === \"done\").length;\n  const total = epic.subtasks.length;\n  const pct = total \u003e 0 ? Math.round((done / total) * 100) : 0;\n  \n  return (\n    \u003cLink\n      href={`/project/${projectId}/swarm/${epic.id}`}\n      className=\"flex items-center gap-3 p-3 rounded-md bg-card border border-border hover:bg-secondary/50 active:bg-secondary\"\n    \u003e\n      \u003cdiv className=\"relative flex-shrink-0\"\u003e\n        \u003cspan className=\"relative flex h-2 w-2\"\u003e\n          \u003cspan className=\"animate-ping absolute h-full w-full rounded-full bg-[hsl(var(--success))] opacity-75\" /\u003e\n          \u003cspan className=\"relative rounded-full h-2 w-2 bg-[hsl(var(--success))]\" /\u003e\n        \u003c/span\u003e\n      \u003c/div\u003e\n      \u003cdiv className=\"flex-1 min-w-0\"\u003e\n        \u003cp className=\"text-sm font-medium truncate\"\u003e{epic.title}\u003c/p\u003e\n        \u003cdiv className=\"flex items-center gap-2 mt-1\"\u003e\n          \u003cdiv className=\"flex-1 h-1 bg-secondary rounded-full\"\u003e\n            \u003cdiv \n              className=\"h-full bg-[hsl(var(--success))] rounded-full\"\n              style={{ width: `${pct}%` }}\n            /\u003e\n          \u003c/div\u003e\n          \u003cspan className=\"text-xs text-muted-foreground\"\u003e{pct}%\u003c/span\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n    \u003c/Link\u003e\n  );\n}\n```\n\n### CompactSessionCard\n```typescript\nfunction CompactSessionCard({ session, projectId }: CompactSessionCardProps) {\n  return (\n    \u003cLink\n      href={`/project/${projectId}/solo/${session.id}`}\n      className=\"flex items-center gap-3 p-3 rounded-md bg-card border border-border hover:bg-secondary/50 active:bg-secondary\"\n    \u003e\n      \u003cMessageSquare className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n      \u003cdiv className=\"flex-1 min-w-0\"\u003e\n        \u003cp className=\"text-sm font-medium truncate\"\u003e{session.title}\u003c/p\u003e\n        \u003cp className=\"text-xs text-muted-foreground truncate\"\u003e{session.lastMessage}\u003c/p\u003e\n      \u003c/div\u003e\n      \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n    \u003c/Link\u003e\n  );\n}\n```\n\n## Important Notes\n- These components are INDEPENDENT of the accordion component\n- They can be developed in parallel with accordion installation\n- All components should have min-h-[44px] for touch-friendly tap targets\n\n## Files\n- Create: `src/components/compact-cards.tsx`\n\n## Dependencies\n**IMPORTANT CHANGE**: This task no longer depends on ec5.10 (accordion install). These are independent components that can be built in parallel.\n\nDependencies:\n- maestro-ec5 (parent epic only)\n\nBlocks:\n- maestro-ec5.12: Build responsive RecentChatsSection\n- maestro-ec5.13: Build mobile accordion layout","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.387403-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Created src/components/compact-cards.tsx with 4 components: CompactIssueCard, CompactEpicCard, CompactSwarmCard, CompactSessionCard. All touch-friendly with min-h-[44px].","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.12","title":"Phase 2.3: Build responsive RecentChatsSection with vertical list for mobile","description":"## Objective\nRefactor the Recent Chats section in the dashboard to have different layouts for mobile and desktop.\n\n## Current Implementation\n```typescript\n\u003cdiv className=\"flex gap-3 overflow-x-auto pb-2 -mx-6 px-6 scrollbar-thin\"\u003e\n  {/* New Chat Card */}\n  \u003cLink className=\"flex-shrink-0 w-48 h-24 ...\"\u003e\n    \u003cPlus /\u003e New Chat\n  \u003c/Link\u003e\n  {/* Session Cards - horizontal scroll */}\n  {mockSoloSessions.map(session =\u003e (\n    \u003cSessionCard key={session.id} ... /\u003e\n  ))}\n\u003c/div\u003e\n```\n\nThis horizontal scroll works on desktop but is awkward on mobile.\n\n## New Implementation\n\n### Extract to Component\n```typescript\nfunction RecentChatsSection({ sessions, projectId }) {\n  return (\n    \u003cdiv className=\"flex-shrink-0 border-b border-border\"\u003e\n      \u003cdiv className=\"px-4 lg:px-6 py-4\"\u003e\n        {/* Header */}\n        \u003cdiv className=\"flex items-center justify-between mb-3\"\u003e\n          \u003cdiv className=\"flex items-center gap-2\"\u003e\n            \u003cMessageSquare className=\"h-4 w-4 text-muted-foreground\" /\u003e\n            \u003cspan className=\"text-sm font-medium\"\u003eRecent Chats\u003c/span\u003e\n          \u003c/div\u003e\n          \u003cLink \n            href={`/project/${projectId}/solo`}\n            className=\"text-xs text-primary hover:underline\"\n          \u003e\n            View all\n          \u003c/Link\u003e\n        \u003c/div\u003e\n        \n        {/* Mobile: Vertical list */}\n        \u003cdiv className=\"lg:hidden space-y-2\"\u003e\n          {/* New Chat - full width */}\n          \u003cLink\n            href={`/project/${projectId}/solo`}\n            className=\"flex items-center justify-center gap-2 p-3 rounded-lg border border-dashed border-border hover:border-primary/50 text-muted-foreground hover:text-foreground\"\n          \u003e\n            \u003cPlus className=\"h-4 w-4\" /\u003e\n            \u003cspan className=\"text-sm font-medium\"\u003eNew Chat\u003c/span\u003e\n          \u003c/Link\u003e\n          \n          {/* Recent sessions - limit to 3 on mobile */}\n          {sessions.slice(0, 3).map(session =\u003e (\n            \u003cCompactSessionCard \n              key={session.id} \n              session={session} \n              projectId={projectId} \n            /\u003e\n          ))}\n        \u003c/div\u003e\n        \n        {/* Desktop: Horizontal scroll (existing) */}\n        \u003cdiv className=\"hidden lg:flex gap-3 overflow-x-auto pb-2 -mx-6 px-6 scrollbar-thin\"\u003e\n          \u003cLink className=\"flex-shrink-0 w-48 h-24 ...\"\u003e\n            \u003cPlus /\u003e New Chat\n          \u003c/Link\u003e\n          {sessions.map(session =\u003e (\n            \u003cSessionCard key={session.id} ... /\u003e\n          ))}\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Key Differences\n\n| Aspect | Mobile | Desktop |\n|--------|--------|---------|\n| Layout | Vertical stack | Horizontal scroll |\n| Session limit | 3 (with \"View all\") | All sessions |\n| New Chat | Full width button | Fixed width card |\n| Padding | px-4 | px-6 |\n| Card style | CompactSessionCard | SessionCard |\n\n## Why These Choices?\n1. **Vertical on mobile** - More natural scrolling, easier to tap\n2. **Limit to 3** - Don't overwhelm mobile view, \"View all\" for more\n3. **Full-width New Chat** - Clear primary action\n4. **Different card styles** - Optimized for each layout\n\n## Dependencies\n- CompactSessionCard from Phase 2.2\n\n## Files\n- Modify: `src/app/project/[id]/page.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.442624-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.13","title":"Phase 2.4: Build mobile accordion layout for dashboard kanban columns","description":"## Objective\nReplace the horizontal kanban board with an accordion layout on mobile screens.\n\n## Current Implementation\n```typescript\n\u003cdiv className=\"flex-1 overflow-hidden p-6\"\u003e\n  \u003cdiv className=\"h-full flex gap-4 overflow-x-auto\"\u003e\n    \u003cKanbanColumn title=\"Issues\" ... /\u003e\n    \u003cKanbanColumn title=\"Ready\" ... /\u003e\n    \u003cKanbanColumn title=\"Active\" ... /\u003e\n    \u003cKanbanColumn title=\"Completed\" ... /\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n## New Implementation\n\n```typescript\n{/* Mobile: Accordion */}\n\u003cdiv className=\"lg:hidden flex-1 overflow-y-auto p-4\"\u003e\n  \u003cAccordion type=\"single\" collapsible defaultValue=\"issues\"\u003e\n    {/* Issues Section */}\n    \u003cAccordionItem value=\"issues\"\u003e\n      \u003cAccordionTrigger className=\"hover:no-underline\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cCircleDot className=\"h-4 w-4 text-[hsl(var(--orange))]\" /\u003e\n          \u003cspan className=\"font-medium\"\u003eIssues\u003c/span\u003e\n          \u003cBadge variant=\"secondary\" className=\"ml-auto\"\u003e\n            {issues.length}\n          \u003c/Badge\u003e\n        \u003c/div\u003e\n      \u003c/AccordionTrigger\u003e\n      \u003cAccordionContent\u003e\n        \u003cdiv className=\"space-y-2 pt-2\"\u003e\n          {issuesLoading ? (\n            \u003cdiv className=\"space-y-2\"\u003e\n              \u003cSkeleton className=\"h-14 w-full\" /\u003e\n              \u003cSkeleton className=\"h-14 w-full\" /\u003e\n            \u003c/div\u003e\n          ) : issues.length === 0 ? (\n            \u003cp className=\"text-sm text-muted-foreground py-4 text-center\"\u003e\n              No open issues\n            \u003c/p\u003e\n          ) : (\n            issues.map(issue =\u003e (\n              \u003cCompactIssueCard \n                key={issue.number} \n                issue={issue} \n                projectId={projectId} \n              /\u003e\n            ))\n          )}\n          {/* Add Issue Button */}\n          \u003cbutton\n            onClick={() =\u003e setIsNewIssueDialogOpen(true)}\n            className=\"w-full p-3 rounded-md border border-dashed border-border text-muted-foreground hover:text-foreground hover:border-primary/50 text-sm\"\n          \u003e\n            \u003cPlus className=\"h-4 w-4 inline mr-2\" /\u003e\n            New Issue\n          \u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/AccordionContent\u003e\n    \u003c/AccordionItem\u003e\n    \n    {/* Ready Section */}\n    \u003cAccordionItem value=\"ready\"\u003e\n      \u003cAccordionTrigger className=\"hover:no-underline\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cCircle className=\"h-4 w-4 text-[hsl(var(--info))]\" /\u003e\n          \u003cspan className=\"font-medium\"\u003eReady\u003c/span\u003e\n          \u003cBadge variant=\"secondary\" className=\"ml-auto\"\u003e\n            {readyToSwarm.length}\n          \u003c/Badge\u003e\n        \u003c/div\u003e\n      \u003c/AccordionTrigger\u003e\n      \u003cAccordionContent\u003e\n        \u003cdiv className=\"space-y-2 pt-2\"\u003e\n          {readyToSwarm.length === 0 ? (\n            \u003cp className=\"text-sm text-muted-foreground py-4 text-center\"\u003e\n              No epics ready to swarm\n            \u003c/p\u003e\n          ) : (\n            readyToSwarm.map(epic =\u003e (\n              \u003cCompactEpicCard \n                key={epic.id} \n                epic={epic} \n                projectId={projectId} \n              /\u003e\n            ))\n          )}\n        \u003c/div\u003e\n      \u003c/AccordionContent\u003e\n    \u003c/AccordionItem\u003e\n    \n    {/* Active Section */}\n    \u003cAccordionItem value=\"active\"\u003e\n      \u003cAccordionTrigger className=\"hover:no-underline\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cZap className=\"h-4 w-4 text-[hsl(var(--success))]\" /\u003e\n          \u003cspan className=\"font-medium\"\u003eActive\u003c/span\u003e\n          \u003cBadge variant=\"secondary\" className=\"ml-auto\"\u003e\n            {activeSwarms.length}\n          \u003c/Badge\u003e\n        \u003c/div\u003e\n      \u003c/AccordionTrigger\u003e\n      \u003cAccordionContent\u003e\n        \u003cdiv className=\"space-y-2 pt-2\"\u003e\n          {activeSwarms.length === 0 ? (\n            \u003cp className=\"text-sm text-muted-foreground py-4 text-center\"\u003e\n              No active swarms\n            \u003c/p\u003e\n          ) : (\n            activeSwarms.map(epic =\u003e (\n              \u003cCompactSwarmCard \n                key={epic.id} \n                epic={epic} \n                projectId={projectId} \n              /\u003e\n            ))\n          )}\n        \u003c/div\u003e\n      \u003c/AccordionContent\u003e\n    \u003c/AccordionItem\u003e\n    \n    {/* Completed Section */}\n    \u003cAccordionItem value=\"completed\"\u003e\n      \u003cAccordionTrigger className=\"hover:no-underline\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cCheckCircle className=\"h-4 w-4 text-muted-foreground\" /\u003e\n          \u003cspan className=\"font-medium\"\u003eCompleted\u003c/span\u003e\n          \u003cBadge variant=\"secondary\" className=\"ml-auto\"\u003e\n            {completed.length}\n          \u003c/Badge\u003e\n        \u003c/div\u003e\n      \u003c/AccordionTrigger\u003e\n      \u003cAccordionContent\u003e\n        \u003cdiv className=\"space-y-2 pt-2\"\u003e\n          {completed.length === 0 ? (\n            \u003cp className=\"text-sm text-muted-foreground py-4 text-center\"\u003e\n              No completed items\n            \u003c/p\u003e\n          ) : (\n            completed.map(epic =\u003e (\n              \u003cCompactEpicCard \n                key={epic.id} \n                epic={epic} \n                projectId={projectId} \n              /\u003e\n            ))\n          )}\n        \u003c/div\u003e\n      \u003c/AccordionContent\u003e\n    \u003c/AccordionItem\u003e\n  \u003c/Accordion\u003e\n\u003c/div\u003e\n\n{/* Desktop: Kanban (existing - now wrapped with hidden lg:block) */}\n\u003cdiv className=\"hidden lg:block flex-1 overflow-hidden p-6\"\u003e\n  \u003cdiv className=\"h-full flex gap-4 overflow-x-auto\"\u003e\n    {/* Existing kanban code unchanged */}\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n## Key Features\n1. **Single open section** - `type=\"single\"` keeps UI clean\n2. **Collapsible** - User can close all sections\n3. **Default open** - Issues section open by default\n4. **Count badges** - Each header shows item count\n5. **Empty states** - Helpful messages when sections are empty\n6. **Add Issue button** - Inside Issues accordion\n\n## Dependencies\n- Accordion component from Phase 2.1\n- CompactIssueCard, CompactEpicCard, CompactSwarmCard from Phase 2.2\n\n## Files\n- Modify: `src/app/project/[id]/page.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.497808-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.14","title":"Phase 2.5: Ensure desktop kanban layout unchanged and test layout transitions","description":"## Objective\nVerify that the desktop kanban layout remains unchanged and test smooth transitions between mobile and desktop layouts.\n\n## Desktop Verification Checklist\n\n### Visual Consistency\n- [ ] Kanban columns maintain w-72 (288px) width\n- [ ] 4 columns display: Issues, Ready, Active, Completed\n- [ ] Horizontal scroll works when columns exceed viewport\n- [ ] Column headers have correct icons and colors\n- [ ] Column accent lines at bottom display correctly\n- [ ] \"+\" buttons visible on columns with add actions\n\n### Functionality\n- [ ] Issue cards link to issue view\n- [ ] Epic cards link to epic view\n- [ ] Swarm cards link to swarm view (with progress bars)\n- [ ] Completed cards link to epic view (with opacity)\n- [ ] \"Add Issue\" button opens NewIssueDialog\n- [ ] Loading skeletons display while data fetches\n\n### Data Display\n- [ ] Issue counts match actual issue count\n- [ ] Epic categorization correct (ready vs active vs completed)\n- [ ] Swarm progress percentages accurate\n- [ ] Labels display on issue cards\n\n## Transition Testing\n\n### Resize from Mobile to Desktop\n1. Start at 320px width (mobile)\n2. Slowly resize to 1024px\n3. At exactly 1024px:\n   - [ ] Accordion hides\n   - [ ] Kanban appears\n   - [ ] No layout jump or flash\n   - [ ] Content doesn't disappear momentarily\n\n### Resize from Desktop to Mobile\n1. Start at 1440px width (desktop)\n2. Slowly resize to below 1024px\n3. At exactly 1023px:\n   - [ ] Kanban hides\n   - [ ] Accordion appears\n   - [ ] Default accordion section is open\n   - [ ] No layout jump or flash\n\n### Rapid Resize Test\n- [ ] Rapidly resize back and forth across 1024px breakpoint\n- [ ] No visual glitches or broken state\n- [ ] No console errors\n\n## Performance Checks\n- [ ] No layout shift (CLS) during transitions\n- [ ] Cards don't re-render unnecessarily\n- [ ] Scroll position doesn't jump\n\n## Browser Compatibility\nTest in:\n- [ ] Chrome\n- [ ] Firefox\n- [ ] Safari\n- [ ] Edge\n\n## Files\n- src/app/project/[id]/page.tsx","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.553947-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.15","title":"Phase 3.1: Change issue view breakpoint from md: to lg: throughout file","description":"## Objective\nUpdate all responsive breakpoints in the issue view from `md:` (768px) to `lg:` (1024px) for consistency with the rest of the app.\n\n## Background\nThe issue view already has functioning mobile tabs and panel switching, but it uses `md:` breakpoint (768px). For consistency, we need to change to `lg:` (1024px).\n\n## VERIFIED Changes Required (from actual code review)\n\n### Line 272: Skeleton details panel visibility\n```diff\n- \u003cdiv className=\"hidden md:flex flex-col w-[400px] border-r ...\"\u003e\n+ \u003cdiv className=\"hidden lg:flex flex-col w-[400px] border-r ...\"\u003e\n```\n\n### Line 377: Mobile tabs container\n```diff\n- \u003cdiv className=\"flex border-t border-border md:hidden\"\u003e\n+ \u003cdiv className=\"flex border-t border-border lg:hidden\"\u003e\n```\n\n### Lines 410-412: Details panel visibility\n```diff\n  \u003cdiv\n-   className={`${activeTab === \"details\" ? \"flex\" : \"hidden\"} md:flex flex-col w-full ...`}\n+   className={`${activeTab === \"details\" ? \"flex\" : \"hidden\"} lg:flex flex-col w-full ...`}\n```\n\n### Line 413: Panel width conditional\n```diff\n-   style={{ width: typeof window !== \"undefined\" \u0026\u0026 window.innerWidth \u003e= 768 ? panelWidth : undefined }}\n+   style={{ width: typeof window !== \"undefined\" \u0026\u0026 window.innerWidth \u003e= 1024 ? panelWidth : undefined }}\n```\n\n### Lines 417-418: Resize handle visibility\n```diff\n  \u003cdiv \n-   className={cn(\"... hidden md:block\", ...)}\n+   className={cn(\"... hidden lg:block\", ...)}\n```\n\n### Lines 487-490: Chat panel visibility\n```diff\n  \u003cdiv\n-   className={`${activeTab === \"chat\" ? \"flex\" : \"hidden\"} md:flex flex-col ...`}\n+   className={`${activeTab === \"chat\" ? \"flex\" : \"hidden\"} lg:flex flex-col ...`}\n```\n\n## Search \u0026 Replace Patterns\nYou can use these patterns:\n- `md:hidden` → `lg:hidden` (2 occurrences)\n- `md:flex` → `lg:flex` (3 occurrences)\n- `md:block` → `lg:block` (1 occurrence)\n- `\u003e= 768` → `\u003e= 1024` (1 occurrence)\n\n## Testing After Changes\n- [ ] At 1023px: Mobile layout (tabs visible, single panel)\n- [ ] At 1024px: Desktop layout (split view, no tabs)\n- [ ] Tab switching works on mobile\n- [ ] Panel resize works on desktop\n- [ ] Unread indicator works when on details tab\n\n## Why This Matters\nUsers on tablets (768-1024px) will now get the mobile experience, which is actually better for those screen sizes than trying to show split panels.\n\n## PARALLELIZATION NOTE\nThis task has NO dependency on Phase 2 (Dashboard accordion work). It can be done in parallel with ec5.10, ec5.11, ec5.12, ec5.13, ec5.14.\n\n## Files\n- Modify: `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\nDependencies:\n- maestro-ec5 (parent epic only)\n\nBlocks:\n- maestro-ec5.17: Verify resize handle hidden on mobile\n- maestro-ec5.16: (Optional) Toggle-group upgrade","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.608624-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"All 6 breakpoint changes completed: md:flex to lg:flex, md:hidden to lg:hidden, md:block to lg:block, and \u003e= 768 to \u003e= 1024.","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.16","title":"Phase 3.2: (Optional) Install toggle-group and upgrade mobile tab buttons to ToggleGroup","description":"## Objective\n(OPTIONAL) Replace the plain tab buttons with a polished ToggleGroup component for iOS-style segmented control appearance.\n\n## Background\nThe current mobile tabs work fine but use plain `\u003cbutton\u003e` elements with basic styling. Upgrading to ToggleGroup provides:\n- More polished visual appearance\n- Better touch feedback\n- Accessibility improvements (proper ARIA)\n- Consistent with shadcn design language\n\n## Installation\n```bash\npnpm dlx shadcn@latest add toggle-group\n```\n\n## Current Implementation (lines 377-403)\n```typescript\n\u003cdiv className=\"flex border-t border-border lg:hidden\"\u003e\n  \u003cbutton\n    onClick={() =\u003e handleTabChange(\"details\")}\n    className={cn(\n      \"flex-1 py-2 text-xs font-medium transition-colors\",\n      activeTab === \"details\"\n        ? \"text-foreground border-b-2 border-primary\"\n        : \"text-muted-foreground\"\n    )}\n  \u003e\n    Details\n  \u003c/button\u003e\n  \u003cbutton\n    onClick={() =\u003e handleTabChange(\"chat\")}\n    className={cn(\n      \"flex-1 py-2 text-xs font-medium transition-colors relative\",\n      activeTab === \"chat\"\n        ? \"text-foreground border-b-2 border-primary\"\n        : \"text-muted-foreground\"\n    )}\n  \u003e\n    Chat\n    {hasUnread \u0026\u0026 (\n      \u003cspan className=\"absolute top-1 right-1/4 h-2 w-2 bg-destructive rounded-full animate-pulse\" /\u003e\n    )}\n  \u003c/button\u003e\n\u003c/div\u003e\n```\n\n## New Implementation\n```typescript\nimport { ToggleGroup, ToggleGroupItem } from \"@/components/ui/toggle-group\";\nimport { FileText, MessageSquare } from \"lucide-react\";\n\n{/* Mobile toggle - in header below title */}\n\u003cdiv className=\"lg:hidden flex items-center justify-center py-2 border-t border-border\"\u003e\n  \u003cToggleGroup \n    type=\"single\" \n    value={activeTab} \n    onValueChange={(v) =\u003e v \u0026\u0026 handleTabChange(v as \"details\" | \"chat\")}\n    className=\"bg-secondary/50 rounded-lg p-1\"\n  \u003e\n    \u003cToggleGroupItem \n      value=\"details\" \n      aria-label=\"View issue details\"\n      className=\"data-[state=on]:bg-background rounded-md px-3\"\n    \u003e\n      \u003cFileText className=\"h-4 w-4 mr-2\" /\u003e\n      Details\n    \u003c/ToggleGroupItem\u003e\n    \u003cToggleGroupItem \n      value=\"chat\" \n      aria-label=\"View chat\"\n      className=\"data-[state=on]:bg-background rounded-md px-3 relative\"\n    \u003e\n      \u003cMessageSquare className=\"h-4 w-4 mr-2\" /\u003e\n      Chat\n      {hasUnread \u0026\u0026 (\n        \u003cspan className=\"absolute -top-1 -right-1 h-2 w-2 bg-destructive rounded-full\" /\u003e\n      )}\n    \u003c/ToggleGroupItem\u003e\n  \u003c/ToggleGroup\u003e\n\u003c/div\u003e\n```\n\n## Visual Comparison\n\n| Aspect | Current | With ToggleGroup |\n|--------|---------|------------------|\n| Style | Underline tabs | Pill/segment control |\n| Icons | None | FileText, MessageSquare |\n| Active state | Border-bottom | Background change |\n| Touch feedback | Color only | Background + subtle animation |\n\n## Decision Criteria\nImplement if:\n- Team values visual polish\n- Time permits after core functionality\n- Want consistent shadcn styling\n\nSkip if:\n- Time constrained\n- Current tabs are acceptable\n- Want to minimize changes\n\n## Priority\nThis is marked P3 (backlog) because it's purely aesthetic. The functional behavior is identical.\n\n## Files\n- Optional create: `src/components/ui/toggle-group.tsx`\n- Optional modify: `src/app/project/[id]/issue/[issueNumber]/page.tsx`","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-30T21:11:43.665066-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.17","title":"Phase 3.3: Verify resize handle hidden on mobile and panel behavior correct","description":"## Objective\nVerify that the panel resize handle is hidden on mobile and that panel width behavior works correctly.\n\n## Current Implementation\nThe resize handle (line 417-419):\n```typescript\n\u003cdiv \n  className={cn(\n    \"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize transition-colors z-10 hidden md:block\",\n    isDragging ? \"bg-primary\" : \"hover:bg-primary/30\"\n  )}\n  onMouseDown={handleMouseDown}\n/\u003e\n```\n\n## Changes Needed\nAfter Phase 3.1, this will be `lg:block` instead of `md:block`.\n\n## Testing Checklist\n\n### Mobile (\u003c 1024px)\n- [ ] Resize handle is NOT visible\n- [ ] Cannot drag to resize panels\n- [ ] Tab switching controls which panel is visible\n- [ ] Panels take full width when active\n\n### Desktop (\u003e= 1024px)\n- [ ] Resize handle IS visible on hover (subtle line)\n- [ ] Cursor changes to `col-resize` when hovering handle\n- [ ] Dragging handle resizes left panel\n- [ ] Minimum width enforced (200px per code)\n- [ ] Maximum width enforced (50% of viewport per code)\n- [ ] Width persists in localStorage (`issue-panel-width`)\n- [ ] Width restored on page reload\n\n### Edge Cases\n- [ ] Resize to exactly 1024px - handle should appear\n- [ ] Resize to 1023px - handle should disappear\n- [ ] Start dragging, then resize window to mobile - should handle gracefully\n- [ ] Very narrow desktop (1024px) - resize should still work within limits\n\n## Code Review Points\n\n### Width Calculation (line 413)\n```typescript\nstyle={{ width: typeof window !== \"undefined\" \u0026\u0026 window.innerWidth \u003e= 1024 ? panelWidth : undefined }}\n```\nThis ensures:\n- On mobile: no inline width style (panel uses flex/full width)\n- On desktop: uses panelWidth from state\n\n### Drag Constraints (line 210)\n```typescript\nconst newWidth = Math.max(200, Math.min(e.clientX, window.innerWidth * 0.5))\n```\nThis ensures:\n- Minimum 200px width\n- Maximum 50% of viewport\n- Responsive to current viewport size\n\n## Potential Issues to Watch\n1. **SSR hydration**: `typeof window !== \"undefined\"` check is critical\n2. **Stale state**: If window resizes while dragging, constraints use current size\n3. **Touch devices**: Mouse events only - touch resize not implemented (acceptable)\n\n## Files\n- Verify: `src/app/project/[id]/issue/[issueNumber]/page.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.723036-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.18","title":"Phase 4.1: Apply responsive fixes to solo pages based on audit findings","description":"## Objective\nApply responsive fixes to solo pages based on Phase 0.2 audit findings.\n\n## SPECIFIC FIX REQUIRED\n\n### SidebarTrigger - Header\nFor BOTH `solo/page.tsx` (line 50) AND `solo/[sessionId]/page.tsx` (line 57):\n\nAfter the ChevronLeft Link, add:\n```tsx\n\u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n```\n\n### Example (solo/page.tsx lines 49-52):\n```tsx\n// Before\n\u003cLink href={`/project/${project.id}`} className=\"h-7 w-7 rounded flex items-center justify-center hover:bg-secondary\"\u003e\n  \u003cChevronLeft className=\"h-4 w-4\" /\u003e\n\u003c/Link\u003e\n\n// After\n\u003cLink href={`/project/${project.id}`} className=\"h-7 w-7 rounded flex items-center justify-center hover:bg-secondary\"\u003e\n  \u003cChevronLeft className=\"h-4 w-4\" /\u003e\n\u003c/Link\u003e\n\u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n```\n\n## NO OTHER FIXES NEEDED\nThe solo pages are already well-designed for mobile:\n- `max-w-3xl mx-auto` centers content\n- `max-w-[85%]` on message bubbles prevents overflow\n- Input area with `flex gap-2` works on mobile\n\n## Testing Checklist\n- [ ] SidebarTrigger visible on mobile (both pages)\n- [ ] Messages area scrolls properly\n- [ ] Input area usable at 320px\n- [ ] Empty state looks good on mobile\n- [ ] Back button still works\n\n## Files\n- Modify: `src/app/project/[id]/solo/page.tsx`\n- Modify: `src/app/project/[id]/solo/[sessionId]/page.tsx`\n\n## Dependencies\n- ec5.7: SidebarTrigger added to pages (provides pattern to follow)\n\n## Parallelization\nCan run in parallel with ec5.19, ec5.20, ec5.21","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.780722-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.19","title":"Phase 4.2: Apply responsive fixes to epic page based on audit findings","description":"## Objective\nApply responsive fixes to the epic (planning) page based on Phase 0.2 audit findings.\n\n## SPECIFIC FIX REQUIRED\n\n### SidebarTrigger - Header (Line 47)\nAfter the ChevronLeft Link, add:\n```tsx\n\u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n```\n\n## NO OTHER FIXES NEEDED\nThe epic page is already well-designed for mobile:\n- `max-w-3xl mx-auto` centers content\n- File badges use `flex-wrap` - handles overflow correctly\n- Bottom actions use `w-full` button - already mobile-friendly\n- Input area with `flex gap-2` works on mobile\n\n## Testing Checklist\n- [ ] SidebarTrigger visible on mobile\n- [ ] Subtask list scrolls properly\n- [ ] File badges wrap correctly (don't overflow)\n- [ ] Bottom actions accessible\n- [ ] Launch/View Swarm button is full-width and tappable\n- [ ] Chat input usable\n\n## Files\n- Modify: `src/app/project/[id]/epic/[epicId]/page.tsx`\n\n## Dependencies\n- ec5.7: SidebarTrigger added to pages (provides pattern to follow)\n\n## Parallelization\nCan run in parallel with ec5.18, ec5.20, ec5.21","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.83673-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.2","title":"Phase 0.2: Audit solo, epic, swarm, and ideate pages for responsive needs","description":"## Objective\nAudit the solo, epic, swarm, and ideate pages to determine what responsive changes (if any) are needed.\n\n## PRE-AUDIT FINDINGS (from code review)\n\n### Solo Pages (solo/page.tsx, solo/[sessionId]/page.tsx) - 117 \u0026 111 lines\n**Current Layout:**\n- Full-height flex column with header, messages, input\n- Messages use `max-w-[85%]` for bubbles - GOOD\n- Content uses `max-w-3xl mx-auto` - GOOD\n- No explicit breakpoints used\n\n**Issues Found:**\n1. **NO SidebarTrigger** - Must be added (handled by ec5.7)\n2. Input area uses `flex gap-2` - adequate for mobile\n3. `px-4` padding is fine for mobile\n\n**Verdict: MOSTLY OK** - Only needs SidebarTrigger\n\n---\n\n### Epic Page (epic/[epicId]/page.tsx) - 177 lines\n**Current Layout:**\n- Full-height flex with header, scrollable content, bottom actions\n- Content uses `max-w-3xl mx-auto` - GOOD\n- Bottom actions use full-width button - GOOD for mobile\n\n**Issues Found:**\n1. **NO SidebarTrigger** - Must be added\n2. File badges use `flex-wrap` - GOOD, already handles overflow\n3. Bottom input + button layout is fine\n\n**Verdict: MOSTLY OK** - Only needs SidebarTrigger\n\n---\n\n### Swarm Page (swarm/[epicId]/page.tsx) - 288 lines\n**Current Layout:**\n- Full-height with header, stats bar, scrollable content\n- Content uses `max-w-3xl mx-auto` - GOOD\n\n**Issues Found:**\n1. **NO SidebarTrigger** - Must be added\n2. **Stats grid uses `grid-cols-4`** - PROBLEMATIC at 320px!\n   - Line 60: `\u003cdiv className=\"grid grid-cols-4 gap-4 text-center mb-3\"\u003e`\n   - At 320px: 4 columns = 80px per column = too cramped\n   - **FIX NEEDED:** Change to `grid grid-cols-2 lg:grid-cols-4`\n3. Agent cards use `w-20` for progress bar - might be tight but acceptable\n\n**Verdict: NEEDS RESPONSIVE FIX** for stats grid\n\n---\n\n### Ideate Page (ideate/page.tsx) - 120 lines\n**Current Layout:**\n- Full-height flex with header, messages, CTA section, input\n- Uses `max-w-3xl mx-auto` - GOOD\n- Messages use `max-w-[85%]` - GOOD\n\n**Issues Found:**\n1. **NO SidebarTrigger** - Must be added\n2. **CTA section uses `flex items-center justify-between`** (line 87)\n   - On narrow screens, text and button compete for space\n   - **FIX NEEDED:** Stack vertically on mobile\n   - Change to: `flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between`\n   - Button should be: `w-full lg:w-auto`\n\n**Verdict: NEEDS MINOR RESPONSIVE FIX** for CTA section\n\n---\n\n## Summary Table\n\n| Page | SidebarTrigger Needed | Other Fixes Needed | Priority |\n|------|----------------------|-------------------|----------|\n| solo/page.tsx | Yes | None | Low |\n| solo/[sessionId]/page.tsx | Yes | None | Low |\n| epic/[epicId]/page.tsx | Yes | None | Low |\n| swarm/[epicId]/page.tsx | Yes | Stats grid (cols-4 → cols-2 lg:cols-4) | Medium |\n| ideate/page.tsx | Yes | CTA section stacking | Low |\n\n## Parallelization\nThis task can run IN PARALLEL with ec5.1 and ec5.3 - they are all independent P0 audit/prep tasks.\n\n## Deliverable\nThis bead now contains the audit findings. No separate document needed.\n\nDepends on:\n- maestro-ec5 (parent epic only)\n\nBlocks:\n- ec5.18: Apply responsive fixes to solo pages\n- ec5.19: Apply responsive fixes to epic page\n- ec5.20: Apply responsive fixes to swarm page\n- ec5.21: Apply responsive fixes to ideate page","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T21:11:42.896669-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Audit complete. Confirmed swarm page needs stats grid fix (grid-cols-4 -\u003e grid-cols-2 lg:grid-cols-4) and ideate page needs CTA section stacking on mobile.","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.20","title":"Phase 4.3: Apply responsive fixes to swarm page based on audit findings","description":"## Objective\nApply responsive fixes to the swarm page based on Phase 0.2 audit findings.\n\n## SPECIFIC FIX REQUIRED\n\n### Stats Grid - Line 60\n**Current:**\n```tsx\n\u003cdiv className=\"grid grid-cols-4 gap-4 text-center mb-3\"\u003e\n```\n\n**Change to:**\n```tsx\n\u003cdiv className=\"grid grid-cols-2 gap-2 lg:grid-cols-4 lg:gap-4 text-center mb-3\"\u003e\n```\n\nThis gives:\n- Mobile (2x2 grid):\n  ```\n  [Progress: 45%] [Completed: 3]\n  [Running: 2   ] [Blocked: 1  ]\n  ```\n- Desktop (1x4 grid):\n  ```\n  [Progress: 45%] [Completed: 3] [Running: 2] [Blocked: 1]\n  ```\n\n### SidebarTrigger - Header (Line 39-41)\nAfter the ChevronLeft Link, add:\n```tsx\n\u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n```\n\n## Additional Considerations (Optional)\n- Agent card progress bars use `w-20` (80px) - acceptable on mobile but could use `w-16 lg:w-20` if needed\n- File paths in File Locks already use `truncate` - GOOD\n\n## Testing Checklist\n- [ ] Stats grid readable at 320px (2x2 layout)\n- [ ] Stats grid shows 1x4 at 1024px+\n- [ ] SidebarTrigger visible on mobile\n- [ ] Agent list scrolls properly\n- [ ] Blocked alert visible and clear\n- [ ] Intervention input usable on mobile\n\n## Files\n- Modify: `src/app/project/[id]/swarm/[epicId]/page.tsx`\n\n## Dependencies\nThis task depends on:\n- ec5.2: Audit findings (COMPLETED - findings in this bead)\n- ec5.7: SidebarTrigger added to pages\n\n## Parallelization\nCan run in parallel with ec5.18, ec5.19, ec5.21","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.891676-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.21","title":"Phase 4.4: Apply responsive fixes to ideate page based on audit findings","description":"## Objective\nApply responsive fixes to the ideate page based on Phase 0.2 audit findings.\n\n## SPECIFIC FIX REQUIRED\n\n### CTA Section - Lines 85-99\n**Current (line 87):**\n```tsx\n\u003cdiv className=\"max-w-3xl mx-auto flex items-center justify-between\"\u003e\n```\n\n**Change to:**\n```tsx\n\u003cdiv className=\"max-w-3xl mx-auto flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between\"\u003e\n```\n\n**Also update button (line 93):**\n```tsx\n// Before\n\u003cButton variant=\"outline\" size=\"sm\"\u003e\n\n// After\n\u003cButton variant=\"outline\" size=\"sm\" className=\"w-full lg:w-auto\"\u003e\n```\n\nThis gives:\n- **Mobile (stacked):**\n  ```\n  ┌─────────────────────────┐\n  │ Ready to formalize?     │\n  │ Create a GitHub issue   │\n  │ and start planning      │\n  ├─────────────────────────┤\n  │ [   Create Issue    ]   │  \u003c- full width button\n  └─────────────────────────┘\n  ```\n\n- **Desktop (side-by-side):**\n  ```\n  ┌───────────────────────────────────────────┐\n  │ Ready to formalize?        [Create Issue] │\n  │ Create a GitHub issue...                  │\n  └───────────────────────────────────────────┘\n  ```\n\n### SidebarTrigger - Header (Line 49-51)\nAfter the ChevronLeft Link, add:\n```tsx\n\u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n```\n\n## Testing Checklist\n- [ ] CTA section stacks vertically on mobile\n- [ ] CTA section is side-by-side on desktop\n- [ ] Create Issue button is full-width on mobile\n- [ ] Create Issue button is auto-width on desktop\n- [ ] SidebarTrigger visible on mobile\n- [ ] Messages area scrolls properly\n- [ ] Input area usable at 320px\n\n## Files\n- Modify: `src/app/project/[id]/ideate/page.tsx`\n\n## Dependencies\nThis task depends on:\n- ec5.2: Audit findings (COMPLETED - findings in this bead)\n- ec5.7: SidebarTrigger added to pages\n\n## Parallelization\nCan run in parallel with ec5.18, ec5.19, ec5.20","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.945736-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.22","title":"Phase 5.1: Cross-browser and device testing at all breakpoints","description":"## Objective\nComprehensive cross-browser and device testing at all target breakpoints.\n\n## Test Matrix\n\n### Browsers\n| Browser | macOS | Windows | iOS | Android |\n|---------|-------|---------|-----|---------|\n| Chrome | Yes | Yes | N/A | Yes |\n| Firefox | Yes | Yes | N/A | Yes |\n| Safari | Yes | N/A | Yes | N/A |\n| Edge | Yes | Yes | N/A | N/A |\n\n### Breakpoints to Test\n| Width | Category | Layout Expected |\n|-------|----------|-----------------|\n| 320px | Mobile (min) | Mobile layouts |\n| 375px | iPhone SE | Mobile layouts |\n| 390px | iPhone 14 | Mobile layouts |\n| 428px | iPhone 14 Pro Max | Mobile layouts |\n| 768px | iPad Portrait | Mobile layouts |\n| 1024px | iPad Landscape / Breakpoint | Desktop layouts |\n| 1280px | Laptop | Desktop layouts |\n| 1440px | Desktop | Desktop layouts |\n| 1920px | Large Desktop | Desktop layouts |\n\n### Pages to Test\n1. Dashboard (`/project/[id]`)\n2. Issue View (`/project/[id]/issue/[n]`)\n3. Solo Chat (`/project/[id]/solo`)\n4. Solo Session (`/project/[id]/solo/[id]`)\n5. Epic/Planning (`/project/[id]/epic/[id]`)\n6. Swarm (`/project/[id]/swarm/[id]`)\n7. Ideate (`/project/[id]/ideate`)\n\n## Test Checklist per Page\n\n### General (All Pages)\n- [ ] Page loads without errors\n- [ ] No horizontal scroll (unless intentional)\n- [ ] Content is readable (not cut off)\n- [ ] Interactive elements are accessible\n- [ ] Navigation works correctly\n\n### Sidebar Behavior\n- [ ] \u003c 1024px: Sidebar hidden, trigger visible\n- [ ] \u003e= 1024px: Sidebar visible, trigger hidden\n- [ ] Trigger opens sidebar on mobile\n- [ ] Sidebar closes on navigation (mobile)\n- [ ] Keyboard shortcut works (desktop)\n\n### Dashboard Specific\n- [ ] Recent chats: vertical list on mobile, horizontal on desktop\n- [ ] Kanban: accordion on mobile, columns on desktop\n- [ ] New Issue dialog opens correctly\n- [ ] All links work\n\n### Issue View Specific\n- [ ] Tabs visible on mobile\n- [ ] Split view on desktop\n- [ ] Panel resize works on desktop\n- [ ] Tab switching works on mobile\n- [ ] Unread indicator works\n\n## Device Testing\n\n### Physical Devices (if available)\n- [ ] iPhone (any model)\n- [ ] Android phone (any model)\n- [ ] iPad (any model)\n- [ ] Android tablet (any model)\n\n### Browser DevTools\n- [ ] Chrome DevTools device mode\n- [ ] Firefox Responsive Design Mode\n- [ ] Safari Responsive Design Mode\n\n## Performance Observations\nNote any issues with:\n- Layout shifts during load\n- Slow transitions\n- Janky animations\n- Memory issues on mobile\n\n## Bug Reporting Template\nFor any issues found:\n```\n**Page:** [page name]\n**Browser:** [browser/version]\n**Device/Viewport:** [device or width]\n**Steps to Reproduce:**\n1. ...\n2. ...\n**Expected:** ...\n**Actual:** ...\n**Screenshot:** [attach]\n```\n\n## Success Criteria\n- No critical bugs on any browser/device combo\n- All core functionality works\n- Visual presentation is acceptable (minor variations OK)\n- Performance is acceptable on mobile devices","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.999361-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.23","title":"Phase 5.2: Verify 320px minimum width support with no horizontal scroll","description":"## Objective\nVerify that all pages work correctly at 320px minimum width without horizontal scrolling.\n\n## Background\n320px is the minimum supported width, representing older/smaller smartphones. Content must be usable without requiring horizontal scroll.\n\n## Test Procedure\n1. Open Chrome DevTools\n2. Set viewport to 320px width\n3. Navigate to each page\n4. Check for horizontal scroll indicator\n5. Verify content is usable\n\n## Pages to Check\n\n### Dashboard\n- [ ] Header doesn't overflow\n- [ ] Recent chats section fits\n- [ ] Accordion headers fit\n- [ ] Accordion content fits\n- [ ] No horizontal scroll\n\n### Issue View\n- [ ] Header fits (back, title, actions)\n- [ ] Tab buttons fit\n- [ ] Details panel content wraps properly\n- [ ] Chat messages don't overflow\n- [ ] Input area fits\n- [ ] No horizontal scroll\n\n### Solo Pages\n- [ ] Header fits\n- [ ] Messages wrap properly\n- [ ] Input area fits\n- [ ] No horizontal scroll\n\n### Epic Page\n- [ ] Header fits\n- [ ] Description wraps\n- [ ] Subtask list fits\n- [ ] File badges wrap (don't overflow)\n- [ ] Bottom actions fit\n- [ ] No horizontal scroll\n\n### Swarm Page\n- [ ] Header fits\n- [ ] Stats grid (2x2) fits\n- [ ] Agent cards fit\n- [ ] File locks truncate properly\n- [ ] Tasks list fits\n- [ ] No horizontal scroll\n\n### Ideate Page\n- [ ] Header fits\n- [ ] Messages wrap\n- [ ] CTA section stacks and fits\n- [ ] Input area fits\n- [ ] No horizontal scroll\n\n## Common Problem Areas\n\n### Text Overflow\n- Long titles without `truncate`\n- Long file paths without wrapping\n- Code snippets without `overflow-x-auto`\n\n### Fixed Widths\n- Elements with `w-[XXpx]` that don't have responsive variants\n- Flex containers without `flex-wrap`\n\n### Padding Issues\n- `px-6` (24px each side = 48px) leaves only 272px for content\n- Consider `px-3 lg:px-6` pattern\n\n## Fixes if Issues Found\n\n### For text overflow:\n```css\ntruncate        /* single line with ellipsis */\nline-clamp-2    /* 2 lines with ellipsis */\nbreak-words     /* wrap long words */\n```\n\n### For fixed widths:\n```css\nw-full lg:w-[400px]  /* full on mobile, fixed on desktop */\nmax-w-full           /* never exceed container */\nmin-w-0              /* allow flex items to shrink */\n```\n\n### For padding:\n```css\npx-3 lg:px-6         /* less padding on mobile */\n```\n\n## Success Criteria\n- No horizontal scroll indicator appears on any page\n- All content is readable and usable\n- No elements are cut off\n- Touch targets remain accessible (44px minimum)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:44.053166-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.24","title":"Phase 5.3: Verify touch-friendly tap targets (min 44px) throughout app","description":"## Objective\nVerify all interactive elements have touch-friendly tap targets of at least 44x44 pixels.\n\n## Background\nApple's Human Interface Guidelines and Google's Material Design both recommend minimum tap targets of 44-48 pixels. This ensures:\n- Users can accurately tap without frustration\n- Accessibility for users with motor impairments\n- Reduced accidental taps on wrong elements\n\n## Elements to Audit\n\n### Buttons\n- [ ] All `\u003cButton\u003e` components\n- [ ] Icon-only buttons (especially `size=\"icon-sm\"`)\n- [ ] Submit buttons in forms\n- [ ] Action buttons in dialogs\n\n### Links\n- [ ] Navigation links in sidebar\n- [ ] Card links (entire card should be tappable)\n- [ ] Text links in content\n- [ ] Header action links\n\n### Form Controls\n- [ ] Input fields (height)\n- [ ] Checkboxes\n- [ ] Radio buttons\n- [ ] Select dropdowns\n\n### Interactive Components\n- [ ] Accordion triggers\n- [ ] Tab buttons\n- [ ] Expand/collapse chevrons\n- [ ] SidebarTrigger\n\n## Measurement Technique\n\n### Browser DevTools\n1. Right-click element → Inspect\n2. Look at computed styles for height/width\n3. Check padding adds to clickable area\n\n### Visual Check\n1. Use 44px ruler overlay\n2. Element should be at least as large\n\n## Common Issues\n\n### Icon-only buttons\n```typescript\n// Too small:\n\u003cButton variant=\"ghost\" size=\"icon-sm\"\u003e  // 28x28\n  \u003cSend className=\"h-4 w-4\" /\u003e\n\u003c/Button\u003e\n\n// Better:\n\u003cButton variant=\"ghost\" size=\"icon\"\u003e  // 40x40, close enough\n  \u003cSend className=\"h-4 w-4\" /\u003e\n\u003c/Button\u003e\n\n// Or add padding:\n\u003cButton variant=\"ghost\" size=\"icon-sm\" className=\"p-2\"\u003e\n  \u003cSend className=\"h-4 w-4\" /\u003e\n\u003c/Button\u003e\n```\n\n### Small text links\n```typescript\n// Too small:\n\u003cspan className=\"text-xs\"\u003eEdit\u003c/span\u003e\n\n// Better:\n\u003cspan className=\"text-xs py-2 px-1 -my-2 -mx-1\"\u003eEdit\u003c/span\u003e\n// Padding increases tap target, negative margin maintains visual position\n```\n\n### Compact list items\n```typescript\n// Might be too small:\n\u003cdiv className=\"px-2 py-1\"\u003eItem\u003c/div\u003e\n\n// Better:\n\u003cdiv className=\"px-3 py-2\"\u003eItem\u003c/div\u003e  // 44px+ with line height\n```\n\n## Checklist by Component\n\n### Sidebar\n- [ ] Project names (entire row should be tappable)\n- [ ] Issue links\n- [ ] Expand/collapse buttons\n- [ ] Add project button\n- [ ] Footer buttons (New Idea, Solo Chat)\n\n### Dashboard\n- [ ] Session cards (48px+ height - OK)\n- [ ] Issue/Epic cards (should be tappable)\n- [ ] Accordion triggers\n- [ ] Add issue button\n\n### Issue View\n- [ ] Tab buttons\n- [ ] Action buttons in header\n- [ ] Message copy button\n- [ ] Submit button\n- [ ] Save summary button\n\n### All Pages\n- [ ] SidebarTrigger\n- [ ] Back buttons (ChevronLeft)\n- [ ] Header action buttons\n\n## Fixes to Apply\n\nIf elements are too small, use one of:\n\n1. **Increase size prop:**\n   `size=\"icon\"` instead of `size=\"icon-sm\"`\n\n2. **Add padding:**\n   `className=\"p-2\"` or `className=\"py-2 px-3\"`\n\n3. **Minimum height:**\n   `className=\"min-h-[44px]\"`\n\n4. **Invisible tap area:**\n   ```typescript\n   \u003cbutton className=\"relative\"\u003e\n     \u003cspan className=\"absolute inset-0 -m-2\" /\u003e  // Extends tap area\n     \u003cIcon /\u003e\n   \u003c/button\u003e\n   ```\n\n## Success Criteria\n- All interactive elements are at least 44x44px\n- Or have at least 44x44px tap target (via padding)\n- No elements require precision tapping\n- Tested on actual touch device if possible","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:44.10618-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.25","title":"Phase 5.4: Final regression testing and documentation update","description":"## Objective\nFinal regression testing and documentation update before closing the epic.\n\n## Regression Testing\n\n### Full User Journey Tests\n\n**Journey 1: Mobile User - New Issue**\n1. [ ] Open app on mobile (320px)\n2. [ ] Open sidebar via trigger\n3. [ ] Select a project\n4. [ ] Dashboard loads with accordion\n5. [ ] Open Issues accordion\n6. [ ] Tap \"New Issue\"\n7. [ ] Fill out and submit form\n8. [ ] Issue appears in list\n9. [ ] Tap issue to open\n10. [ ] Chat tab works\n11. [ ] Switch to Details tab\n12. [ ] Navigate back to dashboard\n\n**Journey 2: Desktop User - Swarm Monitoring**\n1. [ ] Open app on desktop (1440px)\n2. [ ] Sidebar visible, no trigger\n3. [ ] Select project from sidebar\n4. [ ] Dashboard shows kanban\n5. [ ] Click active swarm card\n6. [ ] Swarm page loads with stats\n7. [ ] Expand blocked agent\n8. [ ] Submit intervention\n9. [ ] Navigate via sidebar (doesn't close)\n10. [ ] Use cmd+b to toggle sidebar\n\n**Journey 3: Tablet User - Planning**\n1. [ ] Open app on tablet portrait (768px) - mobile layout\n2. [ ] Open sidebar via trigger\n3. [ ] Navigate to epic\n4. [ ] Review subtasks\n5. [ ] Use chat to refine\n6. [ ] Rotate to landscape (1024px) - desktop layout\n7. [ ] Sidebar appears automatically\n8. [ ] Launch swarm button visible\n\n### Feature Regression Tests\n\n**Sidebar Features:**\n- [ ] Project tree expand/collapse\n- [ ] Issue fetching per project\n- [ ] FolderBrowserModal opens\n- [ ] Active state highlighting\n- [ ] Mobile close on navigation\n- [ ] Desktop keyboard shortcut\n\n**Dashboard Features:**\n- [ ] Recent chats (both layouts)\n- [ ] All kanban columns (desktop)\n- [ ] All accordion sections (mobile)\n- [ ] New issue dialog\n- [ ] Card navigation\n\n**Issue View Features:**\n- [ ] Panel resize (desktop)\n- [ ] Tab switching (mobile)\n- [ ] Markdown rendering\n- [ ] Chat functionality\n- [ ] Unread indicator\n- [ ] Save summary\n\n## Documentation Updates\n\n### Files to Update\n\n**AGENTS.md or similar:**\n- [ ] Note the `lg:` breakpoint standard\n- [ ] Document responsive patterns used\n- [ ] Note shadcn components added\n\n**Component documentation (if exists):**\n- [ ] AppSidebar usage\n- [ ] Compact card components\n- [ ] Accordion patterns\n\n### Code Comments\nReview and ensure key responsive patterns are documented inline:\n- [ ] Layout switching logic\n- [ ] Breakpoint usage\n- [ ] Mobile-specific behavior\n\n## Cleanup Tasks\n\n- [ ] Remove sidebar.backup.tsx (if created and no longer needed)\n- [ ] Remove any TODO comments added during implementation\n- [ ] Ensure all console.logs removed\n- [ ] Run linter and fix issues\n- [ ] Run type checker and fix issues\n\n## Final Checklist\n\n- [ ] All Phase 1-4 tasks completed\n- [ ] All Phase 5.1-5.3 tests passed\n- [ ] No known critical bugs\n- [ ] No accessibility regressions\n- [ ] Performance acceptable\n- [ ] Code reviewed (if team process)\n- [ ] Changes committed and pushed\n\n## Closing the Epic\n\nOnce all above is verified:\n1. Update GH Issue #5 with summary of changes\n2. Close GH Issue #5\n3. Close this epic in beads\n4. Celebrate responsive design! \n\n## Post-Launch Monitoring\n\nConsider monitoring for:\n- User feedback on mobile experience\n- Error rates by device type\n- Performance metrics (Core Web Vitals) by viewport\n- Support requests related to mobile/responsive issues","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:44.160218-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.3","title":"Phase 0.3: Backup current sidebar.tsx content before shadcn installation","description":"Backup created at src/components/ui/sidebar.backup.tsx (305 lines). Contains TreeItem component, ProjectIssuesSection, and main Sidebar with all state management.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T21:11:42.951423-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Backup created at src/components/ui/sidebar.backup.tsx. Key components documented: TreeItem, ProjectIssuesSection, Sidebar.","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.4","title":"Phase 1.1: Install shadcn sidebar component","description":"## Objective\nInstall the shadcn sidebar component using the CLI.\n\n## Background\nThe shadcn/ui Sidebar component provides:\n- `collapsible=\"offcanvas\"` mode for mobile overlay\n- `SidebarProvider` with `useSidebar` hook for state management\n- `SidebarTrigger` for hamburger toggle button\n- Built-in `isMobile` detection (uses 1024px breakpoint by default)\n- Keyboard shortcut support (cmd+b / ctrl+b)\n- `SidebarInset` for main content area\n\n## Prerequisites\n- Phase 0.3 must be complete (backup created)\n- Git working tree should be clean or changes committed\n\n## Command\n```bash\npnpm dlx shadcn@latest add sidebar\n```\n\n## Expected Changes\n- `src/components/ui/sidebar.tsx` will be REPLACED with shadcn primitives\n- May add additional dependencies to package.json\n- May create additional utility files if needed\n\n## Post-Installation Verification\n1. Check that sidebar.tsx now contains shadcn primitives (Sidebar, SidebarContent, SidebarHeader, etc.)\n2. Verify no TypeScript errors\n3. Run `pnpm build` to check for issues (app will be broken until Phase 1.2-1.3)\n\n## Important Notes\n- The app WILL be broken after this step until we create app-sidebar.tsx and update layout.tsx\n- This is expected - don't panic\n- Phases 1.2 and 1.3 must follow immediately\n\n## Rollback Plan\nIf something goes catastrophically wrong:\n```bash\ngit checkout -- src/components/ui/sidebar.tsx\n```\nOr restore from sidebar.backup.tsx created in Phase 0.3","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T21:11:43.005394-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"shadcn sidebar installed. All exports available: Sidebar, SidebarProvider, SidebarTrigger, useSidebar, etc. App is broken as expected until layout is updated.","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.5","title":"Phase 1.2: Create app-sidebar.tsx preserving all existing sidebar functionality","description":"## Objective\nCreate a new `app-sidebar.tsx` component that uses the shadcn Sidebar primitives while preserving ALL existing sidebar functionality.\n\n## Background\nThe shadcn sidebar provides the responsive shell (offcanvas behavior, triggers, etc.) but we need to fill it with our app-specific content:\n- Project tree with expand/collapse\n- Live issue fetching per project\n- FolderBrowserModal integration\n- Navigation with active states\n- Bottom action buttons\n\n## Implementation Plan\n\n### 1. Import Structure\n```typescript\n\"use client\";\n\nimport { \n  Sidebar, \n  SidebarContent, \n  SidebarHeader, \n  SidebarFooter, \n  SidebarMenu, \n  SidebarMenuItem, \n  SidebarMenuButton, \n  SidebarGroup, \n  SidebarGroupLabel,\n  SidebarMenuSub,\n  SidebarMenuSubItem,\n  SidebarMenuSubButton,\n  useSidebar \n} from \"@/components/ui/sidebar\";\nimport { useParams, usePathname, useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\nimport Link from \"next/link\";\nimport { useProjects, useProjectIssues } from \"@/lib/hooks/useProjects\";\nimport { FolderBrowserModal } from \"@/components/folder-browser\";\n// ... icons\n```\n\n### 2. Component Structure\n```typescript\nexport function AppSidebar() {\n  // ALL existing state preserved:\n  const params = useParams();\n  const pathname = usePathname();\n  const router = useRouter();\n  const currentProjectId = params.id as string;\n  const { data: projects, isLoading } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  const [expandedProjects, setExpandedProjects] = useState\u003cSet\u003cstring\u003e\u003e(...);\n  \n  // NEW: Access sidebar state for mobile close behavior\n  const { setOpenMobile } = useSidebar();\n  \n  return (\n    \u003cSidebar collapsible=\"offcanvas\"\u003e\n      \u003cSidebarHeader\u003e...\u003c/SidebarHeader\u003e\n      \u003cSidebarContent\u003e...\u003c/SidebarContent\u003e\n      \u003cSidebarFooter\u003e...\u003c/SidebarFooter\u003e\n      \u003cFolderBrowserModal ... /\u003e\n    \u003c/Sidebar\u003e\n  );\n}\n```\n\n### 3. Key Features to Implement\n\n**Header Section:**\n- Logo + \"Maestro\" title\n- Search button with kbd shortcut display\n\n**Content Section:**\n- Projects group with \"+\" button to add project\n- Project tree using SidebarMenu \u003e SidebarMenuItem \u003e SidebarMenuSub structure\n- Each project expandable to show issues\n- Active state highlighting for current project/issue\n\n**Footer Section:**\n- \"New Idea\" link\n- \"Solo Chat\" link (primary styled)\n\n### 4. Navigation Click Handler\n```typescript\n// Wrap links to close mobile sidebar on navigation\nfunction NavLink({ href, children, ...props }) {\n  const { setOpenMobile } = useSidebar();\n  return (\n    \u003cLink \n      href={href} \n      onClick={() =\u003e setOpenMobile(false)}\n      {...props}\n    \u003e\n      {children}\n    \u003c/Link\u003e\n  );\n}\n```\n\n## Acceptance Criteria\n- [ ] All projects display with expand/collapse\n- [ ] Issues load and display under each project\n- [ ] Active states highlight correctly\n- [ ] FolderBrowserModal opens from \"+\" button\n- [ ] Navigation works and closes mobile sidebar\n- [ ] Search button present (even if non-functional)\n- [ ] Bottom actions link to correct pages\n\n## Files\n- Create: `src/components/app-sidebar.tsx`\n- Reference: `src/components/ui/sidebar.backup.tsx` (from Phase 0.3)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T21:11:43.061159-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.6","title":"Phase 1.3: Update project layout.tsx with SidebarProvider wrapper","description":"## Objective\nUpdate the project layout to use SidebarProvider and integrate the new AppSidebar component.\n\n## Background\nThe shadcn Sidebar requires a `SidebarProvider` wrapper to manage state (open/closed, mobile detection). The layout also needs `SidebarInset` to properly position the main content area.\n\n## Current Layout (layout.tsx)\n```typescript\nexport default function ProjectLayout({ children }) {\n  return (\n    \u003cdiv className=\"flex h-screen bg-background\"\u003e\n      \u003cSidebar /\u003e\n      \u003cmain className=\"flex-1 overflow-y-auto\"\u003e\n        {children}\n      \u003c/main\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## New Layout Structure\n```typescript\nimport { SidebarProvider, SidebarInset } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\n\nexport default function ProjectLayout({ children }) {\n  return (\n    \u003cSidebarProvider\u003e\n      \u003cAppSidebar /\u003e\n      \u003cSidebarInset\u003e\n        \u003cmain className=\"flex-1 overflow-hidden\"\u003e\n          {children}\n        \u003c/main\u003e\n      \u003c/SidebarInset\u003e\n    \u003c/SidebarProvider\u003e\n  );\n}\n```\n\n## Key Changes\n1. Import `SidebarProvider` and `SidebarInset` from shadcn sidebar\n2. Import `AppSidebar` from our new component\n3. Wrap entire layout in `SidebarProvider`\n4. Replace `\u003cSidebar /\u003e` with `\u003cAppSidebar /\u003e`\n5. Wrap `\u003cmain\u003e` in `\u003cSidebarInset\u003e`\n6. Remove the outer `\u003cdiv className=\"flex h-screen\"\u003e` (SidebarProvider handles this)\n\n## Considerations\n\n### Cookie-based Persistence (Optional)\nThe shadcn SidebarProvider supports cookie-based persistence of sidebar state:\n```typescript\n\u003cSidebarProvider defaultOpen={cookies.get(\"sidebar:state\")?.value === \"true\"}\u003e\n```\nThis is a nice-to-have for desktop users but not required for MVP.\n\n### Mobile Detection\nSidebarProvider automatically detects mobile using a 1024px breakpoint (matching our `lg:` strategy). No configuration needed.\n\n## Testing After This Phase\n- Desktop: Sidebar should be visible, full width\n- Mobile (\u003c1024px): Sidebar should be hidden\n- The app should not crash (basic functionality restored)\n\n## Files\n- Modify: `src/app/project/[id]/layout.tsx`","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T21:11:43.116517-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.7","title":"Phase 1.4: Add SidebarTrigger to all page headers for mobile","description":"## Objective\nAdd a SidebarTrigger (hamburger menu button) to all page headers so mobile users can open the sidebar.\n\n## Background\nOn mobile (\u003c1024px), the sidebar is hidden by default. Users need a way to open it. The `SidebarTrigger` component from shadcn provides a hamburger icon that toggles the sidebar.\n\n## Pages Requiring SidebarTrigger\n\n### 1. Dashboard (page.tsx)\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b border-border bg-card flex-shrink-0\"\u003e\n  \u003cdiv className=\"flex h-12 items-center justify-between px-6\"\u003e\n+   \u003cSidebarTrigger className=\"lg:hidden mr-2\" /\u003e\n    \u003cdiv className=\"flex items-center gap-3\"\u003e\n      \u003ch1 className=\"font-semibold text-lg\"\u003e{project.name}\u003c/h1\u003e\n      ...\n```\n\n### 2. Issue View (issue/[issueNumber]/page.tsx)\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b border-border bg-card\"\u003e\n  \u003cdiv className=\"flex h-12 items-center gap-2 px-4\"\u003e\n+   \u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n    \u003cLink href={`/project/${projectId}`} ...\u003e\n      \u003cChevronLeft ... /\u003e\n    \u003c/Link\u003e\n    ...\n```\n\n### 3. Solo Page (solo/page.tsx)\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b border-border bg-card\"\u003e\n  \u003cdiv className=\"flex h-12 items-center gap-2 px-4\"\u003e\n+   \u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n    \u003cLink href={`/project/${project.id}`} ...\u003e\n      \u003cChevronLeft ... /\u003e\n    \u003c/Link\u003e\n    ...\n```\n\n### 4. Solo Session Page (solo/[sessionId]/page.tsx)\nSame pattern as Solo Page.\n\n### 5. Epic Page (epic/[epicId]/page.tsx)\nSame pattern as Solo Page.\n\n### 6. Swarm Page (swarm/[epicId]/page.tsx)\nSame pattern as Solo Page.\n\n### 7. Ideate Page (ideate/page.tsx)\nSame pattern as Solo Page.\n\n## Implementation Pattern\n```typescript\nimport { SidebarTrigger } from \"@/components/ui/sidebar\";\n\n// In header, before any back button or title:\n\u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n```\n\n## Why `lg:hidden`?\n- On desktop (\u003e=1024px), the sidebar is always visible, so the trigger is unnecessary\n- On mobile (\u003c1024px), the trigger is needed to open the offcanvas sidebar\n- This matches our primary breakpoint strategy\n\n## Visual Placement\nThe trigger should be the first element in the header (leftmost on LTR layouts). If there's a back button (ChevronLeft), the trigger goes BEFORE it.\n\n## Testing\n- On desktop: Trigger should not be visible\n- On mobile: Trigger should be visible and open sidebar on click\n- Sidebar should overlay the page content when open\n\n## Files to Modify\n- src/app/project/[id]/page.tsx\n- src/app/project/[id]/issue/[issueNumber]/page.tsx\n- src/app/project/[id]/solo/page.tsx\n- src/app/project/[id]/solo/[sessionId]/page.tsx\n- src/app/project/[id]/epic/[epicId]/page.tsx\n- src/app/project/[id]/swarm/[epicId]/page.tsx\n- src/app/project/[id]/ideate/page.tsx","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T21:11:43.171263-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.8","title":"Phase 1.5: Wire up setOpenMobile(false) on all navigation clicks in sidebar","description":"## Objective\nEnsure the mobile sidebar closes automatically when users click any navigation link within it.\n\n## Background\nOn mobile, when users tap a link in the sidebar (e.g., a project, an issue, or \"Solo Chat\"), the sidebar should close so they can see the page they navigated to. Without this, the sidebar remains open and covers the content.\n\n## Implementation\n\n### Option 1: Wrapper Component (Recommended)\nCreate a reusable NavLink component inside app-sidebar.tsx:\n\n```typescript\nfunction SidebarNavLink({ href, children, className, ...props }) {\n  const { setOpenMobile } = useSidebar();\n  \n  return (\n    \u003cLink \n      href={href} \n      onClick={() =\u003e setOpenMobile(false)}\n      className={className}\n      {...props}\n    \u003e\n      {children}\n    \u003c/Link\u003e\n  );\n}\n```\n\nUse this for all navigation links in the sidebar.\n\n### Option 2: Direct onClick Handlers\nAdd onClick handlers directly to each Link:\n\n```typescript\nconst { setOpenMobile } = useSidebar();\n\n\u003cLink \n  href={`/project/${project.id}`}\n  onClick={() =\u003e setOpenMobile(false)}\n\u003e\n  {project.displayName}\n\u003c/Link\u003e\n```\n\n### Places to Update\n\n1. **Project names** - clicking navigates to project dashboard\n2. **Issue links** - clicking navigates to issue view\n3. **\"New Idea\" button** - navigates to ideate page\n4. **\"Solo Chat\" button** - navigates to solo page\n5. **Any other clickable navigation items**\n\n### Non-Navigation Clicks\nSome clicks should NOT close the sidebar:\n- Expand/collapse project tree (toggleProjectExpanded)\n- Opening FolderBrowserModal (add project button)\n- Search button (when implemented)\n\nOnly NAVIGATION (page changes) should close the sidebar.\n\n## Testing Checklist\n- [ ] Click project name → sidebar closes, navigates to dashboard\n- [ ] Click issue → sidebar closes, navigates to issue view\n- [ ] Click \"New Idea\" → sidebar closes, navigates to ideate\n- [ ] Click \"Solo Chat\" → sidebar closes, navigates to solo\n- [ ] Expand/collapse project → sidebar stays open\n- [ ] Click \"+\" to add project → modal opens, sidebar stays open\n\n## Why This Matters\nPoor mobile UX if users have to manually close the sidebar after every navigation. This is a critical usability pattern for mobile apps.\n\n## Files\n- Modify: `src/components/app-sidebar.tsx`","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T21:11:43.224516-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.9","title":"Phase 1.6: Test sidebar mobile overlay behavior and keyboard shortcut (cmd+b)","description":"## Objective\nComprehensive testing of the new sidebar implementation on mobile and desktop.\n\n## Test Scenarios\n\n### Mobile Tests (viewport \u003c 1024px)\n\n**Visibility:**\n- [ ] Sidebar is hidden by default\n- [ ] SidebarTrigger (hamburger) is visible in all page headers\n- [ ] Clicking trigger opens sidebar as overlay\n- [ ] Sidebar overlays content (doesn't push it)\n- [ ] Background is dimmed when sidebar is open\n\n**Navigation:**\n- [ ] Clicking any navigation link closes sidebar\n- [ ] Page content updates correctly after navigation\n- [ ] Back button (ChevronLeft) still works alongside trigger\n\n**Interactions:**\n- [ ] Expand/collapse project works, sidebar stays open\n- [ ] Add project button opens FolderBrowserModal\n- [ ] Search button is visible (even if non-functional)\n- [ ] Clicking outside sidebar closes it\n- [ ] Swiping to close works (if supported by shadcn)\n\n### Desktop Tests (viewport \u003e= 1024px)\n\n**Visibility:**\n- [ ] Sidebar is visible and docked (not overlay)\n- [ ] SidebarTrigger is hidden\n- [ ] Sidebar takes fixed width (~256px or as styled)\n\n**Functionality:**\n- [ ] All project expand/collapse works\n- [ ] Issue fetching works per project\n- [ ] Active states highlight correctly\n- [ ] Navigation works normally\n- [ ] FolderBrowserModal works\n\n**Keyboard Shortcut:**\n- [ ] cmd+b (Mac) / ctrl+b (Windows) toggles sidebar\n- [ ] Focus moves appropriately when toggling\n- [ ] Shortcut works from any page in /project/*\n\n### Responsive Transition Test\n- [ ] Resize browser from mobile to desktop: sidebar appears\n- [ ] Resize browser from desktop to mobile: sidebar hides\n- [ ] No layout jump or flash during resize\n- [ ] State (expanded projects) preserved during resize\n\n### Edge Cases\n- [ ] Deep link directly to issue while on mobile - trigger visible\n- [ ] Refresh page while sidebar open on mobile\n- [ ] Navigate away from /project/* and back\n\n## How to Test\n1. Use browser DevTools device toolbar for mobile testing\n2. Test on actual iPhone/Android if available\n3. Test Safari, Chrome, Firefox for browser compatibility\n4. Test with keyboard only (accessibility)\n\n## Bug Template\nIf issues found, document:\n- Steps to reproduce\n- Expected behavior\n- Actual behavior\n- Screenshot/video if applicable\n- Browser and viewport size\n\n## Success Criteria\nAll checkboxes above should pass. Any failures should be logged as bugs to fix before Phase 1 is complete.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T21:11:43.276903-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp","title":"Issue Discussion: Chat Interface with GitHub Issue Persistence","description":"## Overview\n\nImplement the Issue Discussion view - a split-panel interface where users explore and refine GitHub Issues with an AI agent, using the GitHub issue itself as the persistent source of truth.\n\n## Architectural Philosophy\n\nThis feature embodies a key architectural principle: **GitHub Issues ARE the persistent artifact**. Unlike traditional chat applications where conversation history is stored separately, we use GitHub Issues as the canonical source of truth. OpenCode sessions are transient - they can be recreated at any time by re-injecting the issue context.\n\n### Key Design Decisions\n\n1. **No git branch/worktree during discussion** - Agent operates on main branch in read-only exploration mode\n2. **GitHub Issue IS persistence** - Not local files, not OpenCode session state\n3. **Sessions are ephemeral** - Can be recreated by injecting issue context\n4. **Summary persistence is on-demand** - User explicitly saves conversation summaries as GitHub comments\n5. **No new concepts** - We work directly with GitHub Issues\n\n## Why This Matters\n\nThe Issue Discussion phase is the first step in the Maestro workflow:\n\n```\nIssue Discussion → Planning → Execution (Swarm/Solo) → Completion\n```\n\nUsers need a space to:\n- Explore ideas with AI assistance\n- Understand codebase implications\n- Refine requirements before committing to implementation\n- Build shared context that persists beyond any single conversation\n\n## Technical Context\n\n### Already Implemented\n- NewIssueDialog component (creates GitHub issues)\n- Issue View page (basic split panel, but chat is mocked)\n- Issues API endpoints (list, create, get single)\n- Mobile tabbed interface\n- Desktop split panel (fixed 400px width)\n\n### Needs Implementation\n- OpenCode SDK integration (replacing mock setTimeout)\n- Session storage service (~/.maestro/sessions.json)\n- Comments display in issue panel\n- Add comment API endpoint\n- Session management API endpoints\n- SSE streaming for real-time responses\n- Save Summary modal\n- Error handling infrastructure\n- Panel resizing (polish)\n\n## Parallelization Opportunities\n\n**Can be worked in parallel:**\n- Task 1.1 (Install SDK) + Task 1.3 (SessionStorage) - no dependencies between them\n- Task 3.1 (Display comments) - pure UI, no dependencies at all\n- Task 3.2 (Comment posting API) - independent of OpenCode work\n- Task 4.2 (Panel resizing) - independent UI polish\n\n**Critical path:**\n1.1 → 1.2 → 1.4 → 2.1 → 2.3 → 2.4\n\n**Merge notes:**\n- Task 2.2 was merged into 1.4 (context injection is part of session creation)\n\n## OpenCode SDK Key Points\n\n**Critical: Directory Parameter**\nThe OpenCode SDK operates on a specific project directory. Almost every API call requires a `directory` query parameter. Our services must pass the project path to OpenCode.\n\n**Streaming Pattern**\nFor real-time streaming, use:\n1. `session.promptAsync()` - starts prompt, returns immediately\n2. `event.subscribe()` - SSE stream for updates\n3. Listen for `message.part.updated` events with `delta` property\n\n**Health Check**\nUse `client.global.health()` for connectivity checks.\n\n## Dependencies\n\nExternal:\n- OpenCode server running locally (`opencode serve`)\n- @opencode-ai/sdk npm package\n- GitHub CLI (`gh`) authenticated\n\nInternal:\n- ConfigService (for project paths) - EXISTS\n- TanStack Query hooks pattern - EXISTS\n- UI component library - EXISTS\n\n## Success Criteria\n\n1. User can chat with AI about a GitHub issue\n2. AI has full issue context (title, body, comments)\n3. AI can read codebase but cannot modify files\n4. Conversation summaries can be saved to GitHub\n5. Sessions reconnect gracefully if interrupted\n6. Works on both desktop and mobile layouts\n\n## Reference\n\nGitHub Issue: https://github.com/ejohane/maestro/issues/3\nOpenCode SDK Docs: https://opencode.ai/docs/sdk","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-30T10:33:34.352275-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:57.165223-06:00","close_reason":"Completed","deleted_at":"2025-12-31T08:43:57.165223-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-fyp.1","title":"Phase 1: Core Infrastructure","description":"## Phase 1: Core Infrastructure\n\nThis phase establishes the foundational services and API endpoints that all subsequent phases depend on. Without this infrastructure, we cannot connect to OpenCode or manage sessions.\n\n### Why This Phase First?\n\nThe Issue Discussion feature is fundamentally about connecting the Maestro UI to the OpenCode AI backend. Before we can build any user-facing chat functionality, we need:\n\n1. **SDK Integration** - The bridge between our frontend and OpenCode\n2. **Session Management** - Tracking which OpenCode session belongs to which GitHub issue\n3. **Health Monitoring** - Knowing when OpenCode is available\n\n### Technical Decisions\n\n**Session Storage Location: `~/.maestro/sessions.json`**\n- Chosen to match existing config pattern (`~/.maestro/config.json`)\n- JSON file is simple, human-readable, and sufficient for local use\n- Cross-device support via shared filesystem (Tailscale)\n- No database overhead for this MVP\n\n**One Session Per Issue (Singleton Pattern)**\n- Simplifies reasoning about state\n- Prevents duplicate sessions consuming resources\n- If session dies, we recreate with context injection\n\n**Lazy Session Cleanup**\n- Don't proactively garbage collect sessions\n- Check if alive when requested, recreate if dead\n- Simple and robust for MVP\n\n### API Design\n\nFollowing existing patterns in the codebase:\n- Use Next.js 15 async params pattern\n- Return `{ error: \"message\" }` on failures\n- Execute `gh` commands with `cwd: project.path`\n\n### Deliverables\n\n1. OpenCode SDK installed and typed\n2. OpenCodeService wrapper with error handling\n3. SessionStorage service for JSON persistence\n4. Session management API endpoints\n5. Health check endpoint\n\n### Dependencies\n\nNone - this is the foundation.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:33:34.407677-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"All Phase 1 subtasks completed: SDK installed, OpenCodeService created, SessionStorage service created, session API endpoints created, health check endpoint created","dependencies":[{"issue_id":"maestro-fyp.1","depends_on_id":"maestro-fyp","type":"parent-child","created_at":"2025-12-30T10:33:34.409693-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.1.1","title":"Install and configure @opencode-ai/sdk","description":"## Task\n\nInstall the OpenCode SDK and configure TypeScript types.\n\n## Why\n\nThe SDK is the foundation for all OpenCode communication. Without it, we cannot create sessions, send messages, or stream responses.\n\n## Implementation\n\n```bash\nbun add @opencode-ai/sdk\n```\n\n## Verification\n\n1. Import works: `import { createOpencodeClient } from \"@opencode-ai/sdk\"`\n2. TypeScript types are available\n3. No build errors\n\n## Files to Create/Modify\n\n- `package.json` - Add dependency\n- `bun.lock` - Updated automatically\n\n## Notes\n\nSDK documentation: https://opencode.ai/docs/sdk\n\nThe SDK provides:\n- `createOpencodeClient()` - Factory function\n- `client.session.create()` - Create new session\n- `client.session.prompt()` - Send message\n- `client.event.subscribe()` - SSE streaming\n- Full TypeScript types\n\n## Acceptance Criteria\n\n- [ ] SDK installed via bun\n- [ ] Imports work without errors\n- [ ] Types are available in IDE","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:34:38.849563-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"SDK @opencode-ai/sdk@1.0.214 installed successfully, types verified","dependencies":[{"issue_id":"maestro-fyp.1.1","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:34:38.851496-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.1.2","title":"Create OpenCodeService wrapper","description":"## Task\n\nCreate `src/lib/services/opencode.ts` - A service wrapper around the OpenCode SDK with error handling and helper methods.\n\n## Why\n\nDirect SDK usage scatters OpenCode-specific logic across the codebase. A service wrapper:\n- Centralizes configuration (base URL)\n- Provides typed helper methods\n- Handles common error patterns\n- Makes testing easier (can mock the service)\n\n## CRITICAL: Directory Parameter\n\nThe OpenCode SDK operates on a **specific project directory**. Almost every API call accepts a `directory` query parameter. Our service MUST pass the project path to OpenCode so it knows which project context to use.\n\n## Implementation\n\n```typescript\n// src/lib/services/opencode.ts\nimport { createOpencodeClient } from \"@opencode-ai/sdk\"\n\nexport interface OpenCodeConfig {\n  baseUrl: string\n}\n\nexport class OpenCodeService {\n  private client: ReturnType\u003ctypeof createOpencodeClient\u003e\n  \n  constructor(config?: Partial\u003cOpenCodeConfig\u003e) {\n    this.client = createOpencodeClient({\n      baseUrl: config?.baseUrl || process.env.OPENCODE_URL || \"http://localhost:4096\"\n    })\n  }\n\n  // Create a new session\n  async createSession(projectPath: string, title: string): Promise\u003c{ id: string }\u003e {\n    const result = await this.client.session.create({\n      query: { directory: projectPath },\n      body: { title }\n    })\n    return { id: result.data!.id }\n  }\n\n  // Check if session is alive\n  async isSessionAlive(projectPath: string, sessionId: string): Promise\u003cboolean\u003e {\n    try {\n      await this.client.session.get({\n        path: { id: sessionId },\n        query: { directory: projectPath }\n      })\n      return true\n    } catch {\n      return false\n    }\n  }\n\n  // Inject context without AI response\n  async injectContext(projectPath: string, sessionId: string, context: string): Promise\u003cvoid\u003e {\n    await this.client.session.prompt({\n      path: { id: sessionId },\n      query: { directory: projectPath },\n      body: {\n        noReply: true,\n        parts: [{\n          type: \"text\",\n          text: context,\n          synthetic: true  // Mark as system-injected\n        }]\n      }\n    })\n  }\n\n  // Send message in read-only mode using ASYNC prompt + events\n  // NOTE: Use prompt_async for streaming, then subscribe to events\n  async sendReadOnlyMessageAsync(projectPath: string, sessionId: string, message: string): Promise\u003cvoid\u003e {\n    // This starts the prompt but doesn't wait for response\n    // Caller should subscribe to events for streaming\n    await this.client.session.promptAsync({\n      path: { id: sessionId },\n      query: { directory: projectPath },\n      body: {\n        tools: {\n          bash: false,\n          write: false,\n          edit: false\n        },\n        parts: [{ type: \"text\", text: message }]\n      }\n    })\n  }\n\n  // Request conversation summary (sync, waits for response)\n  async generateSummary(projectPath: string, sessionId: string): Promise\u003cstring\u003e {\n    const result = await this.client.session.prompt({\n      path: { id: sessionId },\n      query: { directory: projectPath },\n      body: {\n        parts: [{\n          type: \"text\",\n          text: \"Summarize our discussion so far in 2-3 paragraphs. Focus on key decisions made, open questions identified, and suggested next steps. Format as markdown.\"\n        }]\n      }\n    })\n    // Extract text from response parts\n    const textPart = result.data?.parts?.find(p =\u003e p.type === \"text\")\n    return textPart?.text || \"\"\n  }\n\n  // Health check using SDK's built-in method\n  async isHealthy(): Promise\u003cboolean\u003e {\n    try {\n      const result = await this.client.global.health()\n      return result.data?.healthy === true\n    } catch {\n      return false\n    }\n  }\n\n  // Get SSE event stream\n  async subscribeToEvents(projectPath: string): Promise\u003cAsyncIterable\u003cany\u003e\u003e {\n    const events = await this.client.event.subscribe({\n      query: { directory: projectPath }\n    })\n    return events.stream\n  }\n}\n\n// Singleton instance for server-side use\nexport const openCodeService = new OpenCodeService()\n```\n\n## Key Design Decisions\n\n1. **projectPath required** - Every method requires the project path to pass to OpenCode\n2. **Singleton pattern** - One instance per server, consistent config\n3. **Environment variable** - `OPENCODE_URL` for different environments\n4. **Read-only mode** - `sendReadOnlyMessageAsync` enforces tool restrictions\n5. **Health check** - Uses SDK's `client.global.health()` method\n6. **Async prompts** - Use `promptAsync` for streaming, not `prompt`\n\n## Files to Create\n\n- `src/lib/services/opencode.ts`\n\n## Dependencies\n\n- `@opencode-ai/sdk` installed (previous task)\n\n## Acceptance Criteria\n\n- [ ] Service compiles without errors\n- [ ] All methods accept projectPath parameter\n- [ ] createSession returns session ID\n- [ ] isSessionAlive correctly detects dead sessions\n- [ ] injectContext uses noReply: true, synthetic: true on the part\n- [ ] sendReadOnlyMessageAsync disables bash/write/edit tools\n- [ ] isHealthy uses client.global.health()\n- [ ] Error handling for network failures","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:34:49.521334-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"OpenCodeService wrapper created with all methods, TypeScript types resolved, compiles without errors","dependencies":[{"issue_id":"maestro-fyp.1.2","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:34:49.523394-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.1.2","depends_on_id":"maestro-fyp.1.1","type":"blocks","created_at":"2025-12-30T10:39:14.329104-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.1.3","title":"Create SessionStorage service","description":"## Task\n\nCreate `src/lib/services/sessions.ts` - A service for persisting session-to-issue mappings in `~/.maestro/sessions.json`.\n\n## Why\n\nWe need to track which OpenCode session belongs to which GitHub issue:\n- Resume sessions when user returns to an issue\n- Avoid creating duplicate sessions\n- Cross-device support (file on server, not localStorage)\n\n## Data Model\n\n```typescript\ninterface SessionMapping {\n  projectId: string       // Project UUID (from Maestro config)\n  projectPath: string     // Project absolute path (for verification)\n  issueNumber: number     // GitHub issue number\n  sessionId: string       // OpenCode session ID\n  createdAt: string       // ISO timestamp\n  lastAccessedAt: string  // ISO timestamp (updated on access)\n}\n\ninterface SessionStore {\n  version: 1              // For future migrations\n  mappings: SessionMapping[]\n}\n```\n\n**Note**: We store `projectPath` alongside `projectId` for verification. If the project path changes (relocation), we can still match on projectId.\n\n## Implementation\n\n```typescript\n// src/lib/services/sessions.ts\nimport { promises as fs } from \"fs\"\nimport path from \"path\"\nimport os from \"os\"\n\nconst SESSIONS_PATH = path.join(os.homedir(), \".maestro\", \"sessions.json\")\n\nexport class SessionStorageService {\n  // Get session for issue (or null if none)\n  async getSession(projectId: string, issueNumber: number): Promise\u003cSessionMapping | null\u003e {\n    const store = await this.readStore()\n    return store.mappings.find(\n      m =\u003e m.projectId === projectId \u0026\u0026 m.issueNumber === issueNumber\n    ) ?? null\n  }\n\n  // Save session mapping\n  async saveSession(\n    projectId: string,\n    projectPath: string,\n    issueNumber: number,\n    sessionId: string\n  ): Promise\u003cvoid\u003e {\n    const store = await this.readStore()\n    \n    // Remove any existing mapping for this issue\n    store.mappings = store.mappings.filter(\n      m =\u003e !(m.projectId === projectId \u0026\u0026 m.issueNumber === issueNumber)\n    )\n    \n    // Add new mapping\n    store.mappings.push({\n      projectId,\n      projectPath,\n      issueNumber,\n      sessionId,\n      createdAt: new Date().toISOString(),\n      lastAccessedAt: new Date().toISOString()\n    })\n    \n    await this.writeStore(store)\n  }\n\n  // Remove session mapping (when session dies)\n  async removeSession(projectId: string, issueNumber: number): Promise\u003cvoid\u003e {\n    const store = await this.readStore()\n    store.mappings = store.mappings.filter(\n      m =\u003e !(m.projectId === projectId \u0026\u0026 m.issueNumber === issueNumber)\n    )\n    await this.writeStore(store)\n  }\n\n  // Update lastAccessedAt timestamp\n  async touchSession(projectId: string, issueNumber: number): Promise\u003cvoid\u003e {\n    const store = await this.readStore()\n    const mapping = store.mappings.find(\n      m =\u003e m.projectId === projectId \u0026\u0026 m.issueNumber === issueNumber\n    )\n    if (mapping) {\n      mapping.lastAccessedAt = new Date().toISOString()\n      await this.writeStore(store)\n    }\n  }\n\n  // Internal: read file, handle missing/corrupt\n  private async readStore(): Promise\u003cSessionStore\u003e {\n    try {\n      const content = await fs.readFile(SESSIONS_PATH, \"utf-8\")\n      return JSON.parse(content)\n    } catch (err: unknown) {\n      if (err \u0026\u0026 typeof err === \"object\" \u0026\u0026 \"code\" in err \u0026\u0026 err.code === \"ENOENT\") {\n        // File doesn't exist - return empty store\n        return { version: 1, mappings: [] }\n      }\n      // Corrupt JSON - reset to empty\n      console.error(\"Corrupt sessions.json, resetting:\", err)\n      return { version: 1, mappings: [] }\n    }\n  }\n\n  // Internal: write file atomically\n  private async writeStore(store: SessionStore): Promise\u003cvoid\u003e {\n    const dir = path.dirname(SESSIONS_PATH)\n    await fs.mkdir(dir, { recursive: true })\n    \n    // Write to temp file then rename (atomic)\n    const tempPath = SESSIONS_PATH + \".tmp\"\n    await fs.writeFile(tempPath, JSON.stringify(store, null, 2))\n    await fs.rename(tempPath, SESSIONS_PATH)\n  }\n}\n\nexport const sessionStorage = new SessionStorageService()\n```\n\n## Key Design Decisions\n\n1. **File-based storage** - Matches config pattern, simple and sufficient\n2. **Atomic writes** - Write to temp file, then rename (prevents corruption)\n3. **Auto-create directory** - Create ~/.maestro if missing\n4. **Graceful degradation** - Return empty store if file missing/corrupt\n5. **lastAccessedAt** - For potential future cleanup of stale sessions\n6. **projectPath stored** - For verification when reconnecting\n\n## Files to Create\n\n- `src/lib/services/sessions.ts`\n\n## Dependencies\n\nNone - uses Node.js fs module.\n\n## Acceptance Criteria\n\n- [ ] Creates ~/.maestro directory if missing\n- [ ] Reads existing sessions.json correctly\n- [ ] Handles missing file gracefully (returns empty)\n- [ ] Handles corrupt JSON gracefully (resets to empty)\n- [ ] Saves session mappings correctly with projectPath\n- [ ] Removes session mappings correctly\n- [ ] Atomic file writes (no partial writes)\n- [ ] Updates lastAccessedAt on touch","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:35:00.119368-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"SessionStorage service created with all required methods, atomic writes, graceful error handling","dependencies":[{"issue_id":"maestro-fyp.1.3","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:35:00.121484-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.1.4","title":"Create session management API endpoints","description":"## Task\n\nCreate API endpoints for managing OpenCode sessions tied to GitHub issues:\n- `POST /api/projects/[id]/issues/[issueNumber]/session` - Create/resume session\n- `GET /api/projects/[id]/issues/[issueNumber]/session` - Get existing session ID\n\n**This task also includes context injection** - when a session is created, the full GitHub issue context is injected.\n\n## Why\n\nThe frontend needs a way to:\n1. Get or create a session when opening an issue\n2. Know which session ID to use for chat\n\n## Implementation\n\n### GET /api/projects/[id]/issues/[issueNumber]/session\n\nReturns existing session ID if alive, or null.\n\n```typescript\n// Response (200)\n{ sessionId: string | null }\n\n// Response (404)\n{ error: \"Issue not found\" }\n```\n\n**Logic:**\n1. Get project from config (need project.path for OpenCode)\n2. Check sessionStorage for existing mapping\n3. If mapping exists, verify session is alive via OpenCodeService.isSessionAlive(projectPath, sessionId)\n4. If alive, touch session timestamp, return sessionId\n5. If dead, remove mapping, return null\n\n### POST /api/projects/[id]/issues/[issueNumber]/session\n\nCreates new session with context injection.\n\n```typescript\n// Response (201)\n{ sessionId: string }\n\n// Response (500)\n{ error: \"Failed to create session\" }\n```\n\n**Logic:**\n1. Get project from config (need project.path)\n2. Fetch issue details (title, body, comments) via gh CLI\n3. Create new OpenCode session via openCodeService.createSession(projectPath, title)\n4. Inject issue context via openCodeService.injectContext(projectPath, sessionId, context)\n5. Save session mapping to sessionStorage (with projectPath)\n6. Return sessionId\n\n## Context Injection Format\n\n```typescript\nfunction buildIssueContext(issue: GitHubIssue): string {\n  const comments = issue.comments?.length\n    ? issue.comments.map(c =\u003e\n        `**@${c.author.login}** (${new Date(c.createdAt).toLocaleDateString()}):\\n${c.body}`\n      ).join(\"\\n\\n\")\n    : \"No comments yet.\"\n\n  return `## GitHub Issue #${issue.number}\n\n**Title:** ${issue.title}\n**State:** ${issue.state}\n**Author:** @${issue.author.login}\n**Labels:** ${issue.labels.map(l =\u003e l.name).join(\", \") || \"None\"}\n**Created:** ${new Date(issue.createdAt).toLocaleDateString()}\n\n### Description\n${issue.body || \"No description provided.\"}\n\n### Comments\n${comments}\n\n---\nYou are helping discuss this GitHub issue. You can read the codebase to answer questions and suggest approaches, but you cannot modify any files. Focus on exploration and understanding.`\n}\n```\n\n## Key Design Points\n\n1. **Pass projectPath to OpenCode** - Required for OpenCode to know which project\n2. **Context uses synthetic: true** - On the text part, not the body\n3. **Context uses noReply: true** - Do not generate AI response for injection\n4. **Store projectPath in sessionStorage** - For future verification\n\n## Files to Create\n\n- `src/app/api/projects/[id]/issues/[issueNumber]/session/route.ts`\n\n## Dependencies\n\n- OpenCodeService (task 1.2)\n- SessionStorageService (task 1.3)\n- Existing issue detail API (for fetching issue data)\n\n## Acceptance Criteria\n\n- [ ] GET returns sessionId if session exists and alive\n- [ ] GET returns null if no session\n- [ ] GET removes stale mappings for dead sessions\n- [ ] POST creates new session with correct projectPath\n- [ ] POST injects full issue context with synthetic: true, noReply: true\n- [ ] POST saves mapping to sessionStorage with projectPath\n- [ ] Proper error handling for missing project/issue\n- [ ] Follows Next.js 15 async params pattern","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:35:12.798714-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Session API endpoints created with GET and POST handlers, context injection, sessionStorage integration","dependencies":[{"issue_id":"maestro-fyp.1.4","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:35:12.80093-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.1.4","depends_on_id":"maestro-fyp.1.2","type":"blocks","created_at":"2025-12-30T10:39:14.362071-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.1.4","depends_on_id":"maestro-fyp.1.3","type":"blocks","created_at":"2025-12-30T10:39:14.39511-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.1.5","title":"Create OpenCode health check API endpoint","description":"## Task\n\nCreate `GET /api/health/opencode` - An endpoint to check if the OpenCode server is reachable.\n\n## Why\n\nThe frontend needs to know if OpenCode is available before attempting to use it. This enables:\n- Showing helpful error messages (\"Start opencode serve\")\n- Disabling chat UI when OpenCode is down\n- Periodic connectivity checks\n\n## Implementation\n\nUse the SDK's built-in `client.global.health()` method:\n\n```typescript\n// src/app/api/health/opencode/route.ts\n\nimport { openCodeService } from \"@/lib/services/opencode\"\nimport { NextResponse } from \"next/server\"\n\nexport async function GET() {\n  try {\n    const healthy = await openCodeService.isHealthy()\n    \n    if (healthy) {\n      return NextResponse.json({\n        status: \"healthy\",\n        url: process.env.OPENCODE_URL || \"http://localhost:4096\"\n      })\n    } else {\n      return NextResponse.json({\n        status: \"unhealthy\",\n        error: \"OpenCode server not responding\"\n      }, { status: 503 })\n    }\n  } catch (error) {\n    return NextResponse.json({\n      status: \"unhealthy\",\n      error: error instanceof Error ? error.message : \"Unknown error\"\n    }, { status: 503 })\n  }\n}\n```\n\n## SDK Health Check\n\nThe SDK provides `client.global.health()` which returns:\n```typescript\n{ healthy: true, version: string }\n```\n\nThis is the recommended way to check connectivity.\n\n## Response Format\n\n```typescript\n// Success (200)\n{\n  status: \"healthy\",\n  url: \"http://localhost:4096\"\n}\n\n// Failure (503)\n{\n  status: \"unhealthy\",\n  error: \"Connection refused\" // or similar\n}\n```\n\n## Usage in Frontend\n\n```typescript\n// Poll health periodically\nconst { data: health } = useQuery({\n  queryKey: [\"opencode-health\"],\n  queryFn: () =\u003e fetch(\"/api/health/opencode\").then(r =\u003e r.json()),\n  refetchInterval: 30000, // Every 30 seconds\n})\n\nif (health?.status !== \"healthy\") {\n  // Show error banner\n}\n```\n\n## Files to Create\n\n- `src/app/api/health/opencode/route.ts`\n\n## Dependencies\n\n- OpenCodeService.isHealthy() method (uses client.global.health())\n\n## Acceptance Criteria\n\n- [ ] Returns 200 with status: \"healthy\" when OpenCode is running\n- [ ] Returns 503 with status: \"unhealthy\" when OpenCode is down\n- [ ] Includes error message for debugging\n- [ ] Uses SDK's built-in health check (not custom implementation)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T10:35:20.199271-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Health check endpoint created at /api/health/opencode with 200/503 status handling","dependencies":[{"issue_id":"maestro-fyp.1.5","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:35:20.201679-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.1.5","depends_on_id":"maestro-fyp.1.2","type":"blocks","created_at":"2025-12-30T10:39:14.427245-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.2","title":"Phase 2: Chat Integration","description":"## Phase 2: Chat Integration\n\nThis phase connects the existing Issue View UI to the OpenCode backend, replacing mock responses with real AI conversations.\n\n### Why This Phase Second?\n\nWith infrastructure in place (Phase 1), we can now wire up the actual chat experience. This is the core user value - being able to discuss GitHub issues with an AI that understands the codebase.\n\n### Key Behaviors\n\n**Context Injection (handled in Phase 1)**\nWhen a session is created (task 1.4), we inject the full GitHub issue context. This is part of session creation, not a separate step.\n\n**Read-Only Mode**\nThe agent MUST NOT modify files during issue discussion. We enforce this by disabling tools:\n```typescript\ntools: {\n  bash: false,\n  write: false,\n  edit: false\n}\n```\n\nThe agent can still read files, search, and explore - just not change anything.\n\n**SSE Streaming (using promptAsync)**\nReal-time response streaming is critical for UX:\n- User sees text appear as it's generated\n- Use `promptAsync()` to start the prompt\n- Subscribe to `event.subscribe()` for streaming updates\n- Listen for `message.part.updated` events with `delta` property\n\n### Session Lifecycle\n\n1. User opens issue → Check for existing session (via API)\n2. If session exists and alive → Resume it\n3. If no session or dead → Create new (context injection happens automatically)\n4. User sends message → Stream response via SSE\n5. Session dies mid-conversation → Auto-recreate, show toast\n\n### UI Updates\n\nThe existing Issue View page (`src/app/project/[id]/issue/[issueNumber]/page.tsx`) has:\n- Split panel layout (desktop)\n- Tabbed interface (mobile)\n- Mock chat with setTimeout\n\nWe need to:\n- Replace mock with real OpenCode integration\n- Add streaming text display\n- Add typing indicator\n- Handle reconnection gracefully\n\n### Task Changes Note\n\nTask 2.2 (Implement context injection) was **merged into task 1.4** since context injection is inherently part of session creation. This phase now has 3 tasks instead of 4.\n\n### Dependencies\n\n- Phase 1 complete (OpenCodeService, SessionStorage, APIs)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:33:34.463131-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"All Phase 2 subtasks completed: Issue View connected, SSE streaming, session reconnection","dependencies":[{"issue_id":"maestro-fyp.2","depends_on_id":"maestro-fyp","type":"parent-child","created_at":"2025-12-30T10:33:34.463652-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2","depends_on_id":"maestro-fyp.1","type":"blocks","created_at":"2025-12-30T10:39:15.586636-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.2.1","title":"Connect Issue View to OpenCode SDK","description":"## Task\n\nReplace the mock setTimeout-based chat in the Issue View page with real OpenCode SDK calls.\n\n## Why\n\nCurrently the Issue View page at `src/app/project/[id]/issue/[issueNumber]/page.tsx` uses mock responses. This task connects it to the real OpenCode backend.\n\n## Current Implementation\n\n```typescript\n// Current mock pattern (to be replaced)\nconst handleSendMessage = async (content: string) =\u003e {\n  // Add user message\n  setMessages(prev =\u003e [...prev, { role: \"user\", content }])\n  \n  // Mock AI response with setTimeout\n  setTimeout(() =\u003e {\n    setMessages(prev =\u003e [...prev, { \n      role: \"assistant\", \n      content: \"This is a mock response...\" \n    }])\n  }, 1500)\n}\n```\n\n## New Implementation\n\n```typescript\nconst handleSendMessage = async (content: string) =\u003e {\n  // Add user message\n  setMessages(prev =\u003e [...prev, { role: \"user\", content }])\n  setIsLoading(true)\n  \n  try {\n    // Get or create session\n    let sessionId = await getSessionId()\n    if (!sessionId) {\n      sessionId = await createSession()\n    }\n    \n    // Send message in read-only mode\n    const response = await fetch(`/api/projects/${projectId}/issues/${issueNumber}/chat`, {\n      method: \"POST\",\n      body: JSON.stringify({ message: content, sessionId })\n    })\n    \n    // Handle streaming response (see SSE task)\n  } catch (error) {\n    // Handle error (see error handling phase)\n  } finally {\n    setIsLoading(false)\n  }\n}\n```\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Phase 1 complete (session APIs exist)\n\n## Acceptance Criteria\n\n- [ ] Chat sends real messages to OpenCode\n- [ ] Responses display correctly\n- [ ] Loading state shown while waiting\n- [ ] Input disabled during response\n- [ ] Session created automatically on first message","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:35:47.836573-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Issue View connected to OpenCode SDK with session creation, real chat, streaming responses","dependencies":[{"issue_id":"maestro-fyp.2.1","depends_on_id":"maestro-fyp.2","type":"parent-child","created_at":"2025-12-30T10:35:47.837216-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.1","depends_on_id":"maestro-fyp.1.4","type":"blocks","created_at":"2025-12-30T10:39:18.393914-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.2.2","title":"Implement context injection on session start","description":"## Task\n\nWhen a new session is created, inject the full GitHub issue context so the AI understands what is being discussed.\n\n## Why\n\nWithout context injection, the AI would have no idea what issue the user is discussing. By injecting title, body, comments, and instructions upfront, every message benefits from this context.\n\n## How Context Injection Works\n\nOpenCode SDK supports `synthetic: true` messages that appear in the context but were not typed by the user:\n\n```typescript\nawait client.session.prompt({\n  path: { id: sessionId },\n  body: {\n    noReply: true,      // Do not generate AI response\n    parts: [{\n      type: \"text\",\n      text: buildIssueContext(issue),\n      synthetic: true   // Mark as system-injected, not user message\n    }]\n  }\n})\n```\n\n## Context Format\n\n```markdown\n## GitHub Issue #42\n\n**Title:** Add user authentication flow\n**State:** open\n**Author:** @erikjohansson\n**Labels:** feature, authentication\n**Created:** 12/30/2024\n\n### Description\nWe need to implement OAuth2 authentication using Google and GitHub providers.\n\n### Comments\n**@alice** (12/29/2024):\nShould we also support email/password login?\n\n**@bob** (12/30/2024):\nI think OAuth only is fine for MVP.\n\n---\nYou are helping discuss this GitHub issue. You can read the codebase to answer questions and suggest approaches, but you cannot modify any files. Focus on exploration and understanding.\n```\n\n## Key Points\n\n1. **noReply: true** - We do not want AI to respond to context injection\n2. **synthetic: true** - Marks this as system context, not user message\n3. **Read-only instructions** - Clearly state the agent cannot modify files\n4. **Full context** - Include all comments so AI has complete picture\n\n## Files to Modify\n\n- `src/app/api/projects/[id]/issues/[issueNumber]/session/route.ts` (POST handler)\n\n## Dependencies\n\n- Session creation API exists (Phase 1)\n\n## Acceptance Criteria\n\n- [ ] Context injected uses noReply: true\n- [ ] Context injected uses synthetic: true\n- [ ] All issue metadata included (title, state, author, labels, created)\n- [ ] Full body text included\n- [ ] All comments included with authors and dates\n- [ ] Read-only instructions included\n- [ ] No AI response generated from injection","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:36:03.538445-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Merged into task 1.4 (Create session management API endpoints). Context injection is inherently part of session creation, not a separate task.","dependencies":[{"issue_id":"maestro-fyp.2.2","depends_on_id":"maestro-fyp.2","type":"parent-child","created_at":"2025-12-30T10:36:03.542055-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.2","depends_on_id":"maestro-fyp.1.4","type":"blocks","created_at":"2025-12-30T10:39:18.427815-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.2.3","title":"Add SSE streaming for responses","description":"## Task\n\nImplement Server-Sent Events (SSE) streaming so AI responses appear progressively as they are generated.\n\n## Why\n\nWithout streaming:\n- User stares at spinner for 10+ seconds\n- No feedback on response length\n- Feels unresponsive\n\nWith streaming:\n- Text appears word-by-word\n- User can start reading immediately\n- Feels interactive and fast\n\n## OpenCode Streaming Pattern\n\n**IMPORTANT**: For streaming, you must use the async/event pattern:\n1. Call `session.promptAsync()` to start the prompt (returns immediately)\n2. Subscribe to `event.subscribe()` to get streaming updates\n3. Listen for `message.part.updated` events with `delta` property\n\n```typescript\n// Start the prompt (non-blocking)\nawait client.session.promptAsync({\n  path: { id: sessionId },\n  query: { directory: projectPath },\n  body: {\n    tools: { bash: false, write: false, edit: false },\n    parts: [{ type: \"text\", text: userMessage }]\n  }\n})\n\n// Subscribe to events for streaming\nconst events = await client.event.subscribe({\n  query: { directory: projectPath }\n})\n\nfor await (const event of events.stream) {\n  switch (event.type) {\n    case \"session.status\":\n      // { status: \"busy\" | \"idle\" }\n      if (event.properties.status === \"idle\") {\n        // Response complete\n        break\n      }\n      break\n    case \"message.part.updated\":\n      // { part: Part, delta?: string }\n      if (event.properties.delta) {\n        // Stream the delta text\n        controller.enqueue(event.properties.delta)\n      }\n      break\n    case \"session.error\":\n      // { error: ... }\n      // Handle error\n      break\n  }\n}\n```\n\n## Create Chat API Endpoint\n\n```typescript\n// src/app/api/projects/[id]/issues/[issueNumber]/chat/route.ts\n\nimport { openCodeService } from \"@/lib/services/opencode\"\nimport { configService } from \"@/lib/services/config\"\nimport { NextResponse } from \"next/server\"\n\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise\u003c{ id: string; issueNumber: string }\u003e }\n) {\n  const { id } = await params\n  const { message, sessionId } = await request.json()\n\n  const project = await configService.getProject(id)\n  if (!project) {\n    return NextResponse.json({ error: \"Project not found\" }, { status: 404 })\n  }\n\n  // Create SSE stream\n  const stream = new ReadableStream({\n    async start(controller) {\n      try {\n        // Start async prompt (returns immediately)\n        await openCodeService.sendReadOnlyMessageAsync(project.path, sessionId, message)\n        \n        // Subscribe to events\n        const events = await openCodeService.subscribeToEvents(project.path)\n        \n        for await (const event of events) {\n          if (event.type === \"message.part.updated\" \u0026\u0026 event.properties.delta) {\n            const data = `data: ${JSON.stringify({ delta: event.properties.delta })}\\n\\n`\n            controller.enqueue(new TextEncoder().encode(data))\n          }\n          if (event.type === \"session.status\" \u0026\u0026 event.properties.status === \"idle\") {\n            controller.enqueue(new TextEncoder().encode(\"data: [DONE]\\n\\n\"))\n            controller.close()\n            break\n          }\n          if (event.type === \"session.error\") {\n            const data = `data: ${JSON.stringify({ error: event.properties.error })}\\n\\n`\n            controller.enqueue(new TextEncoder().encode(data))\n            controller.close()\n            break\n          }\n        }\n      } catch (error) {\n        controller.error(error)\n      }\n    }\n  })\n\n  return new Response(stream, {\n    headers: {\n      \"Content-Type\": \"text/event-stream\",\n      \"Cache-Control\": \"no-cache\",\n      \"Connection\": \"keep-alive\"\n    }\n  })\n}\n```\n\n## Frontend Consumption\n\n```typescript\nconst sendMessage = async (content: string) =\u003e {\n  setIsStreaming(true)\n  setCurrentResponse(\"\")\n  \n  const response = await fetch(`/api/projects/${projectId}/issues/${issueNumber}/chat`, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ message: content, sessionId })\n  })\n\n  const reader = response.body!.getReader()\n  const decoder = new TextDecoder()\n\n  while (true) {\n    const { done, value } = await reader.read()\n    if (done) break\n    \n    const text = decoder.decode(value)\n    const lines = text.split(\"\\n\\n\")\n    \n    for (const line of lines) {\n      if (line.startsWith(\"data: \")) {\n        const data = line.slice(6)\n        if (data === \"[DONE]\") {\n          // Complete\n        } else {\n          const { delta, error } = JSON.parse(data)\n          if (delta) {\n            setCurrentResponse(prev =\u003e prev + delta)\n          }\n          if (error) {\n            // Handle error\n          }\n        }\n      }\n    }\n  }\n  \n  setIsStreaming(false)\n}\n```\n\n## Files to Create/Modify\n\n- `src/app/api/projects/[id]/issues/[issueNumber]/chat/route.ts` (new)\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx` (consume stream)\n\n## Key Design Points\n\n1. **Use promptAsync, not prompt** - For streaming, use the async variant\n2. **Subscribe to events** - Get real-time updates via SSE\n3. **Pass projectPath** - Required for OpenCode to know the context\n4. **[DONE] sentinel** - Signal completion to frontend\n5. **Filter for correct session** - Events stream includes all sessions; filter if needed\n\n## Dependencies\n\n- OpenCodeService with subscribeToEvents() and sendReadOnlyMessageAsync() methods (task 1.2)\n\n## Acceptance Criteria\n\n- [ ] Chat API endpoint returns SSE stream\n- [ ] Uses promptAsync for non-blocking prompt\n- [ ] Subscribes to OpenCode events for streaming\n- [ ] Frontend consumes stream correctly\n- [ ] Text appears incrementally as generated\n- [ ] Stream closes when response complete\n- [ ] Error events handled gracefully","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:36:18.457188-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"SSE streaming chat API created with event subscription, delta streaming, proper close/error handling","dependencies":[{"issue_id":"maestro-fyp.2.3","depends_on_id":"maestro-fyp.2","type":"parent-child","created_at":"2025-12-30T10:36:18.459443-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.3","depends_on_id":"maestro-fyp.1.2","type":"blocks","created_at":"2025-12-30T10:39:18.461563-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.2.4","title":"Handle session reconnection","description":"## Task\n\nGracefully handle scenarios where an OpenCode session dies mid-conversation and needs to be recreated.\n\n## Why\n\nSessions can die for various reasons:\n- OpenCode server restart\n- Network interruption\n- Session timeout (if implemented)\n- Server crash\n\nUsers should not lose their conversation context or have to manually intervene.\n\n## Reconnection Flow\n\n1. User sends message\n2. Request fails with session error\n3. Detect session is dead\n4. Remove stale mapping from sessionStorage\n5. Create new session with context injection\n6. Retry the failed message\n7. Show brief toast: \"Reconnecting...\"\n\n## Implementation\n\n```typescript\nconst sendMessage = async (content: string) =\u003e {\n  try {\n    await sendToSession(sessionId, content)\n  } catch (error) {\n    if (isSessionDead(error)) {\n      // Show reconnecting toast\n      toast(\"Reconnecting to AI...\", { duration: 2000 })\n      \n      // Remove dead session\n      await fetch(`/api/.../session`, { method: \"DELETE\" })\n      \n      // Create new session (auto-injects context)\n      const { sessionId: newId } = await fetch(`/api/.../session`, {\n        method: \"POST\"\n      }).then(r =\u003e r.json())\n      \n      // Update local state\n      setSessionId(newId)\n      \n      // Retry message\n      await sendToSession(newId, content)\n    } else {\n      throw error // Other errors bubble up\n    }\n  }\n}\n\nfunction isSessionDead(error: unknown): boolean {\n  // Check for specific error codes/messages from OpenCode\n  // that indicate session no longer exists\n  return error.message?.includes(\"session not found\") ||\n         error.status === 404\n}\n```\n\n## UX Considerations\n\n1. **Transparent to user** - They should barely notice reconnection\n2. **Brief interruption** - Show toast, not blocking modal\n3. **No context loss** - New session gets full issue context\n4. **Retry automatic** - Do not make user resend message\n\n## Limitation\n\nThe new session will not have prior chat history (only the issue context). This is by design - chat history is ephemeral, summaries should be saved to GitHub if important.\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n- Possibly add DELETE handler to session route\n\n## Dependencies\n\n- Session creation with context injection (previous task)\n\n## Acceptance Criteria\n\n- [ ] Dead session detected automatically\n- [ ] New session created with context\n- [ ] Failed message retried on new session\n- [ ] User sees brief \"Reconnecting...\" toast\n- [ ] No user intervention required\n- [ ] Works for network interruptions too","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T10:36:33.657835-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Session reconnection implemented with auto-retry, toast notification, and infinite loop prevention","dependencies":[{"issue_id":"maestro-fyp.2.4","depends_on_id":"maestro-fyp.2","type":"parent-child","created_at":"2025-12-30T10:36:33.659782-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.4","depends_on_id":"maestro-fyp.2.1","type":"blocks","created_at":"2025-12-30T10:39:18.494352-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.4","depends_on_id":"maestro-fyp.2.3","type":"blocks","created_at":"2025-12-30T10:39:18.526762-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.3","title":"Phase 3: GitHub Integration","description":"## Phase 3: GitHub Integration\n\nThis phase completes the bidirectional GitHub integration, allowing conversation context to flow back into the issue as persistent comments.\n\n### Why This Phase Third?\n\nWith chat working (Phase 2), users can have productive discussions. But those discussions are ephemeral - if the session dies, the conversation is lost. By enabling summary persistence to GitHub, we create lasting value from each discussion.\n\n### Design Philosophy\n\n**On-Demand, Not Automatic**\nWe explicitly chose NOT to auto-save conversations because:\n- Not every conversation is worth persisting\n- Users should curate what goes into the issue\n- Avoids cluttering issues with noise\n- Keeps user in control\n\n**Summary Generation**\nInstead of dumping raw chat logs, we ask the AI to summarize:\n- Key decisions made\n- Open questions identified\n- Suggested next steps\n- Relevant code references\n\nThis creates higher-quality GitHub comments that future readers can understand.\n\n### User Flow\n\n1. User clicks \"Save Summary\" button in chat footer\n2. Modal opens with auto-generated summary\n3. User can edit/refine the summary\n4. Preview shows how it will appear as GitHub comment\n5. User clicks \"Post to Issue\" → Comment added via `gh issue comment`\n6. Success toast, modal closes\n\n### Comment Format\n\n```markdown\n## Discussion Summary\n\n[Agent-generated summary, user-edited]\n\n---\n*Generated from Maestro discussion on [date]*\n```\n\nThe footer provides attribution and context for why this comment exists.\n\n### Comments Display\n\nThe existing API already fetches comments (`GET /api/projects/[id]/issues/[issueNumber]`), but the UI doesn't render them. This phase adds:\n- Comments thread in Issue Details panel\n- Author avatars/names\n- Timestamps\n- Markdown rendering\n\n### Dependencies\n\n- Phase 2 complete (working chat)\n- Existing issue detail API (already fetches comments)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T10:33:34.51701-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"All Phase 3 subtasks completed: comments display, comment posting API, save summary modal","dependencies":[{"issue_id":"maestro-fyp.3","depends_on_id":"maestro-fyp","type":"parent-child","created_at":"2025-12-30T10:33:34.5175-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.3","depends_on_id":"maestro-fyp.2","type":"blocks","created_at":"2025-12-30T10:39:24.1577-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.3.1","title":"Display comments in Issue Details panel","description":"## Task\n\nRender GitHub issue comments in the Issue Details panel (left side of split view).\n\n## Why\n\nThe existing API (`GET /api/projects/[id]/issues/[issueNumber]`) already fetches comments, but the UI does not render them. Comments provide important context:\n- Previous discussions\n- Decisions made\n- Questions raised\n\nUsers need to see this alongside the chat to have full context.\n\n## PARALLELIZATION NOTE\n\n**This task has NO blocking dependencies.** It is pure UI work using data the API already returns. It can be worked on in parallel with Phase 1 and Phase 2 tasks.\n\n## Current State\n\nThe API response already includes:\n```typescript\n{\n  number: 42,\n  title: \"...\",\n  body: \"...\",\n  state: \"open\",\n  comments: [\n    {\n      author: { login: \"alice\" },\n      body: \"Should we support email/password?\",\n      createdAt: \"2024-12-29T...\"\n    }\n  ]\n}\n```\n\nBut the UI only renders title, state, and body.\n\n## Implementation\n\n```tsx\n// In Issue Details panel\n{issue.comments \u0026\u0026 issue.comments.length \u003e 0 \u0026\u0026 (\n  \u003cdiv className=\"mt-6\"\u003e\n    \u003ch3 className=\"text-sm font-medium text-muted-foreground mb-3\"\u003e\n      Comments ({issue.comments.length})\n    \u003c/h3\u003e\n    \u003cdiv className=\"space-y-4\"\u003e\n      {issue.comments.map((comment, i) =\u003e (\n        \u003cdiv key={i} className=\"border-l-2 border-muted pl-4\"\u003e\n          \u003cdiv className=\"flex items-center gap-2 text-sm text-muted-foreground\"\u003e\n            \u003cspan className=\"font-medium\"\u003e@{comment.author.login}\u003c/span\u003e\n            \u003cspan\u003e•\u003c/span\u003e\n            \u003cspan\u003e{formatDate(comment.createdAt)}\u003c/span\u003e\n          \u003c/div\u003e\n          \u003cdiv className=\"mt-1 text-sm whitespace-pre-wrap\"\u003e\n            {comment.body}\n          \u003c/div\u003e\n        \u003c/div\u003e\n      ))}\n    \u003c/div\u003e\n  \u003c/div\u003e\n)}\n```\n\n## Update GitHubIssue Interface\n\nThe page's interface needs to include comments:\n```typescript\ninterface GitHubIssue {\n  // ... existing fields\n  comments?: {\n    author: { login: string }\n    body: string\n    createdAt: string\n  }[]\n}\n```\n\n## Markdown Rendering\n\nFor MVP, plain text with whitespace preservation is acceptable. Consider adding `react-markdown` later for proper rendering. The comment body might contain:\n- Code blocks\n- Links\n- Lists\n- Bold/italic\n\n## Empty State\n\nIf no comments, either:\n- Hide the Comments section entirely (cleaner), OR\n- Show subtle \"No comments yet.\" message\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n**NONE** - This is pure UI work. The API already returns comments.\n\n## Acceptance Criteria\n\n- [ ] Comments section appears in Issue Details panel\n- [ ] Each comment shows author name\n- [ ] Each comment shows creation date (formatted)\n- [ ] Comment body is displayed with whitespace preserved\n- [ ] Comments count shown in header\n- [ ] Empty state handled gracefully (hide section or show message)\n- [ ] Scrollable if many comments (inherits from panel scroll)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T10:36:51.418663-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Comments section added to Issue Details panel with author, date formatting, and empty state handling","deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.3.2","title":"Add comment posting API endpoint","description":"## Task\n\nCreate `POST /api/projects/[id]/issues/[issueNumber]/comment` - An endpoint to add comments to GitHub issues.\n\n## Why\n\nThe \"Save Summary\" feature needs a way to post conversation summaries as GitHub comments. This endpoint provides that capability.\n\n## Implementation\n\n```typescript\n// src/app/api/projects/[id]/issues/[issueNumber]/comment/route.ts\n\nimport { exec } from \"child_process\"\nimport { promisify } from \"util\"\nimport { configService } from \"@/lib/services/config\"\nimport { NextResponse } from \"next/server\"\n\nconst execAsync = promisify(exec)\n\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise\u003c{ id: string; issueNumber: string }\u003e }\n) {\n  const { id, issueNumber } = await params\n  const { body } = await request.json()\n\n  if (!body || typeof body !== \"string\") {\n    return NextResponse.json(\n      { error: \"Comment body is required\" },\n      { status: 400 }\n    )\n  }\n\n  const project = await configService.getProject(id)\n  if (!project) {\n    return NextResponse.json(\n      { error: \"Project not found\" },\n      { status: 404 }\n    )\n  }\n\n  try {\n    // Use gh CLI to add comment\n    // Escape the body for shell safety\n    const escapedBody = body.replace(/\"/g, \"\\\\\\\"\")\n    \n    await execAsync(\n      `gh issue comment ${issueNumber} --body \"${escapedBody}\"`,\n      { cwd: project.path }\n    )\n\n    return NextResponse.json({ success: true }, { status: 201 })\n  } catch (error) {\n    console.error(\"Failed to post comment:\", error)\n    return NextResponse.json(\n      { error: \"Failed to post comment to GitHub\" },\n      { status: 500 }\n    )\n  }\n}\n```\n\n## Shell Escaping Consideration\n\nThe comment body might contain:\n- Quotes\n- Backticks  \n- Newlines\n- Special characters\n\nA safer approach might use stdin:\n```bash\necho \"$body\" | gh issue comment 42 --body-file -\n```\n\nOr write to temp file first.\n\n## Request/Response\n\n```typescript\n// Request\nPOST /api/projects/abc123/issues/42/comment\n{ \"body\": \"## Summary\\n\\nThis is the discussion summary...\" }\n\n// Success (201)\n{ \"success\": true }\n\n// Error (400)\n{ \"error\": \"Comment body is required\" }\n\n// Error (500)\n{ \"error\": \"Failed to post comment to GitHub\" }\n```\n\n## Files to Create\n\n- `src/app/api/projects/[id]/issues/[issueNumber]/comment/route.ts`\n\n## Dependencies\n\n- Project config service (exists)\n- gh CLI authenticated (prerequisite)\n\n## Acceptance Criteria\n\n- [ ] POST creates comment on GitHub issue\n- [ ] Handles multiline body correctly\n- [ ] Handles special characters safely\n- [ ] Returns 201 on success\n- [ ] Returns 400 if body missing\n- [ ] Returns 404 if project not found\n- [ ] Returns 500 on gh CLI error","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T10:37:05.505163-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Comment posting API created with stdin approach for safe shell handling","dependencies":[{"issue_id":"maestro-fyp.3.2","depends_on_id":"maestro-fyp.3","type":"parent-child","created_at":"2025-12-30T10:37:05.507115-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.3.2","depends_on_id":"maestro-fyp.2.1","type":"blocks","created_at":"2025-12-30T10:39:24.188788-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.3.3","title":"Implement Save Summary modal","description":"## Task\n\nCreate a modal dialog that generates a conversation summary and allows the user to edit and post it to the GitHub issue.\n\n## Why\n\nConversations are ephemeral - when the session ends, they are gone. By saving summaries to GitHub:\n- Key decisions are preserved\n- Future sessions have context\n- Other team members can see discussions\n- Issues become richer documentation\n\n## User Flow\n\n1. User clicks \"Save Summary\" button in chat footer\n2. Modal opens, shows \"Generating summary...\" spinner\n3. AI generates summary of conversation (sync call, waits for response)\n4. Summary displayed in editable textarea\n5. Preview shows how it appears as GitHub comment\n6. User can edit the summary\n7. User clicks \"Post to Issue\"\n8. Comment posted via API\n9. Success toast, modal closes\n10. Comments list refreshes (optional)\n\n## Summary Generation\n\nUse a **synchronous** prompt (not async/streaming) to generate the summary:\n\n```typescript\n// In the modal component\nconst generateSummary = async () =\u003e {\n  setIsGenerating(true)\n  try {\n    const response = await fetch(`/api/projects/${projectId}/issues/${issueNumber}/summary`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ sessionId })\n    })\n    const { summary } = await response.json()\n    setSummaryText(summary)\n  } finally {\n    setIsGenerating(false)\n  }\n}\n```\n\n## Summary API Endpoint\n\nCreate a new endpoint for summary generation:\n\n```typescript\n// src/app/api/projects/[id]/issues/[issueNumber]/summary/route.ts\n\nexport async function POST(request: Request, { params }) {\n  const { id } = await params\n  const { sessionId } = await request.json()\n  \n  const project = await configService.getProject(id)\n  if (!project) {\n    return NextResponse.json({ error: \"Project not found\" }, { status: 404 })\n  }\n  \n  const summary = await openCodeService.generateSummary(project.path, sessionId)\n  \n  return NextResponse.json({ summary })\n}\n```\n\n## UI Design\n\n```\n┌────────────────────────────────────────────────────────┐\n│ Save Discussion Summary                           [X]  │\n├────────────────────────────────────────────────────────┤\n│                                                        │\n│  The AI has summarized your discussion:                │\n│                                                        │\n│  ┌──────────────────────────────────────────────────┐  │\n│  │ ## Summary                                       │  │\n│  │                                                  │  │\n│  │ We discussed implementing OAuth2 authentication │  │\n│  │ using Google and GitHub providers. Key decision:│  │\n│  │ - Start with Google OAuth only for MVP          │  │\n│  │ - Add GitHub OAuth in v2                        │  │\n│  │                                                  │  │\n│  └──────────────────────────────────────────────────┘  │\n│  (editable textarea)                                   │\n│                                                        │\n├────────────────────────────────────────────────────────┤\n│                        [Cancel]  [Post to Issue]       │\n└────────────────────────────────────────────────────────┘\n```\n\n## Comment Format\n\nWhen posting to GitHub:\n```markdown\n## Discussion Summary\n\n[User-edited summary text]\n\n---\n*Generated from Maestro discussion on [date]*\n```\n\n## Component Structure\n\n```typescript\n// src/components/save-summary-modal/SaveSummaryModal.tsx\n\ninterface SaveSummaryModalProps {\n  open: boolean\n  onOpenChange: (open: boolean) =\u003e void\n  projectId: string\n  issueNumber: number\n  sessionId: string\n  onSuccess?: () =\u003e void\n}\n\nexport function SaveSummaryModal({ ... }: SaveSummaryModalProps) {\n  const [summary, setSummary] = useState(\"\")\n  const [isGenerating, setIsGenerating] = useState(true)\n  const [isPosting, setIsPosting] = useState(false)\n\n  // Generate summary on open\n  useEffect(() =\u003e {\n    if (open) {\n      generateSummary()\n    }\n  }, [open])\n\n  const generateSummary = async () =\u003e { ... }\n  const handlePost = async () =\u003e { ... }\n\n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent\u003e\n        {/* ... */}\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  )\n}\n```\n\n## Files to Create\n\n- `src/components/save-summary-modal/SaveSummaryModal.tsx`\n- `src/components/save-summary-modal/index.ts`\n- `src/app/api/projects/[id]/issues/[issueNumber]/summary/route.ts`\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx` (add button + modal)\n\n## Dependencies\n\n- OpenCodeService.generateSummary() method (task 1.2)\n- Comment posting API (task 3.2)\n\n## Acceptance Criteria\n\n- [ ] Modal opens from \"Save Summary\" button\n- [ ] Summary auto-generated on open\n- [ ] Loading state while generating\n- [ ] Summary editable in textarea\n- [ ] Cancel closes without posting\n- [ ] Post creates GitHub comment with footer\n- [ ] Success toast shown\n- [ ] Modal closes on success\n- [ ] Error handling for generation/posting failures","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T10:37:30.225662-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Save Summary modal implemented with summary generation, editable textarea, GitHub posting, and error handling","dependencies":[{"issue_id":"maestro-fyp.3.3","depends_on_id":"maestro-fyp.3","type":"parent-child","created_at":"2025-12-30T10:37:30.228062-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.3.3","depends_on_id":"maestro-fyp.3.2","type":"blocks","created_at":"2025-12-30T10:39:24.222617-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.3.3","depends_on_id":"maestro-fyp.1.2","type":"blocks","created_at":"2025-12-30T10:50:52.759743-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.4","title":"Phase 4: Polish \u0026 Error Handling","description":"## Phase 4: Polish \u0026 Error Handling\n\nThis phase adds robustness, better UX, and handles edge cases that make the difference between a prototype and a production-quality feature.\n\n### Why This Phase Last?\n\nCore functionality must work first (Phases 1-3). Polish is important but not blocking. Users can use a working feature with rough edges; they can't use a polished feature that doesn't work.\n\n### Error Handling Strategy\n\n**Hierarchy of Errors**\n```\n┌─────────────────────────────────────────────┐\n│ [Global Banner - server connectivity]       │  ← Persistent until resolved\n├─────────────────────────────────────────────┤\n│   Issue Details        │  Chat Area         │\n│   [Inline error if     │  [Inline error if  │  ← Contextual errors\n│    issue fetch fails]  │   session fails]   │\n│                        │  [Toast for        │  ← Transient notifications\n│                        │   minor issues]    │\n└─────────────────────────────────────────────┘\n```\n\n**Specific Error Scenarios**\n| Scenario | UI Behavior |\n|----------|-------------|\n| OpenCode unreachable | Banner: \"Cannot connect to OpenCode server\" + Retry |\n| GitHub API failure | Inline error + Retry button |\n| Rate limit | Banner with reset time |\n| Session dies | Auto-recreate with \"Reconnecting...\" toast |\n| Message send fails | Keep message in input, show error, enable retry |\n| Issue not found | 404 page with link back |\n\n### UX Polish\n\n**Panel Resizing**\nCurrently hardcoded at 400px. Should be draggable with:\n- Mouse drag handle\n- Min/max constraints (200px - 50% of viewport)\n- Persist preference to localStorage\n\n**Mobile Unread Indicator**\nWhen on Details tab and agent responds:\n- Show badge on Chat tab\n- Clear badge when user switches to Chat tab\n\n**Loading States**\n- Skeleton loader for issue details\n- \"Starting conversation...\" spinner\n- Typing indicator (pulsing dots)\n- Streaming text (progressive reveal)\n- \"Creating...\" states for buttons\n\n**Empty States**\n- No description: italic \"No description provided.\"\n- No comments: section hidden or subtle message\n- No chat: \"Ask the agent about this issue to start exploring.\"\n\n### Dependencies\n\n- Phases 1-3 complete (all core functionality working)\n- Can be worked on incrementally after MVP launch","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T10:33:34.56895-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"All Phase 4 subtasks completed: error banner, panel resizing, mobile indicator, loading states, contextual errors","dependencies":[{"issue_id":"maestro-fyp.4","depends_on_id":"maestro-fyp","type":"parent-child","created_at":"2025-12-30T10:33:34.569389-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4","depends_on_id":"maestro-fyp.3","type":"blocks","created_at":"2025-12-30T10:39:26.262701-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.4.1","title":"Create global error banner component","description":"## Task\n\nCreate an ErrorBanner component that displays persistent connectivity errors at the top of the application.\n\n## Why\n\nWhen critical services are unavailable (OpenCode server, GitHub), users need clear, persistent feedback - not just momentary toasts that disappear. The banner:\n- Stays visible until issue resolved\n- Provides actionable guidance\n- Does not block UI interaction\n\n## Design\n\n```\n┌─────────────────────────────────────────────────────────────────────┐\n│ ⚠ Cannot connect to OpenCode server. Run `opencode serve` [Retry]  │\n└─────────────────────────────────────────────────────────────────────┘\n│                                                                     │\n│  (rest of application)                                              │\n```\n\n## Error Types\n\n| Error | Message | Action |\n|-------|---------|--------|\n| OpenCode down | \"Cannot connect to OpenCode server. Make sure `opencode serve` is running.\" | Retry button |\n| GitHub rate limit | \"GitHub rate limit exceeded. Resets at 3:45 PM.\" | Shows countdown |\n| gh not authenticated | \"GitHub CLI not authenticated. Run `gh auth login` in terminal.\" | No retry (user action needed) |\n\n## Implementation\n\n```typescript\n// src/components/error-banner/ErrorBanner.tsx\n\ninterface ErrorBannerProps {\n  type: \"opencode\" | \"github-rate-limit\" | \"github-auth\"\n  message: string\n  onRetry?: () =\u003e void\n  retryLabel?: string\n  rateLimitReset?: Date  // For rate limit errors\n}\n\nexport function ErrorBanner({ type, message, onRetry, rateLimitReset }: ErrorBannerProps) {\n  return (\n    \u003cdiv className=\"bg-destructive/10 border-b border-destructive/20 px-4 py-2 text-sm\"\u003e\n      \u003cdiv className=\"flex items-center justify-between max-w-screen-xl mx-auto\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cAlertTriangle className=\"h-4 w-4 text-destructive\" /\u003e\n          \u003cspan className=\"text-destructive\"\u003e{message}\u003c/span\u003e\n          {rateLimitReset \u0026\u0026 (\n            \u003cspan className=\"text-muted-foreground\"\u003e\n              Resets in {formatTimeUntil(rateLimitReset)}\n            \u003c/span\u003e\n          )}\n        \u003c/div\u003e\n        {onRetry \u0026\u0026 (\n          \u003cButton variant=\"ghost\" size=\"sm\" onClick={onRetry}\u003e\n            {retryLabel || \"Retry\"}\n          \u003c/Button\u003e\n        )}\n      \u003c/div\u003e\n    \u003c/div\u003e\n  )\n}\n```\n\n## Context Provider\n\nFor global error state:\n\n```typescript\n// src/lib/contexts/error-context.tsx\n\ninterface ErrorState {\n  opencodeError: string | null\n  githubError: string | null\n  rateLimitReset: Date | null\n}\n\nexport const ErrorContext = createContext\u003c{\n  errors: ErrorState\n  setOpenCodeError: (error: string | null) =\u003e void\n  setGitHubError: (error: string | null) =\u003e void\n  checkOpenCodeHealth: () =\u003e Promise\u003cvoid\u003e\n}\u003e()\n```\n\n## Integration Points\n\n- Check OpenCode health on app load\n- Check GitHub auth on first API call\n- Parse rate limit headers from GitHub responses\n- Clear errors when connectivity restored\n\n## Files to Create\n\n- `src/components/error-banner/ErrorBanner.tsx`\n- `src/components/error-banner/index.ts`\n- `src/lib/contexts/error-context.tsx` (or add to providers.tsx)\n\n## Files to Modify\n\n- `src/app/layout.tsx` or providers - Add error banner at top\n- API routes - Return rate limit info in headers\n\n## Dependencies\n\n- Health check API (Phase 1)\n\n## Acceptance Criteria\n\n- [ ] Banner appears when OpenCode unreachable\n- [ ] Banner appears for GitHub rate limit\n- [ ] Banner appears for gh auth errors\n- [ ] Retry button triggers health check\n- [ ] Banner dismisses when error resolved\n- [ ] Does not block page interaction\n- [ ] Rate limit shows countdown\n- [ ] Consistent styling with app theme","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T10:37:54.707057-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Global error banner created with ErrorProvider context, health check on mount, retry and dismiss functionality","dependencies":[{"issue_id":"maestro-fyp.4.1","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:37:54.709051-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4.1","depends_on_id":"maestro-fyp.1.5","type":"blocks","created_at":"2025-12-30T10:39:26.299505-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.4.2","title":"Add panel resizing for Issue View","description":"## Task\n\nMake the Issue Details panel width adjustable via drag handle, replacing the current fixed 400px width.\n\n## Why\n\nDifferent users have different preferences:\n- Some want more space for long issue descriptions\n- Some prefer larger chat area\n- Content width varies per issue\n\nA fixed width forces everyone into the same experience.\n\n## Current Implementation\n\n```tsx\n// Current fixed width\n\u003cdiv className=\"w-[400px] border-r\"\u003e\n  {/* Issue Details */}\n\u003c/div\u003e\n\u003cdiv className=\"flex-1\"\u003e\n  {/* Chat */}\n\u003c/div\u003e\n```\n\n## New Implementation\n\n```tsx\nconst [panelWidth, setPanelWidth] = useState(() =\u003e {\n  // Load from localStorage or default\n  return parseInt(localStorage.getItem(\"issue-panel-width\") || \"400\")\n})\n\nconst handleDrag = (e: MouseEvent) =\u003e {\n  const newWidth = Math.max(200, Math.min(e.clientX, window.innerWidth * 0.5))\n  setPanelWidth(newWidth)\n}\n\nconst handleDragEnd = () =\u003e {\n  localStorage.setItem(\"issue-panel-width\", panelWidth.toString())\n}\n\nreturn (\n  \u003cdiv className=\"flex h-full\"\u003e\n    \u003cdiv style={{ width: panelWidth }} className=\"border-r relative\"\u003e\n      {/* Issue Details */}\n      \n      {/* Drag handle */}\n      \u003cdiv \n        className=\"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-primary/20\"\n        onMouseDown={startDrag}\n      /\u003e\n    \u003c/div\u003e\n    \u003cdiv className=\"flex-1\"\u003e\n      {/* Chat */}\n    \u003c/div\u003e\n  \u003c/div\u003e\n)\n```\n\n## Drag Handle UX\n\n1. **Visual feedback** - Handle highlights on hover\n2. **Cursor change** - `cursor-col-resize` indicates draggable\n3. **Smooth dragging** - Update width on mousemove\n4. **Persist on release** - Save to localStorage on mouseup\n5. **Constraints** - Min 200px, max 50% of viewport\n\n## Considerations\n\n- **Mobile** - No resizing on mobile (tabbed interface)\n- **Performance** - Debounce localStorage writes\n- **Accessibility** - Consider keyboard-based resizing (optional)\n- **Reset** - Double-click handle to reset to default? (optional)\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Optional: Reusable Hook\n\n```typescript\n// src/lib/hooks/useResizablePanel.ts\nexport function useResizablePanel(storageKey: string, defaultWidth: number) {\n  const [width, setWidth] = useState(defaultWidth)\n  const isDragging = useRef(false)\n  \n  // ... drag logic\n  \n  return { width, dragHandleProps }\n}\n```\n\n## Dependencies\n\nNone - can be implemented independently\n\n## Acceptance Criteria\n\n- [ ] Drag handle visible on right edge of panel\n- [ ] Handle highlights on hover\n- [ ] Cursor changes to resize cursor\n- [ ] Width updates while dragging\n- [ ] Width saved to localStorage on release\n- [ ] Width restored on page reload\n- [ ] Min width enforced (200px)\n- [ ] Max width enforced (50% viewport)\n- [ ] Only active on desktop (\u003e768px)\n- [ ] Smooth, performant dragging","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T10:38:11.191988-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Panel resizing implemented with drag handle, localStorage persistence, min/max constraints","dependencies":[{"issue_id":"maestro-fyp.4.2","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:38:11.194109-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.4.3","title":"Add mobile unread indicator","description":"## Task\n\nShow a badge on the Chat tab when the user is viewing the Details tab and the AI responds with new messages.\n\n## Why\n\nOn mobile, users switch between Details and Chat tabs. If they are reading details while the AI responds, they have no indication that new messages arrived. The unread indicator:\n- Signals new activity\n- Encourages tab switch\n- Prevents user from wondering if AI responded\n\n## Design\n\n```\n┌─────────────────────────────────────────┐\n│ ←  #42: Add auth flow              [···]│\n├─────────────────────────────────────────┤\n│   Details    │    Chat ●                │  ← Red dot = unread\n├─────────────────────────────────────────┤\n```\n\n## Implementation\n\n```tsx\nconst [activeTab, setActiveTab] = useState\u003c\"details\" | \"chat\"\u003e(\"chat\")\nconst [hasUnread, setHasUnread] = useState(false)\n\n// When new message arrives\nconst handleNewMessage = (message) =\u003e {\n  setMessages(prev =\u003e [...prev, message])\n  \n  // Mark unread if not on chat tab\n  if (activeTab !== \"chat\") {\n    setHasUnread(true)\n  }\n}\n\n// Clear unread when switching to chat\nconst handleTabChange = (tab) =\u003e {\n  setActiveTab(tab)\n  if (tab === \"chat\") {\n    setHasUnread(false)\n  }\n}\n\n// Tab bar rendering\n\u003cdiv className=\"flex border-b\"\u003e\n  \u003cbutton\n    className={cn(\"flex-1 py-2\", activeTab === \"details\" \u0026\u0026 \"border-b-2\")}\n    onClick={() =\u003e handleTabChange(\"details\")}\n  \u003e\n    Details\n  \u003c/button\u003e\n  \u003cbutton\n    className={cn(\"flex-1 py-2 relative\", activeTab === \"chat\" \u0026\u0026 \"border-b-2\")}\n    onClick={() =\u003e handleTabChange(\"chat\")}\n  \u003e\n    Chat\n    {hasUnread \u0026\u0026 (\n      \u003cspan className=\"absolute top-1 right-1/4 h-2 w-2 bg-destructive rounded-full\" /\u003e\n    )}\n  \u003c/button\u003e\n\u003c/div\u003e\n```\n\n## Behavior Details\n\n| State | Action | Result |\n|-------|--------|--------|\n| On Chat tab | AI responds | No badge (user sees it) |\n| On Details tab | AI responds | Badge appears |\n| Badge visible | Switch to Chat | Badge clears |\n| Badge visible | Switch to Details | Badge stays |\n| On Chat tab | Switch to Details then back | No badge |\n\n## Visual Design\n\n- Small red dot (not a number badge)\n- Positioned near tab text\n- Matches destructive color for visibility\n- Animates in with slight fade/scale? (optional)\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Streaming messages working (Phase 2)\n- Only relevant on mobile (already have tab UI)\n\n## Acceptance Criteria\n\n- [ ] Badge appears when AI responds on Details tab\n- [ ] Badge clears when switching to Chat tab\n- [ ] Badge only shows on mobile layout\n- [ ] Badge positioned correctly relative to tab\n- [ ] Badge uses consistent styling (red dot)\n- [ ] No badge when already on Chat tab","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T10:38:27.794788-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Mobile unread indicator added with red pulsing dot on Chat tab when AI responds on Details tab","dependencies":[{"issue_id":"maestro-fyp.4.3","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:38:27.796975-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4.3","depends_on_id":"maestro-fyp.2.3","type":"blocks","created_at":"2025-12-30T10:39:26.333965-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.4.4","title":"Improve loading and empty states","description":"## Task\n\nAdd comprehensive loading states and empty states throughout the Issue View.\n\n## Why\n\nUsers need feedback about what is happening:\n- Is data loading?\n- Is the AI thinking?\n- Why is this section empty?\n\nGood loading/empty states reduce confusion and perceived wait time.\n\n## Loading States to Add\n\n### 1. Issue Details Loading\nCurrently: Nothing while fetching\nGoal: Skeleton loader\n\n```tsx\n{isLoading ? (\n  \u003cdiv className=\"space-y-4\"\u003e\n    \u003cSkeleton className=\"h-6 w-3/4\" /\u003e  {/* Title */}\n    \u003cSkeleton className=\"h-4 w-1/4\" /\u003e  {/* Metadata */}\n    \u003cSkeleton className=\"h-24 w-full\" /\u003e {/* Body */}\n  \u003c/div\u003e\n) : (\n  \u003cIssueDetails issue={issue} /\u003e\n)}\n```\n\n### 2. Session Starting\nCurrently: Nothing\nGoal: \"Starting conversation...\" with spinner\n\n```tsx\n{isCreatingSession \u0026\u0026 (\n  \u003cdiv className=\"flex items-center justify-center py-8\"\u003e\n    \u003cLoader2 className=\"h-4 w-4 animate-spin mr-2\" /\u003e\n    \u003cspan className=\"text-muted-foreground\"\u003eStarting conversation...\u003c/span\u003e\n  \u003c/div\u003e\n)}\n```\n\n### 3. AI Responding\nCurrently: Nothing (or basic spinner)\nGoal: Typing indicator (pulsing dots)\n\n```tsx\n{isTyping \u0026\u0026 (\n  \u003cdiv className=\"flex items-center gap-1 text-muted-foreground\"\u003e\n    \u003cspan className=\"animate-pulse\"\u003e●\u003c/span\u003e\n    \u003cspan className=\"animate-pulse delay-100\"\u003e●\u003c/span\u003e\n    \u003cspan className=\"animate-pulse delay-200\"\u003e●\u003c/span\u003e\n  \u003c/div\u003e\n)}\n```\n\n### 4. Streaming Response\nAlready streaming text, but should:\n- Disable input while streaming\n- Show cursor at end of text\n\n## Empty States to Add\n\n### 1. No Issue Description\n```tsx\n\u003cp className=\"text-sm text-muted-foreground italic\"\u003e\n  No description provided.\n\u003c/p\u003e\n```\n\n### 2. No Comments\nEither hide section or:\n```tsx\n\u003cp className=\"text-sm text-muted-foreground\"\u003e\n  No comments yet.\n\u003c/p\u003e\n```\n\n### 3. No Chat History (New Session)\n```tsx\n\u003cdiv className=\"flex flex-col items-center justify-center h-full text-center p-8\"\u003e\n  \u003cMessageSquare className=\"h-12 w-12 text-muted-foreground/50 mb-4\" /\u003e\n  \u003ch3 className=\"font-medium\"\u003eStart a conversation\u003c/h3\u003e\n  \u003cp className=\"text-sm text-muted-foreground mt-1\"\u003e\n    Ask the agent about this issue to start exploring.\n  \u003c/p\u003e\n\u003c/div\u003e\n```\n\n## Button Loading States\n\n### Create Issue\n```tsx\n\u003cButton disabled={isCreating}\u003e\n  {isCreating ? (\n    \u003c\u003e\n      \u003cLoader2 className=\"h-4 w-4 animate-spin mr-2\" /\u003e\n      Creating...\n    \u003c/\u003e\n  ) : (\n    \"Create Issue\"\n  )}\n\u003c/Button\u003e\n```\n\n### Send Message\nInput disabled, button shows spinner\n\n### Save Summary (in modal)\n```tsx\n\u003cButton disabled={isPosting}\u003e\n  {isPosting ? \"Posting...\" : \"Post to Issue\"}\n\u003c/Button\u003e\n```\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n- Possibly create `src/components/ui/skeleton.tsx` if not exists\n\n## Dependencies\n\n- Chat integration working (Phase 2) for typing states\n\n## Acceptance Criteria\n\n- [ ] Issue details show skeleton while loading\n- [ ] \"Starting conversation...\" shown during session creation\n- [ ] Typing indicator shown while AI generating\n- [ ] Input disabled during streaming\n- [ ] No description shows placeholder text\n- [ ] No comments handled gracefully\n- [ ] Empty chat shows helpful prompt\n- [ ] All buttons show loading state when appropriate\n- [ ] Loading states match app visual style","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T10:38:48.027519-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Loading states improved with skeletons, empty states, typing indicators, and session error banner","dependencies":[{"issue_id":"maestro-fyp.4.4","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:38:48.030715-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4.4","depends_on_id":"maestro-fyp.2.1","type":"blocks","created_at":"2025-12-30T10:39:26.367831-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.4.5","title":"Add contextual error handling","description":"## Task\n\nAdd inline error handling for specific failure scenarios that do not warrant a global banner.\n\n## Why\n\nNot all errors are equal:\n- OpenCode server down = global banner (affects all features)\n- Single API call failed = contextual inline error\n- Network hiccup = toast with retry\n\nMatching error severity to UI treatment reduces alarm fatigue.\n\n## Error Scenarios\n\n### Issue Fetch Failed\nShow inline error in Issue Details panel:\n\n```tsx\n{issueError \u0026\u0026 (\n  \u003cdiv className=\"rounded-md bg-destructive/10 p-4\"\u003e\n    \u003cdiv className=\"flex items-start gap-3\"\u003e\n      \u003cAlertCircle className=\"h-5 w-5 text-destructive mt-0.5\" /\u003e\n      \u003cdiv className=\"flex-1\"\u003e\n        \u003cp className=\"text-sm font-medium text-destructive\"\u003e\n          Failed to load issue\n        \u003c/p\u003e\n        \u003cp className=\"text-sm text-muted-foreground mt-1\"\u003e\n          {issueError.message}\n        \u003c/p\u003e\n        \u003cButton \n          variant=\"outline\" \n          size=\"sm\" \n          className=\"mt-3\"\n          onClick={refetchIssue}\n        \u003e\n          Try again\n        \u003c/Button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n)}\n```\n\n### Session Creation Failed\nShow inline error in Chat area:\n\n```tsx\n{sessionError \u0026\u0026 (\n  \u003cdiv className=\"flex flex-col items-center justify-center h-full p-8\"\u003e\n    \u003cAlertCircle className=\"h-12 w-12 text-destructive/50 mb-4\" /\u003e\n    \u003ch3 className=\"font-medium\"\u003eCould not start conversation\u003c/h3\u003e\n    \u003cp className=\"text-sm text-muted-foreground mt-1 text-center\"\u003e\n      {sessionError.message}\n    \u003c/p\u003e\n    \u003cButton className=\"mt-4\" onClick={retrySession}\u003e\n      Try again\n    \u003c/Button\u003e\n  \u003c/div\u003e\n)}\n```\n\n### Message Send Failed\nKeep message in input, show toast with retry:\n\n```tsx\ntry {\n  await sendMessage(content)\n  setInput(\"\")\n} catch (error) {\n  // Do NOT clear input\n  toast({\n    variant: \"destructive\",\n    title: \"Message failed to send\",\n    description: \"Check your connection and try again.\",\n    action: (\n      \u003cButton size=\"sm\" variant=\"outline\" onClick={() =\u003e sendMessage(content)}\u003e\n        Retry\n      \u003c/Button\u003e\n    ),\n  })\n}\n```\n\n### Issue Not Found (404)\nNavigate to 404 page with helpful link:\n\n```tsx\n// src/app/project/[id]/issue/[issueNumber]/not-found.tsx\n\nexport default function IssueNotFound() {\n  return (\n    \u003cdiv className=\"flex flex-col items-center justify-center min-h-screen\"\u003e\n      \u003ch1 className=\"text-4xl font-bold\"\u003eIssue Not Found\u003c/h1\u003e\n      \u003cp className=\"text-muted-foreground mt-2\"\u003e\n        This issue may have been deleted or you do not have access.\n      \u003c/p\u003e\n      \u003cButton asChild className=\"mt-4\"\u003e\n        \u003cLink href={`/project/${projectId}`}\u003e\n          Back to Project\n        \u003c/Link\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  )\n}\n```\n\n### Comment Post Failed\nError toast with the comment preserved:\n\n```tsx\ntry {\n  await postComment(summary)\n  closeModal()\n  toast({ title: \"Summary posted to issue\" })\n} catch (error) {\n  toast({\n    variant: \"destructive\",\n    title: \"Failed to post comment\",\n    description: error.message,\n  })\n  // Modal stays open with content preserved\n}\n```\n\n## Error Recovery Patterns\n\n1. **Inline + Retry** - For fetch failures (issue, session)\n2. **Toast + Retry** - For transient failures (send message)\n3. **Preserve Input** - Never lose user-typed content\n4. **Navigate Away** - For unrecoverable (404, auth)\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n- Create `src/app/project/[id]/issue/[issueNumber]/not-found.tsx`\n- Possibly add toast component if not exists\n\n## Dependencies\n\n- Basic functionality working (Phase 2-3)\n\n## Acceptance Criteria\n\n- [ ] Issue fetch error shows inline with retry\n- [ ] Session error shows centered with retry\n- [ ] Message send error keeps input, shows toast\n- [ ] 404 issue shows helpful page\n- [ ] Comment post error keeps modal open\n- [ ] All errors have actionable next steps\n- [ ] No user input ever lost on error","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T10:39:08.713154-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Contextual error handling added with inline errors, retry buttons, input preservation on failure","dependencies":[{"issue_id":"maestro-fyp.4.5","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:39:08.716595-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4.5","depends_on_id":"maestro-fyp.2.1","type":"blocks","created_at":"2025-12-30T10:39:26.401642-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88","title":"Planning Mode: AI-Assisted Task Decomposition (GH Issue #6)","description":"## Overview\n\nBuild the Planning Mode experience - the critical bridge between Ideation and Swarm Execution in Maestro's workflow. When a user enters planning mode from an issue page, we create an isolated development environment (git worktree) and run AI-assisted planning to decompose the GitHub issue into actionable, parallelizable beads.\n\n---\n\n## Strategic Context: Why Planning Mode Matters\n\nMaestro's core value proposition is the **Ideation → Planning → Swarm** workflow:\n1. **Ideation**: Explore ideas conversationally with an AI agent\n2. **Planning** (THIS FEATURE): Break issues into concrete, parallelizable tasks\n3. **Swarm**: Execute tasks in parallel with multiple agents\n\n**Planning Mode is the linchpin.** Without it, users cannot:\n- Transform vague requirements into concrete tasks\n- Establish dependency relationships between tasks\n- Identify which files each task will touch (critical for swarm file reservations)\n- Iteratively refine the plan before committing resources to execution\n\n**Key Insight**: The quality of planning directly determines swarm success. A poorly planned epic leads to agent conflicts, redundant work, and failed executions. Planning Mode must support iterative refinement until the plan is 'right'.\n\n---\n\n## Technical Architecture Decisions\n\n### 1. Git Worktree Isolation\n**Why worktrees instead of branches?**\n- Clean separation: planning changes don't pollute the main working directory\n- Parallel safety: the user (or other agents) can continue working in the main repo\n- Automatic cleanup: worktree can be deleted without affecting main repo\n- Branch tie-in: each worktree has its own branch, ready for PR when complete\n\n**Location**: `~/.maestro/worktrees/{project-slug}/issue-{number}/`\nThis centralized location:\n- Prevents worktrees from cluttering the main project directory\n- Makes cleanup and management straightforward\n- Allows Maestro to track all active planning sessions across projects\n\n### 2. CLI-First Beads Integration\n**Why CLI (`bd`) instead of MCP?**\n- **Simplicity**: No additional server to run; CLI is always available\n- **Consistency**: Matches how developers interact with beads manually\n- **Reliability**: No connection management, reconnection logic, etc.\n- **Observability**: CLI output is easily logged and debugged\n\n**Trade-off accepted**: Slightly higher latency than MCP, but simpler implementation and fewer failure modes.\n\n### 3. Slash Commands as Prompts\n**Why send `/turn_gh_issue_into_beads` as a regular message, not a separate API?**\n- OpenCode's agent already handles slash commands in message text\n- Keeps the interface simple: one way to send messages\n- The slash command is essentially a 'macro' that triggers specific agent behavior\n- Allows natural follow-up: user can continue the conversation after the command\n\n### 4. Full Tool Access for Planning Sessions\nPlanning agents need:\n- **bash**: Execute `bd` commands, run git operations\n- **write/edit**: Create and modify bead files (via CLI)\n- **read**: Analyze codebase structure for task breakdown\n\nThis is more permissive than a pure 'discussion' session but necessary for the agent to actually create/modify beads.\n\n---\n\n## User Experience Design\n\n### Entry Flow\n1. User is on Issue Page (already discussing/viewing a GitHub issue)\n2. User clicks 'Start Planning' button in header\n3. Confirmation modal explains what will happen\n4. On confirm: navigate to Planning Page, begin environment setup\n\n### Planning Page Layout (Desktop)\n```\n┌────────────────────────────┬────────────────────────────┐\n│  LEFT PANE                 │  RIGHT PANE                │\n│  - Setup progress          │  - View toggle (List/Graph)│\n│  - Chat interface          │  - Plan visualization      │\n│                            │  - Detail panel            │\n└────────────────────────────┴────────────────────────────┘\n```\n\n### Planning Page Layout (Mobile \u003c 1024px)\n- Tab 1: Setup/Chat\n- Tab 2: Plan UI\n- Unread indicator when plan changes while on chat tab\n\n### Refinement Model\nTwo modes of refinement:\n1. **Holistic** (slash commands): `/turn_gh_issue_into_beads`, `/improve_beads`\n2. **Granular** (free-form chat): Select a bead, chat about it specifically\n\n---\n\n## Implementation Phases\n\n### Phase 1: Entry Point\n- Add 'Start Planning' button to issue page\n- Build confirmation modal\n- Create navigation to planning route\n\n### Phase 2: Worktree Service\n- Create `WorktreeService` for worktree lifecycle management\n- Handle branch creation, conflict detection, cleanup\n\n### Phase 3: Planning Page \u0026 Setup Pipeline\n- Create planning page with split-pane layout\n- Build SSE-based setup progress UI\n- Implement setup pipeline: worktree → deps → session → initial prompt\n\n### Phase 4: OpenCode Integration\n- Extend OpenCode service for full-access sessions\n- Extend session storage for planning session type\n- Create planning-specific API endpoints\n\n### Phase 5: Beads Integration\n- Build CLI wrapper for `bd` commands\n- Implement file watcher for real-time updates\n- Create beads data hooks\n\n### Phase 6: Plan UI\n- Build list view (MVP) with tree structure\n- Create bead detail panel with view/edit\n- Implement bead selection and navigation\n\n### Phase 7: Chat \u0026 Refinement\n- Integrate chat component with planning context\n- Support slash command execution\n- Connect bead selection to chat context\n\n### Phase 8: Resume \u0026 State Management\n- Detect existing worktrees on navigation\n- Reconnect to existing sessions\n- Load saved bead state\n\n### Phase 9: Testing \u0026 Polish\n- Cross-browser testing\n- Mobile device testing\n- Error scenario testing\n\n---\n\n## Success Criteria\n\n1. User can enter planning mode from any issue with a GitHub issue loaded\n2. Worktree is created automatically with correct branch naming\n3. Setup progress is visible in real-time via SSE\n4. AI agent successfully creates initial bead breakdown via slash command\n5. User can view beads in list format with hierarchy\n6. User can select beads and view/edit details\n7. User can refine plan via free-form chat\n8. Session can be resumed after navigation away\n9. Works on mobile (\u003c 1024px) with tabbed interface\n10. All error states are handled gracefully with recovery options\n\n---\n\n## Dependencies\n\n- **beads CLI (`bd`)**: Must be installed and configured\n- **git worktree support**: Project must be a git repository\n- **bun**: For dependency installation in worktrees\n- **OpenCode server**: Running via `opencode serve`\n\n---\n\n## Risk Assessment\n\n**High Risk:**\n- Worktree creation edge cases (branch conflicts, permissions)\n- Session state management across page reloads\n\n**Medium Risk:**\n- SSE streaming reliability for setup progress\n- Beads file watching accuracy\n\n**Low Risk:**\n- UI component implementation (following established patterns)\n- API endpoint creation (following existing patterns)\n\n---\n\n## References\n- GitHub Issue: #6\n- SCOPE.md: Project overview and workflow\n- Existing patterns: Issue page, Solo chat, Session management","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-30T23:00:07.676082-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:57.165223-06:00","close_reason":"Completed","deleted_at":"2025-12-31T08:43:57.165223-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-g88.1","title":"Phase 1.1: Add 'Start Planning' Button to Issue Page Header","description":"## Task Overview\n\nAdd a 'Start Planning' button to the issue page header that initiates the planning workflow. This is the entry point for the entire planning mode feature.\n\n---\n\n## Background \u0026 Context\n\nThe issue page (`/project/{id}/issue/{issueNumber}`) currently serves as a discussion interface where users can chat with an AI about a GitHub issue. Planning mode extends this by allowing users to transform the discussion into an actionable plan.\n\n**Current header structure** (from `src/app/project/[id]/issue/[issueNumber]/page.tsx`):\n- External link button (opens GitHub issue)\n- Refresh button\n- New session button\n- More options dropdown\n\nThe 'Start Planning' button should fit naturally alongside these existing actions.\n\n---\n\n## Implementation Details\n\n### Button Placement\nAdd the button to the header action group, positioned logically:\n```\n[External Link] [Refresh] [Start Planning] [New Session] [More ▼]\n```\n\n### Button Appearance\n- Use `Button` from shadcn/ui with `variant='outline'`\n- Icon: Consider using a planning/task icon (e.g., `ListTodo` from lucide-react)\n- Text: 'Plan' or 'Start Planning' (depends on available space)\n- On mobile: Icon-only with tooltip\n\n### Enabled State Logic\nThe button should only be **enabled** when:\n1. A GitHub issue has been loaded (i.e., `issueData` is present)\n2. The issue data includes a valid issue number\n\nIf no GitHub issue is associated, the button should be:\n- Visually disabled (dimmed)\n- Show tooltip explaining: 'Create a GitHub issue first to start planning'\n\n### Click Handler\nOn click, trigger the confirmation modal (Task 1.2). Pass:\n- Project ID\n- Issue number\n- Issue title (for display in modal)\n\n---\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx` - Add button to header\n\n---\n\n## Acceptance Criteria\n\n- [ ] Button appears in issue page header\n- [ ] Button uses consistent styling with existing actions\n- [ ] Button is disabled when no GitHub issue is loaded\n- [ ] Disabled state shows helpful tooltip\n- [ ] Click triggers confirmation modal (once Task 1.2 is complete)\n- [ ] Works on both desktop and mobile layouts\n- [ ] Icon-only on mobile with preserved accessibility\n\n---\n\n## Testing Notes\n\n- Test with issue that has GitHub issue loaded\n- Test with issue that has no GitHub issue (should be disabled)\n- Test button appearance at various viewport widths\n- Verify button is keyboard accessible","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:00:26.413139-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.1","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:00:26.416886-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.10","title":"Phase 3.2: Create Beads API Endpoints","description":"## Task Overview\n\nCreate API endpoints that expose beads operations to the frontend, using the BeadsService to execute CLI commands.\n\n---\n\n## Background \u0026 Context\n\nThe frontend needs to:\n1. Fetch the current bead tree for display\n2. Update bead properties (status, priority, etc.)\n3. React to bead changes in real-time\n\nThis task creates the HTTP API layer. Real-time updates will be handled separately via file watching.\n\n---\n\n## Endpoints\n\n### GET `/api/projects/{id}/planning/{issueNumber}/beads`\n\nFetch all beads for the planning session as a tree structure.\n\n**Response:**\n```json\n{\n  \"tree\": {\n    \"root\": {\n      \"id\": \"maestro-g88\",\n      \"title\": \"Planning Mode Feature\",\n      \"type\": \"epic\",\n      \"status\": \"open\",\n      \"priority\": 1\n    },\n    \"children\": [\n      {\n        \"root\": {\n          \"id\": \"maestro-g88.1\",\n          \"title\": \"Add Start Planning Button\",\n          \"type\": \"task\",\n          \"status\": \"open\",\n          \"priority\": 1,\n          \"parent\": \"maestro-g88\"\n        },\n        \"children\": []\n      }\n    ]\n  },\n  \"flat\": [/* all beads as flat array */]\n}\n```\n\n**Error Response:**\n```json\n{\n  \"error\": \"Worktree not found\",\n  \"code\": \"WORKTREE_NOT_FOUND\"\n}\n```\n\n---\n\n### GET `/api/projects/{id}/planning/{issueNumber}/beads/{beadId}`\n\nFetch a single bead's details.\n\n**Response:**\n```json\n{\n  \"bead\": {\n    \"id\": \"maestro-g88.1\",\n    \"title\": \"Add Start Planning Button\",\n    \"description\": \"## Task Overview\\n\\nAdd a 'Start Planning' button...\",\n    \"type\": \"task\",\n    \"status\": \"open\",\n    \"priority\": 1,\n    \"parent\": \"maestro-g88\",\n    \"files\": [\"src/app/project/[id]/issue/[issueNumber]/page.tsx\"],\n    \"blockedBy\": [],\n    \"blocks\": [\"maestro-g88.2\"]\n  }\n}\n```\n\n---\n\n### PATCH `/api/projects/{id}/planning/{issueNumber}/beads/{beadId}`\n\nUpdate a bead's properties.\n\n**Request Body:**\n```json\n{\n  \"status\": \"in_progress\",\n  \"priority\": 0,\n  \"title\": \"Updated title\"\n}\n```\n\n**Response:**\n```json\n{\n  \"bead\": { /* updated bead */ }\n}\n```\n\n---\n\n### POST `/api/projects/{id}/planning/{issueNumber}/beads`\n\nCreate a new bead (typically done by AI, but exposed for manual creation).\n\n**Request Body:**\n```json\n{\n  \"title\": \"New subtask\",\n  \"type\": \"task\",\n  \"parent\": \"maestro-g88.1\",\n  \"priority\": 2,\n  \"description\": \"...\"\n}\n```\n\n**Response:**\n```json\n{\n  \"bead\": { /* created bead */ }\n}\n```\n\n---\n\n### DELETE `/api/projects/{id}/planning/{issueNumber}/beads/{beadId}`\n\nClose/delete a bead.\n\n**Request Body (optional):**\n```json\n{\n  \"reason\": \"Merged with task 2\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true\n}\n```\n\n---\n\n## Implementation\n\n### Route Structure\n\n```\nsrc/app/api/projects/[id]/planning/[issueNumber]/beads/\n├── route.ts           # GET (list), POST (create)\n└── [beadId]/\n    └── route.ts       # GET (single), PATCH (update), DELETE (close)\n```\n\n### Common Handler Pattern\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/beads/route.ts\n\nimport { beadsService } from '@/lib/services/beads';\nimport { worktreeService } from '@/lib/services/worktree';\nimport { configService } from '@/lib/services/config';\n\nexport async function GET(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  // Get project and worktree\n  const project = await configService.getProject(projectId);\n  if (!project) {\n    return Response.json({ error: 'Project not found' }, { status: 404 });\n  }\n  \n  const worktree = await worktreeService.getWorktree(project.path, issueNumber);\n  if (!worktree) {\n    return Response.json({ error: 'Worktree not found' }, { status: 404 });\n  }\n  \n  try {\n    const beads = await beadsService.list(worktree.path);\n    \n    // Find the epic for this issue\n    const epic = beads.find(b =\u003e \n      b.type === 'epic' \u0026\u0026 \n      b.title.includes(`#${issueNumber}`) // Heuristic, may need refinement\n    );\n    \n    if (!epic) {\n      return Response.json({ tree: null, flat: beads });\n    }\n    \n    const tree = await beadsService.getTree(worktree.path, epic.id);\n    \n    return Response.json({ tree, flat: beads });\n  } catch (error) {\n    return Response.json(\n      { error: error.message, code: error.code },\n      { status: 500 }\n    );\n  }\n}\n```\n\n---\n\n## Epic Detection Heuristic\n\nThe initial planning prompt creates an epic titled like:\n`\"Planning Mode Feature (GH Issue #6)\"`\n\nWe need to find this epic to build the tree. Options:\n1. Store epic ID in session metadata\n2. Search by title pattern\n3. Store in worktree metadata\n\nFor MVP, use title pattern matching. Refine later if needed.\n\n---\n\n## Files to Create\n\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/route.ts`\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/[beadId]/route.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] GET /beads returns tree and flat list of beads\n- [ ] GET /beads/{id} returns single bead with full details\n- [ ] PATCH /beads/{id} updates bead properties\n- [ ] POST /beads creates new bead\n- [ ] DELETE /beads/{id} closes bead\n- [ ] Proper 404 handling for missing project/worktree/bead\n- [ ] Error responses include code and message\n- [ ] Epic detection finds correct root bead\n\n---\n\n## Dependencies\n\n- Requires: BeadsService (3.1)\n- Requires: WorktreeService (2.1)\n\n---\n\n## Testing Notes\n\n- Test with no beads (should return empty tree)\n- Test CRUD operations\n- Test error cases (invalid bead ID, missing worktree)\n- Verify epic detection works correctly","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:05:51.523427-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.10","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:05:51.525688-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.10","depends_on_id":"maestro-g88.9","type":"blocks","created_at":"2025-12-30T23:14:46.393022-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.11","title":"Phase 3.3: Implement Beads File Watching for Real-Time Updates","description":"## Task Overview\n\nImplement file system watching on the `.beads/` directory to detect when the AI agent creates or modifies beads, enabling real-time UI updates.\n\n---\n\n## Background \u0026 Context\n\n### The Real-Time Challenge\n\nWhen the AI agent runs `bd create` or `bd update`, the beads database changes. The frontend needs to reflect these changes immediately.\n\n### Options Considered\n\n1. **Polling**: Simple but wastes resources, has latency\n2. **File watching**: Reactive, efficient, but needs careful implementation\n3. **SSE from agent**: Complex, requires agent cooperation\n\n**Decision**: File watching with polling fallback.\n\n---\n\n## Implementation Approach\n\n### Server-Side File Watcher\n\nCreate an SSE endpoint that watches the `.beads/` directory and emits events when changes occur.\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts\n\nimport { watch } from 'fs';\nimport { beadsService } from '@/lib/services/beads';\n\nexport async function GET(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const worktree = await getWorktreeForPlanning(params.id, params.issueNumber);\n  if (!worktree) {\n    return new Response('Worktree not found', { status: 404 });\n  }\n  \n  const beadsDir = path.join(worktree.path, '.beads');\n  \n  const stream = new ReadableStream({\n    start(controller) {\n      const encoder = new TextEncoder();\n      \n      function sendBeads() {\n        beadsService.list(worktree.path).then(beads =\u003e {\n          controller.enqueue(\n            encoder.encode(`data: ${JSON.stringify({ type: 'update', beads })}\\n\\n`)\n          );\n        });\n      }\n      \n      // Send initial state\n      sendBeads();\n      \n      // Watch for changes\n      const watcher = watch(beadsDir, { recursive: true }, (eventType, filename) =\u003e {\n        // Debounce rapid changes\n        sendBeads();\n      });\n      \n      // Cleanup on disconnect\n      request.signal.addEventListener('abort', () =\u003e {\n        watcher.close();\n        controller.close();\n      });\n    }\n  });\n  \n  return new Response(stream, {\n    headers: {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n    },\n  });\n}\n```\n\n---\n\n## Debouncing\n\nMultiple file changes can occur rapidly (e.g., during `bd sync`). Debounce to avoid flooding the frontend:\n\n```typescript\nlet debounceTimer: NodeJS.Timeout | null = null;\n\nfunction debouncedSendBeads() {\n  if (debounceTimer) {\n    clearTimeout(debounceTimer);\n  }\n  \n  debounceTimer = setTimeout(() =\u003e {\n    sendBeads();\n    debounceTimer = null;\n  }, 100);  // 100ms debounce\n}\n```\n\n---\n\n## Frontend Hook\n\n```typescript\n// src/lib/hooks/useBeadsWatch.ts\n\nexport function useBeadsWatch(projectId: string, issueNumber: number) {\n  const [beads, setBeads] = useState\u003cBead[]\u003e([]);\n  const [isConnected, setIsConnected] = useState(false);\n  const [error, setError] = useState\u003cError | null\u003e(null);\n  \n  useEffect(() =\u003e {\n    const eventSource = new EventSource(\n      `/api/projects/${projectId}/planning/${issueNumber}/beads/watch`\n    );\n    \n    eventSource.onopen = () =\u003e {\n      setIsConnected(true);\n      setError(null);\n    };\n    \n    eventSource.onmessage = (event) =\u003e {\n      const data = JSON.parse(event.data);\n      if (data.type === 'update') {\n        setBeads(data.beads);\n      }\n    };\n    \n    eventSource.onerror = (event) =\u003e {\n      setIsConnected(false);\n      setError(new Error('Connection lost'));\n      // Attempt reconnect after delay\n      setTimeout(() =\u003e {\n        eventSource.close();\n        // Hook will re-run and create new connection\n      }, 5000);\n    };\n    \n    return () =\u003e {\n      eventSource.close();\n    };\n  }, [projectId, issueNumber]);\n  \n  return { beads, isConnected, error };\n}\n```\n\n---\n\n## Polling Fallback\n\nIf file watching is unreliable (e.g., on certain filesystems), fall back to polling:\n\n```typescript\nconst POLL_INTERVAL = 5000;  // 5 seconds\n\n// In the SSE handler, if fs.watch fails:\nlet lastHash = '';\n\nconst pollInterval = setInterval(async () =\u003e {\n  const beads = await beadsService.list(worktree.path);\n  const hash = JSON.stringify(beads);\n  \n  if (hash !== lastHash) {\n    lastHash = hash;\n    controller.enqueue(\n      encoder.encode(`data: ${JSON.stringify({ type: 'update', beads })}\\n\\n`)\n    );\n  }\n}, POLL_INTERVAL);\n\nrequest.signal.addEventListener('abort', () =\u003e {\n  clearInterval(pollInterval);\n});\n```\n\n---\n\n## Connection Status UI\n\nIndicate connection status in the UI:\n\n```tsx\nfunction PlanningPage() {\n  const { beads, isConnected, error } = useBeadsWatch(projectId, issueNumber);\n  \n  return (\n    \u003cdiv\u003e\n      {!isConnected \u0026\u0026 (\n        \u003cBanner variant=\"warning\"\u003e\n          Live updates paused. Reconnecting...\n        \u003c/Banner\u003e\n      )}\n      {/* rest of UI */}\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Files to Create\n\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts`\n- `src/lib/hooks/useBeadsWatch.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] SSE endpoint streams bead updates when files change\n- [ ] Changes are debounced to prevent flooding\n- [ ] Frontend hook consumes SSE and updates state\n- [ ] Connection status is tracked and displayed\n- [ ] Reconnection logic handles disconnects\n- [ ] Polling fallback works if file watching fails\n- [ ] Proper cleanup when component unmounts\n- [ ] Stream closes when request is aborted\n\n---\n\n## Dependencies\n\n- Requires: BeadsService (3.1)\n- Requires: Beads API Endpoints (3.2)\n\n---\n\n## Testing Notes\n\n- Test with AI agent creating beads rapidly\n- Test disconnect/reconnect scenarios\n- Test with multiple browser tabs (should all update)\n- Verify cleanup (no leaked file watchers)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T23:06:24.440496-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.11","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:06:24.442855-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.11","depends_on_id":"maestro-g88.10","type":"blocks","created_at":"2025-12-30T23:14:46.462999-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.11","depends_on_id":"maestro-g88.4","type":"blocks","created_at":"2025-12-31T07:52:31.314182-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.12","title":"Phase 4.1: Build BeadsList Component (Tree View)","description":"## Task Overview\n\nCreate the main list view component that displays beads in a hierarchical tree structure with expand/collapse, status indicators, and selection.\n\n---\n\n## Background \u0026 Context\n\n### MVP: List View Only\n\nThe GitHub issue specifies list view as MVP, with graph view as Phase 2. This task implements the tree/list visualization.\n\n### Design Goals\n\n1. **Hierarchical**: Show Epic → Tasks → Subtasks structure\n2. **Scannable**: Status indicators, priorities at a glance\n3. **Interactive**: Click to select, expand/collapse children\n4. **Real-time**: Updates as beads change\n\n---\n\n## Visual Design\n\n```\n┌─────────────────────────────────────────────────────────┐\n│  📋  Planning Mode Feature (GH Issue #6)        [Epic]  │\n│      ○ open • P1                                        │\n├─────────────────────────────────────────────────────────┤\n│  ▼ Phase 1: Entry Point                                 │\n│    │                                                    │\n│    ├─ ● 1.1 Add Start Planning Button         ○ open   │\n│    ├─ ● 1.2 Build Confirmation Modal          ○ open   │\n│    └─ ● 1.3 Create Planning Page Route        ○ open   │\n│                                                         │\n│  ▶ Phase 2: Worktree Service (5 tasks)                 │\n│                                                         │\n│  ▶ Phase 3: Beads Integration (3 tasks)                │\n└─────────────────────────────────────────────────────────┘\n```\n\n---\n\n## Component Structure\n\n```typescript\n// src/components/planning/BeadsList.tsx\n\ninterface BeadsListProps {\n  tree: BeadTree;\n  selectedId: string | null;\n  onSelect: (beadId: string) =\u003e void;\n  onExpand: (beadId: string) =\u003e void;\n}\n\nexport function BeadsList({ tree, selectedId, onSelect, onExpand }: BeadsListProps) {\n  return (\n    \u003cdiv className=\"beads-list\"\u003e\n      \u003cBeadNode \n        bead={tree.root} \n        children={tree.children}\n        depth={0}\n        selectedId={selectedId}\n        onSelect={onSelect}\n        onExpand={onExpand}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## BeadNode Component\n\n```typescript\n// src/components/planning/BeadNode.tsx\n\ninterface BeadNodeProps {\n  bead: Bead;\n  children: BeadTree[];\n  depth: number;\n  selectedId: string | null;\n  onSelect: (beadId: string) =\u003e void;\n  onExpand: (beadId: string) =\u003e void;\n}\n\nexport function BeadNode({ bead, children, depth, selectedId, onSelect, onExpand }: BeadNodeProps) {\n  const [isExpanded, setIsExpanded] = useState(depth === 0);  // Root expanded by default\n  \n  const hasChildren = children.length \u003e 0;\n  const isSelected = bead.id === selectedId;\n  \n  return (\n    \u003cdiv className={cn('bead-node', { 'depth-0': depth === 0 })}\u003e\n      \u003cdiv \n        className={cn(\n          'bead-row flex items-center gap-2 px-2 py-1.5 rounded-md cursor-pointer',\n          'hover:bg-accent',\n          isSelected \u0026\u0026 'bg-accent'\n        )}\n        style={{ paddingLeft: `${depth * 16 + 8}px` }}\n        onClick={() =\u003e onSelect(bead.id)}\n      \u003e\n        {/* Expand/collapse toggle */}\n        {hasChildren ? (\n          \u003cbutton \n            className=\"shrink-0\"\n            onClick={(e) =\u003e { \n              e.stopPropagation(); \n              setIsExpanded(!isExpanded); \n            }}\n          \u003e\n            {isExpanded ? \u003cChevronDown /\u003e : \u003cChevronRight /\u003e}\n          \u003c/button\u003e\n        ) : (\n          \u003cspan className=\"w-4\" /\u003e  {/* Spacing for alignment */}\n        )}\n        \n        {/* Status indicator */}\n        \u003cStatusIndicator status={bead.status} /\u003e\n        \n        {/* Title */}\n        \u003cspan className=\"flex-1 truncate\"\u003e{bead.title}\u003c/span\u003e\n        \n        {/* Type badge */}\n        \u003cTypeBadge type={bead.type} /\u003e\n        \n        {/* Priority (if not default) */}\n        {bead.priority !== 2 \u0026\u0026 \u003cPriorityBadge priority={bead.priority} /\u003e}\n      \u003c/div\u003e\n      \n      {/* Children */}\n      {isExpanded \u0026\u0026 hasChildren \u0026\u0026 (\n        \u003cdiv className=\"bead-children\"\u003e\n          {children.map(child =\u003e (\n            \u003cBeadNode \n              key={child.root.id}\n              bead={child.root}\n              children={child.children}\n              depth={depth + 1}\n              selectedId={selectedId}\n              onSelect={onSelect}\n              onExpand={onExpand}\n            /\u003e\n          ))}\n        \u003c/div\u003e\n      )}\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Status Indicator\n\n```typescript\n// src/components/planning/StatusIndicator.tsx\n\nfunction StatusIndicator({ status }: { status: Bead['status'] }) {\n  const config = {\n    open: { color: 'text-muted-foreground', icon: Circle },\n    in_progress: { color: 'text-blue-500', icon: CircleDot },\n    closed: { color: 'text-green-500', icon: CheckCircle2 },\n  };\n  \n  const { color, icon: Icon } = config[status];\n  \n  return \u003cIcon className={cn('h-4 w-4', color)} /\u003e;\n}\n```\n\n---\n\n## Type Badge\n\n```typescript\n// src/components/planning/TypeBadge.tsx\n\nfunction TypeBadge({ type }: { type: Bead['type'] }) {\n  const config = {\n    epic: { label: 'Epic', variant: 'default' as const },\n    task: { label: 'Task', variant: 'secondary' as const },\n    bug: { label: 'Bug', variant: 'destructive' as const },\n    feature: { label: 'Feature', variant: 'default' as const },\n    question: { label: '?', variant: 'outline' as const },\n    docs: { label: 'Docs', variant: 'outline' as const },\n  };\n  \n  const { label, variant } = config[type];\n  \n  // Only show for epic type in the tree (others are implicit)\n  if (type !== 'epic') return null;\n  \n  return \u003cBadge variant={variant}\u003e{label}\u003c/Badge\u003e;\n}\n```\n\n---\n\n## Priority Badge\n\n```typescript\nfunction PriorityBadge({ priority }: { priority: Bead['priority'] }) {\n  const config = {\n    0: { label: 'P0', className: 'bg-red-500 text-white' },\n    1: { label: 'P1', className: 'bg-orange-500 text-white' },\n    3: { label: 'P3', className: 'bg-gray-400 text-white' },\n    4: { label: 'P4', className: 'bg-gray-300 text-gray-600' },\n  };\n  \n  // P2 is default, don't show\n  if (priority === 2) return null;\n  \n  const { label, className } = config[priority];\n  \n  return (\n    \u003cspan className={cn('text-xs px-1.5 py-0.5 rounded font-mono', className)}\u003e\n      {label}\n    \u003c/span\u003e\n  );\n}\n```\n\n---\n\n## Keyboard Navigation\n\nSupport keyboard navigation for accessibility:\n\n```typescript\n// In BeadsList\nfunction handleKeyDown(e: KeyboardEvent) {\n  switch (e.key) {\n    case 'ArrowDown':\n      // Select next visible bead\n      break;\n    case 'ArrowUp':\n      // Select previous visible bead\n      break;\n    case 'ArrowRight':\n      // Expand if has children, else select first child\n      break;\n    case 'ArrowLeft':\n      // Collapse if expanded, else select parent\n      break;\n    case 'Enter':\n    case ' ':\n      // Toggle expand/collapse\n      break;\n  }\n}\n```\n\n---\n\n## Files to Create\n\n- `src/components/planning/BeadsList.tsx`\n- `src/components/planning/BeadNode.tsx`\n- `src/components/planning/StatusIndicator.tsx`\n- `src/components/planning/TypeBadge.tsx`\n- `src/components/planning/PriorityBadge.tsx`\n\n---\n\n## Acceptance Criteria\n\n- [ ] Tree structure renders with proper indentation\n- [ ] Expand/collapse works for nodes with children\n- [ ] Selection highlights the selected node\n- [ ] Status indicators show correct colors/icons\n- [ ] Type badges display for epics\n- [ ] Priority badges show for non-default priorities\n- [ ] Keyboard navigation works\n- [ ] Works on mobile (touch targets large enough)\n- [ ] Animates expand/collapse smoothly\n\n---\n\n## Dependencies\n\n- Requires: Beads API Endpoints (3.2)\n- Requires: useBeadsWatch hook (3.3)\n\n---\n\n## Testing Notes\n\n- Test with deep nesting (4+ levels)\n- Test with many beads (50+)\n- Test keyboard navigation\n- Test on touch devices","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:07:09.476432-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.12","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:07:09.478807-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.12","depends_on_id":"maestro-g88.10","type":"blocks","created_at":"2025-12-30T23:14:51.805178-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.12","depends_on_id":"maestro-g88.11","type":"blocks","created_at":"2025-12-31T07:52:30.170726-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.13","title":"Phase 4.2: Build BeadDetail Panel Component","description":"## Task Overview\n\nCreate the detail panel that displays when a bead is selected, showing full information and providing edit capabilities.\n\n---\n\n## Background \u0026 Context\n\nWhen a user selects a bead in the list, they need to:\n1. View the full description and metadata\n2. Edit properties (status, priority, title)\n3. See dependencies and associated files\n4. Access actions like 'Chat about this' or 'Delete'\n\n---\n\n## Visual Design\n\n```\n┌─────────────────────────────────────────────────────┐\n│  Phase 1.1: Add Start Planning Button               │\n│  ─────────────────────────────────────────────────  │\n│                                                     │\n│  Status: ○ open    │  Priority: P1   │  Type: task │\n│  [Edit ▼]          │  [Edit ▼]       │             │\n│                                                     │\n│  ───────────────────────────────────────────────── │\n│                                                     │\n│  ## Task Overview                                   │\n│                                                     │\n│  Add a 'Start Planning' button to the issue page    │\n│  header that initiates the planning workflow.       │\n│                                                     │\n│  ### Files to Modify                                │\n│  - src/app/project/[id]/issue/[issueNumber]/page.tsx│\n│                                                     │\n│  ### Acceptance Criteria                            │\n│  - [ ] Button appears in header                     │\n│  - [ ] Button is disabled when no GitHub issue...   │\n│                                                     │\n│  ───────────────────────────────────────────────── │\n│                                                     │\n│  Dependencies:                                      │\n│  Blocks: 1.2 Build Confirmation Modal              │\n│                                                     │\n│  ───────────────────────────────────────────────── │\n│                                                     │\n│  [Chat about this]  [Edit]  [Delete]               │\n└─────────────────────────────────────────────────────┘\n```\n\n---\n\n## Component API\n\n```typescript\n// src/components/planning/BeadDetail.tsx\n\ninterface BeadDetailProps {\n  bead: Bead;\n  onUpdate: (updates: UpdateBeadOptions) =\u003e Promise\u003cvoid\u003e;\n  onClose: () =\u003e void;\n  onChatAbout: (beadId: string) =\u003e void;\n}\n\nexport function BeadDetail({ bead, onUpdate, onClose, onChatAbout }: BeadDetailProps) {\n  const [isEditing, setIsEditing] = useState(false);\n  \n  return (\n    \u003cdiv className=\"bead-detail p-4 border-l bg-card\"\u003e\n      \u003cHeader bead={bead} onClose={onClose} /\u003e\n      \u003cMetadataRow bead={bead} onUpdate={onUpdate} /\u003e\n      \u003cSeparator /\u003e\n      \u003cDescription description={bead.description} /\u003e\n      \u003cSeparator /\u003e\n      \u003cDependencies bead={bead} /\u003e\n      \u003cSeparator /\u003e\n      \u003cActions \n        beadId={bead.id} \n        onChatAbout={onChatAbout}\n        onEdit={() =\u003e setIsEditing(true)}\n        onDelete={handleDelete}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Header Section\n\n```typescript\nfunction Header({ bead, onClose }: { bead: Bead; onClose: () =\u003e void }) {\n  return (\n    \u003cdiv className=\"flex items-start justify-between gap-2 mb-4\"\u003e\n      \u003ch3 className=\"font-semibold text-lg leading-tight\"\u003e{bead.title}\u003c/h3\u003e\n      \u003cButton variant=\"ghost\" size=\"icon\" onClick={onClose}\u003e\n        \u003cX className=\"h-4 w-4\" /\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Metadata Row with Inline Edit\n\n```typescript\nfunction MetadataRow({ bead, onUpdate }: { bead: Bead; onUpdate: Function }) {\n  return (\n    \u003cdiv className=\"flex flex-wrap gap-4 mb-4\"\u003e\n      {/* Status dropdown */}\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cspan className=\"text-sm text-muted-foreground\"\u003eStatus:\u003c/span\u003e\n        \u003cSelect \n          value={bead.status} \n          onValueChange={(status) =\u003e onUpdate({ status })}\n        \u003e\n          \u003cSelectTrigger className=\"w-32\"\u003e\n            \u003cStatusIndicator status={bead.status} /\u003e\n            \u003cspan className=\"ml-2\"\u003e{bead.status}\u003c/span\u003e\n          \u003c/SelectTrigger\u003e\n          \u003cSelectContent\u003e\n            \u003cSelectItem value=\"open\"\u003eOpen\u003c/SelectItem\u003e\n            \u003cSelectItem value=\"in_progress\"\u003eIn Progress\u003c/SelectItem\u003e\n            \u003cSelectItem value=\"closed\"\u003eClosed\u003c/SelectItem\u003e\n          \u003c/SelectContent\u003e\n        \u003c/Select\u003e\n      \u003c/div\u003e\n      \n      {/* Priority dropdown */}\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cspan className=\"text-sm text-muted-foreground\"\u003ePriority:\u003c/span\u003e\n        \u003cSelect \n          value={String(bead.priority)} \n          onValueChange={(p) =\u003e onUpdate({ priority: parseInt(p) })}\n        \u003e\n          \u003cSelectTrigger className=\"w-20\"\u003e\n            \u003cspan\u003eP{bead.priority}\u003c/span\u003e\n          \u003c/SelectTrigger\u003e\n          \u003cSelectContent\u003e\n            \u003cSelectItem value=\"0\"\u003eP0 - Critical\u003c/SelectItem\u003e\n            \u003cSelectItem value=\"1\"\u003eP1 - High\u003c/SelectItem\u003e\n            \u003cSelectItem value=\"2\"\u003eP2 - Medium\u003c/SelectItem\u003e\n            \u003cSelectItem value=\"3\"\u003eP3 - Low\u003c/SelectItem\u003e\n            \u003cSelectItem value=\"4\"\u003eP4 - Backlog\u003c/SelectItem\u003e\n          \u003c/SelectContent\u003e\n        \u003c/Select\u003e\n      \u003c/div\u003e\n      \n      {/* Type badge (read-only) */}\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cspan className=\"text-sm text-muted-foreground\"\u003eType:\u003c/span\u003e\n        \u003cBadge variant=\"outline\"\u003e{bead.type}\u003c/Badge\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Description with Markdown\n\n```typescript\nimport ReactMarkdown from 'react-markdown';\n\nfunction Description({ description }: { description?: string }) {\n  if (!description) {\n    return (\n      \u003cp className=\"text-muted-foreground italic\"\u003eNo description\u003c/p\u003e\n    );\n  }\n  \n  return (\n    \u003cdiv className=\"prose prose-sm dark:prose-invert max-w-none\"\u003e\n      \u003cReactMarkdown\u003e{description}\u003c/ReactMarkdown\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nNote: May need to install `react-markdown` if not already present.\n\n---\n\n## Dependencies Section\n\n```typescript\nfunction Dependencies({ bead }: { bead: Bead }) {\n  const hasBlocks = bead.blocks \u0026\u0026 bead.blocks.length \u003e 0;\n  const hasBlockedBy = bead.blockedBy \u0026\u0026 bead.blockedBy.length \u003e 0;\n  \n  if (!hasBlocks \u0026\u0026 !hasBlockedBy) {\n    return null;\n  }\n  \n  return (\n    \u003cdiv className=\"space-y-2\"\u003e\n      \u003ch4 className=\"text-sm font-medium\"\u003eDependencies\u003c/h4\u003e\n      \n      {hasBlockedBy \u0026\u0026 (\n        \u003cdiv className=\"text-sm\"\u003e\n          \u003cspan className=\"text-muted-foreground\"\u003eBlocked by: \u003c/span\u003e\n          {bead.blockedBy.map(id =\u003e (\n            \u003cBeadLink key={id} beadId={id} /\u003e\n          ))}\n        \u003c/div\u003e\n      )}\n      \n      {hasBlocks \u0026\u0026 (\n        \u003cdiv className=\"text-sm\"\u003e\n          \u003cspan className=\"text-muted-foreground\"\u003eBlocks: \u003c/span\u003e\n          {bead.blocks.map(id =\u003e (\n            \u003cBeadLink key={id} beadId={id} /\u003e\n          ))}\n        \u003c/div\u003e\n      )}\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Actions Section\n\n```typescript\nfunction Actions({ beadId, onChatAbout, onEdit, onDelete }) {\n  return (\n    \u003cdiv className=\"flex gap-2 mt-4\"\u003e\n      \u003cButton variant=\"outline\" size=\"sm\" onClick={() =\u003e onChatAbout(beadId)}\u003e\n        \u003cMessageSquare className=\"h-4 w-4 mr-2\" /\u003e\n        Chat about this\n      \u003c/Button\u003e\n      \n      \u003cButton variant=\"outline\" size=\"sm\" onClick={onEdit}\u003e\n        \u003cPencil className=\"h-4 w-4 mr-2\" /\u003e\n        Edit\n      \u003c/Button\u003e\n      \n      \u003cButton variant=\"outline\" size=\"sm\" className=\"text-destructive\" onClick={onDelete}\u003e\n        \u003cTrash className=\"h-4 w-4 mr-2\" /\u003e\n        Delete\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Delete Confirmation\n\n```typescript\nfunction handleDelete(beadId: string) {\n  // Use Alert Dialog for confirmation\n  // \"Are you sure you want to delete this task? This action cannot be undone.\"\n  // On confirm: call onDelete(beadId) and close detail panel\n}\n```\n\n---\n\n## Files to Create\n\n- `src/components/planning/BeadDetail.tsx`\n- `src/components/planning/BeadLink.tsx` (link to another bead by ID)\n\n---\n\n## Acceptance Criteria\n\n- [ ] Panel displays when bead is selected\n- [ ] Title, status, priority, type visible at a glance\n- [ ] Status and priority editable via dropdowns\n- [ ] Description renders markdown properly\n- [ ] Dependencies section shows blocks/blocked-by\n- [ ] 'Chat about this' button works (Task 5.3)\n- [ ] 'Delete' shows confirmation before deleting\n- [ ] Close button dismisses panel\n- [ ] Optimistic updates for status/priority changes\n- [ ] Mobile-friendly layout\n\n---\n\n## Dependencies\n\n- Requires: Beads API Endpoints (3.2) for updates\n- Requires: BeadsList (4.1) for selection\n\n---\n\n## Testing Notes\n\n- Test editing status and priority\n- Test markdown rendering edge cases\n- Test delete confirmation flow\n- Test with very long descriptions","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:07:56.344265-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.13","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:07:56.346697-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.13","depends_on_id":"maestro-g88.10","type":"blocks","created_at":"2025-12-30T23:14:51.875367-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.14","title":"Phase 4.3: Integrate Plan UI into Planning Page","description":"## Task Overview\n\nWire up the BeadsList and BeadDetail components into the planning page's right pane, replacing the placeholder components created in Phase 1.3.\n\n---\n\n## Background \u0026 Context\n\nPhase 1.3 created the planning page with placeholder components. This task integrates the real Plan UI components into the right pane.\n\n---\n\n## Implementation Details\n\n### Right Pane Structure\n\n```tsx\n// In PlanningRightPane.tsx\n\nfunction PlanningRightPane({ \n  projectId, \n  issueNumber \n}: { \n  projectId: string; \n  issueNumber: number; \n}) {\n  const { beads, isConnected, error } = useBeadsWatch(projectId, issueNumber);\n  const [selectedBeadId, setSelectedBeadId] = useState\u003cstring | null\u003e(null);\n  \n  // Build tree from flat beads\n  const tree = useMemo(() =\u003e buildBeadTree(beads), [beads]);\n  \n  // Get selected bead\n  const selectedBead = selectedBeadId \n    ? beads.find(b =\u003e b.id === selectedBeadId) \n    : null;\n  \n  const handleUpdate = async (updates: UpdateBeadOptions) =\u003e {\n    await fetch(`/api/projects/${projectId}/planning/${issueNumber}/beads/${selectedBeadId}`, {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(updates),\n    });\n    // Optimistic update or wait for file watcher\n  };\n  \n  return (\n    \u003cdiv className=\"flex flex-col h-full\"\u003e\n      {/* View toggle (future: List | Graph) */}\n      \u003cdiv className=\"flex items-center justify-between p-2 border-b\"\u003e\n        \u003ch3 className=\"font-medium\"\u003ePlan\u003c/h3\u003e\n        {!isConnected \u0026\u0026 (\n          \u003cBadge variant=\"outline\" className=\"text-yellow-600\"\u003e\n            Offline\n          \u003c/Badge\u003e\n        )}\n      \u003c/div\u003e\n      \n      {/* Main content */}\n      \u003cdiv className=\"flex flex-1 overflow-hidden\"\u003e\n        {/* Beads list */}\n        \u003cdiv className=\"flex-1 overflow-auto\"\u003e\n          {tree ? (\n            \u003cBeadsList \n              tree={tree}\n              selectedId={selectedBeadId}\n              onSelect={setSelectedBeadId}\n            /\u003e\n          ) : (\n            \u003cEmptyState message=\"No beads yet. The AI is analyzing your issue...\" /\u003e\n          )}\n        \u003c/div\u003e\n        \n        {/* Detail panel (conditional) */}\n        {selectedBead \u0026\u0026 (\n          \u003cdiv className=\"w-80 border-l overflow-auto\"\u003e\n            \u003cBeadDetail \n              bead={selectedBead}\n              onUpdate={handleUpdate}\n              onClose={() =\u003e setSelectedBeadId(null)}\n              onChatAbout={handleChatAbout}\n            /\u003e\n          \u003c/div\u003e\n        )}\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Tree Building Logic\n\n```typescript\nfunction buildBeadTree(beads: Bead[]): BeadTree | null {\n  if (beads.length === 0) return null;\n  \n  // Find the epic (root)\n  const epic = beads.find(b =\u003e b.type === 'epic' \u0026\u0026 !b.parent);\n  if (!epic) return null;\n  \n  const beadMap = new Map(beads.map(b =\u003e [b.id, b]));\n  \n  function buildNode(bead: Bead): BeadTree {\n    const children = beads\n      .filter(b =\u003e b.parent === bead.id)\n      .sort((a, b) =\u003e {\n        // Sort by priority, then by ID\n        if (a.priority !== b.priority) return a.priority - b.priority;\n        return a.id.localeCompare(b.id);\n      })\n      .map(buildNode);\n    \n    return { root: bead, children };\n  }\n  \n  return buildNode(epic);\n}\n```\n\n---\n\n## Mobile Layout Integration\n\nFor mobile (\u003c 1024px), the right pane content appears in the 'Plan' tab:\n\n```tsx\n// In page.tsx mobile section\n\n\u003cTabs defaultValue=\"chat\"\u003e\n  \u003cTabsList\u003e\n    \u003cTabsTrigger value=\"chat\"\u003eSetup/Chat\u003c/TabsTrigger\u003e\n    \u003cTabsTrigger value=\"plan\"\u003e\n      Plan\n      {hasNewBeads \u0026\u0026 \u003cspan className=\"ml-1 h-2 w-2 rounded-full bg-blue-500\" /\u003e}\n    \u003c/TabsTrigger\u003e\n  \u003c/TabsList\u003e\n  \n  \u003cTabsContent value=\"chat\"\u003e\n    \u003cPlanningLeftPane ... /\u003e\n  \u003c/TabsContent\u003e\n  \n  \u003cTabsContent value=\"plan\"\u003e\n    \u003cPlanningRightPane ... /\u003e\n  \u003c/TabsContent\u003e\n\u003c/Tabs\u003e\n```\n\n---\n\n## Unread Indicator Logic\n\nTrack when beads change while viewing the chat tab:\n\n```typescript\nconst [lastViewedBeadsHash, setLastViewedBeadsHash] = useState('');\nconst currentBeadsHash = useMemo(() =\u003e JSON.stringify(beads), [beads]);\nconst hasNewBeads = currentBeadsHash !== lastViewedBeadsHash;\n\n// When switching to plan tab\nfunction handleTabChange(value: string) {\n  if (value === 'plan') {\n    setLastViewedBeadsHash(currentBeadsHash);\n  }\n}\n```\n\n---\n\n## Empty State\n\n```tsx\nfunction EmptyState({ message }: { message: string }) {\n  return (\n    \u003cdiv className=\"flex flex-col items-center justify-center h-full p-8 text-center\"\u003e\n      \u003cListTodo className=\"h-12 w-12 text-muted-foreground mb-4\" /\u003e\n      \u003cp className=\"text-muted-foreground\"\u003e{message}\u003c/p\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Files to Modify\n\n- `src/app/project/[id]/planning/[issueNumber]/page.tsx`\n- `src/components/planning/PlanningRightPane.tsx`\n\n---\n\n## Acceptance Criteria\n\n- [ ] BeadsList renders in right pane on desktop\n- [ ] BeadDetail appears when bead is selected\n- [ ] Selection state managed correctly\n- [ ] Real-time updates from useBeadsWatch reflected\n- [ ] Empty state shown when no beads\n- [ ] Mobile tabs show Plan content correctly\n- [ ] Unread indicator shows when beads change while on chat tab\n- [ ] Optimistic updates for bead edits\n\n---\n\n## Dependencies\n\n- Requires: BeadsList (4.1)\n- Requires: BeadDetail (4.2)\n- Requires: useBeadsWatch (3.3)\n- Requires: Planning Page Layout (1.3)\n\n---\n\n## Testing Notes\n\n- Test with no beads initially, then beads arriving\n- Test selection persistence across bead updates\n- Test mobile tab switching with unread indicator\n- Test resize behavior of split pane","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:08:36.756804-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.14","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:08:36.75942-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.14","depends_on_id":"maestro-g88.12","type":"blocks","created_at":"2025-12-30T23:14:51.910029-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.14","depends_on_id":"maestro-g88.13","type":"blocks","created_at":"2025-12-30T23:14:51.943761-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.14","depends_on_id":"maestro-g88.3","type":"blocks","created_at":"2025-12-30T23:14:51.978142-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.14","depends_on_id":"maestro-g88.11","type":"blocks","created_at":"2025-12-31T07:52:30.745091-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.15","title":"Phase 5.1: Build Planning Chat Component","description":"## Task Overview\n\nCreate the chat component for the planning page that allows users to refine the plan through conversation with the AI agent.\n\n---\n\n## Background \u0026 Context\n\n### Refinement Model (from GH Issue #6)\n\nTwo modes of refinement:\n1. **Holistic (Slash Commands)**: `/turn_gh_issue_into_beads`, `/improve_beads`\n2. **Granular (Free-form)**: Natural conversation about specific beads\n\nThe chat component supports both by treating all input as messages to the OpenCode session.\n\n---\n\n## Visual Design\n\n```\n┌─────────────────────────────────────────────────────┐\n│  Chat                                               │\n│  ─────────────────────────────────────────────────  │\n│                                                     │\n│  ┌─────────────────────────────────────────────┐   │\n│  │ System: Planning session started for issue #6   │\n│  └─────────────────────────────────────────────┘   │\n│                                                     │\n│  ┌─────────────────────────────────────────────┐   │\n│  │ You: /turn_gh_issue_into_beads 6               │\n│  └─────────────────────────────────────────────┘   │\n│                                                     │\n│  ┌─────────────────────────────────────────────┐   │\n│  │ Agent: I'll analyze issue #6 and create a      │\n│  │ task breakdown...                              │\n│  │ [Tool: bd create --title=\"Phase 1.1...\" ]      │\n│  │ Created task maestro-g88.1                     │\n│  └─────────────────────────────────────────────┘   │\n│                                                     │\n│  ─────────────────────────────────────────────────  │\n│                                                     │\n│  💡 Re: Phase 1.1: Add Start Planning Button       │ ← Context indicator\n│                                                     │\n│  ┌─────────────────────────────────────────────┐   │\n│  │ Break this into smaller steps               │   │\n│  └─────────────────────────────────────────────┘   │\n│  [Send]                                             │\n└─────────────────────────────────────────────────────┘\n```\n\n---\n\n## Component API\n\n```typescript\n// src/components/planning/PlanningChat.tsx\n\ninterface PlanningChatProps {\n  projectId: string;\n  issueNumber: number;\n  sessionId: string | null;\n  worktreePath: string | null;\n  selectedBead: Bead | null;  // For context injection\n  onClearContext: () =\u003e void;\n}\n\nexport function PlanningChat({\n  projectId,\n  issueNumber,\n  sessionId,\n  worktreePath,\n  selectedBead,\n  onClearContext,\n}: PlanningChatProps) {\n  const [messages, setMessages] = useState\u003cMessage[]\u003e([]);\n  const [input, setInput] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  \n  // ... implementation\n}\n```\n\n---\n\n## SSE Message Streaming\n\nReuse patterns from existing chat implementation:\n\n```typescript\nasync function sendMessage(text: string) {\n  // Inject bead context if selected\n  let messageText = text;\n  if (selectedBead) {\n    messageText = `[Context: Task \"${selectedBead.title}\" (ID: ${selectedBead.id})]\\n\\n${text}`;\n  }\n  \n  // Add user message to UI\n  setMessages(prev =\u003e [...prev, { role: 'user', content: text }]);\n  setIsLoading(true);\n  \n  // Start streaming response\n  const response = await fetch(`/api/projects/${projectId}/planning/${issueNumber}/chat`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ message: messageText }),\n  });\n  \n  // Handle SSE stream...\n}\n```\n\n---\n\n## Context Indicator\n\nWhen a bead is selected for 'Chat about this':\n\n```tsx\n{selectedBead \u0026\u0026 (\n  \u003cdiv className=\"flex items-center gap-2 px-3 py-2 bg-accent/50 rounded-t-md\"\u003e\n    \u003cLightbulb className=\"h-4 w-4 text-yellow-500\" /\u003e\n    \u003cspan className=\"text-sm\"\u003eRe: {selectedBead.title}\u003c/span\u003e\n    \u003cButton variant=\"ghost\" size=\"icon\" className=\"h-5 w-5 ml-auto\" onClick={onClearContext}\u003e\n      \u003cX className=\"h-3 w-3\" /\u003e\n    \u003c/Button\u003e\n  \u003c/div\u003e\n)}\n```\n\n---\n\n## Tool Execution Display\n\nShow when the agent executes tools (like `bd create`):\n\n```tsx\nfunction ToolExecution({ tool, args, result }: ToolExecutionProps) {\n  return (\n    \u003cdiv className=\"bg-muted rounded p-2 text-sm font-mono my-2\"\u003e\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cTerminal className=\"h-4 w-4\" /\u003e\n        \u003cspan className=\"text-muted-foreground\"\u003eTool: {tool}\u003c/span\u003e\n      \u003c/div\u003e\n      \u003cdiv className=\"mt-1 text-xs text-muted-foreground\"\u003e\n        {args}\n      \u003c/div\u003e\n      {result \u0026\u0026 (\n        \u003cdiv className=\"mt-1 text-green-600 dark:text-green-400\"\u003e\n          {result}\n        \u003c/div\u003e\n      )}\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Slash Command Suggestions\n\nProvide quick access to common slash commands:\n\n```tsx\nfunction SlashCommandSuggestions({ onSelect }: { onSelect: (cmd: string) =\u003e void }) {\n  const commands = [\n    { cmd: '/improve_beads', desc: 'Holistically improve the current plan' },\n    { cmd: '/turn_gh_issue_into_beads', desc: 'Re-generate task breakdown' },\n  ];\n  \n  return (\n    \u003cdiv className=\"flex gap-2 mb-2\"\u003e\n      {commands.map(({ cmd, desc }) =\u003e (\n        \u003cButton \n          key={cmd}\n          variant=\"outline\" \n          size=\"sm\"\n          onClick={() =\u003e onSelect(cmd)}\n          title={desc}\n        \u003e\n          {cmd}\n        \u003c/Button\u003e\n      ))}\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## API Endpoint\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/chat/route.ts\n\nexport async function POST(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const { message } = await request.json();\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  // Get planning session\n  const session = await sessionStorage.getPlanningSession(projectId, issueNumber);\n  if (!session) {\n    return new Response('Planning session not found', { status: 404 });\n  }\n  \n  // Stream response via SSE\n  const stream = new ReadableStream({\n    async start(controller) {\n      const encoder = new TextEncoder();\n      \n      // Use full-access send with streaming\n      for await (const part of openCodeService.streamPlanningResponse(\n        session.worktreePath,\n        session.sessionId,\n        message\n      )) {\n        controller.enqueue(encoder.encode(`data: ${JSON.stringify(part)}\\n\\n`));\n      }\n      \n      controller.close();\n    }\n  });\n  \n  return new Response(stream, {\n    headers: {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n    },\n  });\n}\n```\n\n---\n\n## Files to Create\n\n- `src/components/planning/PlanningChat.tsx`\n- `src/components/planning/SlashCommandSuggestions.tsx`\n- `src/components/planning/ToolExecution.tsx`\n- `src/app/api/projects/[id]/planning/[issueNumber]/chat/route.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] Chat displays message history\n- [ ] User can send messages via input field\n- [ ] Responses stream in real-time via SSE\n- [ ] Context indicator shows when bead is selected\n- [ ] Tool executions rendered specially\n- [ ] Slash command suggestions accessible\n- [ ] Loading state during response generation\n- [ ] Works before session is ready (disabled state)\n- [ ] Mobile-friendly input area\n\n---\n\n## Dependencies\n\n- Requires: Extended OpenCode Service (2.3)\n- Requires: Extended Session Storage (2.2)\n- Requires: Setup Pipeline (2.4) for session creation\n\n---\n\n## Testing Notes\n\n- Test sending slash commands\n- Test with bead context selected\n- Test SSE streaming reliability\n- Test before session is ready\n- Test on mobile keyboard","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:09:23.871711-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.15","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:09:23.874117-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.15","depends_on_id":"maestro-g88.6","type":"blocks","created_at":"2025-12-30T23:14:57.813536-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.15","depends_on_id":"maestro-g88.23","type":"blocks","created_at":"2025-12-31T07:46:32.162037-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.16","title":"Phase 5.2: Integrate Chat into Left Pane with Setup Progress","description":"## Task Overview\n\nIntegrate the SetupProgress and PlanningChat components into the planning page's left pane, managing the transition from setup to chat mode.\n\n---\n\n## Background \u0026 Context\n\nThe left pane has two modes:\n1. **Setup Mode**: During initial environment setup\n2. **Chat Mode**: After setup completes\n\nThe pane should smoothly transition between these and maintain chat history.\n\n---\n\n## Visual Flow\n\n```\nSetup in Progress:\n┌─────────────────────────────────────────────────────┐\n│  Setting up planning environment...                 │\n│                                                     │\n│  ✓  Creating git worktree          (1.2s)          │\n│  ✓  Installing dependencies         (5.3s)          │\n│  ◐  Starting AI session...                          │\n│  ○  Analyzing issue                                 │\n└─────────────────────────────────────────────────────┘\n\nAfter Setup:\n┌─────────────────────────────────────────────────────┐\n│  ✓ Setup complete                    [Collapse ▴]  │\n│  ─────────────────────────────────────────────────  │\n│                                                     │\n│  Chat                                               │\n│  ┌─────────────────────────────────────────────┐   │\n│  │ System: Created epic with 15 subtasks           │\n│  └─────────────────────────────────────────────┘   │\n│                                                     │\n│  ...chat continues...                               │\n└─────────────────────────────────────────────────────┘\n```\n\n---\n\n## Component Structure\n\n```tsx\n// src/components/planning/PlanningLeftPane.tsx\n\ninterface PlanningLeftPaneProps {\n  projectId: string;\n  issueNumber: number;\n  issueTitle: string;\n  selectedBead: Bead | null;\n  onClearContext: () =\u003e void;\n}\n\nexport function PlanningLeftPane({\n  projectId,\n  issueNumber,\n  issueTitle,\n  selectedBead,\n  onClearContext,\n}: PlanningLeftPaneProps) {\n  const [setupState, setSetupState] = useState\u003c'pending' | 'in_progress' | 'completed' | 'error'\u003e('pending');\n  const [sessionInfo, setSessionInfo] = useState\u003c{ sessionId: string; worktreePath: string } | null\u003e(null);\n  const [setupCollapsed, setSetupCollapsed] = useState(false);\n  \n  // Check for existing session on mount\n  useEffect(() =\u003e {\n    checkExistingSession();\n  }, [projectId, issueNumber]);\n  \n  async function checkExistingSession() {\n    const response = await fetch(`/api/projects/${projectId}/planning/${issueNumber}/status`);\n    const data = await response.json();\n    \n    if (data.sessionId \u0026\u0026 data.worktreePath) {\n      setSessionInfo({ sessionId: data.sessionId, worktreePath: data.worktreePath });\n      setSetupState('completed');\n    } else {\n      setSetupState('pending');\n    }\n  }\n  \n  function handleSetupComplete(result: { sessionId: string; worktreePath: string }) {\n    setSessionInfo(result);\n    setSetupState('completed');\n    setSetupCollapsed(true);  // Auto-collapse after completion\n  }\n  \n  return (\n    \u003cdiv className=\"flex flex-col h-full\"\u003e\n      {/* Setup Progress (collapsible after completion) */}\n      {setupState !== 'completed' ? (\n        \u003cSetupProgress\n          projectId={projectId}\n          issueNumber={issueNumber}\n          issueTitle={issueTitle}\n          onComplete={handleSetupComplete}\n          onError={() =\u003e setSetupState('error')}\n        /\u003e\n      ) : (\n        \u003cCollapsible open={!setupCollapsed} onOpenChange={(open) =\u003e setSetupCollapsed(!open)}\u003e\n          \u003cCollapsibleTrigger asChild\u003e\n            \u003cbutton className=\"flex items-center justify-between w-full p-2 text-sm\"\u003e\n              \u003cspan className=\"flex items-center gap-2\"\u003e\n                \u003cCheckCircle className=\"h-4 w-4 text-green-500\" /\u003e\n                Setup complete\n              \u003c/span\u003e\n              {setupCollapsed ? \u003cChevronDown /\u003e : \u003cChevronUp /\u003e}\n            \u003c/button\u003e\n          \u003c/CollapsibleTrigger\u003e\n          \u003cCollapsibleContent\u003e\n            \u003cSetupSummary \n              branch={sessionInfo?.branch}\n              worktreePath={sessionInfo?.worktreePath}\n            /\u003e\n          \u003c/CollapsibleContent\u003e\n        \u003c/Collapsible\u003e\n      )}\n      \n      {/* Divider */}\n      \u003cSeparator /\u003e\n      \n      {/* Chat Section */}\n      \u003cdiv className=\"flex-1 overflow-hidden\"\u003e\n        \u003cPlanningChat\n          projectId={projectId}\n          issueNumber={issueNumber}\n          sessionId={sessionInfo?.sessionId ?? null}\n          worktreePath={sessionInfo?.worktreePath ?? null}\n          selectedBead={selectedBead}\n          onClearContext={onClearContext}\n        /\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Setup Summary\n\nShow minimal info after setup completes:\n\n```tsx\nfunction SetupSummary({ branch, worktreePath }: { branch?: string; worktreePath?: string }) {\n  return (\n    \u003cdiv className=\"p-2 text-xs text-muted-foreground space-y-1\"\u003e\n      \u003cdiv\u003eBranch: \u003ccode\u003e{branch}\u003c/code\u003e\u003c/div\u003e\n      \u003cdiv\u003eWorktree: \u003ccode className=\"truncate\"\u003e{worktreePath}\u003c/code\u003e\u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Status Check Endpoint\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/status/route.ts\n\nexport async function GET(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  // Get project\n  const project = await configService.getProject(projectId);\n  if (!project) {\n    return Response.json({ error: 'Project not found' }, { status: 404 });\n  }\n  \n  // Check worktree\n  const worktree = await worktreeService.getWorktree(project.path, issueNumber);\n  if (!worktree) {\n    return Response.json({ exists: false });\n  }\n  \n  // Check session\n  const session = await sessionStorage.getPlanningSession(projectId, issueNumber);\n  const sessionAlive = session ? await openCodeService.isSessionAlive(session.sessionId) : false;\n  \n  return Response.json({\n    exists: true,\n    worktreePath: worktree.path,\n    branch: worktree.branch,\n    depsInstalled: worktree.depsInstalled,\n    sessionId: sessionAlive ? session.sessionId : null,\n    sessionAlive,\n  });\n}\n```\n\n---\n\n## Auto-Start Setup\n\nWhen landing on the planning page without existing session, automatically start setup:\n\n```tsx\nuseEffect(() =\u003e {\n  if (setupState === 'pending') {\n    // Auto-start setup after brief delay\n    const timer = setTimeout(() =\u003e {\n      setSetupState('in_progress');\n    }, 500);\n    return () =\u003e clearTimeout(timer);\n  }\n}, [setupState]);\n```\n\n---\n\n## Files to Create\n\n- `src/components/planning/PlanningLeftPane.tsx`\n- `src/components/planning/SetupSummary.tsx`\n- `src/app/api/projects/[id]/planning/[issueNumber]/status/route.ts`\n\n## Files to Modify\n\n- `src/app/project/[id]/planning/[issueNumber]/page.tsx` - Wire up left pane\n\n---\n\n## Acceptance Criteria\n\n- [ ] Setup progress shows during initial setup\n- [ ] Auto-collapses after setup completes\n- [ ] Chat section expands to fill available space\n- [ ] Status endpoint returns correct worktree/session info\n- [ ] Existing session detected on page load\n- [ ] Smooth transition from setup to chat\n- [ ] Setup can be expanded again to view details\n\n---\n\n## Dependencies\n\n- Requires: SetupProgress (2.5)\n- Requires: PlanningChat (5.1)\n- Requires: Planning Page Layout (1.3)\n\n---\n\n## Testing Notes\n\n- Test fresh start (no existing session)\n- Test resume (existing session)\n- Test with dead session (needs new session)\n- Test collapse/expand behavior","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:10:05.399582-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.16","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:10:05.401837-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.16","depends_on_id":"maestro-g88.15","type":"blocks","created_at":"2025-12-30T23:14:57.848046-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.16","depends_on_id":"maestro-g88.8","type":"blocks","created_at":"2025-12-30T23:14:57.881844-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.16","depends_on_id":"maestro-g88.3","type":"blocks","created_at":"2025-12-30T23:14:57.915551-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.17","title":"Phase 5.3: Implement 'Chat About This' Bead Context Feature","description":"## Task Overview\n\nImplement the 'Chat about this' feature that allows users to select a bead from the list and have a contextual conversation about it.\n\n---\n\n## Background \u0026 Context\n\nFrom GH Issue #6 Refinement Model:\n\n\u003e **Granular Refinement (Free-form Chat)**\n\u003e For targeted changes to specific beads:\n\u003e \n\u003e User selects a bead in the UI, then chats naturally:\n\u003e - \"This task is too big, break it into smaller pieces\"\n\u003e - \"Combine task 2 and 3, they're really the same thing\"\n\u003e - \"Add a subtask for writing tests\"\n\u003e - \"Change the priority to P0, this is blocking\"\n\u003e - \"What files would this task touch?\"\n\n---\n\n## User Flow\n\n1. User clicks 'Chat about this' button in BeadDetail panel\n2. Selected bead context appears above chat input\n3. User types their message\n4. Message is sent with bead context prefixed\n5. Agent responds with full knowledge of the bead\n6. User can clear context or select a different bead\n\n---\n\n## State Management\n\n```tsx\n// In Planning Page\n\nconst [chatContextBead, setChatContextBead] = useState\u003cBead | null\u003e(null);\n\nfunction handleChatAbout(beadId: string) {\n  const bead = beads.find(b =\u003e b.id === beadId);\n  setChatContextBead(bead);\n  \n  // On mobile, switch to chat tab\n  if (isMobile) {\n    setActiveTab('chat');\n  }\n  \n  // Focus the chat input\n  chatInputRef.current?.focus();\n}\n\nfunction handleClearContext() {\n  setChatContextBead(null);\n}\n```\n\n---\n\n## Context Injection\n\nWhen sending a message with bead context:\n\n```typescript\nfunction buildContextualMessage(userMessage: string, bead: Bead): string {\n  return `[Context: Working on bead \"${bead.title}\" (ID: ${bead.id})]\n\nBead Details:\n- Type: ${bead.type}\n- Status: ${bead.status}\n- Priority: P${bead.priority}\n${bead.description ? `- Description excerpt: ${bead.description.substring(0, 200)}...` : ''}\n\nUser request: ${userMessage}`;\n}\n```\n\nThis provides the agent with enough context to understand:\n1. Which bead the user is referring to\n2. Current state of the bead\n3. What the user wants to do\n\n---\n\n## Context Indicator UI\n\n```tsx\n// In PlanningChat component\n\nfunction ContextIndicator({ \n  bead, \n  onClear \n}: { \n  bead: Bead; \n  onClear: () =\u003e void; \n}) {\n  return (\n    \u003cdiv className=\"flex items-center gap-2 px-3 py-2 bg-accent/50 rounded-t-lg border-b\"\u003e\n      \u003cdiv className=\"flex items-center gap-2 flex-1 min-w-0\"\u003e\n        \u003cMessageSquarePlus className=\"h-4 w-4 shrink-0 text-primary\" /\u003e\n        \u003cspan className=\"text-sm font-medium truncate\"\u003e{bead.title}\u003c/span\u003e\n        \u003cBadge variant=\"outline\" className=\"shrink-0\"\u003e{bead.type}\u003c/Badge\u003e\n      \u003c/div\u003e\n      \u003cButton \n        variant=\"ghost\" \n        size=\"icon\" \n        className=\"h-6 w-6 shrink-0\" \n        onClick={onClear}\n        title=\"Clear context\"\n      \u003e\n        \u003cX className=\"h-3 w-3\" /\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Keyboard Shortcut\n\nAllow clearing context with Escape:\n\n```tsx\nuseEffect(() =\u003e {\n  function handleKeyDown(e: KeyboardEvent) {\n    if (e.key === 'Escape' \u0026\u0026 chatContextBead) {\n      handleClearContext();\n    }\n  }\n  \n  window.addEventListener('keydown', handleKeyDown);\n  return () =\u003e window.removeEventListener('keydown', handleKeyDown);\n}, [chatContextBead]);\n```\n\n---\n\n## Switching Context\n\nWhen user clicks 'Chat about this' on a different bead while one is already selected:\n\n```typescript\nfunction handleChatAbout(beadId: string) {\n  const bead = beads.find(b =\u003e b.id === beadId);\n  \n  // If switching context, just replace\n  setChatContextBead(bead);\n  \n  // Could optionally show a toast: \"Now chatting about: {bead.title}\"\n}\n```\n\n---\n\n## Mobile Flow\n\nOn mobile, after clicking 'Chat about this':\n1. Switch to Chat tab automatically\n2. Show context indicator\n3. Focus input\n\n```tsx\nfunction handleChatAbout(beadId: string) {\n  const bead = beads.find(b =\u003e b.id === beadId);\n  setChatContextBead(bead);\n  \n  // Mobile: switch tabs\n  if (window.innerWidth \u003c 1024) {\n    setActiveTab('chat');\n  }\n}\n```\n\n---\n\n## Files to Modify\n\n- `src/app/project/[id]/planning/[issueNumber]/page.tsx` - Add context state management\n- `src/components/planning/PlanningChat.tsx` - Add context indicator\n- `src/components/planning/BeadDetail.tsx` - Wire up 'Chat about this' button\n- `src/components/planning/PlanningLeftPane.tsx` - Pass context props\n\n---\n\n## Acceptance Criteria\n\n- [ ] 'Chat about this' button sets bead as chat context\n- [ ] Context indicator appears above chat input\n- [ ] X button clears context\n- [ ] Escape key clears context\n- [ ] Messages sent with context include bead info\n- [ ] Mobile switches to chat tab when context is set\n- [ ] Switching beads updates context\n- [ ] Agent responses reference the bead appropriately\n\n---\n\n## Dependencies\n\n- Requires: PlanningChat (5.1)\n- Requires: BeadDetail (4.2)\n- Requires: Integrate Chat into Left Pane (5.2)\n\n---\n\n## Testing Notes\n\n- Test setting context from detail panel\n- Test clearing context via button and keyboard\n- Test mobile tab switch behavior\n- Test that agent receives proper context","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T23:10:40.003521-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.17","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:10:40.00605-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.17","depends_on_id":"maestro-g88.15","type":"blocks","created_at":"2025-12-30T23:14:57.949288-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.17","depends_on_id":"maestro-g88.13","type":"blocks","created_at":"2025-12-30T23:14:57.982333-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.18","title":"Phase 6.1: Implement Session Resume and Recovery Logic","description":"## Task Overview\n\nImplement robust session resume logic that handles various states when a user returns to a planning page, including recovering from dead sessions.\n\n---\n\n## Background \u0026 Context\n\nFrom GH Issue #6 Resume Behavior:\n\n\u003e When navigating back to a planning page:\n\u003e 1. Check if worktree exists at `~/.maestro/worktrees/{project-slug}/issue-{number}/`\n\u003e 2. If exists:\n\u003e    - Skip worktree creation step (show as completed)\n\u003e    - Check if `node_modules` exists → skip deps install if yes\n\u003e    - Check if OpenCode session is alive via `isSessionAlive()`\n\u003e    - If session alive → reconnect; if dead → create new session\n\u003e 3. Load current bead state from `.beads/` via CLI\n\u003e 4. Show where user left off\n\n---\n\n## State Machine\n\n```\n┌──────────────────────────────────────────────────────────┐\n│                    PLANNING PAGE LOAD                     │\n└──────────────────────────────────────────────────────────┘\n                            │\n                            ▼\n                    ┌───────────────┐\n                    │ Check Status  │\n                    │   Endpoint    │\n                    └───────────────┘\n                            │\n            ┌───────────────┼───────────────┐\n            ▼               ▼               ▼\n    ┌──────────────┐ ┌──────────────┐ ┌──────────────┐\n    │ No Worktree  │ │  Worktree +  │ │  Worktree +  │\n    │  (Fresh)     │ │ Live Session │ │ Dead Session │\n    └──────────────┘ └──────────────┘ └──────────────┘\n            │               │               │\n            ▼               ▼               ▼\n    ┌──────────────┐ ┌──────────────┐ ┌──────────────┐\n    │ Start Full   │ │  Reconnect   │ │  Create New  │\n    │   Setup      │ │   Session    │ │   Session    │\n    └──────────────┘ └──────────────┘ └──────────────┘\n            │               │               │\n            └───────────────┴───────────────┘\n                            │\n                            ▼\n                    ┌───────────────┐\n                    │  Load Beads   │\n                    │  Show Chat    │\n                    └───────────────┘\n```\n\n---\n\n## Session Alive Check\n\n**IMPORTANT:** The existing `isSessionAlive` method in OpenCodeService takes BOTH projectPath and sessionId:\n\n```typescript\n// Existing method in src/lib/services/opencode.ts - DO NOT CHANGE SIGNATURE\nasync isSessionAlive(projectPath: string, sessionId: string): Promise\u003cboolean\u003e\n```\n\nFor planning sessions, use the worktreePath as the projectPath:\n\n```typescript\n// Usage in status check\nconst isAlive = await openCodeService.isSessionAlive(\n  session.worktreePath,  // Use worktree path, not original project path\n  session.sessionId\n);\n```\n\n---\n\n## Resume Flow Implementation\n\n```typescript\n// In PlanningLeftPane or custom hook\n\ninterface ResumeState {\n  status: 'checking' | 'fresh' | 'resuming' | 'recovered' | 'ready' | 'error';\n  worktree: WorktreeInfo | null;\n  session: { id: string; isNew: boolean } | null;\n  error: Error | null;\n}\n\nasync function initializePlanningSession(\n  projectId: string,\n  issueNumber: number\n): Promise\u003cResumeState\u003e {\n  // Step 1: Check status endpoint\n  const statusResponse = await fetch(\n    `/api/projects/${projectId}/planning/${issueNumber}/status`\n  );\n  const status = await statusResponse.json();\n  \n  // Case 1: No worktree exists - fresh start\n  if (!status.exists) {\n    return {\n      status: 'fresh',\n      worktree: null,\n      session: null,\n      error: null,\n    };\n  }\n  \n  // Case 2: Worktree exists, session alive - resume\n  if (status.sessionAlive) {\n    return {\n      status: 'ready',\n      worktree: {\n        path: status.worktreePath,\n        branch: status.branch,\n        depsInstalled: status.depsInstalled,\n      },\n      session: { id: status.sessionId, isNew: false },\n      error: null,\n    };\n  }\n  \n  // Case 3: Worktree exists, session dead - recover\n  const recoverResponse = await fetch(\n    `/api/projects/${projectId}/planning/${issueNumber}/session`,\n    { method: 'POST' }\n  );\n  \n  if (!recoverResponse.ok) {\n    return {\n      status: 'error',\n      worktree: null,\n      session: null,\n      error: new Error('Failed to recover session'),\n    };\n  }\n  \n  const { sessionId } = await recoverResponse.json();\n  \n  return {\n    status: 'recovered',\n    worktree: {\n      path: status.worktreePath,\n      branch: status.branch,\n      depsInstalled: status.depsInstalled,\n    },\n    session: { id: sessionId, isNew: true },\n    error: null,\n  };\n}\n```\n\n---\n\n## Session Creation Endpoint\n\nFor recovering dead sessions:\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/session/route.ts\n\nexport async function POST(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  // Get project and worktree\n  const project = await configService.getProject(projectId);\n  const worktree = await worktreeService.getWorktree(project.path, issueNumber);\n  \n  if (!worktree) {\n    return Response.json({ error: 'No worktree found' }, { status: 404 });\n  }\n  \n  // Create new session in worktree context\n  const sessionId = await openCodeService.createPlanningSession(worktree.path);\n  \n  // Update session storage\n  await sessionStorage.saveSession(\n    projectId,\n    project.path,\n    issueNumber,\n    sessionId,\n    { sessionType: 'planning', worktreePath: worktree.path }\n  );\n  \n  return Response.json({ sessionId });\n}\n\nexport async function GET(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  const session = await sessionStorage.getPlanningSession(projectId, issueNumber);\n  \n  if (!session) {\n    return Response.json({ error: 'No session found' }, { status: 404 });\n  }\n  \n  // Use worktreePath for session alive check\n  const isAlive = await openCodeService.isSessionAlive(\n    session.worktreePath,\n    session.sessionId\n  );\n  \n  return Response.json({\n    sessionId: session.sessionId,\n    isAlive,\n    worktreePath: session.worktreePath,\n    createdAt: session.createdAt,\n  });\n}\n```\n\n---\n\n## UI Feedback for Recovery\n\n```tsx\nfunction RecoveryNotice({ onDismiss }: { onDismiss: () =\u003e void }) {\n  return (\n    \u003cdiv className=\"flex items-center gap-2 px-3 py-2 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200 rounded-md mb-4\"\u003e\n      \u003cAlertCircle className=\"h-4 w-4\" /\u003e\n      \u003cspan className=\"text-sm\"\u003ePrevious session expired. Created new session.\u003c/span\u003e\n      \u003cButton variant=\"ghost\" size=\"icon\" className=\"h-5 w-5 ml-auto\" onClick={onDismiss}\u003e\n        \u003cX className=\"h-3 w-3\" /\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Chat History Persistence\n\nWhen recovering a session, the old chat history is lost. For MVP, accept that new sessions start fresh but beads are preserved (beads are stored in .beads/ directory, not tied to session).\n\n---\n\n## Files to Create\n\n- `src/app/api/projects/[id]/planning/[issueNumber]/session/route.ts`\n- `src/lib/hooks/usePlanningSession.ts`\n\n## Files to Modify\n\n- `src/components/planning/PlanningLeftPane.tsx` - Use resume logic\n\n---\n\n## Acceptance Criteria\n\n- [ ] Fresh start (no worktree) triggers full setup\n- [ ] Existing worktree + live session reconnects smoothly\n- [ ] Dead session is detected and new session created\n- [ ] Recovery notice shown when session was recreated\n- [ ] Beads are loaded from existing worktree\n- [ ] No duplicate worktree creation\n- [ ] Error states handled gracefully\n\n---\n\n## Dependencies\n\n- Requires: Status endpoint (from Task 5.2)\n- Requires: Session storage extension (Task 2.2)\n- Requires: OpenCode service extension (Task 2.3)\n\n---\n\n## Testing Notes\n\n- Test fresh start\n- Test page reload with live session\n- Test after session timeout/death\n- Test after OpenCode server restart\n- Test with corrupted session storage","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:11:41.544152-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.18","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:11:41.546389-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.18","depends_on_id":"maestro-g88.5","type":"blocks","created_at":"2025-12-30T23:15:04.222278-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.18","depends_on_id":"maestro-g88.6","type":"blocks","created_at":"2025-12-30T23:15:04.25685-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.18","depends_on_id":"maestro-g88.16","type":"blocks","created_at":"2025-12-30T23:15:04.290897-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.19","title":"Phase 6.2: Add Planning Sessions to Sidebar Navigation","description":"## Task Overview\n\nAdd planning sessions to the sidebar navigation so users can easily access and resume their in-progress planning sessions.\n\n---\n\n## Background \u0026 Context\n\nFrom GH Issue #6 Navigation \u0026 Visibility:\n\n\u003e **Left Sidebar Enhancement**\n\u003e - Planning sessions appear in sidebar under the project\n\u003e - Visual indicator: 📋 or planning icon\n\u003e - Shows: \"Planning #6: {issue title truncated}\"\n\u003e - Click to navigate back to planning page\n\n---\n\n## Visual Design\n\n```\nSidebar (Project Section):\n┌─────────────────────────────────────┐\n│  📁 maestro                         │\n│  ─────────────────────────────────  │\n│  📋 Planning #6: Planning Mode...   │ ← Active planning\n│  📋 Planning #3: Add dark mode...   │\n│  ─────────────────────────────────  │\n│  💬 Recent Chats                    │\n│     Issue #5: Responsive Design     │\n│     Solo: Quick refactor            │\n│  ─────────────────────────────────  │\n│  [+ New Issue]  [Solo Chat]         │\n└─────────────────────────────────────┘\n```\n\n---\n\n## Data Source\n\nFetch active planning sessions from session storage:\n\n```typescript\n// In sidebar or via API\n\nasync function getActivePlanningSessions(projectId: string): Promise\u003cPlanningSessionInfo[]\u003e {\n  const sessions = await sessionStorage.listPlanningSessions(projectId);\n  \n  // Filter to only alive sessions\n  const aliveSessions = await Promise.all(\n    sessions.map(async (session) =\u003e {\n      const isAlive = await openCodeService.isSessionAlive(session.sessionId);\n      if (!isAlive) return null;\n      \n      // Get issue title from somewhere (GitHub API or cached)\n      const issueTitle = await getIssueTitle(projectId, session.issueNumber);\n      \n      return {\n        issueNumber: session.issueNumber,\n        issueTitle,\n        worktreePath: session.worktreePath,\n        createdAt: session.createdAt,\n      };\n    })\n  );\n  \n  return aliveSessions.filter(Boolean);\n}\n```\n\n---\n\n## API Endpoint\n\n```typescript\n// src/app/api/projects/[id]/planning/route.ts\n\nexport async function GET(\n  request: Request,\n  { params }: { params: { id: string } }\n) {\n  const projectId = params.id;\n  const sessions = await getActivePlanningSessions(projectId);\n  \n  return Response.json({ sessions });\n}\n```\n\n---\n\n## Sidebar Integration\n\n```tsx\n// In sidebar component\n\nconst { data: planningSessions } = useSWR(\n  `/api/projects/${projectId}/planning`,\n  fetcher\n);\n\n// Render section\n{planningSessions \u0026\u0026 planningSessions.length \u003e 0 \u0026\u0026 (\n  \u003cSidebarGroup\u003e\n    \u003cSidebarGroupLabel\u003eActive Planning\u003c/SidebarGroupLabel\u003e\n    \u003cSidebarGroupContent\u003e\n      {planningSessions.map((session) =\u003e (\n        \u003cSidebarMenuItem key={session.issueNumber}\u003e\n          \u003cSidebarMenuButton asChild\u003e\n            \u003cLink href={`/project/${projectId}/planning/${session.issueNumber}`}\u003e\n              \u003cClipboardList className=\"h-4 w-4\" /\u003e\n              \u003cspan className=\"truncate\"\u003e\n                #{session.issueNumber}: {session.issueTitle}\n              \u003c/span\u003e\n            \u003c/Link\u003e\n          \u003c/SidebarMenuButton\u003e\n        \u003c/SidebarMenuItem\u003e\n      ))}\n    \u003c/SidebarGroupContent\u003e\n  \u003c/SidebarGroup\u003e\n)}\n```\n\n---\n\n## Active Indicator\n\nHighlight the current planning session in sidebar:\n\n```tsx\nconst pathname = usePathname();\nconst isActive = pathname === `/project/${projectId}/planning/${session.issueNumber}`;\n\n\u003cSidebarMenuButton asChild isActive={isActive}\u003e\n  ...\n\u003c/SidebarMenuButton\u003e\n```\n\n---\n\n## Session Cleanup\n\nConsider adding a way to close/cleanup planning sessions:\n\n1. Right-click context menu with \"End Planning\"\n2. This could close the session and delete the worktree\n3. Or just hide from sidebar without cleanup\n\nFor MVP, sessions naturally disappear when they expire or worktree is deleted.\n\n---\n\n## Files to Create\n\n- `src/app/api/projects/[id]/planning/route.ts`\n\n## Files to Modify\n\n- `src/components/app-sidebar.tsx` - Add planning sessions section\n\n---\n\n## Acceptance Criteria\n\n- [ ] Planning sessions appear in sidebar under project\n- [ ] Shows issue number and truncated title\n- [ ] Click navigates to planning page\n- [ ] Active session is highlighted\n- [ ] Updates when new planning session starts\n- [ ] Empty state (no active planning) is clean\n- [ ] Mobile sidebar shows planning sessions\n\n---\n\n## Dependencies\n\n- Requires: Session storage extension (2.2)\n- Requires: Planning page exists (1.3)\n\n---\n\n## Testing Notes\n\n- Test with 0, 1, and multiple planning sessions\n- Test navigation from sidebar\n- Test with very long issue titles\n- Test after session expiration (should disappear)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T23:12:11.156738-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.19","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:12:11.159025-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.19","depends_on_id":"maestro-g88.5","type":"blocks","created_at":"2025-12-30T23:15:04.324445-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.19","depends_on_id":"maestro-g88.3","type":"blocks","created_at":"2025-12-30T23:15:04.357114-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.2","title":"Phase 1.2: Build Planning Confirmation Modal","description":"## Task Overview\n\nCreate a confirmation modal that explains what will happen when the user starts planning mode, and allows them to confirm or cancel.\n\n---\n\n## Background \u0026 Context\n\nStarting planning mode has side effects:\n1. Creates a git worktree (disk space, git operations)\n2. Installs dependencies (potentially slow)\n3. Starts an AI session that will modify beads\n\nUsers should understand these implications before proceeding. The modal also serves as a 'last chance' to back out if they clicked accidentally.\n\n---\n\n## Implementation Details\n\n### Modal Content\n\n**Header:**\n'Start Planning for #{issueNumber}'\n\n**Body:**\n```\nThis will set up an isolated environment for planning this issue:\n\n• Create a git worktree for safe, isolated changes\n• Install dependencies in the worktree\n• Start an AI session to break down the issue into tasks\n\nThe AI will analyze the issue and codebase to create an initial task breakdown. You can refine the plan before execution.\n```\n\n**Footer:**\n- Cancel button (secondary/outline)\n- 'Start Planning' button (primary)\n\n### Modal Component\n\nUse shadcn `Dialog` component. Create a new component:\n`src/components/planning/StartPlanningModal.tsx`\n\nProps interface:\n```typescript\ninterface StartPlanningModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n  projectId: string;\n  issueNumber: number;\n  issueTitle: string;\n  onConfirm: () =\u003e void;\n}\n```\n\n### UX Considerations\n\n- Modal should be closeable via:\n  - Cancel button\n  - Clicking outside (default Dialog behavior)\n  - Escape key\n- 'Start Planning' button should show loading state during navigation\n- Consider adding a 'Don't show again' checkbox (future enhancement)\n\n---\n\n## Files to Create\n\n- `src/components/planning/StartPlanningModal.tsx`\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx` - Wire up modal state\n\n---\n\n## Acceptance Criteria\n\n- [ ] Modal appears when 'Start Planning' button is clicked\n- [ ] Modal shows issue number in header\n- [ ] Modal explains the three steps that will happen\n- [ ] Cancel button closes modal without side effects\n- [ ] 'Start Planning' button triggers navigation to planning page\n- [ ] Modal is accessible (focus trap, keyboard navigation)\n- [ ] Works on mobile viewports\n\n---\n\n## Dependencies\n\n- Requires Task 1.1 (button that triggers the modal)\n\n---\n\n## Testing Notes\n\n- Verify modal accessibility with keyboard-only navigation\n- Test modal appearance on mobile (should be centered, not full-screen)\n- Verify proper cleanup when modal is dismissed","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:00:49.49038-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.2","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:00:49.493449-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.2","depends_on_id":"maestro-g88.1","type":"blocks","created_at":"2025-12-30T23:14:38.619005-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.20","title":"Phase 7.1: Error Handling and Edge Cases","description":"## Task Overview\n\nImplement comprehensive error handling throughout the planning mode feature, covering all edge cases identified in the GH issue.\n\n---\n\n## Background \u0026 Context\n\nFrom GH Issue #6 Error Handling section, there are three categories of errors to handle:\n\n### 1. Worktree Creation Errors\n| Error | Recovery |\n|-------|----------|\n| Branch already exists | Check for existing worktree, offer to resume or create new |\n| Disk full | Show error, user must free space |\n| Git conflict | Show git error message, suggest manual resolution |\n| Permission denied | Show error, check directory permissions |\n\n### 2. Dependency Installation Errors\n| Error | Recovery |\n|-------|----------|\n| `bun install` fails | Show error log, offer retry button |\n| Network timeout | Show error, offer retry |\n| Lock file conflict | Show error, suggest manual resolution |\n\n### 3. Session Errors\n| Error | Recovery |\n|-------|----------|\n| OpenCode not running | Show connection error, check OpenCode status |\n| Session dies mid-setup | Detect on reconnect, create new session |\n| Slash command fails | Show error in chat, user can retry or refine |\n\n---\n\n## Error UI Components\n\n### Error Banner\n\n```tsx\n// src/components/planning/PlanningError.tsx\n\ninterface PlanningErrorProps {\n  type: 'worktree' | 'deps' | 'session' | 'general';\n  error: Error;\n  onRetry?: () =\u003e void;\n  onDismiss?: () =\u003e void;\n}\n\nexport function PlanningError({ type, error, onRetry, onDismiss }: PlanningErrorProps) {\n  const { title, suggestion } = getErrorInfo(type, error);\n  \n  return (\n    \u003cAlert variant=\"destructive\"\u003e\n      \u003cAlertCircle className=\"h-4 w-4\" /\u003e\n      \u003cAlertTitle\u003e{title}\u003c/AlertTitle\u003e\n      \u003cAlertDescription\u003e\n        \u003cp\u003e{error.message}\u003c/p\u003e\n        {suggestion \u0026\u0026 \u003cp className=\"mt-2 text-sm\"\u003e{suggestion}\u003c/p\u003e}\n        \u003cdiv className=\"mt-4 flex gap-2\"\u003e\n          {onRetry \u0026\u0026 (\n            \u003cButton size=\"sm\" onClick={onRetry}\u003e\n              \u003cRefreshCw className=\"h-4 w-4 mr-2\" /\u003e\n              Retry\n            \u003c/Button\u003e\n          )}\n          \u003cButton size=\"sm\" variant=\"outline\" onClick={onDismiss}\u003e\n            Dismiss\n          \u003c/Button\u003e\n        \u003c/div\u003e\n      \u003c/AlertDescription\u003e\n    \u003c/Alert\u003e\n  );\n}\n\nfunction getErrorInfo(type: string, error: Error) {\n  const mapping = {\n    worktree: {\n      title: 'Failed to create worktree',\n      suggestion: error.message.includes('branch') \n        ? 'A branch with this name already exists. You may need to delete it or choose a different approach.'\n        : error.message.includes('permission')\n        ? 'Check that you have write permissions to the worktree directory.'\n        : null,\n    },\n    deps: {\n      title: 'Failed to install dependencies',\n      suggestion: 'Try running `bun install` manually in the worktree directory.',\n    },\n    session: {\n      title: 'Failed to connect to OpenCode',\n      suggestion: 'Make sure OpenCode is running: `opencode serve`',\n    },\n    general: {\n      title: 'Something went wrong',\n      suggestion: null,\n    },\n  };\n  \n  return mapping[type] || mapping.general;\n}\n```\n\n---\n\n## Specific Error Handlers\n\n### Branch Already Exists\n\n```typescript\nasync function handleBranchExists(projectPath: string, branchName: string): Promise\u003c'resume' | 'new' | 'cancel'\u003e {\n  // Check if there's an existing worktree for this branch\n  const existingWorktree = await worktreeService.findWorktreeForBranch(projectPath, branchName);\n  \n  if (existingWorktree) {\n    // Prompt user: \"A planning session for this issue already exists. Resume?\"\n    return 'resume';\n  }\n  \n  // Branch exists but no worktree - ask what to do\n  // Options: Create worktree from existing branch, or create new branch with suffix\n  return 'new';\n}\n```\n\n### OpenCode Not Running\n\n```typescript\nasync function checkOpenCodeHealth(): Promise\u003c{ ok: boolean; error?: string }\u003e {\n  try {\n    // Use health endpoint if available\n    const response = await fetch('/api/health/opencode');\n    const data = await response.json();\n    return { ok: data.connected };\n  } catch (error) {\n    return { ok: false, error: 'Cannot reach OpenCode server' };\n  }\n}\n\n// In setup flow\nconst health = await checkOpenCodeHealth();\nif (!health.ok) {\n  throw new PlanningError('session', 'OpenCode is not running', {\n    suggestion: 'Start OpenCode with: opencode serve',\n    recoverable: false,\n  });\n}\n```\n\n---\n\n## Global Error Boundary\n\n```tsx\n// In planning page layout\n\nexport default function PlanningLayout({ children }) {\n  return (\n    \u003cErrorBoundary\n      fallback={({ error, resetErrorBoundary }) =\u003e (\n        \u003cdiv className=\"flex flex-col items-center justify-center h-screen p-8\"\u003e\n          \u003cAlertCircle className=\"h-12 w-12 text-destructive mb-4\" /\u003e\n          \u003ch1 className=\"text-xl font-semibold mb-2\"\u003ePlanning Error\u003c/h1\u003e\n          \u003cp className=\"text-muted-foreground mb-4\"\u003e{error.message}\u003c/p\u003e\n          \u003cButton onClick={resetErrorBoundary}\u003eTry Again\u003c/Button\u003e\n        \u003c/div\u003e\n      )}\n    \u003e\n      {children}\n    \u003c/ErrorBoundary\u003e\n  );\n}\n```\n\n---\n\n## Retry Logic\n\nImplement exponential backoff for retryable operations:\n\n```typescript\nasync function withRetry\u003cT\u003e(\n  fn: () =\u003e Promise\u003cT\u003e,\n  options: { maxAttempts: number; backoff: number }\n): Promise\u003cT\u003e {\n  let lastError: Error;\n  \n  for (let attempt = 1; attempt \u003c= options.maxAttempts; attempt++) {\n    try {\n      return await fn();\n    } catch (error) {\n      lastError = error;\n      \n      if (attempt \u003c options.maxAttempts) {\n        await delay(options.backoff * attempt);\n      }\n    }\n  }\n  \n  throw lastError;\n}\n\n// Usage\nconst sessionId = await withRetry(\n  () =\u003e openCodeService.createPlanningSession(worktreePath),\n  { maxAttempts: 3, backoff: 1000 }\n);\n```\n\n---\n\n## User-Facing Error Messages\n\nTranslate technical errors to user-friendly messages:\n\n```typescript\nfunction getUserFriendlyMessage(error: Error): string {\n  const patterns = [\n    { match: /ENOENT/, message: 'File or directory not found' },\n    { match: /EACCES/, message: 'Permission denied' },\n    { match: /ENOSPC/, message: 'Disk is full' },\n    { match: /ETIMEDOUT/, message: 'Connection timed out' },\n    { match: /fatal: A branch named .* already exists/, message: 'Branch already exists' },\n    { match: /bun install.*failed/, message: 'Failed to install dependencies' },\n  ];\n  \n  for (const { match, message } of patterns) {\n    if (match.test(error.message)) {\n      return message;\n    }\n  }\n  \n  return error.message;\n}\n```\n\n---\n\n## Files to Create\n\n- `src/components/planning/PlanningError.tsx`\n- `src/lib/utils/error-handling.ts`\n\n## Files to Modify\n\n- `src/app/project/[id]/planning/[issueNumber]/page.tsx` - Add error boundary\n- `src/components/planning/SetupProgress.tsx` - Improve error UI\n- `src/lib/services/worktree.ts` - Add specific error types\n\n---\n\n## Acceptance Criteria\n\n- [ ] Worktree creation errors show helpful messages\n- [ ] Dependency install errors offer retry\n- [ ] Session errors suggest checking OpenCode\n- [ ] Branch conflict offers resume or create new\n- [ ] Disk full error is clear\n- [ ] Permission denied error suggests fix\n- [ ] Error boundary catches unexpected errors\n- [ ] All errors are user-friendly (no raw stack traces)\n\n---\n\n## Testing Notes\n\n- Test each error scenario manually\n- Test retry logic with flaky operations\n- Test error boundary with thrown errors\n- Verify error messages are helpful","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:12:59.393545-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.20","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:12:59.395881-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.20","depends_on_id":"maestro-g88.4","type":"blocks","created_at":"2025-12-30T23:15:09.997732-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.20","depends_on_id":"maestro-g88.7","type":"blocks","created_at":"2025-12-30T23:15:10.033826-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.21","title":"Phase 7.2: Mobile Responsiveness and Touch Optimization","description":"## Task Overview\n\nEnsure the planning mode feature works flawlessly on mobile devices, with proper touch targets, responsive layouts, and mobile-specific UX patterns.\n\n---\n\n## Background \u0026 Context\n\nFrom GH Issue #6:\n\n\u003e **Mobile Layout (\u003c 1024px)**\n\u003e On mobile (\u003c 1024px), use a tabbed interface similar to the existing issue page:\n\u003e - **Tab 1: \"Setup/Chat\"** - Shows setup progress and chat interface\n\u003e - **Tab 2: \"Plan\"** - Shows the plan UI (list view, since graph is hard on mobile)\n\u003e - Unread indicator dot on Plan tab when changes occur during chat\n\n---\n\n## Mobile Layout Implementation\n\n### Tabbed Interface\n\n```tsx\n// Planning page mobile view\n\nfunction PlanningPageMobile({ projectId, issueNumber, issueTitle }) {\n  const [activeTab, setActiveTab] = useState\u003c'chat' | 'plan'\u003e('chat');\n  const { beads, isConnected } = useBeadsWatch(projectId, issueNumber);\n  const [lastSeenBeadsCount, setLastSeenBeadsCount] = useState(0);\n  \n  const hasUnseenChanges = beads.length !== lastSeenBeadsCount \u0026\u0026 activeTab === 'chat';\n  \n  useEffect(() =\u003e {\n    if (activeTab === 'plan') {\n      setLastSeenBeadsCount(beads.length);\n    }\n  }, [activeTab, beads.length]);\n  \n  return (\n    \u003cdiv className=\"flex flex-col h-screen\"\u003e\n      {/* Header */}\n      \u003cPlanningHeader projectId={projectId} issueNumber={issueNumber} /\u003e\n      \n      {/* Tab Bar */}\n      \u003cdiv className=\"flex border-b\"\u003e\n        \u003cbutton\n          className={cn(\n            \"flex-1 py-3 text-sm font-medium\",\n            activeTab === 'chat' \u0026\u0026 \"border-b-2 border-primary\"\n          )}\n          onClick={() =\u003e setActiveTab('chat')}\n        \u003e\n          Setup/Chat\n        \u003c/button\u003e\n        \u003cbutton\n          className={cn(\n            \"flex-1 py-3 text-sm font-medium relative\",\n            activeTab === 'plan' \u0026\u0026 \"border-b-2 border-primary\"\n          )}\n          onClick={() =\u003e setActiveTab('plan')}\n        \u003e\n          Plan\n          {hasUnseenChanges \u0026\u0026 (\n            \u003cspan className=\"absolute top-2 right-[calc(50%-20px)] h-2 w-2 rounded-full bg-blue-500\" /\u003e\n          )}\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \n      {/* Tab Content */}\n      \u003cdiv className=\"flex-1 overflow-hidden\"\u003e\n        {activeTab === 'chat' ? (\n          \u003cPlanningLeftPane {...props} /\u003e\n        ) : (\n          \u003cPlanningRightPane {...props} /\u003e\n        )}\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Touch Target Sizing\n\nEnsure all interactive elements are at least 44x44px:\n\n```css\n/* In globals.css or component styles */\n\n@media (pointer: coarse) {\n  .bead-row {\n    min-height: 48px;\n    padding: 12px;\n  }\n  \n  .touch-target {\n    min-width: 44px;\n    min-height: 44px;\n  }\n}\n```\n\n```tsx\n// Ensure buttons have adequate tap targets\n\n\u003cButton className=\"h-11 min-w-[44px]\" ...\u003e\n  \u003cIcon className=\"h-5 w-5\" /\u003e\n\u003c/Button\u003e\n```\n\n---\n\n## Mobile-Specific Adjustments\n\n### 1. BeadsList on Mobile\n\n- Larger tap targets for expand/collapse\n- Swipe actions (future: swipe to view details)\n- Bottom sheet for detail panel instead of side panel\n\n```tsx\n// On mobile, detail panel becomes a bottom sheet\n{isMobile \u0026\u0026 selectedBead \u0026\u0026 (\n  \u003cSheet open={!!selectedBead} onOpenChange={() =\u003e setSelectedBead(null)}\u003e\n    \u003cSheetContent side=\"bottom\" className=\"h-[70vh]\"\u003e\n      \u003cBeadDetail bead={selectedBead} ... /\u003e\n    \u003c/SheetContent\u003e\n  \u003c/Sheet\u003e\n)}\n```\n\n### 2. Chat Input on Mobile\n\n- Full-width input\n- Send button always visible (not icon-only)\n- Auto-scroll on keyboard open\n\n```tsx\n\u003cdiv className=\"fixed bottom-0 left-0 right-0 p-2 bg-background border-t safe-area-inset-bottom\"\u003e\n  \u003cdiv className=\"flex gap-2\"\u003e\n    \u003cInput \n      className=\"flex-1\" \n      placeholder=\"Type a message...\" \n      autoComplete=\"off\"\n    /\u003e\n    \u003cButton\u003eSend\u003c/Button\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n### 3. Setup Progress on Mobile\n\n- Full-screen overlay during initial setup\n- Clear progress indicators\n- Accessible retry buttons\n\n---\n\n## Responsive Breakpoint\n\nUse consistent breakpoint:\n\n```tsx\n// Custom hook\nfunction useIsMobile() {\n  const [isMobile, setIsMobile] = useState(false);\n  \n  useEffect(() =\u003e {\n    const check = () =\u003e setIsMobile(window.innerWidth \u003c 1024);\n    check();\n    window.addEventListener('resize', check);\n    return () =\u003e window.removeEventListener('resize', check);\n  }, []);\n  \n  return isMobile;\n}\n\n// In component\nconst isMobile = useIsMobile();\n\nreturn isMobile ? \u003cMobileLayout /\u003e : \u003cDesktopLayout /\u003e;\n```\n\n---\n\n## Safe Area Insets\n\nHandle notch/home indicator on modern phones:\n\n```css\n.safe-area-inset-bottom {\n  padding-bottom: env(safe-area-inset-bottom, 0);\n}\n\n.safe-area-inset-top {\n  padding-top: env(safe-area-inset-top, 0);\n}\n```\n\n---\n\n## Viewport Height Fix\n\nHandle mobile browser chrome (URL bar):\n\n```tsx\n// In layout or page\nuseEffect(() =\u003e {\n  function setVh() {\n    const vh = window.innerHeight * 0.01;\n    document.documentElement.style.setProperty('--vh', `${vh}px`);\n  }\n  \n  setVh();\n  window.addEventListener('resize', setVh);\n  return () =\u003e window.removeEventListener('resize', setVh);\n}, []);\n```\n\n```css\n.h-screen-mobile {\n  height: calc(var(--vh, 1vh) * 100);\n}\n```\n\n---\n\n## Files to Modify\n\n- `src/app/project/[id]/planning/[issueNumber]/page.tsx` - Add mobile layout\n- `src/components/planning/BeadsList.tsx` - Mobile touch targets\n- `src/components/planning/BeadDetail.tsx` - Bottom sheet variant\n- `src/components/planning/PlanningChat.tsx` - Mobile input\n\n---\n\n## Acceptance Criteria\n\n- [ ] Tabbed interface at \u003c 1024px\n- [ ] Unread indicator on Plan tab\n- [ ] Touch targets minimum 44px\n- [ ] Bottom sheet for bead details on mobile\n- [ ] Chat input fixed at bottom with safe area\n- [ ] No layout shift on keyboard open\n- [ ] Works at 320px viewport width\n- [ ] Works on iOS Safari (notch handling)\n- [ ] Works on Android Chrome\n\n---\n\n## Testing Notes\n\n- Test on real devices (not just DevTools)\n- Test iPhone SE (small screen)\n- Test iPad in portrait (near breakpoint)\n- Test with keyboard open\n- Test with screen reader","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:13:39.321523-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.21","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:13:39.324027-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.21","depends_on_id":"maestro-g88.14","type":"blocks","created_at":"2025-12-30T23:15:10.067427-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.21","depends_on_id":"maestro-g88.16","type":"blocks","created_at":"2025-12-30T23:15:10.10162-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.22","title":"Phase 7.3: End-to-End Testing and Final Polish","description":"## Task Overview\n\nComprehensive end-to-end testing of the planning mode feature, covering all user flows, edge cases, and final polish items.\n\n---\n\n## Test Scenarios\n\n### Happy Path: Fresh Start\n\n1. Navigate to issue page with GitHub issue loaded\n2. Click 'Start Planning' button\n3. Confirm in modal\n4. Observe setup progress (worktree → deps → session → initial planning)\n5. See beads appear in list as AI creates them\n6. Select a bead, view details\n7. Chat about a bead ('Break this into smaller tasks')\n8. Observe bead updates in real-time\n9. Navigate away and back - session should resume\n\n### Resume Path: Existing Session\n\n1. Navigate directly to /project/{id}/planning/{issueNumber}\n2. Should detect existing worktree/session\n3. Skip setup steps\n4. Load existing beads\n5. Chat should work immediately\n\n### Recovery Path: Dead Session\n\n1. Stop OpenCode server while on planning page\n2. Try to send a message (should fail gracefully)\n3. Restart OpenCode\n4. Page should recover (create new session)\n5. Beads should still be intact\n\n### Error Path: Various Failures\n\n1. Test with branch that already exists\n2. Test with disk full (simulate)\n3. Test with no network (deps install fail)\n4. Test with OpenCode not running\n\n---\n\n## Manual Test Checklist\n\n### Entry Point\n- [ ] Button visible only when GitHub issue is loaded\n- [ ] Button disabled state is clear\n- [ ] Modal explains what will happen\n- [ ] Cancel closes modal without side effects\n\n### Setup Progress\n- [ ] All 4 steps show correctly\n- [ ] Duration shows for completed steps\n- [ ] Error state shows retry option\n- [ ] Progress is live (not static)\n\n### Plan UI (List View)\n- [ ] Tree renders with proper hierarchy\n- [ ] Expand/collapse works\n- [ ] Selection highlights correctly\n- [ ] Status icons are correct colors\n- [ ] Priority badges show for non-default\n\n### Detail Panel\n- [ ] Shows all bead information\n- [ ] Status dropdown updates bead\n- [ ] Priority dropdown updates bead\n- [ ] Markdown description renders\n- [ ] Dependencies shown correctly\n- [ ] 'Chat about this' sets context\n- [ ] Delete shows confirmation\n\n### Chat\n- [ ] Messages send and receive\n- [ ] SSE streaming works\n- [ ] Tool executions render\n- [ ] Context indicator shows\n- [ ] Slash command suggestions work\n\n### Mobile\n- [ ] Tabs switch correctly\n- [ ] Unread indicator appears\n- [ ] Touch targets are adequate\n- [ ] Bottom sheet for details\n- [ ] Keyboard doesn't break layout\n\n### Resume/Recovery\n- [ ] Page reload resumes session\n- [ ] Dead session detected\n- [ ] New session created on recovery\n- [ ] Beads preserved after recovery\n\n---\n\n## Performance Testing\n\n- [ ] Setup SSE doesn't leak resources\n- [ ] Beads file watcher doesn't leak\n- [ ] Chat SSE doesn't accumulate\n- [ ] Memory usage reasonable after extended use\n- [ ] No unnecessary re-renders\n\n---\n\n## Accessibility Testing\n\n- [ ] All buttons keyboard accessible\n- [ ] Focus management on modal open/close\n- [ ] Screen reader announces status changes\n- [ ] Color contrast meets WCAG AA\n- [ ] No focus traps\n\n---\n\n## Browser Testing\n\n- [ ] Chrome (latest)\n- [ ] Firefox (latest)\n- [ ] Safari (latest)\n- [ ] Mobile Safari (iOS)\n- [ ] Mobile Chrome (Android)\n\n---\n\n## Final Polish Items\n\n1. **Loading states**: All async operations show loading\n2. **Empty states**: Clear messaging when no data\n3. **Transitions**: Smooth animations where appropriate\n4. **Error messages**: All errors are user-friendly\n5. **Cleanup**: No console errors or warnings\n\n---\n\n## Documentation\n\n- [ ] Update SCOPE.md if architecture changed\n- [ ] Code comments on complex logic\n- [ ] Type exports for external use\n\n---\n\n## Acceptance Criteria\n\n- [ ] All happy path scenarios pass\n- [ ] All error scenarios handled gracefully\n- [ ] Works across all target browsers\n- [ ] Mobile experience is polished\n- [ ] No accessibility violations\n- [ ] No console errors in normal operation\n- [ ] Performance is acceptable\n\n---\n\n## Dependencies\n\n- Requires: All previous tasks completed\n\n---\n\n## Notes\n\nThis is the final task before the feature is considered complete. Take time to test thoroughly and fix any issues discovered.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T23:14:11.316071-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.22","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:14:11.318352-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.22","depends_on_id":"maestro-g88.20","type":"blocks","created_at":"2025-12-30T23:15:10.135738-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.22","depends_on_id":"maestro-g88.21","type":"blocks","created_at":"2025-12-30T23:15:10.169818-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.22","depends_on_id":"maestro-g88.18","type":"blocks","created_at":"2025-12-30T23:15:10.204225-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.22","depends_on_id":"maestro-g88.17","type":"blocks","created_at":"2025-12-30T23:15:10.23837-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.23","title":"Phase 5.0: Create Planning Chat API Endpoint","description":"## Task Overview\n\nCreate the `/api/projects/{id}/planning/{issueNumber}/chat` endpoint that handles sending messages to the planning session with SSE streaming responses.\n\n---\n\n## Background \u0026 Context\n\nThe planning page needs a way to send chat messages and receive streaming responses. This is the API counterpart to the PlanningChat UI component (Task 5.1).\n\nUnlike the regular issue chat, planning chat:\n1. Uses full tool access (bash, write, edit)\n2. Operates in the worktree directory context\n3. May include bead context injection\n\n---\n\n## API Endpoint\n\n### POST `/api/projects/{id}/planning/{issueNumber}/chat`\n\n**Request Body:**\n```json\n{\n  \"message\": \"Break this task into smaller pieces\",\n  \"beadContext\": {\n    \"id\": \"maestro-g88.1\",\n    \"title\": \"Add Start Planning Button\"\n  }\n}\n```\n\n**Response:** SSE stream (same format as existing issue chat)\n\n---\n\n## Implementation\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/chat/route.ts\n\nimport { sessionStorage } from '@/lib/services/sessions';\nimport { openCodeService } from '@/lib/services/opencode';\nimport { configService } from '@/lib/services/config';\n\nexport async function POST(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const { message, beadContext } = await request.json();\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  // Validate project exists\n  const project = await configService.getProject(projectId);\n  if (!project) {\n    return Response.json({ error: 'Project not found' }, { status: 404 });\n  }\n  \n  // Get planning session (uses getPlanningSession from Task 2.2)\n  const session = await sessionStorage.getPlanningSession(projectId, issueNumber);\n  if (!session) {\n    return Response.json({ error: 'No planning session found' }, { status: 404 });\n  }\n  \n  // Build message with optional bead context\n  const fullMessage = beadContext \n    ? buildContextualMessage(message, beadContext)\n    : message;\n  \n  // Stream response using streamPlanningResponse from Task 2.3\n  // NOTE: Method name is streamPlanningResponse, NOT streamMessageWithFullAccess\n  const stream = await openCodeService.streamPlanningResponse(\n    session.worktreePath,\n    session.sessionId,\n    fullMessage\n  );\n  \n  return new Response(stream, {\n    headers: {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n    },\n  });\n}\n\nfunction buildContextualMessage(message: string, beadContext: { id: string; title: string }): string {\n  return `[Context: Working on bead \"${beadContext.title}\" (ID: ${beadContext.id})]\n\nUser request: ${message}`;\n}\n```\n\n---\n\n## Error Handling\n\n```typescript\n// Handle common errors\ntry {\n  const stream = await openCodeService.streamPlanningResponse(...);\n  return new Response(stream, { ... });\n} catch (error) {\n  if (error.message.includes('session not found')) {\n    return Response.json({ \n      error: 'Session expired', \n      code: 'SESSION_EXPIRED' \n    }, { status: 410 });\n  }\n  \n  if (error.message.includes('ECONNREFUSED')) {\n    return Response.json({ \n      error: 'OpenCode is not running', \n      code: 'OPENCODE_UNAVAILABLE' \n    }, { status: 503 });\n  }\n  \n  throw error;\n}\n```\n\n---\n\n## Files to Create\n\n- `src/app/api/projects/[id]/planning/[issueNumber]/chat/route.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] Endpoint accepts POST with message body\n- [ ] Returns SSE stream of response parts\n- [ ] Uses worktree path as context directory (from session.worktreePath)\n- [ ] Supports optional bead context injection\n- [ ] Uses `streamPlanningResponse` method from OpenCode service (Task 2.3)\n- [ ] Uses `getPlanningSession` method from session storage (Task 2.2)\n- [ ] Handles missing project gracefully (404)\n- [ ] Handles missing session gracefully (404)\n- [ ] Handles OpenCode errors gracefully (503)\n\n---\n\n## Dependencies\n\n- Requires: Extended Session Storage (2.2) - for `getPlanningSession`\n- Requires: Extended OpenCode Service (2.3) - for `streamPlanningResponse`\n\n---\n\n## Testing Notes\n\n- Test sending message without bead context\n- Test sending message with bead context\n- Test with expired/dead session\n- Verify SSE streaming works correctly\n- Test with OpenCode not running","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T07:46:27.895634-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.23","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-31T07:46:27.897869-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.23","depends_on_id":"maestro-g88.5","type":"blocks","created_at":"2025-12-31T07:46:32.088677-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.23","depends_on_id":"maestro-g88.6","type":"blocks","created_at":"2025-12-31T07:46:32.126364-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.3","title":"Phase 1.3: Create Planning Page Route and Basic Layout","description":"## Task Overview\n\nCreate the planning page route and implement the basic split-pane layout structure that will house the setup progress, chat, and plan visualization.\n\n---\n\n## Background \u0026 Context\n\nThe planning page is the main workspace for the planning workflow. It needs to support:\n1. Setup progress display (during initial setup)\n2. Chat interface (for refinement conversations)\n3. Plan visualization (list/graph of beads)\n4. Detail panel (for viewing/editing selected beads)\n\nThis task establishes the page structure and layout. Subsequent tasks will implement the individual components.\n\n---\n\n## Route Structure\n\n```\n/project/{id}/planning/{issueNumber}\n```\n\nFile path: `src/app/project/[id]/planning/[issueNumber]/page.tsx`\n\n---\n\n## Layout Design\n\n### Desktop Layout (\u003e= 1024px)\n\nSplit-pane layout with resizable divider:\n```\n┌─────────────────────────────┬─────────────────────────────┐\n│  LEFT PANE (40%)            │  RIGHT PANE (60%)           │\n│                             │                             │\n│  [Setup Progress Section]   │  [View Toggle: List | Graph]│\n│  ─────────────────────────  │  ─────────────────────────  │\n│  [Chat Section]             │  [Plan Visualization]       │\n│                             │  ─────────────────────────  │\n│                             │  [Detail Panel]             │\n│                             │                             │\n└─────────────────────────────┴─────────────────────────────┘\n```\n\n- Initial split: 40% left, 60% right\n- Resizable via drag handle (follow Issue page pattern)\n- Minimum widths to prevent unusable panes\n\n### Mobile Layout (\u003c 1024px)\n\nTabbed interface:\n```\n┌─────────────────────────────────────────────────────────┐\n│  [Setup/Chat Tab] [Plan Tab •]                          │\n├─────────────────────────────────────────────────────────┤\n│                                                         │\n│  [Active Tab Content]                                   │\n│                                                         │\n└─────────────────────────────────────────────────────────┘\n```\n\n- Tab 1: 'Setup/Chat' - shows setup progress and chat\n- Tab 2: 'Plan' - shows list view and detail panel\n- Unread indicator (•) on Plan tab when beads change while viewing Chat\n\n---\n\n## Component Structure\n\n```\npage.tsx\n├── PlanningHeader (breadcrumb, issue title, actions)\n├── \u003cDesktop: Split Pane\u003e\n│   ├── LeftPane\n│   │   ├── SetupProgress (placeholder)\n│   │   └── ChatSection (placeholder)\n│   └── RightPane\n│       ├── ViewToggle (placeholder)\n│       ├── PlanVisualization (placeholder)\n│       └── DetailPanel (placeholder)\n└── \u003cMobile: Tabs\u003e\n    ├── Tab 'Setup/Chat'\n    │   ├── SetupProgress (placeholder)\n    │   └── ChatSection (placeholder)\n    └── Tab 'Plan'\n        ├── PlanVisualization (placeholder)\n        └── DetailPanel (placeholder)\n```\n\nInitial implementation uses placeholder components that display 'Coming soon' or similar. Real components are implemented in later tasks.\n\n---\n\n## Header Design\n\nThe header should display:\n- Breadcrumb: Project Name \u003e Planning \u003e Issue #N\n- Issue title (truncated if long)\n- Actions: Back to Issue, Help/Info\n\n---\n\n## State Management\n\nThis task creates the basic structure. State management will be added in later tasks, but consider:\n- Selected bead ID\n- Current tab (mobile)\n- Setup status\n- Pane sizes\n\nCreate a custom hook `usePlanningSession` that will eventually manage this state.\n\n---\n\n## Files to Create\n\n- `src/app/project/[id]/planning/[issueNumber]/page.tsx`\n- `src/components/planning/PlanningHeader.tsx`\n- `src/components/planning/PlanningLeftPane.tsx`\n- `src/components/planning/PlanningRightPane.tsx`\n\n---\n\n## Patterns to Follow\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx` - Split pane with resize\n- Existing mobile tab patterns in the codebase\n- shadcn `Tabs` component for mobile view\n\n---\n\n## Acceptance Criteria\n\n- [ ] Route `/project/{id}/planning/{issueNumber}` renders correctly\n- [ ] Desktop layout shows split-pane with resizable divider\n- [ ] Mobile layout shows tabbed interface\n- [ ] Header displays breadcrumb and issue info\n- [ ] Placeholder components render in correct positions\n- [ ] Responsive breakpoint at lg: (1024px)\n- [ ] Navigation from confirmation modal lands on this page\n\n---\n\n## Testing Notes\n\n- Test resize behavior on desktop\n- Test tab switching on mobile\n- Verify layout at exact 1024px breakpoint\n- Test with very long issue titles (should truncate)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:01:16.698616-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.3","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:01:16.700892-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.3","depends_on_id":"maestro-g88.2","type":"blocks","created_at":"2025-12-30T23:14:38.653668-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.4","title":"Phase 2.1: Create WorktreeService - Core Infrastructure","description":"## Task Overview\n\nCreate the `WorktreeService` that manages git worktree lifecycle for planning sessions. This is foundational infrastructure that other components depend on.\n\n---\n\n## Background \u0026 Context\n\n### Why Git Worktrees?\n\nGit worktrees allow multiple working directories to share a single git repository. For planning mode, this provides:\n\n1. **Isolation**: Planning changes don't pollute the main working directory\n2. **Parallel safety**: User or other agents can continue working in main repo\n3. **Clean branches**: Each worktree has its own branch, perfect for feature work\n4. **Easy cleanup**: Delete worktree without affecting main repo\n\n### Directory Structure\n\n```\n~/.maestro/\n├── config.json              # Project configurations\n├── sessions.json            # Session mappings\n├── worktree-metadata/       # Worktree metadata (CENTRALIZED, not in worktrees)\n│   └── {project-slug}/\n│       └── issue-{number}.json\n└── worktrees/               # Actual worktree directories\n    └── {project-slug}/\n        └── issue-{number}/\n            ├── .git           # Worktree git link (auto-created by git)\n            ├── node_modules/  # After deps install\n            └── ...            # Project files\n```\n\n**Why separate metadata?** Storing metadata inside the worktree could cause git issues (untracked files). Centralized metadata is cleaner and easier to manage.\n\n### Project Slug Derivation\n\nTo create unique, filesystem-safe paths:\n1. Get git remote URL: `git remote get-url origin`\n2. Extract repo name: `github.com/user/my-repo` → `my-repo`\n3. Fallback: Use directory basename if no remote\n\n---\n\n## Implementation Details\n\n### Service Interface\n\n```typescript\n// src/lib/services/worktree.ts\n\nexport interface WorktreeInfo {\n  path: string;           // Full path to worktree\n  branch: string;         // Branch name (e.g., 'feature/issue-6-planning-mode')\n  issueNumber: number;\n  projectPath: string;    // Original project path\n  createdAt: string;      // ISO timestamp\n  depsInstalled: boolean; // Whether node_modules exists\n}\n\nexport class WorktreeService {\n  private baseDir = path.join(os.homedir(), '.maestro', 'worktrees');\n  private metadataDir = path.join(os.homedir(), '.maestro', 'worktree-metadata');\n  \n  // Core operations\n  async createWorktree(projectPath: string, issueNumber: number, issueTitle: string): Promise\u003cWorktreeInfo\u003e;\n  async getWorktree(projectPath: string, issueNumber: number): Promise\u003cWorktreeInfo | null\u003e;\n  async deleteWorktree(projectPath: string, issueNumber: number): Promise\u003cvoid\u003e;\n  \n  // Status checks\n  async worktreeExists(projectPath: string, issueNumber: number): Promise\u003cboolean\u003e;\n  async areDepsInstalled(projectPath: string, issueNumber: number): Promise\u003cboolean\u003e;\n  \n  // Markers\n  async markDepsInstalled(projectPath: string, issueNumber: number): Promise\u003cvoid\u003e;\n  \n  // Utilities\n  async getProjectSlug(projectPath: string): Promise\u003cstring\u003e;\n  async getWorktreePath(projectPath: string, issueNumber: number): Promise\u003cstring\u003e;\n  getBranchName(issueNumber: number, issueTitle: string): string;\n  \n  // Git helpers (REQUIRED - used in createWorktree)\n  async getDefaultBranch(projectPath: string): Promise\u003cstring\u003e;\n  async branchExists(projectPath: string, branchName: string): Promise\u003cboolean\u003e;\n  async findWorktreeForBranch(projectPath: string, branchName: string): Promise\u003cWorktreeInfo | null\u003e;\n  \n  // Internal\n  private async getMetadataPath(projectPath: string, issueNumber: number): Promise\u003cstring\u003e;\n  private async storeWorktreeMetadata(info: WorktreeInfo): Promise\u003cvoid\u003e;\n  private async loadWorktreeMetadata(projectPath: string, issueNumber: number): Promise\u003cWorktreeInfo | null\u003e;\n}\n```\n\n### Git Helper Implementations\n\n```typescript\n/**\n * Get the default branch for a repository (usually 'main' or 'master')\n */\nasync getDefaultBranch(projectPath: string): Promise\u003cstring\u003e {\n  try {\n    // Try to get from remote HEAD\n    const { stdout } = await execAsync(\n      'git symbolic-ref refs/remotes/origin/HEAD --short',\n      { cwd: projectPath }\n    );\n    // Returns something like 'origin/main', extract just 'main'\n    return stdout.trim().replace('origin/', '');\n  } catch {\n    // Fallback: check if 'main' or 'master' exists\n    try {\n      await execAsync('git rev-parse --verify main', { cwd: projectPath });\n      return 'main';\n    } catch {\n      return 'master';\n    }\n  }\n}\n\n/**\n * Check if a branch exists in the repository\n */\nasync branchExists(projectPath: string, branchName: string): Promise\u003cboolean\u003e {\n  try {\n    await execAsync(`git rev-parse --verify ${branchName}`, { cwd: projectPath });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Find an existing worktree for a given branch\n */\nasync findWorktreeForBranch(projectPath: string, branchName: string): Promise\u003cWorktreeInfo | null\u003e {\n  try {\n    const { stdout } = await execAsync('git worktree list --porcelain', { cwd: projectPath });\n    const lines = stdout.split('\\n');\n    \n    for (let i = 0; i \u003c lines.length; i++) {\n      if (lines[i].startsWith('worktree ')) {\n        const worktreePath = lines[i].replace('worktree ', '');\n        // Check next few lines for branch info\n        const branchLine = lines.slice(i, i + 5).find(l =\u003e l.startsWith('branch '));\n        if (branchLine \u0026\u0026 branchLine.includes(branchName)) {\n          // Found it - load metadata\n          const slug = await this.getProjectSlug(projectPath);\n          const issueMatch = worktreePath.match(/issue-(\\d+)/);\n          if (issueMatch) {\n            return this.loadWorktreeMetadata(projectPath, parseInt(issueMatch[1]));\n          }\n        }\n      }\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n```\n\n### Branch Naming\n\n```typescript\ngetBranchName(issueNumber: number, issueTitle: string): string {\n  // Slugify title: 'Planning Mode Feature' → 'planning-mode-feature'\n  const slug = issueTitle\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-|-$/g, '')\n    .substring(0, 50); // Limit length\n  \n  return `feature/issue-${issueNumber}-${slug}`;\n}\n```\n\n### Worktree Creation Flow\n\n```typescript\nasync createWorktree(projectPath: string, issueNumber: number, issueTitle: string): Promise\u003cWorktreeInfo\u003e {\n  const slug = await this.getProjectSlug(projectPath);\n  const worktreePath = path.join(this.baseDir, slug, `issue-${issueNumber}`);\n  const branchName = this.getBranchName(issueNumber, issueTitle);\n  \n  // 1. Ensure parent directories exist\n  await fs.mkdir(path.dirname(worktreePath), { recursive: true });\n  await fs.mkdir(path.join(this.metadataDir, slug), { recursive: true });\n  \n  // 2. Get default branch name\n  const defaultBranch = await this.getDefaultBranch(projectPath);\n  \n  // 3. Check if branch already exists\n  const branchAlreadyExists = await this.branchExists(projectPath, branchName);\n  \n  if (branchAlreadyExists) {\n    // Check if worktree already exists for this branch\n    const existingWorktree = await this.findWorktreeForBranch(projectPath, branchName);\n    if (existingWorktree) {\n      // Resume existing worktree\n      return existingWorktree;\n    }\n    // Create worktree from existing branch\n    await execAsync(`git worktree add \"${worktreePath}\" ${branchName}`, { cwd: projectPath });\n  } else {\n    // Create new branch and worktree\n    await execAsync(`git worktree add -b ${branchName} \"${worktreePath}\" ${defaultBranch}`, { cwd: projectPath });\n  }\n  \n  // 4. Store metadata (in centralized location, not in worktree)\n  const info: WorktreeInfo = {\n    path: worktreePath,\n    branch: branchName,\n    issueNumber,\n    projectPath,\n    createdAt: new Date().toISOString(),\n    depsInstalled: false,\n  };\n  \n  await this.storeWorktreeMetadata(info);\n  \n  return info;\n}\n```\n\n### Metadata Storage\n\nStore worktree metadata in `~/.maestro/worktree-metadata/{slug}/issue-{number}.json`:\n\n```json\n{\n  \"path\": \"/Users/erik/.maestro/worktrees/maestro/issue-6\",\n  \"branch\": \"feature/issue-6-planning-mode\",\n  \"issueNumber\": 6,\n  \"projectPath\": \"/Users/erik/dev/maestro\",\n  \"createdAt\": \"2024-01-15T10:30:00.000Z\",\n  \"depsInstalled\": true\n}\n```\n\n---\n\n## Error Handling\n\n### Conflict Scenarios\n\n| Scenario | Detection | Resolution |\n|----------|-----------|------------|\n| Branch exists, worktree exists | Check `git worktree list` | Return existing worktree |\n| Branch exists, no worktree | Check branch list | Create worktree from branch |\n| Branch merged/deleted | Try checkout, catch error | Offer to create fresh branch |\n| Worktree path occupied | Check `fs.exists` | Error with clear message |\n| No git repo | Check `.git` exists | Error: 'Not a git repository' |\n\n### Error Types\n\n```typescript\nexport class WorktreeError extends Error {\n  constructor(\n    message: string,\n    public code: 'NOT_GIT_REPO' | 'BRANCH_CONFLICT' | 'PATH_OCCUPIED' | 'GIT_ERROR',\n    public details?: string\n  ) {\n    super(message);\n    this.name = 'WorktreeError';\n  }\n}\n```\n\n---\n\n## Files to Create\n\n- `src/lib/services/worktree.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] `createWorktree` creates worktree with correct branch naming\n- [ ] `getWorktree` returns info for existing worktree or null\n- [ ] `worktreeExists` correctly detects existing worktrees\n- [ ] `deleteWorktree` cleans up worktree, branch, and metadata\n- [ ] Branch naming follows `feature/issue-{n}-{slug}` pattern\n- [ ] Project slug derived from git remote or directory name\n- [ ] Handles branch-already-exists case gracefully\n- [ ] Metadata stored in centralized location (not in worktree)\n- [ ] `getDefaultBranch` correctly detects main/master\n- [ ] `branchExists` correctly checks branch existence\n- [ ] `findWorktreeForBranch` finds existing worktrees\n- [ ] Proper error handling with clear error codes\n\n---\n\n## Testing Notes\n\n- Test with fresh project (no existing worktrees)\n- Test resuming existing worktree\n- Test branch name slugification edge cases\n- Test with projects that have no git remote\n- Test cleanup (worktree deletion + metadata cleanup)\n- Test with repos using 'main' vs 'master' as default branch","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T23:02:05.342059-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.4","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:02:05.344659-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.5","title":"Phase 2.2: Extend Session Storage for Planning Sessions","description":"## Task Overview\n\nExtend the existing session storage service to support planning sessions, which have additional metadata compared to regular discussion sessions.\n\n---\n\n## Background \u0026 Context\n\nThe current session storage (`src/lib/services/sessions.ts`) uses an **array-based storage** pattern (not key-value) stored in `~/.maestro/sessions.json`:\n\n```typescript\ninterface SessionStore {\n  version: 1;\n  mappings: SessionMapping[];  // Array, not a key-value map\n}\n```\n\nFor planning sessions, we need to extend SessionMapping with additional fields.\n\n---\n\n## Current Implementation\n\n```typescript\ninterface SessionMapping {\n  projectId: string;       // Project UUID (from Maestro config)\n  projectPath: string;     // Project absolute path (for verification)\n  issueNumber: number;     // GitHub issue number  \n  sessionId: string;       // OpenCode session ID\n  createdAt: string;       // ISO timestamp\n  lastAccessedAt: string;  // ISO timestamp\n}\n```\n\n---\n\n## Extended Interface\n\n```typescript\nexport type SessionType = 'discussion' | 'planning';\n\nexport interface SessionMapping {\n  projectId: string;\n  projectPath: string;\n  issueNumber: number;\n  sessionId: string;\n  sessionType: SessionType;           // NEW - defaults to 'discussion' for backwards compat\n  worktreePath?: string;              // NEW - only for planning sessions\n  createdAt: string;\n  lastAccessedAt: string;\n}\n\n// Helper type for planning sessions\nexport interface PlanningSessionMapping extends SessionMapping {\n  sessionType: 'planning';\n  worktreePath: string;  // Required for planning\n}\n```\n\n---\n\n## API Extensions\n\n### IMPORTANT: Maintain Backward Compatibility\n\nThe existing `saveSession` method signature MUST remain unchanged for backward compatibility:\n\n```typescript\n// EXISTING - DO NOT CHANGE\nasync saveSession(\n  projectId: string,\n  projectPath: string,\n  issueNumber: number,\n  sessionId: string\n): Promise\u003cSessionMapping\u003e\n```\n\nAdd a NEW method for planning sessions:\n\n```typescript\n// NEW METHOD for planning sessions\nasync savePlanningSession(\n  projectId: string,\n  projectPath: string,\n  issueNumber: number,\n  sessionId: string,\n  worktreePath: string\n): Promise\u003cPlanningSessionMapping\u003e {\n  const store = await this.readStore();\n  const now = new Date().toISOString();\n  \n  // Find existing planning session for this issue\n  const existingIndex = store.mappings.findIndex(\n    (m) =\u003e m.projectId === projectId \u0026\u0026 \n           m.issueNumber === issueNumber \u0026\u0026\n           m.sessionType === 'planning'\n  );\n  \n  const mapping: PlanningSessionMapping = {\n    projectId,\n    projectPath,\n    issueNumber,\n    sessionId,\n    sessionType: 'planning',\n    worktreePath,\n    createdAt: existingIndex \u003e= 0 ? store.mappings[existingIndex].createdAt : now,\n    lastAccessedAt: now,\n  };\n  \n  if (existingIndex \u003e= 0) {\n    store.mappings[existingIndex] = mapping;\n  } else {\n    store.mappings.push(mapping);\n  }\n  \n  await this.writeStore(store);\n  return mapping;\n}\n```\n\n### Updated Query Methods\n\n```typescript\nclass SessionStorageService {\n  // Existing method - add sessionType filter for backwards compatibility\n  async getSession(projectId: string, issueNumber: number): Promise\u003cSessionMapping | null\u003e {\n    const store = await this.readStore();\n    return store.mappings.find(\n      (m) =\u003e m.projectId === projectId \u0026\u0026 \n             m.issueNumber === issueNumber \u0026\u0026\n             (m.sessionType === 'discussion' || !m.sessionType)  // Default to discussion\n    ) ?? null;\n  }\n  \n  // NEW: Get planning session specifically\n  async getPlanningSession(projectId: string, issueNumber: number): Promise\u003cPlanningSessionMapping | null\u003e {\n    const store = await this.readStore();\n    const session = store.mappings.find(\n      (m) =\u003e m.projectId === projectId \u0026\u0026 \n             m.issueNumber === issueNumber \u0026\u0026\n             m.sessionType === 'planning'\n    );\n    return session as PlanningSessionMapping | null;\n  }\n  \n  // NEW: List all planning sessions for a project\n  async listPlanningSessions(projectId: string): Promise\u003cPlanningSessionMapping[]\u003e {\n    const store = await this.readStore();\n    return store.mappings.filter(\n      (m) =\u003e m.projectId === projectId \u0026\u0026 m.sessionType === 'planning'\n    ) as PlanningSessionMapping[];\n  }\n}\n```\n\n---\n\n## Backwards Compatibility\n\nSessions without `sessionType` are treated as 'discussion' sessions:\n\n```typescript\n// In getSession and other methods:\n(m.sessionType === 'discussion' || !m.sessionType)\n```\n\nThis allows the same issue to have both a discussion session AND a planning session simultaneously.\n\n---\n\n## Files to Modify\n\n- `src/lib/services/sessions.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] `SessionMapping` interface extended with `sessionType` and `worktreePath`\n- [ ] NEW `savePlanningSession` method for planning-specific saves\n- [ ] EXISTING `saveSession` signature unchanged (backward compatible)\n- [ ] `getPlanningSession` method returns typed planning sessions\n- [ ] Sessions are filtered by type (allowing same issue to have both types)\n- [ ] Existing sessions without `sessionType` work as 'discussion' (backwards compatible)\n- [ ] `listPlanningSessions` returns all planning sessions for a project\n- [ ] TypeScript types properly distinguish planning vs discussion sessions\n\n---\n\n## Testing Notes\n\n- Test existing session without `sessionType` field (should be treated as discussion)\n- Test creating both discussion and planning sessions for same issue\n- Test `listPlanningSessions` with multiple planning sessions\n- Verify existing code using `saveSession` continues to work unchanged","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:02:30.374173-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.5","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:02:30.376357-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.6","title":"Phase 2.3: Extend OpenCode Service for Full-Access Sessions","description":"## Task Overview\n\nAdd methods to the OpenCode service that enable 'full access' sessions - sessions where the AI agent has all tools enabled (bash, write, edit), as required for planning mode.\n\n---\n\n## Background \u0026 Context\n\n### Current Session Types\n\nRegular discussion sessions use limited tool access:\n- Read-only file access\n- No bash execution\n- No file modification\n\n### Planning Session Requirements\n\nPlanning agents need full tool access:\n- **bash**: Execute `bd` CLI commands to manage beads\n- **write**: Create new bead files (via CLI output)\n- **edit**: Modify existing beads\n- **read**: Analyze codebase for task breakdown\n\nThe key insight from GH Issue #6: slash commands like `/turn_gh_issue_into_beads` are sent as regular message text, not as a separate API. The agent handles them.\n\n---\n\n## Implementation Details\n\n### New Method: `sendPlanningMessageAsync`\n\n```typescript\n// In src/lib/services/opencode.ts\n\n/**\n * Send a message with full tool access (bash, write, edit, read).\n * Used for planning sessions where the agent needs to create/modify beads.\n * \n * @param worktreePath - The working directory (worktree path for planning)\n * @param sessionId - The OpenCode session ID\n * @param message - The message text (can include slash commands like /turn_gh_issue_into_beads)\n * @returns Promise that resolves when message is sent (not when response is complete)\n */\nasync sendPlanningMessageAsync(\n  worktreePath: string,\n  sessionId: string,\n  message: string\n): Promise\u003cvoid\u003e {\n  await this.client.session.promptAsync({\n    path: { id: sessionId },\n    query: { directory: worktreePath },\n    body: {\n      model: DEFAULT_MODEL,\n      tools: {\n        bash: true,\n        write: true,\n        edit: true,\n      },\n      parts: [{ type: 'text', text: message }],\n    },\n  });\n}\n```\n\n### New Method: `createPlanningSession`\n\n```typescript\n/**\n * Create a new session configured for planning mode.\n * The session is created in the context of a worktree directory.\n * \n * @param worktreePath - Path to the git worktree\n * @param title - Optional session title\n * @returns The created session ID\n */\nasync createPlanningSession(worktreePath: string, title?: string): Promise\u003c{ id: string }\u003e {\n  const result = await this.client.session.create({\n    query: { directory: worktreePath },\n    body: {\n      title: title || 'Planning Session',\n    },\n  });\n\n  if (!result.data?.id) {\n    throw new Error(\"Failed to create planning session: no session ID returned\");\n  }\n\n  return { id: result.data.id };\n}\n```\n\n### New Method: `streamPlanningResponse` (Used by Chat API)\n\nFor SSE streaming of planning responses:\n\n```typescript\n/**\n * Send a message to a planning session and stream the response.\n * Returns a ReadableStream suitable for SSE responses.\n * \n * IMPORTANT: This is the method used by the /chat API endpoint.\n * \n * @param worktreePath - The working directory (worktree path)\n * @param sessionId - The OpenCode session ID\n * @param message - The message text\n */\nasync streamPlanningResponse(\n  worktreePath: string,\n  sessionId: string,\n  message: string\n): Promise\u003cReadableStream\u003e {\n  const response = await this.client.session.prompt({\n    path: { id: sessionId },\n    query: { directory: worktreePath },\n    body: {\n      model: DEFAULT_MODEL,\n      tools: {\n        bash: true,\n        write: true,\n        edit: true,\n      },\n      parts: [{ type: 'text', text: message }],\n    },\n  });\n  \n  // Return the response stream for SSE\n  // Note: Exact implementation depends on SDK response handling\n  // May need to convert response to SSE format\n  return this.convertToSSEStream(response);\n}\n\nprivate convertToSSEStream(response: any): ReadableStream {\n  // Convert SDK response to SSE format\n  // Implementation depends on @opencode-ai/sdk response structure\n  const encoder = new TextEncoder();\n  \n  return new ReadableStream({\n    async start(controller) {\n      // Handle response parts and emit as SSE events\n      if (response.data?.parts) {\n        for (const part of response.data.parts) {\n          const event = `data: ${JSON.stringify(part)}\\n\\n`;\n          controller.enqueue(encoder.encode(event));\n        }\n      }\n      controller.close();\n    }\n  });\n}\n```\n\n---\n\n## Tool Configuration Reference\n\nFrom OpenCode SDK, the tools object structure:\n\n```typescript\ninterface ToolsConfig {\n  bash?: boolean;    // Shell command execution\n  write?: boolean;   // Create new files\n  edit?: boolean;    // Modify existing files\n  read?: boolean;    // Read file contents (usually enabled by default)\n  glob?: boolean;    // File pattern matching\n  grep?: boolean;    // Content search\n  // ... other tools\n}\n```\n\nFor planning, we enable bash + write + edit. Read/glob/grep are typically enabled by default.\n\n---\n\n## Files to Modify\n\n- `src/lib/services/opencode.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] `sendPlanningMessageAsync` sends messages with all tools enabled\n- [ ] `createPlanningSession` creates session with worktree as directory context\n- [ ] `streamPlanningResponse` returns ReadableStream for SSE\n- [ ] Sessions use worktree path as directory context\n- [ ] Tool configuration includes bash, write, edit\n- [ ] Methods integrate with existing error handling patterns\n- [ ] TypeScript types are correct\n\n---\n\n## Testing Notes\n\n- Test sending a message with `/turn_gh_issue_into_beads` command\n- Verify agent can execute `bd` commands\n- Test session creation with worktree path\n- Verify tool access is properly enabled\n- Test streaming response format","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:03:03.49832-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.6","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:03:03.50077-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.7","title":"Phase 2.4: Build Setup Pipeline with SSE Progress Streaming","description":"## Task Overview\n\nImplement the setup pipeline that runs when entering planning mode. This pipeline creates the worktree, installs dependencies, creates the session, and sends the initial planning prompt. Progress is streamed to the frontend via Server-Sent Events (SSE).\n\n---\n\n## Background \u0026 Context\n\nWhen a user confirms 'Start Planning', several sequential operations must occur:\n\n1. **Create worktree** - Git operations to set up isolated environment\n2. **Install dependencies** - Run `bun install` in the worktree\n3. **Create session** - Create OpenCode session pointed at worktree\n4. **Send initial prompt** - `/turn_gh_issue_into_beads {issueNumber}`\n\nEach step can take several seconds. Users need real-time visibility into progress.\n\n---\n\n## Pipeline Steps\n\n### Step 1: Create Worktree\n\n```typescript\ninterface PipelineStep {\n  id: string;\n  name: string;\n  status: 'pending' | 'in_progress' | 'completed' | 'error';\n  message?: string;\n  startedAt?: string;\n  completedAt?: string;\n  error?: string;\n}\n\n// Step: create_worktree\n{\n  id: 'create_worktree',\n  name: 'Creating git worktree',\n  status: 'in_progress',\n  message: 'Setting up isolated development environment...'\n}\n```\n\n### Step 2: Install Dependencies\n\n```typescript\n// Step: install_deps\n{\n  id: 'install_deps',\n  name: 'Installing dependencies',\n  status: 'in_progress',\n  message: 'Running bun install...'\n}\n```\n\n### Step 3: Create Session\n\n```typescript\n// Step: create_session\n{\n  id: 'create_session',\n  name: 'Starting AI session',\n  status: 'in_progress',\n  message: 'Connecting to OpenCode...'\n}\n```\n\n### Step 4: Initial Planning\n\n```typescript\n// Step: initial_planning\n{\n  id: 'initial_planning',\n  name: 'Analyzing issue',\n  status: 'in_progress',\n  message: 'Breaking down issue into tasks...'\n}\n```\n\n---\n\n## API Endpoint\n\n### POST `/api/projects/{id}/planning/{issueNumber}/start`\n\n**Request Body:**\n```json\n{\n  \"issueTitle\": \"Planning Mode Feature\"\n}\n```\n\n**Response:** SSE stream with events:\n\n```\nevent: step\ndata: {\"id\":\"create_worktree\",\"status\":\"in_progress\",\"name\":\"Creating git worktree\"}\n\nevent: step\ndata: {\"id\":\"create_worktree\",\"status\":\"completed\",\"duration\":1234}\n\nevent: step\ndata: {\"id\":\"install_deps\",\"status\":\"in_progress\",\"name\":\"Installing dependencies\"}\n\nevent: step\ndata: {\"id\":\"install_deps\",\"status\":\"completed\",\"duration\":5678}\n\nevent: step\ndata: {\"id\":\"create_session\",\"status\":\"in_progress\",\"name\":\"Starting AI session\"}\n\nevent: step\ndata: {\"id\":\"create_session\",\"status\":\"completed\",\"sessionId\":\"abc123\"}\n\nevent: step\ndata: {\"id\":\"initial_planning\",\"status\":\"in_progress\",\"name\":\"Analyzing issue\"}\n\nevent: complete\ndata: {\"sessionId\":\"abc123\",\"worktreePath\":\"/Users/.../issue-6\"}\n```\n\n**Error Event:**\n```\nevent: error\ndata: {\"step\":\"install_deps\",\"error\":\"bun install failed\",\"details\":\"...\"}\n```\n\n---\n\n## Implementation\n\n### Route Handler\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/start/route.ts\n\nexport async function POST(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const { issueTitle } = await request.json();\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  // Get project path from config\n  const project = await configService.getProject(projectId);\n  if (!project) {\n    return new Response('Project not found', { status: 404 });\n  }\n  \n  // Create SSE stream\n  const stream = new ReadableStream({\n    async start(controller) {\n      const encoder = new TextEncoder();\n      \n      function sendEvent(event: string, data: object) {\n        controller.enqueue(encoder.encode(`event: ${event}\\ndata: ${JSON.stringify(data)}\\n\\n`));\n      }\n      \n      try {\n        // Step 1: Create worktree\n        sendEvent('step', { id: 'create_worktree', status: 'in_progress', name: 'Creating git worktree' });\n        const worktreeInfo = await worktreeService.createWorktree(project.path, issueNumber, issueTitle);\n        sendEvent('step', { id: 'create_worktree', status: 'completed' });\n        \n        // Step 2: Install dependencies\n        sendEvent('step', { id: 'install_deps', status: 'in_progress', name: 'Installing dependencies' });\n        await execAsync('bun install', { cwd: worktreeInfo.path });\n        await worktreeService.markDepsInstalled(project.path, issueNumber);\n        sendEvent('step', { id: 'install_deps', status: 'completed' });\n        \n        // Step 3: Create session\n        sendEvent('step', { id: 'create_session', status: 'in_progress', name: 'Starting AI session' });\n        const sessionId = await openCodeService.createPlanningSession(worktreeInfo.path);\n        await sessionStorage.setSession({\n          projectId,\n          projectPath: project.path,\n          issueNumber,\n          sessionId,\n          sessionType: 'planning',\n          worktreePath: worktreeInfo.path,\n          createdAt: new Date().toISOString(),\n          lastAccessedAt: new Date().toISOString(),\n        });\n        sendEvent('step', { id: 'create_session', status: 'completed', sessionId });\n        \n        // Step 4: Send initial planning prompt\n        sendEvent('step', { id: 'initial_planning', status: 'in_progress', name: 'Analyzing issue' });\n        await openCodeService.sendMessageWithFullAccessAsync(\n          worktreeInfo.path,\n          sessionId,\n          `/turn_gh_issue_into_beads ${issueNumber}`\n        );\n        sendEvent('step', { id: 'initial_planning', status: 'completed' });\n        \n        // Complete\n        sendEvent('complete', { sessionId, worktreePath: worktreeInfo.path });\n        \n      } catch (error) {\n        sendEvent('error', { \n          error: error.message,\n          details: error.stack \n        });\n      } finally {\n        controller.close();\n      }\n    }\n  });\n  \n  return new Response(stream, {\n    headers: {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n    },\n  });\n}\n```\n\n---\n\n## Resume Logic\n\nThe endpoint should detect existing state:\n\n```typescript\n// At the start of the handler\nconst existingWorktree = await worktreeService.getWorktree(project.path, issueNumber);\n\nif (existingWorktree) {\n  // Skip worktree creation, check deps, etc.\n  sendEvent('step', { id: 'create_worktree', status: 'completed', skipped: true });\n  \n  if (existingWorktree.depsInstalled) {\n    sendEvent('step', { id: 'install_deps', status: 'completed', skipped: true });\n  }\n  \n  // Check for existing session\n  const existingSession = await sessionStorage.getPlanningSession(projectId, issueNumber);\n  if (existingSession \u0026\u0026 await openCodeService.isSessionAlive(existingSession.sessionId)) {\n    sendEvent('step', { id: 'create_session', status: 'completed', skipped: true, sessionId: existingSession.sessionId });\n    // Skip initial planning too\n    sendEvent('step', { id: 'initial_planning', status: 'completed', skipped: true });\n    sendEvent('complete', { sessionId: existingSession.sessionId, worktreePath: existingWorktree.path });\n    return;\n  }\n}\n```\n\n---\n\n## Files to Create\n\n- `src/app/api/projects/[id]/planning/[issueNumber]/start/route.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] SSE stream sends step-by-step progress updates\n- [ ] Each step shows status transitions: pending → in_progress → completed/error\n- [ ] Worktree created with correct branch naming\n- [ ] Dependencies installed in worktree\n- [ ] OpenCode session created and stored\n- [ ] Initial `/turn_gh_issue_into_beads` command sent\n- [ ] Resume logic skips completed steps\n- [ ] Errors are caught and sent as error events\n- [ ] Stream properly closed on completion or error\n\n---\n\n## Dependencies\n\n- Requires: WorktreeService (2.1)\n- Requires: Extended Session Storage (2.2)\n- Requires: Extended OpenCode Service (2.3)\n\n---\n\n## Testing Notes\n\n- Test full flow with new issue\n- Test resume flow with existing worktree\n- Test error handling (e.g., simulate bun install failure)\n- Test SSE parsing in frontend\n- Monitor for resource leaks (unclosed streams)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:03:50.314294-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.7","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:03:50.316713-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.7","depends_on_id":"maestro-g88.4","type":"blocks","created_at":"2025-12-30T23:14:42.188805-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.7","depends_on_id":"maestro-g88.5","type":"blocks","created_at":"2025-12-30T23:14:42.224754-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.7","depends_on_id":"maestro-g88.6","type":"blocks","created_at":"2025-12-30T23:14:42.260006-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.8","title":"Phase 2.5: Build SetupProgress UI Component","description":"## Task Overview\n\nCreate the `SetupProgress` component that displays real-time progress of the planning setup pipeline, consuming SSE events and rendering visual feedback.\n\n---\n\n## Background \u0026 Context\n\nWhen users start planning, they see a multi-step setup process:\n1. Creating git worktree\n2. Installing dependencies\n3. Starting AI session\n4. Analyzing issue\n\nEach step needs visual feedback: spinner during progress, checkmark on success, X on failure.\n\n---\n\n## Visual Design\n\n```\n┌────────────────────────────────────────────────┐\n│  Setting up planning environment...            │\n│                                                │\n│  ✓  Creating git worktree          (1.2s)     │\n│  ✓  Installing dependencies         (5.3s)     │\n│  ◐  Starting AI session...                     │\n│  ○  Analyzing issue                            │\n│                                                │\n│  ─────────────────────────────────────────     │\n│  Branch: feature/issue-6-planning-mode         │\n│  Worktree: ~/.maestro/worktrees/maestro/...    │\n└────────────────────────────────────────────────┘\n\nOn error:\n┌────────────────────────────────────────────────┐\n│  Setup encountered an error                    │\n│                                                │\n│  ✓  Creating git worktree          (1.2s)     │\n│  ✗  Installing dependencies                    │\n│     Error: bun install failed                  │\n│     Exit code 1                                │\n│                                                │\n│  [Retry]  [View Details]                       │\n└────────────────────────────────────────────────┘\n```\n\n---\n\n## Component API\n\n```typescript\n// src/components/planning/SetupProgress.tsx\n\ninterface SetupStep {\n  id: string;\n  name: string;\n  status: 'pending' | 'in_progress' | 'completed' | 'error' | 'skipped';\n  duration?: number;  // milliseconds\n  error?: string;\n  skipped?: boolean;\n}\n\ninterface SetupProgressProps {\n  projectId: string;\n  issueNumber: number;\n  issueTitle: string;\n  onComplete: (result: { sessionId: string; worktreePath: string }) =\u003e void;\n  onError: (error: { step: string; error: string }) =\u003e void;\n}\n\nexport function SetupProgress({ \n  projectId, \n  issueNumber, \n  issueTitle, \n  onComplete, \n  onError \n}: SetupProgressProps) {\n  const [steps, setSteps] = useState\u003cSetupStep[]\u003e([\n    { id: 'create_worktree', name: 'Creating git worktree', status: 'pending' },\n    { id: 'install_deps', name: 'Installing dependencies', status: 'pending' },\n    { id: 'create_session', name: 'Starting AI session', status: 'pending' },\n    { id: 'initial_planning', name: 'Analyzing issue', status: 'pending' },\n  ]);\n  const [error, setError] = useState\u003c{ step: string; error: string } | null\u003e(null);\n  const [metadata, setMetadata] = useState\u003c{ branch?: string; worktreePath?: string }\u003e({});\n  \n  useEffect(() =\u003e {\n    const startSetup = async () =\u003e {\n      const response = await fetch(`/api/projects/${projectId}/planning/${issueNumber}/start`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ issueTitle }),\n      });\n      \n      const reader = response.body?.getReader();\n      const decoder = new TextDecoder();\n      \n      // Parse SSE stream...\n    };\n    \n    startSetup();\n  }, [projectId, issueNumber, issueTitle]);\n  \n  // ... render logic\n}\n```\n\n---\n\n## SSE Parsing\n\n```typescript\nfunction parseSSEEvents(chunk: string): Array\u003c{ event: string; data: object }\u003e {\n  const events: Array\u003c{ event: string; data: object }\u003e = [];\n  const lines = chunk.split('\\n');\n  \n  let currentEvent = '';\n  let currentData = '';\n  \n  for (const line of lines) {\n    if (line.startsWith('event: ')) {\n      currentEvent = line.slice(7);\n    } else if (line.startsWith('data: ')) {\n      currentData = line.slice(6);\n    } else if (line === '' \u0026\u0026 currentEvent \u0026\u0026 currentData) {\n      events.push({ event: currentEvent, data: JSON.parse(currentData) });\n      currentEvent = '';\n      currentData = '';\n    }\n  }\n  \n  return events;\n}\n```\n\n---\n\n## Visual Elements\n\n### Step Icons\n\n```tsx\nfunction StepIcon({ status }: { status: SetupStep['status'] }) {\n  switch (status) {\n    case 'pending':\n      return \u003cCircle className=\"h-4 w-4 text-muted-foreground\" /\u003e;\n    case 'in_progress':\n      return \u003cLoader2 className=\"h-4 w-4 animate-spin text-primary\" /\u003e;\n    case 'completed':\n    case 'skipped':\n      return \u003cCheckCircle2 className=\"h-4 w-4 text-green-500\" /\u003e;\n    case 'error':\n      return \u003cXCircle className=\"h-4 w-4 text-destructive\" /\u003e;\n  }\n}\n```\n\n### Duration Display\n\n```tsx\nfunction formatDuration(ms: number): string {\n  if (ms \u003c 1000) return `${ms}ms`;\n  return `${(ms / 1000).toFixed(1)}s`;\n}\n\n// Render: (1.2s) or (skipped)\n{step.duration \u0026\u0026 \u003cspan className=\"text-muted-foreground\"\u003e({formatDuration(step.duration)})\u003c/span\u003e}\n{step.skipped \u0026\u0026 \u003cspan className=\"text-muted-foreground\"\u003e(skipped)\u003c/span\u003e}\n```\n\n---\n\n## Error Handling UI\n\nWhen an error occurs:\n1. Show error icon on failed step\n2. Display error message below the step\n3. Show 'Retry' button to restart from failed step\n4. Show 'View Details' to expand full error stack\n\n```tsx\n{error \u0026\u0026 (\n  \u003cdiv className=\"mt-4 rounded-md bg-destructive/10 p-3\"\u003e\n    \u003cp className=\"text-sm text-destructive\"\u003e{error.error}\u003c/p\u003e\n    \u003cdiv className=\"mt-2 flex gap-2\"\u003e\n      \u003cButton size=\"sm\" onClick={retry}\u003eRetry\u003c/Button\u003e\n      \u003cButton size=\"sm\" variant=\"outline\" onClick={() =\u003e setShowDetails(true)}\u003e\n        View Details\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n)}\n```\n\n---\n\n## Retry Logic\n\nOn retry, restart the SSE request. The backend handles resume logic automatically (skipping completed steps).\n\n---\n\n## Files to Create\n\n- `src/components/planning/SetupProgress.tsx`\n\n---\n\n## Acceptance Criteria\n\n- [ ] Displays all 4 setup steps with appropriate icons\n- [ ] Real-time updates as SSE events arrive\n- [ ] Shows duration for completed steps\n- [ ] Handles 'skipped' status for resume scenarios\n- [ ] Error state displays error message and retry button\n- [ ] `onComplete` called with session info when done\n- [ ] `onError` called when pipeline fails\n- [ ] Proper loading states during SSE connection\n- [ ] Accessible (screen reader announces step changes)\n\n---\n\n## Dependencies\n\n- Requires: Setup Pipeline API (2.4)\n\n---\n\n## Testing Notes\n\n- Test with slow network (SSE delays)\n- Test error scenarios (each step can fail)\n- Test resume flow (steps show as skipped)\n- Test accessibility with screen reader","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:04:26.897655-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.8","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:04:26.899579-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.8","depends_on_id":"maestro-g88.7","type":"blocks","created_at":"2025-12-30T23:14:42.294266-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.9","title":"Phase 3.1: Create Beads CLI Wrapper Service","description":"## Task Overview\n\nCreate a service that wraps the `bd` CLI commands, providing a clean TypeScript API for beads operations from the frontend.\n\n---\n\n## Background \u0026 Context\n\n### Why CLI Instead of MCP?\n\nThe GitHub issue explicitly recommends CLI-first approach:\n- **Simplicity**: No additional server to run\n- **Consistency**: Matches how developers use beads manually\n- **Reliability**: No connection management complexity\n- **Observability**: CLI output is easily logged\n\n### Key Commands Needed\n\n| Command | Purpose |\n|---------|---------|\n| `bd list --json` | Get all beads for display |\n| `bd show \u003cid\u003e --json` | Get single bead details |\n| `bd ready` | Get tasks ready to work |\n| `bd create --title=\"...\" --type=task --parent=\u003cepic\u003e` | Create new bead |\n| `bd update \u003cid\u003e --status=... --priority=...` | Update bead properties |\n| `bd close \u003cid\u003e` | Mark bead complete |\n| `bd dep add \u003cissue\u003e \u003cdepends-on\u003e` | Add dependency |\n\n---\n\n## Implementation Details\n\n### Service Interface\n\n```typescript\n// src/lib/services/beads.ts\n\nexport interface Bead {\n  id: string;              // e.g., \"maestro-g88\"\n  title: string;\n  description?: string;\n  type: 'epic' | 'task' | 'bug' | 'feature' | 'question' | 'docs';\n  status: 'open' | 'in_progress' | 'closed';\n  priority: 0 | 1 | 2 | 3 | 4;  // P0=critical, P4=backlog\n  parent?: string;         // Parent bead ID\n  children?: string[];     // Child bead IDs\n  blocks?: string[];       // IDs of beads this blocks\n  blockedBy?: string[];    // IDs of beads blocking this\n  files?: string[];        // Associated file paths\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface BeadTree {\n  root: Bead;              // The epic\n  children: BeadTree[];    // Nested structure\n}\n\nexport interface CreateBeadOptions {\n  title: string;\n  type: Bead['type'];\n  priority?: Bead['priority'];\n  parent?: string;\n  description?: string;\n}\n\nexport interface UpdateBeadOptions {\n  status?: Bead['status'];\n  priority?: Bead['priority'];\n  title?: string;\n  description?: string;\n}\n\nexport class BeadsService {\n  // Read operations - ALL take worktreePath as first argument\n  async list(worktreePath: string): Promise\u003cBead[]\u003e;\n  async get(worktreePath: string, id: string): Promise\u003cBead | null\u003e;\n  async getReady(worktreePath: string): Promise\u003cBead[]\u003e;\n  async getTree(worktreePath: string, epicId: string): Promise\u003cBeadTree\u003e;\n  \n  // Write operations (typically done by AI, but exposed for UI)\n  async create(worktreePath: string, options: CreateBeadOptions): Promise\u003cBead\u003e;\n  async update(worktreePath: string, id: string, updates: UpdateBeadOptions): Promise\u003cBead\u003e;\n  async close(worktreePath: string, id: string, reason?: string): Promise\u003cvoid\u003e;\n  \n  // Dependency operations\n  async addDependency(worktreePath: string, beadId: string, dependsOnId: string): Promise\u003cvoid\u003e;\n  async removeDependency(worktreePath: string, beadId: string, dependsOnId: string): Promise\u003cvoid\u003e;\n}\n```\n\n---\n\n## CLI Execution\n\n```typescript\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\n\nconst execAsync = promisify(exec);\n\nasync function runBeadsCommand(worktreePath: string, command: string): Promise\u003cstring\u003e {\n  try {\n    const { stdout, stderr } = await execAsync(`bd ${command}`, {\n      cwd: worktreePath,\n      env: { ...process.env },\n      timeout: 30000,  // 30 second timeout\n    });\n    \n    if (stderr) {\n      console.warn('bd stderr:', stderr);\n    }\n    \n    return stdout.trim();\n  } catch (error: any) {\n    throw new BeadsError(\n      `bd command failed: bd ${command}`,\n      error.code || 'COMMAND_FAILED',\n      error.stderr || error.message\n    );\n  }\n}\n```\n\n---\n\n## Parsing JSON Output\n\n```typescript\nasync list(worktreePath: string): Promise\u003cBead[]\u003e {\n  const output = await runBeadsCommand(worktreePath, 'list --json');\n  \n  // Handle empty list\n  if (!output || output === '[]') {\n    return [];\n  }\n  \n  try {\n    const raw = JSON.parse(output);\n    return raw.map(normalizeBeadFromCLI);\n  } catch (error) {\n    throw new BeadsError('Failed to parse bd list output', 'PARSE_ERROR', output);\n  }\n}\n\n// Normalize CLI output to our Bead interface\nfunction normalizeBeadFromCLI(raw: any): Bead {\n  return {\n    id: raw.id,\n    title: raw.title,\n    description: raw.description || undefined,\n    type: raw.issue_type || raw.type || 'task',\n    status: raw.status || 'open',\n    priority: typeof raw.priority === 'number' ? raw.priority : 2,\n    parent: raw.parent || undefined,\n    children: raw.children || [],\n    blocks: raw.blocks || [],\n    blockedBy: raw.blocked_by || raw.blockedBy || [],\n    files: raw.files || [],\n    createdAt: raw.created_at || raw.createdAt || new Date().toISOString(),\n    updatedAt: raw.updated_at || raw.updatedAt || new Date().toISOString(),\n  };\n}\n```\n\n---\n\n## Tree Building\n\n```typescript\nasync getTree(worktreePath: string, epicId: string): Promise\u003cBeadTree\u003e {\n  const allBeads = await this.list(worktreePath);\n  const beadMap = new Map(allBeads.map(b =\u003e [b.id, b]));\n  \n  const epic = beadMap.get(epicId);\n  if (!epic) {\n    throw new BeadsError(`Epic not found: ${epicId}`, 'NOT_FOUND');\n  }\n  \n  function buildTree(bead: Bead): BeadTree {\n    const children = allBeads\n      .filter(b =\u003e b.parent === bead.id)\n      .map(buildTree);\n    \n    return { root: bead, children };\n  }\n  \n  return buildTree(epic);\n}\n```\n\n---\n\n## Error Handling\n\n```typescript\nexport class BeadsError extends Error {\n  constructor(\n    message: string,\n    public code: 'COMMAND_FAILED' | 'PARSE_ERROR' | 'NOT_FOUND' | 'TIMEOUT',\n    public details?: string\n  ) {\n    super(message);\n    this.name = 'BeadsError';\n  }\n}\n```\n\n---\n\n## Files to Create\n\n- `src/lib/services/beads.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] `list` returns all beads as typed array\n- [ ] `get` returns single bead or null\n- [ ] `getTree` builds hierarchical structure from epic\n- [ ] `create` creates bead via `bd create` command\n- [ ] `update` updates bead properties\n- [ ] `close` marks bead as closed\n- [ ] Proper error handling with typed errors\n- [ ] JSON parsing handles edge cases (empty, malformed)\n- [ ] Commands run in worktree directory context (first param is worktreePath)\n\n---\n\n## Dependencies\n\n- Requires: WorktreeService (2.1) - to know the worktree path\n\n---\n\n## Testing Notes\n\n- Test with empty beads database\n- Test with complex hierarchy (epic → tasks → subtasks)\n- Test error scenarios (invalid bead ID, parse errors)\n- Verify commands work in worktree context","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:05:14.89883-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.9","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:05:14.901699-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.9","depends_on_id":"maestro-g88.4","type":"blocks","created_at":"2025-12-31T07:52:38.469467-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-lrw","title":"Mark As Complete Feature (Issue #12)","description":"## Overview\nAllow users to mark items (inbox items or bookmarks) as \"completed/finished/read\" to indicate they have consumed the content. This is a consumption-tracking feature that is **orthogonal** to the item state (INBOX/BOOKMARKED/ARCHIVED).\n\n## Business Context \u0026 User Need\nUsers save content to consume later. Once consumed, they want to:\n1. Track what they've already consumed (personal accomplishment)\n2. Hide consumed content from their active triage/consumption views\n3. Still have access to consumed content in their library for reference\n\nThe \"completed\" state answers: \"Have I consumed this content?\" while the item state answers: \"What is my workflow relationship with this content?\"\n\n## Key Semantic Distinction\n- **isFinished** = \"I consumed this\" (reading, watching, listening complete)\n- **ARCHIVED** = \"I dismissed this without consuming\" (not interested, outdated, duplicate)\n- **BOOKMARKED** = \"I want to consume this later\" (saved for future)\n- An item can be BOOKMARKED AND finished (saved and consumed)\n- An item can be in INBOX and finished (completed but not yet triaged)\n\n## Existing Infrastructure (Already Implemented)\nThe backend is FULLY ready - this is primarily a frontend wiring task:\n\n### Database (apps/worker/src/db/schema.ts)\n- `isFinished: integer('is_finished', { mode: 'boolean' }).notNull().default(false)`\n- `finishedAt: text('finished_at')` - ISO8601 timestamp, null when not finished\n- Migration already applied: `0005_add_is_finished.sql`\n\n### Backend API (apps/worker/src/trpc/routers/items.ts)\n- `toggleFinished` mutation EXISTS and works correctly (lines 488-526)\n- Returns `{ success: true, isFinished: boolean, finishedAt: string | null }`\n- ItemView type already includes `isFinished` and `finishedAt` fields (lines 60-61)\n\n### Frontend Hook (apps/mobile/hooks/use-items-trpc.ts)\n- `useToggleFinished()` hook EXISTS with full optimistic updates (lines 455-479)\n- Already handles inbox, library, and single-item cache updates\n\n### UI Elements\n- Check icons exist: `CheckIcon` (filled) and `CheckOutlineIcon` (outline) in icons/check-icon.tsx\n- Button placeholder exists in item detail page (line 377-386, handler at lines 212-214 logs \"not yet implemented\")\n\n## Implementation Scope\n\n### 1. Wire Up Action Button (apps/mobile/app/item/[id].tsx)\n- Import and use `useToggleFinished()` hook\n- Replace placeholder `handleToggleFinished` with actual mutation call\n- Toggle between `CheckIcon`/`CheckOutlineIcon` based on `item.isFinished`\n- Add haptic feedback (`expo-haptics`)\n- Handle loading/disabled states during mutation\n\n### 2. Filter Completed Items from Views\n**Inbox Query** (apps/worker/src/trpc/routers/items.ts:136-191):\n- Add `eq(userItems.isFinished, false)` to conditions at line 141\n- Completed inbox items should not appear in triage queue\n\n**Home Data Query** (apps/worker/src/trpc/routers/items.ts:262-345):\n- Filter out finished items from `recentBookmarks` section\n- Filter out finished items from `jumpBackIn` section\n- Keep `byContentType` sections (podcasts, videos, articles) unfiltered (these are library browsing views)\n\n**Library** - NO CHANGES NEEDED:\n- Library shows all BOOKMARKED items regardless of finished state\n- Users can browse their complete collection including finished items\n\n### 3. Visual Indicator on Item Cards\nModify `ItemCard` component (apps/mobile/components/item-card.tsx):\n- Add `isFinished?: boolean` to `ItemCardData` interface\n- Display completion indicator (small checkmark badge on thumbnail corner OR subtle opacity/styling change)\n- Use existing `CheckIcon` component for the badge\n\n### 4. Type Updates (packages/shared/src/types/domain.ts)\n- Add `isFinished?: boolean` and `finishedAt?: string` to `UserItem` interface (lines 126-162)\n- This ensures type consistency across frontend and backend\n\n## Testing Considerations\n- Test toggle on/off repeatedly (rapid toggling edge case)\n- Test on items in different states (INBOX, BOOKMARKED)\n- Verify optimistic updates rollback on network failure\n- Verify filters work with mixed finished/unfinished items\n- Test empty state when all items are completed\n\n## Files to Modify Summary\n1. `apps/mobile/app/item/[id].tsx` - Wire toggle handler\n2. `apps/mobile/components/item-card.tsx` - Add visual indicator\n3. `apps/mobile/hooks/use-items-trpc.ts` - Already done, but may need isFinished in transforms\n4. `apps/worker/src/trpc/routers/items.ts` - Add isFinished filters to queries\n5. `packages/shared/src/types/domain.ts` - Add isFinished to UserItem interface\n\n## Acceptance Criteria\n- [ ] Tapping check icon on item detail page toggles completion state\n- [ ] Icon changes between filled/outline based on state\n- [ ] Haptic feedback on toggle\n- [ ] Completed items hidden from Inbox tab\n- [ ] Completed items hidden from Home page \"Jump Back In\" and \"Recent Inbox\"\n- [ ] Completed items still visible in Library\n- [ ] Item cards show subtle completion indicator","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-31T10:35:24.766289-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-lrw.1","title":"Update UserItem interface with isFinished fields","description":"## Purpose\nEnsure type safety across the codebase by adding consumption tracking fields to the shared UserItem interface.\n\n## Context\nThe backend ItemView already includes `isFinished` and `finishedAt` (see items.ts lines 60-61). The shared types package needs to reflect this for frontend type-checking.\n\n## Implementation\nAdd to UserItem interface (around line 145):\n```typescript\n/** Whether user has finished consuming this content */\nisFinished?: boolean;\n\n/** When the item was marked finished (ISO8601) */\nfinishedAt?: string;\n```\n\n## Why Optional (`?`)\nThese fields are optional because:\n1. Legacy data may not have them\n2. UserItem is used in contexts where these fields aren't always populated\n3. Maintains backward compatibility with existing code\n\n## File Location\n`packages/shared/src/types/domain.ts` - Lines 126-162\n\n## Blocking\nThis is a P0 foundational task - other tasks will implicitly depend on these types being correct.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-31T10:35:24.831691-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-lrw.2","title":"Wire up toggle handler in item detail page","description":"## Purpose\nConnect the existing check button UI to the backend mutation, replacing the placeholder implementation.\n\n## Current State\n- Handler exists at line 212-214: `handleToggleFinished` that just logs \"not yet implemented\"\n- Button exists at lines 377-386 with `CheckOutlineIcon`\n- Hook exists: `useToggleFinished()` in use-items-trpc.ts\n\n## Implementation Steps\n\n1. **Import the hook and filled icon**\n   ```typescript\n   import { useItem, useBookmarkItem, useUnbookmarkItem, useToggleFinished } from '@/hooks/use-items-trpc';\n   import { CheckIcon, CheckOutlineIcon, ... } from '@/components/icons';\n   ```\n\n2. **Initialize the mutation**\n   ```typescript\n   const toggleFinishedMutation = useToggleFinished();\n   ```\n\n3. **Update the handler**\n   ```typescript\n   const handleToggleFinished = () =\u003e {\n     if (!item) return;\n     toggleFinishedMutation.mutate({ id: item.id });\n   };\n   ```\n\n4. **Update the button UI** (around line 377)\n   - Add disabled state during mutation\n   - Toggle icon: `item.isFinished ? \u003cCheckIcon /\u003e : \u003cCheckOutlineIcon /\u003e`\n   - Optionally add color change when finished (e.g., primary color)\n\n## Notes\n- The hook already handles optimistic updates\n- The hook already invalidates relevant caches on completion\n- No toast notification needed (subtle state toggle)\n\n## File Location\n`apps/mobile/app/item/[id].tsx` - Lines 33, 159, 212-214, 377-386","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-31T10:35:24.894405-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-lrw.3","title":"Add isFinished filter to inbox query","description":"## Purpose\nExclude completed items from the inbox triage queue so users only see unconsumed content.\n\n## Business Logic\nThe inbox is a \"triage queue\" - users review new content and decide to bookmark or archive. Showing already-consumed items would clutter this workflow.\n\n## Implementation\nIn the `inbox` procedure (line 136-191), add filter at line 141:\n\n```typescript\nconst conditions = [\n  eq(userItems.userId, ctx.userId),\n  eq(userItems.state, UserItemState.INBOX),\n  eq(userItems.isFinished, false),  // ← ADD THIS LINE\n];\n```\n\n## Why This Works\n- `isFinished` defaults to `false` in the schema\n- Items marked finished are excluded from inbox\n- If user un-finishes an item, it reappears (if still in INBOX state)\n\n## Edge Case: Finished Before Triaging\nA user might mark an inbox item as finished before bookmarking/archiving. This is valid:\n- The item is consumed but not yet organized\n- It will be hidden from inbox (correct - already consumed)\n- User can find it in Library if they bookmarked it\n\n## Testing\n1. Mark inbox item as finished → should disappear from inbox\n2. Un-finish the item → should reappear in inbox\n3. Verify count in inbox header updates correctly\n\n## File Location\n`apps/worker/src/trpc/routers/items.ts` - Line 141","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:35:24.957883-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-lrw.4","title":"Filter completed items from home data sections","description":"## Purpose\nFilter completed items from home page sections that represent \"active\" content to consume.\n\n## Sections to Filter\n\n### recentBookmarks (should filter)\nRecently bookmarked items the user intends to consume. If already consumed, no need to show here.\n\n### jumpBackIn (should filter)\nItems with playback progress - implies active consumption. If finished, user has \"jumped all the way through.\"\n\n### byContentType (videos, podcasts, articles) - DO NOT FILTER\nThese are **library browsing** sections. Users may want to see all their podcasts/videos including finished ones.\n\n## Implementation\n\nIn the `home` procedure (lines 262-345):\n\n1. **Add to baseConditions** (line 266):\n   ```typescript\n   const baseConditions = [\n     eq(userItems.userId, ctx.userId),\n     eq(userItems.state, UserItemState.BOOKMARKED),\n     eq(userItems.isFinished, false),  // ← ADD for recent/jumpBackIn queries\n   ];\n   ```\n\n2. **Create separate conditions for byContentType** (no isFinished filter):\n   ```typescript\n   const libraryConditions = [\n     eq(userItems.userId, ctx.userId),\n     eq(userItems.state, UserItemState.BOOKMARKED),\n   ];\n   ```\n\n3. **Use libraryConditions for videos/podcasts/articles queries** (lines 296-320)\n\n## Alternative: Filter in transform\nCould also filter finished items after fetch in `jumpBackInFiltered` (line 332), but filtering at DB level is more efficient.\n\n## Testing\n1. Mark bookmarked item as finished → should disappear from Jump Back In\n2. Should still appear in Podcasts/Videos sections\n3. Verify home sections update without full page refresh (optimistic updates)\n\n## File Location\n`apps/worker/src/trpc/routers/items.ts` - Lines 262-345","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:35:25.020441-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-lrw.5","title":"Add completion visual indicator to ItemCard","description":"## Purpose\nProvide visual feedback on item cards showing completion status so users can quickly identify consumed content.\n\n## Design Options (pick one)\n\n### Option A: Checkmark Badge (Recommended)\nSmall green checkmark in corner of thumbnail:\n```tsx\n{item.isFinished \u0026\u0026 (\n  \u003cView style={styles.finishedBadge}\u003e\n    \u003cCheckIcon size={12} color=\"#fff\" /\u003e\n  \u003c/View\u003e\n)}\n```\nPositioning: Bottom-left of thumbnail (opposite of duration badge on bottom-right)\n\n### Option B: Opacity Reduction\nReduce opacity of finished items:\n```tsx\n\u003cView style={[styles.card, item.isFinished \u0026\u0026 { opacity: 0.6 }]}\u003e\n```\nPros: Subtle, de-emphasizes consumed content\nCons: May make content harder to read\n\n### Option C: Strikethrough/Faded Title\n```tsx\n\u003cText style={[styles.title, item.isFinished \u0026\u0026 styles.finishedTitle]}\u003e\n```\nWhere `finishedTitle` has reduced opacity or strikethrough\n\n## Implementation Steps\n\n1. **Update ItemCardData interface** (line 48-58):\n   ```typescript\n   export interface ItemCardData {\n     // ... existing fields\n     isFinished?: boolean;  // ← ADD\n   }\n   ```\n\n2. **Add badge to thumbnail** (after line 176 in compact variant):\n   ```tsx\n   {item.isFinished \u0026\u0026 (\n     \u003cView style={styles.finishedBadge}\u003e\n       \u003cCheckIcon size={10} color=\"#fff\" /\u003e\n     \u003c/View\u003e\n   )}\n   ```\n\n3. **Add style** (in styles object):\n   ```typescript\n   finishedBadge: {\n     position: 'absolute',\n     bottom: Spacing.xs,\n     left: Spacing.xs,\n     width: 18,\n     height: 18,\n     borderRadius: 9,\n     backgroundColor: '#22C55E', // green-500\n     alignItems: 'center',\n     justifyContent: 'center',\n   },\n   ```\n\n4. **Import CheckIcon** at top of file\n\n5. **Apply to all variants** (compact, full, large)\n\n## File Location\n`apps/mobile/components/item-card.tsx` - Lines 48-58, 176, 244, 334","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T10:35:25.081975-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-lrw.6","title":"Add haptic feedback to toggle interaction","description":"## Purpose\nAdd tactile feedback when toggling completion state to improve user experience and confirm the action.\n\n## Context\nHaptic feedback is a standard iOS/Android pattern for confirming user actions. The check toggle is a binary state change that benefits from physical confirmation.\n\n## Implementation\n\n1. **Install/Import expo-haptics** (should already be in the project):\n   ```typescript\n   import * as Haptics from 'expo-haptics';\n   ```\n\n2. **Add haptic to handler**:\n   ```typescript\n   const handleToggleFinished = () =\u003e {\n     if (!item) return;\n     \n     // Trigger haptic before mutation (immediate feedback)\n     Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n     \n     toggleFinishedMutation.mutate({ id: item.id });\n   };\n   ```\n\n## Haptic Style Options\n- `ImpactFeedbackStyle.Light` - Subtle tap, good for toggles\n- `ImpactFeedbackStyle.Medium` - More noticeable\n- `ImpactFeedbackStyle.Heavy` - Strong feedback\n- `NotificationFeedbackType.Success` - Success pattern (maybe on completion of mark-as-finished?)\n\n## Recommendation\nUse `Light` for the toggle action. It's a frequent, low-stakes action that shouldn't be jarring.\n\n## Optional Enhancement\nDifferent feedback for \"finishing\" vs \"un-finishing\":\n```typescript\nif (item.isFinished) {\n  // Un-finishing - just light tap\n  Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n} else {\n  // Finishing - success notification\n  Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);\n}\n```\n\n## Dependencies\nThis task should be done WITH or AFTER maestro-lrw.2 (wire up toggle handler) since it modifies the same handler.\n\n## File Location\n`apps/mobile/app/item/[id].tsx` - Lines 212-214","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T10:35:25.143649-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-lrw.7","title":"Pass isFinished through data transforms","description":"## Purpose\nEnsure the `isFinished` field flows through all data transformation layers so the UI can display completion status.\n\n## Context\nData flows: Backend → tRPC response → transform function → ItemCardData → ItemCard component\n\nThe backend already returns `isFinished` in ItemView. We need to ensure transforms pass it through.\n\n## Files to Update\n\n### 1. apps/mobile/app/(tabs)/inbox.tsx (lines 109-119)\nThe transform maps API response to ItemCardData:\n```typescript\nconst inboxItems: ItemCardData[] = (data?.items ?? []).map((item) =\u003e ({\n  id: item.id,\n  title: item.title,\n  // ... existing fields\n  isFinished: item.isFinished,  // ← ADD\n}));\n```\n\n### 2. apps/mobile/app/(tabs)/index.tsx\n\n**transformToItemCardData** (lines 61-82):\n```typescript\nfunction transformToItemCardData({ item, userItem }: ItemWithUserState): ItemCardData {\n  return {\n    // ... existing fields\n    isFinished: userItem.isFinished,  // ← ADD (if available from Replicache)\n  };\n}\n```\n\n**transformToContentItem** (lines 123-158):\nMay need to add isFinished if ContentCard component uses it.\n\n### 3. apps/mobile/hooks/use-items-trpc.ts\nThe hook already returns isFinished in the ItemView. No changes needed here.\n\n## Note on Replicache vs tRPC\nThe home page uses both:\n- Replicache: `useBookmarkedItems()`, `useInboxItems()` (older hooks)\n- tRPC: `useHomeData()`, `useTRPCLibraryItems()` \n\nThe Replicache hooks may not have isFinished exposed. Check `use-items.ts` if these hooks are still in use.\n\n## Testing\n1. Mark item as finished on detail page\n2. Navigate back to list view\n3. Verify completion badge appears on the item card\n\n## File Locations\n- `apps/mobile/app/(tabs)/inbox.tsx` - Lines 109-119\n- `apps/mobile/app/(tabs)/index.tsx` - Lines 61-82, 123-158","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T10:35:25.20507-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-lrw.8","title":"Integration testing and edge case verification","description":"## Purpose\nVerify all pieces work together and handle edge cases correctly before closing the epic.\n\n## Test Scenarios\n\n### Core Functionality\n1. [ ] Tap check icon on item detail → item marked finished\n2. [ ] Tap check icon again → item unmarked (toggle works)\n3. [ ] Icon changes between filled/outline correctly\n4. [ ] Haptic feedback fires on toggle\n\n### Filtering Behavior\n5. [ ] Finished inbox item disappears from Inbox tab\n6. [ ] Finished bookmarked item disappears from \"Jump Back In\"\n7. [ ] Finished bookmarked item disappears from \"Recent Inbox\" section on home\n8. [ ] Finished item STILL appears in Library tab\n9. [ ] Finished item STILL appears in Podcasts/Videos sections on home\n10. [ ] Un-finishing an inbox item makes it reappear in Inbox\n\n### Visual Indicators\n11. [ ] Item cards show completion badge when finished\n12. [ ] Badge appears in all card variants (compact, full, large)\n13. [ ] Badge doesn't obscure important content\n\n### Optimistic Updates\n14. [ ] UI updates immediately on toggle (no loading spinner)\n15. [ ] If network fails, state rolls back correctly\n16. [ ] Cache invalidation refreshes all relevant views\n\n### Edge Cases\n17. [ ] Rapid toggling doesn't cause race conditions\n18. [ ] Works on items in all states (INBOX, BOOKMARKED, ARCHIVED)\n19. [ ] Works offline (queued mutation)\n20. [ ] Empty state when all inbox items finished\n\n### Performance\n21. [ ] No noticeable lag on toggle\n22. [ ] List performance not affected by finished filtering\n23. [ ] Home page loads quickly with filtered queries\n\n## Test Data Setup\nNeed items in various states:\n- 3+ inbox items (some finished, some not)\n- 3+ bookmarked items (some finished, some not)\n- Items with different content types\n\n## Dependencies\nDepends on ALL other subtasks being complete.","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-31T10:36:53.498065-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ris","title":"Test activity event","status":"tombstone","priority":3,"issue_type":"task","created_at":"2026-01-01T21:39:03.792417-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Test bead for activity check","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-sc7","title":"Replace Ready column with Planning column (GH #13)","description":"## Problem Statement\n\nThe current project kanban board at `/project/[id]` has a \"Ready\" column that displays mock epic data filtered by `state === \"planned\"`. This is placeholder content that provides no real value to users. Meanwhile, active planning sessions (real work-in-progress) are stored in `~/.maestro/sessions.json` but are only visible in the sidebar, not on the main kanban view.\n\n## Strategic Goal\n\nTransform the kanban board from a partially-mocked UI to a more useful dashboard by replacing the mock \"Ready\" column with a \"Planning\" column that shows actual active planning sessions. This change:\n\n1. **Increases visibility** of in-progress work by surfacing planning sessions in the main view\n2. **Removes mock data** that could confuse users into thinking features exist\n3. **Maintains consistency** with existing patterns already used in the sidebar\n4. **Prepares the codebase** for future epic implementation by removing the placeholder\n\n## Solution Overview\n\nReplace the \"Ready\" column with a \"Planning\" column that:\n- Uses the existing `usePlanningSessions(projectId)` hook\n- Displays planning session cards linking to `/project/[id]/planning/[issueNumber]`\n- Works on both desktop (Kanban) and mobile (Accordion) layouts\n- Follows existing card patterns (EpicCard → PlanningSessionCard)\n\n## Files Affected\n\n### Primary Changes\n- `src/app/project/[id]/page.tsx` - Main implementation\n- `src/components/compact-cards.tsx` - New mobile card component\n\n### Reference Files (read-only)\n- `src/components/app-sidebar.tsx` - Existing planning sessions pattern\n- `src/lib/hooks/useProjects.ts` - usePlanningSessions hook\n- `src/lib/types/api.ts` - PlanningSessionInfo type\n\n## Execution Plan: Parallelization Guide\n\n```\nPARALLEL TRACK A (page.tsx):\n  sc7.1 (imports) \n    → sc7.2 (hook + remove readyToSwarm)\n      → sc7.3 (PlanningSessionCard component)\n        → sc7.4 (replace desktop column)\n\nPARALLEL TRACK B (compact-cards.tsx):  ← START IMMEDIATELY!\n  sc7.5 (CompactPlanningCard)\n\nJOIN POINT (after both tracks complete):\n  sc7.6 (import CompactPlanningCard in page.tsx)\n    → sc7.7 (replace mobile accordion)\n\nVERIFICATION (after all code changes):\n  sc7.8 (TypeScript check)\n    → sc7.9 (manual testing)  ← Can run in parallel\n    → sc7.10 (cleanup verify) ← Can run in parallel\n```\n\n**Key Optimization**: Task sc7.5 has NO dependencies on page.tsx changes. Start it immediately alongside sc7.1 to maximize parallelization.\n\n## Architecture Decisions\n\n### 1. No \"Start Planning\" CTA in Empty State\nPlanning is initiated from the issue detail page, not the kanban board. Adding a CTA would create a confusing parallel entry point and require additional routing logic.\n\n### 2. Title Formatting: Strip \"Issue #N\" Prefix\nThe API returns `issueTitle` like \"Issue #42\". Since we display the issue number separately, we strip this prefix for cleaner display. When real titles are available, they will show correctly.\n\n### 3. Remove Ready Column Entirely\nThe Ready column uses mock data that will never be real until epics are implemented. Keeping it would mislead users. When epics become real, a separate issue should add a proper \"Ready to Swarm\" column.\n\n### 4. Follow Existing Patterns\nThe sidebar already implements planning sessions display. We follow the same patterns: ClipboardList icon, text-primary color, same title formatting logic.\n\n## Success Criteria\n\n- [ ] Desktop: \"Ready\" column → \"Planning\" column with session cards\n- [ ] Mobile: \"Ready\" accordion → \"Planning\" accordion with session cards\n- [ ] Cards link to correct planning pages\n- [ ] Loading states show skeleton placeholders\n- [ ] Empty state shows helpful message (both lines on desktop AND mobile)\n- [ ] No references to mock \"readyToSwarm\" data remain\n- [ ] TypeScript compiles without errors\n- [ ] UI matches existing design patterns\n\n## Related\n- GitHub Issue: #13\n- Branch: feature/issue-13-replace-ready-column-with-planning-column-showing-","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2026-01-02T05:31:22.895999-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-sc7.1","title":"Update imports in page.tsx: add planning hook, ClipboardList icon, remove Circle","description":"## Task Overview\n\nUpdate the import statements in `src/app/project/[id]/page.tsx` to add the new dependencies needed for the Planning column and remove the imports that will no longer be used.\n\n## Background \u0026 Reasoning\n\nThe current implementation imports `Circle` from lucide-react for the \"Ready\" column icon. We are replacing this column with \"Planning\" which uses `ClipboardList` instead. We also need to import `usePlanningSessions` hook and `PlanningSessionInfo` type.\n\n### Why These Specific Changes?\n\n1. **ClipboardList icon**: Matches the sidebar pattern for planning sessions (see `app-sidebar.tsx:44`)\n2. **usePlanningSessions hook**: Already exists in `useProjects.ts:137-151`, provides planning session data\n3. **PlanningSessionInfo type**: Needed for type-safe props in the new PlanningSessionCard component\n4. **Remove Circle**: No longer needed after Ready column removal - keeps bundle size minimal\n\n## Changes Required\n\n### Add to lucide-react imports (line 14-25):\n```typescript\n// ADD: ClipboardList\nimport {\n  ChevronRight,\n  Zap,\n  CheckCircle,\n  MessageSquare,\n  GitBranch,\n  AlertCircle,\n  ClipboardList,  // NEW - replaces Circle\n  MoreHorizontal,\n  Plus,\n  CircleDot,\n} from \"lucide-react\";\n// REMOVE: Circle (line 21)\n```\n\n### Add to hooks import (line 8):\n```typescript\n// BEFORE:\nimport { useProject, useProjectIssues } from \"@/lib/hooks/useProjects\";\n\n// AFTER:\nimport { useProject, useProjectIssues, usePlanningSessions } from \"@/lib/hooks/useProjects\";\n```\n\n### Add type import (line 13):\n```typescript\n// BEFORE:\nimport type { GitHubIssue } from \"@/lib/types/api\";\n\n// AFTER:\nimport type { GitHubIssue, PlanningSessionInfo } from \"@/lib/types/api\";\n```\n\n## Verification\n\nAfter this change, the file should compile without errors. The `Circle` import warning (unused) should disappear and the new imports should be ready for use in subsequent tasks.\n\n## Files Changed\n- `src/app/project/[id]/page.tsx`\n\n## Acceptance Criteria\n- [ ] Circle import is removed from lucide-react\n- [ ] ClipboardList import is added to lucide-react\n- [ ] usePlanningSessions is imported from useProjects hook\n- [ ] PlanningSessionInfo type is imported from api types\n- [ ] No TypeScript errors","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T05:31:39.912782-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-sc7.10","title":"Clean up unused code: remove Circle from compact-cards.tsx if present","description":"## Task Overview\n\nVerify that `Circle` import is correctly handled in both files after all changes.\n\n## Background \u0026 Reasoning\n\n### Status After Changes\n\n**page.tsx:**\n- `Circle` was used in Ready column (desktop) and Ready accordion (mobile)\n- After our changes, `Circle` is NO LONGER USED in page.tsx\n- Task sc7.1 correctly removes it from imports\n\n**compact-cards.tsx:**\n- `Circle` is used by `CompactEpicCard` (line 46)\n- `CompactEpicCard` is used by Completed accordion (page.tsx line 184)\n- `Circle` MUST STAY in compact-cards.tsx\n\n## Verification Steps\n\n1. Check page.tsx:\n   ```bash\n   grep \"Circle\" src/app/project/[id]/page.tsx\n   # Should only show: CheckCircle, AlertCircle, CircleDot\n   # Should NOT show: Circle (standalone)\n   ```\n\n2. Check compact-cards.tsx:\n   ```bash\n   grep \"Circle\" src/components/compact-cards.tsx\n   # Should show: CircleDot, Circle\n   # Circle is correctly kept for CompactEpicCard\n   ```\n\n## Action Required\n\n**LIKELY NO ACTION NEEDED** - this task is for verification only.\n\nThe changes in sc7.1 correctly handle page.tsx, and sc7.5 correctly keeps Circle in compact-cards.tsx.\n\nHowever, IF during implementation you discover:\n- Circle is still imported in page.tsx → Remove it\n- Circle is accidentally removed from compact-cards.tsx → Add it back\n- CompactEpicCard is somehow unused → Then remove both Circle and CompactEpicCard\n\n## Priority\n\nThis is priority 2 (cleanup/verification) because the code will work even if there is an unused import - it is just not clean and will show a linter warning.\n\n## Files Potentially Changed\n- `src/components/compact-cards.tsx` (only if cleanup is needed)\n\n## Acceptance Criteria\n- [ ] Verified Circle is NOT in page.tsx imports\n- [ ] Verified Circle IS in compact-cards.tsx imports\n- [ ] Verified CompactEpicCard is still used (Completed section)\n- [ ] No unused import warnings from linter","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-02T05:34:37.65658-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-sc7.2","title":"Add usePlanningSessions hook call and remove readyToSwarm variable","description":"## Task Overview\n\nAdd the hook call to fetch planning sessions and remove the `readyToSwarm` variable that is no longer needed.\n\n## Background \u0026 Reasoning\n\n### Why Remove readyToSwarm?\n\nThe `readyToSwarm` variable (line 57) filters mock epics:\n```typescript\nconst readyToSwarm = mockEpics.filter((e) =\u003e e.state === \"planned\");\n```\n\nThis mock data will never become real until epics are implemented. Keeping it clutters the code and could confuse developers into thinking this is a working feature.\n\n### Why Add usePlanningSessions?\n\nThe planning sessions hook fetches real data from the API:\n```typescript\nconst { data: planningSessions = [], isLoading: planningLoading } = usePlanningSessions(projectId);\n```\n\nThis is the same pattern used in the sidebar (`app-sidebar.tsx:58`) and provides:\n- `data` (or `planningSessions`): Array of `PlanningSessionInfo` objects\n- `isLoading` (or `planningLoading`): Boolean for loading state\n- `error`: Error object if fetch failed (not used in this implementation)\n\n## Changes Required\n\n### Add hook call (after line 31):\n```typescript\n// EXISTING (line 31):\nconst { data: issues = [], isLoading: issuesLoading } = useProjectIssues(projectId);\n\n// ADD AFTER:\nconst { data: planningSessions = [], isLoading: planningLoading } = usePlanningSessions(projectId);\n```\n\n### Remove readyToSwarm (line 57):\n```typescript\n// DELETE THIS LINE:\nconst readyToSwarm = mockEpics.filter((e) =\u003e e.state === \"planned\");\n```\n\n## Why Named `planningLoading` Instead of `isLoading`?\n\nWe use destructuring rename to avoid collision with `issuesLoading`. This is the same pattern used throughout the file.\n\n## Order of Hook Calls\n\nKeeping the hooks together improves readability:\n1. `useParams()` - route params\n2. `useProject(projectId)` - project data\n3. `useProjectIssues(projectId)` - issues data\n4. `usePlanningSessions(projectId)` - **NEW** planning sessions data\n5. `useState` for dialog\n\n## Files Changed\n- `src/app/project/[id]/page.tsx`\n\n## Acceptance Criteria\n- [ ] usePlanningSessions hook is called with projectId\n- [ ] planningSessions defaults to empty array\n- [ ] planningLoading boolean is destructured\n- [ ] readyToSwarm variable is removed\n- [ ] No TypeScript errors about undefined readyToSwarm (will be addressed in subsequent tasks)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T05:31:54.835348-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-sc7.3","title":"Create PlanningSessionCard component for desktop kanban view","description":"## Task Overview\n\nCreate a new `PlanningSessionCard` component for displaying planning sessions in the desktop kanban board. This follows the existing card patterns (EpicCard, IssueCard) in the same file.\n\n## Background \u0026 Reasoning\n\n### Why a New Component?\n\nPlanning sessions have different data and routing than epics:\n- **Data shape**: `PlanningSessionInfo` vs `Epic`\n- **Route**: `/project/{id}/planning/{issueNumber}` vs `/project/{id}/epic/{epicId}`\n- **Display**: Issue number + title vs epic title + task count\n\n### Why Inline vs Separate File?\n\nFollowing the existing pattern, all kanban card components (IssueCard, EpicCard, SwarmCard, CompletedCard, SessionCard) are defined inline in `page.tsx`. This keeps related UI together and avoids prop drilling across files.\n\n## Component Implementation\n\nAdd this component after the `EpicCard` component (around line 497-520):\n\n```typescript\n// Planning Session Card (Active planning sessions)\nfunction PlanningSessionCard({ \n  session, \n  projectId \n}: { \n  session: PlanningSessionInfo; \n  projectId: string;\n}) {\n  // Format the display title - remove \"Issue #N\" prefix if present\n  // API may return \"Issue #42\" as title, but we show issue number separately\n  const displayTitle = session.issueTitle.replace(/^Issue #\\d+/, \"\").trim() || `Planning #${session.issueNumber}`;\n\n  return (\n    \u003cLink\n      href={`/project/${projectId}/planning/${session.issueNumber}`}\n      className=\"block p-3 rounded-md bg-card border border-border hover:border-primary/50 transition-colors group\"\n    \u003e\n      \u003cdiv className=\"flex items-start gap-2 mb-1\"\u003e\n        \u003cClipboardList className=\"h-3.5 w-3.5 text-primary flex-shrink-0 mt-0.5\" /\u003e\n        \u003ch4 className=\"font-medium text-sm flex-1\"\u003e{displayTitle}\u003c/h4\u003e\n      \u003c/div\u003e\n      \u003cdiv className=\"flex items-center justify-between ml-5.5\"\u003e\n        \u003cspan className=\"text-xs text-muted-foreground font-mono\"\u003e#{session.issueNumber}\u003c/span\u003e\n        \u003cChevronRight className=\"h-3.5 w-3.5 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity\" /\u003e\n      \u003c/div\u003e\n    \u003c/Link\u003e\n  );\n}\n```\n\n## Design Decisions\n\n### 1. Title Formatting Logic\n```typescript\nsession.issueTitle.replace(/^Issue #\\d+/, \"\").trim() || `Planning #${session.issueNumber}`\n```\n\nThis handles three cases:\n- Input: `\"Issue #42\"` → Output: `\"Planning #42\"` (fallback when API has placeholder)\n- Input: `\"Add dark mode\"` → Output: `\"Add dark mode\"` (real title shows as-is)\n- Input: `\"Issue #42 - Fix bug\"` → Output: `\"- Fix bug\"` (edge case, trimmed)\n\n### 2. Icon: ClipboardList with text-primary\nMatches sidebar pattern (`app-sidebar.tsx:75`). The primary color provides visual distinction from issues (green CircleDot) and completed items (muted CheckCircle).\n\n### 3. Hover Effect: border-primary/50\nMatches all other cards in the kanban. Provides consistent interaction feedback.\n\n### 4. Chevron Reveal on Hover\n```typescript\n\u003cChevronRight className=\"... opacity-0 group-hover:opacity-100 ...\" /\u003e\n```\nSame pattern as EpicCard, IssueCard - subtle affordance that this is clickable.\n\n### 5. ml-5.5 Spacing\nThe `ml-5.5` (Tailwind 4 arbitrary value) aligns the issue number with the title text (accounting for icon width + gap).\n\n## Placement in File\n\nInsert after `EpicCard` (ends around line 520) and before `IssueCard` (starts line 523). This keeps all card components grouped by type: Session → Epic → Planning → Issue → Completed.\n\n## Files Changed\n- `src/app/project/[id]/page.tsx`\n\n## Acceptance Criteria\n- [ ] PlanningSessionCard component is defined\n- [ ] Component accepts session (PlanningSessionInfo) and projectId props\n- [ ] Links to correct planning URL\n- [ ] Uses ClipboardList icon with text-primary color\n- [ ] Displays formatted title and issue number\n- [ ] Has hover effects matching other cards\n- [ ] No TypeScript errors","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T05:32:19.28262-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-sc7.4","title":"Replace desktop Ready KanbanColumn with Planning column","description":"## Task Overview\n\nReplace the \"Ready\" `KanbanColumn` in the desktop view with a \"Planning\" column that displays active planning sessions.\n\n## Background \u0026 Reasoning\n\n### Current Implementation (lines 213-224)\n```tsx\n{/* Ready Column */}\n\u003cKanbanColumn\n  title=\"Ready\"\n  icon={\u003cCircle className=\"h-3.5 w-3.5\" /\u003e}\n  iconColor=\"text-[hsl(var(--info))]\"\n  count={readyToSwarm.length}\n  accentColor=\"bg-[hsl(var(--info))]\"\n\u003e\n  {readyToSwarm.map((epic) =\u003e (\n    \u003cEpicCard key={epic.id} epic={epic} projectId={projectId} /\u003e\n  ))}\n\u003c/KanbanColumn\u003e\n```\n\n### Issues with Current Implementation\n1. Uses mock `readyToSwarm` data that will be removed\n2. Uses `Circle` icon which is being removed\n3. Shows placeholder content with no real value\n\n## New Implementation\n\nReplace the entire Ready column block with:\n\n```tsx\n{/* Planning Column */}\n\u003cKanbanColumn\n  title=\"Planning\"\n  icon={\u003cClipboardList className=\"h-3.5 w-3.5\" /\u003e}\n  iconColor=\"text-primary\"\n  count={planningSessions.length}\n  accentColor=\"bg-primary\"\n  isLoading={planningLoading}\n\u003e\n  {planningSessions.length \u003e 0 ? (\n    planningSessions.map((session) =\u003e (\n      \u003cPlanningSessionCard key={session.issueNumber} session={session} projectId={projectId} /\u003e\n    ))\n  ) : (\n    \u003cdiv className=\"p-4 text-center\"\u003e\n      \u003cp className=\"text-sm text-muted-foreground\"\u003eNo active planning sessions\u003c/p\u003e\n      \u003cp className=\"text-xs text-muted-foreground mt-1\"\u003eStart planning from an issue\u003c/p\u003e\n    \u003c/div\u003e\n  )}\n\u003c/KanbanColumn\u003e\n```\n\n## Key Changes Explained\n\n### 1. Title: \"Ready\" → \"Planning\"\nMore accurately describes what the column shows.\n\n### 2. Icon: Circle → ClipboardList\n- `Circle` icon represented \"ready to start\" status\n- `ClipboardList` represents \"planning in progress\"\n- Matches sidebar pattern for planning sessions\n\n### 3. Icon Color: text-[hsl(var(--info))] → text-primary\n- Info color (blue) was for \"ready\" state\n- Primary color matches sidebar planning icon\n- Creates visual consistency across the app\n\n### 4. Accent Color: bg-[hsl(var(--info))] → bg-primary\nThe bottom accent bar follows the same color change.\n\n### 5. Data Source: readyToSwarm → planningSessions\n- Switches from mock data to real API data\n- Uses the hook data set up in Task 2\n\n### 6. Loading State: Added isLoading={planningLoading}\nKanbanColumn already supports `isLoading` prop - shows skeleton while fetching.\n\n### 7. Empty State: Added contextual message\nWhen no planning sessions exist, show:\n- Main message: \"No active planning sessions\"\n- Helper text: \"Start planning from an issue\"\n\nThis guides users without being intrusive.\n\n### 8. Card Component: EpicCard → PlanningSessionCard\nUses the new component created in Task 3.\n\n### 9. Key Prop: epic.id → session.issueNumber\nEach planning session is uniquely identified by its issue number.\n\n## Column Order in Kanban\n\nThe column order remains:\n1. Issues (GitHub issues - starting point)\n2. **Planning** (in-progress planning) ← was \"Ready\"\n3. Active (running swarms)\n4. Completed (finished epics)\n\nThis flow makes sense: Issue → Planning → Active → Completed\n\n## Files Changed\n- `src/app/project/[id]/page.tsx`\n\n## Acceptance Criteria\n- [ ] Ready column is completely replaced\n- [ ] Title is \"Planning\"\n- [ ] Icon is ClipboardList with text-primary\n- [ ] Count shows planningSessions.length\n- [ ] Accent bar is bg-primary\n- [ ] Loading state is passed to KanbanColumn\n- [ ] Empty state shows helpful messages\n- [ ] PlanningSessionCard is used for each session\n- [ ] No references to readyToSwarm remain in this section","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T05:32:41.29405-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-sc7.5","title":"Create CompactPlanningCard component in compact-cards.tsx","description":"## Task Overview\n\nCreate a new `CompactPlanningCard` component in `src/components/compact-cards.tsx` for displaying planning sessions in the mobile accordion view. This follows the existing compact card patterns.\n\n## PARALLELIZATION NOTE\n\n**This task can run in PARALLEL with sc7.1, sc7.2, sc7.3, and sc7.4!** It operates on a completely different file (`compact-cards.tsx`) and has no dependencies on the page.tsx changes. Start this task immediately to maximize parallelization.\n\n## Background \u0026 Reasoning\n\n### Why a Separate Component File?\n\nMobile compact cards are in a dedicated file (`compact-cards.tsx`) because:\n1. **Separation of concerns**: Mobile cards have different styling (min-height for touch targets)\n2. **Reusability**: These cards could be used elsewhere in mobile views\n3. **Consistency**: All compact cards are defined together\n\n### Existing Pattern Reference\n\nLooking at `CompactIssueCard` (lines 16-30):\n```typescript\nexport function CompactIssueCard({ issue, projectId }: CompactIssueCardProps) {\n  return (\n    \u003cLink\n      href={`/project/${projectId}/issue/${issue.number}`}\n      className=\"flex items-center gap-3 p-3 rounded-md bg-card border border-border hover:bg-secondary/50 active:bg-secondary min-h-[44px]\"\n    \u003e\n      \u003cCircleDot className=\"h-4 w-4 text-[hsl(var(--success))] flex-shrink-0\" /\u003e\n      \u003cdiv className=\"flex-1 min-w-0\"\u003e\n        \u003cp className=\"text-sm font-medium truncate\"\u003e{issue.title}\u003c/p\u003e\n        \u003cp className=\"text-xs text-muted-foreground\"\u003e#{issue.number}\u003c/p\u003e\n      \u003c/div\u003e\n      \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n    \u003c/Link\u003e\n  );\n}\n```\n\n## Implementation\n\n### Add to imports (line 4):\n```typescript\n// BEFORE:\nimport { CircleDot, Circle, ChevronRight, MessageSquare } from \"lucide-react\";\n\n// AFTER:\nimport { CircleDot, Circle, ChevronRight, MessageSquare, ClipboardList } from \"lucide-react\";\n```\n\nNOTE: Keep `Circle` - it is still used by `CompactEpicCard` for the Completed section.\n\n### Add type import (line 7):\n```typescript\n// BEFORE:\nimport { GitHubIssue } from \"@/lib/types/api\";\n\n// AFTER:\nimport { GitHubIssue, PlanningSessionInfo } from \"@/lib/types/api\";\n```\n\n### Add component (at end of file, after CompactSessionCard):\n\n```typescript\n// CompactPlanningCard - for active planning sessions in mobile accordion\ninterface CompactPlanningCardProps {\n  session: PlanningSessionInfo;\n  projectId: string;\n}\n\nexport function CompactPlanningCard({ session, projectId }: CompactPlanningCardProps) {\n  // Format the display title - remove \"Issue #N\" prefix if present\n  const displayTitle = session.issueTitle.replace(/^Issue #\\d+/, \"\").trim() || `Planning #${session.issueNumber}`;\n\n  return (\n    \u003cLink\n      href={`/project/${projectId}/planning/${session.issueNumber}`}\n      className=\"flex items-center gap-3 p-3 rounded-md bg-card border border-border hover:bg-secondary/50 active:bg-secondary min-h-[44px]\"\n    \u003e\n      \u003cClipboardList className=\"h-4 w-4 text-primary flex-shrink-0\" /\u003e\n      \u003cdiv className=\"flex-1 min-w-0\"\u003e\n        \u003cp className=\"text-sm font-medium truncate\"\u003e{displayTitle}\u003c/p\u003e\n        \u003cp className=\"text-xs text-muted-foreground\"\u003e#{session.issueNumber}\u003c/p\u003e\n      \u003c/div\u003e\n      \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n    \u003c/Link\u003e\n  );\n}\n```\n\n## Key Design Elements\n\n### 1. min-h-[44px] Touch Target\nApple Human Interface Guidelines recommend 44px minimum touch targets for mobile.\n\n### 2. active:bg-secondary\nMobile-specific feedback for touch interactions. Shows immediate response on tap.\n\n### 3. truncate Class\nEnsures long titles dont break layout on narrow mobile screens.\n\n### 4. Same Title Formatting as Desktop\n```typescript\nsession.issueTitle.replace(/^Issue #\\d+/, \"\").trim() || `Planning #${session.issueNumber}`\n```\nConsistent behavior across desktop and mobile views.\n\n### 5. flex-shrink-0 on Icon and Chevron\nPrevents icons from shrinking when title is long.\n\n### 6. min-w-0 on Content Container\nRequired for truncate to work properly with flex layout.\n\n## Files Changed\n- `src/components/compact-cards.tsx`\n\n## Acceptance Criteria\n- [ ] PlanningSessionInfo type is imported\n- [ ] ClipboardList icon is imported (Circle stays!)\n- [ ] CompactPlanningCard component is exported\n- [ ] Component matches existing compact card patterns\n- [ ] Uses text-primary color for icon\n- [ ] Has 44px minimum height\n- [ ] Title formatting matches desktop component\n- [ ] No TypeScript errors","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T05:33:03.892689-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-sc7.6","title":"Update page.tsx imports to include CompactPlanningCard","description":"## Task Overview\n\nUpdate the import statement in `page.tsx` to include the new `CompactPlanningCard` component from `compact-cards.tsx`.\n\n## Background \u0026 Reasoning\n\nTask 5 creates `CompactPlanningCard` in the compact-cards file. Before we can use it in the mobile accordion (Task 7), we need to import it.\n\n## Current Import (line 9):\n```typescript\nimport { CompactSessionCard, CompactIssueCard, CompactEpicCard, CompactSwarmCard } from \"@/components/compact-cards\";\n```\n\n## New Import:\n```typescript\nimport { CompactSessionCard, CompactIssueCard, CompactEpicCard, CompactSwarmCard, CompactPlanningCard } from \"@/components/compact-cards\";\n```\n\n## Why This Order?\n\nAdding `CompactPlanningCard` at the end maintains alphabetical-ish consistency:\n- CompactSessionCard (sessions)\n- CompactIssueCard (issues) \n- CompactEpicCard (epics)\n- CompactSwarmCard (swarms)\n- CompactPlanningCard (planning) ← NEW\n\n## Dependencies\n\nThis task depends on Task 5 being complete, as the component must exist before it can be imported.\n\n## Files Changed\n- `src/app/project/[id]/page.tsx`\n\n## Acceptance Criteria\n- [ ] CompactPlanningCard is imported from compact-cards\n- [ ] Import statement is syntactically correct\n- [ ] No TypeScript errors about missing export","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T05:33:15.331218-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-sc7.7","title":"Replace mobile Ready AccordionItem with Planning section","description":"## Task Overview\n\nReplace the \"Ready\" `AccordionItem` in the mobile view with a \"Planning\" section that displays active planning sessions using the `CompactPlanningCard` component.\n\n## Background \u0026 Reasoning\n\n### Current Implementation (lines 121-143)\n```tsx\n{/* Ready Section */}\n\u003cAccordionItem value=\"ready\"\u003e\n  \u003cAccordionTrigger className=\"py-3\"\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cCircle className=\"h-4 w-4 text-[hsl(var(--info))]\" /\u003e\n      \u003cspan className=\"font-medium\"\u003eReady\u003c/span\u003e\n      \u003cspan className=\"text-xs text-muted-foreground bg-secondary rounded-full px-2 py-0.5\"\u003e\n        {readyToSwarm.length}\n      \u003c/span\u003e\n    \u003c/div\u003e\n  \u003c/AccordionTrigger\u003e\n  \u003cAccordionContent\u003e\n    \u003cdiv className=\"space-y-2\"\u003e\n      {readyToSwarm.length \u003e 0 ? (\n        readyToSwarm.map((epic) =\u003e (\n          \u003cCompactEpicCard key={epic.id} epic={epic} projectId={projectId} /\u003e\n        ))\n      ) : (\n        \u003cp className=\"text-sm text-muted-foreground text-center py-4\"\u003eNo epics ready to swarm\u003c/p\u003e\n      )}\n    \u003c/div\u003e\n  \u003c/AccordionContent\u003e\n\u003c/AccordionItem\u003e\n```\n\n## New Implementation\n\n```tsx\n{/* Planning Section */}\n\u003cAccordionItem value=\"planning\"\u003e\n  \u003cAccordionTrigger className=\"py-3\"\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cClipboardList className=\"h-4 w-4 text-primary\" /\u003e\n      \u003cspan className=\"font-medium\"\u003ePlanning\u003c/span\u003e\n      \u003cspan className=\"text-xs text-muted-foreground bg-secondary rounded-full px-2 py-0.5\"\u003e\n        {planningLoading ? \"...\" : planningSessions.length}\n      \u003c/span\u003e\n    \u003c/div\u003e\n  \u003c/AccordionTrigger\u003e\n  \u003cAccordionContent\u003e\n    \u003cdiv className=\"space-y-2\"\u003e\n      {planningLoading ? (\n        \u003cdiv className=\"space-y-2\"\u003e\n          \u003cSkeleton className=\"h-16 w-full\" /\u003e\n          \u003cSkeleton className=\"h-16 w-full\" /\u003e\n        \u003c/div\u003e\n      ) : planningSessions.length \u003e 0 ? (\n        planningSessions.map((session) =\u003e (\n          \u003cCompactPlanningCard key={session.issueNumber} session={session} projectId={projectId} /\u003e\n        ))\n      ) : (\n        \u003cdiv className=\"text-center py-4\"\u003e\n          \u003cp className=\"text-sm text-muted-foreground\"\u003eNo active planning sessions\u003c/p\u003e\n          \u003cp className=\"text-xs text-muted-foreground mt-1\"\u003eStart planning from an issue\u003c/p\u003e\n        \u003c/div\u003e\n      )}\n    \u003c/div\u003e\n  \u003c/AccordionContent\u003e\n\u003c/AccordionItem\u003e\n```\n\n## Key Changes Explained\n\n### 1. Accordion Value: \"ready\" → \"planning\"\nThe value prop is used for accessibility and state management.\n\n### 2. Icon: Circle → ClipboardList\nSame change as desktop - matches sidebar pattern for planning sessions.\n\n### 3. Icon Color: text-[hsl(var(--info))] → text-primary\nConsistent with desktop column and sidebar.\n\n### 4. Title: \"Ready\" → \"Planning\"\nMatches desktop column title.\n\n### 5. Count Badge: Shows Loading State\n```tsx\n{planningLoading ? \"...\" : planningSessions.length}\n```\nShows \"...\" while loading, actual count when loaded.\n\n### 6. Loading State with Skeletons\nShows two skeleton cards while loading - matches Issues section pattern.\n\n### 7. Empty State: TWO LINES (Matching Desktop)\nPreviously only had one line. Now matches desktop:\n- Main: \"No active planning sessions\"\n- Helper: \"Start planning from an issue\"\n\n### 8. Card Component: CompactEpicCard → CompactPlanningCard\nUses the component created in Task 5.\n\n### 9. Empty Message Updated\n- Before: \"No epics ready to swarm\"\n- After: Two-line message matching desktop\n\n## Accordion Default Value Consideration\n\nThe Accordion has `defaultValue=\"issues\"` (line 83). This means Issues is expanded by default. We are NOT changing this because:\n1. Issues is the starting point for users\n2. Planning sessions are less common than issues\n3. Changing default could disrupt existing user expectations\n\n## Files Changed\n- `src/app/project/[id]/page.tsx`\n\n## Acceptance Criteria\n- [ ] AccordionItem value is \"planning\"\n- [ ] Icon is ClipboardList with text-primary\n- [ ] Title is \"Planning\"\n- [ ] Count badge shows \"...\" while loading\n- [ ] Skeleton loading state is shown\n- [ ] CompactPlanningCard is used for sessions\n- [ ] Empty state has TWO lines matching desktop\n- [ ] No references to readyToSwarm remain in this section","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T05:33:37.613511-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-sc7.8","title":"Verify TypeScript compilation and fix any type errors","description":"## Task Overview\n\nRun TypeScript compilation to verify all changes compile without errors. Fix any type errors that arise.\n\n## Background \u0026 Reasoning\n\nAfter making multiple interconnected changes across files, TypeScript compilation ensures:\n1. All imports resolve correctly\n2. Component props match their type definitions\n3. No unused variables remain (if strict mode)\n4. Type narrowing works correctly in conditional renders\n\n## Verification Steps\n\n```bash\n# Run TypeScript compiler in check mode\nnpx tsc --noEmit\n\n# Or if using Next.js type checking\nnpm run type-check\n\n# Or run the build (also catches type errors)\nnpm run build\n```\n\n## Common Issues to Watch For\n\n### 1. Missing Import\nIf `CompactPlanningCard` is used but not imported:\n```\nError: Cannot find name CompactPlanningCard.\n```\nFix: Ensure Task 6 was completed (import added to page.tsx)\n\n### 2. Type Mismatch on Props\nIf `PlanningSessionInfo` properties dont match component expectations:\n```\nError: Property X does not exist on type PlanningSessionInfo.\n```\nFix: Verify component uses only properties defined in `src/lib/types/api.ts:38-43`\n\n### 3. Unused Import Warning\nIf `Circle` icon is still imported but not used:\n```\nWarning: Circle is declared but never used.\n```\nFix: Remove `Circle` from lucide-react imports in both files\n\n### 4. Missing Export\nIf `CompactPlanningCard` is defined but not exported from compact-cards.tsx:\n```\nError: Module has no exported member CompactPlanningCard.\n```\nFix: Ensure the function has `export` keyword\n\n## Files That May Have Errors\n- `src/app/project/[id]/page.tsx` - Main changes\n- `src/components/compact-cards.tsx` - New component\n\n## Acceptance Criteria\n- [ ] `npx tsc --noEmit` passes with no errors\n- [ ] No ESLint errors in modified files\n- [ ] All imports resolve correctly\n- [ ] Build completes successfully (if running full build)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T05:33:53.233266-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-sc7.9","title":"Manual testing: verify Planning column displays correctly","description":"## Task Overview\n\nPerform manual testing to verify the Planning column works correctly in both desktop and mobile views.\n\n## Background \u0026 Reasoning\n\nAutomated tests cannot fully verify:\n1. Visual appearance and styling\n2. Navigation to correct routes\n3. Loading state animations\n4. Responsive behavior\n5. User interaction feel\n\n## Test Prerequisites\n\n1. Development server running (`npm run dev`)\n2. At least one project configured in maestro\n3. Ideally, an active planning session to test with (or test empty state)\n\n## Desktop Testing (lg breakpoint and above)\n\n### Test 1: Planning Column Visibility\n1. Navigate to `/project/[id]`\n2. Resize browser to \u003e= 1024px width\n3. **Verify**: Planning column is visible between Issues and Active columns\n4. **Verify**: Column header shows \"Planning\" with ClipboardList icon\n\n### Test 2: Empty State\n(When no planning sessions exist)\n1. **Verify**: Column shows \"No active planning sessions\"\n2. **Verify**: Helper text shows \"Start planning from an issue\"\n3. **Verify**: Text is centered in the column\n\n### Test 3: Loading State\n1. Throttle network in DevTools (Slow 3G)\n2. Refresh the page\n3. **Verify**: Skeleton placeholders appear in Planning column\n4. **Verify**: Count badge shows correct number once loaded\n\n### Test 4: With Active Sessions\n(If you have planning sessions)\n1. **Verify**: Cards display with ClipboardList icon\n2. **Verify**: Title is formatted correctly (no \"Issue #N\" prefix unless thats the real title)\n3. **Verify**: Issue number shows in format \"#{number}\"\n4. **Verify**: Hover shows border color change and chevron\n\n### Test 5: Navigation\n1. Click a planning session card\n2. **Verify**: Navigates to `/project/[id]/planning/[issueNumber]`\n3. **Verify**: Planning page loads correctly\n\n## Mobile Testing (\u003c lg breakpoint)\n\n### Test 6: Accordion Visibility\n1. Resize browser to \u003c 1024px width (or use mobile device)\n2. **Verify**: \"Planning\" accordion section exists\n3. **Verify**: Accordion trigger shows ClipboardList icon, \"Planning\" text, and count badge\n\n### Test 7: Accordion Expand/Collapse\n1. Click on Planning accordion\n2. **Verify**: Section expands smoothly\n3. Click again\n4. **Verify**: Section collapses smoothly\n\n### Test 8: Mobile Empty State\n1. With no planning sessions\n2. Expand Planning accordion\n3. **Verify**: Shows \"No active planning sessions\"\n\n### Test 9: Mobile Loading State\n1. Throttle network, refresh page\n2. Open Planning accordion\n3. **Verify**: Two skeleton cards appear while loading\n4. **Verify**: Count badge shows \"...\" while loading\n\n### Test 10: Mobile Card Tap\n1. With planning sessions, tap a CompactPlanningCard\n2. **Verify**: Card shows active state (bg-secondary)\n3. **Verify**: Navigates to correct planning page\n\n## Browser Compatibility (Optional)\n\nTest in:\n- [ ] Chrome/Chromium\n- [ ] Firefox\n- [ ] Safari (macOS/iOS)\n- [ ] Edge\n\n## Acceptance Criteria\n- [ ] Desktop: Column displays correctly in kanban\n- [ ] Desktop: Cards link to correct planning pages\n- [ ] Desktop: Empty and loading states work\n- [ ] Mobile: Accordion section works\n- [ ] Mobile: Cards show correct styling and navigation\n- [ ] No console errors during testing","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-02T05:34:20.623886-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm","title":"Project List: Add and Manage Projects via Remote Filesystem Browser","description":"## Overview\n\nImplement the project list view - the main entry point to Maestro. This replaces the current mock data with a real persistence layer and adds a custom folder browser for adding projects from the server's filesystem.\n\n## Background \u0026 Context\n\n### Why This Matters\nMaestro is a mobile-friendly web frontend for OpenCode that runs on a user's dev machine and is accessed remotely via Tailscale. The project list is the **first screen users see** and the **foundation for all other features**. Without real project persistence, nothing else in Maestro can function.\n\n### Technical Constraint: Remote Access\nBecause Maestro runs as a Next.js server on the dev machine but is accessed from remote clients (phone, tablet, another laptop via Tailscale):\n- **Browser file picker APIs won't work** - they open on the client device, not the server\n- **We need a custom server-side folder browser** that exposes the server's filesystem\n- **All storage is server-side** - config lives at `~/.maestro/config.json` on the dev machine\n\n### Current State\n- `src/app/page.tsx` displays mock projects from `src/lib/data/mock.ts`\n- `src/components/ui/sidebar.tsx` also uses mock data\n- No API routes exist yet\n- No persistence layer exists\n\n### Target State\n- Real project storage in `~/.maestro/config.json`\n- Full CRUD API for projects\n- Filesystem browsing API (constrained to home directory)\n- Folder browser modal for adding projects\n- Project card management (edit name, remove, relocate missing)\n- Proper loading/error states throughout\n\n## Task Structure (10 Tasks)\n\n### Foundation Layer (P0) - Sequential start\n1. **Foundation: Dependencies \u0026 React Query Setup** - Install dependencies, add shadcn components, set up QueryClientProvider\n2. **Config Service** - Create `~/.maestro/config.json` persistence layer with type-safe CRUD operations\n\n### API Layer (P0) - Can parallelize after Config Service\n3. **Projects API** - All 4 endpoints: GET, POST, PATCH, DELETE /api/projects\n4. **Filesystem Browse API** - GET /api/filesystem/browse endpoint for folder picker\n\n### Data Layer (P1) - Bridges backend to frontend\n5. **React Query Hooks** - useProjects, useAddProject, useUpdateProject, useDeleteProject, useFilesystem\n\n### UI Layer (P1) - Core user-facing features\n6. **FolderBrowserModal** - Complete modal with directory list, breadcrumbs, and add project form\n7. **Project List Page** - Replace mock data, add loading/error/empty states, header Add button\n\n### Polish Layer (P2) - Enhanced UX (can parallelize 28 \u0026 31)\n8. **ProjectCard Component** - Extract card with dropdown menu, edit name dialog\n9. **Missing Project Detection \u0026 Relocate** - Warning UI for missing projects, relocate dialog\n10. **Sidebar Integration** - Fetch from API, wire + button to folder browser\n\n## Dependency Graph (Corrected)\n```\n[22. Foundation] \n      |\n      v\n[23. Config Service]\n      |\n      +---------------+\n      |               |\n      v               v\n[24. Projects API] [25. Filesystem API]\n      |               |\n      +-------+-------+\n              |\n              v\n      [26. React Query Hooks]\n              |\n              v\n      [27. FolderBrowserModal]\n              |\n      +-------+-------+\n      |               |\n      v               v\n[28. Project List] [31. Sidebar]\n      |\n      v\n[29. ProjectCard]\n      |\n      v\n[30. Missing/Relocate]\n```\n\n## Parallelization Opportunities\n- **Wave 3**: Tasks 24 and 25 can run in parallel (both depend only on 23)\n- **Wave 6**: Tasks 28 and 31 can run in parallel (both depend on 26 and 27)\n\n## Key Design Decisions\n\n### UUID-based Project IDs\nProjects get UUID v4 identifiers used in routing (`/project/[id]`). This decouples the URL from the filesystem path, allowing projects to be relocated without breaking links.\n\n### Display Name Derivation\nWhen no custom name is set, derive from path: `/Users/erik/dev/my-project` -\u003e `my-project`.\n\n### Security Boundary\nAll filesystem operations constrained to user's home directory. No browsing `/etc`, `/usr`, etc.\n\n### FolderBrowserModal Reuse\nThe modal supports both \"Add Project\" and \"Relocate Project\" modes via props, avoiding code duplication.\n\n### Symlink Resolution\nPaths are resolved via `fs.realpath()` before storing to avoid issues when symlinks change.\n\n## References\n- GitHub Issue: #1\n- SCOPE.md: Project overview and architecture\n- AGENTS.md: Development workflow guidelines","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-30T07:55:02.722791-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:57.165223-06:00","close_reason":"Completed","deleted_at":"2025-12-31T08:43:57.165223-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-slm.1","title":"1.1 Create config service for ~/.maestro/config.json","description":"## Purpose\nCreate the persistence layer for Maestro's project configuration. This service handles reading/writing `~/.maestro/config.json` and provides type-safe access to project data.\n\n## Why a Dedicated Service?\n1. **Single source of truth** - All config access goes through one place\n2. **Auto-initialization** - Creates `~/.maestro/` and `config.json` on first use\n3. **Type safety** - TypeScript interfaces for all data structures\n4. **Error handling** - Graceful handling of missing/corrupted files\n5. **Path utilities** - Centralized logic for home directory, path display, etc.\n\n## Config File Location\n```\n~/.maestro/config.json\n```\nUse `os.homedir()` to resolve `~`. This is the home of the user running the Next.js server.\n\n## Config Schema\n```typescript\n// src/lib/types/config.ts\ninterface MaestroConfig {\n  projects: ProjectConfig[];\n}\n\ninterface ProjectConfig {\n  id: string;          // UUID v4\n  path: string;        // Absolute path: /Users/erik/dev/project\n  name: string | null; // Custom display name, null = derive from path\n  addedAt: string;     // ISO 8601 timestamp\n}\n```\n\n## Service API\n```typescript\n// src/lib/services/config.ts\nclass ConfigService {\n  // Core operations\n  async getConfig(): Promise\u003cMaestroConfig\u003e\n  async saveConfig(config: MaestroConfig): Promise\u003cvoid\u003e\n  \n  // Project helpers\n  async getProjects(): Promise\u003cProjectConfig[]\u003e\n  async getProject(id: string): Promise\u003cProjectConfig | null\u003e\n  async addProject(path: string, name?: string): Promise\u003cProjectConfig\u003e\n  async updateProject(id: string, updates: Partial\u003cProjectConfig\u003e): Promise\u003cProjectConfig\u003e\n  async deleteProject(id: string): Promise\u003cvoid\u003e\n  \n  // Path utilities\n  getHomeDir(): string\n  toDisplayPath(absolutePath: string): string  // /Users/erik/dev → ~/dev\n  toAbsolutePath(displayPath: string): string  // ~/dev → /Users/erik/dev\n  deriveDisplayName(path: string): string      // /Users/erik/dev/foo → foo\n  isWithinHome(path: string): boolean          // Security check\n}\n```\n\n## Implementation Notes\n\n### Auto-initialization\n```typescript\nasync getConfig(): Promise\u003cMaestroConfig\u003e {\n  const configPath = path.join(os.homedir(), '.maestro', 'config.json');\n  try {\n    const content = await fs.readFile(configPath, 'utf-8');\n    return JSON.parse(content);\n  } catch (err) {\n    if (err.code === 'ENOENT') {\n      // First run - create default config\n      const defaultConfig = { projects: [] };\n      await this.saveConfig(defaultConfig);\n      return defaultConfig;\n    }\n    throw err;\n  }\n}\n```\n\n### Directory Creation\n```typescript\nasync saveConfig(config: MaestroConfig): Promise\u003cvoid\u003e {\n  const dir = path.join(os.homedir(), '.maestro');\n  await fs.mkdir(dir, { recursive: true }); // No-op if exists\n  await fs.writeFile(\n    path.join(dir, 'config.json'),\n    JSON.stringify(config, null, 2)\n  );\n}\n```\n\n### UUID Generation\nUse `crypto.randomUUID()` (built into Node.js 19+) or install `uuid` package.\n\n## Edge Cases\n- **Corrupted JSON**: Throw clear error, let API layer handle (could offer reset option later)\n- **Permission denied**: Throw, user needs to fix permissions\n- **Concurrent writes**: Last write wins (acceptable for v1, single user)\n- **Symlinks in path**: Resolve with `fs.realpath()` before storing\n\n## Acceptance Criteria\n- [ ] `~/.maestro/` directory created automatically\n- [ ] `config.json` created with empty projects array on first access\n- [ ] All CRUD operations work correctly\n- [ ] Path utility functions work correctly\n- [ ] Security check rejects paths outside home directory\n- [ ] Type definitions exported for use by API routes\n\n## Dependencies\n- Task 7.2 (React Query) should ideally be done first, but this can proceed in parallel as it's server-side only\n\n## Files\n- `src/lib/types/config.ts` (new) - Type definitions\n- `src/lib/services/config.ts` (new) - Service implementation","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:02.793402-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: consolidated into new task structure for better cohesion","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.10","title":"4.1 Update project list page to fetch from API","description":"## Purpose\nUpdate the project list page (`src/app/page.tsx`) to fetch real data from the API instead of using mock data. This is the core integration that makes the project list functional.\n\n## Current State\n```typescript\n// Current - uses mock data\nimport { mockProjects } from \"@/lib/data/mock\";\n// ...\n{mockProjects.map((project) =\u003e (\n```\n\n## Target State\n```typescript\n// Target - fetches from API\nimport { useProjects } from \"@/lib/hooks/useProjects\";\n// ...\nconst { data: projects, isLoading, error } = useProjects();\n// Handle loading, error, empty states\n// Map over real projects\n```\n\n## Changes Required\n\n### 1. Import useProjects hook\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\n```\n\n### 2. Replace mock data with hook\n```typescript\nexport default function ProjectListPage() {\n  const { data: projects, isLoading, error, refetch } = useProjects();\n  \n  // ... render based on state\n}\n```\n\n### 3. Update project card rendering\nThe API returns a slightly different shape than mock data:\n- `displayName` instead of `name` (computed field)\n- `displayPath` instead of `path` for display\n- `status` field for missing detection\n- No `activeSwarms`, `inProgress`, `lastActivity` yet (placeholders)\n\n```typescript\n{projects?.map((project) =\u003e (\n  \u003cLink \n    key={project.id} \n    href={`/project/${project.id}`}\n    className={cn(\n      \"flex items-center gap-3 px-3 py-2.5 hover:bg-secondary/50 transition-colors\",\n      project.status === \"missing\" \u0026\u0026 \"opacity-60\"\n    )}\n  \u003e\n    {/* ... */}\n    \u003cspan className=\"font-medium text-sm\"\u003e{project.displayName}\u003c/span\u003e\n    \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n      {project.displayPath}\n    \u003c/p\u003e\n    {/* ... */}\n  \u003c/Link\u003e\n))}\n```\n\n### 4. Handle loading state\nShow skeleton cards while loading:\n```typescript\nif (isLoading) {\n  return (\n    \u003cdiv className=\"border border-border rounded-md overflow-hidden divide-y divide-border\"\u003e\n      {[1, 2, 3].map((i) =\u003e (\n        \u003cProjectCardSkeleton key={i} /\u003e\n      ))}\n    \u003c/div\u003e\n  );\n}\n```\n\n### 5. Handle error state\nShow error with retry:\n```typescript\nif (error) {\n  return (\n    \u003cdiv className=\"text-center py-8\"\u003e\n      \u003cp className=\"text-destructive mb-2\"\u003eFailed to load projects\u003c/p\u003e\n      \u003cButton variant=\"outline\" onClick={() =\u003e refetch()}\u003e\n        Retry\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### 6. Handle empty state\nWhen no projects exist:\n```typescript\nif (!projects?.length) {\n  return \u003cNoProjectsEmptyState onAddProject={openFolderBrowser} /\u003e;\n}\n```\n\n(Empty state component is separate task 4.2)\n\n## Placeholder Data\nUntil we integrate with OpenCode for activity data, use static placeholders:\n- `activeSwarms`: 0 (or hide indicator)\n- `inProgress`: 0 (or hide indicator)\n- `lastActivity`: Show `addedAt` date formatted, or hide\n\n## Type Updates\nCreate or update types to match API response:\n```typescript\n// Can use types from useProjects hook\ninterface Project {\n  id: string;\n  path: string;\n  displayPath: string;\n  name: string | null;\n  displayName: string;\n  addedAt: string;\n  status: \"active\" | \"missing\";\n}\n```\n\n## Acceptance Criteria\n- [ ] Fetches projects from GET /api/projects\n- [ ] Renders project cards with displayName and displayPath\n- [ ] Handles loading state with skeletons\n- [ ] Handles error state with retry button\n- [ ] Empty check (for task 4.2 empty state)\n- [ ] Clicking project navigates to /project/[id]\n- [ ] Missing projects shown with different styling\n- [ ] Remove import of mockProjects\n\n## Dependencies\n- **Requires**: Task 7.1 (useProjects hook)\n- **Requires**: Task 7.2 (React Query provider)\n- **Requires**: Tasks 1.2 (GET /api/projects endpoint)\n\n## Files\n- `src/app/page.tsx` (modify)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.30898-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Project List Page task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.11","title":"4.2 Add empty state to project list page","description":"## Purpose\nCreate a compelling empty state for when users first open Maestro with no projects configured. This is the first impression for new users and should guide them to add their first project.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────┐\n│                                                 │\n│                   [folder icon]                 │\n│                                                 │\n│              No projects yet                    │\n│                                                 │\n│     Add a project folder to get started         │\n│                                                 │\n│            [ + Add Project ]                    │\n│                                                 │\n└─────────────────────────────────────────────────┘\n```\n\n## Component\n```typescript\n// src/components/empty-states/NoProjects.tsx\nimport { Folder, Plus } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface NoProjectsProps {\n  onAddProject: () =\u003e void;\n}\n\nexport function NoProjects({ onAddProject }: NoProjectsProps) {\n  return (\n    \u003cdiv className=\"flex flex-col items-center justify-center py-16 px-4 text-center\"\u003e\n      {/* Icon */}\n      \u003cdiv className=\"w-16 h-16 rounded-full bg-secondary flex items-center justify-center mb-6\"\u003e\n        \u003cFolder className=\"h-8 w-8 text-muted-foreground\" /\u003e\n      \u003c/div\u003e\n      \n      {/* Heading */}\n      \u003ch2 className=\"text-lg font-semibold mb-2\"\u003eNo projects yet\u003c/h2\u003e\n      \n      {/* Description */}\n      \u003cp className=\"text-sm text-muted-foreground mb-6 max-w-sm\"\u003e\n        Add a project folder to get started. Maestro will help you manage ideas, \n        plan tasks, and run agent swarms.\n      \u003c/p\u003e\n      \n      {/* CTA */}\n      \u003cButton onClick={onAddProject}\u003e\n        \u003cPlus className=\"h-4 w-4 mr-2\" /\u003e\n        Add Project\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Integration with page.tsx\n```typescript\n// In ProjectListPage\nconst [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n\n// ...\n\nif (!projects?.length) {\n  return (\n    \u003c\u003e\n      \u003cNoProjects onAddProject={() =\u003e setFolderBrowserOpen(true)} /\u003e\n      \u003cFolderBrowserModal \n        open={folderBrowserOpen} \n        onOpenChange={setFolderBrowserOpen}\n      /\u003e\n    \u003c/\u003e\n  );\n}\n```\n\n## Design Considerations\n\n### Illustration vs Icon\nFor v1, use a simple folder icon. Could upgrade to a custom illustration later, but icon is faster to implement and still looks good.\n\n### Copy\n- Keep it short and friendly\n- \"No projects yet\" - clear state\n- \"Add a project folder to get started\" - clear action\n- Additional context about what Maestro does - helps new users understand value\n\n### Button\n- Use primary button for strong CTA\n- Include icon for visual clarity\n- Same action as header \"Add Project\" button\n\n## Mobile Behavior\n- Centered layout works well on all screen sizes\n- Adequate padding on mobile\n- Touch-friendly button\n\n## Accessibility\n- Heading hierarchy (h2)\n- Button has clear label\n- Icon is decorative (no aria-label needed)\n\n## Acceptance Criteria\n- [ ] Shows when projects array is empty\n- [ ] Displays folder icon\n- [ ] Shows \"No projects yet\" heading\n- [ ] Shows helpful description text\n- [ ] \"Add Project\" button opens folder browser modal\n- [ ] Centered layout\n- [ ] Mobile-friendly\n\n## Dependencies\n- **Requires**: Task 3.3 (FolderBrowserModal)\n- **Used by**: Task 4.1 (project list page integration)\n\n## Files\n- `src/components/empty-states/NoProjects.tsx` (new)\n- `src/app/page.tsx` (integrate)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.369725-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Project List Page task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.12","title":"4.3 Add loading and error states to project list","description":"## Purpose\nAdd proper loading and error states to the project list page. Good loading/error UX is essential for a polished feel and helps users understand system state.\n\n## Loading State\n\n### Skeleton Cards\nShow placeholder cards that match the shape of real project cards:\n```typescript\nfunction ProjectCardSkeleton() {\n  return (\n    \u003cdiv className=\"flex items-center gap-3 px-3 py-2.5 animate-pulse\"\u003e\n      {/* Icon placeholder */}\n      \u003cdiv className=\"w-8 h-8 rounded-md bg-secondary\" /\u003e\n      \n      {/* Content placeholder */}\n      \u003cdiv className=\"flex-1 space-y-2\"\u003e\n        \u003cdiv className=\"h-4 w-32 bg-secondary rounded\" /\u003e\n        \u003cdiv className=\"h-3 w-48 bg-secondary rounded\" /\u003e\n      \u003c/div\u003e\n      \n      {/* Right side placeholder */}\n      \u003cdiv className=\"h-4 w-4 bg-secondary rounded\" /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Integration\n```typescript\nif (isLoading) {\n  return (\n    \u003cdiv className=\"border border-border rounded-md overflow-hidden divide-y divide-border\"\u003e\n      \u003cProjectCardSkeleton /\u003e\n      \u003cProjectCardSkeleton /\u003e\n      \u003cProjectCardSkeleton /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nShow 3 skeleton cards as a reasonable default. This provides visual structure while loading without being jarring.\n\n## Error State\n\n### Error Display\n```typescript\nfunction ProjectListError({ message, onRetry }: { message: string; onRetry: () =\u003e void }) {\n  return (\n    \u003cdiv className=\"border border-border rounded-md p-8 text-center\"\u003e\n      {/* Error icon */}\n      \u003cdiv className=\"w-12 h-12 rounded-full bg-destructive/10 flex items-center justify-center mx-auto mb-4\"\u003e\n        \u003cAlertCircle className=\"h-6 w-6 text-destructive\" /\u003e\n      \u003c/div\u003e\n      \n      {/* Message */}\n      \u003ch3 className=\"font-medium mb-1\"\u003eFailed to load projects\u003c/h3\u003e\n      \u003cp className=\"text-sm text-muted-foreground mb-4\"\u003e{message}\u003c/p\u003e\n      \n      {/* Retry */}\n      \u003cButton variant=\"outline\" onClick={onRetry}\u003e\n        \u003cRefreshCw className=\"h-4 w-4 mr-2\" /\u003e\n        Try Again\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Integration\n```typescript\nif (error) {\n  return (\n    \u003cProjectListError \n      message={error.message} \n      onRetry={() =\u003e refetch()} \n    /\u003e\n  );\n}\n```\n\n## Error Scenarios\n- **Network error**: \"Failed to fetch\" - server might be down\n- **Server error**: 500 response - show generic message\n- **Config error**: Could indicate corrupted config file\n\nFor all cases, the retry button is the primary action. If errors persist, users should check the server logs.\n\n## Refetching State\nWhen data exists but is being refetched (background refresh), don't show loading state - keep showing current data. React Query handles this automatically with `isLoading` (initial load) vs `isFetching` (refetch).\n\n```typescript\n// Only show skeleton on initial load, not refetch\nif (isLoading) {\n  return \u003cSkeletonState /\u003e;\n}\n\n// Show error only if no cached data\nif (error \u0026\u0026 !projects) {\n  return \u003cErrorState /\u003e;\n}\n```\n\n## Page-Level Integration\n```typescript\nexport default function ProjectListPage() {\n  const { data: projects, isLoading, error, refetch } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n\n  return (\n    \u003cdiv className=\"min-h-screen bg-background\"\u003e\n      {/* Header - always shown */}\n      \u003cheader\u003e...\u003c/header\u003e\n      \n      \u003cmain className=\"max-w-3xl mx-auto p-4\"\u003e\n        \u003cdiv className=\"mb-6\"\u003e\n          \u003ch1\u003eProjects\u003c/h1\u003e\n          \u003cp\u003eSelect a project to view swarms and sessions\u003c/p\u003e\n        \u003c/div\u003e\n        \n        {isLoading ? (\n          \u003cProjectListSkeleton /\u003e\n        ) : error \u0026\u0026 !projects ? (\n          \u003cProjectListError message={error.message} onRetry={refetch} /\u003e\n        ) : !projects?.length ? (\n          \u003cNoProjects onAddProject={() =\u003e setFolderBrowserOpen(true)} /\u003e\n        ) : (\n          \u003cProjectList projects={projects} /\u003e\n        )}\n      \u003c/main\u003e\n      \n      \u003cFolderBrowserModal \n        open={folderBrowserOpen}\n        onOpenChange={setFolderBrowserOpen}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Acceptance Criteria\n- [ ] Loading skeleton shown during initial fetch\n- [ ] Skeleton matches shape of real cards\n- [ ] Error state shown when API fails\n- [ ] Error message displayed\n- [ ] Retry button triggers refetch\n- [ ] Refetch doesn't show loading state (keeps stale data)\n- [ ] Proper state hierarchy: loading → error → empty → data\n\n## Dependencies\n- **Requires**: Task 4.1 (page using useProjects)\n- **Related**: Task 4.2 (empty state)\n\n## Files\n- `src/app/page.tsx` (add loading/error states)\n- Could extract: `src/components/project-list/ProjectCardSkeleton.tsx`\n- Could extract: `src/components/project-list/ProjectListError.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.429006-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Project List Page task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.13","title":"4.4 Add 'Add Project' button to header - opens folder browser modal","description":"## Purpose\nAdd an \"Add Project\" button to the project list page header that opens the folder browser modal. This provides a consistent, always-visible entry point for adding projects.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────────────────┐\n│  ⚡ Maestro                              [Search] [+ Add]   │\n└─────────────────────────────────────────────────────────────┘\n```\n\nThe button should be:\n- Visible in the header at all times\n- Compact but recognizable\n- Consistent with the empty state CTA\n\n## Current Header\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b border-border bg-card\"\u003e\n  \u003cdiv className=\"flex h-12 items-center justify-between px-4\"\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cZap /\u003e\n      \u003cspan\u003eMaestro\u003c/span\u003e\n    \u003c/div\u003e\n    \u003cdiv className=\"flex items-center gap-1\"\u003e\n      \u003cbutton\u003e[Search]\u003c/button\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\u003c/header\u003e\n```\n\n## Updated Header\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b border-border bg-card\"\u003e\n  \u003cdiv className=\"flex h-12 items-center justify-between px-4\"\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cZap /\u003e\n      \u003cspan\u003eMaestro\u003c/span\u003e\n    \u003c/div\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cbutton className=\"search-button\"\u003e[Search]\u003c/button\u003e\n      \u003cButton \n        size=\"sm\" \n        onClick={() =\u003e setFolderBrowserOpen(true)}\n      \u003e\n        \u003cPlus className=\"h-4 w-4 mr-1\" /\u003e\n        \u003cspan className=\"hidden sm:inline\"\u003eAdd\u003c/span\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\u003c/header\u003e\n```\n\n## Button Design\n- **Size**: Small (`size=\"sm\"`) to fit header\n- **Icon**: Plus icon always visible\n- **Text**: \"Add\" visible on larger screens, hidden on mobile (icon only)\n- **Style**: Primary button for emphasis\n\n## Mobile Behavior\nOn mobile:\n- Button shows only icon (plus)\n- Maintains adequate touch target (min 44x44 via padding)\n- Positioned where thumb can reach\n\n```typescript\n\u003cButton \n  size=\"sm\" \n  onClick={() =\u003e setFolderBrowserOpen(true)}\n  className=\"h-8 px-2 sm:px-3\"\n\u003e\n  \u003cPlus className=\"h-4 w-4\" /\u003e\n  \u003cspan className=\"hidden sm:inline ml-1\"\u003eAdd\u003c/span\u003e\n\u003c/Button\u003e\n```\n\n## State Management\nThe folder browser modal state is managed at the page level:\n```typescript\nexport default function ProjectListPage() {\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  \n  return (\n    \u003c\u003e\n      \u003cheader\u003e\n        {/* ... */}\n        \u003cButton onClick={() =\u003e setFolderBrowserOpen(true)}\u003e\n          Add\n        \u003c/Button\u003e\n      \u003c/header\u003e\n      \n      {/* ... main content ... */}\n      \n      \u003cFolderBrowserModal \n        open={folderBrowserOpen}\n        onOpenChange={setFolderBrowserOpen}\n        onSuccess={() =\u003e {\n          // Optionally scroll to new project, show toast, etc.\n        }}\n      /\u003e\n    \u003c/\u003e\n  );\n}\n```\n\n## Success Callback\nAfter successfully adding a project:\n- Modal closes automatically\n- Projects list refetches (React Query invalidation)\n- Optionally show a success toast\n- New project appears at top of list (sorted by addedAt)\n\n## Acceptance Criteria\n- [ ] \"Add\" button visible in header\n- [ ] Button shows icon + text on desktop\n- [ ] Button shows icon only on mobile\n- [ ] Clicking opens folder browser modal\n- [ ] Modal closes on successful add\n- [ ] Project list updates after add\n- [ ] Button accessible via keyboard\n\n## Dependencies\n- **Requires**: Task 3.3 (FolderBrowserModal)\n- **Requires**: Task 7.1 (hooks for refetch after add)\n- **Part of**: Task 4.1 (overall page update)\n\n## Files\n- `src/app/page.tsx` (update header)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.487865-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Project List Page task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.14","title":"5.1 Add project card dropdown menu (edit name, remove)","description":"## Purpose\nAdd a dropdown menu to each project card that provides actions: \"Edit Name\" and \"Remove\". This enables users to manage existing projects without navigating away from the list.\n\n## Visual Design\n```\n┌──────────────────────────────────────────────────────────────┐\n│  📁 my-project                                          [⋮] │\n│     ~/dev/my-project                                        │\n└──────────────────────────────────────────────────────────────┘\n                                                           │\n                                                  ┌────────┴────────┐\n                                                  │  ✏️ Edit Name   │\n                                                  │  🗑️ Remove      │\n                                                  └─────────────────┘\n```\n\n## Component Structure\n```\nproject-card/\n├── ProjectCard.tsx       # Main card component\n├── ProjectCardMenu.tsx   # Dropdown menu\n├── EditNameDialog.tsx    # Edit dialog (Task 5.2)\n└── RelocateDialog.tsx    # Relocate dialog (Task 5.4)\n```\n\n## ProjectCard Component\nExtract the project card from page.tsx into a reusable component:\n```typescript\n// src/components/project-card/ProjectCard.tsx\ninterface ProjectCardProps {\n  project: Project;\n  onEdit: () =\u003e void;\n  onRemove: () =\u003e void;\n  onRelocate?: () =\u003e void;  // Only for missing projects\n}\n\nexport function ProjectCard({ project, onEdit, onRemove, onRelocate }: ProjectCardProps) {\n  const isMissing = project.status === \"missing\";\n  \n  return (\n    \u003cdiv className={cn(\n      \"flex items-center gap-3 px-3 py-2.5 transition-colors\",\n      isMissing ? \"opacity-60\" : \"hover:bg-secondary/50\"\n    )}\u003e\n      {/* Card content as link (except menu) */}\n      \u003cLink \n        href={isMissing ? \"#\" : `/project/${project.id}`}\n        className=\"flex items-center gap-3 flex-1 min-w-0\"\n        onClick={isMissing ? (e) =\u003e e.preventDefault() : undefined}\n      \u003e\n        \u003cdiv className=\"flex items-center justify-center w-8 h-8 rounded-md bg-secondary\"\u003e\n          \u003cFolder className=\"h-4 w-4 text-muted-foreground\" /\u003e\n        \u003c/div\u003e\n        \n        \u003cdiv className=\"flex-1 min-w-0\"\u003e\n          \u003cdiv className=\"flex items-center gap-2\"\u003e\n            \u003cspan className=\"font-medium text-sm\"\u003e{project.displayName}\u003c/span\u003e\n            {isMissing \u0026\u0026 (\n              \u003cspan className=\"text-xs text-warning\"\u003eMissing\u003c/span\u003e\n            )}\n          \u003c/div\u003e\n          \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n            {project.displayPath}\n          \u003c/p\u003e\n        \u003c/div\u003e\n      \u003c/Link\u003e\n      \n      {/* Menu - not part of link */}\n      \u003cProjectCardMenu \n        project={project}\n        onEdit={onEdit}\n        onRemove={onRemove}\n        onRelocate={onRelocate}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## ProjectCardMenu Component\n```typescript\n// src/components/project-card/ProjectCardMenu.tsx\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { MoreVertical, Pencil, Trash2, FolderSearch } from \"lucide-react\";\n\ninterface ProjectCardMenuProps {\n  project: Project;\n  onEdit: () =\u003e void;\n  onRemove: () =\u003e void;\n  onRelocate?: () =\u003e void;\n}\n\nexport function ProjectCardMenu({ project, onEdit, onRemove, onRelocate }: ProjectCardMenuProps) {\n  const isMissing = project.status === \"missing\";\n  \n  return (\n    \u003cDropdownMenu\u003e\n      \u003cDropdownMenuTrigger asChild\u003e\n        \u003cbutton \n          className=\"h-8 w-8 flex items-center justify-center rounded-md hover:bg-secondary transition-colors\"\n          onClick={(e) =\u003e e.preventDefault()}  // Don't trigger card link\n        \u003e\n          \u003cMoreVertical className=\"h-4 w-4 text-muted-foreground\" /\u003e\n        \u003c/button\u003e\n      \u003c/DropdownMenuTrigger\u003e\n      \u003cDropdownMenuContent align=\"end\"\u003e\n        {isMissing \u0026\u0026 onRelocate \u0026\u0026 (\n          \u003cDropdownMenuItem onClick={onRelocate}\u003e\n            \u003cFolderSearch className=\"h-4 w-4 mr-2\" /\u003e\n            Relocate\n          \u003c/DropdownMenuItem\u003e\n        )}\n        \u003cDropdownMenuItem onClick={onEdit}\u003e\n          \u003cPencil className=\"h-4 w-4 mr-2\" /\u003e\n          Edit Name\n        \u003c/DropdownMenuItem\u003e\n        \u003cDropdownMenuItem \n          onClick={onRemove}\n          className=\"text-destructive focus:text-destructive\"\n        \u003e\n          \u003cTrash2 className=\"h-4 w-4 mr-2\" /\u003e\n          Remove\n        \u003c/DropdownMenuItem\u003e\n      \u003c/DropdownMenuContent\u003e\n    \u003c/DropdownMenu\u003e\n  );\n}\n```\n\n## Menu Actions\n| Action | Condition | Behavior |\n|--------|-----------|----------|\n| Relocate | Missing projects only | Opens folder browser to select new location |\n| Edit Name | Always | Opens edit dialog |\n| Remove | Always | Immediately removes (no confirmation) |\n\n## No Confirmation for Remove\nRemove doesn't require confirmation because:\n1. **Non-destructive** - Only removes from Maestro, not from disk\n2. **Easily reversible** - Can re-add the project immediately\n3. **Reduces friction** - One click to clean up\n\n## shadcn Components Needed\nThis task requires the DropdownMenu component from shadcn/ui:\n```bash\nnpx shadcn-ui@latest add dropdown-menu\n```\n\n## Integration with Page\n```typescript\n// In page.tsx\nconst [editingProject, setEditingProject] = useState\u003cProject | null\u003e(null);\nconst [relocatingProject, setRelocatingProject] = useState\u003cProject | null\u003e(null);\nconst deleteProject = useDeleteProject();\n\n// ...\n\n{projects?.map((project) =\u003e (\n  \u003cProjectCard\n    key={project.id}\n    project={project}\n    onEdit={() =\u003e setEditingProject(project)}\n    onRemove={() =\u003e deleteProject.mutate(project.id)}\n    onRelocate={project.status === \"missing\" ? () =\u003e setRelocatingProject(project) : undefined}\n  /\u003e\n))}\n\n{/* Edit dialog */}\n\u003cEditNameDialog \n  project={editingProject}\n  open={!!editingProject}\n  onOpenChange={(open) =\u003e !open \u0026\u0026 setEditingProject(null)}\n/\u003e\n\n{/* Relocate dialog */}\n\u003cRelocateDialog\n  project={relocatingProject}\n  open={!!relocatingProject}\n  onOpenChange={(open) =\u003e !open \u0026\u0026 setRelocatingProject(null)}\n/\u003e\n```\n\n## Acceptance Criteria\n- [ ] Three-dot menu icon on each project card\n- [ ] Menu opens on click without navigating to project\n- [ ] \"Edit Name\" option present for all projects\n- [ ] \"Remove\" option present for all projects\n- [ ] \"Relocate\" option present only for missing projects\n- [ ] Remove immediately deletes (no confirmation)\n- [ ] Menu closes after action\n- [ ] Touch-friendly (adequate tap target)\n\n## Dependencies\n- **Requires**: Task 7.1 (useDeleteProject hook)\n- **Requires**: shadcn DropdownMenu component\n- **Enables**: Tasks 5.2, 5.3, 5.4 (dialogs)\n\n## Files\n- `src/components/project-card/ProjectCard.tsx` (new)\n- `src/components/project-card/ProjectCardMenu.tsx` (new)\n- `src/components/ui/dropdown-menu.tsx` (shadcn - may need to add)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.54657-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into ProjectCard component task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.15","title":"5.2 Implement edit project name functionality","description":"## Purpose\nImplement the edit project name dialog that allows users to change a project's display name. This is a simple modal with a text input and save/cancel buttons.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────┐\n│  Edit Project Name                          [X] │\n├─────────────────────────────────────────────────┤\n│                                                 │\n│  Display Name                                   │\n│  ┌─────────────────────────────────────────┐   │\n│  │ My Custom Name                          │   │\n│  └─────────────────────────────────────────┘   │\n│                                                 │\n│  Leave empty to use folder name                 │\n│                                                 │\n├─────────────────────────────────────────────────┤\n│                    [Cancel]  [Save]             │\n└─────────────────────────────────────────────────┘\n```\n\n## Props\n```typescript\ninterface EditNameDialogProps {\n  project: Project | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n}\n```\n\n## Implementation\n```typescript\n// src/components/project-card/EditNameDialog.tsx\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useUpdateProject } from \"@/lib/hooks/useProjects\";\nimport { useState, useEffect } from \"react\";\n\nexport function EditNameDialog({ project, open, onOpenChange }: EditNameDialogProps) {\n  const [name, setName] = useState(\"\");\n  const [error, setError] = useState\u003cstring | null\u003e(null);\n  const updateProject = useUpdateProject();\n  \n  // Initialize with current name when dialog opens\n  useEffect(() =\u003e {\n    if (project \u0026\u0026 open) {\n      // Use custom name if set, otherwise show derived name as placeholder\n      setName(project.name || \"\");\n      setError(null);\n    }\n  }, [project, open]);\n  \n  const handleSave = async () =\u003e {\n    if (!project) return;\n    \n    setError(null);\n    try {\n      await updateProject.mutateAsync({\n        id: project.id,\n        name: name.trim() || null,  // Empty string → null (use derived)\n      });\n      onOpenChange(false);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Failed to update name\");\n    }\n  };\n  \n  const derivedName = project?.path.split(\"/\").pop() || \"\";\n  \n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent className=\"sm:max-w-md\"\u003e\n        \u003cDialogHeader\u003e\n          \u003cDialogTitle\u003eEdit Project Name\u003c/DialogTitle\u003e\n        \u003c/DialogHeader\u003e\n        \n        \u003cdiv className=\"space-y-4 py-4\"\u003e\n          \u003cdiv className=\"space-y-2\"\u003e\n            \u003cLabel htmlFor=\"name\"\u003eDisplay Name\u003c/Label\u003e\n            \u003cInput\n              id=\"name\"\n              value={name}\n              onChange={(e) =\u003e setName(e.target.value)}\n              placeholder={derivedName}\n            /\u003e\n            \u003cp className=\"text-xs text-muted-foreground\"\u003e\n              Leave empty to use folder name ({derivedName})\n            \u003c/p\u003e\n          \u003c/div\u003e\n          \n          {error \u0026\u0026 (\n            \u003cp className=\"text-sm text-destructive\"\u003e{error}\u003c/p\u003e\n          )}\n        \u003c/div\u003e\n        \n        \u003cDialogFooter\u003e\n          \u003cButton variant=\"outline\" onClick={() =\u003e onOpenChange(false)}\u003e\n            Cancel\n          \u003c/Button\u003e\n          \u003cButton \n            onClick={handleSave}\n            disabled={updateProject.isPending}\n          \u003e\n            {updateProject.isPending ? \"Saving...\" : \"Save\"}\n          \u003c/Button\u003e\n        \u003c/DialogFooter\u003e\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  );\n}\n```\n\n## Behavior Details\n\n### Name Initialization\n- If project has custom name: Show it in input\n- If project uses derived name: Show empty input with derived name as placeholder\n\n### Saving Empty Name\n- Empty string or whitespace-only → sets `name: null` in API\n- This reverts to derived name from path\n- Clear UX: \"Leave empty to use folder name\"\n\n### Validation\n- No client-side validation needed (any string is valid)\n- Server validates and returns error if needed\n- Show error message inline\n\n### Keyboard Support\n- Enter to save\n- Escape to cancel\n- Auto-focus input on open\n\n## shadcn Components Needed\n- Dialog (may already have from FolderBrowserModal)\n- Input\n- Label\n- Button\n\n## Acceptance Criteria\n- [ ] Dialog opens with current name pre-filled\n- [ ] Placeholder shows derived name\n- [ ] Can save custom name\n- [ ] Can clear name to revert to derived\n- [ ] Shows loading state while saving\n- [ ] Shows error messages inline\n- [ ] Closes on successful save\n- [ ] Cancel closes without saving\n- [ ] Enter key submits form\n\n## Dependencies\n- **Requires**: Task 7.1 (useUpdateProject hook)\n- **Requires**: Task 1.4 (PATCH endpoint)\n- **Used by**: Task 5.1 (ProjectCardMenu)\n\n## Files\n- `src/components/project-card/EditNameDialog.tsx` (new)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.603572-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into ProjectCard component task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.16","title":"5.3 Implement missing project detection and warning UI","description":"## Purpose\nDetect and visually indicate when a project's path no longer exists on the filesystem. This helps users understand why a project might not be accessible and guides them to fix it.\n\n## Why Projects Go Missing\n- Project directory was moved or renamed\n- External drive was disconnected\n- Project was deleted from disk\n- Path was changed outside of Maestro\n\n## Visual Treatment\nMissing projects should be clearly distinguished from active ones:\n\n```\nActive project:\n┌──────────────────────────────────────────────────────────────┐\n│  📁 my-project                                          [⋮] │\n│     ~/dev/my-project                              2 min ago │\n└──────────────────────────────────────────────────────────────┘\n\nMissing project:\n┌──────────────────────────────────────────────────────────────┐\n│  📁 old-project                      ⚠️ Missing         [⋮] │\n│     ~/dev/old-project                                       │\n└──────────────────────────────────────────────────────────────┘\n  (dimmed/muted styling)\n```\n\n## Implementation\n\n### API Already Handles Detection\nThe GET /api/projects endpoint already validates each path and returns `status: \"active\" | \"missing\"`. No additional API work needed.\n\n### ProjectCard Updates\n```typescript\n// In ProjectCard.tsx\nconst isMissing = project.status === \"missing\";\n\nreturn (\n  \u003cdiv className={cn(\n    \"flex items-center gap-3 px-3 py-2.5 transition-colors\",\n    isMissing \n      ? \"opacity-60 bg-secondary/20\" \n      : \"hover:bg-secondary/50\"\n  )}\u003e\n    {/* Icon with warning indicator */}\n    \u003cdiv className=\"relative\"\u003e\n      \u003cdiv className={cn(\n        \"flex items-center justify-center w-8 h-8 rounded-md\",\n        isMissing ? \"bg-warning/10\" : \"bg-secondary\"\n      )}\u003e\n        \u003cFolder className={cn(\n          \"h-4 w-4\",\n          isMissing ? \"text-warning\" : \"text-muted-foreground\"\n        )} /\u003e\n      \u003c/div\u003e\n      {isMissing \u0026\u0026 (\n        \u003cAlertTriangle className=\"h-3 w-3 text-warning absolute -top-1 -right-1\" /\u003e\n      )}\n    \u003c/div\u003e\n    \n    \u003cdiv className=\"flex-1 min-w-0\"\u003e\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cspan className={cn(\n          \"font-medium text-sm\",\n          isMissing \u0026\u0026 \"text-muted-foreground\"\n        )}\u003e\n          {project.displayName}\n        \u003c/span\u003e\n        {isMissing \u0026\u0026 (\n          \u003cspan className=\"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-warning/10 text-warning\"\u003e\n            \u003cAlertTriangle className=\"h-3 w-3\" /\u003e\n            Missing\n          \u003c/span\u003e\n        )}\n      \u003c/div\u003e\n      \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n        {project.displayPath}\n      \u003c/p\u003e\n    \u003c/div\u003e\n    \n    {/* ... rest of card ... */}\n  \u003c/div\u003e\n);\n```\n\n### Click Behavior\nMissing projects should NOT navigate to `/project/[id]` - there's nothing to show. Instead:\n- Click on card content: Does nothing or shows inline message\n- Click on menu: Opens menu with Relocate/Remove options\n\n```typescript\n// Prevent navigation for missing projects\n\u003cLink\n  href={isMissing ? \"#\" : `/project/${project.id}`}\n  onClick={isMissing ? (e) =\u003e e.preventDefault() : undefined}\n  className={cn(isMissing \u0026\u0026 \"cursor-default\")}\n\u003e\n```\n\n### Menu Options for Missing Projects\nThe menu should show \"Relocate\" as the primary action for missing projects:\n```typescript\n// In ProjectCardMenu\n{isMissing \u0026\u0026 (\n  \u003cDropdownMenuItem onClick={onRelocate} className=\"font-medium\"\u003e\n    \u003cFolderSearch className=\"h-4 w-4 mr-2\" /\u003e\n    Relocate\n  \u003c/DropdownMenuItem\u003e\n)}\n```\n\n## Alternative Approaches Considered\n\n### Inline Relocate Button\nCould show a \"Relocate\" button directly on the card instead of in the menu. Decided against because:\n- Clutters the UI\n- Inconsistent with active project cards\n- Menu works well for infrequent action\n\n### Auto-hide Missing Projects\nCould hide missing projects by default. Decided against because:\n- User might not realize project is gone\n- No way to know something needs fixing\n- Better to show problem and offer fix\n\n### Toast on Detection\nCould show toast when missing project detected. Decided against because:\n- Could be annoying on every page load\n- Visual indicator is sufficient\n- User can fix when they want to\n\n## Acceptance Criteria\n- [ ] Missing projects have dimmed/muted styling\n- [ ] Warning icon or badge indicates \"Missing\" status\n- [ ] Click doesn't navigate to project page\n- [ ] Menu shows \"Relocate\" option prominently\n- [ ] Menu still shows \"Remove\" option\n- [ ] Clear visual distinction from active projects\n\n## Dependencies\n- **Requires**: Task 1.2 (API returns status field)\n- **Part of**: Task 5.1 (ProjectCard component)\n- **Enables**: Task 5.4 (Relocate functionality)\n\n## Files\n- `src/components/project-card/ProjectCard.tsx` (update)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.662499-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Missing Project Detection task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.17","title":"5.4 Implement relocate project functionality for missing projects","description":"## Purpose\nAllow users to \"relocate\" a missing project by selecting a new path via the folder browser. This preserves the project's ID and any associated data while updating where Maestro looks for it.\n\n## Use Case\n1. User moved `~/dev/my-project` to `~/dev/projects/my-project`\n2. Maestro shows project as \"Missing\"\n3. User clicks Relocate\n4. Folder browser opens, navigated to `~/dev` (parent of old path, or default if parent gone)\n5. User navigates to `~/dev/projects/my-project`\n6. User clicks \"Update Location\"\n7. Project is now tracked at new path, same ID preserved\n\n## Why Preserve ID?\nThe project ID is a UUID used in routing (`/project/[id]`). By keeping the same ID:\n- Bookmarks to the project still work\n- Any future features using project ID (settings, history) stay linked\n- Cleaner than delete + re-add\n\n## Visual Design\nThe relocate dialog is similar to the add project modal, but:\n- Different title: \"Relocate Project\" instead of \"Select Project Folder\"\n- Shows the old path for context\n- Button says \"Update Location\" instead of \"Add Project\"\n- No custom name input (keep existing name)\n\n```\n┌─────────────────────────────────────────────────┐\n│  Relocate Project                           [X] │\n├─────────────────────────────────────────────────┤\n│  Current path (missing):                        │\n│  ~/dev/old-location/my-project                  │\n├─────────────────────────────────────────────────┤\n│  ~ / dev / projects / my-project            [↑] │  ← Breadcrumbs\n├─────────────────────────────────────────────────┤\n│  📁 api-gateway              git                │\n│  📁 frontend                 git                │\n│                                                 │\n├─────────────────────────────────────────────────┤\n│                [Cancel]  [Update Location]      │\n└─────────────────────────────────────────────────┘\n```\n\n## Implementation\n```typescript\n// src/components/project-card/RelocateDialog.tsx\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { FolderBrowser } from \"@/components/folder-browser/FolderBrowser\";\nimport { Breadcrumbs } from \"@/components/folder-browser/Breadcrumbs\";\nimport { useUpdateProject } from \"@/lib/hooks/useProjects\";\nimport { useFilesystem } from \"@/lib/hooks/useFilesystem\";\nimport { AlertTriangle } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport path from \"path\";\n\ninterface RelocateDialogProps {\n  project: Project | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n}\n\nexport function RelocateDialog({ project, open, onOpenChange }: RelocateDialogProps) {\n  const [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e();\n  const [error, setError] = useState\u003cstring | null\u003e(null);\n  \n  const updateProject = useUpdateProject();\n  const { data: filesystem, isLoading } = useFilesystem(currentPath);\n  \n  // Set initial path when dialog opens\n  useEffect(() =\u003e {\n    if (project \u0026\u0026 open) {\n      // Try to start at parent of old path\n      // API will fall back to ~/dev or ~ if parent doesn't exist\n      const parentPath = project.path.split(\"/\").slice(0, -1).join(\"/\");\n      setCurrentPath(parentPath || undefined);\n      setError(null);\n    }\n  }, [project, open]);\n  \n  const handleRelocate = async () =\u003e {\n    if (!project || !filesystem?.currentPath) return;\n    \n    setError(null);\n    try {\n      await updateProject.mutateAsync({\n        id: project.id,\n        path: filesystem.currentPath,\n      });\n      onOpenChange(false);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Failed to relocate project\");\n    }\n  };\n  \n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent className=\"max-w-lg max-h-[80vh] flex flex-col p-0\"\u003e\n        \u003cDialogHeader className=\"px-4 py-3 border-b\"\u003e\n          \u003cDialogTitle\u003eRelocate Project\u003c/DialogTitle\u003e\n        \u003c/DialogHeader\u003e\n        \n        {/* Old path context */}\n        {project \u0026\u0026 (\n          \u003cdiv className=\"px-4 py-3 bg-secondary/30 border-b\"\u003e\n            \u003cdiv className=\"flex items-center gap-2 text-sm text-muted-foreground\"\u003e\n              \u003cAlertTriangle className=\"h-4 w-4 text-warning\" /\u003e\n              \u003cspan\u003eCurrent path (missing):\u003c/span\u003e\n            \u003c/div\u003e\n            \u003cp className=\"text-sm font-mono mt-1\"\u003e{project.displayPath}\u003c/p\u003e\n          \u003c/div\u003e\n        )}\n        \n        {/* Breadcrumbs */}\n        {filesystem \u0026\u0026 (\n          \u003cBreadcrumbs\n            currentPath={filesystem.currentPath}\n            displayPath={filesystem.displayPath}\n            onNavigate={setCurrentPath}\n            parent={filesystem.parent}\n            canGoUp={filesystem.canGoUp}\n          /\u003e\n        )}\n        \n        {/* Directory List */}\n        \u003cdiv className=\"flex-1 overflow-y-auto min-h-[200px]\"\u003e\n          \u003cFolderBrowser\n            currentPath={currentPath}\n            onNavigate={setCurrentPath}\n          /\u003e\n        \u003c/div\u003e\n        \n        {/* Error */}\n        {error \u0026\u0026 (\n          \u003cdiv className=\"px-4 py-2 text-sm text-destructive border-t\"\u003e\n            {error}\n          \u003c/div\u003e\n        )}\n        \n        {/* Actions */}\n        \u003cdiv className=\"flex justify-end gap-2 px-4 py-3 border-t\"\u003e\n          \u003cButton variant=\"outline\" onClick={() =\u003e onOpenChange(false)}\u003e\n            Cancel\n          \u003c/Button\u003e\n          \u003cButton \n            onClick={handleRelocate}\n            disabled={!filesystem?.currentPath || updateProject.isPending}\n          \u003e\n            {updateProject.isPending ? \"Updating...\" : \"Update Location\"}\n          \u003c/Button\u003e\n        \u003c/div\u003e\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  );\n}\n```\n\n## Error Handling\nThe PATCH endpoint handles validation:\n- **404**: New path doesn't exist → show error, stay in dialog\n- **400**: New path is not a directory → show error\n- **403**: New path outside home → show error\n- **409**: New path already tracked by another project → show error\n\nShow all errors inline, keep dialog open for retry.\n\n## Reusability Note\nThis dialog is very similar to FolderBrowserModal. Consider:\n1. Keep separate (clearer code, slightly different UX)\n2. Create shared base component (DRYer, more complex)\n\nFor v1, keeping separate is fine. Can refactor later if needed.\n\n## Acceptance Criteria\n- [ ] Opens from \"Relocate\" menu item on missing projects\n- [ ] Shows old path for context\n- [ ] Starts navigation at parent of old path (if exists)\n- [ ] Can navigate filesystem to find new location\n- [ ] \"Update Location\" calls PATCH API with new path\n- [ ] Shows loading state during update\n- [ ] Shows error messages inline\n- [ ] Closes on successful update\n- [ ] Project list refreshes with new path\n- [ ] Project status changes to \"active\" if path valid\n\n## Dependencies\n- **Requires**: Task 7.1 (useUpdateProject hook)\n- **Requires**: Task 1.4 (PATCH /api/projects/:id endpoint)\n- **Requires**: Task 3.1, 3.2 (FolderBrowser, Breadcrumbs components)\n- **Used by**: Task 5.1, 5.3 (ProjectCard menu)\n\n## Files\n- `src/components/project-card/RelocateDialog.tsx` (new)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.719655-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Missing Project Detection task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.18","title":"6.1 Update sidebar to fetch projects from API","description":"## Purpose\nUpdate the sidebar to fetch projects from the API instead of using mock data. The sidebar shows all projects in the left navigation, allowing users to switch between projects.\n\n## Current State\n```typescript\n// In sidebar.tsx\nimport { mockProjects } from \"@/lib/data/mock\";\n// ...\n{mockProjects.map((project) =\u003e (\n```\n\n## Target State\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\n// ...\nconst { data: projects } = useProjects();\n// ...\n{projects?.map((project) =\u003e (\n```\n\n## Changes Required\n\n### 1. Import and use hook\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\n\nexport function Sidebar() {\n  const { data: projects, isLoading } = useProjects();\n  // ...\n}\n```\n\n### 2. Update project mapping\n```typescript\n{projects?.map((project) =\u003e {\n  const isCurrentProject = project.id === currentProjectId;\n  const isMissing = project.status === \"missing\";\n\n  return (\n    \u003cTreeItem\n      key={project.id}\n      icon={\n        isCurrentProject ? (\n          \u003cFolderOpen className=\"h-4 w-4 text-primary\" /\u003e\n        ) : isMissing ? (\n          \u003cFolder className=\"h-4 w-4 text-warning\" /\u003e\n        ) : (\n          \u003cFolder className=\"h-4 w-4\" /\u003e\n        )\n      }\n      label={project.displayName}\n      defaultOpen={isCurrentProject}\n      statusIndicator={isMissing ? \"warning\" : hasActiveSwarm ? \"active\" : undefined}\n    \u003e\n      {/* ... epics and sessions for current project ... */}\n    \u003c/TreeItem\u003e\n  );\n})}\n```\n\n### 3. Handle loading state\nFor sidebar, a subtle loading state is appropriate:\n```typescript\n{isLoading ? (\n  // Show minimal skeleton or loading indicator\n  \u003cdiv className=\"px-4 py-2 text-xs text-muted-foreground\"\u003e\n    Loading projects...\n  \u003c/div\u003e\n) : projects?.length ? (\n  // Show projects\n) : (\n  // Empty state - maybe just show nothing, or prompt to add\n  \u003cdiv className=\"px-4 py-2 text-xs text-muted-foreground\"\u003e\n    No projects\n  \u003c/div\u003e\n)}\n```\n\n### 4. Show missing projects with warning\nMissing projects should be visible in sidebar with a visual indicator so users know to fix them:\n```typescript\nstatusIndicator={isMissing ? \"warning\" : /* ... */}\n```\n\nThe TreeItem component already supports a \"warning\" status indicator.\n\n## Missing Projects in Sidebar\nDecision: **Show missing projects** with warning indicator.\n\nRationale:\n- User should be aware of the problem\n- Can click and see \"Missing\" state, then fix\n- Hiding would make the problem invisible\n\n## Activity Data\nThe sidebar currently shows:\n- Active swarms count (from mock)\n- In progress count (from mock)\n\nUntil OpenCode integration is complete, these will show 0 or be hidden:\n```typescript\nconst hasActiveSwarm = false; // TODO: Get from OpenCode\n```\n\n## Epics and Sessions\nThe sidebar shows epics and sessions for the current project. These still use mock data for now (separate feature work). This task only updates the project list portion.\n\n## Acceptance Criteria\n- [ ] Fetches projects from API using useProjects hook\n- [ ] Renders project tree items with displayName\n- [ ] Current project is highlighted and expanded\n- [ ] Missing projects show warning indicator\n- [ ] Loading state while fetching\n- [ ] Empty state when no projects\n- [ ] Remove mockProjects import\n\n## Dependencies\n- **Requires**: Task 7.1 (useProjects hook)\n- **Requires**: Task 7.2 (React Query provider)\n- **Requires**: Task 1.2 (GET /api/projects endpoint)\n\n## Files\n- `src/components/ui/sidebar.tsx` (modify)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.779159-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Sidebar Integration task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.19","title":"6.2 Wire sidebar '+' button to open folder browser modal","description":"## Purpose\nWire the \"+\" button in the sidebar's Projects header to open the folder browser modal. This provides a consistent entry point for adding projects from anywhere in the app.\n\n## Current State\n```typescript\n// In sidebar.tsx\n\u003cdiv className=\"flex items-center justify-between px-2 py-1\"\u003e\n  \u003cspan className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\"\u003e\n    Projects\n  \u003c/span\u003e\n  \u003cbutton className=\"h-5 w-5 rounded hover:bg-secondary flex items-center justify-center\"\u003e\n    \u003cPlus className=\"h-3 w-3 text-muted-foreground\" /\u003e\n  \u003c/button\u003e\n\u003c/div\u003e\n```\n\nThe button exists but does nothing.\n\n## Challenge: Modal State Across Components\nThe FolderBrowserModal is rendered at the page level (in page.tsx), but the sidebar is a separate component. We need a way to open the modal from the sidebar.\n\n## Solutions\n\n### Option 1: Context (Recommended)\nCreate a context to manage the folder browser modal state:\n```typescript\n// src/contexts/FolderBrowserContext.tsx\ninterface FolderBrowserContextType {\n  openFolderBrowser: () =\u003e void;\n}\n\nconst FolderBrowserContext = createContext\u003cFolderBrowserContextType | null\u003e(null);\n\nexport function useFolderBrowser() {\n  const context = useContext(FolderBrowserContext);\n  if (!context) throw new Error(\"useFolderBrowser must be used within FolderBrowserProvider\");\n  return context;\n}\n\n// In layout or page\n\u003cFolderBrowserContext.Provider value={{ openFolderBrowser: () =\u003e setModalOpen(true) }}\u003e\n  \u003cSidebar /\u003e\n  {/* ... */}\n  \u003cFolderBrowserModal open={modalOpen} onOpenChange={setModalOpen} /\u003e\n\u003c/FolderBrowserContext.Provider\u003e\n```\n\n### Option 2: Callback Prop\nPass a callback through component hierarchy:\n```typescript\n// In layout\n\u003cSidebar onAddProject={() =\u003e setModalOpen(true)} /\u003e\n```\n\nThis works but requires prop drilling through layout → sidebar.\n\n### Option 3: Portal Modal in Sidebar\nRender the modal from within the sidebar:\n```typescript\n// In sidebar.tsx\nconst [modalOpen, setModalOpen] = useState(false);\n\nreturn (\n  \u003c\u003e\n    {/* sidebar content */}\n    \u003cFolderBrowserModal open={modalOpen} onOpenChange={setModalOpen} /\u003e\n  \u003c/\u003e\n);\n```\n\nThis is simplest but means multiple modal instances if main page also has one.\n\n## Recommended Approach: Option 3 (Simple)\nFor v1, render the modal directly in the sidebar. Multiple modal instances aren't a problem since only one is open at a time, and they share the same React Query cache for instant updates.\n\n```typescript\n// src/components/ui/sidebar.tsx\nimport { FolderBrowserModal } from \"@/components/folder-browser/FolderBrowserModal\";\nimport { useState } from \"react\";\n\nexport function Sidebar() {\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  const { data: projects } = useProjects();\n  \n  return (\n    \u003cdiv className=\"w-64 h-screen flex flex-col border-r border-border bg-card\"\u003e\n      {/* ... header, search ... */}\n      \n      \u003cnav className=\"flex-1 overflow-y-auto px-2 py-2\"\u003e\n        {/* Projects Section */}\n        \u003cdiv className=\"mb-2\"\u003e\n          \u003cdiv className=\"flex items-center justify-between px-2 py-1\"\u003e\n            \u003cspan className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\"\u003e\n              Projects\n            \u003c/span\u003e\n            \u003cbutton \n              onClick={() =\u003e setFolderBrowserOpen(true)}\n              className=\"h-5 w-5 rounded hover:bg-secondary flex items-center justify-center\"\n            \u003e\n              \u003cPlus className=\"h-3 w-3 text-muted-foreground\" /\u003e\n            \u003c/button\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n        \n        {/* ... project tree ... */}\n      \u003c/nav\u003e\n      \n      {/* ... bottom actions ... */}\n      \n      {/* Folder Browser Modal */}\n      \u003cFolderBrowserModal \n        open={folderBrowserOpen} \n        onOpenChange={setFolderBrowserOpen}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Accessibility\nThe \"+\" button should be properly labeled:\n```typescript\n\u003cbutton \n  onClick={() =\u003e setFolderBrowserOpen(true)}\n  className=\"...\"\n  aria-label=\"Add project\"\n\u003e\n  \u003cPlus className=\"h-3 w-3 text-muted-foreground\" /\u003e\n\u003c/button\u003e\n```\n\n## Success Behavior\nAfter adding a project:\n1. Modal closes\n2. useProjects hook refetches (React Query invalidation)\n3. New project appears in sidebar immediately\n4. No need to refresh page\n\n## Acceptance Criteria\n- [ ] \"+\" button in sidebar opens folder browser modal\n- [ ] Can add project from sidebar\n- [ ] Project list updates after add\n- [ ] Modal closes on success\n- [ ] Button has proper aria-label\n- [ ] Works consistently with main page add button\n\n## Dependencies\n- **Requires**: Task 3.3 (FolderBrowserModal)\n- **Requires**: Task 6.1 (Sidebar fetches from API)\n\n## Files\n- `src/components/ui/sidebar.tsx` (update)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.837573-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Sidebar Integration task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.2","title":"1.2 Implement GET /api/projects endpoint","description":"## Purpose\nImplement the `GET /api/projects` endpoint that returns all saved projects with computed fields and validation status.\n\n## Why This Endpoint?\nThis is the primary data source for the project list UI. It must:\n1. Return all projects from config\n2. Compute display-friendly fields (displayPath, displayName)\n3. Validate each project's path still exists\n4. Sort by most recently added\n\n## Response Schema\n```typescript\ninterface ProjectsResponse {\n  projects: Project[];\n}\n\ninterface Project {\n  id: string;\n  path: string;              // Absolute: /Users/erik/dev/project\n  displayPath: string;       // Friendly: ~/dev/project\n  name: string | null;       // Custom name or null\n  displayName: string;       // name ?? derived from path\n  addedAt: string;           // ISO 8601\n  status: \"active\" | \"missing\";\n}\n```\n\n## Implementation\n```typescript\n// src/app/api/projects/route.ts\nimport { NextResponse } from \"next/server\";\nimport { configService } from \"@/lib/services/config\";\nimport fs from \"fs/promises\";\n\nexport async function GET() {\n  try {\n    const projects = await configService.getProjects();\n    \n    const enrichedProjects = await Promise.all(\n      projects.map(async (p) =\u003e {\n        // Check if path exists\n        let status: \"active\" | \"missing\" = \"active\";\n        try {\n          await fs.access(p.path);\n        } catch {\n          status = \"missing\";\n        }\n        \n        return {\n          id: p.id,\n          path: p.path,\n          displayPath: configService.toDisplayPath(p.path),\n          name: p.name,\n          displayName: p.name ?? configService.deriveDisplayName(p.path),\n          addedAt: p.addedAt,\n          status,\n        };\n      })\n    );\n    \n    // Sort by addedAt descending (most recent first)\n    enrichedProjects.sort((a, b) =\u003e \n      new Date(b.addedAt).getTime() - new Date(a.addedAt).getTime()\n    );\n    \n    return NextResponse.json({ projects: enrichedProjects });\n  } catch (error) {\n    console.error(\"Failed to fetch projects:\", error);\n    return NextResponse.json(\n      { error: \"Failed to fetch projects\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\n## Performance Note\nPath validation (`fs.access`) is done for each project on every request. For typical use cases (\u003c 20 projects), this is fine. If it becomes slow, we could:\n- Cache validation results briefly\n- Validate asynchronously and update status in background\n- Only validate on explicit refresh\n\nFor v1, keep it simple - validate on every request.\n\n## Acceptance Criteria\n- [ ] Returns all projects from config\n- [ ] Computes displayPath correctly (~ notation)\n- [ ] Computes displayName correctly (custom or derived)\n- [ ] Detects missing projects (path doesn't exist)\n- [ ] Sorts by addedAt descending\n- [ ] Returns empty array when no projects (not error)\n- [ ] Returns 500 on unexpected errors\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service)\n\n## Files\n- `src/app/api/projects/route.ts` (new)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:02.851831-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into consolidated Projects API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.20","title":"7.1 Create shared React Query hooks for projects API","description":"## Purpose\nCreate shared React Query hooks that encapsulate all API interactions for projects and filesystem browsing. These hooks provide a consistent, type-safe interface for components to fetch and mutate data.\n\n## Why Custom Hooks?\n1. **DRY** - Don't repeat query keys, fetch logic, error handling\n2. **Type safety** - Return types match API response schemas\n3. **Optimistic updates** - Centralized cache invalidation logic\n4. **Testing** - Easy to mock in component tests\n\n## Hook API Design\n\n### useProjects\n```typescript\n// src/lib/hooks/useProjects.ts\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\n\ninterface Project {\n  id: string;\n  path: string;\n  displayPath: string;\n  name: string | null;\n  displayName: string;\n  addedAt: string;\n  status: \"active\" | \"missing\";\n}\n\nexport function useProjects() {\n  return useQuery({\n    queryKey: [\"projects\"],\n    queryFn: async (): Promise\u003cProject[]\u003e =\u003e {\n      const res = await fetch(\"/api/projects\");\n      if (!res.ok) throw new Error(\"Failed to fetch projects\");\n      const data = await res.json();\n      return data.projects;\n    },\n  });\n}\n\nexport function useProject(id: string) {\n  const { data: projects } = useProjects();\n  return projects?.find(p =\u003e p.id === id);\n}\n```\n\n### useAddProject\n```typescript\nexport function useAddProject() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (input: { path: string; name?: string }) =\u003e {\n      const res = await fetch(\"/api/projects\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(input),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to add project\");\n      }\n      return res.json();\n    },\n    onSuccess: () =\u003e {\n      queryClient.invalidateQueries({ queryKey: [\"projects\"] });\n    },\n  });\n}\n```\n\n### useUpdateProject\n```typescript\nexport function useUpdateProject() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ id, ...updates }: { id: string; name?: string | null; path?: string }) =\u003e {\n      const res = await fetch(`/api/projects/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(updates),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to update project\");\n      }\n      return res.json();\n    },\n    onSuccess: () =\u003e {\n      queryClient.invalidateQueries({ queryKey: [\"projects\"] });\n    },\n  });\n}\n```\n\n### useDeleteProject\n```typescript\nexport function useDeleteProject() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (id: string) =\u003e {\n      const res = await fetch(`/api/projects/${id}`, {\n        method: \"DELETE\",\n      });\n      if (!res.ok \u0026\u0026 res.status !== 204) {\n        throw new Error(\"Failed to delete project\");\n      }\n    },\n    onSuccess: () =\u003e {\n      queryClient.invalidateQueries({ queryKey: [\"projects\"] });\n    },\n  });\n}\n```\n\n### useFilesystem\n```typescript\n// src/lib/hooks/useFilesystem.ts\ninterface Directory {\n  name: string;\n  path: string;\n  isGitRepo: boolean;\n}\n\ninterface BrowseResult {\n  currentPath: string;\n  displayPath: string;\n  parent: string | null;\n  canGoUp: boolean;\n  directories: Directory[];\n}\n\nexport function useFilesystem(path?: string) {\n  return useQuery({\n    queryKey: [\"filesystem\", path],\n    queryFn: async (): Promise\u003cBrowseResult\u003e =\u003e {\n      const url = path \n        ? `/api/filesystem/browse?path=${encodeURIComponent(path)}`\n        : \"/api/filesystem/browse\";\n      const res = await fetch(url);\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to browse directory\");\n      }\n      return res.json();\n    },\n    // Keep previous data while navigating to avoid flash\n    placeholderData: (previousData) =\u003e previousData,\n  });\n}\n```\n\n## Error Handling Pattern\nAll hooks throw errors that can be caught by error boundaries or handled by the component:\n```typescript\nconst { data, error, isLoading } = useProjects();\n\nif (error) {\n  return \u003cErrorState message={error.message} onRetry={() =\u003e refetch()} /\u003e;\n}\n```\n\n## Cache Invalidation Strategy\n- After add/update/delete, invalidate the entire projects list\n- For filesystem browsing, each path is cached independently\n- Use `placeholderData` to keep showing old data while new data loads\n\n## Type Exports\nExport all types so components have full type safety:\n```typescript\nexport type { Project, Directory, BrowseResult };\n```\n\n## Acceptance Criteria\n- [ ] useProjects fetches and returns project list\n- [ ] useProject(id) returns single project from cache\n- [ ] useAddProject mutation works with cache invalidation\n- [ ] useUpdateProject mutation works with cache invalidation\n- [ ] useDeleteProject mutation works with cache invalidation\n- [ ] useFilesystem fetches directory contents\n- [ ] All hooks have proper TypeScript types\n- [ ] Error messages propagate from API responses\n\n## Dependencies\n- **Requires**: Task 7.2 (React Query provider)\n- **Requires**: Tasks 1.2, 1.3, 2.1 (API endpoints must exist)\n\n## Files\n- `src/lib/hooks/useProjects.ts` (new)\n- `src/lib/hooks/useFilesystem.ts` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.894727-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: now standalone React Query Hooks task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.21","title":"7.2 Set up React Query provider","description":"## Purpose\nSet up React Query (TanStack Query) as the data fetching and caching layer for all API interactions. This is a foundational task that must be completed before any UI components can consume API data.\n\n## Why React Query?\n1. **Automatic caching** - Projects list is fetched once and cached; subsequent navigations are instant\n2. **Background refetching** - Stale data is refreshed automatically when window regains focus\n3. **Optimistic updates** - Edit/delete operations feel instant while we sync with server\n4. **Loading/error states** - Standardized handling across all API calls\n5. **Request deduplication** - Multiple components requesting same data = one network call\n\n## Implementation Details\n\n### Install dependencies\n```bash\nbun add @tanstack/react-query\n```\n\n### Create providers.tsx\n```typescript\n// src/app/providers.tsx\n\"use client\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\n\nexport function Providers({ children }: { children: React.ReactNode }) {\n  const [queryClient] = useState(() =\u003e new QueryClient({\n    defaultOptions: {\n      queries: {\n        staleTime: 60 * 1000, // 1 minute before refetch\n        retry: 1,\n      },\n    },\n  }));\n  \n  return (\n    \u003cQueryClientProvider client={queryClient}\u003e\n      {children}\n    \u003c/QueryClientProvider\u003e\n  );\n}\n```\n\n### Update layout.tsx\nWrap the app with Providers in the root layout.\n\n## Considerations\n- Use `useState` for QueryClient to avoid recreating on each render (App Router requirement)\n- Set reasonable `staleTime` - projects don't change often, but we want fresh data on focus\n- Single retry is enough - if server is down, failing fast is better than hanging\n\n## Acceptance Criteria\n- [ ] @tanstack/react-query installed\n- [ ] Providers component created with QueryClientProvider\n- [ ] Root layout wraps children with Providers\n- [ ] Can use `useQuery` in any client component\n\n## Dependencies\nNone - this is a foundational task.\n\n## Files\n- `src/app/providers.tsx` (new)\n- `src/app/layout.tsx` (modify)\n- `package.json` (dependency added)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:03.954086-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Foundation task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.22","title":"1. Foundation: Dependencies \u0026 React Query Setup","description":"## Purpose\nSet up the foundational dependencies and infrastructure needed by all other tasks. This is the first task to complete.\n\n## Dependencies to Install\n```bash\nbun add @tanstack/react-query\n```\n\n## shadcn Components to Add\n```bash\nnpx shadcn@latest add dialog dropdown-menu input label scroll-area alert\n```\n\nThese components are used by:\n- **Dialog**: FolderBrowserModal, EditNameDialog, RelocateDialog\n- **DropdownMenu**: ProjectCard menu\n- **Input**: Name input in dialogs, path input in folder browser\n- **Label**: Form labels in dialogs\n- **ScrollArea**: Mobile-friendly scrollable directory list in folder browser\n- **Alert**: Error state displays\n\n## React Query Provider Setup\n\n### Create providers.tsx\n```typescript\n// src/app/providers.tsx\n\"use client\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\n\nexport function Providers({ children }: { children: React.ReactNode }) {\n  const [queryClient] = useState(() =\u003e new QueryClient({\n    defaultOptions: {\n      queries: {\n        staleTime: 5 * 60 * 1000, // 5 minutes - projects change rarely\n        retry: 1,\n        refetchOnWindowFocus: true, // Refetch when user switches back from file operations\n      },\n    },\n  }));\n  \n  return (\n    \u003cQueryClientProvider client={queryClient}\u003e\n      {children}\n    \u003c/QueryClientProvider\u003e\n  );\n}\n```\n\n### Update layout.tsx\nWrap the app with Providers in the root layout:\n```typescript\nimport { Providers } from \"./providers\";\n\nexport default function RootLayout({ children }) {\n  return (\n    \u003chtml\u003e\n      \u003cbody\u003e\n        \u003cProviders\u003e{children}\u003c/Providers\u003e\n      \u003c/body\u003e\n    \u003c/html\u003e\n  );\n}\n```\n\n## Why These Choices\n- **React Query**: Automatic caching, background refetching, optimistic updates, request deduplication\n- **useState for QueryClient**: Required for App Router to avoid recreating on each render\n- **staleTime 5 minutes**: Projects change rarely; no need for frequent refetching\n- **refetchOnWindowFocus**: Ensures fresh data when user returns from filesystem operations\n- **retry 1**: Fail fast if server is down\n\n## Acceptance Criteria\n- [ ] @tanstack/react-query installed\n- [ ] shadcn Dialog component added\n- [ ] shadcn DropdownMenu component added  \n- [ ] shadcn Input component added\n- [ ] shadcn Label component added\n- [ ] shadcn ScrollArea component added\n- [ ] shadcn Alert component added\n- [ ] Providers component created with QueryClientProvider\n- [ ] Root layout wraps children with Providers\n- [ ] Can use `useQuery` in any client component\n\n## Files\n- `package.json` (dependencies)\n- `src/app/providers.tsx` (new)\n- `src/app/layout.tsx` (modify)\n- `src/components/ui/dialog.tsx` (new - shadcn)\n- `src/components/ui/dropdown-menu.tsx` (new - shadcn)\n- `src/components/ui/input.tsx` (new - shadcn)\n- `src/components/ui/label.tsx` (new - shadcn)\n- `src/components/ui/scroll-area.tsx` (new - shadcn)\n- `src/components/ui/alert.tsx` (new - shadcn)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T08:13:15.413668-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Installed @tanstack/react-query, added shadcn components (dialog, dropdown-menu, input, label, scroll-area, alert), created Providers component with QueryClientProvider, updated root layout to wrap children with Providers. Build passes.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.23","title":"2. Config Service for ~/.maestro/config.json","description":"## Purpose\nCreate the persistence layer for Maestro's project configuration. This service handles reading/writing `~/.maestro/config.json` and provides type-safe access to project data.\n\n## Config File Location\n```\n~/.maestro/config.json\n```\nUse `os.homedir()` to resolve `~`. This is the home of the user running the Next.js server.\n\n## Config Schema\n```typescript\n// src/lib/types/config.ts\ninterface MaestroConfig {\n  projects: ProjectConfig[];\n}\n\ninterface ProjectConfig {\n  id: string;          // UUID v4\n  path: string;        // Absolute path: /Users/erik/dev/project\n  name: string | null; // Custom display name, null = derive from path\n  addedAt: string;     // ISO 8601 timestamp\n}\n```\n\n## Service API\n```typescript\n// src/lib/services/config.ts\nclass ConfigService {\n  // Core operations\n  async getConfig(): Promise\u003cMaestroConfig\u003e\n  async saveConfig(config: MaestroConfig): Promise\u003cvoid\u003e\n  \n  // Project helpers\n  async getProjects(): Promise\u003cProjectConfig[]\u003e\n  async getProject(id: string): Promise\u003cProjectConfig | null\u003e\n  async projectExists(id: string): Promise\u003cboolean\u003e  // Quick existence check\n  async addProject(path: string, name?: string): Promise\u003cProjectConfig\u003e\n  async updateProject(id: string, updates: Partial\u003cPick\u003cProjectConfig, \"name\" | \"path\"\u003e\u003e): Promise\u003cProjectConfig\u003e\n  async deleteProject(id: string): Promise\u003cvoid\u003e\n  \n  // Path utilities\n  getHomeDir(): string\n  toDisplayPath(absolutePath: string): string  // /Users/erik/dev -\u003e ~/dev\n  toAbsolutePath(displayPath: string): string  // ~/dev -\u003e /Users/erik/dev\n  deriveDisplayName(path: string): string      // /Users/erik/dev/foo -\u003e foo\n  isWithinHome(path: string): boolean          // Security check\n  getParentPath(path: string): string | null   // Get parent directory, null if at home\n}\n\n// Export singleton instance\nexport const configService = new ConfigService();\n```\n\n## Implementation Notes\n\n### Auto-initialization\n```typescript\nasync getConfig(): Promise\u003cMaestroConfig\u003e {\n  const configPath = path.join(os.homedir(), \".maestro\", \"config.json\");\n  try {\n    const content = await fs.readFile(configPath, \"utf-8\");\n    return JSON.parse(content);\n  } catch (err) {\n    if (err.code === \"ENOENT\") {\n      const defaultConfig = { projects: [] };\n      await this.saveConfig(defaultConfig);\n      return defaultConfig;\n    }\n    throw err;\n  }\n}\n```\n\n### Directory Creation\n```typescript\nasync saveConfig(config: MaestroConfig): Promise\u003cvoid\u003e {\n  const dir = path.join(os.homedir(), \".maestro\");\n  await fs.mkdir(dir, { recursive: true });\n  await fs.writeFile(\n    path.join(dir, \"config.json\"),\n    JSON.stringify(config, null, 2)\n  );\n}\n```\n\n### UUID Generation\nUse `crypto.randomUUID()` (built into Node.js).\n\n### Symlink Resolution\n**IMPORTANT**: Resolve symlinks BEFORE storing paths to avoid issues when symlinks change:\n```typescript\nasync addProject(inputPath: string, name?: string): Promise\u003cProjectConfig\u003e {\n  // Resolve symlinks to get the real path\n  const realPath = await fs.realpath(inputPath);\n  // Then validate and store realPath\n}\n```\n\n### Path Utilities\n```typescript\ntoDisplayPath(absolutePath: string): string {\n  const home = this.getHomeDir();\n  if (absolutePath.startsWith(home)) {\n    return \"~\" + absolutePath.slice(home.length);\n  }\n  return absolutePath;\n}\n\ntoAbsolutePath(displayPath: string): string {\n  if (displayPath.startsWith(\"~/\") || displayPath === \"~\") {\n    return path.join(this.getHomeDir(), displayPath.slice(1));\n  }\n  return displayPath;\n}\n\nisWithinHome(testPath: string): boolean {\n  const resolved = path.resolve(testPath);\n  const home = this.getHomeDir();\n  // Handle both with and without trailing separator\n  return resolved === home || resolved.startsWith(home + path.sep);\n}\n\ngetParentPath(filePath: string): string | null {\n  const parent = path.dirname(filePath);\n  // Stop at home directory\n  if (!this.isWithinHome(parent) || parent === filePath) {\n    return null;\n  }\n  return parent;\n}\n```\n\n## Error Handling\nDefine specific error types for clear API responses:\n```typescript\nexport class ConfigError extends Error {\n  constructor(\n    message: string,\n    public code: \"ENOENT\" | \"EACCES\" | \"PARSE_ERROR\" | \"VALIDATION\"\n  ) {\n    super(message);\n    this.name = \"ConfigError\";\n  }\n}\n```\n\n## Edge Cases\n- **Corrupted JSON**: Throw ConfigError with code \"PARSE_ERROR\", let API layer handle\n- **Permission denied**: Throw ConfigError with code \"EACCES\", user needs to fix permissions\n- **Concurrent writes**: Last write wins (acceptable for v1, single user)\n- **Symlinks in path**: Resolve with `fs.realpath()` before storing\n\n## Acceptance Criteria\n- [ ] `~/.maestro/` directory created automatically on first access\n- [ ] `config.json` created with empty projects array on first access\n- [ ] All CRUD operations work correctly (add, get, update, delete)\n- [ ] `projectExists()` helper for quick validation\n- [ ] Path utility functions work correctly (toDisplayPath, toAbsolutePath, deriveDisplayName)\n- [ ] `getParentPath()` utility for relocate flow navigation\n- [ ] Security check rejects paths outside home directory\n- [ ] Symlinks resolved before storing\n- [ ] Type definitions exported for use by API routes\n- [ ] Singleton instance exported as `configService`\n- [ ] Clear error types for different failure modes\n\n## Files\n- `src/lib/types/config.ts` (new)\n- `src/lib/services/config.ts` (new)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T08:13:36.967567-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Created config types (MaestroConfig, ProjectConfig, ConfigError) and ConfigService class with full CRUD operations, path utilities, and security checks. Singleton instance exported as configService. TypeScript checks pass.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.24","title":"3. Projects API: GET, POST, PATCH, DELETE endpoints","description":"## Purpose\nImplement all four CRUD endpoints for projects. These are the backbone of the project management feature.\n\n## Endpoints Overview\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | /api/projects | List all projects with computed fields |\n| POST | /api/projects | Add a new project |\n| PATCH | /api/projects/[id] | Update name or relocate path |\n| DELETE | /api/projects/[id] | Remove project from tracking |\n\n---\n\n## GET /api/projects\n\nReturns all projects with computed fields and validation status.\n\n### Response Schema\n```typescript\ninterface ProjectsResponse {\n  projects: Project[];\n}\n\ninterface Project {\n  id: string;\n  path: string;              // Absolute: /Users/erik/dev/project\n  displayPath: string;       // Friendly: ~/dev/project\n  name: string | null;       // Custom name or null\n  displayName: string;       // name ?? derived from path\n  addedAt: string;           // ISO 8601\n  status: \"active\" | \"missing\";\n}\n```\n\n### Implementation\n- Fetch all projects from config service\n- For each project, check if path exists (`fs.access`)\n- Compute displayPath, displayName, status\n- Sort by addedAt descending (most recent first)\n- Return empty array when no projects (not error)\n\n---\n\n## POST /api/projects\n\nAdd a new project.\n\n### Request\n```json\n{\n  \"path\": \"/Users/erik/dev/my-project\",\n  \"name\": \"My Project\"\n}\n```\n\n`name` is optional (omit or set to null to derive from path).\n\n### Validation (in order)\n1. `path` required and non-empty string\n2. Path must be within home directory (security) -\u003e 403\n3. Resolve symlinks with `fs.realpath()`\n4. Path must exist -\u003e 404\n5. Path must be a directory -\u003e 400\n6. Path must not already be tracked -\u003e 409\n\n### Response\n- 201 with created project object on success\n- Error responses with `{ error: \"message\" }`\n\n---\n\n## PATCH /api/projects/[id]\n\nUpdate name or relocate path.\n\n### Request\n```json\n{\n  \"name\": \"New Name\",\n  \"path\": \"/new/path\"\n}\n```\n\nAt least one field required. Both optional.\n\n### Validation\n- Project must exist -\u003e 404\n- If path provided: same validation as POST (exists, is directory, in home, not duplicate)\n- If path is same as current: no-op (not an error, just return current state)\n- Empty name or whitespace-only -\u003e treat as null (use derived)\n\n### Response\n- 200 with updated project object\n- Error responses with `{ error: \"message\" }`\n\n---\n\n## DELETE /api/projects/[id]\n\nRemove project from tracking (not from disk).\n\n### Response\n- 204 No Content on success\n- 204 even if project doesn't exist (idempotent)\n\n---\n\n## Shared Response Type\n```typescript\n// Used in GET list item, POST response, PATCH response\ninterface Project {\n  id: string;\n  path: string;\n  displayPath: string;\n  name: string | null;\n  displayName: string;\n  addedAt: string;\n  status: \"active\" | \"missing\";\n}\n```\n\n## Error Response Format\nAll errors return:\n```json\n{\n  \"error\": \"Human-readable error message\"\n}\n```\n\n## Acceptance Criteria\n- [ ] GET /api/projects returns all projects with computed fields\n- [ ] GET returns empty array (not error) when no projects\n- [ ] GET detects missing projects (status: \"missing\")\n- [ ] POST validates all requirements (path exists, is directory, in home, not duplicate)\n- [ ] POST resolves symlinks before storing\n- [ ] POST returns 201 with created project\n- [ ] PATCH can update name only\n- [ ] PATCH can update path only (relocate)\n- [ ] PATCH can update both\n- [ ] PATCH with same path value is a no-op (not error)\n- [ ] PATCH returns 404 for unknown ID\n- [ ] DELETE returns 204 (idempotent)\n- [ ] All error responses have consistent format\n\n## Files\n- `src/app/api/projects/route.ts` (new) - GET, POST\n- `src/app/api/projects/[id]/route.ts` (new) - PATCH, DELETE","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T08:13:58.737043-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Implemented GET, POST /api/projects and PATCH, DELETE /api/projects/[id] endpoints with computed fields (displayPath, displayName, status), path validation, symlink resolution, missing project detection, and consistent error format.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.25","title":"4. Filesystem Browse API endpoint","description":"## Purpose\nImplement the `GET /api/filesystem/browse` endpoint for the folder picker UI. This enables users to navigate the server's filesystem to select project directories.\n\n## Why Custom Browsing?\nMaestro runs on the dev machine but is accessed remotely (via Tailscale). Browser file picker APIs open on the **client** device, not the server. We need a custom API that exposes the server's filesystem in a controlled way.\n\n## Security Constraints\n**Critical**: This endpoint exposes the filesystem. Security measures:\n1. **Home directory only** - Cannot browse outside `~`\n2. **Directories only** - Don't list files\n3. **Hidden directories filtered** - No `.git`, `.config`, `.ssh`, etc.\n4. **Permission errors handled gracefully** - Skip unreadable dirs\n\n## Query Parameters\n| Param | Required | Default | Description |\n|-------|----------|---------|-------------|\n| `path` | No | `~/dev` or `~` | Directory to list |\n\nIf `path` not provided:\n- Try `~/dev` first (common convention)\n- Fall back to `~` if `~/dev` doesn't exist\n\n## Response Schema\n```typescript\ninterface BrowseResponse {\n  currentPath: string;    // Absolute: /Users/erik/dev\n  displayPath: string;    // Friendly: ~/dev\n  parent: string | null;  // Parent path, null if at home\n  canGoUp: boolean;       // false if at home directory\n  directories: Directory[];\n}\n\ninterface Directory {\n  name: string;           // Directory name\n  path: string;           // Absolute path\n  isGitRepo: boolean;     // Has .git subdirectory\n}\n```\n\n## Implementation\n```typescript\n// src/app/api/filesystem/browse/route.ts\nconst HIDDEN_PATTERNS = [\n  /^\\./,                 // Hidden dirs (., .git, .config, etc)\n  /^node_modules$/,\n  /^__pycache__$/,\n  /^\\.cache$/,\n  /^vendor$/,\n  /^\\.?venv$/,\n  /^.next$/,            // Next.js build output\n  /^dist$/,             // Common build output\n  /^build$/,            // Common build output\n  /^target$/,           // Rust/Maven build output\n  /^coverage$/,         // Test coverage\n  /^\\.nyc_output$/,    // NYC coverage\n];\n\nfunction shouldHide(name: string): boolean {\n  return HIDDEN_PATTERNS.some(pattern =\u003e pattern.test(name));\n}\n\n// Add timeout wrapper for filesystem operations\nasync function withTimeout\u003cT\u003e(promise: Promise\u003cT\u003e, ms: number): Promise\u003cT\u003e {\n  const timeout = new Promise\u003cnever\u003e((_, reject) =\u003e\n    setTimeout(() =\u003e reject(new Error('Filesystem timeout')), ms)\n  );\n  return Promise.race([promise, timeout]);\n}\n\nexport async function GET(request: Request) {\n  // 1. Determine path (from query or default)\n  // 2. Security check: must be within home\n  // 3. Validate path exists and is directory (with 5s timeout)\n  // 4. Read directory entries (with 5s timeout)\n  // 5. Filter to visible directories\n  // 6. Check each for .git subdirectory\n  // 7. Sort alphabetically (case-insensitive)\n  // 8. Compute parent/canGoUp using configService.getParentPath()\n  // 9. Return response\n}\n```\n\n## Git Repo Detection\nCheck for `.git` subdirectory to identify git repos. This helps users visually distinguish project directories from regular folders.\n\n## Error Responses\n| Status | Condition |\n|--------|-----------|\n| 400 | Invalid path parameter |\n| 403 | Path outside home directory |\n| 404 | Path does not exist |\n| 500 | Filesystem timeout (network drive issues) |\n\n## Edge Cases\n- **Permission denied on subdirectory**: Skip it, don't fail request\n- **Symlink directory**: Follow it, check resolved path is within home\n- **Race condition (dir deleted while reading)**: Skip missing entries\n- **Network drive timeout**: Fail after 5 seconds with clear error\n\n## Acceptance Criteria\n- [ ] Returns directories at requested path\n- [ ] Defaults to ~/dev (or ~ if no ~/dev)\n- [ ] Hides hidden directories (starting with .)\n- [ ] Hides node_modules, __pycache__, vendor, venv\n- [ ] Hides build output directories (.next, dist, build, target, coverage)\n- [ ] Shows isGitRepo indicator for git repos\n- [ ] Provides parent path for navigation (using configService.getParentPath())\n- [ ] Returns canGoUp: false at home directory\n- [ ] Returns 403 for paths outside home\n- [ ] Returns 404 for non-existent paths\n- [ ] Handles permission errors gracefully (skips unreadable)\n- [ ] Directories sorted alphabetically (case-insensitive)\n- [ ] 5 second timeout for filesystem operations\n\n## Files\n- `src/app/api/filesystem/browse/route.ts` (new)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T08:14:22.590412-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Implemented GET /api/filesystem/browse endpoint with security constraints (home directory only), hidden directory filtering, git repo detection, 5s timeout, and proper error handling.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.26","title":"5. React Query Hooks for Projects and Filesystem","description":"Completed: Created React Query hooks for Projects and Filesystem APIs","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T08:14:44.110157-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Created api.ts types (Project, Directory, BrowseResult), useProjects.ts hooks (useProjects, useProject, useAddProject, useUpdateProject, useDeleteProject), and useFilesystem.ts hook. All with proper TypeScript types, error handling, and cache invalidation.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.27","title":"6. FolderBrowserModal with Directory List and Breadcrumbs","description":"## Purpose\nCreate the complete folder browser modal for adding projects (and later, relocating). This is a cohesive UI component that includes the modal wrapper, directory list, breadcrumb navigation, and add project form.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────┐\n│  Select Project Folder                      [X] │\n├─────────────────────────────────────────────────┤\n│  ~ / dev / my-project                       [↑] │  \u003c- Breadcrumbs\n├─────────────────────────────────────────────────┤\n│  📁 api-gateway              git                │\n│  📁 frontend                 git                │\n│  📁 scripts                                     │\n│                                                 │\n│              (ScrollArea - scrollable)          │\n├─────────────────────────────────────────────────┤\n│  Name: [my-project              ] (optional)    │\n├─────────────────────────────────────────────────┤\n│                    [Cancel]  [Add Project]      │\n└─────────────────────────────────────────────────┘\n```\n\n## Component Structure\n```\nfolder-browser/\n├── FolderBrowserModal.tsx   # Main modal with state management\n├── DirectoryList.tsx        # Scrollable directory list (uses ScrollArea)\n├── Breadcrumbs.tsx          # Path navigation\n└── index.ts                 # Exports\n```\n\n## Props - FolderBrowserModal\n```typescript\ninterface FolderBrowserModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n  \n  // For \"Relocate\" mode (Task 9)\n  mode?: \"add\" | \"relocate\";\n  initialPath?: string;\n  projectToRelocate?: Project;\n  \n  onSuccess?: () =\u003e void;\n}\n```\n\n## State Management\nThe modal manages navigation state and calls the API:\n```typescript\nconst [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e(initialPath);\nconst [customName, setCustomName] = useState(\"\");\nconst [error, setError] = useState\u003cstring | null\u003e(null);\n\nconst { data: filesystem, isLoading, error: fetchError } = useFilesystem(currentPath);\nconst addProject = useAddProject();\nconst updateProject = useUpdateProject();\n```\n\n## DirectoryList Component\n```typescript\ninterface DirectoryListProps {\n  directories: Directory[];\n  onNavigate: (path: string) =\u003e void;\n  isLoading?: boolean;\n}\n```\n\nFeatures:\n- Wrapped in `\u003cScrollArea\u003e` for mobile-friendly scrolling\n- Click directory -\u003e navigate into it\n- Git indicator badge for repos\n- Loading skeleton while fetching\n- Empty state when no subdirectories\n- 44px+ touch targets for mobile\n\n## Breadcrumbs Component\n```typescript\ninterface BreadcrumbsProps {\n  currentPath: string;       // Absolute path for building segment paths\n  displayPath: string;       // ~/dev/project for display\n  onNavigate: (path: string) =\u003e void;\n  parent: string | null;\n  canGoUp: boolean;\n}\n```\n\nFeatures:\n- Clickable path segments (except current)\n- Up button (disabled at home)\n- Horizontal scroll on mobile with overflow-x-auto\n- Home icon for ~ segment\n\n## Mobile-Responsive Dialog\n```typescript\n\u003cDialogContent className=\"max-w-none h-full sm:max-w-lg sm:h-auto sm:max-h-[80vh]\"\u003e\n```\n\nThis makes the modal full-screen on mobile, constrained on desktop.\n\n## Keyboard Accessibility\n- **Enter** on directory item: Navigate into it\n- **Escape**: Close modal (default Dialog behavior)\n- **Arrow keys**: Navigate directory list items\n- **Tab**: Move between interactive elements\n\n## Dual Mode Support\nThe modal supports both adding and relocating:\n\n**Add Mode (default)**:\n- Title: \"Select Project Folder\"\n- Shows name input\n- Button: \"Add Project\" (disabled until directory selected)\n- Calls useAddProject\n\n**Relocate Mode**:\n- Title: \"Relocate Project\"\n- Shows old path context (warning banner)\n- No name input (keep existing)\n- Button: \"Update Location\"\n- Calls useUpdateProject with new path\n\n```typescript\n// In modal\nconst handleSubmit = async () =\u003e {\n  if (!filesystem?.currentPath) return;\n  \n  setError(null);\n  try {\n    if (mode === \"relocate\" \u0026\u0026 projectToRelocate) {\n      await updateProject.mutateAsync({\n        id: projectToRelocate.id,\n        path: filesystem.currentPath,\n      });\n    } else {\n      await addProject.mutateAsync({\n        path: filesystem.currentPath,\n        name: customName.trim() || undefined,\n      });\n    }\n    onOpenChange(false);\n    onSuccess?.();\n  } catch (err) {\n    setError(err instanceof Error ? err.message : \"An error occurred\");\n  }\n};\n```\n\n## Button States\n- **Add/Update button disabled when**: No directory selected, or mutation in progress\n- **Show loading spinner**: When mutation is pending\n\n## Error Handling\n- Browse errors: Show in directory list area with retry button\n- Add/Update errors: Show inline below form (red Alert component)\n- Clear error when navigating or retrying\n\n## Acceptance Criteria\n- [ ] Modal opens/closes correctly\n- [ ] Full-screen on mobile, constrained on desktop\n- [ ] Breadcrumbs show current path with clickable segments\n- [ ] Up button navigates to parent (disabled at home)\n- [ ] Directory list wrapped in ScrollArea\n- [ ] Directory list shows folders with git indicators\n- [ ] Click directory navigates into it\n- [ ] Loading skeleton while fetching directories\n- [ ] Empty state when no subdirectories\n- [ ] Name input with folder name as placeholder (add mode only)\n- [ ] Add button disabled until directory selected\n- [ ] Add mode: calls POST /api/projects\n- [ ] Relocate mode: calls PATCH /api/projects/[id] with path\n- [ ] Shows loading state on submit button\n- [ ] Shows errors inline (Alert component)\n- [ ] Closes on success\n- [ ] Keyboard accessible (Enter, Escape, Tab)\n\n## Files\n- `src/components/folder-browser/FolderBrowserModal.tsx` (new)\n- `src/components/folder-browser/DirectoryList.tsx` (new)\n- `src/components/folder-browser/Breadcrumbs.tsx` (new)\n- `src/components/folder-browser/index.ts` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T08:15:12.42384-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Created FolderBrowserModal, DirectoryList, and Breadcrumbs components with full functionality including add/relocate modes, navigation, loading states, error handling, and mobile-responsive design. TypeScript and build pass.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.28","title":"7. Project List Page: API Integration and States","description":"## Purpose\nUpdate the main project list page to fetch real data from the API, replacing mock data. This includes all UI states: loading, error, empty, and the \"Add Project\" button.\n\n## Current State\n```typescript\n// src/app/page.tsx\nimport { mockProjects } from \"@/lib/data/mock\";\n// Uses mockProjects.map(...)\n```\n\n## Target State\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\nimport { FolderBrowserModal } from \"@/components/folder-browser\";\n\nexport default function ProjectListPage() {\n  const { data: projects, isLoading, error, refetch } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  \n  // Render based on state...\n}\n```\n\n## Page Structure\n```\n┌─────────────────────────────────────────────────────────────┐\n│  ⚡ Maestro                              [Search] [+ Add]   │  \u003c- Header\n├─────────────────────────────────────────────────────────────┤\n│  Projects                                                   │\n│  Select a project to view swarms and sessions               │\n├─────────────────────────────────────────────────────────────┤\n│  ┌─────────────────────────────────────────────────────┐   │\n│  │  📁 my-project                                  [⋮] │   │  \u003c- Project cards\n│  │     ~/dev/my-project                                │   │\n│  ├─────────────────────────────────────────────────────┤   │\n│  │  📁 another-project                             [⋮] │   │\n│  │     ~/dev/another                                   │   │\n│  └─────────────────────────────────────────────────────┘   │\n└─────────────────────────────────────────────────────────────┘\n```\n\n## State Rendering Logic\n```typescript\nif (isLoading) {\n  return \u003cProjectListSkeleton /\u003e;\n}\n\nif (error \u0026\u0026 !projects) {\n  return \u003cProjectListError message={error.message} onRetry={refetch} /\u003e;\n}\n\nif (!projects?.length) {\n  return \u003cNoProjectsEmptyState onAddProject={() =\u003e setFolderBrowserOpen(true)} /\u003e;\n}\n\nreturn \u003cProjectList projects={projects} /\u003e;\n```\n\n## Loading State - Skeleton Cards\n```typescript\nfunction ProjectCardSkeleton() {\n  return (\n    \u003cdiv className=\"flex items-center gap-3 px-3 py-2.5 animate-pulse\"\u003e\n      \u003cdiv className=\"w-8 h-8 rounded-md bg-secondary\" /\u003e\n      \u003cdiv className=\"flex-1 space-y-2\"\u003e\n        \u003cdiv className=\"h-4 w-32 bg-secondary rounded\" /\u003e\n        \u003cdiv className=\"h-3 w-48 bg-secondary rounded\" /\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nShow 3 skeletons as default.\n\n## Error State\n```typescript\nfunction ProjectListError({ message, onRetry }) {\n  return (\n    \u003cdiv className=\"border rounded-md p-8 text-center\"\u003e\n      \u003cAlertCircle className=\"h-6 w-6 text-destructive mx-auto mb-4\" /\u003e\n      \u003ch3 className=\"font-medium mb-1\"\u003eFailed to load projects\u003c/h3\u003e\n      \u003cp className=\"text-sm text-muted-foreground mb-4\"\u003e{message}\u003c/p\u003e\n      \u003cButton variant=\"outline\" onClick={onRetry}\u003e\n        \u003cRefreshCw className=\"h-4 w-4 mr-2\" /\u003e\n        Try Again\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Empty State\n```typescript\nfunction NoProjectsEmptyState({ onAddProject }) {\n  return (\n    \u003cdiv className=\"flex flex-col items-center py-16 text-center\"\u003e\n      \u003cdiv className=\"w-16 h-16 rounded-full bg-secondary flex items-center justify-center mb-6\"\u003e\n        \u003cFolder className=\"h-8 w-8 text-muted-foreground\" /\u003e\n      \u003c/div\u003e\n      \u003ch2 className=\"text-lg font-semibold mb-2\"\u003eNo projects yet\u003c/h2\u003e\n      \u003cp className=\"text-sm text-muted-foreground mb-6 max-w-sm\"\u003e\n        Add a project folder to get started.\n      \u003c/p\u003e\n      \u003cButton onClick={onAddProject}\u003e\n        \u003cPlus className=\"h-4 w-4 mr-2\" /\u003e\n        Add Project\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Header Add Button\nUpdate header to include Add button:\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b bg-card\"\u003e\n  \u003cdiv className=\"flex h-12 items-center justify-between px-4\"\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cZap /\u003e\n      \u003cspan\u003eMaestro\u003c/span\u003e\n    \u003c/div\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cbutton className=\"search-button\"\u003e...\u003c/button\u003e\n      \u003cButton size=\"sm\" onClick={() =\u003e setFolderBrowserOpen(true)}\u003e\n        \u003cPlus className=\"h-4 w-4\" /\u003e\n        \u003cspan className=\"hidden sm:inline ml-1\"\u003eAdd\u003c/span\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\u003c/header\u003e\n```\n\nMobile: Icon only. Desktop: Icon + \"Add\".\n\n## Interim Project Cards\nFor this task, render simple cards inline. The full ProjectCard component with menu will replace this in Task 8.\n\n```typescript\n{projects.map((project) =\u003e {\n  const isMissing = project.status === \"missing\";\n  return (\n    \u003cLink \n      key={project.id}\n      href={isMissing ? undefined : `/project/${project.id}`}\n      className={cn(\n        \"flex items-center gap-3 px-3 py-2.5\",\n        isMissing ? \"opacity-60 cursor-default\" : \"hover:bg-secondary/50\"\n      )}\n    \u003e\n      \u003cFolder className={cn(\"h-4 w-4\", isMissing \u0026\u0026 \"text-warning\")} /\u003e\n      \u003cdiv className=\"flex-1 min-w-0\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cspan className=\"font-medium text-sm\"\u003e{project.displayName}\u003c/span\u003e\n          {isMissing \u0026\u0026 (\n            \u003cspan className=\"text-xs px-1.5 py-0.5 rounded bg-warning/10 text-warning\"\u003e\n              Missing\n            \u003c/span\u003e\n          )}\n        \u003c/div\u003e\n        \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n          {project.displayPath}\n        \u003c/p\u003e\n      \u003c/div\u003e\n      {!isMissing \u0026\u0026 \u003cChevronRight className=\"h-4 w-4 text-muted-foreground\" /\u003e}\n    \u003c/Link\u003e\n  );\n})}\n```\n\nNote: Missing projects show warning badge but no navigation. The menu and edit functionality comes in Task 8.\n\n## Modal Placement\nThe FolderBrowserModal lives inside the page component:\n```typescript\nreturn (\n  \u003cdiv\u003e\n    {/* ... page content ... */}\n    \u003cFolderBrowserModal \n      open={folderBrowserOpen}\n      onOpenChange={setFolderBrowserOpen}\n    /\u003e\n  \u003c/div\u003e\n);\n```\n\n## Acceptance Criteria\n- [ ] Fetches projects from API using useProjects\n- [ ] Loading skeleton shown during initial fetch (3 cards)\n- [ ] Error state with retry button\n- [ ] Empty state with Add Project CTA\n- [ ] Projects rendered with displayName and displayPath\n- [ ] Missing projects show warning badge and dimmed styling\n- [ ] Clicking active project navigates to /project/[id]\n- [ ] Clicking missing project does NOT navigate\n- [ ] Header has Add button (icon-only on mobile, icon+text on desktop)\n- [ ] Add button opens FolderBrowserModal\n- [ ] Project list updates after adding project\n- [ ] Remove mockProjects import\n\n## Files\n- `src/app/page.tsx` (major update)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T08:15:42.972344-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Updated page.tsx to use useProjects hook, added loading skeleton, error state with retry, empty state with Add CTA, missing project handling (yellow badge, not clickable), and integrated FolderBrowserModal. Removed mockProjects import.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.29","title":"8. ProjectCard Component with Menu and Edit Name","description":"## Purpose\nExtract the project card into a reusable component with a dropdown menu for actions: Edit Name and Remove. This enables inline project management.\n\n## Visual Design\n```\n┌──────────────────────────────────────────────────────────────┐\n│  📁 my-project                                          [⋮] │\n│     ~/dev/my-project                                        │\n└──────────────────────────────────────────────────────────────┘\n                                                           │\n                                                  ┌────────┴────────┐\n                                                  │  ✏️ Edit Name   │\n                                                  │  🗑️ Remove      │\n                                                  └─────────────────┘\n```\n\n## Component Structure\n```\nproject-card/\n├── ProjectCard.tsx       # Main card component\n├── ProjectCardMenu.tsx   # Dropdown menu\n├── EditNameDialog.tsx    # Edit name modal\n└── index.ts\n```\n\n## ProjectCard Props\n```typescript\ninterface ProjectCardProps {\n  project: Project;\n  onEdit: () =\u003e void;\n  onRemove: () =\u003e void;\n  onRelocate?: () =\u003e void;  // Only for missing projects (Task 9)\n}\n```\n\n## ProjectCard Implementation\nThe card content is a Link, but the menu button sits outside the Link to prevent navigation when clicking the menu.\n\n```typescript\nexport function ProjectCard({ project, onEdit, onRemove, onRelocate }: ProjectCardProps) {\n  const isMissing = project.status === \"missing\";\n  \n  return (\n    \u003cdiv className={cn(\n      \"flex items-center gap-3 px-3 py-2.5 transition-colors\",\n      isMissing ? \"opacity-60\" : \"hover:bg-secondary/50\"\n    )}\u003e\n      {/* Card content as conditional link */}\n      {isMissing ? (\n        \u003cdiv className=\"flex items-center gap-3 flex-1 min-w-0\"\u003e\n          {/* content */}\n        \u003c/div\u003e\n      ) : (\n        \u003cLink \n          href={`/project/${project.id}`}\n          className=\"flex items-center gap-3 flex-1 min-w-0\"\n        \u003e\n          {/* same content */}\n        \u003c/Link\u003e\n      )}\n      \n      {/* Menu - NOT part of link */}\n      \u003cProjectCardMenu\n        isMissing={isMissing}\n        onEdit={onEdit}\n        onRemove={onRemove}\n        onRelocate={onRelocate}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## ProjectCardMenu\n```typescript\ninterface ProjectCardMenuProps {\n  isMissing: boolean;\n  onEdit: () =\u003e void;\n  onRemove: () =\u003e void;\n  onRelocate?: () =\u003e void;\n}\n\nfunction ProjectCardMenu({ isMissing, onEdit, onRemove, onRelocate }) {\n  return (\n    \u003cDropdownMenu\u003e\n      \u003cDropdownMenuTrigger asChild\u003e\n        \u003cbutton \n          className=\"h-8 w-8 flex items-center justify-center rounded-md hover:bg-secondary\"\n          onClick={(e) =\u003e e.stopPropagation()}\n        \u003e\n          \u003cMoreVertical className=\"h-4 w-4 text-muted-foreground\" /\u003e\n        \u003c/button\u003e\n      \u003c/DropdownMenuTrigger\u003e\n      \u003cDropdownMenuContent align=\"end\"\u003e\n        {isMissing \u0026\u0026 onRelocate \u0026\u0026 (\n          \u003cDropdownMenuItem onClick={onRelocate} className=\"font-medium\"\u003e\n            \u003cFolderSearch className=\"h-4 w-4 mr-2\" /\u003e\n            Relocate\n          \u003c/DropdownMenuItem\u003e\n        )}\n        \u003cDropdownMenuItem onClick={onEdit}\u003e\n          \u003cPencil className=\"h-4 w-4 mr-2\" /\u003e\n          Edit Name\n        \u003c/DropdownMenuItem\u003e\n        \u003cDropdownMenuItem onClick={onRemove} className=\"text-destructive\"\u003e\n          \u003cTrash2 className=\"h-4 w-4 mr-2\" /\u003e\n          Remove\n        \u003c/DropdownMenuItem\u003e\n      \u003c/DropdownMenuContent\u003e\n    \u003c/DropdownMenu\u003e\n  );\n}\n```\n\n## EditNameDialog\n```typescript\ninterface EditNameDialogProps {\n  project: Project | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n}\n\nfunction EditNameDialog({ project, open, onOpenChange }) {\n  const [name, setName] = useState(\"\");\n  const updateProject = useUpdateProject();\n  \n  useEffect(() =\u003e {\n    if (project \u0026\u0026 open) {\n      setName(project.name || \"\");\n    }\n  }, [project, open]);\n  \n  const handleSave = async () =\u003e {\n    if (!project) return;\n    await updateProject.mutateAsync({\n      id: project.id,\n      name: name.trim() || null,  // null reverts to derived name\n    });\n    onOpenChange(false);\n  };\n  \n  const derivedName = project?.path.split(\"/\").pop() || \"\";\n  \n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent className=\"sm:max-w-md\"\u003e\n        \u003cDialogHeader\u003e\n          \u003cDialogTitle\u003eEdit Project Name\u003c/DialogTitle\u003e\n        \u003c/DialogHeader\u003e\n        \u003cdiv className=\"space-y-4 py-4\"\u003e\n          \u003cdiv className=\"space-y-2\"\u003e\n            \u003cLabel htmlFor=\"name\"\u003eDisplay Name\u003c/Label\u003e\n            \u003cInput\n              id=\"name\"\n              value={name}\n              onChange={(e) =\u003e setName(e.target.value)}\n              placeholder={derivedName}\n            /\u003e\n            \u003cp className=\"text-xs text-muted-foreground\"\u003e\n              Leave empty to use folder name ({derivedName})\n            \u003c/p\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n        \u003cDialogFooter\u003e\n          \u003cButton variant=\"outline\" onClick={() =\u003e onOpenChange(false)}\u003e\n            Cancel\n          \u003c/Button\u003e\n          \u003cButton onClick={handleSave} disabled={updateProject.isPending}\u003e\n            {updateProject.isPending ? \"Saving...\" : \"Save\"}\n          \u003c/Button\u003e\n        \u003c/DialogFooter\u003e\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  );\n}\n```\n\n## Remove Action\nRemove calls useDeleteProject directly - no confirmation needed (non-destructive, only removes from tracking):\n```typescript\nconst deleteProject = useDeleteProject();\n// ...\nonRemove={() =\u003e deleteProject.mutate(project.id)}\n```\n\nThe project is removed from the list immediately when the mutation succeeds (React Query invalidates the cache).\n\n## Integration with Page\n```typescript\n// In page.tsx\nconst [editingProject, setEditingProject] = useState\u003cProject | null\u003e(null);\nconst deleteProject = useDeleteProject();\n\n{projects.map((project) =\u003e (\n  \u003cProjectCard\n    key={project.id}\n    project={project}\n    onEdit={() =\u003e setEditingProject(project)}\n    onRemove={() =\u003e deleteProject.mutate(project.id)}\n    // onRelocate handled in Task 9\n  /\u003e\n))}\n\n\u003cEditNameDialog \n  project={editingProject}\n  open={!!editingProject}\n  onOpenChange={(open) =\u003e !open \u0026\u0026 setEditingProject(null)}\n/\u003e\n```\n\n## Acceptance Criteria\n- [ ] ProjectCard renders project info (displayName, displayPath)\n- [ ] Active projects are clickable links\n- [ ] Missing projects are NOT clickable (handled in Task 9 for full styling)\n- [ ] Three-dot menu icon on each card\n- [ ] Menu opens without navigating to project (e.stopPropagation)\n- [ ] Menu shows \"Edit Name\" and \"Remove\" options\n- [ ] \"Edit Name\" opens EditNameDialog\n- [ ] EditNameDialog pre-fills current name (or empty if using derived)\n- [ ] Can save new name\n- [ ] Empty name input reverts to derived name\n- [ ] \"Remove\" immediately deletes (no confirmation)\n- [ ] Project list updates after edit/remove\n- [ ] Menu closes after action\n- [ ] Touch-friendly tap targets (8x8 minimum for menu button)\n\n## Files\n- `src/components/project-card/ProjectCard.tsx` (new)\n- `src/components/project-card/ProjectCardMenu.tsx` (new)\n- `src/components/project-card/EditNameDialog.tsx` (new)\n- `src/components/project-card/index.ts` (new)\n- `src/app/page.tsx` (integrate - replace inline cards with ProjectCard)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T08:16:08.491404-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Created ProjectCard, ProjectCardMenu, and EditNameDialog components. Updated page.tsx to use them. Menu has Edit Name and Remove options, supports Relocate for missing projects. Edit dialog pre-fills and updates via useUpdateProject. Build passes.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.3","title":"1.3 Implement POST /api/projects endpoint","description":"## Purpose\nImplement the `POST /api/projects` endpoint for adding new projects to Maestro.\n\n## Why Validation Matters\nThis endpoint is the gatekeeper for project integrity. It must validate:\n1. Path is provided and non-empty\n2. Path exists on the filesystem\n3. Path is a directory (not a file)\n4. Path is within user's home directory (security)\n5. Path isn't already tracked (no duplicates)\n\n## Request Schema\n```typescript\ninterface AddProjectRequest {\n  path: string;       // Required: absolute path\n  name?: string;      // Optional: custom display name\n}\n```\n\n## Response Schema\nOn success, returns the created project (same shape as GET response item):\n```typescript\ninterface Project {\n  id: string;\n  path: string;\n  displayPath: string;\n  name: string | null;\n  displayName: string;\n  addedAt: string;\n  status: \"active\";\n}\n```\n\n## Error Responses\n| Status | Condition | Response |\n|--------|-----------|----------|\n| 400 | Missing or empty path | `{ error: \"Path is required\" }` |\n| 400 | Path is not a directory | `{ error: \"Path is not a directory\" }` |\n| 403 | Path outside home directory | `{ error: \"Path must be within home directory\" }` |\n| 404 | Path does not exist | `{ error: \"Path does not exist\" }` |\n| 409 | Duplicate path | `{ error: \"Project already exists\" }` |\n\n## Implementation\n```typescript\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const { path: inputPath, name } = body;\n    \n    // Validate path provided\n    if (!inputPath || typeof inputPath !== \"string\" || !inputPath.trim()) {\n      return NextResponse.json(\n        { error: \"Path is required\" },\n        { status: 400 }\n      );\n    }\n    \n    const absolutePath = configService.toAbsolutePath(inputPath.trim());\n    \n    // Security: must be within home\n    if (!configService.isWithinHome(absolutePath)) {\n      return NextResponse.json(\n        { error: \"Path must be within home directory\" },\n        { status: 403 }\n      );\n    }\n    \n    // Check path exists\n    try {\n      await fs.access(absolutePath);\n    } catch {\n      return NextResponse.json(\n        { error: \"Path does not exist\" },\n        { status: 404 }\n      );\n    }\n    \n    // Check it's a directory\n    const stat = await fs.stat(absolutePath);\n    if (!stat.isDirectory()) {\n      return NextResponse.json(\n        { error: \"Path is not a directory\" },\n        { status: 400 }\n      );\n    }\n    \n    // Check for duplicates\n    const existing = await configService.getProjects();\n    if (existing.some(p =\u003e p.path === absolutePath)) {\n      return NextResponse.json(\n        { error: \"Project already exists\" },\n        { status: 409 }\n      );\n    }\n    \n    // Add project\n    const project = await configService.addProject(\n      absolutePath,\n      name?.trim() || undefined\n    );\n    \n    return NextResponse.json({\n      id: project.id,\n      path: project.path,\n      displayPath: configService.toDisplayPath(project.path),\n      name: project.name,\n      displayName: project.name ?? configService.deriveDisplayName(project.path),\n      addedAt: project.addedAt,\n      status: \"active\",\n    }, { status: 201 });\n    \n  } catch (error) {\n    console.error(\"Failed to add project:\", error);\n    return NextResponse.json(\n      { error: \"Failed to add project\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\n## Edge Cases\n- **Path with trailing slash**: Normalize before storing\n- **Path with ~**: Expand to absolute before validation/storage\n- **Symlink path**: Follow symlink, check resolved path is within home\n- **Empty name string**: Treat as null (use derived name)\n- **Whitespace-only name**: Treat as null\n\n## Acceptance Criteria\n- [ ] Validates all required fields\n- [ ] Returns 400 for missing/invalid path\n- [ ] Returns 403 for paths outside home directory\n- [ ] Returns 404 for non-existent paths\n- [ ] Returns 400 for file paths (not directories)\n- [ ] Returns 409 for duplicate paths\n- [ ] Returns 201 with created project on success\n- [ ] Generated UUID is used in response\n- [ ] Timestamp is set correctly\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service)\n- **Can parallel with**: Task 1.2 (GET endpoint)\n\n## Files\n- `src/app/api/projects/route.ts` (add POST handler)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:02.92336-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into consolidated Projects API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.30","title":"9. Missing Project Detection and Relocate Flow","description":"## Purpose\nEnhance the project card to show warning status for missing projects (path no longer exists) and provide a \"Relocate\" action to point Maestro to the project's new location.\n\n## Why Projects Go Missing\n- Directory was moved or renamed\n- External drive disconnected\n- Project deleted from disk\n- Path changed outside Maestro\n\n## Visual Treatment - Missing Projects\n```\nActive project:\n┌──────────────────────────────────────────────────────────────┐\n│  📁 my-project                                          [⋮] │\n│     ~/dev/my-project                                        │\n└──────────────────────────────────────────────────────────────┘\n\nMissing project:\n┌──────────────────────────────────────────────────────────────┐\n│  📁 old-project                    ⚠️ Missing           [⋮] │\n│     ~/dev/old-project                                       │\n└──────────────────────────────────────────────────────────────┘\n  (dimmed styling, warning colors)\n```\n\n## ProjectCard Updates for Missing Status\nExtend the ProjectCard component from Task 8:\n\n```typescript\nconst isMissing = project.status === \"missing\";\n\nreturn (\n  \u003cdiv className={cn(\n    \"flex items-center gap-3 px-3 py-2.5 transition-colors\",\n    isMissing \n      ? \"opacity-60 bg-secondary/20\" \n      : \"hover:bg-secondary/50\"\n  )}\u003e\n    {/* Icon with warning indicator */}\n    \u003cdiv className=\"relative\"\u003e\n      \u003cdiv className={cn(\n        \"flex items-center justify-center w-8 h-8 rounded-md\",\n        isMissing ? \"bg-warning/10\" : \"bg-secondary\"\n      )}\u003e\n        \u003cFolder className={cn(\n          \"h-4 w-4\",\n          isMissing ? \"text-warning\" : \"text-muted-foreground\"\n        )} /\u003e\n      \u003c/div\u003e\n      {isMissing \u0026\u0026 (\n        \u003cAlertTriangle className=\"h-3 w-3 text-warning absolute -top-1 -right-1\" /\u003e\n      )}\n    \u003c/div\u003e\n    \n    \u003cdiv className=\"flex-1 min-w-0\"\u003e\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cspan className={cn(\"font-medium text-sm\", isMissing \u0026\u0026 \"text-muted-foreground\")}\u003e\n          {project.displayName}\n        \u003c/span\u003e\n        {isMissing \u0026\u0026 (\n          \u003cspan className=\"text-xs px-1.5 py-0.5 rounded bg-warning/10 text-warning\"\u003e\n            Missing\n          \u003c/span\u003e\n        )}\n      \u003c/div\u003e\n      \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n        {project.displayPath}\n      \u003c/p\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n);\n```\n\n## Click Behavior for Missing Projects\nMissing projects do NOT navigate to `/project/[id]`. The content is not wrapped in a Link:\n\n```typescript\n// In ProjectCard - already handled via conditional Link in Task 8\n{isMissing ? (\n  \u003cdiv className=\"flex items-center gap-3 flex-1 min-w-0 cursor-default\"\u003e\n    {/* content */}\n  \u003c/div\u003e\n) : (\n  \u003cLink href={`/project/${project.id}`} className=\"...\"\u003e\n    {/* content */}\n  \u003c/Link\u003e\n)}\n```\n\n## Menu Updates for Missing Projects\nThe \"Relocate\" option is shown for missing projects (already stubbed in Task 8):\n\n```typescript\n{isMissing \u0026\u0026 onRelocate \u0026\u0026 (\n  \u003cDropdownMenuItem onClick={onRelocate} className=\"font-medium\"\u003e\n    \u003cFolderSearch className=\"h-4 w-4 mr-2\" /\u003e\n    Relocate\n  \u003c/DropdownMenuItem\u003e\n)}\n```\n\n## Relocate Using FolderBrowserModal\nReuse FolderBrowserModal in \"relocate\" mode:\n\n```typescript\n// In page.tsx\nconst [relocatingProject, setRelocatingProject] = useState\u003cProject | null\u003e(null);\n\n{projects.map((project) =\u003e (\n  \u003cProjectCard\n    project={project}\n    onEdit={() =\u003e setEditingProject(project)}\n    onRemove={() =\u003e deleteProject.mutate(project.id)}\n    onRelocate={project.status === \"missing\" \n      ? () =\u003e setRelocatingProject(project) \n      : undefined}\n  /\u003e\n))}\n\n// FolderBrowserModal for relocation\n\u003cFolderBrowserModal\n  open={!!relocatingProject}\n  onOpenChange={(open) =\u003e !open \u0026\u0026 setRelocatingProject(null)}\n  mode=\"relocate\"\n  projectToRelocate={relocatingProject ?? undefined}\n  initialPath={getRelocateInitialPath(relocatingProject)}\n/\u003e\n```\n\n## getRelocateInitialPath Helper\nUse configService.getParentPath() with fallback chain:\n```typescript\nfunction getRelocateInitialPath(project: Project | null): string | undefined {\n  if (!project) return undefined;\n  \n  // Try parent of old path, then ~/dev, then ~ \n  // This is handled server-side by the browse API default\n  // Just pass the parent path, API will handle fallbacks\n  const parts = project.path.split('/');\n  parts.pop();\n  return parts.join('/') || undefined;\n}\n```\n\nNote: If the parent path doesn't exist, the filesystem browse API will fall back to ~/dev or ~.\n\n## Relocate Mode in FolderBrowserModal\n(Specified in Task 6, but summarized here for context)\n\nWhen `mode=\"relocate\"`:\n- Title: \"Relocate Project\"\n- Shows old path context with warning banner:\n```typescript\n{projectToRelocate \u0026\u0026 (\n  \u003cdiv className=\"px-4 py-3 bg-warning/10 border-b\"\u003e\n    \u003cdiv className=\"flex items-center gap-2 text-sm\"\u003e\n      \u003cAlertTriangle className=\"h-4 w-4 text-warning\" /\u003e\n      \u003cspan\u003eCurrent path (missing):\u003c/span\u003e\n    \u003c/div\u003e\n    \u003cp className=\"text-sm font-mono mt-1\"\u003e{projectToRelocate.displayPath}\u003c/p\u003e\n  \u003c/div\u003e\n)}\n```\n- No name input\n- Button: \"Update Location\"\n- Calls PATCH with new path\n\n## Acceptance Criteria\n- [ ] Missing projects have dimmed/muted styling (opacity-60, bg-secondary/20)\n- [ ] Warning icon overlay on folder icon for missing projects\n- [ ] \"Missing\" badge next to project name\n- [ ] Click on missing project does NOT navigate\n- [ ] Menu shows \"Relocate\" as first option for missing projects\n- [ ] Relocate opens FolderBrowserModal in relocate mode\n- [ ] Modal shows old path context with warning styling\n- [ ] Modal starts navigated to parent of old path (or fallback)\n- [ ] Can navigate and select new location\n- [ ] \"Update Location\" calls PATCH API with new path\n- [ ] Project becomes active after successful relocate\n- [ ] Error messages shown inline in modal\n\n## Files\n- `src/components/project-card/ProjectCard.tsx` (update with full missing styling)\n- `src/app/page.tsx` (integrate relocate state and modal)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T08:16:38.407937-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Wired up relocate flow in page.tsx with getRelocateInitialPath helper, relocatingProject state, onRelocate callback for missing projects, and FolderBrowserModal in relocate mode. Build passes.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.31","title":"10. Sidebar: API Integration and Add Project Button","description":"## Purpose\nUpdate the sidebar to fetch projects from the API instead of mock data, and wire the \"+\" button to open the folder browser modal.\n\n## Current State\n```typescript\n// In sidebar.tsx\nimport { mockProjects } from \"@/lib/data/mock\";\n// Uses mockProjects.map(...)\n```\n\n## Target State\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\nimport { FolderBrowserModal } from \"@/components/folder-browser\";\n\nexport function Sidebar() {\n  const { data: projects, isLoading } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  // ...\n}\n```\n\n## Sidebar Structure\n```\n┌─────────────────────────────────────┐\n│  ⚡ Maestro                         │\n├─────────────────────────────────────┤\n│  [🔍 Search...]                     │\n├─────────────────────────────────────┤\n│  PROJECTS                       [+] │  \u003c- Wire this button\n│  ▶ my-project                       │\n│  ▶ another-project                  │\n│  ▶ old-project          ⚠️         │  \u003c- Missing indicator\n├─────────────────────────────────────┤\n│  ...                                │\n└─────────────────────────────────────┘\n```\n\n## Changes Required\n\n### 1. Import and use hooks\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\nimport { FolderBrowserModal } from \"@/components/folder-browser\";\n\nexport function Sidebar() {\n  const { data: projects, isLoading } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  // ...\n}\n```\n\n### 2. Update project rendering\n```typescript\n{isLoading ? (\n  \u003cdiv className=\"px-4 py-2 text-xs text-muted-foreground\"\u003e\n    Loading...\n  \u003c/div\u003e\n) : projects?.length ? (\n  projects.map((project) =\u003e {\n    const isMissing = project.status === \"missing\";\n    return (\n      \u003cTreeItem\n        key={project.id}\n        icon={\u003cFolder className={cn(\"h-4 w-4\", isMissing \u0026\u0026 \"text-warning\")} /\u003e}\n        label={project.displayName}\n        href={isMissing ? undefined : `/project/${project.id}`}\n        statusIndicator={isMissing ? \"warning\" : undefined}\n      /\u003e\n    );\n  })\n) : (\n  \u003cdiv className=\"px-4 py-2 text-xs text-muted-foreground\"\u003e\n    No projects\n  \u003c/div\u003e\n)}\n```\n\n### 3. Update TreeItem to handle undefined href\nThe TreeItem component needs to gracefully handle `href={undefined}`:\n```typescript\n// In TreeItem component\n{href ? (\n  \u003cLink href={href}\u003e{content}\u003c/Link\u003e\n) : (\n  \u003cdiv className=\"cursor-default\"\u003e{content}\u003c/div\u003e\n)}\n```\n\n### 4. Wire \"+\" button\n```typescript\nconst [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n\n// In the Projects header\n\u003cdiv className=\"flex items-center justify-between px-2 py-1\"\u003e\n  \u003cspan className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\"\u003e\n    Projects\n  \u003c/span\u003e\n  \u003cbutton \n    onClick={() =\u003e setFolderBrowserOpen(true)}\n    className=\"h-5 w-5 rounded hover:bg-secondary flex items-center justify-center\"\n    aria-label=\"Add project\"\n  \u003e\n    \u003cPlus className=\"h-3 w-3 text-muted-foreground\" /\u003e\n  \u003c/button\u003e\n\u003c/div\u003e\n\n// At end of sidebar component, inside the return\n\u003cFolderBrowserModal \n  open={folderBrowserOpen} \n  onOpenChange={setFolderBrowserOpen}\n/\u003e\n```\n\n### 5. Show missing projects with warning\nMissing projects are visible in sidebar with warning indicator so users know to fix them:\n```typescript\nstatusIndicator={isMissing ? \"warning\" : undefined}\n```\n\nThe existing TreeItem component already supports `statusIndicator=\"warning\"`.\n\n## Multiple Modal Instances\nThe sidebar renders its own FolderBrowserModal instance, separate from the page's modal. This is acceptable because:\n- Only one modal is open at a time (user can only click one button)\n- They share the same React Query cache\n- Updates reflect everywhere immediately via cache invalidation\n\nIf we wanted to ensure exactly one modal instance, we could lift state to a context provider. But for v1, separate instances work fine.\n\n## Epics and Sessions\nThe sidebar shows epics/sessions for the current project. These still use mock data (separate feature). This task only updates the **project list** portion of the sidebar.\n\n## Acceptance Criteria\n- [ ] Fetches projects from API using useProjects hook\n- [ ] Shows \"Loading...\" text while fetching\n- [ ] Shows \"No projects\" when empty\n- [ ] Renders projects with displayName\n- [ ] Missing projects show warning indicator\n- [ ] Missing projects are not clickable (no navigation)\n- [ ] TreeItem handles href={undefined} gracefully\n- [ ] \"+\" button opens folder browser modal\n- [ ] Can add project from sidebar\n- [ ] Project list updates after adding\n- [ ] Remove mockProjects import\n- [ ] Button has aria-label=\"Add project\" for accessibility\n\n## Files\n- `src/components/ui/sidebar.tsx` (update)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T08:17:01.971053-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Updated sidebar to use useProjects hook, added loading/empty states, wired + button to FolderBrowserModal, missing projects show warning indicator and are not clickable. Kept mockEpics/mockSoloSessions for epic/session features.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32","title":"Integrate AI Elements into Chat Interface","description":"## Overview\n\nIntegrate Vercel's AI Elements component library into Maestro's chat interface to provide a polished, modern AI chat experience with proper message rendering, markdown support, code blocks, and rich input controls.\n\n## Background\n\nAI Elements (https://ai-sdk.dev/elements) is a component library built on shadcn/ui that provides pre-built, customizable React components specifically designed for AI applications. Key features:\n- Professional message rendering with markdown support\n- Syntax-highlighted code blocks\n- Collapsible reasoning/thinking displays\n- Source citations\n- Rich prompt input with model selection and attachments\n- Copy/regenerate message actions\n\n## Current State\n\nThe Issue Discussion page (`src/app/project/[id]/issue/[issueNumber]/page.tsx`) has:\n- Custom chat implementation with manual SSE streaming\n- Basic message bubbles (user/assistant distinction)\n- Works with OpenCode SDK backend via custom API routes\n- Session management with auto-reconnection\n- ~773 lines of code mixing UI and logic\n\n## Integration Strategy\n\nSince AI Elements components are installed as source code (not library imports), we can adapt them to work with our existing OpenCode backend rather than requiring Vercel AI SDK's `useChat` hook.\n\n**Approach:**\n1. Install AI Elements components into the project\n2. Create adapter layer that bridges OpenCode SDK streaming to component props\n3. Progressively replace custom message rendering with AI Elements components\n4. Enhance input experience with PromptInput component\n5. Add markdown rendering and code block support to messages\n\n## Key Technical Considerations\n\n1. **Backend Compatibility**: Keep existing OpenCode SDK integration, adapt frontend only\n2. **Streaming Format**: Current SSE `data: {\"delta\": \"...\"}` format needs to feed into component state\n3. **Message Parts**: AI Elements uses `parts` array for messages (text, reasoning, sources), adapt our flat `content` string\n4. **Styling**: AI Elements uses Tailwind CSS 4 and CSS variables - verify compatibility\n\n## Dependencies\n\n- AI Elements CLI (`npx ai-elements@latest`)\n- shadcn/ui already installed in project\n- React 19 (already using)\n- Tailwind CSS 4 (already using)\n\n## Out of Scope\n\n- Changing the OpenCode backend integration\n- Adding new AI features (reasoning, sources) - just UI preparation\n- Modifying the session/chat API routes","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-30T12:18:06.495285-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:57.165223-06:00","close_reason":"Completed","dependencies":[{"issue_id":"maestro-slm.32","depends_on_id":"maestro-slm","type":"parent-child","created_at":"2025-12-30T12:18:06.495838-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:57.165223-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-slm.32.1","title":"Install AI Elements components via CLI","description":"## Task\n\nRun the AI Elements CLI to install all components into the project.\n\n## Why\n\nAI Elements components are installed as source code into `@/components/ai-elements/`. This is the foundation for all subsequent UI work. Components are fully customizable once installed.\n\n## Implementation\n\n```bash\nnpx ai-elements@latest\n```\n\nThis will:\n1. Detect existing shadcn/ui configuration\n2. Install all AI Elements components to `src/components/ai-elements/`\n3. Add any missing shadcn/ui dependencies\n\n## Components to Verify After Installation\n\nKey components we'll use:\n- `message.tsx` - Message container and content\n- `conversation.tsx` - Conversation wrapper\n- `prompt-input.tsx` - Rich input component\n- `code-block.tsx` - Syntax-highlighted code\n- `loader.tsx` - Loading states\n\nOptional components for future use:\n- `reasoning.tsx` - For AI thinking/reasoning display\n- `sources.tsx` - For citations\n- `message-actions.tsx` - Copy/regenerate buttons\n\n## Files Created\n\nAfter installation, verify these exist:\n- `src/components/ai-elements/message.tsx`\n- `src/components/ai-elements/conversation.tsx`\n- `src/components/ai-elements/prompt-input.tsx`\n- `src/components/ai-elements/code-block.tsx`\n- `src/components/ai-elements/loader.tsx`\n\n## Potential Issues\n\n1. **Tailwind CSS 4 compatibility** - AI Elements targets Tailwind 4, we're using it\n2. **React 19** - AI Elements uses React 19 (no forwardRef), we're on React 19\n3. **shadcn component conflicts** - May need to update existing components\n\n## Acceptance Criteria\n\n- [ ] AI Elements CLI runs successfully\n- [ ] Components installed to `src/components/ai-elements/`\n- [ ] No TypeScript errors in installed components\n- [ ] `bun run build` still succeeds","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T12:18:17.81655-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"AI Elements CLI installed successfully. 30 components added to src/components/ai-elements/. Added CardAction export to card.tsx. Build passes.","dependencies":[{"issue_id":"maestro-slm.32.1","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:18:17.819276-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.10","title":"Add dependencies between AI Elements integration tasks","description":"## Task\n\nSet up the dependency graph between the AI Elements integration tasks to ensure proper execution order.\n\n## Dependencies to Add\n\n1. **[deleted:[deleted:maestro-slm].32].1** (Install AI Elements) - No dependencies, can start immediately\n\n2. **[deleted:[deleted:maestro-slm].32].2** (Type adapter) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].1 (need components installed to understand types)\n\n3. **[deleted:[deleted:maestro-slm].32].3** (Replace message rendering) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].1 (need Message component)\n   - [deleted:[deleted:maestro-slm].32].2 (need type adapter)\n\n4. **[deleted:[deleted:maestro-slm].32].4** (Conversation wrapper) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].3 (need messages converted first)\n\n5. **[deleted:[deleted:maestro-slm].32].5** (Loader component) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].1 (need Loader component)\n\n6. **[deleted:[deleted:maestro-slm].32].6** (Markdown rendering) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].3 (need messages using AI Elements)\n\n7. **[deleted:[deleted:maestro-slm].32].7** (Message actions) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].3 (need Message component in use)\n\n8. **[deleted:[deleted:maestro-slm].32].8** (PromptInput) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].1 (need PromptInput component)\n\n9. **[deleted:[deleted:maestro-slm].32].9** (Extract hook) - No strict deps, can parallel\n\n## Commands\n\n```bash\n# Type adapter depends on install\nbd dep add [deleted:[deleted:maestro-slm].32].2 [deleted:[deleted:maestro-slm].32].1\n\n# Message rendering depends on install and adapter\nbd dep add [deleted:[deleted:maestro-slm].32].3 [deleted:[deleted:maestro-slm].32].1\nbd dep add [deleted:[deleted:maestro-slm].32].3 [deleted:[deleted:maestro-slm].32].2\n\n# Conversation depends on message rendering\nbd dep add [deleted:[deleted:maestro-slm].32].4 [deleted:[deleted:maestro-slm].32].3\n\n# Loader depends on install\nbd dep add [deleted:[deleted:maestro-slm].32].5 [deleted:[deleted:maestro-slm].32].1\n\n# Markdown depends on message rendering\nbd dep add [deleted:[deleted:maestro-slm].32].6 [deleted:[deleted:maestro-slm].32].3\n\n# Actions depends on message rendering\nbd dep add [deleted:[deleted:maestro-slm].32].7 [deleted:[deleted:maestro-slm].32].3\n\n# PromptInput depends on install\nbd dep add [deleted:[deleted:maestro-slm].32].8 [deleted:[deleted:maestro-slm].32].1\n```\n\n## Execution Order\n\nBased on dependencies, recommended order:\n1. Install AI Elements (.32.1) ← START HERE\n2. Type adapter (.32.2) + Loader (.32.5) + PromptInput (.32.8) + Hook (.32.9) - can parallel\n3. Message rendering (.32.3)\n4. Conversation (.32.4) + Markdown (.32.6) + Actions (.32.7) - can parallel","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2025-12-30T12:20:10.640538-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.137774-06:00","close_reason":"Dependencies configured between all AI Elements integration tasks","dependencies":[{"issue_id":"maestro-slm.32.10","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:20:10.643401-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"chore"}
{"id":"maestro-slm.32.2","title":"Create ChatMessage type adapter for AI Elements","description":"## Task\n\nCreate a type adapter that converts our current `ChatMessage` interface to the format AI Elements expects.\n\n## Why\n\nAI Elements components use a `parts` array structure for messages, while our current implementation uses a flat `content` string. We need an adapter layer to bridge this gap without changing our backend.\n\n## Current Message Type\n\n```typescript\ninterface ChatMessage {\n  id: string;\n  role: \"user\" | \"assistant\";\n  content: string;\n  timestamp: string;\n}\n```\n\n## AI Elements Message Type\n\nAI Elements expects messages with a `parts` array:\n```typescript\ninterface AIMessage {\n  id: string;\n  role: \"user\" | \"assistant\";\n  parts: MessagePart[];\n}\n\ntype MessagePart = \n  | { type: \"text\"; text: string }\n  | { type: \"reasoning\"; text: string }\n  | { type: \"source-url\"; url: string };\n```\n\n## Implementation\n\nCreate `src/lib/utils/message-adapter.ts`:\n\n```typescript\nimport type { ChatMessage } from \"@/app/project/[id]/issue/[issueNumber]/page\";\n\nexport interface AIElementsMessage {\n  id: string;\n  role: \"user\" | \"assistant\";\n  parts: Array\u003c{ type: \"text\"; text: string }\u003e;\n}\n\nexport function toAIElementsMessage(msg: ChatMessage): AIElementsMessage {\n  return {\n    id: msg.id,\n    role: msg.role,\n    parts: [{ type: \"text\", text: msg.content }],\n  };\n}\n\nexport function toAIElementsMessages(messages: ChatMessage[]): AIElementsMessage[] {\n  return messages.map(toAIElementsMessage);\n}\n```\n\n## Future Extension Points\n\nThe adapter is designed to be extended when we add:\n- Reasoning/thinking support (parse special markers in content)\n- Source citations (extract URLs from content)\n- Code blocks (parse markdown code fences)\n\n## Files to Create\n\n- `src/lib/utils/message-adapter.ts`\n\n## Acceptance Criteria\n\n- [ ] Type adapter created with proper TypeScript types\n- [ ] Converts flat content to parts array\n- [ ] Helper functions for single and batch conversion\n- [ ] Export types for use in components","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T12:18:35.216756-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Created message-adapter.ts with toAIElementsMessage and toAIElementsMessages functions. Type-safe conversion from ChatMessage to AI Elements parts format.","dependencies":[{"issue_id":"maestro-slm.32.2","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:18:35.217424-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.2","depends_on_id":"maestro-slm.32.1","type":"blocks","created_at":"2025-12-30T12:20:16.385917-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.3","title":"Replace message rendering with AI Elements Message component","description":"## Task\n\nReplace the custom message rendering in the Issue View page with AI Elements' Message component.\n\n## Why\n\nAI Elements provides professional message rendering with:\n- Proper avatar/role indicators\n- Better visual hierarchy\n- Extensible structure for future features (actions, reasoning)\n- Consistent styling with other AI apps\n\n## Current Implementation\n\n```tsx\n// In page.tsx lines ~648-672\nmessages.map((msg) =\u003e (\n  \u003cdiv\n    key={msg.id}\n    className={`flex ${msg.role === \"user\" ? \"justify-end\" : \"justify-start\"}`}\n  \u003e\n    \u003cdiv className={`max-w-[85%] ${msg.role === \"user\" ? \"order-1\" : \"\"}`}\u003e\n      \u003cdiv\n        className={`rounded-md px-3 py-2 text-sm ${\n          msg.role === \"user\"\n            ? \"bg-primary text-primary-foreground\"\n            : \"bg-secondary\"\n        }`}\n      \u003e\n        \u003cp className=\"whitespace-pre-wrap\"\u003e{msg.content}\u003c/p\u003e\n      \u003c/div\u003e\n      \u003cp className={`text-[10px] text-muted-foreground mt-1...`}\u003e\n        {msg.timestamp}\n      \u003c/p\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n))\n```\n\n## New Implementation\n\n```tsx\nimport {\n  Message,\n  MessageContent,\n  MessageResponse,\n} from \"@/components/ai-elements/message\";\nimport { toAIElementsMessages } from \"@/lib/utils/message-adapter\";\n\n// In render:\n{toAIElementsMessages(messages).map((message) =\u003e (\n  \u003cMessage key={message.id} from={message.role}\u003e\n    \u003cMessageContent\u003e\n      {message.parts.map((part, i) =\u003e {\n        if (part.type === \"text\") {\n          return \u003cMessageResponse key={i}\u003e{part.text}\u003c/MessageResponse\u003e;\n        }\n        return null;\n      })}\n    \u003c/MessageContent\u003e\n  \u003c/Message\u003e\n))}\n```\n\n## Styling Considerations\n\nAI Elements uses Tailwind classes that should match our existing theme:\n- May need to adjust colors/spacing in message.tsx\n- User messages should use primary color\n- Assistant messages should use secondary background\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Task: Install AI Elements components\n- Task: Create ChatMessage type adapter\n\n## Acceptance Criteria\n\n- [ ] Messages render using AI Elements components\n- [ ] User/assistant distinction maintained\n- [ ] Timestamps still displayed\n- [ ] Streaming still works (empty content shows loader)\n- [ ] Visual appearance is consistent or improved","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T12:18:45.210534-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Replaced message rendering with AI Elements Message/MessageContent/MessageResponse components. User messages styled with primary color override. Timestamps preserved.","dependencies":[{"issue_id":"maestro-slm.32.3","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:18:45.2141-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.3","depends_on_id":"maestro-slm.32.1","type":"blocks","created_at":"2025-12-30T12:20:16.420378-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.3","depends_on_id":"maestro-slm.32.2","type":"blocks","created_at":"2025-12-30T12:20:16.454153-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.4","title":"Add Conversation wrapper component to chat panel","description":"## Task\n\nWrap the messages area with AI Elements' Conversation component to get proper scrolling behavior and layout.\n\n## Why\n\nThe Conversation component provides:\n- Auto-scroll to bottom on new messages\n- Scroll-to-bottom button when scrolled up\n- Proper overflow handling\n- Consistent structure for chat UIs\n\n## Current Implementation\n\n```tsx\n// In page.tsx\n\u003cdiv className=\"flex-1 overflow-y-auto\"\u003e\n  \u003cdiv className=\"max-w-3xl mx-auto p-4 space-y-4\"\u003e\n    {/* messages */}\n    \u003cdiv ref={messagesEndRef} /\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\nWe have manual scroll-to-bottom via ref and useEffect.\n\n## New Implementation\n\n```tsx\nimport {\n  Conversation,\n  ConversationContent,\n  ConversationScrollButton,\n} from \"@/components/ai-elements/conversation\";\n\n// In render:\n\u003cConversation className=\"flex-1\"\u003e\n  \u003cConversationContent\u003e\n    {/* AI Elements Message components */}\n  \u003c/ConversationContent\u003e\n  \u003cConversationScrollButton /\u003e\n\u003c/Conversation\u003e\n```\n\n## Benefits\n\n1. **ConversationScrollButton** - Shows \"scroll to bottom\" button when user scrolls up\n2. **Auto-scroll** - Handles scroll-to-bottom automatically\n3. **Cleaner code** - Remove manual scrollToBottom useEffect and ref\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Task: Install AI Elements components\n- Task: Replace message rendering with AI Elements Message\n\n## Acceptance Criteria\n\n- [ ] Chat wrapped in Conversation component\n- [ ] Scroll-to-bottom button appears when scrolled up\n- [ ] Auto-scroll on new messages works\n- [ ] Can remove manual scrollToBottom logic\n- [ ] Messages area maintains proper height/overflow","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T12:18:56.143777-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Wrapped chat with Conversation/ConversationContent/ConversationScrollButton. Auto-scroll built-in, removed manual scroll logic.","dependencies":[{"issue_id":"maestro-slm.32.4","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:18:56.146158-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.4","depends_on_id":"maestro-slm.32.3","type":"blocks","created_at":"2025-12-30T12:20:16.487213-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.5","title":"Replace loader with AI Elements Loader component","description":"## Task\n\nReplace the custom typing indicator (bouncing dots) with AI Elements' Loader component.\n\n## Why\n\nConsistency with AI Elements design language and potentially better animations/states.\n\n## Current Implementation\n\n```tsx\n// In page.tsx lines ~675-685\n{isStreaming \u0026\u0026 messages[messages.length - 1]?.content === \"\" \u0026\u0026 (\n  \u003cdiv className=\"flex justify-start\"\u003e\n    \u003cdiv className=\"bg-secondary rounded-md px-3 py-2\"\u003e\n      \u003cdiv className=\"flex gap-1 items-center\"\u003e\n        \u003cspan className=\"w-2 h-2 bg-muted-foreground rounded-full animate-bounce\" style={{ animationDelay: \"0ms\" }} /\u003e\n        \u003cspan className=\"w-2 h-2 bg-muted-foreground rounded-full animate-bounce\" style={{ animationDelay: \"150ms\" }} /\u003e\n        \u003cspan className=\"w-2 h-2 bg-muted-foreground rounded-full animate-bounce\" style={{ animationDelay: \"300ms\" }} /\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n)}\n```\n\n## New Implementation\n\n```tsx\nimport { Loader } from \"@/components/ai-elements/loader\";\n\n// In render:\n{isStreaming \u0026\u0026 messages[messages.length - 1]?.content === \"\" \u0026\u0026 (\n  \u003cLoader /\u003e\n)}\n```\n\n## Considerations\n\n- Check if Loader component matches our visual style\n- May need to customize the loader in `src/components/ai-elements/loader.tsx`\n- Ensure it integrates well within the Conversation/Message structure\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Task: Install AI Elements components\n\n## Acceptance Criteria\n\n- [ ] Typing indicator uses AI Elements Loader\n- [ ] Shows at correct times (streaming with empty content)\n- [ ] Visually consistent with rest of chat","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T12:19:03.157102-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Replaced bouncing dots with AI Elements Loader component. Both typing indicator and initial loading use Loader with size=20.","dependencies":[{"issue_id":"maestro-slm.32.5","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:19:03.159442-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.5","depends_on_id":"maestro-slm.32.1","type":"blocks","created_at":"2025-12-30T12:20:16.520277-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.6","title":"Add markdown rendering to message responses","description":"## Task\n\nEnable markdown rendering in AI responses using either AI Elements' built-in markdown support or integrating with our existing react-markdown setup.\n\n## Why\n\nAI responses frequently contain:\n- Code snippets with syntax highlighting\n- Lists and bullet points\n- Headers for organization\n- Links to documentation\n- Tables\n\nCurrently we just render plain text with `whitespace-pre-wrap`, losing all formatting.\n\n## Options\n\n### Option A: Use AI Elements CodeBlock for code\nAI Elements has a `code-block` component for syntax-highlighted code. We can:\n1. Parse markdown in content to find code blocks\n2. Render regular text with MessageResponse\n3. Render code blocks with CodeBlock component\n\n### Option B: Use react-markdown (already installed)\nWe already have `react-markdown` and `remark-gfm` installed (used in issue body rendering). We can wrap the response content with ReactMarkdown:\n\n```tsx\nimport ReactMarkdown from \"react-markdown\";\nimport remarkGfm from \"remark-gfm\";\n\n\u003cMessageResponse\u003e\n  \u003cReactMarkdown remarkPlugins={[remarkGfm]}\u003e\n    {part.text}\n  \u003c/ReactMarkdown\u003e\n\u003c/MessageResponse\u003e\n```\n\n### Recommended: Option B with AI Elements code-block\n\nCombine both approaches:\n1. Use ReactMarkdown for general markdown\n2. Override the `code` component to use AI Elements CodeBlock\n\n```tsx\nimport { CodeBlock } from \"@/components/ai-elements/code-block\";\n\nconst markdownComponents = {\n  code: ({ inline, className, children }) =\u003e {\n    if (inline) {\n      return \u003ccode className=\"...\"\u003e{children}\u003c/code\u003e;\n    }\n    const language = className?.replace(\"language-\", \"\") || \"text\";\n    return \u003cCodeBlock language={language}\u003e{String(children)}\u003c/CodeBlock\u003e;\n  }\n};\n\n\u003cReactMarkdown \n  remarkPlugins={[remarkGfm]}\n  components={markdownComponents}\n\u003e\n  {part.text}\n\u003c/ReactMarkdown\u003e\n```\n\n## Styling\n\nReuse the prose classes from issue body rendering:\n```\nprose prose-sm dark:prose-invert max-w-none\n```\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n- Potentially create `src/components/chat/MarkdownMessage.tsx`\n\n## Dependencies\n\n- Task: Install AI Elements components\n- Task: Replace message rendering with AI Elements Message\n\n## Acceptance Criteria\n\n- [ ] Markdown in AI responses renders correctly\n- [ ] Code blocks have syntax highlighting\n- [ ] Lists, headers, links render properly\n- [ ] Inline code styled appropriately\n- [ ] Tables render (GFM support)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T12:19:18.142616-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Markdown already handled by Streamdown in MessageResponse. Added @source directive to globals.css for proper styling.","dependencies":[{"issue_id":"maestro-slm.32.6","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:19:18.145086-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.6","depends_on_id":"maestro-slm.32.3","type":"blocks","created_at":"2025-12-30T12:20:16.553232-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.7","title":"Add MessageActions with copy button","description":"## Task\n\nAdd copy and regenerate actions to assistant messages using AI Elements MessageActions component.\n\n## Why\n\nUsers frequently want to:\n- Copy AI responses (especially code snippets)\n- Regenerate a response if unsatisfied\n\nThese are standard features in modern AI chat interfaces (ChatGPT, Claude, etc.).\n\n## Implementation\n\n```tsx\nimport {\n  Message,\n  MessageContent,\n  MessageResponse,\n  MessageActions,\n  MessageAction,\n} from \"@/components/ai-elements/message\";\nimport { CopyIcon, RefreshCcwIcon } from \"lucide-react\";\n\n// In message rendering:\n\u003cMessage from={message.role}\u003e\n  \u003cMessageContent\u003e\n    \u003cMessageResponse\u003e{part.text}\u003c/MessageResponse\u003e\n  \u003c/MessageContent\u003e\n  {message.role === \"assistant\" \u0026\u0026 (\n    \u003cMessageActions\u003e\n      \u003cMessageAction\n        onClick={() =\u003e navigator.clipboard.writeText(part.text)}\n        label=\"Copy\"\n      \u003e\n        \u003cCopyIcon className=\"size-3\" /\u003e\n      \u003c/MessageAction\u003e\n      \u003cMessageAction\n        onClick={() =\u003e handleRegenerate(message.id)}\n        label=\"Retry\"\n      \u003e\n        \u003cRefreshCcwIcon className=\"size-3\" /\u003e\n      \u003c/MessageAction\u003e\n    \u003c/MessageActions\u003e\n  )}\n\u003c/Message\u003e\n```\n\n## Regenerate Functionality\n\nFor regenerate, we need to:\n1. Remove the last assistant message\n2. Resend the last user message\n3. This may require storing the user message that triggered each response\n\n**Note**: Regenerate can be deferred if complex. Copy is the priority.\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Task: Install AI Elements components\n- Task: Replace message rendering with AI Elements Message\n\n## Acceptance Criteria\n\n- [ ] Copy button appears on assistant messages\n- [ ] Clicking copy copies message content to clipboard\n- [ ] Visual feedback on copy (toast or icon change)\n- [ ] (Optional) Regenerate button triggers message resend","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T12:19:26.309911-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Added copy button to assistant messages with visual feedback (icon changes to checkmark for 2s).","dependencies":[{"issue_id":"maestro-slm.32.7","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:19:26.312923-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.7","depends_on_id":"maestro-slm.32.3","type":"blocks","created_at":"2025-12-30T12:20:16.587064-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.8","title":"Upgrade input to AI Elements PromptInput component","description":"## Task\n\nReplace the basic text input with AI Elements' PromptInput component for a richer input experience.\n\n## Why\n\nPromptInput provides:\n- Better visual design matching modern AI interfaces\n- Expandable textarea for longer prompts\n- Framework for future features (attachments, model selection)\n- Consistent styling with Message components\n\n## Current Implementation\n\n```tsx\n// In page.tsx lines ~721-745\n\u003cdiv className=\"border-t border-border bg-card px-4 py-3\"\u003e\n  \u003cdiv className=\"max-w-3xl mx-auto flex gap-2\"\u003e\n    \u003cinput\n      type=\"text\"\n      value={message}\n      onChange={(e) =\u003e setMessage(e.target.value)}\n      onKeyDown={(e) =\u003e e.key === \"Enter\" \u0026\u0026 !e.shiftKey \u0026\u0026 handleSend()}\n      placeholder=\"Ask the agent about this issue...\"\n      className=\"flex-1 h-9 px-3 rounded-md border border-border bg-background text-sm focus-ring disabled:opacity-50\"\n      disabled={isSending || isStreaming}\n    /\u003e\n    \u003cButton variant=\"outline\" onClick={() =\u003e setShowSaveModal(true)} ... /\u003e\n    \u003cButton onClick={handleSend} disabled={!message.trim() || isSending || isStreaming}\u003e\n      \u003cSend className=\"h-4 w-4\" /\u003e\n    \u003c/Button\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n## New Implementation\n\n```tsx\nimport {\n  PromptInput,\n  PromptInputBody,\n  PromptInputTextarea,\n  PromptInputFooter,\n  PromptInputSubmit,\n  PromptInputTools,\n  PromptInputButton,\n} from \"@/components/ai-elements/prompt-input\";\nimport { FileText } from \"lucide-react\";\n\nconst handleSubmit = (msg: PromptInputMessage) =\u003e {\n  if (!msg.text?.trim()) return;\n  handleSend(msg.text);\n};\n\n\u003cPromptInput onSubmit={handleSubmit} className=\"border-t bg-card\"\u003e\n  \u003cPromptInputBody\u003e\n    \u003cPromptInputTextarea\n      value={message}\n      onChange={(e) =\u003e setMessage(e.target.value)}\n      placeholder=\"Ask the agent about this issue...\"\n      disabled={isSending || isStreaming}\n    /\u003e\n  \u003c/PromptInputBody\u003e\n  \u003cPromptInputFooter\u003e\n    \u003cPromptInputTools\u003e\n      \u003cPromptInputButton\n        variant=\"ghost\"\n        onClick={() =\u003e setShowSaveModal(true)}\n        disabled={!sessionId || messages.length \u003c 2}\n      \u003e\n        \u003cFileText className=\"h-4 w-4\" /\u003e\n        \u003cspan className=\"hidden sm:inline\"\u003eSave\u003c/span\u003e\n      \u003c/PromptInputButton\u003e\n    \u003c/PromptInputTools\u003e\n    \u003cPromptInputSubmit \n      disabled={!message.trim()} \n      status={isStreaming ? \"streaming\" : isSending ? \"submitted\" : undefined}\n    /\u003e\n  \u003c/PromptInputFooter\u003e\n\u003c/PromptInput\u003e\n```\n\n## Considerations\n\n1. **Enter key behavior**: PromptInput may handle Enter differently, verify\n2. **Status mapping**: Map our isSending/isStreaming to PromptInput's status prop\n3. **Save button placement**: Keep the save summary button accessible\n4. **Max width**: Maintain max-w-3xl constraint for readability\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Task: Install AI Elements components\n\n## Acceptance Criteria\n\n- [ ] Input uses PromptInput component\n- [ ] Enter to send still works\n- [ ] Disabled states work correctly\n- [ ] Save summary button still accessible\n- [ ] Looks polished and consistent","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T12:19:42.856953-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Upgraded to PromptInput component. Auto-expanding textarea, status-aware submit button, and PromptInputButton for Save Summary.","dependencies":[{"issue_id":"maestro-slm.32.8","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:19:42.859172-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.8","depends_on_id":"maestro-slm.32.1","type":"blocks","created_at":"2025-12-30T12:20:16.620196-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.9","title":"Extract chat logic into custom useChatSession hook","description":"## Task\n\nExtract the chat-related state and logic from the Issue View page into a reusable custom hook.\n\n## Why\n\nThe page component is currently ~773 lines with mixed concerns:\n- Issue fetching and display\n- Session management\n- Message state and streaming\n- UI state (tabs, modals, resizing)\n\nExtracting chat logic will:\n1. Make the code more maintainable\n2. Enable reuse in Solo Sessions page\n3. Separate concerns for easier testing\n4. Prepare for potential AI SDK migration\n\n## Current State in page.tsx\n\n```typescript\n// State scattered throughout:\nconst [message, setMessage] = useState(\"\");\nconst [messages, setMessages] = useState\u003cChatMessage[]\u003e([]);\nconst [isSending, setIsSending] = useState(false);\nconst [isStreaming, setIsStreaming] = useState(false);\nconst [sessionId, setSessionId] = useState\u003cstring | null\u003e(null);\nconst [sessionError, setSessionError] = useState\u003cstring | null\u003e(null);\nconst [reconnecting, setReconnecting] = useState(false);\n\n// Functions:\nconst getOrCreateSession = async () =\u003e { ... }\nconst retrySession = async () =\u003e { ... }\nconst handleSend = async () =\u003e { ... }\n```\n\n## New Hook API\n\n```typescript\n// src/lib/hooks/useChatSession.ts\n\ninterface UseChatSessionOptions {\n  projectId: string;\n  issueNumber: string;\n}\n\ninterface UseChatSessionReturn {\n  // State\n  messages: ChatMessage[];\n  input: string;\n  setInput: (value: string) =\u003e void;\n  \n  // Status\n  isLoading: boolean;      // Initial session creation\n  isSending: boolean;      // Message being sent\n  isStreaming: boolean;    // Response streaming\n  isReconnecting: boolean; // Session recovery\n  error: string | null;\n  \n  // Session\n  sessionId: string | null;\n  \n  // Actions\n  sendMessage: () =\u003e Promise\u003cvoid\u003e;\n  retrySession: () =\u003e Promise\u003cvoid\u003e;\n  clearError: () =\u003e void;\n}\n\nexport function useChatSession(options: UseChatSessionOptions): UseChatSessionReturn {\n  // All the chat logic extracted here\n}\n```\n\n## Usage in Page\n\n```tsx\nexport default function IssueViewPage() {\n  const params = useParams();\n  const projectId = params.id as string;\n  const issueNumber = params.issueNumber as string;\n  \n  const chat = useChatSession({ projectId, issueNumber });\n  \n  // ... rest of component uses chat.messages, chat.sendMessage, etc.\n}\n```\n\n## Implementation Notes\n\n1. Move all session/message state into hook\n2. Move getOrCreateSession, handleSend logic\n3. Keep SSE streaming logic in hook\n4. Return clean interface for component\n\n## Files to Create/Modify\n\n- Create: `src/lib/hooks/useChatSession.ts`\n- Modify: `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- None (can be done in parallel with UI tasks)\n\n## Acceptance Criteria\n\n- [ ] Hook encapsulates all chat state and logic\n- [ ] Page component significantly simplified\n- [ ] All existing functionality preserved\n- [ ] Types exported for reuse\n- [ ] Hook is testable in isolation","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T12:19:56.296324-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Extracted chat logic to useChatSession hook. Page reduced from 773 to 565 lines (27% reduction). Hook provides clean API with onStreamChunk callback.","dependencies":[{"issue_id":"maestro-slm.32.9","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:19:56.29856-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.4","title":"1.4 Implement PATCH /api/projects/[id] endpoint","description":"## Purpose\nImplement the `PATCH /api/projects/[id]` endpoint for updating project name or relocating its path.\n\n## Use Cases\n1. **Rename**: User wants to change the display name\n2. **Revert to derived name**: User sets name to null\n3. **Relocate**: Project was moved on disk, user points Maestro to new location\n\n## Request Schema\n```typescript\ninterface UpdateProjectRequest {\n  name?: string | null;  // New display name, null to use derived\n  path?: string;         // New path (for relocation)\n}\n```\n\nAt least one field must be provided.\n\n## Response Schema\nReturns the updated project (same shape as GET response item).\n\n## Error Responses\n| Status | Condition | Response |\n|--------|-----------|----------|\n| 400 | No fields to update | `{ error: \"No fields to update\" }` |\n| 400 | Invalid path (if provided) | `{ error: \"Path is not a directory\" }` |\n| 403 | Path outside home (if provided) | `{ error: \"Path must be within home directory\" }` |\n| 404 | Project ID not found | `{ error: \"Project not found\" }` |\n| 404 | New path doesn't exist | `{ error: \"Path does not exist\" }` |\n| 409 | New path already tracked | `{ error: \"A project with this path already exists\" }` |\n\n## Implementation\n```typescript\n// src/app/api/projects/[id]/route.ts\nimport { NextResponse } from \"next/server\";\nimport { configService } from \"@/lib/services/config\";\nimport fs from \"fs/promises\";\n\nexport async function PATCH(\n  request: Request,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { id } = params;\n    const body = await request.json();\n    const { name, path: newPath } = body;\n    \n    // Check project exists\n    const project = await configService.getProject(id);\n    if (!project) {\n      return NextResponse.json(\n        { error: \"Project not found\" },\n        { status: 404 }\n      );\n    }\n    \n    // Build updates\n    const updates: Partial\u003cProjectConfig\u003e = {};\n    \n    // Handle name update\n    if (\"name\" in body) {\n      // Explicit null or empty string → null (use derived)\n      updates.name = name?.trim() || null;\n    }\n    \n    // Handle path update (relocation)\n    if (newPath) {\n      const absolutePath = configService.toAbsolutePath(newPath.trim());\n      \n      if (!configService.isWithinHome(absolutePath)) {\n        return NextResponse.json(\n          { error: \"Path must be within home directory\" },\n          { status: 403 }\n        );\n      }\n      \n      try {\n        await fs.access(absolutePath);\n      } catch {\n        return NextResponse.json(\n          { error: \"Path does not exist\" },\n          { status: 404 }\n        );\n      }\n      \n      const stat = await fs.stat(absolutePath);\n      if (!stat.isDirectory()) {\n        return NextResponse.json(\n          { error: \"Path is not a directory\" },\n          { status: 400 }\n        );\n      }\n      \n      // Check not duplicate (unless it's the same project)\n      const existing = await configService.getProjects();\n      const duplicate = existing.find(p =\u003e p.path === absolutePath \u0026\u0026 p.id !== id);\n      if (duplicate) {\n        return NextResponse.json(\n          { error: \"A project with this path already exists\" },\n          { status: 409 }\n        );\n      }\n      \n      updates.path = absolutePath;\n    }\n    \n    if (Object.keys(updates).length === 0) {\n      return NextResponse.json(\n        { error: \"No fields to update\" },\n        { status: 400 }\n      );\n    }\n    \n    const updated = await configService.updateProject(id, updates);\n    \n    return NextResponse.json({\n      id: updated.id,\n      path: updated.path,\n      displayPath: configService.toDisplayPath(updated.path),\n      name: updated.name,\n      displayName: updated.name ?? configService.deriveDisplayName(updated.path),\n      addedAt: updated.addedAt,\n      status: \"active\",\n    });\n    \n  } catch (error) {\n    console.error(\"Failed to update project:\", error);\n    return NextResponse.json(\n      { error: \"Failed to update project\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\n## Relocation Workflow\nWhen a project goes missing:\n1. User sees warning in UI\n2. User clicks \"Relocate\"\n3. Folder browser opens (ideally at parent of old path if it exists, else ~/dev)\n4. User selects new location\n5. PATCH request with new path\n6. Project is now tracked at new location with same ID\n\nThe ID stays constant, preserving any bookmarks or links to `/project/[id]`.\n\n## Acceptance Criteria\n- [ ] Can update name only\n- [ ] Can update path only\n- [ ] Can update both name and path\n- [ ] Setting name to null reverts to derived name\n- [ ] Path validation (exists, is directory, in home, not duplicate)\n- [ ] Returns 404 for unknown project ID\n- [ ] Returns 400 when no updates provided\n- [ ] ID and addedAt are preserved on update\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service)\n- **Requires**: Tasks 1.2 \u0026 1.3 (to have projects to update)\n\n## Files\n- `src/app/api/projects/[id]/route.ts` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:02.980937-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into consolidated Projects API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.5","title":"1.5 Implement DELETE /api/projects/[id] endpoint","description":"## Purpose\nImplement the `DELETE /api/projects/[id]` endpoint for removing projects from Maestro's tracking.\n\n## Important: Non-Destructive\nThis endpoint **only removes the project from Maestro's config**. It does NOT:\n- Delete any files on disk\n- Remove git history\n- Affect the project in any way\n\nThis is why no confirmation is required in the UI - it's trivially reversible by re-adding the project.\n\n## Response\n- **204 No Content**: Project successfully removed\n- **404 Not Found**: Project ID doesn't exist (still return 204 for idempotency? Design choice.)\n\nFor simplicity, return 204 even if project doesn't exist. This makes the operation idempotent - calling delete multiple times has the same effect as calling it once.\n\n## Implementation\n```typescript\n// src/app/api/projects/[id]/route.ts (add to existing file)\n\nexport async function DELETE(\n  request: Request,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { id } = params;\n    \n    await configService.deleteProject(id);\n    \n    return new NextResponse(null, { status: 204 });\n    \n  } catch (error) {\n    console.error(\"Failed to delete project:\", error);\n    return NextResponse.json(\n      { error: \"Failed to delete project\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\nThe `configService.deleteProject(id)` should be idempotent - if project doesn't exist, it simply does nothing.\n\n## Use Cases\n1. **User removes a project they no longer want to track**\n2. **User removes a missing project** (can't relocate, just wants it gone)\n3. **Cleanup after project was deleted from disk** (via terminal, not Maestro)\n\n## Acceptance Criteria\n- [ ] Returns 204 on successful deletion\n- [ ] Returns 204 even if project doesn't exist (idempotent)\n- [ ] Project is removed from config.json\n- [ ] No files are deleted from disk\n- [ ] Returns 500 on unexpected errors (disk full, permissions, etc.)\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service)\n- **Can parallel with**: Task 1.4 (PATCH endpoint)\n\n## Files\n- `src/app/api/projects/[id]/route.ts` (add DELETE handler)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.038099-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into consolidated Projects API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.6","title":"2.1 Implement GET /api/filesystem/browse endpoint","description":"## Purpose\nImplement the `GET /api/filesystem/browse` endpoint for the folder picker UI. This enables users to navigate the server's filesystem to select project directories.\n\n## Why Custom Browsing?\nMaestro runs on the dev machine but is accessed remotely (via Tailscale from phone/tablet). Browser file picker APIs (`\u003cinput type=\"file\"\u003e`) open on the **client** device, not the server. We need a custom API that exposes the server's filesystem in a controlled way.\n\n## Security Constraints\n**Critical**: This endpoint exposes the filesystem. Security measures:\n1. **Home directory only** - Cannot browse outside `~`\n2. **Directories only** - Don't list files (irrelevant for project selection)\n3. **Hidden directories filtered** - No `.git`, `.config`, `.ssh`, etc.\n4. **Permission errors handled gracefully** - Skip unreadable dirs, don't fail\n\n## Query Parameters\n| Param | Required | Default | Description |\n|-------|----------|---------|-------------|\n| `path` | No | `~/dev` or `~` | Directory to list |\n\nIf `path` is not provided:\n- Try `~/dev` first (common convention)\n- Fall back to `~` if `~/dev` doesn't exist\n\n## Response Schema\n```typescript\ninterface BrowseResponse {\n  currentPath: string;    // Absolute: /Users/erik/dev\n  displayPath: string;    // Friendly: ~/dev\n  parent: string | null;  // Parent path, null if at home\n  canGoUp: boolean;       // false if at home directory\n  directories: Directory[];\n}\n\ninterface Directory {\n  name: string;           // Directory name\n  path: string;           // Absolute path\n  isGitRepo: boolean;     // Has .git subdirectory\n}\n```\n\n## Implementation\n```typescript\n// src/app/api/filesystem/browse/route.ts\nimport { NextResponse } from \"next/server\";\nimport { configService } from \"@/lib/services/config\";\nimport fs from \"fs/promises\";\nimport path from \"path\";\n\n// Directories to hide from listing\nconst HIDDEN_PATTERNS = [\n  /^\\./, // Hidden files/dirs (., .git, .config, etc.)\n  /^node_modules$/,\n  /^__pycache__$/,\n  /^\\.cache$/,\n  /^vendor$/,\n  /^\\.venv$/,\n  /^venv$/,\n];\n\nfunction shouldHide(name: string): boolean {\n  return HIDDEN_PATTERNS.some(pattern =\u003e pattern.test(name));\n}\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const homeDir = configService.getHomeDir();\n    \n    // Determine path to browse\n    let browsePath = searchParams.get(\"path\");\n    \n    if (!browsePath) {\n      // Default: ~/dev if exists, else ~\n      const devPath = path.join(homeDir, \"dev\");\n      try {\n        await fs.access(devPath);\n        browsePath = devPath;\n      } catch {\n        browsePath = homeDir;\n      }\n    } else {\n      browsePath = configService.toAbsolutePath(browsePath);\n    }\n    \n    // Security: must be within home\n    if (!configService.isWithinHome(browsePath)) {\n      return NextResponse.json(\n        { error: \"Path must be within home directory\" },\n        { status: 403 }\n      );\n    }\n    \n    // Check path exists\n    try {\n      await fs.access(browsePath);\n    } catch {\n      return NextResponse.json(\n        { error: \"Path does not exist\" },\n        { status: 404 }\n      );\n    }\n    \n    // Check it's a directory\n    const stat = await fs.stat(browsePath);\n    if (!stat.isDirectory()) {\n      return NextResponse.json(\n        { error: \"Path is not a directory\" },\n        { status: 400 }\n      );\n    }\n    \n    // Read directory contents\n    const entries = await fs.readdir(browsePath, { withFileTypes: true });\n    \n    // Filter to visible directories only\n    const directories: Directory[] = [];\n    \n    for (const entry of entries) {\n      if (!entry.isDirectory()) continue;\n      if (shouldHide(entry.name)) continue;\n      \n      const entryPath = path.join(browsePath, entry.name);\n      \n      // Check if it's a git repo\n      let isGitRepo = false;\n      try {\n        await fs.access(path.join(entryPath, \".git\"));\n        isGitRepo = true;\n      } catch {\n        // Not a git repo, that's fine\n      }\n      \n      directories.push({\n        name: entry.name,\n        path: entryPath,\n        isGitRepo,\n      });\n    }\n    \n    // Sort alphabetically\n    directories.sort((a, b) =\u003e a.name.localeCompare(b.name));\n    \n    // Compute parent info\n    const parentPath = path.dirname(browsePath);\n    const isAtHome = browsePath === homeDir;\n    \n    return NextResponse.json({\n      currentPath: browsePath,\n      displayPath: configService.toDisplayPath(browsePath),\n      parent: isAtHome ? null : parentPath,\n      canGoUp: !isAtHome,\n      directories,\n    });\n    \n  } catch (error) {\n    console.error(\"Failed to browse filesystem:\", error);\n    return NextResponse.json(\n      { error: \"Failed to browse directory\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\n## Git Repo Detection\nWe check for `.git` subdirectory to identify git repos. This helps users visually distinguish project directories from regular folders in the picker.\n\nNote: We intentionally skip `.git` in the listing (hidden pattern) but check for its existence to set `isGitRepo`.\n\n## Performance Considerations\n- Most dev directories have \u003c 50 items after filtering - performance is fine\n- Git detection adds one `fs.access` per directory - negligible overhead\n- For directories with many items, consider pagination (future enhancement)\n\n## Edge Cases\n- **Permission denied on subdirectory**: Skip it, don't fail the whole request\n- **Symlink directory**: Follow it, check resolved path is within home\n- **Race condition (dir deleted while reading)**: Skip missing entries gracefully\n- **Very deep nesting**: No limit enforced, but UI should handle long paths\n\n## Acceptance Criteria\n- [ ] Returns directories at requested path\n- [ ] Defaults to ~/dev (or ~ if no ~/dev)\n- [ ] Hides hidden directories (starting with .)\n- [ ] Hides node_modules, __pycache__, etc.\n- [ ] Shows isGitRepo indicator for git repos\n- [ ] Provides parent path for navigation\n- [ ] Returns canGoUp: false at home directory\n- [ ] Returns 403 for paths outside home\n- [ ] Returns 404 for non-existent paths\n- [ ] Handles permission errors gracefully\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service for path utilities)\n- **Independent from**: Project CRUD endpoints\n\n## Files\n- `src/app/api/filesystem/browse/route.ts` (new)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:03.095579-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: now standalone Filesystem API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.7","title":"3.1 Create FolderBrowser component - directory list with navigation","description":"## Purpose\nCreate the core FolderBrowser component that displays a navigable list of directories from the server filesystem. This is the main content area of the folder browser modal.\n\n## Component Structure\n```\nFolderBrowser/\n├── FolderBrowser.tsx      # Main component, manages navigation state\n├── DirectoryList.tsx      # Renders list of directories\n└── (Breadcrumbs.tsx)      # Separate task\n```\n\n## FolderBrowser Props\n```typescript\ninterface FolderBrowserProps {\n  onSelect?: (path: string) =\u003e void;  // Called when user clicks \"Select\" \n  initialPath?: string;               // Starting path (default: ~/dev or ~)\n}\n```\n\n## State Management\n```typescript\nconst [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e(initialPath);\nconst { data, isLoading, error } = useFilesystem(currentPath);\n```\n\nThe component maintains the current path and uses the useFilesystem hook to fetch directory contents. Navigation is handled by updating the currentPath state.\n\n## DirectoryList Component\n```typescript\ninterface DirectoryListProps {\n  directories: Directory[];\n  onNavigate: (path: string) =\u003e void;\n  isLoading?: boolean;\n}\n\nfunction DirectoryList({ directories, onNavigate, isLoading }: DirectoryListProps) {\n  if (isLoading) {\n    return \u003cDirectoryListSkeleton /\u003e;\n  }\n  \n  if (directories.length === 0) {\n    return (\n      \u003cdiv className=\"text-center py-8 text-muted-foreground\"\u003e\n        No subdirectories found\n      \u003c/div\u003e\n    );\n  }\n  \n  return (\n    \u003cdiv className=\"divide-y divide-border\"\u003e\n      {directories.map((dir) =\u003e (\n        \u003cbutton\n          key={dir.path}\n          onClick={() =\u003e onNavigate(dir.path)}\n          className=\"w-full flex items-center gap-3 px-3 py-2.5 hover:bg-secondary/50 transition-colors text-left\"\n        \u003e\n          \u003cFolder className=\"h-4 w-4 text-muted-foreground\" /\u003e\n          \u003cspan className=\"flex-1 truncate\"\u003e{dir.name}\u003c/span\u003e\n          {dir.isGitRepo \u0026\u0026 (\n            \u003cspan className=\"text-xs text-muted-foreground bg-secondary px-1.5 py-0.5 rounded\"\u003e\n              git\n            \u003c/span\u003e\n          )}\n          \u003cChevronRight className=\"h-4 w-4 text-muted-foreground\" /\u003e\n        \u003c/button\u003e\n      ))}\n    \u003c/div\u003e\n  );\n}\n```\n\n## Navigation Flow\n1. User clicks a directory → `onNavigate(dir.path)` → updates `currentPath`\n2. useFilesystem refetches with new path\n3. UI updates to show new directory contents\n4. Breadcrumbs update (separate component, same currentPath state)\n\n## Mobile Considerations\n- **Touch targets**: Minimum 44px height for directory items\n- **Scroll area**: Directory list should scroll independently, not the whole modal\n- **Loading state**: Show skeleton while navigating to prevent layout shift\n\n## Error Handling\n```typescript\nif (error) {\n  return (\n    \u003cdiv className=\"p-4 text-center\"\u003e\n      \u003cp className=\"text-destructive mb-2\"\u003eFailed to load directory\u003c/p\u003e\n      \u003cp className=\"text-sm text-muted-foreground mb-4\"\u003e{error.message}\u003c/p\u003e\n      \u003cButton variant=\"outline\" onClick={() =\u003e refetch()}\u003e\n        Retry\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Git Repo Indicator\nDirectories with `isGitRepo: true` show a small \"git\" badge. This helps users identify project directories vs regular folders.\n\n## Accessibility\n- Directory items are buttons with proper focus states\n- Keyboard navigation works (Tab, Enter)\n- Screen reader announces directory names and git status\n\n## Acceptance Criteria\n- [ ] Displays directories from useFilesystem hook\n- [ ] Clicking a directory navigates into it\n- [ ] Shows git repo indicator for git directories\n- [ ] Shows loading skeleton while fetching\n- [ ] Shows empty state when no subdirectories\n- [ ] Shows error state with retry option\n- [ ] Touch-friendly (44px+ tap targets)\n- [ ] Scrollable directory list\n\n## Dependencies\n- **Requires**: Task 7.1 (useFilesystem hook)\n- **Requires**: Task 2.1 (filesystem API endpoint)\n\n## Files\n- `src/components/folder-browser/FolderBrowser.tsx` (new)\n- `src/components/folder-browser/DirectoryList.tsx` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.14827-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into FolderBrowserModal task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.8","title":"3.2 Create FolderBrowser breadcrumb navigation","description":"## Purpose\nCreate the breadcrumb navigation component for the folder browser. Shows the current path as clickable segments, allowing users to jump to any parent directory.\n\n## Visual Design\n```\n┌─────────────────────────────────────────┐\n│  ~ / dev / projects / my-app        [↑] │\n└─────────────────────────────────────────┘\n```\n\n- Each segment is clickable\n- Current directory (last segment) is not clickable, just highlighted\n- \"Up\" button navigates to parent (same as clicking second-to-last segment)\n- On mobile, breadcrumbs scroll horizontally\n\n## Props\n```typescript\ninterface BreadcrumbsProps {\n  displayPath: string;       // e.g., \"~/dev/projects/my-app\"\n  onNavigate: (path: string) =\u003e void;\n  parent: string | null;     // Absolute path of parent, null if at home\n  canGoUp: boolean;\n}\n```\n\n## Implementation\n```typescript\n// src/components/folder-browser/Breadcrumbs.tsx\nimport { ChevronUp, Home } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nexport function Breadcrumbs({ displayPath, onNavigate, parent, canGoUp }: BreadcrumbsProps) {\n  // Parse displayPath into segments\n  // \"~/dev/projects\" → [\"~\", \"dev\", \"projects\"]\n  const segments = displayPath.split(\"/\").filter(Boolean);\n  \n  // Build absolute paths for each segment\n  // We need to map display paths back to absolute paths for navigation\n  // This requires knowing the home directory or receiving absolute paths\n  // For simplicity, receive absolutePath as well or compute from displayPath\n  \n  return (\n    \u003cdiv className=\"flex items-center gap-1 px-3 py-2 border-b border-border overflow-x-auto\"\u003e\n      {/* Scrollable breadcrumb container */}\n      \u003cdiv className=\"flex items-center gap-1 min-w-0 flex-1\"\u003e\n        {segments.map((segment, index) =\u003e {\n          const isLast = index === segments.length - 1;\n          const isHome = segment === \"~\";\n          \n          // Compute path for this segment\n          // \"~/dev/projects\" at index 1 (\"dev\") → \"~/dev\" → need absolute\n          // This is tricky - see implementation note below\n          \n          return (\n            \u003cdiv key={index} className=\"flex items-center\"\u003e\n              {index \u003e 0 \u0026\u0026 (\n                \u003cspan className=\"text-muted-foreground mx-1\"\u003e/\u003c/span\u003e\n              )}\n              {isLast ? (\n                \u003cspan className=\"font-medium truncate\"\u003e{segment}\u003c/span\u003e\n              ) : (\n                \u003cbutton\n                  onClick={() =\u003e onNavigate(pathForSegment)}\n                  className=\"text-muted-foreground hover:text-foreground transition-colors truncate\"\n                \u003e\n                  {isHome ? \u003cHome className=\"h-3.5 w-3.5\" /\u003e : segment}\n                \u003c/button\u003e\n              )}\n            \u003c/div\u003e\n          );\n        })}\n      \u003c/div\u003e\n      \n      {/* Up button */}\n      \u003cbutton\n        onClick={() =\u003e parent \u0026\u0026 onNavigate(parent)}\n        disabled={!canGoUp}\n        className={cn(\n          \"h-8 w-8 flex items-center justify-center rounded-md transition-colors\",\n          canGoUp \n            ? \"hover:bg-secondary text-muted-foreground hover:text-foreground\" \n            : \"text-muted-foreground/30 cursor-not-allowed\"\n        )}\n        aria-label=\"Go to parent directory\"\n      \u003e\n        \u003cChevronUp className=\"h-4 w-4\" /\u003e\n      \u003c/button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Path Mapping Challenge\nThe displayPath is `~/dev/projects` but we need absolute paths for navigation. Solutions:\n\n1. **Pass absolutePath as prop** (recommended)\n   - FolderBrowser has both from useFilesystem response\n   - Breadcrumbs receives both and uses absolute for onClick\n\n2. **Reconstruct from segments**\n   - Replace `~` with home directory\n   - Join segments with `/`\n   - More brittle, assumes path format\n\nGoing with option 1:\n```typescript\ninterface BreadcrumbsProps {\n  currentPath: string;       // Absolute: /Users/erik/dev/projects\n  displayPath: string;       // Display: ~/dev/projects\n  onNavigate: (path: string) =\u003e void;\n  parent: string | null;\n  canGoUp: boolean;\n}\n```\n\nThen compute segment paths by walking back from currentPath.\n\n## Mobile Behavior\n- Container has `overflow-x-auto` for horizontal scroll\n- No explicit scroll indicators (browser native)\n- Current directory (last segment) should be visible - consider `scrollIntoView` on mount\n- Minimum touch target height maintained\n\n## Accessibility\n- Each segment is a button with proper focus state\n- Up button has aria-label\n- Disabled state properly announced\n\n## Acceptance Criteria\n- [ ] Shows path segments from displayPath\n- [ ] Clicking segment navigates to that directory\n- [ ] Last segment (current dir) is not clickable\n- [ ] Up button navigates to parent\n- [ ] Up button disabled at home directory\n- [ ] Horizontally scrollable on narrow screens\n- [ ] Home icon for ~ segment (optional, can be text)\n\n## Dependencies\n- **Used by**: Task 3.1 (FolderBrowser component)\n- **Requires**: Task 7.1 (useFilesystem hook data)\n\n## Files\n- `src/components/folder-browser/Breadcrumbs.tsx` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.198729-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into FolderBrowserModal task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.9","title":"3.3 Create FolderBrowserModal with add project form","description":"## Purpose\nCreate the modal wrapper that contains the folder browser and the \"Add Project\" form. This is the complete UI for adding a new project to Maestro.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────┐\n│  Select Project Folder                      [X] │  ← Header with close button\n├─────────────────────────────────────────────────┤\n│  ~ / dev / my-project                       [↑] │  ← Breadcrumbs\n├─────────────────────────────────────────────────┤\n│  ┌─────────────────────────────────────────┐   │\n│  │ [Paste path here...                   ] │   │  ← Path input (power user)\n│  └─────────────────────────────────────────┘   │\n├─────────────────────────────────────────────────┤\n│  📁 api-gateway              git                │  ← Directory list\n│  📁 frontend                 git                │\n│  📁 scripts                                     │\n│                                                 │\n│              (scrollable area)                  │\n├─────────────────────────────────────────────────┤\n│  Name: [my-project              ] (optional)    │  ← Custom name input\n├─────────────────────────────────────────────────┤\n│                    [Cancel]  [Add Project]      │  ← Actions\n└─────────────────────────────────────────────────┘\n```\n\n## Props\n```typescript\ninterface FolderBrowserModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n  initialPath?: string;      // For \"Relocate\" flow, start at specific path\n  onSuccess?: () =\u003e void;    // Called after successful add\n}\n```\n\n## State\n```typescript\nconst [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e(initialPath);\nconst [selectedPath, setSelectedPath] = useState\u003cstring | null\u003e(null);\nconst [customName, setCustomName] = useState(\"\");\nconst [pathInput, setPathInput] = useState(\"\");\nconst [error, setError] = useState\u003cstring | null\u003e(null);\n\nconst { data: filesystem } = useFilesystem(currentPath);\nconst addProject = useAddProject();\n```\n\n## Interaction Flow\n\n### Navigating Directories\n1. User clicks directory in list\n2. `setCurrentPath(dir.path)` - navigates into directory\n3. useFilesystem refetches\n4. Breadcrumbs update\n\n### Selecting Current Directory\nThe current directory (shown in breadcrumbs) is implicitly selected. User can:\n1. Navigate to the project folder\n2. Optionally enter a custom name\n3. Click \"Add Project\"\n\n### Path Input (Power User Feature)\n- User can paste an absolute path directly\n- On Enter or blur, navigate to that path\n- Validates path via API (will show error if invalid)\n- Optional feature - can be omitted for v1\n\n### Custom Name\n- Text input pre-populated with current directory name\n- Empty → use derived name (no custom name stored)\n- User can edit to set custom display name\n\n## Implementation\n```typescript\n// src/components/folder-browser/FolderBrowserModal.tsx\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { FolderBrowser } from \"./FolderBrowser\";\nimport { Breadcrumbs } from \"./Breadcrumbs\";\nimport { useAddProject } from \"@/lib/hooks/useProjects\";\nimport { useFilesystem } from \"@/lib/hooks/useFilesystem\";\n\nexport function FolderBrowserModal({ open, onOpenChange, initialPath, onSuccess }: FolderBrowserModalProps) {\n  const [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e(initialPath);\n  const [customName, setCustomName] = useState(\"\");\n  const [error, setError] = useState\u003cstring | null\u003e(null);\n  \n  const { data: filesystem, isLoading, error: browseError } = useFilesystem(currentPath);\n  const addProject = useAddProject();\n  \n  // Update custom name placeholder when path changes\n  useEffect(() =\u003e {\n    if (filesystem?.currentPath) {\n      const dirName = filesystem.currentPath.split(\"/\").pop() || \"\";\n      setCustomName(dirName);\n    }\n  }, [filesystem?.currentPath]);\n  \n  const handleAddProject = async () =\u003e {\n    if (!filesystem?.currentPath) return;\n    \n    setError(null);\n    try {\n      await addProject.mutateAsync({\n        path: filesystem.currentPath,\n        name: customName.trim() || undefined,\n      });\n      onOpenChange(false);\n      onSuccess?.();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Failed to add project\");\n    }\n  };\n  \n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent className=\"max-w-lg max-h-[80vh] flex flex-col p-0\"\u003e\n        \u003cDialogHeader className=\"px-4 py-3 border-b\"\u003e\n          \u003cDialogTitle\u003eSelect Project Folder\u003c/DialogTitle\u003e\n        \u003c/DialogHeader\u003e\n        \n        {/* Breadcrumbs */}\n        {filesystem \u0026\u0026 (\n          \u003cBreadcrumbs\n            currentPath={filesystem.currentPath}\n            displayPath={filesystem.displayPath}\n            onNavigate={setCurrentPath}\n            parent={filesystem.parent}\n            canGoUp={filesystem.canGoUp}\n          /\u003e\n        )}\n        \n        {/* Directory List */}\n        \u003cdiv className=\"flex-1 overflow-y-auto min-h-[200px]\"\u003e\n          \u003cFolderBrowser\n            currentPath={currentPath}\n            onNavigate={setCurrentPath}\n          /\u003e\n        \u003c/div\u003e\n        \n        {/* Custom Name Input */}\n        \u003cdiv className=\"px-4 py-3 border-t\"\u003e\n          \u003clabel className=\"text-sm text-muted-foreground mb-1.5 block\"\u003e\n            Display name (optional)\n          \u003c/label\u003e\n          \u003cInput\n            value={customName}\n            onChange={(e) =\u003e setCustomName(e.target.value)}\n            placeholder=\"Use folder name\"\n          /\u003e\n        \u003c/div\u003e\n        \n        {/* Error */}\n        {error \u0026\u0026 (\n          \u003cdiv className=\"px-4 py-2 text-sm text-destructive\"\u003e\n            {error}\n          \u003c/div\u003e\n        )}\n        \n        {/* Actions */}\n        \u003cdiv className=\"flex justify-end gap-2 px-4 py-3 border-t\"\u003e\n          \u003cButton variant=\"outline\" onClick={() =\u003e onOpenChange(false)}\u003e\n            Cancel\n          \u003c/Button\u003e\n          \u003cButton \n            onClick={handleAddProject}\n            disabled={!filesystem?.currentPath || addProject.isPending}\n          \u003e\n            {addProject.isPending ? \"Adding...\" : \"Add Project\"}\n          \u003c/Button\u003e\n        \u003c/div\u003e\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  );\n}\n```\n\n## Mobile Behavior\n- Full screen modal on small screens (`sm:max-w-lg`)\n- Directory list takes available space, scrolls\n- Actions sticky at bottom\n- Touch-friendly inputs and buttons\n\n## Error Handling\n- Browse errors: Show in directory list area with retry\n- Add project errors: Show inline below name input\n- Clear error when navigating or retrying\n\n## Acceptance Criteria\n- [ ] Opens as modal dialog\n- [ ] Shows breadcrumbs with navigation\n- [ ] Shows directory list with navigation\n- [ ] Custom name input with folder name as placeholder\n- [ ] \"Add Project\" calls API with current path and name\n- [ ] Shows loading state during add\n- [ ] Shows error messages inline\n- [ ] Closes on success\n- [ ] Calls onSuccess callback on success\n- [ ] Cancel closes without action\n- [ ] Mobile-friendly layout\n\n## Dependencies\n- **Requires**: Task 3.1 (FolderBrowser component)\n- **Requires**: Task 3.2 (Breadcrumbs component)\n- **Requires**: Task 7.1 (useAddProject hook)\n- **Requires**: shadcn Dialog component (may need to add)\n\n## Files\n- `src/components/folder-browser/FolderBrowserModal.tsx` (new)\n- May need: `src/components/ui/dialog.tsx` (shadcn component)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.250446-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into FolderBrowserModal task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-wsz","title":"Mark As Complete Feature (Issue #12)","description":"## Overview\n\nAllow users to mark items (inbox items or bookmarks) as \"completed/finished/read\". This indicates the user has consumed the content. Completed items should be filtered out of the Inbox view and Home page lists, but should still appear in the Library for reference.\n\n## Business Context \u0026 Rationale\n\nThe \"Mark as Complete\" feature addresses a fundamental gap in Zine's content lifecycle model. Currently, users can:\n- **INBOX**: Triage new content (bookmark or archive)\n- **BOOKMARKED**: Save content for later consumption\n- **ARCHIVED**: Dismiss content they don't want\n\nWhat's missing is a way to indicate \"I've consumed this content\" without losing access to it. This is distinct from:\n- **Archived** = \"I don't want this\" (dismissal, hidden everywhere)\n- **Completed** = \"I've finished this\" (consumed, still accessible in Library)\n\nThis feature serves the \"intentional saving\" and \"long-term reference and rediscovery\" goals from Zine's architecture doc.\n\n## Technical Context\n\n**Database**: The `is_finished` and `finished_at` columns already exist in the `user_items` table (migration `0005_add_is_finished.sql`). No schema changes needed.\n\n**Backend**: The `toggleFinished` tRPC mutation is fully implemented in `apps/worker/src/trpc/routers/items.ts:488-526`. It correctly:\n- Finds the user item\n- Toggles `isFinished` boolean\n- Sets/clears `finishedAt` timestamp\n- Returns `{ success, isFinished, finishedAt }`\n\n**Frontend Hook**: The `useToggleFinished()` hook exists in `apps/mobile/hooks/use-items-trpc.ts:455-479` with full optimistic update support for inbox, library, and single item caches.\n\n**UI Gap**: The item detail page (`apps/mobile/app/item/[id].tsx:211-214`) has a placeholder handler that logs \"not yet implemented\".\n\n## Key Design Decisions\n\n1. **isFinished is orthogonal to state**: An item can be INBOX + finished, BOOKMARKED + finished, or even ARCHIVED + finished. The flags are independent.\n\n2. **Filtering strategy**: Finished items should be EXCLUDED from Inbox and Home sections (triage-focused views) but INCLUDED in Library (reference-focused view).\n\n3. **Visual feedback**: Users need clear indication of completion state via icon toggle (filled/outline) and visual treatment on cards.\n\n4. **UX principle**: Marking complete should feel instant (optimistic updates already support this) with haptic feedback for tactile confirmation.\n\n## Files Overview\n\n### Must Modify\n- `apps/mobile/app/item/[id].tsx` - Wire up toggle handler\n- `apps/worker/src/trpc/routers/items.ts` - Add isFinished filter to inbox query\n- `apps/mobile/components/item-card.tsx` - Add completion visual indicator\n- `packages/shared/src/types/domain.ts` - Add isFinished/finishedAt to UserItem interface\n\n### May Need to Review\n- `apps/mobile/app/(tabs)/index.tsx` - Home page (may need filtering or visual update)\n- `apps/mobile/hooks/use-items-trpc.ts` - Verify optimistic updates handle filtering correctly\n\n## Acceptance Criteria\n- [ ] Tapping check icon on item detail page toggles completion state\n- [ ] Check icon switches between filled (finished) and outline (not finished)\n- [ ] Haptic feedback on toggle\n- [ ] Completed items are hidden from Inbox tab\n- [ ] Completed items are hidden from Home page lists\n- [ ] Completed items still appear in Library view\n- [ ] Visual feedback shows completion status on item cards","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2026-01-01T06:14:12.085846-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-wsz.1","title":"Update UserItem type definition with isFinished fields","description":"## Task: Update UserItem Type Definition\n\n### What\nAdd `isFinished` and `finishedAt` fields to the `UserItem` interface in the shared types package.\n\n### Why\nThe UserItem interface is the canonical TypeScript representation of user-item relationships. While the database schema already has these fields (added in migration 0005), the TypeScript type definition is missing them. This causes:\n1. Type errors when accessing `isFinished` on UserItem objects\n2. Missing IDE autocomplete for these fields\n3. Potential runtime bugs from assuming fields exist\n\n### Context\nLooking at `packages/shared/src/types/domain.ts:126-162`, the UserItem interface currently has:\n- `id`, `userId`, `itemId`, `state`\n- `ingestedAt`, `bookmarkedAt`, `archivedAt`\n- `progressPosition`, `progressDuration`, `progressUpdatedAt`\n- `createdAt`, `updatedAt`\n\nMissing fields that exist in DB schema (`apps/worker/src/db/schema.ts`):\n- `isFinished: boolean` - Whether user has consumed the content\n- `finishedAt?: string` - ISO8601 timestamp when marked finished\n\n### Implementation Details\nAdd after line 155 (after progressUpdatedAt):\n```typescript\n/** Whether the user has consumed this content */\nisFinished: boolean;\n\n/** When the item was marked as finished (ISO8601, null if not finished) */\nfinishedAt?: string;\n```\n\n### Dependencies\n- None (foundational type change)\n\n### Blocked By\n- Nothing\n\n### Blocks\n- All other tasks depend on correct types\n\n### Testing\n- TypeScript compilation should pass\n- No runtime changes needed (types only)\n\n### Acceptance Criteria\n- [ ] `isFinished: boolean` field added to UserItem interface\n- [ ] `finishedAt?: string` field added to UserItem interface\n- [ ] JSDoc comments explain the fields' purpose\n- [ ] Package builds successfully with `bun run build`","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-01T06:14:12.142714-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-wsz.2","title":"Wire up toggleFinished mutation in item detail page","description":"## Task: Wire Up toggleFinished Mutation in Item Detail Page\n\n### What\nConnect the check icon button on the item detail page to the `useToggleFinished()` mutation, replacing the current placeholder implementation.\n\n### Why\nThe item detail page (`apps/mobile/app/item/[id].tsx`) has a check icon in the action row (line 377-386) that currently logs \"not yet implemented\" (line 212-214). This is the primary UI for marking content as complete.\n\n### Context\n**Current State (lines 211-214):**\n```typescript\nconst handleToggleFinished = () =\u003e {\n  logger.debug('Toggle finished - not yet implemented');\n};\n```\n\n**Available Hook:** `useToggleFinished()` from `@/hooks/use-items-trpc` (line 455-479) is already implemented with:\n- Full optimistic updates for inbox, library, and single item caches\n- Proper rollback on error\n- Cache invalidation on completion\n\n**Icon Components:** Both `CheckIcon` (filled) and `CheckOutlineIcon` (outline) exist in `@/components/icons` (line 18 in icons/index.tsx).\n\n### Implementation Details\n\n1. **Import the hook and filled icon:**\n```typescript\nimport { useItem, useBookmarkItem, useUnbookmarkItem, useToggleFinished } from '@/hooks/use-items-trpc';\nimport { CheckIcon, CheckOutlineIcon, ... } from '@/components/icons';\n```\n\n2. **Initialize the mutation (after line 160):**\n```typescript\nconst toggleFinishedMutation = useToggleFinished();\n```\n\n3. **Replace handleToggleFinished (lines 211-214):**\n```typescript\nconst handleToggleFinished = () =\u003e {\n  if (!item) return;\n  \n  // Haptic feedback\n  Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);\n  \n  toggleFinishedMutation.mutate({ id: item.id });\n};\n```\n\n4. **Update the check icon button (lines 377-386):**\n```typescript\n\u003cPressable\n  onPress={handleToggleFinished}\n  disabled={toggleFinishedMutation.isPending}\n  style={({ pressed }) =\u003e [\n    styles.actionButton,\n    { backgroundColor: item.isFinished ? colors.primary : colors.backgroundSecondary },\n    pressed \u0026\u0026 { opacity: 0.7 },\n    toggleFinishedMutation.isPending \u0026\u0026 { opacity: 0.5 },\n  ]}\n\u003e\n  {item.isFinished ? (\n    \u003cCheckIcon size={24} color=\"#fff\" /\u003e\n  ) : (\n    \u003cCheckOutlineIcon size={24} color={colors.textSecondary} /\u003e\n  )}\n\u003c/Pressable\u003e\n```\n\n5. **Add Haptics import:**\n```typescript\nimport * as Haptics from 'expo-haptics';\n```\n\n### Dependencies\n- Task 1 (types) should be done first for proper typing\n\n### Testing\n- Tap check icon → should toggle isFinished state\n- Icon should switch between filled (finished) and outline (not finished)\n- Background color should change (primary when finished)\n- Haptic feedback should trigger on tap\n- Button should show pending state during mutation\n\n### Acceptance Criteria\n- [ ] Check icon connected to useToggleFinished mutation\n- [ ] Icon toggles between filled/outline based on isFinished\n- [ ] Button background changes when finished (primary color)\n- [ ] Haptic feedback on toggle\n- [ ] Pending state disables button with reduced opacity\n- [ ] State persists after navigation away and back","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-01T06:14:12.203269-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-wsz.3","title":"Filter completed items from inbox query","description":"## Task: Filter Completed Items from Inbox Query\n\n### What\nModify the `inbox` tRPC query to exclude items where `isFinished = true`.\n\n### Why\nThe inbox is a triage queue for NEW content. Completed items have already been consumed and shouldn't clutter the triage view. Users want to see what they need to decide on, not what they've already finished.\n\n### Context\n**File:** `apps/worker/src/trpc/routers/items.ts`\n\n**Current inbox query (lines 136-191):**\n- Filters by `userId` and `state = INBOX`\n- Supports cursor pagination and provider/contentType filters\n- Does NOT currently filter by `isFinished`\n\n**Key insight:** The `isFinished` flag is orthogonal to `state`. An item can be:\n- INBOX + isFinished (user marked it complete from inbox view before bookmarking)\n- BOOKMARKED + isFinished (normal \"I saved and consumed this\")\n- ARCHIVED + isFinished (edge case, but possible)\n\nFor inbox, we want: `state = INBOX AND isFinished = false`\n\n### Implementation Details\n\n**Location:** Line 141, in the WHERE conditions array\n\n**Current:**\n```typescript\nconst conditions = [eq(userItems.userId, ctx.userId), eq(userItems.state, UserItemState.INBOX)];\n```\n\n**Updated:**\n```typescript\nconst conditions = [\n  eq(userItems.userId, ctx.userId), \n  eq(userItems.state, UserItemState.INBOX),\n  eq(userItems.isFinished, false),  // Exclude completed items\n];\n```\n\n### Edge Cases to Consider\n1. **Marking complete from item detail while viewing inbox item:** The optimistic update should immediately remove it from the inbox list (already handled by the hook's `updateInbox` function).\n\n2. **Pagination with isFinished filter:** The cursor-based pagination should work correctly since we're adding a filter, not changing sort order.\n\n3. **Un-marking complete:** If a user un-marks an item as complete, it should reappear in inbox (if state is still INBOX). The query will naturally include it.\n\n### Dependencies\n- None (backend-only change)\n\n### Blocked By\n- Nothing\n\n### Blocks\n- Task 6 (optimistic update verification)\n\n### Testing\n- Create test items in INBOX state\n- Mark one as finished via direct DB update\n- Verify inbox query excludes the finished item\n- Verify un-finished items still appear\n\n### Acceptance Criteria\n- [ ] Inbox query includes `eq(userItems.isFinished, false)` condition\n- [ ] Items with isFinished=true don't appear in inbox response\n- [ ] Pagination still works correctly\n- [ ] Performance not degraded (isFinished column should be indexed)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T06:14:12.260059-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-wsz.4","title":"Filter completed items from home page sections","description":"## Task: Filter Completed Items from Home Page Sections\n\n### What\nModify the `home` tRPC query to exclude completed items from all sections.\n\n### Why\nThe home page shows curated content sections designed to help users discover and consume content. Showing completed items defeats this purpose:\n- \"Jump Back In\" = continue content in progress (if finished, nothing to continue)\n- \"Recent Bookmarks\" = recently saved content to consume (if finished, already consumed)\n- Content type sections = content available to consume (if finished, already done)\n\n### Context\n**File:** `apps/worker/src/trpc/routers/items.ts`\n\n**Current home query (lines 262-345):**\n```typescript\nconst baseConditions = [\n  eq(userItems.userId, ctx.userId),\n  eq(userItems.state, UserItemState.BOOKMARKED),\n];\n```\n\nThis is used as the base for all section queries:\n- recentBookmarksQuery (line 272)\n- jumpBackInQuery (line 281)\n- videosQuery (line 296)\n- podcastsQuery (line 305)\n- articlesQuery (line 314)\n\n### Implementation Details\n\n**Add isFinished filter to baseConditions (around line 266):**\n```typescript\nconst baseConditions = [\n  eq(userItems.userId, ctx.userId),\n  eq(userItems.state, UserItemState.BOOKMARKED),\n  eq(userItems.isFinished, false),  // Exclude completed items from home\n];\n```\n\n**Special consideration for \"Jump Back In\":**\nThe jumpBackInQuery already has additional filters:\n```typescript\nisNotNull(userItems.progressPosition)\n```\n\nAnd post-filters:\n```typescript\nconst jumpBackInFiltered = jumpBackIn.filter(\n  (row) =\u003e row.user_items.progressPosition !== null \u0026\u0026 row.user_items.progressPosition \u003e 0\n);\n```\n\nWith `isFinished = false` in baseConditions, this naturally excludes finished items. Items that are \"in progress\" shouldn't be marked finished (though technically possible).\n\n### Design Decision\n**Why filter at query level vs. frontend?**\n1. Reduces data transfer (don't fetch items we'll hide)\n2. Consistent behavior (same data structure, just fewer items)\n3. Pagination-friendly (if we add pagination to home sections later)\n\n**Alternative considered:** Add `isFinished` to response and filter in frontend. Rejected because it wastes bandwidth and creates potential inconsistencies.\n\n### Dependencies\n- None (backend-only change)\n\n### Blocked By\n- Nothing\n\n### Blocks\n- Task 6 (optimistic update verification)\n\n### Testing\n- Bookmark several items\n- Mark some as finished\n- Verify home query sections exclude finished items\n- Verify finished items still appear in library (separate query)\n\n### Acceptance Criteria\n- [ ] baseConditions includes `eq(userItems.isFinished, false)`\n- [ ] Recent Bookmarks section excludes finished items\n- [ ] Jump Back In section excludes finished items\n- [ ] Videos section excludes finished items\n- [ ] Podcasts section excludes finished items\n- [ ] Articles section excludes finished items\n- [ ] All sections still return correctly when no items match","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T06:14:12.316438-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-wsz.5","title":"Add completion visual indicator to ItemCard component","description":"## Task: Add Completion Visual Indicator to ItemCard Component\n\n### What\nAdd visual feedback showing completion status on item cards across all variants (compact, full, large).\n\n### Why\nUsers need to see at a glance which items they've completed. This is especially important in the Library view where completed items ARE shown (unlike Inbox/Home). Without visual feedback:\n- Users can't distinguish completed from uncompleted items\n- They might re-consume content they've already finished\n- The \"mark as complete\" feature feels incomplete\n\n### Context\n**File:** `apps/mobile/components/item-card.tsx`\n\n**Current ItemCardData interface (lines 48-58):**\n```typescript\nexport interface ItemCardData {\n  id: string;\n  title: string;\n  creator: string;\n  thumbnailUrl: string | null;\n  contentType: ContentType;\n  provider: Provider;\n  duration?: number | null;\n  bookmarkedAt?: string | null;\n  publishedAt?: string | null;\n}\n```\n\nMissing: `isFinished` and `finishedAt` fields.\n\n**Three variants to update:**\n1. **compact** (library) - Most important, only place finished items appear\n2. **full** (inbox) - Less important since finished items filtered out\n3. **large** (home) - Less important since finished items filtered out\n\n### Implementation Details\n\n**1. Update ItemCardData interface:**\n```typescript\nexport interface ItemCardData {\n  // ... existing fields ...\n  isFinished?: boolean;\n  finishedAt?: string | null;\n}\n```\n\n**2. Design Options for Visual Indicator:**\n\n**Option A: Checkmark Badge (Recommended)**\nAdd a small checkmark badge on the thumbnail corner (opposite corner from duration badge):\n```typescript\n{item.isFinished \u0026\u0026 (\n  \u003cView style={styles.completedBadge}\u003e\n    \u003cCheckIcon size={12} color=\"#fff\" /\u003e\n  \u003c/View\u003e\n)}\n```\n\n**Option B: Opacity Reduction**\nReduce opacity of entire card when finished:\n```typescript\nstyle={[\n  styles.compactCard,\n  item.isFinished \u0026\u0026 { opacity: 0.7 },\n]}\n```\n\n**Option C: Title Strikethrough**\nAdd strikethrough to title:\n```typescript\n\u003cText style={[\n  styles.compactTitle,\n  item.isFinished \u0026\u0026 { textDecorationLine: 'line-through', opacity: 0.7 },\n]}\u003e\n```\n\n**Recommended: Option A + subtle opacity**\nCombines clear visual indicator with subtle \"dimming\" effect.\n\n**3. Add styles:**\n```typescript\ncompletedBadge: {\n  position: 'absolute',\n  top: Spacing.xs,\n  right: Spacing.xs,\n  width: 20,\n  height: 20,\n  borderRadius: 10,\n  backgroundColor: Colors.success, // green checkmark\n  alignItems: 'center',\n  justifyContent: 'center',\n},\ncompletedCard: {\n  opacity: 0.85,\n},\n```\n\n**4. Update all three variants:**\nApply the visual treatment consistently across compact, full, and large variants.\n\n### Design Considerations\n- **Accessibility:** Ensure color contrast meets WCAG standards\n- **Consistency:** Use same indicator style across all variants\n- **Subtlety:** Don't make finished items look \"disabled\" - they're still tappable\n- **Color:** Use success/green color to indicate positive completion (not gray which implies disabled)\n\n### Dependencies\n- Task 1 (types must include isFinished)\n\n### Testing\n- Render ItemCard with isFinished=true and isFinished=false\n- Verify badge appears on finished items\n- Verify badge position doesn't conflict with other badges\n- Test all three variants\n\n### Acceptance Criteria\n- [ ] ItemCardData interface includes isFinished field\n- [ ] Compact variant shows completion indicator\n- [ ] Full variant shows completion indicator\n- [ ] Large variant shows completion indicator\n- [ ] Visual indicator is consistent across variants\n- [ ] Finished items are still clearly tappable (not \"disabled\" looking)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T06:14:12.37226-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-wsz.6","title":"Verify optimistic updates handle filtering correctly","description":"## Task: Verify Optimistic Updates Handle Filtering Correctly\n\n### What\nReview and potentially update the `useToggleFinished()` hook's optimistic update logic to ensure items are correctly removed from inbox/home caches when marked as finished.\n\n### Why\nWith Tasks 3 and 4 adding server-side filtering (`isFinished = false`), the frontend optimistic updates need to match this behavior. If a user marks an inbox item as finished, it should:\n1. Immediately disappear from the inbox list (optimistic)\n2. Stay gone after server response (consistent)\n3. Reappear if marking as un-finished (reversible)\n\n### Context\n**File:** `apps/mobile/hooks/use-items-trpc.ts`\n\n**Current useToggleFinished implementation (lines 455-479):**\n```typescript\nexport function useToggleFinished() {\n  const utils = trpc.useUtils();\n\n  const toggleFinished = \u003cT extends { id: string; isFinished: boolean; finishedAt: string | null }\u003e(\n    item: T,\n    targetId: string\n  ): T =\u003e {\n    if (item.id !== targetId) return item;\n    const now = new Date().toISOString();\n    return {\n      ...item,\n      isFinished: !item.isFinished,\n      finishedAt: item.isFinished ? null : now,\n    };\n  };\n\n  return trpc.items.toggleFinished.useMutation(\n    createOptimisticConfig(utils, {\n      updateInbox: (items, { id }) =\u003e items.map((item) =\u003e toggleFinished(item, id)),\n      updateLibrary: (items, { id }) =\u003e items.map((item) =\u003e toggleFinished(item, id)),\n      updateSingleItem: (item, { id }) =\u003e toggleFinished(item, id),\n    })\n  );\n}\n```\n\n### Issue Identified\nThe current `updateInbox` uses `map()` which keeps items in the list with toggled `isFinished` value. But since the server now filters out `isFinished = true` items, the optimistic update should REMOVE the item from inbox, not just toggle its flag.\n\n### Implementation Details\n\n**Update optimistic update logic:**\n```typescript\nreturn trpc.items.toggleFinished.useMutation(\n  createOptimisticConfig(utils, {\n    // Inbox: if marking finished, remove from list; if un-marking, add back\n    updateInbox: (items, { id }) =\u003e {\n      const item = items.find((i) =\u003e i.id === id);\n      if (!item) return items;\n      \n      if (!item.isFinished) {\n        // Marking as finished → remove from inbox (server filters these out)\n        return items.filter((i) =\u003e i.id !== id);\n      } else {\n        // Un-marking as finished → keep in list, toggle flag\n        return items.map((i) =\u003e toggleFinished(i, id));\n      }\n    },\n    // Library: keep all items, just toggle the flag (library shows all)\n    updateLibrary: (items, { id }) =\u003e items.map((item) =\u003e toggleFinished(item, id)),\n    // Single item: always toggle (this is the item detail view)\n    updateSingleItem: (item, { id }) =\u003e toggleFinished(item, id),\n  })\n);\n```\n\n**Also update home cache:**\nThe home query also filters out finished items. Need to add home cache handling:\n```typescript\n// In onMutate, also cancel and update home data\nawait utils.items.home.cancel();\n// Update home data to filter out finished items\nutils.items.home.setData(undefined, (old) =\u003e {\n  if (!old) return old;\n  const filterFinished = (items: typeof old.recentBookmarks) =\u003e\n    items.filter((i) =\u003e i.id !== id || i.isFinished);\n  // ... apply to all sections\n});\n```\n\n### Edge Cases\n1. **Item in both inbox and library:** Shouldn't happen (different states), but handle gracefully\n2. **Rapid toggling:** Each toggle should be independent; optimistic updates should handle back-to-back mutations\n3. **Network failure:** Rollback should restore previous state correctly\n\n### Dependencies\n- Tasks 3 and 4 (filtering) define the expected server behavior\n\n### Testing\n- Mark inbox item as finished → should disappear from inbox list immediately\n- Un-mark that item → should reappear in inbox (if still INBOX state)\n- Mark library item as finished → should stay in library with visual indicator\n- Verify home page updates when items marked finished\n\n### Acceptance Criteria\n- [ ] Inbox optimistic update removes finished items\n- [ ] Library optimistic update keeps finished items (with toggled flag)\n- [ ] Home page optimistic update removes finished items\n- [ ] Rollback correctly restores items on error\n- [ ] Un-marking works correctly in all contexts","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T06:14:12.429419-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-wsz.7","title":"Add E2E test coverage for mark as complete flow","description":"## Task: Add E2E Test Coverage for Mark as Complete Flow\n\n### What\nCreate end-to-end tests covering the complete \"mark as complete\" user journey.\n\n### Why\nThis feature touches multiple layers (UI, hooks, tRPC, database) and has complex state interactions. E2E tests ensure the full flow works correctly and catches regressions.\n\n### Context\n**Current test infrastructure:**\n- Mobile: Jest setup in `apps/mobile/jest.config.js`\n- Worker: Vitest setup in `apps/worker/vitest.config.ts`\n\n**Existing tests to reference:**\n- `apps/mobile/hooks/use-offline-mutation.test.ts` - mutation testing patterns\n- `apps/mobile/lib/auth.test.ts` - unit test patterns\n- `apps/worker/src/lib/auth.test.ts` - backend test patterns\n\n### Test Scenarios\n\n**1. Item Detail Page Tests:**\n```typescript\ndescribe('Mark as Complete - Item Detail', () =\u003e {\n  it('toggles completion state when check icon tapped', async () =\u003e {\n    // Render item detail with isFinished=false\n    // Tap check icon\n    // Verify icon changes to filled\n    // Verify mutation called with correct id\n  });\n\n  it('shows filled icon for completed items', async () =\u003e {\n    // Render item detail with isFinished=true\n    // Verify CheckIcon (filled) is rendered, not CheckOutlineIcon\n  });\n\n  it('provides haptic feedback on toggle', async () =\u003e {\n    // Mock Haptics\n    // Tap check icon\n    // Verify Haptics.impactAsync called\n  });\n\n  it('disables button during pending mutation', async () =\u003e {\n    // Mock slow mutation\n    // Tap check icon\n    // Verify button opacity reduced\n    // Verify button not clickable\n  });\n});\n```\n\n**2. Inbox Filtering Tests:**\n```typescript\ndescribe('Mark as Complete - Inbox Filtering', () =\u003e {\n  it('hides completed items from inbox', async () =\u003e {\n    // Mock inbox response with mix of finished/unfinished\n    // Render inbox screen\n    // Verify only unfinished items displayed\n  });\n\n  it('removes item from inbox when marked complete', async () =\u003e {\n    // Render inbox with unfinished item\n    // Navigate to item detail\n    // Mark as complete\n    // Navigate back to inbox\n    // Verify item removed\n  });\n});\n```\n\n**3. Library Display Tests:**\n```typescript\ndescribe('Mark as Complete - Library Display', () =\u003e {\n  it('shows completed items in library', async () =\u003e {\n    // Mock library response with finished items\n    // Render library screen\n    // Verify finished items displayed with visual indicator\n  });\n\n  it('shows completion badge on finished items', async () =\u003e {\n    // Render ItemCard with isFinished=true\n    // Verify completion badge visible\n  });\n});\n```\n\n**4. Home Page Filtering Tests:**\n```typescript\ndescribe('Mark as Complete - Home Filtering', () =\u003e {\n  it('hides completed items from Jump Back In', async () =\u003e {\n    // Mock home response\n    // Verify finished items not in jumpBackIn section\n  });\n\n  it('hides completed items from content type sections', async () =\u003e {\n    // Mock home response\n    // Verify finished items not in podcasts/videos/articles sections\n  });\n});\n```\n\n**5. Optimistic Update Tests:**\n```typescript\ndescribe('Mark as Complete - Optimistic Updates', () =\u003e {\n  it('immediately removes item from inbox on toggle', async () =\u003e {\n    // Setup mutation that takes time\n    // Toggle finished\n    // Verify item immediately removed (before server response)\n  });\n\n  it('rolls back on mutation error', async () =\u003e {\n    // Setup failing mutation\n    // Toggle finished\n    // Verify item returns to original state\n  });\n});\n```\n\n### Implementation Notes\n- Use React Native Testing Library for component tests\n- Mock tRPC hooks for isolation\n- Use MSW or similar for API mocking if needed\n- Focus on user-visible behavior, not implementation details\n\n### Dependencies\n- All other tasks must be complete (this tests the full feature)\n\n### Acceptance Criteria\n- [ ] Item detail toggle test passes\n- [ ] Inbox filtering test passes\n- [ ] Library display test passes\n- [ ] Home filtering test passes\n- [ ] Optimistic update test passes\n- [ ] Error rollback test passes\n- [ ] All tests run in CI","status":"tombstone","priority":3,"issue_type":"task","created_at":"2026-01-01T06:14:12.48783-06:00","created_by":"erikjohansson","updated_at":"2026-01-01T07:04:27.092112-06:00","close_reason":"Cleaning up incorrectly created beads","deleted_at":"2026-01-01T07:04:27.092112-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-zuw","title":"Fix beads view not updating live during planning phase (GH #12)","description":"## Problem Statement\n\nThe beads view in the planning phase does not update in real-time when beads are created or modified by the AI agent. Users must manually refresh to see changes, breaking the live collaboration experience.\n\n## Root Cause Analysis\n\nThe current implementation in `src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts` uses `fs.watch()` on a `.beads/` directory within the worktree. This approach has several fundamental issues:\n\n### 1. Wrong Watch Target\nWorktrees do NOT have their own `.beads/` directory. The beads database is shared with the main repository (see `.beads/config.yaml` with `sync-branch: beads-sync`). The code watches a non-existent directory:\n```typescript\n// line 93: const beadsDir = path.join(worktreePath, \".beads\");\n```\n\n### 2. Immediate Fallback to Slow Polling\nSince the directory does not exist, `fs.watch()` immediately falls back to 5-second polling (`POLL_INTERVAL_MS = 5000`), which is too slow for real-time UX.\n\n### 3. Wrong File Type\nEven if the directory existed, the code watches for JSONL file changes, but beads uses SQLite (`beads.db`). JSONL exports add additional latency.\n\n### 4. Platform-Specific Issues\n`fs.watch()` has known quirks with Linux inotify limits and macOS FSEvents.\n\n## Solution: Use `bd activity --follow`\n\nThe beads CLI provides a purpose-built real-time event stream via `bd activity --follow --json`. This outputs NDJSON (newline-delimited JSON) with immediate mutation events:\n\n```json\n{\"timestamp\":\"...\",\"type\":\"create\",\"issue_id\":\"...\",\"message\":\"...\"}\n{\"timestamp\":\"...\",\"type\":\"status\",\"issue_id\":\"...\",\"old_status\":\"open\",\"new_status\":\"closed\"}\n```\n\n### Why This Works\n- **Purpose-built**: Designed for real-time mutation tracking\n- **Immediate**: Events fire on SQLite mutation, not file export\n- **No file watching**: Avoids inotify/FSEvents complexity\n- **Works with shared DB**: Auto-discovers database regardless of worktree location\n- **Semantic events**: Know *what* changed (create/status/update/delete)\n\n## Success Criteria\n- Bead creation appears in UI within ~1 second\n- Status updates reflect within ~1 second\n- No zombie `bd` processes after client disconnect\n- Graceful polling fallback if `bd activity` fails\n- Automatic process restart on unexpected crash\n\n## Files Affected\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts` (primary)\n- No changes to client hooks or other services\n\n## Related\n- GitHub Issue: #12\n- Branch: feature/issue-12-fix-beads-view-not-updating-live-during-planning-p","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2026-01-01T21:54:27.565511-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"All implementation tasks complete, TypeScript passes, tests pass","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-zuw.1","title":"Remove fs.watch infrastructure and add child_process imports","description":"## Task Overview\n\nRemove the broken `fs.watch()` infrastructure from the SSE endpoint and add the necessary imports for spawning the `bd activity` subprocess.\n\n## Background \u0026 Reasoning\n\nThe current code imports `watch` and `FSWatcher` from `fs`, and uses `access` to check directory existence. None of this is needed when switching to subprocess-based watching. Instead, we need `spawn` from `child_process` to run `bd activity --follow`.\n\n## Changes Required\n\n### Remove imports (lines 7-8):\n```typescript\n// REMOVE:\nimport { watch, FSWatcher } from \"fs\";\nimport { access, constants } from \"fs/promises\";\n```\n\n### Add imports:\n```typescript\nimport { spawn, ChildProcess } from \"child_process\";\n```\n\n### Remove helper function (lines 40-47):\n```typescript\n// REMOVE: directoryExists() function - no longer needed\n```\n\n### Remove variables in stream start():\n- Remove: `let watcher: FSWatcher | null = null;`\n- Add: Subprocess tracking will be handled differently\n\n## Why This Matters\n\nThis is the foundational change that enables the new architecture. Without removing the old infrastructure, we would have dead code and confusing imports. The `ChildProcess` type is essential for proper TypeScript typing of the subprocess handle.\n\n## Files Changed\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts`\n\n## Acceptance Criteria\n- [ ] No fs.watch imports remain\n- [ ] No FSWatcher type references remain\n- [ ] child_process spawn and ChildProcess are imported\n- [ ] directoryExists helper is removed\n- [ ] No TypeScript compilation errors","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T21:54:42.071368-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-zuw.10","title":"Manual testing: verify polling fallback when bd unavailable","description":"## Task Overview\n\nVerify that the system gracefully falls back to 5-second polling when the `bd activity` command is unavailable or fails.\n\n## Background \u0026 Reasoning\n\nIn production environments, `bd` might not be installed, might be an older version without the `activity` subcommand, or might fail for other reasons. The system must degrade gracefully to polling rather than breaking entirely.\n\n## Test Procedure\n\n### Test 1: bd Not in PATH\n\n1. **Temporarily Remove bd from PATH**\n   ```bash\n   # Find bd location\n   which bd\n   # e.g., /usr/local/bin/bd\n   \n   # Temporarily rename it\n   sudo mv /usr/local/bin/bd /usr/local/bin/bd.bak\n   ```\n\n2. **Open Planning Page**\n   - Should connect without error\n   - Check server logs for polling fallback message:\n     `[beads-watch] Falling back to polling (5000ms)`\n\n3. **Test Updates**\n   ```bash\n   # Restore bd first\n   sudo mv /usr/local/bin/bd.bak /usr/local/bin/bd\n   bd create \"Test during polling\" -t task -p 2\n   ```\n   - Bead should appear within 5 seconds (polling interval)\n\n4. **Restore bd**\n   ```bash\n   sudo mv /usr/local/bin/bd.bak /usr/local/bin/bd\n   ```\n\n### Test 2: bd Process Repeatedly Crashes\n\n1. **Simulate Crash**\n   - This is harder to test manually\n   - Would require modifying code to force subprocess exit\n   - Or: repeatedly kill the bd process in another terminal\n\n2. **Expected Behavior**\n   - Should attempt 5 restarts with backoff (1s, 2s, 3s, 4s, 5s)\n   - After 5 failures, should fall back to polling\n   - Server logs should show restart attempts and final fallback\n\n### Test 3: SSE Still Works During Polling\n\n1. **Force Polling Mode** (by breaking bd temporarily)\n2. **Create/Update Beads**\n3. **Verify** updates appear within ~5 seconds\n4. **Verify** SSE connection stays open (no disconnects)\n\n### Expected Server Logs\n\nWhen falling back to polling:\n```\n[beads-watch] Activity process spawn error: ...\n[beads-watch] Falling back to polling (5000ms)\n```\n\nWhen restarting:\n```\n[beads-watch] Activity process exited with code 1\n[beads-watch] Restarting in 1000ms (attempt 1/5)\n...\n[beads-watch] Max restart attempts reached, falling back to polling\n[beads-watch] Falling back to polling (5000ms)\n```\n\n## Files Changed\nNone (testing only)\n\n## Acceptance Criteria\n- [ ] Polling fallback activates when bd unavailable\n- [ ] Polling fallback activates after 5 restart failures\n- [ ] Updates still work during polling (with ~5s latency)\n- [ ] SSE connection remains stable during polling\n- [ ] Appropriate log messages are visible","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T21:57:21.015615-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Implementation complete, manual testing deferred to user","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-zuw.11","title":"Manual testing: verify rapid event debouncing","description":"## Task Overview\n\nVerify that rapid bead creation/updates are properly debounced to avoid flooding the UI with updates.\n\n## Background \u0026 Reasoning\n\nWhen the AI agent creates multiple beads quickly (e.g., creating 10 subtasks), we should not send 10 separate SSE events in rapid succession. The 100ms debounce should batch these into fewer updates.\n\n## Test Procedure\n\n### Setup\n\n1. Open planning page\n2. Open DevTools Network tab, filter by \"watch\"\n3. Click the SSE connection to view events\n\n### Test: Rapid Creation\n\n```bash\n# In terminal, create 10 beads rapidly\nfor i in {1..10}; do\n  bd create \"Rapid test $i\" -t task -p 3 \u0026\ndone\nwait\n```\n\n### Observe\n\n1. **In DevTools EventStream:**\n   - Should see significantly fewer than 10 \"update\" events\n   - Events should be batched (multiple creates in one update)\n\n2. **In UI:**\n   - All 10 beads should eventually appear\n   - UI should not flicker or jank\n\n### Expected Behavior\n\nWith 100ms debounce:\n- If 10 creates happen within 100ms, should see ~1-2 updates\n- If creates are spread over 500ms, should see ~5-6 updates\n- Final state should always show all beads\n\n### What to Check If It Fails\n\n1. Verify DEBOUNCE_MS is set to 100\n2. Check if debouncedSendBeads is being called (add debug log)\n3. Verify debounce timer is being cleared and reset\n\n### Performance Consideration\n\nWithout debouncing:\n- 10 creates → 10 SSE events → 10 React re-renders\n- Potentially causes UI jank\n\nWith debouncing:\n- 10 creates → 1-2 SSE events → 1-2 React re-renders\n- Smooth UI experience\n\n## Files Changed\nNone (testing only)\n\n## Acceptance Criteria\n- [ ] Rapid creates result in fewer SSE events than creates\n- [ ] All beads eventually appear in UI\n- [ ] No UI flickering during rapid updates\n- [ ] DevTools shows batched update events","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T21:57:37.004841-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Consolidated into maestro-zuw.8","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-zuw.12","title":"Manual testing: verify long session stability","description":"## Task Overview\n\nVerify that the SSE connection and subprocess remain stable during extended planning sessions (10+ minutes).\n\n## Background \u0026 Reasoning\n\nReal planning sessions can last 30+ minutes. The subprocess and SSE connection must remain stable throughout without memory leaks, connection drops, or process accumulation.\n\n## Test Procedure\n\n### Setup\n\n1. Open planning page\n2. Note the time\n3. Leave it open for 10-15 minutes (or longer if possible)\n\n### During Test\n\nPeriodically (every 2-3 minutes):\n1. Create a bead: `bd create \"Stability test $(date +%H:%M)\" -t task -p 3`\n2. Verify it appears in UI within ~1 second\n3. Check process count: `ps aux | grep \"bd activity\" | wc -l`\n   - Should always be 1\n\n### Observations to Log\n\n- Any SSE disconnects (check DevTools or isConnected state)\n- Any failed updates\n- Process count at each check\n- Server memory usage (optional): `ps aux | grep node`\n\n### Expected Behavior\n\n- SSE connection remains open continuously\n- Updates continue to work at minute 10+ same as minute 1\n- Exactly 1 `bd activity` process throughout\n- No increase in server memory\n\n### Signs of Problems\n\n- Connection drops and reconnects (check reconnectAttempts in React state)\n- Increasing process count (zombie processes)\n- Increasing latency for updates\n- Memory growth in server process\n\n### If Connection Drops\n\n1. Check server logs for errors\n2. Check if subprocess crashed\n3. Verify network issues are not the cause\n4. Note how quickly reconnection happens\n\n## Files Changed\nNone (testing only)\n\n## Acceptance Criteria\n- [ ] SSE stays connected for 10+ minutes\n- [ ] Updates work throughout the session\n- [ ] Process count stays at 1\n- [ ] No memory leaks observed\n- [ ] Reconnection works if connection drops","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T21:57:53.57846-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Consolidated into maestro-zuw.8","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-zuw.13","title":"Verify TypeScript compilation and run type check","description":"## Task Overview\n\nRun TypeScript compilation to verify no type errors after all import/variable changes.\n\n## Background \u0026 Reasoning\n\nThe implementation tasks modify imports (removing fs, adding child_process) and change variable types (FSWatcher to ChildProcess). A type check ensures:\n1. All imports resolve correctly\n2. Variable types match their usage\n3. No implicit any or missing types\n\n## Verification Steps\n\n```bash\n# Run TypeScript compiler in check mode\nnpx tsc --noEmit\n\n# Or if using Next.js's type checking\nnpm run type-check\n```\n\n## Expected Output\n\n- No type errors related to the modified file\n- All ChildProcess type usages are correct\n- spawn() call signature matches expected types\n\n## Common Issues to Watch For\n\n1. **Missing type imports**: `ChildProcess` must be imported from `child_process`\n2. **Nullable checks**: `activityProc?.stdout` vs `activityProc.stdout`\n3. **Buffer type**: The data event receives `Buffer`, ensure toString() is called\n\n## Files Checked\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts`\n\n## Acceptance Criteria\n- [ ] `npx tsc --noEmit` passes with no errors\n- [ ] No ESLint errors in modified file","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T22:03:08.170541-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-zuw.2","title":"Add subprocess restart constants and tracking variables","description":"## Task Overview\n\nAdd new constants for subprocess management and update the variable declarations inside the ReadableStream start() function to track the bd process instead of the FSWatcher.\n\n## Background \u0026 Reasoning\n\nThe `bd activity --follow` subprocess may crash or exit unexpectedly. We need restart logic with exponential backoff to handle transient failures while falling back to polling if the process consistently fails.\n\n## Changes Required\n\n### Update constants block (after line 15):\n```typescript\n// Constants\nconst DEBOUNCE_MS = 100;\nconst POLL_INTERVAL_MS = 5000;\nconst RESTART_DELAY_MS = 1000;      // NEW: Base delay before restart\nconst MAX_RESTART_ATTEMPTS = 5;      // NEW: Max restarts before polling fallback\n```\n\n### Update variables INSIDE stream start() (around line 101-104):\n\n**CRITICAL**: The subprocess reference MUST be inside start(), NOT at module scope!\n\n```typescript\n// Track cleanup state\nlet isCleanedUp = false;\nlet debounceTimer: NodeJS.Timeout | null = null;\nlet pollInterval: NodeJS.Timeout | null = null;\n// REMOVE: let watcher: FSWatcher | null = null;\n\n// ADD these variables (INSIDE start(), not module scope):\nlet activityProc: ChildProcess | null = null;  // Subprocess handle\nlet lineBuffer = \"\";                           // Buffer for incomplete NDJSON lines\nlet restartAttempts = 0;                        // Track restart attempts for backoff\n```\n\n## Why activityProc Must Be Inside start()\n\n**BUG PREVENTION**: If activityProc were at module scope, multiple concurrent SSE connections would overwrite each other's subprocess reference. When client A disconnects, cleanup() would kill client B's subprocess!\n\nNext.js route handler modules are shared across all requests. Each ReadableStream's start() function creates a closure that captures its own variables. This ensures each SSE connection has its own isolated subprocess reference.\n\n## Why This Matters\n\n- **RESTART_DELAY_MS**: 1 second base delay gives the system time to stabilize\n- **MAX_RESTART_ATTEMPTS**: 5 attempts with backoff covers ~15 seconds of retries\n- **lineBuffer**: NDJSON streams may split lines across chunks; buffering is essential\n- **restartAttempts**: Must track to know when to give up and fall back to polling\n- **activityProc scope**: MUST be per-connection to avoid cross-talk between clients\n\n## Files Changed\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts`\n\n## Acceptance Criteria\n- [ ] RESTART_DELAY_MS = 1000 is defined\n- [ ] MAX_RESTART_ATTEMPTS = 5 is defined  \n- [ ] activityProc is declared INSIDE start(), not at module scope\n- [ ] lineBuffer variable is added inside start()\n- [ ] restartAttempts variable is added inside start()\n- [ ] watcher variable is removed","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T21:54:57.956549-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-zuw.3","title":"Update cleanup() function to terminate subprocess","description":"## Task Overview\n\nModify the cleanup() function to properly terminate the `bd activity` subprocess instead of closing an FSWatcher.\n\n## Background \u0026 Reasoning\n\nWhen the client disconnects or the stream ends, we MUST terminate the subprocess to prevent zombie processes. The current cleanup closes an FSWatcher; we need to kill a subprocess instead.\n\n## Current Code (lines 171-199):\n```typescript\nfunction cleanup(): void {\n  if (isCleanedUp) return;\n  isCleanedUp = true;\n\n  if (debounceTimer) {\n    clearTimeout(debounceTimer);\n    debounceTimer = null;\n  }\n\n  if (pollInterval) {\n    clearInterval(pollInterval);\n    pollInterval = null;\n  }\n\n  if (watcher) {                    // \u003c-- REMOVE THIS BLOCK\n    try {\n      watcher.close();\n    } catch {\n      // Ignore close errors\n    }\n    watcher = null;\n  }\n\n  try {\n    controller.close();\n  } catch {\n    // Stream might already be closed\n  }\n}\n```\n\n## New Code:\n```typescript\nfunction cleanup(): void {\n  if (isCleanedUp) return;\n  isCleanedUp = true;\n\n  if (debounceTimer) {\n    clearTimeout(debounceTimer);\n    debounceTimer = null;\n  }\n\n  if (pollInterval) {\n    clearInterval(pollInterval);\n    pollInterval = null;\n  }\n\n  // Kill the activity subprocess\n  if (activityProc) {\n    activityProc.kill(\"SIGTERM\");\n    activityProc = null;\n  }\n\n  try {\n    controller.close();\n  } catch {\n    // Stream might already be closed\n  }\n}\n```\n\n## Why SIGTERM\n\nWe use SIGTERM (not SIGKILL) because:\n1. **Graceful shutdown**: SIGTERM allows the process to clean up\n2. **Convention**: SIGTERM is the standard \"please exit\" signal\n3. **Cross-platform**: Node's process.kill() handles Windows correctly\n\nSIGKILL should only be used as a last resort if SIGTERM is ignored.\n\n## Edge Cases\n\n- If activityProc is null, the check prevents a crash\n- If kill() throws (rare), it will propagate - this is intentional\n- The subprocess's `close` event will fire but cleanup is already done\n\n## Files Changed\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts`\n\n## Acceptance Criteria\n- [ ] Watcher close block is removed\n- [ ] activityProc.kill(\"SIGTERM\") is called in cleanup\n- [ ] activityProc is set to null after kill\n- [ ] No zombie processes after client disconnect (manual test)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T21:55:13.304037-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-zuw.4","title":"Implement startActivityStream() function","description":"## Task Overview\n\nCreate a new `startActivityStream()` function that spawns the `bd activity --follow --json` subprocess and handles its output, errors, and lifecycle.\n\n## Background \u0026 Reasoning\n\nThis is the core of the new implementation. The `bd activity --follow` command provides a real-time stream of bead mutation events. We parse these events and trigger bead list refreshes when mutations occur.\n\n## Function Implementation\n\n```typescript\nfunction startActivityStream(): void {\n  if (isCleanedUp) return;\n\n  // Reset restart counter on successful start (will increment on failure)\n  const thisAttemptNumber = restartAttempts;\n\n  // Use --since 0s to skip historical events, only receive new ones\n  activityProc = spawn(\"bd\", [\"activity\", \"--follow\", \"--json\", \"--since\", \"0s\"], {\n    cwd: worktreePath,\n    stdio: [\"ignore\", \"pipe\", \"pipe\"],\n  });\n\n  // Track successful operation to reset restart counter\n  let hasReceivedData = false;\n\n  // Handle stdout (NDJSON event stream)\n  activityProc.stdout?.on(\"data\", (data: Buffer) =\u003e {\n    if (isCleanedUp) return;\n\n    // First data received = process is working, reset restart counter\n    if (!hasReceivedData) {\n      hasReceivedData = true;\n      restartAttempts = 0;  // Reset on successful operation\n    }\n\n    // Append to line buffer and parse complete lines\n    lineBuffer += data.toString();\n    const lines = lineBuffer.split(\"\\n\");\n    \n    // Keep incomplete last line in buffer\n    lineBuffer = lines.pop() || \"\";\n\n    for (const line of lines) {\n      const trimmed = line.trim();\n      if (!trimmed) continue;\n\n      try {\n        // Parse to validate JSON\n        // Any valid event means something changed - trigger refresh\n        JSON.parse(trimmed);\n        debouncedSendBeads();\n      } catch {\n        // Not valid JSON - might be a partial line or log message\n        // Ignore silently\n      }\n    }\n  });\n\n  // Handle stderr (warnings/errors from bd)\n  activityProc.stderr?.on(\"data\", (data: Buffer) =\u003e {\n    // Log but don't treat as fatal - bd may output warnings\n    console.warn(\"[beads-watch] bd stderr:\", data.toString().trim());\n  });\n\n  // Handle spawn error (e.g., bd not found)\n  activityProc.on(\"error\", (err) =\u003e {\n    console.error(\"[beads-watch] Activity process spawn error:\", err);\n    activityProc = null;\n\n    if (!isCleanedUp) {\n      sendEvent({ type: \"error\", error: \"Activity stream failed to start\" });\n      startPolling();\n    }\n  });\n\n  // Handle process exit\n  activityProc.on(\"close\", (code) =\u003e {\n    activityProc = null;\n    if (isCleanedUp) return;\n\n    console.log(`[beads-watch] Activity process exited with code ${code}`);\n\n    // Attempt restart with linear backoff\n    if (restartAttempts \u003c MAX_RESTART_ATTEMPTS) {\n      restartAttempts++;\n      const delay = RESTART_DELAY_MS * restartAttempts;\n      console.log(`[beads-watch] Restarting in ${delay}ms (attempt ${restartAttempts}/${MAX_RESTART_ATTEMPTS})`);\n      \n      setTimeout(() =\u003e {\n        if (!isCleanedUp) startActivityStream();\n      }, delay);\n    } else {\n      console.error(\"[beads-watch] Max restart attempts reached, falling back to polling\");\n      startPolling();\n    }\n  });\n\n  console.log(`[beads-watch] Started bd activity --follow for ${worktreePath}`);\n}\n```\n\n## Key Design Decisions\n\n### 1. `--since 0s` Flag\nWe use `--since 0s` to skip historical events. Without this, `bd activity` outputs recent historical events before streaming live ones. We only want new events since we send initial bead list separately.\n\n### 2. NDJSON Line Buffering\nNDJSON (Newline Delimited JSON) may split lines across data chunks. We buffer incomplete lines and only process complete ones. The last element after split() is either empty (line was complete) or a partial line (keep in buffer).\n\n### 3. Spawn Options\n- `cwd: worktreePath`: Run in worktree so bd finds the shared database\n- `stdio: [\"ignore\", \"pipe\", \"pipe\"]`: No stdin, capture stdout/stderr\n- No shell wrapping: spawn() is safer than exec()\n\n### 4. stderr Handling\nWe log stderr as warnings but don't fail. The bd CLI may output warnings (e.g., about sync state) that aren't fatal.\n\n### 5. Restart Counter Reset\n**IMPORTANT**: The restart counter resets to 0 when we receive valid data from the subprocess. This prevents the counter from accumulating across long sessions where occasional transient failures occur.\n\n### 6. Linear Backoff\nDelays: 1s, 2s, 3s, 4s, 5s - totaling 15s of retry window. After 5 failures without successful data reception, we assume something is fundamentally wrong and fall back to polling.\n\n### 7. Why Not Parse Event Contents?\nWe could parse the event type and only refresh on relevant events. However, ANY mutation event means the bead list may have changed, so a full refresh is always correct. Parsing adds complexity without benefit.\n\n## Files Changed\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts`\n\n## Acceptance Criteria\n- [ ] Function spawns bd with correct arguments\n- [ ] stdout is parsed as NDJSON with line buffering\n- [ ] stderr is logged but not treated as fatal\n- [ ] spawn errors trigger polling fallback\n- [ ] Process exit triggers restart with backoff\n- [ ] Max restart attempts trigger polling fallback\n- [ ] cleanup flag prevents actions after cleanup\n- [ ] Restart counter resets after receiving valid data","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T21:55:47.991527-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-zuw.5","title":"Remove setupWatcher() and update initialization flow","description":"## Task Overview\n\nRemove the entire `setupWatcher()` function and update the initialization at the end of `start()` to call `startActivityStream()` instead.\n\n## Background \u0026 Reasoning\n\nThe `setupWatcher()` function contains all the fs.watch logic that is being replaced. It checks for directory existence, sets up watchers, and handles watcher events. All of this is replaced by the subprocess approach.\n\n## Changes Required\n\n### Remove setupWatcher() (lines 219-276):\n```typescript\n// REMOVE entire function:\nasync function setupWatcher(): Promise\u003cvoid\u003e {\n  // Check if .beads directory exists\n  const beadsDirExists = await directoryExists(beadsDir);\n  // ... all this code is obsolete\n}\n```\n\n### Update initialization (lines 291-294):\n```typescript\n// BEFORE:\n// Set up file watching (or polling fallback)\nawait setupWatcher();\n\n// AFTER:\n// Start the bd activity stream for real-time updates\nstartActivityStream();\n```\n\n### Remove beadsDir variable (line 93):\n```typescript\n// REMOVE - no longer needed:\nconst beadsDir = path.join(worktreePath, \".beads\");\n```\n\n## Why This Matters\n\nThis is the integration point where we switch from the old approach to the new approach. The initialization now simply starts the activity stream, which handles its own error cases and polling fallback internally.\n\n## Order of Operations After Change\n\n1. Send \"connected\" event\n2. Send initial beads list (existing behavior)\n3. Start activity stream (new behavior)\n\nThis order is intentional: the client gets the current state immediately, then receives updates as they happen.\n\n## Files Changed\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts`\n\n## Acceptance Criteria\n- [ ] setupWatcher() function is completely removed\n- [ ] beadsDir variable is removed\n- [ ] startActivityStream() is called after sendBeadsUpdate()\n- [ ] No TypeScript errors about undefined functions\n- [ ] No references to beadsDir remain","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T21:56:04.328042-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-zuw.6","title":"Update documentation: file header and log messages","description":"## Task Overview\n\nUpdate comments and log messages to accurately reflect the new subprocess-based architecture.\n\n## Changes Required\n\n### 1. Update File Header (lines 1-5)\n\n**Current:**\n```typescript\n// Beads Watch API - Server-Sent Events for real-time bead updates\n// GET /api/projects/{id}/planning/{issueNumber}/beads/watch\n//\n// This endpoint uses file system watching on the `.beads/` directory to detect\n// when the AI agent creates or modifies beads, enabling real-time UI updates.\n```\n\n**New:**\n```typescript\n// Beads Watch API - Server-Sent Events for real-time bead updates\n// GET /api/projects/{id}/planning/{issueNumber}/beads/watch\n//\n// This endpoint uses the `bd activity --follow` subprocess to receive real-time\n// bead mutation events. When the AI agent creates or modifies beads, events are\n// streamed via NDJSON and trigger UI updates.\n//\n// Architecture:\n// - Spawns `bd activity --follow --json --since 0s` subprocess\n// - Parses NDJSON events (one JSON object per line)\n// - Triggers debounced bead list refresh on any mutation event\n// - Automatic restart with backoff on subprocess failure\n// - Falls back to 5-second polling if subprocess repeatedly fails\n//\n// Why subprocess instead of fs.watch:\n// - Worktrees share the main repo's .beads/ directory (no local .beads/)\n// - bd activity watches SQLite mutations directly, not file exports\n// - No platform-specific inotify/FSEvents issues\n// - Semantic events (create/update/delete) instead of raw file changes\n```\n\n### 2. Update startPolling() Log Message (line 207)\n\n**Current:**\n```typescript\nconsole.log(`[beads-watch] File watching unavailable, falling back to polling (${POLL_INTERVAL_MS}ms)`);\n```\n\n**New:**\n```typescript\nconsole.log(`[beads-watch] Falling back to polling (${POLL_INTERVAL_MS}ms)`);\n```\n\n## Why This Matters\n\n1. **Accuracy**: Comments match implementation\n2. **No confusion**: Future devs understand the approach\n3. **Debugging**: Log messages reflect actual behavior\n\n## Files Changed\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts`\n\n## Acceptance Criteria\n- [ ] Header describes subprocess approach, not fs.watch\n- [ ] Architecture overview is included\n- [ ] Rationale documented\n- [ ] Log message simplified (no 'file watching' reference)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T21:56:21.206042-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Closed","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-zuw.7","title":"Simplify startPolling() logging message","description":"## Task Overview\n\nUpdate the log message in `startPolling()` to remove the reference to \"file watching unavailable\" since we no longer use file watching.\n\n## Background \u0026 Reasoning\n\nThe current log message says \"File watching unavailable, falling back to polling\" but we are not using file watching anymore. The message should reflect that we are falling back because the activity stream failed.\n\n## Current Code (line 207):\n```typescript\nconsole.log(`[beads-watch] File watching unavailable, falling back to polling (${POLL_INTERVAL_MS}ms)`);\n```\n\n## New Code:\n```typescript\nconsole.log(`[beads-watch] Falling back to polling (${POLL_INTERVAL_MS}ms)`);\n```\n\n## Why This Matters\n\nAccurate log messages are essential for debugging. If someone sees \"file watching unavailable\" but we do not use file watching, it creates confusion about the architecture.\n\n## Files Changed\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts`\n\n## Acceptance Criteria\n- [ ] Log message no longer mentions file watching\n- [ ] Polling interval is still included in message","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-01T21:56:30.512304-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Consolidated into maestro-zuw.6","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-zuw.8","title":"Manual testing: verify core functionality (real-time updates, cleanup, debouncing, stability)","description":"## Task Overview\n\nComprehensive manual testing of the core SSE functionality to verify the fix works end-to-end.\n\n## Test Scenarios\n\n### 1. Real-Time Bead Updates (Primary Goal)\n\n**Prerequisites:**\n1. Dev server running (`npm run dev`)\n2. Project configured in maestro\n3. Terminal access to worktree\n\n**Steps:**\n1. Open planning page, open DevTools Network, filter 'watch'\n2. Confirm SSE connection established (`text/event-stream`)\n3. In terminal: `bd create \"Test realtime\" -t task -p 2`\n4. Verify bead appears in UI within ~1 second\n5. Test status update: `bd update \u003cid\u003e --status in_progress`\n6. Test close: `bd close \u003cid\u003e`\n\n**Expected:** All changes reflect in UI within ~1 second, no refresh needed.\n\n---\n\n### 2. Subprocess Cleanup on Disconnect\n\n**Steps:**\n1. Check initial: `ps aux | grep \"bd activity\"` (should be none)\n2. Open planning page\n3. Verify: `ps aux | grep \"bd activity\"` (should be 1)\n4. Close browser tab\n5. Wait 3 seconds, verify: `ps aux | grep \"bd activity\"` (should be 0)\n\n**Additional:**\n- Test with 3 tabs open (should see 3 processes)\n- Test page refresh (old process killed, new one started)\n- Test navigation away (process killed)\n\n**Expected:** Process count matches active connections, no zombies.\n\n---\n\n### 3. Rapid Event Debouncing\n\n**Steps:**\n1. Open planning page, watch SSE events in DevTools\n2. Create 10 beads rapidly:\n   ```bash\n   for i in {1..10}; do bd create \"Rapid \" -t task -p 3 \u0026 done; wait\n   ```\n3. Count SSE 'update' events received\n\n**Expected:** Significantly fewer than 10 events (debouncing works), all beads appear.\n\n---\n\n### 4. Long Session Stability (10+ minutes)\n\n**Steps:**\n1. Open planning page, note time\n2. Every 2-3 minutes:\n   - Create bead: `bd create \"Test 22:03\" -t task -p 3`\n   - Verify update appears in ~1 second\n   - Check process count: `ps aux | grep \"bd activity\" | wc -l` (should be 1)\n\n**Expected:** SSE stays connected, updates work, exactly 1 process throughout.\n\n---\n\n## Acceptance Criteria\n- [ ] Bead CRUD appears in UI within 1 second\n- [ ] No zombie processes after disconnect\n- [ ] Rapid events are debounced\n- [ ] 10+ minute sessions remain stable\n- [ ] Server logs show `[beads-watch] Started bd activity` message","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T21:56:46.6745-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Implementation complete, manual testing deferred to user","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-zuw.9","title":"Manual testing: verify subprocess cleanup on disconnect","description":"## Task Overview\n\nVerify that the `bd activity` subprocess is properly terminated when the client disconnects, preventing zombie processes.\n\n## Background \u0026 Reasoning\n\nIf we spawn a subprocess for each SSE connection but do not clean it up, we will accumulate zombie `bd` processes. This is a resource leak that degrades system performance over time.\n\n## Test Procedure\n\n### Steps\n\n1. **Check Initial State**\n   ```bash\n   ps aux | grep \"bd activity\"\n   # Should show no processes (or only your manual testing)\n   ```\n\n2. **Open Planning Session**\n   - Navigate to a planning page for an issue\n   - Wait for SSE connection to establish\n\n3. **Verify Process Started**\n   ```bash\n   ps aux | grep \"bd activity\"\n   # Should show ONE bd activity process\n   ```\n\n4. **Close Browser Tab**\n   - Simply close the tab (do not refresh)\n\n5. **Verify Process Terminated**\n   ```bash\n   # Wait 2-3 seconds for cleanup\n   sleep 3\n   ps aux | grep \"bd activity\"\n   # Should show NO bd activity processes\n   ```\n\n### Additional Tests\n\n**Test Multiple Connections:**\n1. Open 3 browser tabs to the same planning page\n2. Verify 3 `bd activity` processes exist\n3. Close all tabs\n4. Verify all processes are terminated\n\n**Test Refresh:**\n1. Open planning page\n2. Refresh the page\n3. Verify old process is terminated, new one started (should be 1 total)\n\n**Test Navigation:**\n1. Open planning page\n2. Navigate to a different page within the app\n3. Verify process is terminated\n\n### Expected Behavior\n- One `bd activity` process per active SSE connection\n- Process terminates within 1-2 seconds of disconnect\n- No accumulation of processes over time\n\n### What to Check If It Fails\n1. Check server logs for cleanup messages\n2. Verify abort handler is firing (add debug log)\n3. Check if SIGTERM is being sent\n4. Verify activityProc is not null when cleanup runs\n\n## Files Changed\nNone (testing only)\n\n## Acceptance Criteria\n- [ ] No zombie processes after tab close\n- [ ] No zombie processes after navigation away\n- [ ] No zombie processes after page refresh\n- [ ] Process count matches active connections\n- [ ] Server logs show cleanup messages","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-01T21:57:01.56519-06:00","created_by":"erikjohansson","updated_at":"2026-01-02T08:07:01.424865-06:00","close_reason":"Consolidated into maestro-zuw.8","deleted_at":"2026-01-02T08:07:01.424865-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
