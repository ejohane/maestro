{"id":"maestro-141","title":"Test issue from worktree","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-31T09:01:25.255884-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","close_reason":"Test complete","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-2e2","title":"New Issue Prompt - Simplify modal to single prompt input (GH #7)","description":"Simplify the new issue modal to a single prompt input. The system will:\n1. Create a GitHub issue programmatically with a placeholder\n2. Inject context into the OpenCode session instructing the agent to update the issue title and description\n3. Send the user's prompt to the agent\n\nSee GitHub issue #7 for full details.","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-31T09:06:34.674719-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-2e2.1","title":"Replace title input with prompt textarea in NewIssueDialog","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T09:06:34.732542-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-2e2.2","title":"Update API route to handle prompt-based issue creation","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T09:06:34.787328-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-2e2.3","title":"Add OpenCode session creation and context injection","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T09:06:34.841915-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-2e2.4","title":"Implement session storage linking issue to OpenCode session","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T09:06:34.89525-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-2e2.5","title":"Verify agent updates issue title AND description via gh issue edit","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T09:06:34.949505-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-2e2.6","title":"Test end-to-end flow: prompt → issue creation → agent update → navigation","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-31T09:06:35.003677-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:45:23.004683-06:00","deleted_at":"2025-12-31T09:45:23.004683-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ds3","title":"Issue #7: New Issue Prompt - Single-Prompt Issue Creation with AI-Generated Title/Description","description":"## Overview\n\nTransform the issue creation workflow from a traditional \"Title + Description\" form into a streamlined single-prompt experience where the user describes what they want, and an AI agent automatically generates a proper GitHub issue title and comprehensive description.\n\n## Background \u0026 Motivation\n\n### Current State\nThe existing `NewIssueDialog` component (`src/components/new-issue-dialog/NewIssueDialog.tsx`) requires users to manually enter an issue title. The backend creates an issue with an empty body. This creates friction because:\n1. Users have to think about proper issue formatting upfront\n2. The resulting issues often lack comprehensive descriptions\n3. There's no AI assistance in the issue creation process\n\n### Desired State\nUsers simply describe what they want to explore or build in natural language. The system:\n1. Creates a GitHub issue immediately (with placeholder content for instant feedback)\n2. Spawns an AI agent to explore the user's intent\n3. The agent updates the issue with a well-crafted title and detailed description\n4. The user sees live updates as the agent works\n\n### Why This Matters for Maestro\nMaestro's core philosophy is \"ideation-first\" (see SCOPE.md). This change aligns perfectly:\n- Reduces friction at the entry point of the ideation workflow\n- Demonstrates AI-assisted issue creation as a first-class feature\n- Sets up the pattern for AI agents to own and update GitHub issues\n- Creates a natural bridge from rough idea → formalized issue → planning → execution\n\n## Technical Approach\n\n### Data Flow\n```\nUser enters prompt → Frontend POSTs to /api/projects/[id]/issues\n                              ↓\nBackend creates GitHub issue with:\n  - Title: First ~80 chars of prompt (or \"New Issue\")\n  - Body: \"Generating description...\"\n                              ↓\nBackend creates OpenCode session\nBackend calls injectContext() with instructions\nBackend calls sendMessageWithBashAsync() with user's prompt\n                              ↓\nBackend returns issue number (fast response)\nFrontend navigates to /project/[id]/issue/[issueNumber]\n                              ↓\nAgent explores codebase based on prompt\nAgent runs: gh issue edit [number] --title \"...\" --body \"...\"\n                              ↓\nUser sees updated issue (via existing refresh mechanism)\n```\n\n### Key Design Decisions\n\n1. **Immediate Issue Creation**: Don't wait for AI to finish before creating the issue. Creates it with placeholder content so user has instant feedback and a stable URL to navigate to.\n\n2. **Async Agent Work**: Use `sendMessageWithBashAsync()` (already exists in opencode.ts) so the API returns quickly. The agent works in the background.\n\n3. **Bash-Only Tool Access**: Agent gets `bash: true, write: false, edit: false`. It can run `gh issue edit` but cannot modify project files. This is issue ideation, not implementation.\n\n4. **Session Persistence**: Save the session mapping so the issue page can show the conversation. Users can see the agent's reasoning about how it crafted the issue.\n\n5. **Title Truncation Strategy**: Use first 80 chars of prompt as initial title. Agent will craft a proper imperative-mood title. If prompt is too short, it becomes the title directly.\n\n## Acceptance Criteria\n\n- [ ] Modal shows single \"Prompt\" textarea instead of \"Title\" input\n- [ ] Prompt textarea has appropriate placeholder and minimum height\n- [ ] GitHub issue is created immediately with placeholder body\n- [ ] OpenCode session is created and linked to the issue\n- [ ] Agent receives context instructing it to update title AND description\n- [ ] Agent updates issue via `gh issue edit` with both `--title` and `--body`\n- [ ] User is navigated to issue page after creation\n- [ ] Session is saved so issue page shows the conversation\n- [ ] Error handling for gh CLI failures, OpenCode failures, etc.\n\n## Files Involved\n\n| File | Role |\n|------|------|\n| `src/components/new-issue-dialog/NewIssueDialog.tsx` | UI component - change from Input to Textarea |\n| `src/app/api/projects/[id]/issues/route.ts` | API handler - add session creation, context injection |\n| `src/lib/services/sessions.ts` | Session storage - already has saveSession() |\n| `src/lib/services/opencode.ts` | OpenCode client - already has required methods |\n\n## Dependencies\n\nThis epic depends on:\n- Existing OpenCode service methods (injectContext, sendMessageWithBashAsync)\n- Existing session storage service\n- gh CLI being configured on the user's machine\n\nThis epic enables future work:\n- Issue page showing the AI conversation alongside issue details\n- \"Regenerate description\" button on issue page\n- Multi-turn refinement of issue content","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-31T09:50:41.936982-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:50:41.936982-06:00"}
{"id":"maestro-ds3.1","title":"T1: Frontend - Replace title input with prompt textarea in NewIssueDialog","description":"## Task: Frontend UI Changes\n\nTransform the `NewIssueDialog` from a title-based input to a prompt-based textarea.\n\n### Current Implementation\n```tsx\nconst [title, setTitle] = useState(\"\");\n// ...\n\u003cLabel htmlFor=\"issue-title\"\u003eTitle\u003c/Label\u003e\n\u003cInput\n  id=\"issue-title\"\n  value={title}\n  onChange={(e) =\u003e setTitle(e.target.value)}\n  placeholder=\"What would you like to explore?\"\n  // ...\n/\u003e\n```\n\n### Required Changes\n\n1. **State Variable Rename**\n   - Change `title` → `prompt`\n   - Change `setTitle` → `setPrompt`\n\n2. **UI Component Swap**\n   - Replace `\u003cInput\u003e` with `\u003cTextarea\u003e` (already imported in shadcn/ui)\n   - Add `min-h-[100px]` for adequate vertical space\n   - Update `id` to `issue-prompt`\n\n3. **Label and Placeholder Updates**\n   - Label: \"Prompt\" or \"What do you want to build?\"\n   - Placeholder: \"Describe what you want to build or explore...\"\n\n4. **Request Body Change**\n   ```tsx\n   body: JSON.stringify({ \n     prompt: prompt.trim(),  // Changed from title\n     projectPath,\n   }),\n   ```\n\n5. **Button Text (Optional)**\n   - Consider changing \"Create Issue\" → \"Create\" or \"Start\" to be more action-oriented\n\n6. **Dialog Description Update**\n   - Update `\u003cDialogDescription\u003e` to reflect new flow:\n     \"Describe your idea and the agent will create a detailed GitHub issue.\"\n\n### Technical Notes\n- No new imports needed - `Textarea` should already be available from `@/components/ui/textarea`\n- Keep the form submission logic the same\n- Keep error handling the same (just different field name)\n\n### Acceptance Criteria\n- [ ] Textarea replaces Input\n- [ ] Minimum height of 100px\n- [ ] Appropriate placeholder text\n- [ ] Request body sends `prompt` instead of `title`\n- [ ] Dialog description updated to explain new flow","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-31T09:50:41.995449-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:50:57.427005-06:00","dependencies":[{"issue_id":"maestro-ds3.1","depends_on_id":"maestro-ds3","type":"parent-child","created_at":"2025-12-31T09:50:41.995989-06:00","created_by":"daemon"}]}
{"id":"maestro-ds3.2","title":"T2: Backend - Extract prompt and generate initial title in POST handler","description":"## Task: Backend Prompt Extraction and Initial Title Generation\n\nUpdate the POST handler to accept a `prompt` field and generate an initial issue title.\n\n### Current Implementation\n```typescript\nconst { title } = body;\nif (!title || typeof title !== \"string\") {\n  return NextResponse.json({ error: \"Title is required\" }, { status: 400 });\n}\nconst escapedTitle = title.replace(/\"/g, '\\\\\"');\nawait execAsync(`gh issue create --title \"${escapedTitle}\" --body \"\"`);\n```\n\n### Required Changes\n\n1. **Extract Prompt Instead of Title**\n   ```typescript\n   const { prompt } = body;\n   if (!prompt || typeof prompt !== \"string\") {\n     return NextResponse.json({ error: \"Prompt is required\" }, { status: 400 });\n   }\n   ```\n\n2. **Generate Initial Title from Prompt**\n   ```typescript\n   // Generate initial title: truncate at 80 chars or use full prompt if shorter\n   const initialTitle = prompt.length \u003e 80 \n     ? prompt.substring(0, 77).trim() + \"...\" \n     : prompt;\n   ```\n\n3. **Create Issue with Placeholder Body**\n   ```typescript\n   const escapedTitle = initialTitle.replace(/\"/g, '\\\\\"');\n   const { stdout: createStdout } = await execAsync(\n     `gh issue create --title \"${escapedTitle}\" --body \"Generating description...\"`,\n     { cwd }\n   );\n   ```\n\n### Design Decisions\n\n**Why 80 characters for title truncation?**\n- GitHub allows up to 256 chars but recommends keeping titles concise\n- 80 chars is roughly one line in most GitHub UI views\n- Ellipsis indicates the full content is being processed\n\n**Why \"Generating description...\" as placeholder?**\n- Signals to the user that work is in progress\n- If the agent fails, users can still edit the issue manually\n- Better than an empty body which might confuse users\n\n### Technical Notes\n- Title escaping is critical for shell safety\n- Consider edge cases: very short prompts, prompts with special characters\n- The `--body` flag should use a simple string, no need for multiline\n\n### Acceptance Criteria\n- [ ] Handler extracts `prompt` from request body\n- [ ] Validation returns 400 if prompt is missing/invalid\n- [ ] Initial title is generated (truncated at 80 chars)\n- [ ] Issue is created with \"Generating description...\" body\n- [ ] Special characters in prompt are properly escaped","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-31T09:50:42.052942-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:51:06.630136-06:00","dependencies":[{"issue_id":"maestro-ds3.2","depends_on_id":"maestro-ds3","type":"parent-child","created_at":"2025-12-31T09:50:42.053468-06:00","created_by":"daemon"},{"issue_id":"maestro-ds3.2","depends_on_id":"maestro-ds3.1","type":"blocks","created_at":"2025-12-31T09:52:20.88487-06:00","created_by":"daemon"}]}
{"id":"maestro-ds3.3","title":"T3: Backend - Create OpenCode session after issue creation","description":"## Task: Create OpenCode Session After Issue Creation\n\nAfter creating the GitHub issue, create an OpenCode session that will be used to generate the issue content.\n\n### Context\nThe OpenCode service already has the `createSession()` method we need:\n```typescript\nasync createSession(projectPath: string, title: string): Promise\u003c{ id: string }\u003e\n```\n\n### Required Changes\n\nAdd session creation after successfully parsing the issue number:\n\n```typescript\n// After extracting issueNumber from URL...\nconst issueNumber = urlMatch[1];\n\n// Import at top of file\nimport { openCodeService } from \"@/lib/services/opencode\";\n\n// Create OpenCode session for this issue\nconst session = await openCodeService.createSession(\n  cwd,\n  `Issue #${issueNumber} - Generation`\n);\n```\n\n### Design Decisions\n\n**Session Title Convention**\n- Format: `Issue #${issueNumber} - Generation`\n- Distinguishes from the discussion session that may be created later on the issue page\n- Clear indication of purpose when viewing session list\n\n**Error Handling Strategy**\n- If session creation fails, the issue is already created\n- We should log the error but still return the issue\n- The user can refresh the issue page to trigger a new session later\n\n### Technical Notes\n- The `cwd` variable (project.path) is already available in scope\n- Session creation is fast (just creates an ID)\n- No need to wait for any AI response yet\n\n### Acceptance Criteria\n- [ ] OpenCode service is imported\n- [ ] Session is created after issue creation succeeds\n- [ ] Session title includes issue number\n- [ ] Error in session creation doesn't fail the entire request","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-31T09:50:42.110527-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:51:14.105034-06:00","dependencies":[{"issue_id":"maestro-ds3.3","depends_on_id":"maestro-ds3","type":"parent-child","created_at":"2025-12-31T09:50:42.110979-06:00","created_by":"daemon"},{"issue_id":"maestro-ds3.3","depends_on_id":"maestro-ds3.2","type":"blocks","created_at":"2025-12-31T09:52:27.435176-06:00","created_by":"daemon"}]}
{"id":"maestro-ds3.4","title":"T4: Backend - Inject context with issue update instructions","description":"## Task: Inject Context with Issue Update Instructions\n\nInject system context into the session that instructs the agent on how to update the GitHub issue.\n\n### Context\nThe OpenCode service has `injectContext()` which adds context without triggering a response:\n```typescript\nasync injectContext(projectPath: string, sessionId: string, context: string): Promise\u003cvoid\u003e\n```\n\n### Required Implementation\n\n```typescript\nawait openCodeService.injectContext(cwd, session.id, `\nYou are helping create GitHub issue #${issueNumber} in this repository.\n\nThe user has described what they want to build or explore. Your job is to:\n1. Understand their intent by exploring the codebase if needed\n2. Craft a clear, concise issue TITLE (imperative mood, e.g., \"Add dark mode toggle to settings\")\n3. Write a comprehensive issue DESCRIPTION with proper markdown formatting\n\n## Description Structure\nInclude relevant sections based on the request:\n- **Summary**: 1-2 sentence overview\n- **Background/Motivation**: Why this matters (if applicable)\n- **Requirements/Goals**: What needs to be accomplished\n- **Technical Approach**: High-level implementation strategy (if technical)\n- **Acceptance Criteria**: Checklist of what \"done\" looks like\n- **Files/Areas Affected**: Which parts of codebase are involved (if known)\n\n## Important Instructions\n- Use \\`gh issue edit ${issueNumber} --title \"your title\" --body \"your markdown body\"\\`\n- The body should be valid markdown\n- Be thorough but concise - this issue should be actionable\n- If the request is vague, make reasonable assumptions and state them\n- DO NOT modify any code files - this is ideation only\n\n## Shell Escaping\nWhen using gh issue edit, ensure proper escaping:\n- Use single quotes around the body if it contains double quotes\n- Or escape double quotes with backslash\n- Newlines in body should work directly in the command\n`);\n```\n\n### Design Decisions\n\n**Why Imperative Mood for Titles?**\n- GitHub convention: \"Add feature\" not \"Adding feature\" or \"Feature added\"\n- Reads as a command, which is what issues represent\n\n**Why Detailed Section Structure?**\n- Provides consistent issue quality across the project\n- Helps agents create actionable, well-organized issues\n- Users know what to expect when viewing issues\n\n**Why Explicit Shell Escaping Instructions?**\n- Multi-line bodies with special characters can fail `gh` commands\n- Agent needs guidance on proper escaping\n- Prevents common failure modes\n\n### Technical Notes\n- `injectContext()` uses `noReply: true` and `synthetic: true`\n- This context becomes part of the conversation but doesn't trigger a response\n- Agent sees this when processing the user's actual prompt\n\n### Acceptance Criteria\n- [ ] Context is injected with clear instructions\n- [ ] Instructions specify how to use `gh issue edit`\n- [ ] Description structure guidance is provided\n- [ ] Shell escaping guidance is included\n- [ ] Context emphasizes no code modification","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-31T09:50:42.167859-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:51:29.005724-06:00","dependencies":[{"issue_id":"maestro-ds3.4","depends_on_id":"maestro-ds3","type":"parent-child","created_at":"2025-12-31T09:50:42.168292-06:00","created_by":"daemon"},{"issue_id":"maestro-ds3.4","depends_on_id":"maestro-ds3.3","type":"blocks","created_at":"2025-12-31T09:52:27.472803-06:00","created_by":"daemon"}]}
{"id":"maestro-ds3.5","title":"T5: Backend - Send user prompt via sendMessageWithBashAsync","description":"## Task: Send User Prompt via sendMessageWithBashAsync\n\nAfter injecting context, send the user's original prompt to trigger the agent to start working.\n\n### Context\nThe OpenCode service has `sendMessageWithBashAsync()` which is perfect for this use case:\n```typescript\nasync sendMessageWithBashAsync(\n  projectPath: string,\n  sessionId: string,\n  message: string\n): Promise\u003cvoid\u003e\n```\n\nThis method:\n- Uses `promptAsync` (fire-and-forget, returns immediately)\n- Enables `bash: true` (agent can run `gh issue edit`)\n- Disables `write: false, edit: false` (no code modifications)\n\n### Required Implementation\n\n```typescript\n// After injectContext...\n\n// Send the user's prompt - this triggers the agent to start working\nawait openCodeService.sendMessageWithBashAsync(cwd, session.id, prompt);\n```\n\n### What Happens Next (Not Our Concern Here)\n1. Agent receives the prompt\n2. Agent reads the injected context (instructions)\n3. Agent explores codebase if needed (`bash` commands like `ls`, `cat`, etc.)\n4. Agent crafts title and description\n5. Agent runs `gh issue edit ${issueNumber} --title \"...\" --body \"...\"`\n6. Issue is updated (user will see on refresh)\n\n### Design Decisions\n\n**Why Async?**\n- The API should return quickly (user sees issue page immediately)\n- Agent work happens in background\n- User can watch the conversation unfold on the issue page\n\n**Why sendMessageWithBashAsync Specifically?**\n- Matches our use case exactly: bash access, no file editing\n- Already exists and is tested\n- No need to create a new method\n\n**Order of Operations**\n1. Create issue (must succeed)\n2. Create session (should succeed, but handle failure gracefully)\n3. Inject context (should succeed)\n4. Send prompt (fire-and-forget)\n5. Return issue data to frontend\n\n### Technical Notes\n- `promptAsync` is truly async - it returns before agent processes\n- If this call fails, the session is still valid for later use\n- The prompt IS the user's intent, sent verbatim\n\n### Acceptance Criteria\n- [ ] User's prompt is sent via sendMessageWithBashAsync\n- [ ] Call happens after context injection\n- [ ] API returns immediately (doesn't wait for agent)\n- [ ] Errors don't fail the entire request","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-31T09:50:42.224498-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:51:39.509629-06:00","dependencies":[{"issue_id":"maestro-ds3.5","depends_on_id":"maestro-ds3","type":"parent-child","created_at":"2025-12-31T09:50:42.225-06:00","created_by":"daemon"},{"issue_id":"maestro-ds3.5","depends_on_id":"maestro-ds3.4","type":"blocks","created_at":"2025-12-31T09:52:27.507849-06:00","created_by":"daemon"}]}
{"id":"maestro-ds3.6","title":"T6: Backend - Save session mapping for issue page to display conversation","description":"## Task: Save Session Mapping for Issue Page\n\nPersist the session-to-issue mapping so the issue page can display the AI conversation.\n\n### Context\nThe session storage service already has `saveSession()`:\n```typescript\nasync saveSession(\n  projectId: string,\n  projectPath: string,\n  issueNumber: number,\n  sessionId: string\n): Promise\u003cSessionMapping\u003e\n```\n\nThis saves to `~/.maestro/sessions.json` and is used by the issue page to find existing sessions.\n\n### Required Implementation\n\n```typescript\n// Import at top\nimport { sessionStorage } from \"@/lib/services/sessions\";\n\n// After sending the prompt...\nawait sessionStorage.saveSession(\n  id,            // projectId from route params\n  cwd,           // project.path\n  parseInt(issueNumber),\n  session.id\n);\n```\n\n### Why This Matters\n\nWhen the user navigates to `/project/[id]/issue/[issueNumber]`:\n1. The issue page's `useChatSession` hook looks for an existing session\n2. It calls `sessionStorage.getSession(projectId, parseInt(issueNumber))`\n3. If found, it connects to that session and shows the conversation\n4. If not found, it creates a new session\n\nBy saving the session we created during issue creation:\n- User immediately sees the AI conversation that generated their issue\n- No duplicate sessions are created\n- The \"generation\" conversation is preserved for reference\n\n### Technical Notes\n- `issueNumber` is a string from URL parsing, needs `parseInt()`\n- `saveSession` handles both create and update\n- The session type defaults to 'discussion' which is what we want\n- This uses atomic file writes (temp file + rename)\n\n### Edge Cases\n- What if save fails? Log error, don't fail the request\n- The session is still valid, just won't be linked\n- User can still see the issue (just won't have pre-populated chat)\n\n### Acceptance Criteria\n- [ ] Session storage is imported\n- [ ] Session mapping is saved after prompt is sent\n- [ ] Uses correct types (parseInt for issueNumber)\n- [ ] Errors don't fail the request","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T09:50:42.281452-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:51:48.675769-06:00","dependencies":[{"issue_id":"maestro-ds3.6","depends_on_id":"maestro-ds3","type":"parent-child","created_at":"2025-12-31T09:50:42.281907-06:00","created_by":"daemon"},{"issue_id":"maestro-ds3.6","depends_on_id":"maestro-ds3.5","type":"blocks","created_at":"2025-12-31T09:52:27.543559-06:00","created_by":"daemon"}]}
{"id":"maestro-ds3.7","title":"T7: Error Handling - Add comprehensive error handling for OpenCode and gh CLI failures","description":"## Task: Comprehensive Error Handling\n\nAdd proper error handling for the new session-related operations without breaking the core issue creation flow.\n\n### Error Handling Philosophy\n\n**Tier 1 - Critical (Must Succeed)**\n- GitHub issue creation\n- If this fails, return error to user\n\n**Tier 2 - Important but Non-Blocking**\n- OpenCode session creation\n- Context injection\n- Prompt sending\n- Session storage\n- If these fail, log error and continue\n\n### Backend Error Handling\n\n```typescript\n// POST handler structure\n\ntry {\n  // 1. Create GitHub issue (CRITICAL)\n  // If this fails, throw and return error\n\n  const issueNumber = urlMatch[1];\n\n  // 2. AI enhancement (NON-BLOCKING)\n  try {\n    const session = await openCodeService.createSession(cwd, `Issue #${issueNumber} - Generation`);\n    \n    await openCodeService.injectContext(cwd, session.id, contextInstructions);\n    await openCodeService.sendMessageWithBashAsync(cwd, session.id, prompt);\n    await sessionStorage.saveSession(id, cwd, parseInt(issueNumber), session.id);\n  } catch (sessionError) {\n    // Log but don't fail the request\n    console.error(`Failed to set up AI session for issue #${issueNumber}:`, sessionError);\n    // Issue is created, user can still use it\n  }\n\n  // 3. Return success\n  return NextResponse.json(issue, { status: 201 });\n\n} catch (error) {\n  // Handle GitHub issue creation failures\n  // (existing error handling)\n}\n```\n\n### Frontend Error Handling\n\nThe frontend already has error handling that displays messages to users:\n```tsx\n} catch (err) {\n  setError(err instanceof Error ? err.message : \"Failed to create issue\");\n}\n```\n\nThis should continue to work - we just need to ensure the backend returns appropriate error messages.\n\n### Specific Error Cases\n\n1. **OpenCode not running**\n   - Session creation fails\n   - Log error, issue still created\n   - User can discuss on issue page (new session will be created)\n\n2. **Context injection fails**\n   - Rare, but possible\n   - Agent won't have instructions, but session is valid\n   - Issue is still created\n\n3. **promptAsync fails**\n   - Agent won't start working\n   - Session exists but idle\n   - Issue has placeholder content\n\n4. **Session storage fails**\n   - Session exists but not linked\n   - Issue page will create a new session\n   - Duplicate sessions, but not broken\n\n### Technical Notes\n- Use try-catch around the session block, not individual calls\n- Log with enough context to debug (issue number, project id)\n- Consider adding a `warning` field to response if AI setup failed\n\n### Acceptance Criteria\n- [ ] Critical path (issue creation) fails properly with user feedback\n- [ ] Non-critical path (session setup) doesn't block issue creation\n- [ ] Errors are logged with context\n- [ ] User-facing error messages are helpful","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T09:50:42.337918-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:52:01.948806-06:00","dependencies":[{"issue_id":"maestro-ds3.7","depends_on_id":"maestro-ds3","type":"parent-child","created_at":"2025-12-31T09:50:42.338406-06:00","created_by":"daemon"},{"issue_id":"maestro-ds3.7","depends_on_id":"maestro-ds3.5","type":"blocks","created_at":"2025-12-31T09:52:27.578637-06:00","created_by":"daemon"}]}
{"id":"maestro-ds3.8","title":"T8: Integration Testing - Verify end-to-end flow works correctly","description":"## Task: Integration Testing\n\nVerify the complete end-to-end flow works correctly in various scenarios.\n\n### Test Scenarios\n\n#### Happy Path\n1. Open project overview\n2. Click \"New Issue\" (or equivalent)\n3. Enter prompt: \"Add a dark mode toggle to the settings page\"\n4. Click Create\n5. Verify:\n   - Navigated to issue page immediately\n   - Issue exists in GitHub with placeholder body\n   - Chat panel shows AI conversation starting\n   - Agent eventually updates issue title and body\n   - Refreshing issue shows updated content\n\n#### Short Prompt\n1. Enter prompt: \"Fix bug\"\n2. Verify:\n   - Issue title is \"Fix bug\" (no truncation needed)\n   - Agent still generates comprehensive description\n\n#### Long Prompt\n1. Enter prompt with 200+ characters describing a complex feature\n2. Verify:\n   - Issue title is truncated to ~80 chars with ellipsis\n   - Full prompt visible in chat\n   - Agent understands full context\n\n#### Special Characters\n1. Enter prompt with quotes, newlines, backticks\n2. Verify:\n   - Issue is created without shell injection\n   - Agent handles escaping properly when updating\n\n#### OpenCode Not Running\n1. Stop OpenCode server\n2. Create issue\n3. Verify:\n   - Issue is still created in GitHub\n   - Error is logged (check console)\n   - User can still view issue\n   - Discussing on issue page creates new session\n\n#### Network Failure Mid-Request\n1. Simulate network issues\n2. Verify:\n   - Appropriate error message displayed\n   - User can retry\n   - No partial state left behind\n\n### Manual Verification Checklist\n- [ ] UI shows textarea instead of input\n- [ ] Placeholder text is appropriate\n- [ ] Create button is disabled when textarea is empty\n- [ ] Loading state shown during creation\n- [ ] Navigation to issue page works\n- [ ] Issue appears in GitHub (check github.com)\n- [ ] Chat shows agent's work\n- [ ] Issue is updated within reasonable time (~30-60 seconds)\n- [ ] Refreshing issue shows AI-generated content\n\n### Automated Testing (Future)\nConsider adding:\n- Unit tests for title truncation logic\n- Integration tests for API endpoint\n- E2E tests with Playwright/Cypress\n\n### Technical Notes\n- OpenCode needs to be running for full flow\n- gh CLI needs to be authenticated\n- May need to clean up test issues after testing\n\n### Acceptance Criteria\n- [ ] Happy path works end-to-end\n- [ ] Edge cases handled gracefully\n- [ ] Error scenarios don't leave broken state\n- [ ] User experience is smooth and intuitive","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-31T09:50:42.394029-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T09:52:13.361007-06:00","dependencies":[{"issue_id":"maestro-ds3.8","depends_on_id":"maestro-ds3","type":"parent-child","created_at":"2025-12-31T09:50:42.394508-06:00","created_by":"daemon"},{"issue_id":"maestro-ds3.8","depends_on_id":"maestro-ds3.7","type":"blocks","created_at":"2025-12-31T09:52:27.613521-06:00","created_by":"daemon"},{"issue_id":"maestro-ds3.8","depends_on_id":"maestro-ds3.6","type":"blocks","created_at":"2025-12-31T09:52:27.648444-06:00","created_by":"daemon"}]}
{"id":"maestro-ec5","title":"Responsive Design Implementation (GH Issue #5)","description":"## Overview\n\nMake the Maestro app fully responsive across mobile, tablet, and desktop breakpoints with a primary breakpoint at `lg:` (1024px).\n\n### Background \u0026 Strategic Rationale\n\nThis initiative transforms Maestro from a desktop-only application into a responsive, mobile-first experience. The goal is to maintain the rich desktop functionality while providing an excellent mobile/tablet experience.\n\n**Why lg: (1024px) as the primary breakpoint?**\n- Most tablets in landscape mode exceed 1024px, allowing them to use the \"desktop\" layout\n- Phones and portrait tablets (typically \u003c1024px) get the mobile-optimized layout\n- This aligns with common industry practice and shadcn/ui defaults\n- Simplifies decision-making: everything uses ONE breakpoint for responsive logic\n\n**Current State Analysis:**\n| Component | Current State | Mobile Ready? |\n|-----------|---------------|---------------|\n| Sidebar | Custom 306-line component, fixed 256px, no collapse | No |\n| Issue View | Split panels with resize, tabs exist but use md: | Partial |\n| Dashboard | 4-column kanban with horizontal scroll | No |\n| Solo Pages | Full-width chat layouts | Mostly OK |\n| Epic/Swarm Pages | Full-width with sections | Mostly OK |\n\n---\n\n## OPTIMIZED PARALLELIZATION STRATEGY\n\n### Wave 1: Parallel Prep (P0 tasks - can ALL run simultaneously)\n```\nec5.1 ─┬─ Audit md: breakpoints\nec5.2 ─┼─ Audit other pages (solo/epic/swarm/ideate)  \nec5.3 ─┴─ Backup sidebar.tsx\n```\n**All 3 tasks are independent - assign to 3 parallel workers**\n\n### Wave 2: Sidebar + Issue View + Dashboard Prep (can run in parallel after Wave 1)\n```\nec5.4 → ec5.5 → ec5.6 → ec5.7 → ec5.8 → ec5.9  (Sidebar chain - sequential)\n        ↓\nec5.15 → ec5.17                                  (Issue View - can run parallel to sidebar)\n        ↓\nec5.10 ─┬─ Install accordion\nec5.11 ─┴─ Create compact cards (PARALLEL - no dependency on accordion!)\n```\n\n### Wave 3: Dashboard + Phase 4 (after their dependencies)\n```\nec5.12 ─┬─ RecentChatsSection (needs ec5.11)\nec5.13 ─┴─ Accordion layout (needs ec5.10 + ec5.11)\n        ↓\nec5.14    Test transitions (needs ec5.12 + ec5.13)\n\nec5.18 ─┬─ Solo pages (needs ec5.2 + ec5.7)\nec5.19 ─┼─ Epic page (needs ec5.2 + ec5.7)\nec5.20 ─┼─ Swarm page (needs ec5.2 + ec5.7)  \nec5.21 ─┴─ Ideate page (needs ec5.2 + ec5.7)\n```\n**Phase 4 tasks (18-21) can run in parallel with each other!**\n\n### Wave 4: Final Testing\n```\nec5.22 → ec5.23 ─┬─ 320px testing\n         ec5.24 ─┴─ Touch targets (parallel)\n                 ↓\n         ec5.25    Final regression\n```\n\n### Optional (P3)\n```\nec5.16    Toggle-group upgrade (after ec5.15, purely aesthetic)\n```\n\n---\n\n## KEY INSIGHT: Maximum Parallelism\n\n**With 3 workers, optimal assignment:**\n\n| Time | Worker A | Worker B | Worker C |\n|------|----------|----------|----------|\n| T1 | ec5.1 (audit md:) | ec5.2 (audit pages) | ec5.3 (backup) |\n| T2 | ec5.4 (install sidebar) | ec5.10 (install accordion) | ec5.15 (issue breakpoints) |\n| T3 | ec5.5 (app-sidebar.tsx) | ec5.11 (compact cards) | ec5.17 (verify resize) |\n| T4 | ec5.6 (layout.tsx) | ec5.12 (RecentChats) | ec5.18 (solo pages) |\n| T5 | ec5.7 (SidebarTrigger) | ec5.13 (accordion layout) | ec5.19 (epic page) |\n| T6 | ec5.8 (setOpenMobile) | ec5.14 (test transitions) | ec5.20 (swarm page) |\n| T7 | ec5.9 (test sidebar) | ec5.21 (ideate page) | ec5.22 (cross-browser) |\n| T8 | ec5.23 (320px) | ec5.24 (touch targets) | ec5.25 (final) |\n\n---\n\n## Acceptance Criteria\n\n**Sidebar:**\n- Uses shadcn Sidebar with `collapsible=\"offcanvas\"` mode\n- SidebarTrigger (hamburger) visible below lg: breakpoint\n- Sidebar closes on navigation item click (mobile)\n- Project tree structure preserved (expand/collapse)\n- FolderBrowserModal accessible from sidebar\n- Keyboard shortcut (cmd+b) works on desktop\n\n**Dashboard:**\n- Mobile (\u003c1024px): Accordion by status + vertical chat list\n- Desktop (\u003e=1024px): Kanban + horizontal chat carousel\n- \"New Chat\" action accessible in both layouts\n- Issue counts shown in accordion headers\n\n**Issue View:**\n- Breakpoint aligned to lg: (1024px)\n- Tab/toggle switching works on mobile\n- Split view with resize on desktop\n- Unread indicator works when on details tab\n\n**General:**\n- All views functional at 320px width minimum\n- No unintentional horizontal scroll\n- Touch-friendly tap targets (min 44px)\n- Consistent lg: breakpoint usage across entire app\n- SidebarTrigger visible in all page headers on mobile\n\n---\n\n## Files Summary\n\n**New Files to Create:**\n- src/components/app-sidebar.tsx - Extracted sidebar content\n- src/components/compact-cards.tsx - Mobile-optimized card variants\n- src/components/ui/accordion.tsx - shadcn accordion\n- src/components/ui/toggle-group.tsx - shadcn toggle-group (optional)\n\n**Files to Modify:**\n- src/components/ui/sidebar.tsx - Replaced by shadcn\n- src/app/project/[id]/layout.tsx - SidebarProvider wrapper\n- src/app/project/[id]/page.tsx - Mobile accordion layout\n- src/app/project/[id]/issue/[issueNumber]/page.tsx - Breakpoint alignment\n\n**Files to Audit:**\n- src/app/project/[id]/solo/page.tsx\n- src/app/project/[id]/solo/[sessionId]/page.tsx\n- src/app/project/[id]/epic/[epicId]/page.tsx\n- src/app/project/[id]/swarm/[epicId]/page.tsx\n- src/app/project/[id]/ideate/page.tsx\n\n---\n\n## Risk Assessment\n\n**Low Risk:**\n- Issue view breakpoint changes (minimal changes, 6 search-replace operations)\n- Solo/Ideate page audits (likely minimal changes needed)\n\n**Medium Risk:**\n- Dashboard accordion implementation (new components, layout changes)\n- Epic/Swarm page audits (may need layout adjustments for stats grid)\n\n**Higher Risk:**\n- Sidebar migration (largest change, replaces 306-line custom component)\n- Potential for regression in project tree expand/collapse behavior\n- FolderBrowserModal integration needs careful testing\n\n---\n\n## Testing Strategy\n\n1. Test at multiple viewport widths: 320px, 375px, 768px, 1024px, 1440px\n2. Test on actual devices (not just browser DevTools)\n3. Verify keyboard shortcuts still work\n4. Test navigation flows on mobile (sidebar close behavior)\n5. Performance testing (no layout shifts, smooth transitions)","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-30T21:11:42.781774-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:57.165223-06:00","close_reason":"Completed","deleted_at":"2025-12-31T08:43:57.165223-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-ec5.1","title":"Phase 0.1: Audit and document current md: breakpoint usage across codebase","description":"## Objective\nSearch the entire codebase for existing responsive breakpoint usage, specifically `md:` classes that will need to change to `lg:`.\n\n## Background\nThe issue view already has mobile tabs implemented using `md:` (768px) breakpoint. For consistency across the app, we need to standardize on `lg:` (1024px). This audit identifies all locations that need updating.\n\n## KNOWN FINDINGS (from pre-review)\n\n### issue/[issueNumber]/page.tsx - CONFIRMED md: usage\nThe following `md:` breakpoints exist and need changing:\n- Line 272: `md:flex` on skeleton details panel\n- Line 377: `md:hidden` on mobile tabs container\n- Line 410: `md:flex` on details panel\n- Line 413: `\u003e= 768` in JS conditional\n- Line 418: `md:block` on resize handle\n- Line 490: `md:flex` on chat panel\n\n### Other files to verify have NO md: usage:\n- `src/components/ui/sidebar.tsx` - Custom sidebar, no breakpoints (verified)\n- `src/app/project/[id]/page.tsx` - Dashboard, no breakpoints (verified)\n- `src/app/project/[id]/solo/page.tsx` - No breakpoints (verified)\n- `src/app/project/[id]/solo/[sessionId]/page.tsx` - No breakpoints (verified)\n- `src/app/project/[id]/epic/[epicId]/page.tsx` - No breakpoints (verified)\n- `src/app/project/[id]/swarm/[epicId]/page.tsx` - No breakpoints (verified)\n- `src/app/project/[id]/ideate/page.tsx` - No breakpoints (verified)\n\n## Tasks\n1. Run grep search for `md:` patterns in src/ directory\n2. Confirm the findings above\n3. Check for any OTHER breakpoint patterns (sm:, xl:, 2xl:, etc.)\n4. Document any unexpected findings\n\n## Commands to Run\n```bash\n# Find all md: breakpoint usage\ngrep -rn \"md:\" src/\n\n# Find all breakpoint patterns\ngrep -rn \"sm:\\|md:\\|lg:\\|xl:\\|2xl:\" src/\n\n# Find JS breakpoint conditionals\ngrep -rn \"\u003e= 768\\|\u003e= 1024\\|\u003c 768\\|\u003c 1024\" src/\n```\n\n## Expected Output\nA checklist or document confirming:\n- File: `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n  - Line 272: `md:flex` - CHANGE TO lg:flex\n  - Line 377: `md:hidden` - CHANGE TO lg:hidden\n  - Line 410: `md:flex` - CHANGE TO lg:flex\n  - Line 413: `\u003e= 768` - CHANGE TO \u003e= 1024\n  - Line 418: `md:block` - CHANGE TO lg:block\n  - Line 490: `md:flex` - CHANGE TO lg:flex\n\n## Parallelization\nThis task can run IN PARALLEL with ec5.2 and ec5.3 - they are all independent P0 audit/prep tasks.\n\n## Files to Check\nAll files in src/app/ and src/components/\n\nDepends on:\n- maestro-ec5 (parent epic only)\n\nBlocks:\n- Nothing directly (informational task)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T21:11:42.838205-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Audit complete. Confirmed 6 locations in issue/[issueNumber]/page.tsx need md: to lg: changes. No unexpected findings.","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.10","title":"Phase 2.1: Install shadcn accordion component","description":"## Objective\nInstall the shadcn accordion component for use in the mobile dashboard layout.\n\n## Background\nOn mobile, the 4-column kanban board doesn't fit. Instead, we'll use an accordion where each status (Issues, Ready, Active, Completed) is a collapsible section.\n\n## Command\n```bash\npnpm dlx shadcn@latest add accordion\n```\n\n## Expected Output\nCreates `src/components/ui/accordion.tsx` with:\n- Accordion (root)\n- AccordionItem (each collapsible section)\n- AccordionTrigger (the clickable header)\n- AccordionContent (the collapsible body)\n\n## Usage Pattern\n```typescript\nimport { \n  Accordion, \n  AccordionItem, \n  AccordionTrigger, \n  AccordionContent \n} from \"@/components/ui/accordion\";\n\n\u003cAccordion type=\"single\" collapsible defaultValue=\"issues\"\u003e\n  \u003cAccordionItem value=\"issues\"\u003e\n    \u003cAccordionTrigger\u003e\n      \u003cCircleDot /\u003e Issues \u003cBadge\u003e{count}\u003c/Badge\u003e\n    \u003c/AccordionTrigger\u003e\n    \u003cAccordionContent\u003e\n      {/* Issue cards */}\n    \u003c/AccordionContent\u003e\n  \u003c/AccordionItem\u003e\n  {/* More items... */}\n\u003c/Accordion\u003e\n```\n\n## Props to Know\n- `type=\"single\"` - Only one section open at a time\n- `type=\"multiple\"` - Multiple sections can be open\n- `collapsible` - Allows closing all sections (with type=\"single\")\n- `defaultValue` - Which section is open by default\n\n## For Dashboard\nWe'll use `type=\"single\" collapsible defaultValue=\"issues\"`:\n- One section at a time (cleaner on mobile)\n- Can close all if desired\n- Issues section open by default\n\n## Verification\nAfter installation:\n1. Check file exists: `src/components/ui/accordion.tsx`\n2. No TypeScript errors\n3. Can import from the component\n\n## Files\n- Creates: `src/components/ui/accordion.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.332224-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.11","title":"Phase 2.2: Create compact card components for mobile (CompactIssueCard, CompactEpicCard, CompactSessionCard)","description":"## Objective\nCreate mobile-optimized card components for use in the dashboard accordion view.\n\n## Background\nThe existing card components (IssueCard, EpicCard, SwarmCard, etc.) are designed for the desktop kanban with fixed width columns. For the mobile accordion, we need more compact, full-width variants that:\n- Use horizontal space efficiently\n- Show essential info at a glance\n- Have clear tap targets\n- Link to the correct detail pages\n\n## Components to Create\n\n### CompactIssueCard\n```typescript\ninterface CompactIssueCardProps {\n  issue: GitHubIssue;\n  projectId: string;\n}\n\nfunction CompactIssueCard({ issue, projectId }: CompactIssueCardProps) {\n  return (\n    \u003cLink\n      href={`/project/${projectId}/issue/${issue.number}`}\n      className=\"flex items-center gap-3 p-3 rounded-md bg-card border border-border hover:bg-secondary/50 active:bg-secondary\"\n    \u003e\n      \u003cCircleDot className=\"h-4 w-4 text-[hsl(var(--success))] flex-shrink-0\" /\u003e\n      \u003cdiv className=\"flex-1 min-w-0\"\u003e\n        \u003cp className=\"text-sm font-medium truncate\"\u003e{issue.title}\u003c/p\u003e\n        \u003cp className=\"text-xs text-muted-foreground\"\u003e#{issue.number}\u003c/p\u003e\n      \u003c/div\u003e\n      \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n    \u003c/Link\u003e\n  );\n}\n```\n\n### CompactEpicCard\n```typescript\ninterface CompactEpicCardProps {\n  epic: Epic;\n  projectId: string;\n}\n\nfunction CompactEpicCard({ epic, projectId }: CompactEpicCardProps) {\n  const taskCount = epic.subtasks.length;\n  \n  return (\n    \u003cLink\n      href={`/project/${projectId}/epic/${epic.id}`}\n      className=\"flex items-center gap-3 p-3 rounded-md bg-card border border-border hover:bg-secondary/50 active:bg-secondary\"\n    \u003e\n      \u003cCircle className=\"h-4 w-4 text-[hsl(var(--info))] flex-shrink-0\" /\u003e\n      \u003cdiv className=\"flex-1 min-w-0\"\u003e\n        \u003cp className=\"text-sm font-medium truncate\"\u003e{epic.title}\u003c/p\u003e\n        \u003cp className=\"text-xs text-muted-foreground\"\u003e{taskCount} tasks\u003c/p\u003e\n      \u003c/div\u003e\n      \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n    \u003c/Link\u003e\n  );\n}\n```\n\n### CompactSwarmCard (Active items with progress)\n```typescript\nfunction CompactSwarmCard({ epic, projectId }: CompactEpicCardProps) {\n  const done = epic.subtasks.filter(t =\u003e t.status === \"done\").length;\n  const total = epic.subtasks.length;\n  const pct = total \u003e 0 ? Math.round((done / total) * 100) : 0;\n  \n  return (\n    \u003cLink\n      href={`/project/${projectId}/swarm/${epic.id}`}\n      className=\"flex items-center gap-3 p-3 rounded-md bg-card border border-border hover:bg-secondary/50 active:bg-secondary\"\n    \u003e\n      \u003cdiv className=\"relative flex-shrink-0\"\u003e\n        \u003cspan className=\"relative flex h-2 w-2\"\u003e\n          \u003cspan className=\"animate-ping absolute h-full w-full rounded-full bg-[hsl(var(--success))] opacity-75\" /\u003e\n          \u003cspan className=\"relative rounded-full h-2 w-2 bg-[hsl(var(--success))]\" /\u003e\n        \u003c/span\u003e\n      \u003c/div\u003e\n      \u003cdiv className=\"flex-1 min-w-0\"\u003e\n        \u003cp className=\"text-sm font-medium truncate\"\u003e{epic.title}\u003c/p\u003e\n        \u003cdiv className=\"flex items-center gap-2 mt-1\"\u003e\n          \u003cdiv className=\"flex-1 h-1 bg-secondary rounded-full\"\u003e\n            \u003cdiv \n              className=\"h-full bg-[hsl(var(--success))] rounded-full\"\n              style={{ width: `${pct}%` }}\n            /\u003e\n          \u003c/div\u003e\n          \u003cspan className=\"text-xs text-muted-foreground\"\u003e{pct}%\u003c/span\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\n      \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n    \u003c/Link\u003e\n  );\n}\n```\n\n### CompactSessionCard\n```typescript\nfunction CompactSessionCard({ session, projectId }: CompactSessionCardProps) {\n  return (\n    \u003cLink\n      href={`/project/${projectId}/solo/${session.id}`}\n      className=\"flex items-center gap-3 p-3 rounded-md bg-card border border-border hover:bg-secondary/50 active:bg-secondary\"\n    \u003e\n      \u003cMessageSquare className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n      \u003cdiv className=\"flex-1 min-w-0\"\u003e\n        \u003cp className=\"text-sm font-medium truncate\"\u003e{session.title}\u003c/p\u003e\n        \u003cp className=\"text-xs text-muted-foreground truncate\"\u003e{session.lastMessage}\u003c/p\u003e\n      \u003c/div\u003e\n      \u003cChevronRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" /\u003e\n    \u003c/Link\u003e\n  );\n}\n```\n\n## Important Notes\n- These components are INDEPENDENT of the accordion component\n- They can be developed in parallel with accordion installation\n- All components should have min-h-[44px] for touch-friendly tap targets\n\n## Files\n- Create: `src/components/compact-cards.tsx`\n\n## Dependencies\n**IMPORTANT CHANGE**: This task no longer depends on ec5.10 (accordion install). These are independent components that can be built in parallel.\n\nDependencies:\n- maestro-ec5 (parent epic only)\n\nBlocks:\n- maestro-ec5.12: Build responsive RecentChatsSection\n- maestro-ec5.13: Build mobile accordion layout","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.387403-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Created src/components/compact-cards.tsx with 4 components: CompactIssueCard, CompactEpicCard, CompactSwarmCard, CompactSessionCard. All touch-friendly with min-h-[44px].","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.12","title":"Phase 2.3: Build responsive RecentChatsSection with vertical list for mobile","description":"## Objective\nRefactor the Recent Chats section in the dashboard to have different layouts for mobile and desktop.\n\n## Current Implementation\n```typescript\n\u003cdiv className=\"flex gap-3 overflow-x-auto pb-2 -mx-6 px-6 scrollbar-thin\"\u003e\n  {/* New Chat Card */}\n  \u003cLink className=\"flex-shrink-0 w-48 h-24 ...\"\u003e\n    \u003cPlus /\u003e New Chat\n  \u003c/Link\u003e\n  {/* Session Cards - horizontal scroll */}\n  {mockSoloSessions.map(session =\u003e (\n    \u003cSessionCard key={session.id} ... /\u003e\n  ))}\n\u003c/div\u003e\n```\n\nThis horizontal scroll works on desktop but is awkward on mobile.\n\n## New Implementation\n\n### Extract to Component\n```typescript\nfunction RecentChatsSection({ sessions, projectId }) {\n  return (\n    \u003cdiv className=\"flex-shrink-0 border-b border-border\"\u003e\n      \u003cdiv className=\"px-4 lg:px-6 py-4\"\u003e\n        {/* Header */}\n        \u003cdiv className=\"flex items-center justify-between mb-3\"\u003e\n          \u003cdiv className=\"flex items-center gap-2\"\u003e\n            \u003cMessageSquare className=\"h-4 w-4 text-muted-foreground\" /\u003e\n            \u003cspan className=\"text-sm font-medium\"\u003eRecent Chats\u003c/span\u003e\n          \u003c/div\u003e\n          \u003cLink \n            href={`/project/${projectId}/solo`}\n            className=\"text-xs text-primary hover:underline\"\n          \u003e\n            View all\n          \u003c/Link\u003e\n        \u003c/div\u003e\n        \n        {/* Mobile: Vertical list */}\n        \u003cdiv className=\"lg:hidden space-y-2\"\u003e\n          {/* New Chat - full width */}\n          \u003cLink\n            href={`/project/${projectId}/solo`}\n            className=\"flex items-center justify-center gap-2 p-3 rounded-lg border border-dashed border-border hover:border-primary/50 text-muted-foreground hover:text-foreground\"\n          \u003e\n            \u003cPlus className=\"h-4 w-4\" /\u003e\n            \u003cspan className=\"text-sm font-medium\"\u003eNew Chat\u003c/span\u003e\n          \u003c/Link\u003e\n          \n          {/* Recent sessions - limit to 3 on mobile */}\n          {sessions.slice(0, 3).map(session =\u003e (\n            \u003cCompactSessionCard \n              key={session.id} \n              session={session} \n              projectId={projectId} \n            /\u003e\n          ))}\n        \u003c/div\u003e\n        \n        {/* Desktop: Horizontal scroll (existing) */}\n        \u003cdiv className=\"hidden lg:flex gap-3 overflow-x-auto pb-2 -mx-6 px-6 scrollbar-thin\"\u003e\n          \u003cLink className=\"flex-shrink-0 w-48 h-24 ...\"\u003e\n            \u003cPlus /\u003e New Chat\n          \u003c/Link\u003e\n          {sessions.map(session =\u003e (\n            \u003cSessionCard key={session.id} ... /\u003e\n          ))}\n        \u003c/div\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Key Differences\n\n| Aspect | Mobile | Desktop |\n|--------|--------|---------|\n| Layout | Vertical stack | Horizontal scroll |\n| Session limit | 3 (with \"View all\") | All sessions |\n| New Chat | Full width button | Fixed width card |\n| Padding | px-4 | px-6 |\n| Card style | CompactSessionCard | SessionCard |\n\n## Why These Choices?\n1. **Vertical on mobile** - More natural scrolling, easier to tap\n2. **Limit to 3** - Don't overwhelm mobile view, \"View all\" for more\n3. **Full-width New Chat** - Clear primary action\n4. **Different card styles** - Optimized for each layout\n\n## Dependencies\n- CompactSessionCard from Phase 2.2\n\n## Files\n- Modify: `src/app/project/[id]/page.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.442624-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.13","title":"Phase 2.4: Build mobile accordion layout for dashboard kanban columns","description":"## Objective\nReplace the horizontal kanban board with an accordion layout on mobile screens.\n\n## Current Implementation\n```typescript\n\u003cdiv className=\"flex-1 overflow-hidden p-6\"\u003e\n  \u003cdiv className=\"h-full flex gap-4 overflow-x-auto\"\u003e\n    \u003cKanbanColumn title=\"Issues\" ... /\u003e\n    \u003cKanbanColumn title=\"Ready\" ... /\u003e\n    \u003cKanbanColumn title=\"Active\" ... /\u003e\n    \u003cKanbanColumn title=\"Completed\" ... /\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n## New Implementation\n\n```typescript\n{/* Mobile: Accordion */}\n\u003cdiv className=\"lg:hidden flex-1 overflow-y-auto p-4\"\u003e\n  \u003cAccordion type=\"single\" collapsible defaultValue=\"issues\"\u003e\n    {/* Issues Section */}\n    \u003cAccordionItem value=\"issues\"\u003e\n      \u003cAccordionTrigger className=\"hover:no-underline\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cCircleDot className=\"h-4 w-4 text-[hsl(var(--orange))]\" /\u003e\n          \u003cspan className=\"font-medium\"\u003eIssues\u003c/span\u003e\n          \u003cBadge variant=\"secondary\" className=\"ml-auto\"\u003e\n            {issues.length}\n          \u003c/Badge\u003e\n        \u003c/div\u003e\n      \u003c/AccordionTrigger\u003e\n      \u003cAccordionContent\u003e\n        \u003cdiv className=\"space-y-2 pt-2\"\u003e\n          {issuesLoading ? (\n            \u003cdiv className=\"space-y-2\"\u003e\n              \u003cSkeleton className=\"h-14 w-full\" /\u003e\n              \u003cSkeleton className=\"h-14 w-full\" /\u003e\n            \u003c/div\u003e\n          ) : issues.length === 0 ? (\n            \u003cp className=\"text-sm text-muted-foreground py-4 text-center\"\u003e\n              No open issues\n            \u003c/p\u003e\n          ) : (\n            issues.map(issue =\u003e (\n              \u003cCompactIssueCard \n                key={issue.number} \n                issue={issue} \n                projectId={projectId} \n              /\u003e\n            ))\n          )}\n          {/* Add Issue Button */}\n          \u003cbutton\n            onClick={() =\u003e setIsNewIssueDialogOpen(true)}\n            className=\"w-full p-3 rounded-md border border-dashed border-border text-muted-foreground hover:text-foreground hover:border-primary/50 text-sm\"\n          \u003e\n            \u003cPlus className=\"h-4 w-4 inline mr-2\" /\u003e\n            New Issue\n          \u003c/button\u003e\n        \u003c/div\u003e\n      \u003c/AccordionContent\u003e\n    \u003c/AccordionItem\u003e\n    \n    {/* Ready Section */}\n    \u003cAccordionItem value=\"ready\"\u003e\n      \u003cAccordionTrigger className=\"hover:no-underline\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cCircle className=\"h-4 w-4 text-[hsl(var(--info))]\" /\u003e\n          \u003cspan className=\"font-medium\"\u003eReady\u003c/span\u003e\n          \u003cBadge variant=\"secondary\" className=\"ml-auto\"\u003e\n            {readyToSwarm.length}\n          \u003c/Badge\u003e\n        \u003c/div\u003e\n      \u003c/AccordionTrigger\u003e\n      \u003cAccordionContent\u003e\n        \u003cdiv className=\"space-y-2 pt-2\"\u003e\n          {readyToSwarm.length === 0 ? (\n            \u003cp className=\"text-sm text-muted-foreground py-4 text-center\"\u003e\n              No epics ready to swarm\n            \u003c/p\u003e\n          ) : (\n            readyToSwarm.map(epic =\u003e (\n              \u003cCompactEpicCard \n                key={epic.id} \n                epic={epic} \n                projectId={projectId} \n              /\u003e\n            ))\n          )}\n        \u003c/div\u003e\n      \u003c/AccordionContent\u003e\n    \u003c/AccordionItem\u003e\n    \n    {/* Active Section */}\n    \u003cAccordionItem value=\"active\"\u003e\n      \u003cAccordionTrigger className=\"hover:no-underline\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cZap className=\"h-4 w-4 text-[hsl(var(--success))]\" /\u003e\n          \u003cspan className=\"font-medium\"\u003eActive\u003c/span\u003e\n          \u003cBadge variant=\"secondary\" className=\"ml-auto\"\u003e\n            {activeSwarms.length}\n          \u003c/Badge\u003e\n        \u003c/div\u003e\n      \u003c/AccordionTrigger\u003e\n      \u003cAccordionContent\u003e\n        \u003cdiv className=\"space-y-2 pt-2\"\u003e\n          {activeSwarms.length === 0 ? (\n            \u003cp className=\"text-sm text-muted-foreground py-4 text-center\"\u003e\n              No active swarms\n            \u003c/p\u003e\n          ) : (\n            activeSwarms.map(epic =\u003e (\n              \u003cCompactSwarmCard \n                key={epic.id} \n                epic={epic} \n                projectId={projectId} \n              /\u003e\n            ))\n          )}\n        \u003c/div\u003e\n      \u003c/AccordionContent\u003e\n    \u003c/AccordionItem\u003e\n    \n    {/* Completed Section */}\n    \u003cAccordionItem value=\"completed\"\u003e\n      \u003cAccordionTrigger className=\"hover:no-underline\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cCheckCircle className=\"h-4 w-4 text-muted-foreground\" /\u003e\n          \u003cspan className=\"font-medium\"\u003eCompleted\u003c/span\u003e\n          \u003cBadge variant=\"secondary\" className=\"ml-auto\"\u003e\n            {completed.length}\n          \u003c/Badge\u003e\n        \u003c/div\u003e\n      \u003c/AccordionTrigger\u003e\n      \u003cAccordionContent\u003e\n        \u003cdiv className=\"space-y-2 pt-2\"\u003e\n          {completed.length === 0 ? (\n            \u003cp className=\"text-sm text-muted-foreground py-4 text-center\"\u003e\n              No completed items\n            \u003c/p\u003e\n          ) : (\n            completed.map(epic =\u003e (\n              \u003cCompactEpicCard \n                key={epic.id} \n                epic={epic} \n                projectId={projectId} \n              /\u003e\n            ))\n          )}\n        \u003c/div\u003e\n      \u003c/AccordionContent\u003e\n    \u003c/AccordionItem\u003e\n  \u003c/Accordion\u003e\n\u003c/div\u003e\n\n{/* Desktop: Kanban (existing - now wrapped with hidden lg:block) */}\n\u003cdiv className=\"hidden lg:block flex-1 overflow-hidden p-6\"\u003e\n  \u003cdiv className=\"h-full flex gap-4 overflow-x-auto\"\u003e\n    {/* Existing kanban code unchanged */}\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n## Key Features\n1. **Single open section** - `type=\"single\"` keeps UI clean\n2. **Collapsible** - User can close all sections\n3. **Default open** - Issues section open by default\n4. **Count badges** - Each header shows item count\n5. **Empty states** - Helpful messages when sections are empty\n6. **Add Issue button** - Inside Issues accordion\n\n## Dependencies\n- Accordion component from Phase 2.1\n- CompactIssueCard, CompactEpicCard, CompactSwarmCard from Phase 2.2\n\n## Files\n- Modify: `src/app/project/[id]/page.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.497808-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.14","title":"Phase 2.5: Ensure desktop kanban layout unchanged and test layout transitions","description":"## Objective\nVerify that the desktop kanban layout remains unchanged and test smooth transitions between mobile and desktop layouts.\n\n## Desktop Verification Checklist\n\n### Visual Consistency\n- [ ] Kanban columns maintain w-72 (288px) width\n- [ ] 4 columns display: Issues, Ready, Active, Completed\n- [ ] Horizontal scroll works when columns exceed viewport\n- [ ] Column headers have correct icons and colors\n- [ ] Column accent lines at bottom display correctly\n- [ ] \"+\" buttons visible on columns with add actions\n\n### Functionality\n- [ ] Issue cards link to issue view\n- [ ] Epic cards link to epic view\n- [ ] Swarm cards link to swarm view (with progress bars)\n- [ ] Completed cards link to epic view (with opacity)\n- [ ] \"Add Issue\" button opens NewIssueDialog\n- [ ] Loading skeletons display while data fetches\n\n### Data Display\n- [ ] Issue counts match actual issue count\n- [ ] Epic categorization correct (ready vs active vs completed)\n- [ ] Swarm progress percentages accurate\n- [ ] Labels display on issue cards\n\n## Transition Testing\n\n### Resize from Mobile to Desktop\n1. Start at 320px width (mobile)\n2. Slowly resize to 1024px\n3. At exactly 1024px:\n   - [ ] Accordion hides\n   - [ ] Kanban appears\n   - [ ] No layout jump or flash\n   - [ ] Content doesn't disappear momentarily\n\n### Resize from Desktop to Mobile\n1. Start at 1440px width (desktop)\n2. Slowly resize to below 1024px\n3. At exactly 1023px:\n   - [ ] Kanban hides\n   - [ ] Accordion appears\n   - [ ] Default accordion section is open\n   - [ ] No layout jump or flash\n\n### Rapid Resize Test\n- [ ] Rapidly resize back and forth across 1024px breakpoint\n- [ ] No visual glitches or broken state\n- [ ] No console errors\n\n## Performance Checks\n- [ ] No layout shift (CLS) during transitions\n- [ ] Cards don't re-render unnecessarily\n- [ ] Scroll position doesn't jump\n\n## Browser Compatibility\nTest in:\n- [ ] Chrome\n- [ ] Firefox\n- [ ] Safari\n- [ ] Edge\n\n## Files\n- src/app/project/[id]/page.tsx","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.553947-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.15","title":"Phase 3.1: Change issue view breakpoint from md: to lg: throughout file","description":"## Objective\nUpdate all responsive breakpoints in the issue view from `md:` (768px) to `lg:` (1024px) for consistency with the rest of the app.\n\n## Background\nThe issue view already has functioning mobile tabs and panel switching, but it uses `md:` breakpoint (768px). For consistency, we need to change to `lg:` (1024px).\n\n## VERIFIED Changes Required (from actual code review)\n\n### Line 272: Skeleton details panel visibility\n```diff\n- \u003cdiv className=\"hidden md:flex flex-col w-[400px] border-r ...\"\u003e\n+ \u003cdiv className=\"hidden lg:flex flex-col w-[400px] border-r ...\"\u003e\n```\n\n### Line 377: Mobile tabs container\n```diff\n- \u003cdiv className=\"flex border-t border-border md:hidden\"\u003e\n+ \u003cdiv className=\"flex border-t border-border lg:hidden\"\u003e\n```\n\n### Lines 410-412: Details panel visibility\n```diff\n  \u003cdiv\n-   className={`${activeTab === \"details\" ? \"flex\" : \"hidden\"} md:flex flex-col w-full ...`}\n+   className={`${activeTab === \"details\" ? \"flex\" : \"hidden\"} lg:flex flex-col w-full ...`}\n```\n\n### Line 413: Panel width conditional\n```diff\n-   style={{ width: typeof window !== \"undefined\" \u0026\u0026 window.innerWidth \u003e= 768 ? panelWidth : undefined }}\n+   style={{ width: typeof window !== \"undefined\" \u0026\u0026 window.innerWidth \u003e= 1024 ? panelWidth : undefined }}\n```\n\n### Lines 417-418: Resize handle visibility\n```diff\n  \u003cdiv \n-   className={cn(\"... hidden md:block\", ...)}\n+   className={cn(\"... hidden lg:block\", ...)}\n```\n\n### Lines 487-490: Chat panel visibility\n```diff\n  \u003cdiv\n-   className={`${activeTab === \"chat\" ? \"flex\" : \"hidden\"} md:flex flex-col ...`}\n+   className={`${activeTab === \"chat\" ? \"flex\" : \"hidden\"} lg:flex flex-col ...`}\n```\n\n## Search \u0026 Replace Patterns\nYou can use these patterns:\n- `md:hidden` → `lg:hidden` (2 occurrences)\n- `md:flex` → `lg:flex` (3 occurrences)\n- `md:block` → `lg:block` (1 occurrence)\n- `\u003e= 768` → `\u003e= 1024` (1 occurrence)\n\n## Testing After Changes\n- [ ] At 1023px: Mobile layout (tabs visible, single panel)\n- [ ] At 1024px: Desktop layout (split view, no tabs)\n- [ ] Tab switching works on mobile\n- [ ] Panel resize works on desktop\n- [ ] Unread indicator works when on details tab\n\n## Why This Matters\nUsers on tablets (768-1024px) will now get the mobile experience, which is actually better for those screen sizes than trying to show split panels.\n\n## PARALLELIZATION NOTE\nThis task has NO dependency on Phase 2 (Dashboard accordion work). It can be done in parallel with ec5.10, ec5.11, ec5.12, ec5.13, ec5.14.\n\n## Files\n- Modify: `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\nDependencies:\n- maestro-ec5 (parent epic only)\n\nBlocks:\n- maestro-ec5.17: Verify resize handle hidden on mobile\n- maestro-ec5.16: (Optional) Toggle-group upgrade","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.608624-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"All 6 breakpoint changes completed: md:flex to lg:flex, md:hidden to lg:hidden, md:block to lg:block, and \u003e= 768 to \u003e= 1024.","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.16","title":"Phase 3.2: (Optional) Install toggle-group and upgrade mobile tab buttons to ToggleGroup","description":"## Objective\n(OPTIONAL) Replace the plain tab buttons with a polished ToggleGroup component for iOS-style segmented control appearance.\n\n## Background\nThe current mobile tabs work fine but use plain `\u003cbutton\u003e` elements with basic styling. Upgrading to ToggleGroup provides:\n- More polished visual appearance\n- Better touch feedback\n- Accessibility improvements (proper ARIA)\n- Consistent with shadcn design language\n\n## Installation\n```bash\npnpm dlx shadcn@latest add toggle-group\n```\n\n## Current Implementation (lines 377-403)\n```typescript\n\u003cdiv className=\"flex border-t border-border lg:hidden\"\u003e\n  \u003cbutton\n    onClick={() =\u003e handleTabChange(\"details\")}\n    className={cn(\n      \"flex-1 py-2 text-xs font-medium transition-colors\",\n      activeTab === \"details\"\n        ? \"text-foreground border-b-2 border-primary\"\n        : \"text-muted-foreground\"\n    )}\n  \u003e\n    Details\n  \u003c/button\u003e\n  \u003cbutton\n    onClick={() =\u003e handleTabChange(\"chat\")}\n    className={cn(\n      \"flex-1 py-2 text-xs font-medium transition-colors relative\",\n      activeTab === \"chat\"\n        ? \"text-foreground border-b-2 border-primary\"\n        : \"text-muted-foreground\"\n    )}\n  \u003e\n    Chat\n    {hasUnread \u0026\u0026 (\n      \u003cspan className=\"absolute top-1 right-1/4 h-2 w-2 bg-destructive rounded-full animate-pulse\" /\u003e\n    )}\n  \u003c/button\u003e\n\u003c/div\u003e\n```\n\n## New Implementation\n```typescript\nimport { ToggleGroup, ToggleGroupItem } from \"@/components/ui/toggle-group\";\nimport { FileText, MessageSquare } from \"lucide-react\";\n\n{/* Mobile toggle - in header below title */}\n\u003cdiv className=\"lg:hidden flex items-center justify-center py-2 border-t border-border\"\u003e\n  \u003cToggleGroup \n    type=\"single\" \n    value={activeTab} \n    onValueChange={(v) =\u003e v \u0026\u0026 handleTabChange(v as \"details\" | \"chat\")}\n    className=\"bg-secondary/50 rounded-lg p-1\"\n  \u003e\n    \u003cToggleGroupItem \n      value=\"details\" \n      aria-label=\"View issue details\"\n      className=\"data-[state=on]:bg-background rounded-md px-3\"\n    \u003e\n      \u003cFileText className=\"h-4 w-4 mr-2\" /\u003e\n      Details\n    \u003c/ToggleGroupItem\u003e\n    \u003cToggleGroupItem \n      value=\"chat\" \n      aria-label=\"View chat\"\n      className=\"data-[state=on]:bg-background rounded-md px-3 relative\"\n    \u003e\n      \u003cMessageSquare className=\"h-4 w-4 mr-2\" /\u003e\n      Chat\n      {hasUnread \u0026\u0026 (\n        \u003cspan className=\"absolute -top-1 -right-1 h-2 w-2 bg-destructive rounded-full\" /\u003e\n      )}\n    \u003c/ToggleGroupItem\u003e\n  \u003c/ToggleGroup\u003e\n\u003c/div\u003e\n```\n\n## Visual Comparison\n\n| Aspect | Current | With ToggleGroup |\n|--------|---------|------------------|\n| Style | Underline tabs | Pill/segment control |\n| Icons | None | FileText, MessageSquare |\n| Active state | Border-bottom | Background change |\n| Touch feedback | Color only | Background + subtle animation |\n\n## Decision Criteria\nImplement if:\n- Team values visual polish\n- Time permits after core functionality\n- Want consistent shadcn styling\n\nSkip if:\n- Time constrained\n- Current tabs are acceptable\n- Want to minimize changes\n\n## Priority\nThis is marked P3 (backlog) because it's purely aesthetic. The functional behavior is identical.\n\n## Files\n- Optional create: `src/components/ui/toggle-group.tsx`\n- Optional modify: `src/app/project/[id]/issue/[issueNumber]/page.tsx`","status":"tombstone","priority":3,"issue_type":"task","created_at":"2025-12-30T21:11:43.665066-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.17","title":"Phase 3.3: Verify resize handle hidden on mobile and panel behavior correct","description":"## Objective\nVerify that the panel resize handle is hidden on mobile and that panel width behavior works correctly.\n\n## Current Implementation\nThe resize handle (line 417-419):\n```typescript\n\u003cdiv \n  className={cn(\n    \"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize transition-colors z-10 hidden md:block\",\n    isDragging ? \"bg-primary\" : \"hover:bg-primary/30\"\n  )}\n  onMouseDown={handleMouseDown}\n/\u003e\n```\n\n## Changes Needed\nAfter Phase 3.1, this will be `lg:block` instead of `md:block`.\n\n## Testing Checklist\n\n### Mobile (\u003c 1024px)\n- [ ] Resize handle is NOT visible\n- [ ] Cannot drag to resize panels\n- [ ] Tab switching controls which panel is visible\n- [ ] Panels take full width when active\n\n### Desktop (\u003e= 1024px)\n- [ ] Resize handle IS visible on hover (subtle line)\n- [ ] Cursor changes to `col-resize` when hovering handle\n- [ ] Dragging handle resizes left panel\n- [ ] Minimum width enforced (200px per code)\n- [ ] Maximum width enforced (50% of viewport per code)\n- [ ] Width persists in localStorage (`issue-panel-width`)\n- [ ] Width restored on page reload\n\n### Edge Cases\n- [ ] Resize to exactly 1024px - handle should appear\n- [ ] Resize to 1023px - handle should disappear\n- [ ] Start dragging, then resize window to mobile - should handle gracefully\n- [ ] Very narrow desktop (1024px) - resize should still work within limits\n\n## Code Review Points\n\n### Width Calculation (line 413)\n```typescript\nstyle={{ width: typeof window !== \"undefined\" \u0026\u0026 window.innerWidth \u003e= 1024 ? panelWidth : undefined }}\n```\nThis ensures:\n- On mobile: no inline width style (panel uses flex/full width)\n- On desktop: uses panelWidth from state\n\n### Drag Constraints (line 210)\n```typescript\nconst newWidth = Math.max(200, Math.min(e.clientX, window.innerWidth * 0.5))\n```\nThis ensures:\n- Minimum 200px width\n- Maximum 50% of viewport\n- Responsive to current viewport size\n\n## Potential Issues to Watch\n1. **SSR hydration**: `typeof window !== \"undefined\"` check is critical\n2. **Stale state**: If window resizes while dragging, constraints use current size\n3. **Touch devices**: Mouse events only - touch resize not implemented (acceptable)\n\n## Files\n- Verify: `src/app/project/[id]/issue/[issueNumber]/page.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.723036-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.18","title":"Phase 4.1: Apply responsive fixes to solo pages based on audit findings","description":"## Objective\nApply responsive fixes to solo pages based on Phase 0.2 audit findings.\n\n## SPECIFIC FIX REQUIRED\n\n### SidebarTrigger - Header\nFor BOTH `solo/page.tsx` (line 50) AND `solo/[sessionId]/page.tsx` (line 57):\n\nAfter the ChevronLeft Link, add:\n```tsx\n\u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n```\n\n### Example (solo/page.tsx lines 49-52):\n```tsx\n// Before\n\u003cLink href={`/project/${project.id}`} className=\"h-7 w-7 rounded flex items-center justify-center hover:bg-secondary\"\u003e\n  \u003cChevronLeft className=\"h-4 w-4\" /\u003e\n\u003c/Link\u003e\n\n// After\n\u003cLink href={`/project/${project.id}`} className=\"h-7 w-7 rounded flex items-center justify-center hover:bg-secondary\"\u003e\n  \u003cChevronLeft className=\"h-4 w-4\" /\u003e\n\u003c/Link\u003e\n\u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n```\n\n## NO OTHER FIXES NEEDED\nThe solo pages are already well-designed for mobile:\n- `max-w-3xl mx-auto` centers content\n- `max-w-[85%]` on message bubbles prevents overflow\n- Input area with `flex gap-2` works on mobile\n\n## Testing Checklist\n- [ ] SidebarTrigger visible on mobile (both pages)\n- [ ] Messages area scrolls properly\n- [ ] Input area usable at 320px\n- [ ] Empty state looks good on mobile\n- [ ] Back button still works\n\n## Files\n- Modify: `src/app/project/[id]/solo/page.tsx`\n- Modify: `src/app/project/[id]/solo/[sessionId]/page.tsx`\n\n## Dependencies\n- ec5.7: SidebarTrigger added to pages (provides pattern to follow)\n\n## Parallelization\nCan run in parallel with ec5.19, ec5.20, ec5.21","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.780722-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.19","title":"Phase 4.2: Apply responsive fixes to epic page based on audit findings","description":"## Objective\nApply responsive fixes to the epic (planning) page based on Phase 0.2 audit findings.\n\n## SPECIFIC FIX REQUIRED\n\n### SidebarTrigger - Header (Line 47)\nAfter the ChevronLeft Link, add:\n```tsx\n\u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n```\n\n## NO OTHER FIXES NEEDED\nThe epic page is already well-designed for mobile:\n- `max-w-3xl mx-auto` centers content\n- File badges use `flex-wrap` - handles overflow correctly\n- Bottom actions use `w-full` button - already mobile-friendly\n- Input area with `flex gap-2` works on mobile\n\n## Testing Checklist\n- [ ] SidebarTrigger visible on mobile\n- [ ] Subtask list scrolls properly\n- [ ] File badges wrap correctly (don't overflow)\n- [ ] Bottom actions accessible\n- [ ] Launch/View Swarm button is full-width and tappable\n- [ ] Chat input usable\n\n## Files\n- Modify: `src/app/project/[id]/epic/[epicId]/page.tsx`\n\n## Dependencies\n- ec5.7: SidebarTrigger added to pages (provides pattern to follow)\n\n## Parallelization\nCan run in parallel with ec5.18, ec5.20, ec5.21","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.83673-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.2","title":"Phase 0.2: Audit solo, epic, swarm, and ideate pages for responsive needs","description":"## Objective\nAudit the solo, epic, swarm, and ideate pages to determine what responsive changes (if any) are needed.\n\n## PRE-AUDIT FINDINGS (from code review)\n\n### Solo Pages (solo/page.tsx, solo/[sessionId]/page.tsx) - 117 \u0026 111 lines\n**Current Layout:**\n- Full-height flex column with header, messages, input\n- Messages use `max-w-[85%]` for bubbles - GOOD\n- Content uses `max-w-3xl mx-auto` - GOOD\n- No explicit breakpoints used\n\n**Issues Found:**\n1. **NO SidebarTrigger** - Must be added (handled by ec5.7)\n2. Input area uses `flex gap-2` - adequate for mobile\n3. `px-4` padding is fine for mobile\n\n**Verdict: MOSTLY OK** - Only needs SidebarTrigger\n\n---\n\n### Epic Page (epic/[epicId]/page.tsx) - 177 lines\n**Current Layout:**\n- Full-height flex with header, scrollable content, bottom actions\n- Content uses `max-w-3xl mx-auto` - GOOD\n- Bottom actions use full-width button - GOOD for mobile\n\n**Issues Found:**\n1. **NO SidebarTrigger** - Must be added\n2. File badges use `flex-wrap` - GOOD, already handles overflow\n3. Bottom input + button layout is fine\n\n**Verdict: MOSTLY OK** - Only needs SidebarTrigger\n\n---\n\n### Swarm Page (swarm/[epicId]/page.tsx) - 288 lines\n**Current Layout:**\n- Full-height with header, stats bar, scrollable content\n- Content uses `max-w-3xl mx-auto` - GOOD\n\n**Issues Found:**\n1. **NO SidebarTrigger** - Must be added\n2. **Stats grid uses `grid-cols-4`** - PROBLEMATIC at 320px!\n   - Line 60: `\u003cdiv className=\"grid grid-cols-4 gap-4 text-center mb-3\"\u003e`\n   - At 320px: 4 columns = 80px per column = too cramped\n   - **FIX NEEDED:** Change to `grid grid-cols-2 lg:grid-cols-4`\n3. Agent cards use `w-20` for progress bar - might be tight but acceptable\n\n**Verdict: NEEDS RESPONSIVE FIX** for stats grid\n\n---\n\n### Ideate Page (ideate/page.tsx) - 120 lines\n**Current Layout:**\n- Full-height flex with header, messages, CTA section, input\n- Uses `max-w-3xl mx-auto` - GOOD\n- Messages use `max-w-[85%]` - GOOD\n\n**Issues Found:**\n1. **NO SidebarTrigger** - Must be added\n2. **CTA section uses `flex items-center justify-between`** (line 87)\n   - On narrow screens, text and button compete for space\n   - **FIX NEEDED:** Stack vertically on mobile\n   - Change to: `flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between`\n   - Button should be: `w-full lg:w-auto`\n\n**Verdict: NEEDS MINOR RESPONSIVE FIX** for CTA section\n\n---\n\n## Summary Table\n\n| Page | SidebarTrigger Needed | Other Fixes Needed | Priority |\n|------|----------------------|-------------------|----------|\n| solo/page.tsx | Yes | None | Low |\n| solo/[sessionId]/page.tsx | Yes | None | Low |\n| epic/[epicId]/page.tsx | Yes | None | Low |\n| swarm/[epicId]/page.tsx | Yes | Stats grid (cols-4 → cols-2 lg:cols-4) | Medium |\n| ideate/page.tsx | Yes | CTA section stacking | Low |\n\n## Parallelization\nThis task can run IN PARALLEL with ec5.1 and ec5.3 - they are all independent P0 audit/prep tasks.\n\n## Deliverable\nThis bead now contains the audit findings. No separate document needed.\n\nDepends on:\n- maestro-ec5 (parent epic only)\n\nBlocks:\n- ec5.18: Apply responsive fixes to solo pages\n- ec5.19: Apply responsive fixes to epic page\n- ec5.20: Apply responsive fixes to swarm page\n- ec5.21: Apply responsive fixes to ideate page","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T21:11:42.896669-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Audit complete. Confirmed swarm page needs stats grid fix (grid-cols-4 -\u003e grid-cols-2 lg:grid-cols-4) and ideate page needs CTA section stacking on mobile.","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.20","title":"Phase 4.3: Apply responsive fixes to swarm page based on audit findings","description":"## Objective\nApply responsive fixes to the swarm page based on Phase 0.2 audit findings.\n\n## SPECIFIC FIX REQUIRED\n\n### Stats Grid - Line 60\n**Current:**\n```tsx\n\u003cdiv className=\"grid grid-cols-4 gap-4 text-center mb-3\"\u003e\n```\n\n**Change to:**\n```tsx\n\u003cdiv className=\"grid grid-cols-2 gap-2 lg:grid-cols-4 lg:gap-4 text-center mb-3\"\u003e\n```\n\nThis gives:\n- Mobile (2x2 grid):\n  ```\n  [Progress: 45%] [Completed: 3]\n  [Running: 2   ] [Blocked: 1  ]\n  ```\n- Desktop (1x4 grid):\n  ```\n  [Progress: 45%] [Completed: 3] [Running: 2] [Blocked: 1]\n  ```\n\n### SidebarTrigger - Header (Line 39-41)\nAfter the ChevronLeft Link, add:\n```tsx\n\u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n```\n\n## Additional Considerations (Optional)\n- Agent card progress bars use `w-20` (80px) - acceptable on mobile but could use `w-16 lg:w-20` if needed\n- File paths in File Locks already use `truncate` - GOOD\n\n## Testing Checklist\n- [ ] Stats grid readable at 320px (2x2 layout)\n- [ ] Stats grid shows 1x4 at 1024px+\n- [ ] SidebarTrigger visible on mobile\n- [ ] Agent list scrolls properly\n- [ ] Blocked alert visible and clear\n- [ ] Intervention input usable on mobile\n\n## Files\n- Modify: `src/app/project/[id]/swarm/[epicId]/page.tsx`\n\n## Dependencies\nThis task depends on:\n- ec5.2: Audit findings (COMPLETED - findings in this bead)\n- ec5.7: SidebarTrigger added to pages\n\n## Parallelization\nCan run in parallel with ec5.18, ec5.19, ec5.21","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.891676-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.21","title":"Phase 4.4: Apply responsive fixes to ideate page based on audit findings","description":"## Objective\nApply responsive fixes to the ideate page based on Phase 0.2 audit findings.\n\n## SPECIFIC FIX REQUIRED\n\n### CTA Section - Lines 85-99\n**Current (line 87):**\n```tsx\n\u003cdiv className=\"max-w-3xl mx-auto flex items-center justify-between\"\u003e\n```\n\n**Change to:**\n```tsx\n\u003cdiv className=\"max-w-3xl mx-auto flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between\"\u003e\n```\n\n**Also update button (line 93):**\n```tsx\n// Before\n\u003cButton variant=\"outline\" size=\"sm\"\u003e\n\n// After\n\u003cButton variant=\"outline\" size=\"sm\" className=\"w-full lg:w-auto\"\u003e\n```\n\nThis gives:\n- **Mobile (stacked):**\n  ```\n  ┌─────────────────────────┐\n  │ Ready to formalize?     │\n  │ Create a GitHub issue   │\n  │ and start planning      │\n  ├─────────────────────────┤\n  │ [   Create Issue    ]   │  \u003c- full width button\n  └─────────────────────────┘\n  ```\n\n- **Desktop (side-by-side):**\n  ```\n  ┌───────────────────────────────────────────┐\n  │ Ready to formalize?        [Create Issue] │\n  │ Create a GitHub issue...                  │\n  └───────────────────────────────────────────┘\n  ```\n\n### SidebarTrigger - Header (Line 49-51)\nAfter the ChevronLeft Link, add:\n```tsx\n\u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n```\n\n## Testing Checklist\n- [ ] CTA section stacks vertically on mobile\n- [ ] CTA section is side-by-side on desktop\n- [ ] Create Issue button is full-width on mobile\n- [ ] Create Issue button is auto-width on desktop\n- [ ] SidebarTrigger visible on mobile\n- [ ] Messages area scrolls properly\n- [ ] Input area usable at 320px\n\n## Files\n- Modify: `src/app/project/[id]/ideate/page.tsx`\n\n## Dependencies\nThis task depends on:\n- ec5.2: Audit findings (COMPLETED - findings in this bead)\n- ec5.7: SidebarTrigger added to pages\n\n## Parallelization\nCan run in parallel with ec5.18, ec5.19, ec5.20","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.945736-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.22","title":"Phase 5.1: Cross-browser and device testing at all breakpoints","description":"## Objective\nComprehensive cross-browser and device testing at all target breakpoints.\n\n## Test Matrix\n\n### Browsers\n| Browser | macOS | Windows | iOS | Android |\n|---------|-------|---------|-----|---------|\n| Chrome | Yes | Yes | N/A | Yes |\n| Firefox | Yes | Yes | N/A | Yes |\n| Safari | Yes | N/A | Yes | N/A |\n| Edge | Yes | Yes | N/A | N/A |\n\n### Breakpoints to Test\n| Width | Category | Layout Expected |\n|-------|----------|-----------------|\n| 320px | Mobile (min) | Mobile layouts |\n| 375px | iPhone SE | Mobile layouts |\n| 390px | iPhone 14 | Mobile layouts |\n| 428px | iPhone 14 Pro Max | Mobile layouts |\n| 768px | iPad Portrait | Mobile layouts |\n| 1024px | iPad Landscape / Breakpoint | Desktop layouts |\n| 1280px | Laptop | Desktop layouts |\n| 1440px | Desktop | Desktop layouts |\n| 1920px | Large Desktop | Desktop layouts |\n\n### Pages to Test\n1. Dashboard (`/project/[id]`)\n2. Issue View (`/project/[id]/issue/[n]`)\n3. Solo Chat (`/project/[id]/solo`)\n4. Solo Session (`/project/[id]/solo/[id]`)\n5. Epic/Planning (`/project/[id]/epic/[id]`)\n6. Swarm (`/project/[id]/swarm/[id]`)\n7. Ideate (`/project/[id]/ideate`)\n\n## Test Checklist per Page\n\n### General (All Pages)\n- [ ] Page loads without errors\n- [ ] No horizontal scroll (unless intentional)\n- [ ] Content is readable (not cut off)\n- [ ] Interactive elements are accessible\n- [ ] Navigation works correctly\n\n### Sidebar Behavior\n- [ ] \u003c 1024px: Sidebar hidden, trigger visible\n- [ ] \u003e= 1024px: Sidebar visible, trigger hidden\n- [ ] Trigger opens sidebar on mobile\n- [ ] Sidebar closes on navigation (mobile)\n- [ ] Keyboard shortcut works (desktop)\n\n### Dashboard Specific\n- [ ] Recent chats: vertical list on mobile, horizontal on desktop\n- [ ] Kanban: accordion on mobile, columns on desktop\n- [ ] New Issue dialog opens correctly\n- [ ] All links work\n\n### Issue View Specific\n- [ ] Tabs visible on mobile\n- [ ] Split view on desktop\n- [ ] Panel resize works on desktop\n- [ ] Tab switching works on mobile\n- [ ] Unread indicator works\n\n## Device Testing\n\n### Physical Devices (if available)\n- [ ] iPhone (any model)\n- [ ] Android phone (any model)\n- [ ] iPad (any model)\n- [ ] Android tablet (any model)\n\n### Browser DevTools\n- [ ] Chrome DevTools device mode\n- [ ] Firefox Responsive Design Mode\n- [ ] Safari Responsive Design Mode\n\n## Performance Observations\nNote any issues with:\n- Layout shifts during load\n- Slow transitions\n- Janky animations\n- Memory issues on mobile\n\n## Bug Reporting Template\nFor any issues found:\n```\n**Page:** [page name]\n**Browser:** [browser/version]\n**Device/Viewport:** [device or width]\n**Steps to Reproduce:**\n1. ...\n2. ...\n**Expected:** ...\n**Actual:** ...\n**Screenshot:** [attach]\n```\n\n## Success Criteria\n- No critical bugs on any browser/device combo\n- All core functionality works\n- Visual presentation is acceptable (minor variations OK)\n- Performance is acceptable on mobile devices","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:43.999361-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.23","title":"Phase 5.2: Verify 320px minimum width support with no horizontal scroll","description":"## Objective\nVerify that all pages work correctly at 320px minimum width without horizontal scrolling.\n\n## Background\n320px is the minimum supported width, representing older/smaller smartphones. Content must be usable without requiring horizontal scroll.\n\n## Test Procedure\n1. Open Chrome DevTools\n2. Set viewport to 320px width\n3. Navigate to each page\n4. Check for horizontal scroll indicator\n5. Verify content is usable\n\n## Pages to Check\n\n### Dashboard\n- [ ] Header doesn't overflow\n- [ ] Recent chats section fits\n- [ ] Accordion headers fit\n- [ ] Accordion content fits\n- [ ] No horizontal scroll\n\n### Issue View\n- [ ] Header fits (back, title, actions)\n- [ ] Tab buttons fit\n- [ ] Details panel content wraps properly\n- [ ] Chat messages don't overflow\n- [ ] Input area fits\n- [ ] No horizontal scroll\n\n### Solo Pages\n- [ ] Header fits\n- [ ] Messages wrap properly\n- [ ] Input area fits\n- [ ] No horizontal scroll\n\n### Epic Page\n- [ ] Header fits\n- [ ] Description wraps\n- [ ] Subtask list fits\n- [ ] File badges wrap (don't overflow)\n- [ ] Bottom actions fit\n- [ ] No horizontal scroll\n\n### Swarm Page\n- [ ] Header fits\n- [ ] Stats grid (2x2) fits\n- [ ] Agent cards fit\n- [ ] File locks truncate properly\n- [ ] Tasks list fits\n- [ ] No horizontal scroll\n\n### Ideate Page\n- [ ] Header fits\n- [ ] Messages wrap\n- [ ] CTA section stacks and fits\n- [ ] Input area fits\n- [ ] No horizontal scroll\n\n## Common Problem Areas\n\n### Text Overflow\n- Long titles without `truncate`\n- Long file paths without wrapping\n- Code snippets without `overflow-x-auto`\n\n### Fixed Widths\n- Elements with `w-[XXpx]` that don't have responsive variants\n- Flex containers without `flex-wrap`\n\n### Padding Issues\n- `px-6` (24px each side = 48px) leaves only 272px for content\n- Consider `px-3 lg:px-6` pattern\n\n## Fixes if Issues Found\n\n### For text overflow:\n```css\ntruncate        /* single line with ellipsis */\nline-clamp-2    /* 2 lines with ellipsis */\nbreak-words     /* wrap long words */\n```\n\n### For fixed widths:\n```css\nw-full lg:w-[400px]  /* full on mobile, fixed on desktop */\nmax-w-full           /* never exceed container */\nmin-w-0              /* allow flex items to shrink */\n```\n\n### For padding:\n```css\npx-3 lg:px-6         /* less padding on mobile */\n```\n\n## Success Criteria\n- No horizontal scroll indicator appears on any page\n- All content is readable and usable\n- No elements are cut off\n- Touch targets remain accessible (44px minimum)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:44.053166-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.24","title":"Phase 5.3: Verify touch-friendly tap targets (min 44px) throughout app","description":"## Objective\nVerify all interactive elements have touch-friendly tap targets of at least 44x44 pixels.\n\n## Background\nApple's Human Interface Guidelines and Google's Material Design both recommend minimum tap targets of 44-48 pixels. This ensures:\n- Users can accurately tap without frustration\n- Accessibility for users with motor impairments\n- Reduced accidental taps on wrong elements\n\n## Elements to Audit\n\n### Buttons\n- [ ] All `\u003cButton\u003e` components\n- [ ] Icon-only buttons (especially `size=\"icon-sm\"`)\n- [ ] Submit buttons in forms\n- [ ] Action buttons in dialogs\n\n### Links\n- [ ] Navigation links in sidebar\n- [ ] Card links (entire card should be tappable)\n- [ ] Text links in content\n- [ ] Header action links\n\n### Form Controls\n- [ ] Input fields (height)\n- [ ] Checkboxes\n- [ ] Radio buttons\n- [ ] Select dropdowns\n\n### Interactive Components\n- [ ] Accordion triggers\n- [ ] Tab buttons\n- [ ] Expand/collapse chevrons\n- [ ] SidebarTrigger\n\n## Measurement Technique\n\n### Browser DevTools\n1. Right-click element → Inspect\n2. Look at computed styles for height/width\n3. Check padding adds to clickable area\n\n### Visual Check\n1. Use 44px ruler overlay\n2. Element should be at least as large\n\n## Common Issues\n\n### Icon-only buttons\n```typescript\n// Too small:\n\u003cButton variant=\"ghost\" size=\"icon-sm\"\u003e  // 28x28\n  \u003cSend className=\"h-4 w-4\" /\u003e\n\u003c/Button\u003e\n\n// Better:\n\u003cButton variant=\"ghost\" size=\"icon\"\u003e  // 40x40, close enough\n  \u003cSend className=\"h-4 w-4\" /\u003e\n\u003c/Button\u003e\n\n// Or add padding:\n\u003cButton variant=\"ghost\" size=\"icon-sm\" className=\"p-2\"\u003e\n  \u003cSend className=\"h-4 w-4\" /\u003e\n\u003c/Button\u003e\n```\n\n### Small text links\n```typescript\n// Too small:\n\u003cspan className=\"text-xs\"\u003eEdit\u003c/span\u003e\n\n// Better:\n\u003cspan className=\"text-xs py-2 px-1 -my-2 -mx-1\"\u003eEdit\u003c/span\u003e\n// Padding increases tap target, negative margin maintains visual position\n```\n\n### Compact list items\n```typescript\n// Might be too small:\n\u003cdiv className=\"px-2 py-1\"\u003eItem\u003c/div\u003e\n\n// Better:\n\u003cdiv className=\"px-3 py-2\"\u003eItem\u003c/div\u003e  // 44px+ with line height\n```\n\n## Checklist by Component\n\n### Sidebar\n- [ ] Project names (entire row should be tappable)\n- [ ] Issue links\n- [ ] Expand/collapse buttons\n- [ ] Add project button\n- [ ] Footer buttons (New Idea, Solo Chat)\n\n### Dashboard\n- [ ] Session cards (48px+ height - OK)\n- [ ] Issue/Epic cards (should be tappable)\n- [ ] Accordion triggers\n- [ ] Add issue button\n\n### Issue View\n- [ ] Tab buttons\n- [ ] Action buttons in header\n- [ ] Message copy button\n- [ ] Submit button\n- [ ] Save summary button\n\n### All Pages\n- [ ] SidebarTrigger\n- [ ] Back buttons (ChevronLeft)\n- [ ] Header action buttons\n\n## Fixes to Apply\n\nIf elements are too small, use one of:\n\n1. **Increase size prop:**\n   `size=\"icon\"` instead of `size=\"icon-sm\"`\n\n2. **Add padding:**\n   `className=\"p-2\"` or `className=\"py-2 px-3\"`\n\n3. **Minimum height:**\n   `className=\"min-h-[44px]\"`\n\n4. **Invisible tap area:**\n   ```typescript\n   \u003cbutton className=\"relative\"\u003e\n     \u003cspan className=\"absolute inset-0 -m-2\" /\u003e  // Extends tap area\n     \u003cIcon /\u003e\n   \u003c/button\u003e\n   ```\n\n## Success Criteria\n- All interactive elements are at least 44x44px\n- Or have at least 44x44px tap target (via padding)\n- No elements require precision tapping\n- Tested on actual touch device if possible","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:44.10618-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.25","title":"Phase 5.4: Final regression testing and documentation update","description":"## Objective\nFinal regression testing and documentation update before closing the epic.\n\n## Regression Testing\n\n### Full User Journey Tests\n\n**Journey 1: Mobile User - New Issue**\n1. [ ] Open app on mobile (320px)\n2. [ ] Open sidebar via trigger\n3. [ ] Select a project\n4. [ ] Dashboard loads with accordion\n5. [ ] Open Issues accordion\n6. [ ] Tap \"New Issue\"\n7. [ ] Fill out and submit form\n8. [ ] Issue appears in list\n9. [ ] Tap issue to open\n10. [ ] Chat tab works\n11. [ ] Switch to Details tab\n12. [ ] Navigate back to dashboard\n\n**Journey 2: Desktop User - Swarm Monitoring**\n1. [ ] Open app on desktop (1440px)\n2. [ ] Sidebar visible, no trigger\n3. [ ] Select project from sidebar\n4. [ ] Dashboard shows kanban\n5. [ ] Click active swarm card\n6. [ ] Swarm page loads with stats\n7. [ ] Expand blocked agent\n8. [ ] Submit intervention\n9. [ ] Navigate via sidebar (doesn't close)\n10. [ ] Use cmd+b to toggle sidebar\n\n**Journey 3: Tablet User - Planning**\n1. [ ] Open app on tablet portrait (768px) - mobile layout\n2. [ ] Open sidebar via trigger\n3. [ ] Navigate to epic\n4. [ ] Review subtasks\n5. [ ] Use chat to refine\n6. [ ] Rotate to landscape (1024px) - desktop layout\n7. [ ] Sidebar appears automatically\n8. [ ] Launch swarm button visible\n\n### Feature Regression Tests\n\n**Sidebar Features:**\n- [ ] Project tree expand/collapse\n- [ ] Issue fetching per project\n- [ ] FolderBrowserModal opens\n- [ ] Active state highlighting\n- [ ] Mobile close on navigation\n- [ ] Desktop keyboard shortcut\n\n**Dashboard Features:**\n- [ ] Recent chats (both layouts)\n- [ ] All kanban columns (desktop)\n- [ ] All accordion sections (mobile)\n- [ ] New issue dialog\n- [ ] Card navigation\n\n**Issue View Features:**\n- [ ] Panel resize (desktop)\n- [ ] Tab switching (mobile)\n- [ ] Markdown rendering\n- [ ] Chat functionality\n- [ ] Unread indicator\n- [ ] Save summary\n\n## Documentation Updates\n\n### Files to Update\n\n**AGENTS.md or similar:**\n- [ ] Note the `lg:` breakpoint standard\n- [ ] Document responsive patterns used\n- [ ] Note shadcn components added\n\n**Component documentation (if exists):**\n- [ ] AppSidebar usage\n- [ ] Compact card components\n- [ ] Accordion patterns\n\n### Code Comments\nReview and ensure key responsive patterns are documented inline:\n- [ ] Layout switching logic\n- [ ] Breakpoint usage\n- [ ] Mobile-specific behavior\n\n## Cleanup Tasks\n\n- [ ] Remove sidebar.backup.tsx (if created and no longer needed)\n- [ ] Remove any TODO comments added during implementation\n- [ ] Ensure all console.logs removed\n- [ ] Run linter and fix issues\n- [ ] Run type checker and fix issues\n\n## Final Checklist\n\n- [ ] All Phase 1-4 tasks completed\n- [ ] All Phase 5.1-5.3 tests passed\n- [ ] No known critical bugs\n- [ ] No accessibility regressions\n- [ ] Performance acceptable\n- [ ] Code reviewed (if team process)\n- [ ] Changes committed and pushed\n\n## Closing the Epic\n\nOnce all above is verified:\n1. Update GH Issue #5 with summary of changes\n2. Close GH Issue #5\n3. Close this epic in beads\n4. Celebrate responsive design! \n\n## Post-Launch Monitoring\n\nConsider monitoring for:\n- User feedback on mobile experience\n- Error rates by device type\n- Performance metrics (Core Web Vitals) by viewport\n- Support requests related to mobile/responsive issues","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T21:11:44.160218-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.3","title":"Phase 0.3: Backup current sidebar.tsx content before shadcn installation","description":"Backup created at src/components/ui/sidebar.backup.tsx (305 lines). Contains TreeItem component, ProjectIssuesSection, and main Sidebar with all state management.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T21:11:42.951423-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Backup created at src/components/ui/sidebar.backup.tsx. Key components documented: TreeItem, ProjectIssuesSection, Sidebar.","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.4","title":"Phase 1.1: Install shadcn sidebar component","description":"## Objective\nInstall the shadcn sidebar component using the CLI.\n\n## Background\nThe shadcn/ui Sidebar component provides:\n- `collapsible=\"offcanvas\"` mode for mobile overlay\n- `SidebarProvider` with `useSidebar` hook for state management\n- `SidebarTrigger` for hamburger toggle button\n- Built-in `isMobile` detection (uses 1024px breakpoint by default)\n- Keyboard shortcut support (cmd+b / ctrl+b)\n- `SidebarInset` for main content area\n\n## Prerequisites\n- Phase 0.3 must be complete (backup created)\n- Git working tree should be clean or changes committed\n\n## Command\n```bash\npnpm dlx shadcn@latest add sidebar\n```\n\n## Expected Changes\n- `src/components/ui/sidebar.tsx` will be REPLACED with shadcn primitives\n- May add additional dependencies to package.json\n- May create additional utility files if needed\n\n## Post-Installation Verification\n1. Check that sidebar.tsx now contains shadcn primitives (Sidebar, SidebarContent, SidebarHeader, etc.)\n2. Verify no TypeScript errors\n3. Run `pnpm build` to check for issues (app will be broken until Phase 1.2-1.3)\n\n## Important Notes\n- The app WILL be broken after this step until we create app-sidebar.tsx and update layout.tsx\n- This is expected - don't panic\n- Phases 1.2 and 1.3 must follow immediately\n\n## Rollback Plan\nIf something goes catastrophically wrong:\n```bash\ngit checkout -- src/components/ui/sidebar.tsx\n```\nOr restore from sidebar.backup.tsx created in Phase 0.3","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T21:11:43.005394-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"shadcn sidebar installed. All exports available: Sidebar, SidebarProvider, SidebarTrigger, useSidebar, etc. App is broken as expected until layout is updated.","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.5","title":"Phase 1.2: Create app-sidebar.tsx preserving all existing sidebar functionality","description":"## Objective\nCreate a new `app-sidebar.tsx` component that uses the shadcn Sidebar primitives while preserving ALL existing sidebar functionality.\n\n## Background\nThe shadcn sidebar provides the responsive shell (offcanvas behavior, triggers, etc.) but we need to fill it with our app-specific content:\n- Project tree with expand/collapse\n- Live issue fetching per project\n- FolderBrowserModal integration\n- Navigation with active states\n- Bottom action buttons\n\n## Implementation Plan\n\n### 1. Import Structure\n```typescript\n\"use client\";\n\nimport { \n  Sidebar, \n  SidebarContent, \n  SidebarHeader, \n  SidebarFooter, \n  SidebarMenu, \n  SidebarMenuItem, \n  SidebarMenuButton, \n  SidebarGroup, \n  SidebarGroupLabel,\n  SidebarMenuSub,\n  SidebarMenuSubItem,\n  SidebarMenuSubButton,\n  useSidebar \n} from \"@/components/ui/sidebar\";\nimport { useParams, usePathname, useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\nimport Link from \"next/link\";\nimport { useProjects, useProjectIssues } from \"@/lib/hooks/useProjects\";\nimport { FolderBrowserModal } from \"@/components/folder-browser\";\n// ... icons\n```\n\n### 2. Component Structure\n```typescript\nexport function AppSidebar() {\n  // ALL existing state preserved:\n  const params = useParams();\n  const pathname = usePathname();\n  const router = useRouter();\n  const currentProjectId = params.id as string;\n  const { data: projects, isLoading } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  const [expandedProjects, setExpandedProjects] = useState\u003cSet\u003cstring\u003e\u003e(...);\n  \n  // NEW: Access sidebar state for mobile close behavior\n  const { setOpenMobile } = useSidebar();\n  \n  return (\n    \u003cSidebar collapsible=\"offcanvas\"\u003e\n      \u003cSidebarHeader\u003e...\u003c/SidebarHeader\u003e\n      \u003cSidebarContent\u003e...\u003c/SidebarContent\u003e\n      \u003cSidebarFooter\u003e...\u003c/SidebarFooter\u003e\n      \u003cFolderBrowserModal ... /\u003e\n    \u003c/Sidebar\u003e\n  );\n}\n```\n\n### 3. Key Features to Implement\n\n**Header Section:**\n- Logo + \"Maestro\" title\n- Search button with kbd shortcut display\n\n**Content Section:**\n- Projects group with \"+\" button to add project\n- Project tree using SidebarMenu \u003e SidebarMenuItem \u003e SidebarMenuSub structure\n- Each project expandable to show issues\n- Active state highlighting for current project/issue\n\n**Footer Section:**\n- \"New Idea\" link\n- \"Solo Chat\" link (primary styled)\n\n### 4. Navigation Click Handler\n```typescript\n// Wrap links to close mobile sidebar on navigation\nfunction NavLink({ href, children, ...props }) {\n  const { setOpenMobile } = useSidebar();\n  return (\n    \u003cLink \n      href={href} \n      onClick={() =\u003e setOpenMobile(false)}\n      {...props}\n    \u003e\n      {children}\n    \u003c/Link\u003e\n  );\n}\n```\n\n## Acceptance Criteria\n- [ ] All projects display with expand/collapse\n- [ ] Issues load and display under each project\n- [ ] Active states highlight correctly\n- [ ] FolderBrowserModal opens from \"+\" button\n- [ ] Navigation works and closes mobile sidebar\n- [ ] Search button present (even if non-functional)\n- [ ] Bottom actions link to correct pages\n\n## Files\n- Create: `src/components/app-sidebar.tsx`\n- Reference: `src/components/ui/sidebar.backup.tsx` (from Phase 0.3)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T21:11:43.061159-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.6","title":"Phase 1.3: Update project layout.tsx with SidebarProvider wrapper","description":"## Objective\nUpdate the project layout to use SidebarProvider and integrate the new AppSidebar component.\n\n## Background\nThe shadcn Sidebar requires a `SidebarProvider` wrapper to manage state (open/closed, mobile detection). The layout also needs `SidebarInset` to properly position the main content area.\n\n## Current Layout (layout.tsx)\n```typescript\nexport default function ProjectLayout({ children }) {\n  return (\n    \u003cdiv className=\"flex h-screen bg-background\"\u003e\n      \u003cSidebar /\u003e\n      \u003cmain className=\"flex-1 overflow-y-auto\"\u003e\n        {children}\n      \u003c/main\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## New Layout Structure\n```typescript\nimport { SidebarProvider, SidebarInset } from \"@/components/ui/sidebar\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\n\nexport default function ProjectLayout({ children }) {\n  return (\n    \u003cSidebarProvider\u003e\n      \u003cAppSidebar /\u003e\n      \u003cSidebarInset\u003e\n        \u003cmain className=\"flex-1 overflow-hidden\"\u003e\n          {children}\n        \u003c/main\u003e\n      \u003c/SidebarInset\u003e\n    \u003c/SidebarProvider\u003e\n  );\n}\n```\n\n## Key Changes\n1. Import `SidebarProvider` and `SidebarInset` from shadcn sidebar\n2. Import `AppSidebar` from our new component\n3. Wrap entire layout in `SidebarProvider`\n4. Replace `\u003cSidebar /\u003e` with `\u003cAppSidebar /\u003e`\n5. Wrap `\u003cmain\u003e` in `\u003cSidebarInset\u003e`\n6. Remove the outer `\u003cdiv className=\"flex h-screen\"\u003e` (SidebarProvider handles this)\n\n## Considerations\n\n### Cookie-based Persistence (Optional)\nThe shadcn SidebarProvider supports cookie-based persistence of sidebar state:\n```typescript\n\u003cSidebarProvider defaultOpen={cookies.get(\"sidebar:state\")?.value === \"true\"}\u003e\n```\nThis is a nice-to-have for desktop users but not required for MVP.\n\n### Mobile Detection\nSidebarProvider automatically detects mobile using a 1024px breakpoint (matching our `lg:` strategy). No configuration needed.\n\n## Testing After This Phase\n- Desktop: Sidebar should be visible, full width\n- Mobile (\u003c1024px): Sidebar should be hidden\n- The app should not crash (basic functionality restored)\n\n## Files\n- Modify: `src/app/project/[id]/layout.tsx`","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T21:11:43.116517-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.7","title":"Phase 1.4: Add SidebarTrigger to all page headers for mobile","description":"## Objective\nAdd a SidebarTrigger (hamburger menu button) to all page headers so mobile users can open the sidebar.\n\n## Background\nOn mobile (\u003c1024px), the sidebar is hidden by default. Users need a way to open it. The `SidebarTrigger` component from shadcn provides a hamburger icon that toggles the sidebar.\n\n## Pages Requiring SidebarTrigger\n\n### 1. Dashboard (page.tsx)\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b border-border bg-card flex-shrink-0\"\u003e\n  \u003cdiv className=\"flex h-12 items-center justify-between px-6\"\u003e\n+   \u003cSidebarTrigger className=\"lg:hidden mr-2\" /\u003e\n    \u003cdiv className=\"flex items-center gap-3\"\u003e\n      \u003ch1 className=\"font-semibold text-lg\"\u003e{project.name}\u003c/h1\u003e\n      ...\n```\n\n### 2. Issue View (issue/[issueNumber]/page.tsx)\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b border-border bg-card\"\u003e\n  \u003cdiv className=\"flex h-12 items-center gap-2 px-4\"\u003e\n+   \u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n    \u003cLink href={`/project/${projectId}`} ...\u003e\n      \u003cChevronLeft ... /\u003e\n    \u003c/Link\u003e\n    ...\n```\n\n### 3. Solo Page (solo/page.tsx)\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b border-border bg-card\"\u003e\n  \u003cdiv className=\"flex h-12 items-center gap-2 px-4\"\u003e\n+   \u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n    \u003cLink href={`/project/${project.id}`} ...\u003e\n      \u003cChevronLeft ... /\u003e\n    \u003c/Link\u003e\n    ...\n```\n\n### 4. Solo Session Page (solo/[sessionId]/page.tsx)\nSame pattern as Solo Page.\n\n### 5. Epic Page (epic/[epicId]/page.tsx)\nSame pattern as Solo Page.\n\n### 6. Swarm Page (swarm/[epicId]/page.tsx)\nSame pattern as Solo Page.\n\n### 7. Ideate Page (ideate/page.tsx)\nSame pattern as Solo Page.\n\n## Implementation Pattern\n```typescript\nimport { SidebarTrigger } from \"@/components/ui/sidebar\";\n\n// In header, before any back button or title:\n\u003cSidebarTrigger className=\"lg:hidden\" /\u003e\n```\n\n## Why `lg:hidden`?\n- On desktop (\u003e=1024px), the sidebar is always visible, so the trigger is unnecessary\n- On mobile (\u003c1024px), the trigger is needed to open the offcanvas sidebar\n- This matches our primary breakpoint strategy\n\n## Visual Placement\nThe trigger should be the first element in the header (leftmost on LTR layouts). If there's a back button (ChevronLeft), the trigger goes BEFORE it.\n\n## Testing\n- On desktop: Trigger should not be visible\n- On mobile: Trigger should be visible and open sidebar on click\n- Sidebar should overlay the page content when open\n\n## Files to Modify\n- src/app/project/[id]/page.tsx\n- src/app/project/[id]/issue/[issueNumber]/page.tsx\n- src/app/project/[id]/solo/page.tsx\n- src/app/project/[id]/solo/[sessionId]/page.tsx\n- src/app/project/[id]/epic/[epicId]/page.tsx\n- src/app/project/[id]/swarm/[epicId]/page.tsx\n- src/app/project/[id]/ideate/page.tsx","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T21:11:43.171263-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.8","title":"Phase 1.5: Wire up setOpenMobile(false) on all navigation clicks in sidebar","description":"## Objective\nEnsure the mobile sidebar closes automatically when users click any navigation link within it.\n\n## Background\nOn mobile, when users tap a link in the sidebar (e.g., a project, an issue, or \"Solo Chat\"), the sidebar should close so they can see the page they navigated to. Without this, the sidebar remains open and covers the content.\n\n## Implementation\n\n### Option 1: Wrapper Component (Recommended)\nCreate a reusable NavLink component inside app-sidebar.tsx:\n\n```typescript\nfunction SidebarNavLink({ href, children, className, ...props }) {\n  const { setOpenMobile } = useSidebar();\n  \n  return (\n    \u003cLink \n      href={href} \n      onClick={() =\u003e setOpenMobile(false)}\n      className={className}\n      {...props}\n    \u003e\n      {children}\n    \u003c/Link\u003e\n  );\n}\n```\n\nUse this for all navigation links in the sidebar.\n\n### Option 2: Direct onClick Handlers\nAdd onClick handlers directly to each Link:\n\n```typescript\nconst { setOpenMobile } = useSidebar();\n\n\u003cLink \n  href={`/project/${project.id}`}\n  onClick={() =\u003e setOpenMobile(false)}\n\u003e\n  {project.displayName}\n\u003c/Link\u003e\n```\n\n### Places to Update\n\n1. **Project names** - clicking navigates to project dashboard\n2. **Issue links** - clicking navigates to issue view\n3. **\"New Idea\" button** - navigates to ideate page\n4. **\"Solo Chat\" button** - navigates to solo page\n5. **Any other clickable navigation items**\n\n### Non-Navigation Clicks\nSome clicks should NOT close the sidebar:\n- Expand/collapse project tree (toggleProjectExpanded)\n- Opening FolderBrowserModal (add project button)\n- Search button (when implemented)\n\nOnly NAVIGATION (page changes) should close the sidebar.\n\n## Testing Checklist\n- [ ] Click project name → sidebar closes, navigates to dashboard\n- [ ] Click issue → sidebar closes, navigates to issue view\n- [ ] Click \"New Idea\" → sidebar closes, navigates to ideate\n- [ ] Click \"Solo Chat\" → sidebar closes, navigates to solo\n- [ ] Expand/collapse project → sidebar stays open\n- [ ] Click \"+\" to add project → modal opens, sidebar stays open\n\n## Why This Matters\nPoor mobile UX if users have to manually close the sidebar after every navigation. This is a critical usability pattern for mobile apps.\n\n## Files\n- Modify: `src/components/app-sidebar.tsx`","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T21:11:43.224516-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-ec5.9","title":"Phase 1.6: Test sidebar mobile overlay behavior and keyboard shortcut (cmd+b)","description":"## Objective\nComprehensive testing of the new sidebar implementation on mobile and desktop.\n\n## Test Scenarios\n\n### Mobile Tests (viewport \u003c 1024px)\n\n**Visibility:**\n- [ ] Sidebar is hidden by default\n- [ ] SidebarTrigger (hamburger) is visible in all page headers\n- [ ] Clicking trigger opens sidebar as overlay\n- [ ] Sidebar overlays content (doesn't push it)\n- [ ] Background is dimmed when sidebar is open\n\n**Navigation:**\n- [ ] Clicking any navigation link closes sidebar\n- [ ] Page content updates correctly after navigation\n- [ ] Back button (ChevronLeft) still works alongside trigger\n\n**Interactions:**\n- [ ] Expand/collapse project works, sidebar stays open\n- [ ] Add project button opens FolderBrowserModal\n- [ ] Search button is visible (even if non-functional)\n- [ ] Clicking outside sidebar closes it\n- [ ] Swiping to close works (if supported by shadcn)\n\n### Desktop Tests (viewport \u003e= 1024px)\n\n**Visibility:**\n- [ ] Sidebar is visible and docked (not overlay)\n- [ ] SidebarTrigger is hidden\n- [ ] Sidebar takes fixed width (~256px or as styled)\n\n**Functionality:**\n- [ ] All project expand/collapse works\n- [ ] Issue fetching works per project\n- [ ] Active states highlight correctly\n- [ ] Navigation works normally\n- [ ] FolderBrowserModal works\n\n**Keyboard Shortcut:**\n- [ ] cmd+b (Mac) / ctrl+b (Windows) toggles sidebar\n- [ ] Focus moves appropriately when toggling\n- [ ] Shortcut works from any page in /project/*\n\n### Responsive Transition Test\n- [ ] Resize browser from mobile to desktop: sidebar appears\n- [ ] Resize browser from desktop to mobile: sidebar hides\n- [ ] No layout jump or flash during resize\n- [ ] State (expanded projects) preserved during resize\n\n### Edge Cases\n- [ ] Deep link directly to issue while on mobile - trigger visible\n- [ ] Refresh page while sidebar open on mobile\n- [ ] Navigate away from /project/* and back\n\n## How to Test\n1. Use browser DevTools device toolbar for mobile testing\n2. Test on actual iPhone/Android if available\n3. Test Safari, Chrome, Firefox for browser compatibility\n4. Test with keyboard only (accessibility)\n\n## Bug Template\nIf issues found, document:\n- Steps to reproduce\n- Expected behavior\n- Actual behavior\n- Screenshot/video if applicable\n- Browser and viewport size\n\n## Success Criteria\nAll checkboxes above should pass. Any failures should be logged as bugs to fix before Phase 1 is complete.","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T21:11:43.276903-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T22:58:13.468114-06:00","close_reason":"Closed","deleted_at":"2025-12-30T22:58:13.468114-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp","title":"Issue Discussion: Chat Interface with GitHub Issue Persistence","description":"## Overview\n\nImplement the Issue Discussion view - a split-panel interface where users explore and refine GitHub Issues with an AI agent, using the GitHub issue itself as the persistent source of truth.\n\n## Architectural Philosophy\n\nThis feature embodies a key architectural principle: **GitHub Issues ARE the persistent artifact**. Unlike traditional chat applications where conversation history is stored separately, we use GitHub Issues as the canonical source of truth. OpenCode sessions are transient - they can be recreated at any time by re-injecting the issue context.\n\n### Key Design Decisions\n\n1. **No git branch/worktree during discussion** - Agent operates on main branch in read-only exploration mode\n2. **GitHub Issue IS persistence** - Not local files, not OpenCode session state\n3. **Sessions are ephemeral** - Can be recreated by injecting issue context\n4. **Summary persistence is on-demand** - User explicitly saves conversation summaries as GitHub comments\n5. **No new concepts** - We work directly with GitHub Issues\n\n## Why This Matters\n\nThe Issue Discussion phase is the first step in the Maestro workflow:\n\n```\nIssue Discussion → Planning → Execution (Swarm/Solo) → Completion\n```\n\nUsers need a space to:\n- Explore ideas with AI assistance\n- Understand codebase implications\n- Refine requirements before committing to implementation\n- Build shared context that persists beyond any single conversation\n\n## Technical Context\n\n### Already Implemented\n- NewIssueDialog component (creates GitHub issues)\n- Issue View page (basic split panel, but chat is mocked)\n- Issues API endpoints (list, create, get single)\n- Mobile tabbed interface\n- Desktop split panel (fixed 400px width)\n\n### Needs Implementation\n- OpenCode SDK integration (replacing mock setTimeout)\n- Session storage service (~/.maestro/sessions.json)\n- Comments display in issue panel\n- Add comment API endpoint\n- Session management API endpoints\n- SSE streaming for real-time responses\n- Save Summary modal\n- Error handling infrastructure\n- Panel resizing (polish)\n\n## Parallelization Opportunities\n\n**Can be worked in parallel:**\n- Task 1.1 (Install SDK) + Task 1.3 (SessionStorage) - no dependencies between them\n- Task 3.1 (Display comments) - pure UI, no dependencies at all\n- Task 3.2 (Comment posting API) - independent of OpenCode work\n- Task 4.2 (Panel resizing) - independent UI polish\n\n**Critical path:**\n1.1 → 1.2 → 1.4 → 2.1 → 2.3 → 2.4\n\n**Merge notes:**\n- Task 2.2 was merged into 1.4 (context injection is part of session creation)\n\n## OpenCode SDK Key Points\n\n**Critical: Directory Parameter**\nThe OpenCode SDK operates on a specific project directory. Almost every API call requires a `directory` query parameter. Our services must pass the project path to OpenCode.\n\n**Streaming Pattern**\nFor real-time streaming, use:\n1. `session.promptAsync()` - starts prompt, returns immediately\n2. `event.subscribe()` - SSE stream for updates\n3. Listen for `message.part.updated` events with `delta` property\n\n**Health Check**\nUse `client.global.health()` for connectivity checks.\n\n## Dependencies\n\nExternal:\n- OpenCode server running locally (`opencode serve`)\n- @opencode-ai/sdk npm package\n- GitHub CLI (`gh`) authenticated\n\nInternal:\n- ConfigService (for project paths) - EXISTS\n- TanStack Query hooks pattern - EXISTS\n- UI component library - EXISTS\n\n## Success Criteria\n\n1. User can chat with AI about a GitHub issue\n2. AI has full issue context (title, body, comments)\n3. AI can read codebase but cannot modify files\n4. Conversation summaries can be saved to GitHub\n5. Sessions reconnect gracefully if interrupted\n6. Works on both desktop and mobile layouts\n\n## Reference\n\nGitHub Issue: https://github.com/ejohane/maestro/issues/3\nOpenCode SDK Docs: https://opencode.ai/docs/sdk","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-30T10:33:34.352275-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:57.165223-06:00","close_reason":"Completed","deleted_at":"2025-12-31T08:43:57.165223-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-fyp.1","title":"Phase 1: Core Infrastructure","description":"## Phase 1: Core Infrastructure\n\nThis phase establishes the foundational services and API endpoints that all subsequent phases depend on. Without this infrastructure, we cannot connect to OpenCode or manage sessions.\n\n### Why This Phase First?\n\nThe Issue Discussion feature is fundamentally about connecting the Maestro UI to the OpenCode AI backend. Before we can build any user-facing chat functionality, we need:\n\n1. **SDK Integration** - The bridge between our frontend and OpenCode\n2. **Session Management** - Tracking which OpenCode session belongs to which GitHub issue\n3. **Health Monitoring** - Knowing when OpenCode is available\n\n### Technical Decisions\n\n**Session Storage Location: `~/.maestro/sessions.json`**\n- Chosen to match existing config pattern (`~/.maestro/config.json`)\n- JSON file is simple, human-readable, and sufficient for local use\n- Cross-device support via shared filesystem (Tailscale)\n- No database overhead for this MVP\n\n**One Session Per Issue (Singleton Pattern)**\n- Simplifies reasoning about state\n- Prevents duplicate sessions consuming resources\n- If session dies, we recreate with context injection\n\n**Lazy Session Cleanup**\n- Don't proactively garbage collect sessions\n- Check if alive when requested, recreate if dead\n- Simple and robust for MVP\n\n### API Design\n\nFollowing existing patterns in the codebase:\n- Use Next.js 15 async params pattern\n- Return `{ error: \"message\" }` on failures\n- Execute `gh` commands with `cwd: project.path`\n\n### Deliverables\n\n1. OpenCode SDK installed and typed\n2. OpenCodeService wrapper with error handling\n3. SessionStorage service for JSON persistence\n4. Session management API endpoints\n5. Health check endpoint\n\n### Dependencies\n\nNone - this is the foundation.","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:33:34.407677-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"All Phase 1 subtasks completed: SDK installed, OpenCodeService created, SessionStorage service created, session API endpoints created, health check endpoint created","dependencies":[{"issue_id":"maestro-fyp.1","depends_on_id":"maestro-fyp","type":"parent-child","created_at":"2025-12-30T10:33:34.409693-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.1.1","title":"Install and configure @opencode-ai/sdk","description":"## Task\n\nInstall the OpenCode SDK and configure TypeScript types.\n\n## Why\n\nThe SDK is the foundation for all OpenCode communication. Without it, we cannot create sessions, send messages, or stream responses.\n\n## Implementation\n\n```bash\nbun add @opencode-ai/sdk\n```\n\n## Verification\n\n1. Import works: `import { createOpencodeClient } from \"@opencode-ai/sdk\"`\n2. TypeScript types are available\n3. No build errors\n\n## Files to Create/Modify\n\n- `package.json` - Add dependency\n- `bun.lock` - Updated automatically\n\n## Notes\n\nSDK documentation: https://opencode.ai/docs/sdk\n\nThe SDK provides:\n- `createOpencodeClient()` - Factory function\n- `client.session.create()` - Create new session\n- `client.session.prompt()` - Send message\n- `client.event.subscribe()` - SSE streaming\n- Full TypeScript types\n\n## Acceptance Criteria\n\n- [ ] SDK installed via bun\n- [ ] Imports work without errors\n- [ ] Types are available in IDE","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:34:38.849563-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"SDK @opencode-ai/sdk@1.0.214 installed successfully, types verified","dependencies":[{"issue_id":"maestro-fyp.1.1","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:34:38.851496-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.1.2","title":"Create OpenCodeService wrapper","description":"## Task\n\nCreate `src/lib/services/opencode.ts` - A service wrapper around the OpenCode SDK with error handling and helper methods.\n\n## Why\n\nDirect SDK usage scatters OpenCode-specific logic across the codebase. A service wrapper:\n- Centralizes configuration (base URL)\n- Provides typed helper methods\n- Handles common error patterns\n- Makes testing easier (can mock the service)\n\n## CRITICAL: Directory Parameter\n\nThe OpenCode SDK operates on a **specific project directory**. Almost every API call accepts a `directory` query parameter. Our service MUST pass the project path to OpenCode so it knows which project context to use.\n\n## Implementation\n\n```typescript\n// src/lib/services/opencode.ts\nimport { createOpencodeClient } from \"@opencode-ai/sdk\"\n\nexport interface OpenCodeConfig {\n  baseUrl: string\n}\n\nexport class OpenCodeService {\n  private client: ReturnType\u003ctypeof createOpencodeClient\u003e\n  \n  constructor(config?: Partial\u003cOpenCodeConfig\u003e) {\n    this.client = createOpencodeClient({\n      baseUrl: config?.baseUrl || process.env.OPENCODE_URL || \"http://localhost:4096\"\n    })\n  }\n\n  // Create a new session\n  async createSession(projectPath: string, title: string): Promise\u003c{ id: string }\u003e {\n    const result = await this.client.session.create({\n      query: { directory: projectPath },\n      body: { title }\n    })\n    return { id: result.data!.id }\n  }\n\n  // Check if session is alive\n  async isSessionAlive(projectPath: string, sessionId: string): Promise\u003cboolean\u003e {\n    try {\n      await this.client.session.get({\n        path: { id: sessionId },\n        query: { directory: projectPath }\n      })\n      return true\n    } catch {\n      return false\n    }\n  }\n\n  // Inject context without AI response\n  async injectContext(projectPath: string, sessionId: string, context: string): Promise\u003cvoid\u003e {\n    await this.client.session.prompt({\n      path: { id: sessionId },\n      query: { directory: projectPath },\n      body: {\n        noReply: true,\n        parts: [{\n          type: \"text\",\n          text: context,\n          synthetic: true  // Mark as system-injected\n        }]\n      }\n    })\n  }\n\n  // Send message in read-only mode using ASYNC prompt + events\n  // NOTE: Use prompt_async for streaming, then subscribe to events\n  async sendReadOnlyMessageAsync(projectPath: string, sessionId: string, message: string): Promise\u003cvoid\u003e {\n    // This starts the prompt but doesn't wait for response\n    // Caller should subscribe to events for streaming\n    await this.client.session.promptAsync({\n      path: { id: sessionId },\n      query: { directory: projectPath },\n      body: {\n        tools: {\n          bash: false,\n          write: false,\n          edit: false\n        },\n        parts: [{ type: \"text\", text: message }]\n      }\n    })\n  }\n\n  // Request conversation summary (sync, waits for response)\n  async generateSummary(projectPath: string, sessionId: string): Promise\u003cstring\u003e {\n    const result = await this.client.session.prompt({\n      path: { id: sessionId },\n      query: { directory: projectPath },\n      body: {\n        parts: [{\n          type: \"text\",\n          text: \"Summarize our discussion so far in 2-3 paragraphs. Focus on key decisions made, open questions identified, and suggested next steps. Format as markdown.\"\n        }]\n      }\n    })\n    // Extract text from response parts\n    const textPart = result.data?.parts?.find(p =\u003e p.type === \"text\")\n    return textPart?.text || \"\"\n  }\n\n  // Health check using SDK's built-in method\n  async isHealthy(): Promise\u003cboolean\u003e {\n    try {\n      const result = await this.client.global.health()\n      return result.data?.healthy === true\n    } catch {\n      return false\n    }\n  }\n\n  // Get SSE event stream\n  async subscribeToEvents(projectPath: string): Promise\u003cAsyncIterable\u003cany\u003e\u003e {\n    const events = await this.client.event.subscribe({\n      query: { directory: projectPath }\n    })\n    return events.stream\n  }\n}\n\n// Singleton instance for server-side use\nexport const openCodeService = new OpenCodeService()\n```\n\n## Key Design Decisions\n\n1. **projectPath required** - Every method requires the project path to pass to OpenCode\n2. **Singleton pattern** - One instance per server, consistent config\n3. **Environment variable** - `OPENCODE_URL` for different environments\n4. **Read-only mode** - `sendReadOnlyMessageAsync` enforces tool restrictions\n5. **Health check** - Uses SDK's `client.global.health()` method\n6. **Async prompts** - Use `promptAsync` for streaming, not `prompt`\n\n## Files to Create\n\n- `src/lib/services/opencode.ts`\n\n## Dependencies\n\n- `@opencode-ai/sdk` installed (previous task)\n\n## Acceptance Criteria\n\n- [ ] Service compiles without errors\n- [ ] All methods accept projectPath parameter\n- [ ] createSession returns session ID\n- [ ] isSessionAlive correctly detects dead sessions\n- [ ] injectContext uses noReply: true, synthetic: true on the part\n- [ ] sendReadOnlyMessageAsync disables bash/write/edit tools\n- [ ] isHealthy uses client.global.health()\n- [ ] Error handling for network failures","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:34:49.521334-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"OpenCodeService wrapper created with all methods, TypeScript types resolved, compiles without errors","dependencies":[{"issue_id":"maestro-fyp.1.2","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:34:49.523394-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.1.2","depends_on_id":"maestro-fyp.1.1","type":"blocks","created_at":"2025-12-30T10:39:14.329104-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.1.3","title":"Create SessionStorage service","description":"## Task\n\nCreate `src/lib/services/sessions.ts` - A service for persisting session-to-issue mappings in `~/.maestro/sessions.json`.\n\n## Why\n\nWe need to track which OpenCode session belongs to which GitHub issue:\n- Resume sessions when user returns to an issue\n- Avoid creating duplicate sessions\n- Cross-device support (file on server, not localStorage)\n\n## Data Model\n\n```typescript\ninterface SessionMapping {\n  projectId: string       // Project UUID (from Maestro config)\n  projectPath: string     // Project absolute path (for verification)\n  issueNumber: number     // GitHub issue number\n  sessionId: string       // OpenCode session ID\n  createdAt: string       // ISO timestamp\n  lastAccessedAt: string  // ISO timestamp (updated on access)\n}\n\ninterface SessionStore {\n  version: 1              // For future migrations\n  mappings: SessionMapping[]\n}\n```\n\n**Note**: We store `projectPath` alongside `projectId` for verification. If the project path changes (relocation), we can still match on projectId.\n\n## Implementation\n\n```typescript\n// src/lib/services/sessions.ts\nimport { promises as fs } from \"fs\"\nimport path from \"path\"\nimport os from \"os\"\n\nconst SESSIONS_PATH = path.join(os.homedir(), \".maestro\", \"sessions.json\")\n\nexport class SessionStorageService {\n  // Get session for issue (or null if none)\n  async getSession(projectId: string, issueNumber: number): Promise\u003cSessionMapping | null\u003e {\n    const store = await this.readStore()\n    return store.mappings.find(\n      m =\u003e m.projectId === projectId \u0026\u0026 m.issueNumber === issueNumber\n    ) ?? null\n  }\n\n  // Save session mapping\n  async saveSession(\n    projectId: string,\n    projectPath: string,\n    issueNumber: number,\n    sessionId: string\n  ): Promise\u003cvoid\u003e {\n    const store = await this.readStore()\n    \n    // Remove any existing mapping for this issue\n    store.mappings = store.mappings.filter(\n      m =\u003e !(m.projectId === projectId \u0026\u0026 m.issueNumber === issueNumber)\n    )\n    \n    // Add new mapping\n    store.mappings.push({\n      projectId,\n      projectPath,\n      issueNumber,\n      sessionId,\n      createdAt: new Date().toISOString(),\n      lastAccessedAt: new Date().toISOString()\n    })\n    \n    await this.writeStore(store)\n  }\n\n  // Remove session mapping (when session dies)\n  async removeSession(projectId: string, issueNumber: number): Promise\u003cvoid\u003e {\n    const store = await this.readStore()\n    store.mappings = store.mappings.filter(\n      m =\u003e !(m.projectId === projectId \u0026\u0026 m.issueNumber === issueNumber)\n    )\n    await this.writeStore(store)\n  }\n\n  // Update lastAccessedAt timestamp\n  async touchSession(projectId: string, issueNumber: number): Promise\u003cvoid\u003e {\n    const store = await this.readStore()\n    const mapping = store.mappings.find(\n      m =\u003e m.projectId === projectId \u0026\u0026 m.issueNumber === issueNumber\n    )\n    if (mapping) {\n      mapping.lastAccessedAt = new Date().toISOString()\n      await this.writeStore(store)\n    }\n  }\n\n  // Internal: read file, handle missing/corrupt\n  private async readStore(): Promise\u003cSessionStore\u003e {\n    try {\n      const content = await fs.readFile(SESSIONS_PATH, \"utf-8\")\n      return JSON.parse(content)\n    } catch (err: unknown) {\n      if (err \u0026\u0026 typeof err === \"object\" \u0026\u0026 \"code\" in err \u0026\u0026 err.code === \"ENOENT\") {\n        // File doesn't exist - return empty store\n        return { version: 1, mappings: [] }\n      }\n      // Corrupt JSON - reset to empty\n      console.error(\"Corrupt sessions.json, resetting:\", err)\n      return { version: 1, mappings: [] }\n    }\n  }\n\n  // Internal: write file atomically\n  private async writeStore(store: SessionStore): Promise\u003cvoid\u003e {\n    const dir = path.dirname(SESSIONS_PATH)\n    await fs.mkdir(dir, { recursive: true })\n    \n    // Write to temp file then rename (atomic)\n    const tempPath = SESSIONS_PATH + \".tmp\"\n    await fs.writeFile(tempPath, JSON.stringify(store, null, 2))\n    await fs.rename(tempPath, SESSIONS_PATH)\n  }\n}\n\nexport const sessionStorage = new SessionStorageService()\n```\n\n## Key Design Decisions\n\n1. **File-based storage** - Matches config pattern, simple and sufficient\n2. **Atomic writes** - Write to temp file, then rename (prevents corruption)\n3. **Auto-create directory** - Create ~/.maestro if missing\n4. **Graceful degradation** - Return empty store if file missing/corrupt\n5. **lastAccessedAt** - For potential future cleanup of stale sessions\n6. **projectPath stored** - For verification when reconnecting\n\n## Files to Create\n\n- `src/lib/services/sessions.ts`\n\n## Dependencies\n\nNone - uses Node.js fs module.\n\n## Acceptance Criteria\n\n- [ ] Creates ~/.maestro directory if missing\n- [ ] Reads existing sessions.json correctly\n- [ ] Handles missing file gracefully (returns empty)\n- [ ] Handles corrupt JSON gracefully (resets to empty)\n- [ ] Saves session mappings correctly with projectPath\n- [ ] Removes session mappings correctly\n- [ ] Atomic file writes (no partial writes)\n- [ ] Updates lastAccessedAt on touch","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:35:00.119368-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"SessionStorage service created with all required methods, atomic writes, graceful error handling","dependencies":[{"issue_id":"maestro-fyp.1.3","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:35:00.121484-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.1.4","title":"Create session management API endpoints","description":"## Task\n\nCreate API endpoints for managing OpenCode sessions tied to GitHub issues:\n- `POST /api/projects/[id]/issues/[issueNumber]/session` - Create/resume session\n- `GET /api/projects/[id]/issues/[issueNumber]/session` - Get existing session ID\n\n**This task also includes context injection** - when a session is created, the full GitHub issue context is injected.\n\n## Why\n\nThe frontend needs a way to:\n1. Get or create a session when opening an issue\n2. Know which session ID to use for chat\n\n## Implementation\n\n### GET /api/projects/[id]/issues/[issueNumber]/session\n\nReturns existing session ID if alive, or null.\n\n```typescript\n// Response (200)\n{ sessionId: string | null }\n\n// Response (404)\n{ error: \"Issue not found\" }\n```\n\n**Logic:**\n1. Get project from config (need project.path for OpenCode)\n2. Check sessionStorage for existing mapping\n3. If mapping exists, verify session is alive via OpenCodeService.isSessionAlive(projectPath, sessionId)\n4. If alive, touch session timestamp, return sessionId\n5. If dead, remove mapping, return null\n\n### POST /api/projects/[id]/issues/[issueNumber]/session\n\nCreates new session with context injection.\n\n```typescript\n// Response (201)\n{ sessionId: string }\n\n// Response (500)\n{ error: \"Failed to create session\" }\n```\n\n**Logic:**\n1. Get project from config (need project.path)\n2. Fetch issue details (title, body, comments) via gh CLI\n3. Create new OpenCode session via openCodeService.createSession(projectPath, title)\n4. Inject issue context via openCodeService.injectContext(projectPath, sessionId, context)\n5. Save session mapping to sessionStorage (with projectPath)\n6. Return sessionId\n\n## Context Injection Format\n\n```typescript\nfunction buildIssueContext(issue: GitHubIssue): string {\n  const comments = issue.comments?.length\n    ? issue.comments.map(c =\u003e\n        `**@${c.author.login}** (${new Date(c.createdAt).toLocaleDateString()}):\\n${c.body}`\n      ).join(\"\\n\\n\")\n    : \"No comments yet.\"\n\n  return `## GitHub Issue #${issue.number}\n\n**Title:** ${issue.title}\n**State:** ${issue.state}\n**Author:** @${issue.author.login}\n**Labels:** ${issue.labels.map(l =\u003e l.name).join(\", \") || \"None\"}\n**Created:** ${new Date(issue.createdAt).toLocaleDateString()}\n\n### Description\n${issue.body || \"No description provided.\"}\n\n### Comments\n${comments}\n\n---\nYou are helping discuss this GitHub issue. You can read the codebase to answer questions and suggest approaches, but you cannot modify any files. Focus on exploration and understanding.`\n}\n```\n\n## Key Design Points\n\n1. **Pass projectPath to OpenCode** - Required for OpenCode to know which project\n2. **Context uses synthetic: true** - On the text part, not the body\n3. **Context uses noReply: true** - Do not generate AI response for injection\n4. **Store projectPath in sessionStorage** - For future verification\n\n## Files to Create\n\n- `src/app/api/projects/[id]/issues/[issueNumber]/session/route.ts`\n\n## Dependencies\n\n- OpenCodeService (task 1.2)\n- SessionStorageService (task 1.3)\n- Existing issue detail API (for fetching issue data)\n\n## Acceptance Criteria\n\n- [ ] GET returns sessionId if session exists and alive\n- [ ] GET returns null if no session\n- [ ] GET removes stale mappings for dead sessions\n- [ ] POST creates new session with correct projectPath\n- [ ] POST injects full issue context with synthetic: true, noReply: true\n- [ ] POST saves mapping to sessionStorage with projectPath\n- [ ] Proper error handling for missing project/issue\n- [ ] Follows Next.js 15 async params pattern","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:35:12.798714-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Session API endpoints created with GET and POST handlers, context injection, sessionStorage integration","dependencies":[{"issue_id":"maestro-fyp.1.4","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:35:12.80093-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.1.4","depends_on_id":"maestro-fyp.1.2","type":"blocks","created_at":"2025-12-30T10:39:14.362071-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.1.4","depends_on_id":"maestro-fyp.1.3","type":"blocks","created_at":"2025-12-30T10:39:14.39511-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.1.5","title":"Create OpenCode health check API endpoint","description":"## Task\n\nCreate `GET /api/health/opencode` - An endpoint to check if the OpenCode server is reachable.\n\n## Why\n\nThe frontend needs to know if OpenCode is available before attempting to use it. This enables:\n- Showing helpful error messages (\"Start opencode serve\")\n- Disabling chat UI when OpenCode is down\n- Periodic connectivity checks\n\n## Implementation\n\nUse the SDK's built-in `client.global.health()` method:\n\n```typescript\n// src/app/api/health/opencode/route.ts\n\nimport { openCodeService } from \"@/lib/services/opencode\"\nimport { NextResponse } from \"next/server\"\n\nexport async function GET() {\n  try {\n    const healthy = await openCodeService.isHealthy()\n    \n    if (healthy) {\n      return NextResponse.json({\n        status: \"healthy\",\n        url: process.env.OPENCODE_URL || \"http://localhost:4096\"\n      })\n    } else {\n      return NextResponse.json({\n        status: \"unhealthy\",\n        error: \"OpenCode server not responding\"\n      }, { status: 503 })\n    }\n  } catch (error) {\n    return NextResponse.json({\n      status: \"unhealthy\",\n      error: error instanceof Error ? error.message : \"Unknown error\"\n    }, { status: 503 })\n  }\n}\n```\n\n## SDK Health Check\n\nThe SDK provides `client.global.health()` which returns:\n```typescript\n{ healthy: true, version: string }\n```\n\nThis is the recommended way to check connectivity.\n\n## Response Format\n\n```typescript\n// Success (200)\n{\n  status: \"healthy\",\n  url: \"http://localhost:4096\"\n}\n\n// Failure (503)\n{\n  status: \"unhealthy\",\n  error: \"Connection refused\" // or similar\n}\n```\n\n## Usage in Frontend\n\n```typescript\n// Poll health periodically\nconst { data: health } = useQuery({\n  queryKey: [\"opencode-health\"],\n  queryFn: () =\u003e fetch(\"/api/health/opencode\").then(r =\u003e r.json()),\n  refetchInterval: 30000, // Every 30 seconds\n})\n\nif (health?.status !== \"healthy\") {\n  // Show error banner\n}\n```\n\n## Files to Create\n\n- `src/app/api/health/opencode/route.ts`\n\n## Dependencies\n\n- OpenCodeService.isHealthy() method (uses client.global.health())\n\n## Acceptance Criteria\n\n- [ ] Returns 200 with status: \"healthy\" when OpenCode is running\n- [ ] Returns 503 with status: \"unhealthy\" when OpenCode is down\n- [ ] Includes error message for debugging\n- [ ] Uses SDK's built-in health check (not custom implementation)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T10:35:20.199271-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Health check endpoint created at /api/health/opencode with 200/503 status handling","dependencies":[{"issue_id":"maestro-fyp.1.5","depends_on_id":"maestro-fyp.1","type":"parent-child","created_at":"2025-12-30T10:35:20.201679-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.1.5","depends_on_id":"maestro-fyp.1.2","type":"blocks","created_at":"2025-12-30T10:39:14.427245-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.2","title":"Phase 2: Chat Integration","description":"## Phase 2: Chat Integration\n\nThis phase connects the existing Issue View UI to the OpenCode backend, replacing mock responses with real AI conversations.\n\n### Why This Phase Second?\n\nWith infrastructure in place (Phase 1), we can now wire up the actual chat experience. This is the core user value - being able to discuss GitHub issues with an AI that understands the codebase.\n\n### Key Behaviors\n\n**Context Injection (handled in Phase 1)**\nWhen a session is created (task 1.4), we inject the full GitHub issue context. This is part of session creation, not a separate step.\n\n**Read-Only Mode**\nThe agent MUST NOT modify files during issue discussion. We enforce this by disabling tools:\n```typescript\ntools: {\n  bash: false,\n  write: false,\n  edit: false\n}\n```\n\nThe agent can still read files, search, and explore - just not change anything.\n\n**SSE Streaming (using promptAsync)**\nReal-time response streaming is critical for UX:\n- User sees text appear as it's generated\n- Use `promptAsync()` to start the prompt\n- Subscribe to `event.subscribe()` for streaming updates\n- Listen for `message.part.updated` events with `delta` property\n\n### Session Lifecycle\n\n1. User opens issue → Check for existing session (via API)\n2. If session exists and alive → Resume it\n3. If no session or dead → Create new (context injection happens automatically)\n4. User sends message → Stream response via SSE\n5. Session dies mid-conversation → Auto-recreate, show toast\n\n### UI Updates\n\nThe existing Issue View page (`src/app/project/[id]/issue/[issueNumber]/page.tsx`) has:\n- Split panel layout (desktop)\n- Tabbed interface (mobile)\n- Mock chat with setTimeout\n\nWe need to:\n- Replace mock with real OpenCode integration\n- Add streaming text display\n- Add typing indicator\n- Handle reconnection gracefully\n\n### Task Changes Note\n\nTask 2.2 (Implement context injection) was **merged into task 1.4** since context injection is inherently part of session creation. This phase now has 3 tasks instead of 4.\n\n### Dependencies\n\n- Phase 1 complete (OpenCodeService, SessionStorage, APIs)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:33:34.463131-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"All Phase 2 subtasks completed: Issue View connected, SSE streaming, session reconnection","dependencies":[{"issue_id":"maestro-fyp.2","depends_on_id":"maestro-fyp","type":"parent-child","created_at":"2025-12-30T10:33:34.463652-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2","depends_on_id":"maestro-fyp.1","type":"blocks","created_at":"2025-12-30T10:39:15.586636-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.2.1","title":"Connect Issue View to OpenCode SDK","description":"## Task\n\nReplace the mock setTimeout-based chat in the Issue View page with real OpenCode SDK calls.\n\n## Why\n\nCurrently the Issue View page at `src/app/project/[id]/issue/[issueNumber]/page.tsx` uses mock responses. This task connects it to the real OpenCode backend.\n\n## Current Implementation\n\n```typescript\n// Current mock pattern (to be replaced)\nconst handleSendMessage = async (content: string) =\u003e {\n  // Add user message\n  setMessages(prev =\u003e [...prev, { role: \"user\", content }])\n  \n  // Mock AI response with setTimeout\n  setTimeout(() =\u003e {\n    setMessages(prev =\u003e [...prev, { \n      role: \"assistant\", \n      content: \"This is a mock response...\" \n    }])\n  }, 1500)\n}\n```\n\n## New Implementation\n\n```typescript\nconst handleSendMessage = async (content: string) =\u003e {\n  // Add user message\n  setMessages(prev =\u003e [...prev, { role: \"user\", content }])\n  setIsLoading(true)\n  \n  try {\n    // Get or create session\n    let sessionId = await getSessionId()\n    if (!sessionId) {\n      sessionId = await createSession()\n    }\n    \n    // Send message in read-only mode\n    const response = await fetch(`/api/projects/${projectId}/issues/${issueNumber}/chat`, {\n      method: \"POST\",\n      body: JSON.stringify({ message: content, sessionId })\n    })\n    \n    // Handle streaming response (see SSE task)\n  } catch (error) {\n    // Handle error (see error handling phase)\n  } finally {\n    setIsLoading(false)\n  }\n}\n```\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Phase 1 complete (session APIs exist)\n\n## Acceptance Criteria\n\n- [ ] Chat sends real messages to OpenCode\n- [ ] Responses display correctly\n- [ ] Loading state shown while waiting\n- [ ] Input disabled during response\n- [ ] Session created automatically on first message","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:35:47.836573-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Issue View connected to OpenCode SDK with session creation, real chat, streaming responses","dependencies":[{"issue_id":"maestro-fyp.2.1","depends_on_id":"maestro-fyp.2","type":"parent-child","created_at":"2025-12-30T10:35:47.837216-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.1","depends_on_id":"maestro-fyp.1.4","type":"blocks","created_at":"2025-12-30T10:39:18.393914-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.2.2","title":"Implement context injection on session start","description":"## Task\n\nWhen a new session is created, inject the full GitHub issue context so the AI understands what is being discussed.\n\n## Why\n\nWithout context injection, the AI would have no idea what issue the user is discussing. By injecting title, body, comments, and instructions upfront, every message benefits from this context.\n\n## How Context Injection Works\n\nOpenCode SDK supports `synthetic: true` messages that appear in the context but were not typed by the user:\n\n```typescript\nawait client.session.prompt({\n  path: { id: sessionId },\n  body: {\n    noReply: true,      // Do not generate AI response\n    parts: [{\n      type: \"text\",\n      text: buildIssueContext(issue),\n      synthetic: true   // Mark as system-injected, not user message\n    }]\n  }\n})\n```\n\n## Context Format\n\n```markdown\n## GitHub Issue #42\n\n**Title:** Add user authentication flow\n**State:** open\n**Author:** @erikjohansson\n**Labels:** feature, authentication\n**Created:** 12/30/2024\n\n### Description\nWe need to implement OAuth2 authentication using Google and GitHub providers.\n\n### Comments\n**@alice** (12/29/2024):\nShould we also support email/password login?\n\n**@bob** (12/30/2024):\nI think OAuth only is fine for MVP.\n\n---\nYou are helping discuss this GitHub issue. You can read the codebase to answer questions and suggest approaches, but you cannot modify any files. Focus on exploration and understanding.\n```\n\n## Key Points\n\n1. **noReply: true** - We do not want AI to respond to context injection\n2. **synthetic: true** - Marks this as system context, not user message\n3. **Read-only instructions** - Clearly state the agent cannot modify files\n4. **Full context** - Include all comments so AI has complete picture\n\n## Files to Modify\n\n- `src/app/api/projects/[id]/issues/[issueNumber]/session/route.ts` (POST handler)\n\n## Dependencies\n\n- Session creation API exists (Phase 1)\n\n## Acceptance Criteria\n\n- [ ] Context injected uses noReply: true\n- [ ] Context injected uses synthetic: true\n- [ ] All issue metadata included (title, state, author, labels, created)\n- [ ] Full body text included\n- [ ] All comments included with authors and dates\n- [ ] Read-only instructions included\n- [ ] No AI response generated from injection","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:36:03.538445-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Merged into task 1.4 (Create session management API endpoints). Context injection is inherently part of session creation, not a separate task.","dependencies":[{"issue_id":"maestro-fyp.2.2","depends_on_id":"maestro-fyp.2","type":"parent-child","created_at":"2025-12-30T10:36:03.542055-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.2","depends_on_id":"maestro-fyp.1.4","type":"blocks","created_at":"2025-12-30T10:39:18.427815-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.2.3","title":"Add SSE streaming for responses","description":"## Task\n\nImplement Server-Sent Events (SSE) streaming so AI responses appear progressively as they are generated.\n\n## Why\n\nWithout streaming:\n- User stares at spinner for 10+ seconds\n- No feedback on response length\n- Feels unresponsive\n\nWith streaming:\n- Text appears word-by-word\n- User can start reading immediately\n- Feels interactive and fast\n\n## OpenCode Streaming Pattern\n\n**IMPORTANT**: For streaming, you must use the async/event pattern:\n1. Call `session.promptAsync()` to start the prompt (returns immediately)\n2. Subscribe to `event.subscribe()` to get streaming updates\n3. Listen for `message.part.updated` events with `delta` property\n\n```typescript\n// Start the prompt (non-blocking)\nawait client.session.promptAsync({\n  path: { id: sessionId },\n  query: { directory: projectPath },\n  body: {\n    tools: { bash: false, write: false, edit: false },\n    parts: [{ type: \"text\", text: userMessage }]\n  }\n})\n\n// Subscribe to events for streaming\nconst events = await client.event.subscribe({\n  query: { directory: projectPath }\n})\n\nfor await (const event of events.stream) {\n  switch (event.type) {\n    case \"session.status\":\n      // { status: \"busy\" | \"idle\" }\n      if (event.properties.status === \"idle\") {\n        // Response complete\n        break\n      }\n      break\n    case \"message.part.updated\":\n      // { part: Part, delta?: string }\n      if (event.properties.delta) {\n        // Stream the delta text\n        controller.enqueue(event.properties.delta)\n      }\n      break\n    case \"session.error\":\n      // { error: ... }\n      // Handle error\n      break\n  }\n}\n```\n\n## Create Chat API Endpoint\n\n```typescript\n// src/app/api/projects/[id]/issues/[issueNumber]/chat/route.ts\n\nimport { openCodeService } from \"@/lib/services/opencode\"\nimport { configService } from \"@/lib/services/config\"\nimport { NextResponse } from \"next/server\"\n\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise\u003c{ id: string; issueNumber: string }\u003e }\n) {\n  const { id } = await params\n  const { message, sessionId } = await request.json()\n\n  const project = await configService.getProject(id)\n  if (!project) {\n    return NextResponse.json({ error: \"Project not found\" }, { status: 404 })\n  }\n\n  // Create SSE stream\n  const stream = new ReadableStream({\n    async start(controller) {\n      try {\n        // Start async prompt (returns immediately)\n        await openCodeService.sendReadOnlyMessageAsync(project.path, sessionId, message)\n        \n        // Subscribe to events\n        const events = await openCodeService.subscribeToEvents(project.path)\n        \n        for await (const event of events) {\n          if (event.type === \"message.part.updated\" \u0026\u0026 event.properties.delta) {\n            const data = `data: ${JSON.stringify({ delta: event.properties.delta })}\\n\\n`\n            controller.enqueue(new TextEncoder().encode(data))\n          }\n          if (event.type === \"session.status\" \u0026\u0026 event.properties.status === \"idle\") {\n            controller.enqueue(new TextEncoder().encode(\"data: [DONE]\\n\\n\"))\n            controller.close()\n            break\n          }\n          if (event.type === \"session.error\") {\n            const data = `data: ${JSON.stringify({ error: event.properties.error })}\\n\\n`\n            controller.enqueue(new TextEncoder().encode(data))\n            controller.close()\n            break\n          }\n        }\n      } catch (error) {\n        controller.error(error)\n      }\n    }\n  })\n\n  return new Response(stream, {\n    headers: {\n      \"Content-Type\": \"text/event-stream\",\n      \"Cache-Control\": \"no-cache\",\n      \"Connection\": \"keep-alive\"\n    }\n  })\n}\n```\n\n## Frontend Consumption\n\n```typescript\nconst sendMessage = async (content: string) =\u003e {\n  setIsStreaming(true)\n  setCurrentResponse(\"\")\n  \n  const response = await fetch(`/api/projects/${projectId}/issues/${issueNumber}/chat`, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ message: content, sessionId })\n  })\n\n  const reader = response.body!.getReader()\n  const decoder = new TextDecoder()\n\n  while (true) {\n    const { done, value } = await reader.read()\n    if (done) break\n    \n    const text = decoder.decode(value)\n    const lines = text.split(\"\\n\\n\")\n    \n    for (const line of lines) {\n      if (line.startsWith(\"data: \")) {\n        const data = line.slice(6)\n        if (data === \"[DONE]\") {\n          // Complete\n        } else {\n          const { delta, error } = JSON.parse(data)\n          if (delta) {\n            setCurrentResponse(prev =\u003e prev + delta)\n          }\n          if (error) {\n            // Handle error\n          }\n        }\n      }\n    }\n  }\n  \n  setIsStreaming(false)\n}\n```\n\n## Files to Create/Modify\n\n- `src/app/api/projects/[id]/issues/[issueNumber]/chat/route.ts` (new)\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx` (consume stream)\n\n## Key Design Points\n\n1. **Use promptAsync, not prompt** - For streaming, use the async variant\n2. **Subscribe to events** - Get real-time updates via SSE\n3. **Pass projectPath** - Required for OpenCode to know the context\n4. **[DONE] sentinel** - Signal completion to frontend\n5. **Filter for correct session** - Events stream includes all sessions; filter if needed\n\n## Dependencies\n\n- OpenCodeService with subscribeToEvents() and sendReadOnlyMessageAsync() methods (task 1.2)\n\n## Acceptance Criteria\n\n- [ ] Chat API endpoint returns SSE stream\n- [ ] Uses promptAsync for non-blocking prompt\n- [ ] Subscribes to OpenCode events for streaming\n- [ ] Frontend consumes stream correctly\n- [ ] Text appears incrementally as generated\n- [ ] Stream closes when response complete\n- [ ] Error events handled gracefully","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T10:36:18.457188-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"SSE streaming chat API created with event subscription, delta streaming, proper close/error handling","dependencies":[{"issue_id":"maestro-fyp.2.3","depends_on_id":"maestro-fyp.2","type":"parent-child","created_at":"2025-12-30T10:36:18.459443-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.3","depends_on_id":"maestro-fyp.1.2","type":"blocks","created_at":"2025-12-30T10:39:18.461563-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.2.4","title":"Handle session reconnection","description":"## Task\n\nGracefully handle scenarios where an OpenCode session dies mid-conversation and needs to be recreated.\n\n## Why\n\nSessions can die for various reasons:\n- OpenCode server restart\n- Network interruption\n- Session timeout (if implemented)\n- Server crash\n\nUsers should not lose their conversation context or have to manually intervene.\n\n## Reconnection Flow\n\n1. User sends message\n2. Request fails with session error\n3. Detect session is dead\n4. Remove stale mapping from sessionStorage\n5. Create new session with context injection\n6. Retry the failed message\n7. Show brief toast: \"Reconnecting...\"\n\n## Implementation\n\n```typescript\nconst sendMessage = async (content: string) =\u003e {\n  try {\n    await sendToSession(sessionId, content)\n  } catch (error) {\n    if (isSessionDead(error)) {\n      // Show reconnecting toast\n      toast(\"Reconnecting to AI...\", { duration: 2000 })\n      \n      // Remove dead session\n      await fetch(`/api/.../session`, { method: \"DELETE\" })\n      \n      // Create new session (auto-injects context)\n      const { sessionId: newId } = await fetch(`/api/.../session`, {\n        method: \"POST\"\n      }).then(r =\u003e r.json())\n      \n      // Update local state\n      setSessionId(newId)\n      \n      // Retry message\n      await sendToSession(newId, content)\n    } else {\n      throw error // Other errors bubble up\n    }\n  }\n}\n\nfunction isSessionDead(error: unknown): boolean {\n  // Check for specific error codes/messages from OpenCode\n  // that indicate session no longer exists\n  return error.message?.includes(\"session not found\") ||\n         error.status === 404\n}\n```\n\n## UX Considerations\n\n1. **Transparent to user** - They should barely notice reconnection\n2. **Brief interruption** - Show toast, not blocking modal\n3. **No context loss** - New session gets full issue context\n4. **Retry automatic** - Do not make user resend message\n\n## Limitation\n\nThe new session will not have prior chat history (only the issue context). This is by design - chat history is ephemeral, summaries should be saved to GitHub if important.\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n- Possibly add DELETE handler to session route\n\n## Dependencies\n\n- Session creation with context injection (previous task)\n\n## Acceptance Criteria\n\n- [ ] Dead session detected automatically\n- [ ] New session created with context\n- [ ] Failed message retried on new session\n- [ ] User sees brief \"Reconnecting...\" toast\n- [ ] No user intervention required\n- [ ] Works for network interruptions too","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T10:36:33.657835-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Session reconnection implemented with auto-retry, toast notification, and infinite loop prevention","dependencies":[{"issue_id":"maestro-fyp.2.4","depends_on_id":"maestro-fyp.2","type":"parent-child","created_at":"2025-12-30T10:36:33.659782-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.4","depends_on_id":"maestro-fyp.2.1","type":"blocks","created_at":"2025-12-30T10:39:18.494352-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.2.4","depends_on_id":"maestro-fyp.2.3","type":"blocks","created_at":"2025-12-30T10:39:18.526762-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.3","title":"Phase 3: GitHub Integration","description":"## Phase 3: GitHub Integration\n\nThis phase completes the bidirectional GitHub integration, allowing conversation context to flow back into the issue as persistent comments.\n\n### Why This Phase Third?\n\nWith chat working (Phase 2), users can have productive discussions. But those discussions are ephemeral - if the session dies, the conversation is lost. By enabling summary persistence to GitHub, we create lasting value from each discussion.\n\n### Design Philosophy\n\n**On-Demand, Not Automatic**\nWe explicitly chose NOT to auto-save conversations because:\n- Not every conversation is worth persisting\n- Users should curate what goes into the issue\n- Avoids cluttering issues with noise\n- Keeps user in control\n\n**Summary Generation**\nInstead of dumping raw chat logs, we ask the AI to summarize:\n- Key decisions made\n- Open questions identified\n- Suggested next steps\n- Relevant code references\n\nThis creates higher-quality GitHub comments that future readers can understand.\n\n### User Flow\n\n1. User clicks \"Save Summary\" button in chat footer\n2. Modal opens with auto-generated summary\n3. User can edit/refine the summary\n4. Preview shows how it will appear as GitHub comment\n5. User clicks \"Post to Issue\" → Comment added via `gh issue comment`\n6. Success toast, modal closes\n\n### Comment Format\n\n```markdown\n## Discussion Summary\n\n[Agent-generated summary, user-edited]\n\n---\n*Generated from Maestro discussion on [date]*\n```\n\nThe footer provides attribution and context for why this comment exists.\n\n### Comments Display\n\nThe existing API already fetches comments (`GET /api/projects/[id]/issues/[issueNumber]`), but the UI doesn't render them. This phase adds:\n- Comments thread in Issue Details panel\n- Author avatars/names\n- Timestamps\n- Markdown rendering\n\n### Dependencies\n\n- Phase 2 complete (working chat)\n- Existing issue detail API (already fetches comments)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T10:33:34.51701-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"All Phase 3 subtasks completed: comments display, comment posting API, save summary modal","dependencies":[{"issue_id":"maestro-fyp.3","depends_on_id":"maestro-fyp","type":"parent-child","created_at":"2025-12-30T10:33:34.5175-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.3","depends_on_id":"maestro-fyp.2","type":"blocks","created_at":"2025-12-30T10:39:24.1577-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.3.1","title":"Display comments in Issue Details panel","description":"## Task\n\nRender GitHub issue comments in the Issue Details panel (left side of split view).\n\n## Why\n\nThe existing API (`GET /api/projects/[id]/issues/[issueNumber]`) already fetches comments, but the UI does not render them. Comments provide important context:\n- Previous discussions\n- Decisions made\n- Questions raised\n\nUsers need to see this alongside the chat to have full context.\n\n## PARALLELIZATION NOTE\n\n**This task has NO blocking dependencies.** It is pure UI work using data the API already returns. It can be worked on in parallel with Phase 1 and Phase 2 tasks.\n\n## Current State\n\nThe API response already includes:\n```typescript\n{\n  number: 42,\n  title: \"...\",\n  body: \"...\",\n  state: \"open\",\n  comments: [\n    {\n      author: { login: \"alice\" },\n      body: \"Should we support email/password?\",\n      createdAt: \"2024-12-29T...\"\n    }\n  ]\n}\n```\n\nBut the UI only renders title, state, and body.\n\n## Implementation\n\n```tsx\n// In Issue Details panel\n{issue.comments \u0026\u0026 issue.comments.length \u003e 0 \u0026\u0026 (\n  \u003cdiv className=\"mt-6\"\u003e\n    \u003ch3 className=\"text-sm font-medium text-muted-foreground mb-3\"\u003e\n      Comments ({issue.comments.length})\n    \u003c/h3\u003e\n    \u003cdiv className=\"space-y-4\"\u003e\n      {issue.comments.map((comment, i) =\u003e (\n        \u003cdiv key={i} className=\"border-l-2 border-muted pl-4\"\u003e\n          \u003cdiv className=\"flex items-center gap-2 text-sm text-muted-foreground\"\u003e\n            \u003cspan className=\"font-medium\"\u003e@{comment.author.login}\u003c/span\u003e\n            \u003cspan\u003e•\u003c/span\u003e\n            \u003cspan\u003e{formatDate(comment.createdAt)}\u003c/span\u003e\n          \u003c/div\u003e\n          \u003cdiv className=\"mt-1 text-sm whitespace-pre-wrap\"\u003e\n            {comment.body}\n          \u003c/div\u003e\n        \u003c/div\u003e\n      ))}\n    \u003c/div\u003e\n  \u003c/div\u003e\n)}\n```\n\n## Update GitHubIssue Interface\n\nThe page's interface needs to include comments:\n```typescript\ninterface GitHubIssue {\n  // ... existing fields\n  comments?: {\n    author: { login: string }\n    body: string\n    createdAt: string\n  }[]\n}\n```\n\n## Markdown Rendering\n\nFor MVP, plain text with whitespace preservation is acceptable. Consider adding `react-markdown` later for proper rendering. The comment body might contain:\n- Code blocks\n- Links\n- Lists\n- Bold/italic\n\n## Empty State\n\nIf no comments, either:\n- Hide the Comments section entirely (cleaner), OR\n- Show subtle \"No comments yet.\" message\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n**NONE** - This is pure UI work. The API already returns comments.\n\n## Acceptance Criteria\n\n- [ ] Comments section appears in Issue Details panel\n- [ ] Each comment shows author name\n- [ ] Each comment shows creation date (formatted)\n- [ ] Comment body is displayed with whitespace preserved\n- [ ] Comments count shown in header\n- [ ] Empty state handled gracefully (hide section or show message)\n- [ ] Scrollable if many comments (inherits from panel scroll)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T10:36:51.418663-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Comments section added to Issue Details panel with author, date formatting, and empty state handling","deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.3.2","title":"Add comment posting API endpoint","description":"## Task\n\nCreate `POST /api/projects/[id]/issues/[issueNumber]/comment` - An endpoint to add comments to GitHub issues.\n\n## Why\n\nThe \"Save Summary\" feature needs a way to post conversation summaries as GitHub comments. This endpoint provides that capability.\n\n## Implementation\n\n```typescript\n// src/app/api/projects/[id]/issues/[issueNumber]/comment/route.ts\n\nimport { exec } from \"child_process\"\nimport { promisify } from \"util\"\nimport { configService } from \"@/lib/services/config\"\nimport { NextResponse } from \"next/server\"\n\nconst execAsync = promisify(exec)\n\nexport async function POST(\n  request: Request,\n  { params }: { params: Promise\u003c{ id: string; issueNumber: string }\u003e }\n) {\n  const { id, issueNumber } = await params\n  const { body } = await request.json()\n\n  if (!body || typeof body !== \"string\") {\n    return NextResponse.json(\n      { error: \"Comment body is required\" },\n      { status: 400 }\n    )\n  }\n\n  const project = await configService.getProject(id)\n  if (!project) {\n    return NextResponse.json(\n      { error: \"Project not found\" },\n      { status: 404 }\n    )\n  }\n\n  try {\n    // Use gh CLI to add comment\n    // Escape the body for shell safety\n    const escapedBody = body.replace(/\"/g, \"\\\\\\\"\")\n    \n    await execAsync(\n      `gh issue comment ${issueNumber} --body \"${escapedBody}\"`,\n      { cwd: project.path }\n    )\n\n    return NextResponse.json({ success: true }, { status: 201 })\n  } catch (error) {\n    console.error(\"Failed to post comment:\", error)\n    return NextResponse.json(\n      { error: \"Failed to post comment to GitHub\" },\n      { status: 500 }\n    )\n  }\n}\n```\n\n## Shell Escaping Consideration\n\nThe comment body might contain:\n- Quotes\n- Backticks  \n- Newlines\n- Special characters\n\nA safer approach might use stdin:\n```bash\necho \"$body\" | gh issue comment 42 --body-file -\n```\n\nOr write to temp file first.\n\n## Request/Response\n\n```typescript\n// Request\nPOST /api/projects/abc123/issues/42/comment\n{ \"body\": \"## Summary\\n\\nThis is the discussion summary...\" }\n\n// Success (201)\n{ \"success\": true }\n\n// Error (400)\n{ \"error\": \"Comment body is required\" }\n\n// Error (500)\n{ \"error\": \"Failed to post comment to GitHub\" }\n```\n\n## Files to Create\n\n- `src/app/api/projects/[id]/issues/[issueNumber]/comment/route.ts`\n\n## Dependencies\n\n- Project config service (exists)\n- gh CLI authenticated (prerequisite)\n\n## Acceptance Criteria\n\n- [ ] POST creates comment on GitHub issue\n- [ ] Handles multiline body correctly\n- [ ] Handles special characters safely\n- [ ] Returns 201 on success\n- [ ] Returns 400 if body missing\n- [ ] Returns 404 if project not found\n- [ ] Returns 500 on gh CLI error","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T10:37:05.505163-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Comment posting API created with stdin approach for safe shell handling","dependencies":[{"issue_id":"maestro-fyp.3.2","depends_on_id":"maestro-fyp.3","type":"parent-child","created_at":"2025-12-30T10:37:05.507115-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.3.2","depends_on_id":"maestro-fyp.2.1","type":"blocks","created_at":"2025-12-30T10:39:24.188788-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.3.3","title":"Implement Save Summary modal","description":"## Task\n\nCreate a modal dialog that generates a conversation summary and allows the user to edit and post it to the GitHub issue.\n\n## Why\n\nConversations are ephemeral - when the session ends, they are gone. By saving summaries to GitHub:\n- Key decisions are preserved\n- Future sessions have context\n- Other team members can see discussions\n- Issues become richer documentation\n\n## User Flow\n\n1. User clicks \"Save Summary\" button in chat footer\n2. Modal opens, shows \"Generating summary...\" spinner\n3. AI generates summary of conversation (sync call, waits for response)\n4. Summary displayed in editable textarea\n5. Preview shows how it appears as GitHub comment\n6. User can edit the summary\n7. User clicks \"Post to Issue\"\n8. Comment posted via API\n9. Success toast, modal closes\n10. Comments list refreshes (optional)\n\n## Summary Generation\n\nUse a **synchronous** prompt (not async/streaming) to generate the summary:\n\n```typescript\n// In the modal component\nconst generateSummary = async () =\u003e {\n  setIsGenerating(true)\n  try {\n    const response = await fetch(`/api/projects/${projectId}/issues/${issueNumber}/summary`, {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ sessionId })\n    })\n    const { summary } = await response.json()\n    setSummaryText(summary)\n  } finally {\n    setIsGenerating(false)\n  }\n}\n```\n\n## Summary API Endpoint\n\nCreate a new endpoint for summary generation:\n\n```typescript\n// src/app/api/projects/[id]/issues/[issueNumber]/summary/route.ts\n\nexport async function POST(request: Request, { params }) {\n  const { id } = await params\n  const { sessionId } = await request.json()\n  \n  const project = await configService.getProject(id)\n  if (!project) {\n    return NextResponse.json({ error: \"Project not found\" }, { status: 404 })\n  }\n  \n  const summary = await openCodeService.generateSummary(project.path, sessionId)\n  \n  return NextResponse.json({ summary })\n}\n```\n\n## UI Design\n\n```\n┌────────────────────────────────────────────────────────┐\n│ Save Discussion Summary                           [X]  │\n├────────────────────────────────────────────────────────┤\n│                                                        │\n│  The AI has summarized your discussion:                │\n│                                                        │\n│  ┌──────────────────────────────────────────────────┐  │\n│  │ ## Summary                                       │  │\n│  │                                                  │  │\n│  │ We discussed implementing OAuth2 authentication │  │\n│  │ using Google and GitHub providers. Key decision:│  │\n│  │ - Start with Google OAuth only for MVP          │  │\n│  │ - Add GitHub OAuth in v2                        │  │\n│  │                                                  │  │\n│  └──────────────────────────────────────────────────┘  │\n│  (editable textarea)                                   │\n│                                                        │\n├────────────────────────────────────────────────────────┤\n│                        [Cancel]  [Post to Issue]       │\n└────────────────────────────────────────────────────────┘\n```\n\n## Comment Format\n\nWhen posting to GitHub:\n```markdown\n## Discussion Summary\n\n[User-edited summary text]\n\n---\n*Generated from Maestro discussion on [date]*\n```\n\n## Component Structure\n\n```typescript\n// src/components/save-summary-modal/SaveSummaryModal.tsx\n\ninterface SaveSummaryModalProps {\n  open: boolean\n  onOpenChange: (open: boolean) =\u003e void\n  projectId: string\n  issueNumber: number\n  sessionId: string\n  onSuccess?: () =\u003e void\n}\n\nexport function SaveSummaryModal({ ... }: SaveSummaryModalProps) {\n  const [summary, setSummary] = useState(\"\")\n  const [isGenerating, setIsGenerating] = useState(true)\n  const [isPosting, setIsPosting] = useState(false)\n\n  // Generate summary on open\n  useEffect(() =\u003e {\n    if (open) {\n      generateSummary()\n    }\n  }, [open])\n\n  const generateSummary = async () =\u003e { ... }\n  const handlePost = async () =\u003e { ... }\n\n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent\u003e\n        {/* ... */}\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  )\n}\n```\n\n## Files to Create\n\n- `src/components/save-summary-modal/SaveSummaryModal.tsx`\n- `src/components/save-summary-modal/index.ts`\n- `src/app/api/projects/[id]/issues/[issueNumber]/summary/route.ts`\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx` (add button + modal)\n\n## Dependencies\n\n- OpenCodeService.generateSummary() method (task 1.2)\n- Comment posting API (task 3.2)\n\n## Acceptance Criteria\n\n- [ ] Modal opens from \"Save Summary\" button\n- [ ] Summary auto-generated on open\n- [ ] Loading state while generating\n- [ ] Summary editable in textarea\n- [ ] Cancel closes without posting\n- [ ] Post creates GitHub comment with footer\n- [ ] Success toast shown\n- [ ] Modal closes on success\n- [ ] Error handling for generation/posting failures","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T10:37:30.225662-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Save Summary modal implemented with summary generation, editable textarea, GitHub posting, and error handling","dependencies":[{"issue_id":"maestro-fyp.3.3","depends_on_id":"maestro-fyp.3","type":"parent-child","created_at":"2025-12-30T10:37:30.228062-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.3.3","depends_on_id":"maestro-fyp.3.2","type":"blocks","created_at":"2025-12-30T10:39:24.222617-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.3.3","depends_on_id":"maestro-fyp.1.2","type":"blocks","created_at":"2025-12-30T10:50:52.759743-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.4","title":"Phase 4: Polish \u0026 Error Handling","description":"## Phase 4: Polish \u0026 Error Handling\n\nThis phase adds robustness, better UX, and handles edge cases that make the difference between a prototype and a production-quality feature.\n\n### Why This Phase Last?\n\nCore functionality must work first (Phases 1-3). Polish is important but not blocking. Users can use a working feature with rough edges; they can't use a polished feature that doesn't work.\n\n### Error Handling Strategy\n\n**Hierarchy of Errors**\n```\n┌─────────────────────────────────────────────┐\n│ [Global Banner - server connectivity]       │  ← Persistent until resolved\n├─────────────────────────────────────────────┤\n│   Issue Details        │  Chat Area         │\n│   [Inline error if     │  [Inline error if  │  ← Contextual errors\n│    issue fetch fails]  │   session fails]   │\n│                        │  [Toast for        │  ← Transient notifications\n│                        │   minor issues]    │\n└─────────────────────────────────────────────┘\n```\n\n**Specific Error Scenarios**\n| Scenario | UI Behavior |\n|----------|-------------|\n| OpenCode unreachable | Banner: \"Cannot connect to OpenCode server\" + Retry |\n| GitHub API failure | Inline error + Retry button |\n| Rate limit | Banner with reset time |\n| Session dies | Auto-recreate with \"Reconnecting...\" toast |\n| Message send fails | Keep message in input, show error, enable retry |\n| Issue not found | 404 page with link back |\n\n### UX Polish\n\n**Panel Resizing**\nCurrently hardcoded at 400px. Should be draggable with:\n- Mouse drag handle\n- Min/max constraints (200px - 50% of viewport)\n- Persist preference to localStorage\n\n**Mobile Unread Indicator**\nWhen on Details tab and agent responds:\n- Show badge on Chat tab\n- Clear badge when user switches to Chat tab\n\n**Loading States**\n- Skeleton loader for issue details\n- \"Starting conversation...\" spinner\n- Typing indicator (pulsing dots)\n- Streaming text (progressive reveal)\n- \"Creating...\" states for buttons\n\n**Empty States**\n- No description: italic \"No description provided.\"\n- No comments: section hidden or subtle message\n- No chat: \"Ask the agent about this issue to start exploring.\"\n\n### Dependencies\n\n- Phases 1-3 complete (all core functionality working)\n- Can be worked on incrementally after MVP launch","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T10:33:34.56895-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"All Phase 4 subtasks completed: error banner, panel resizing, mobile indicator, loading states, contextual errors","dependencies":[{"issue_id":"maestro-fyp.4","depends_on_id":"maestro-fyp","type":"parent-child","created_at":"2025-12-30T10:33:34.569389-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4","depends_on_id":"maestro-fyp.3","type":"blocks","created_at":"2025-12-30T10:39:26.262701-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.4.1","title":"Create global error banner component","description":"## Task\n\nCreate an ErrorBanner component that displays persistent connectivity errors at the top of the application.\n\n## Why\n\nWhen critical services are unavailable (OpenCode server, GitHub), users need clear, persistent feedback - not just momentary toasts that disappear. The banner:\n- Stays visible until issue resolved\n- Provides actionable guidance\n- Does not block UI interaction\n\n## Design\n\n```\n┌─────────────────────────────────────────────────────────────────────┐\n│ ⚠ Cannot connect to OpenCode server. Run `opencode serve` [Retry]  │\n└─────────────────────────────────────────────────────────────────────┘\n│                                                                     │\n│  (rest of application)                                              │\n```\n\n## Error Types\n\n| Error | Message | Action |\n|-------|---------|--------|\n| OpenCode down | \"Cannot connect to OpenCode server. Make sure `opencode serve` is running.\" | Retry button |\n| GitHub rate limit | \"GitHub rate limit exceeded. Resets at 3:45 PM.\" | Shows countdown |\n| gh not authenticated | \"GitHub CLI not authenticated. Run `gh auth login` in terminal.\" | No retry (user action needed) |\n\n## Implementation\n\n```typescript\n// src/components/error-banner/ErrorBanner.tsx\n\ninterface ErrorBannerProps {\n  type: \"opencode\" | \"github-rate-limit\" | \"github-auth\"\n  message: string\n  onRetry?: () =\u003e void\n  retryLabel?: string\n  rateLimitReset?: Date  // For rate limit errors\n}\n\nexport function ErrorBanner({ type, message, onRetry, rateLimitReset }: ErrorBannerProps) {\n  return (\n    \u003cdiv className=\"bg-destructive/10 border-b border-destructive/20 px-4 py-2 text-sm\"\u003e\n      \u003cdiv className=\"flex items-center justify-between max-w-screen-xl mx-auto\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cAlertTriangle className=\"h-4 w-4 text-destructive\" /\u003e\n          \u003cspan className=\"text-destructive\"\u003e{message}\u003c/span\u003e\n          {rateLimitReset \u0026\u0026 (\n            \u003cspan className=\"text-muted-foreground\"\u003e\n              Resets in {formatTimeUntil(rateLimitReset)}\n            \u003c/span\u003e\n          )}\n        \u003c/div\u003e\n        {onRetry \u0026\u0026 (\n          \u003cButton variant=\"ghost\" size=\"sm\" onClick={onRetry}\u003e\n            {retryLabel || \"Retry\"}\n          \u003c/Button\u003e\n        )}\n      \u003c/div\u003e\n    \u003c/div\u003e\n  )\n}\n```\n\n## Context Provider\n\nFor global error state:\n\n```typescript\n// src/lib/contexts/error-context.tsx\n\ninterface ErrorState {\n  opencodeError: string | null\n  githubError: string | null\n  rateLimitReset: Date | null\n}\n\nexport const ErrorContext = createContext\u003c{\n  errors: ErrorState\n  setOpenCodeError: (error: string | null) =\u003e void\n  setGitHubError: (error: string | null) =\u003e void\n  checkOpenCodeHealth: () =\u003e Promise\u003cvoid\u003e\n}\u003e()\n```\n\n## Integration Points\n\n- Check OpenCode health on app load\n- Check GitHub auth on first API call\n- Parse rate limit headers from GitHub responses\n- Clear errors when connectivity restored\n\n## Files to Create\n\n- `src/components/error-banner/ErrorBanner.tsx`\n- `src/components/error-banner/index.ts`\n- `src/lib/contexts/error-context.tsx` (or add to providers.tsx)\n\n## Files to Modify\n\n- `src/app/layout.tsx` or providers - Add error banner at top\n- API routes - Return rate limit info in headers\n\n## Dependencies\n\n- Health check API (Phase 1)\n\n## Acceptance Criteria\n\n- [ ] Banner appears when OpenCode unreachable\n- [ ] Banner appears for GitHub rate limit\n- [ ] Banner appears for gh auth errors\n- [ ] Retry button triggers health check\n- [ ] Banner dismisses when error resolved\n- [ ] Does not block page interaction\n- [ ] Rate limit shows countdown\n- [ ] Consistent styling with app theme","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T10:37:54.707057-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Global error banner created with ErrorProvider context, health check on mount, retry and dismiss functionality","dependencies":[{"issue_id":"maestro-fyp.4.1","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:37:54.709051-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4.1","depends_on_id":"maestro-fyp.1.5","type":"blocks","created_at":"2025-12-30T10:39:26.299505-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.4.2","title":"Add panel resizing for Issue View","description":"## Task\n\nMake the Issue Details panel width adjustable via drag handle, replacing the current fixed 400px width.\n\n## Why\n\nDifferent users have different preferences:\n- Some want more space for long issue descriptions\n- Some prefer larger chat area\n- Content width varies per issue\n\nA fixed width forces everyone into the same experience.\n\n## Current Implementation\n\n```tsx\n// Current fixed width\n\u003cdiv className=\"w-[400px] border-r\"\u003e\n  {/* Issue Details */}\n\u003c/div\u003e\n\u003cdiv className=\"flex-1\"\u003e\n  {/* Chat */}\n\u003c/div\u003e\n```\n\n## New Implementation\n\n```tsx\nconst [panelWidth, setPanelWidth] = useState(() =\u003e {\n  // Load from localStorage or default\n  return parseInt(localStorage.getItem(\"issue-panel-width\") || \"400\")\n})\n\nconst handleDrag = (e: MouseEvent) =\u003e {\n  const newWidth = Math.max(200, Math.min(e.clientX, window.innerWidth * 0.5))\n  setPanelWidth(newWidth)\n}\n\nconst handleDragEnd = () =\u003e {\n  localStorage.setItem(\"issue-panel-width\", panelWidth.toString())\n}\n\nreturn (\n  \u003cdiv className=\"flex h-full\"\u003e\n    \u003cdiv style={{ width: panelWidth }} className=\"border-r relative\"\u003e\n      {/* Issue Details */}\n      \n      {/* Drag handle */}\n      \u003cdiv \n        className=\"absolute right-0 top-0 bottom-0 w-1 cursor-col-resize hover:bg-primary/20\"\n        onMouseDown={startDrag}\n      /\u003e\n    \u003c/div\u003e\n    \u003cdiv className=\"flex-1\"\u003e\n      {/* Chat */}\n    \u003c/div\u003e\n  \u003c/div\u003e\n)\n```\n\n## Drag Handle UX\n\n1. **Visual feedback** - Handle highlights on hover\n2. **Cursor change** - `cursor-col-resize` indicates draggable\n3. **Smooth dragging** - Update width on mousemove\n4. **Persist on release** - Save to localStorage on mouseup\n5. **Constraints** - Min 200px, max 50% of viewport\n\n## Considerations\n\n- **Mobile** - No resizing on mobile (tabbed interface)\n- **Performance** - Debounce localStorage writes\n- **Accessibility** - Consider keyboard-based resizing (optional)\n- **Reset** - Double-click handle to reset to default? (optional)\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Optional: Reusable Hook\n\n```typescript\n// src/lib/hooks/useResizablePanel.ts\nexport function useResizablePanel(storageKey: string, defaultWidth: number) {\n  const [width, setWidth] = useState(defaultWidth)\n  const isDragging = useRef(false)\n  \n  // ... drag logic\n  \n  return { width, dragHandleProps }\n}\n```\n\n## Dependencies\n\nNone - can be implemented independently\n\n## Acceptance Criteria\n\n- [ ] Drag handle visible on right edge of panel\n- [ ] Handle highlights on hover\n- [ ] Cursor changes to resize cursor\n- [ ] Width updates while dragging\n- [ ] Width saved to localStorage on release\n- [ ] Width restored on page reload\n- [ ] Min width enforced (200px)\n- [ ] Max width enforced (50% viewport)\n- [ ] Only active on desktop (\u003e768px)\n- [ ] Smooth, performant dragging","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T10:38:11.191988-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Panel resizing implemented with drag handle, localStorage persistence, min/max constraints","dependencies":[{"issue_id":"maestro-fyp.4.2","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:38:11.194109-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.4.3","title":"Add mobile unread indicator","description":"## Task\n\nShow a badge on the Chat tab when the user is viewing the Details tab and the AI responds with new messages.\n\n## Why\n\nOn mobile, users switch between Details and Chat tabs. If they are reading details while the AI responds, they have no indication that new messages arrived. The unread indicator:\n- Signals new activity\n- Encourages tab switch\n- Prevents user from wondering if AI responded\n\n## Design\n\n```\n┌─────────────────────────────────────────┐\n│ ←  #42: Add auth flow              [···]│\n├─────────────────────────────────────────┤\n│   Details    │    Chat ●                │  ← Red dot = unread\n├─────────────────────────────────────────┤\n```\n\n## Implementation\n\n```tsx\nconst [activeTab, setActiveTab] = useState\u003c\"details\" | \"chat\"\u003e(\"chat\")\nconst [hasUnread, setHasUnread] = useState(false)\n\n// When new message arrives\nconst handleNewMessage = (message) =\u003e {\n  setMessages(prev =\u003e [...prev, message])\n  \n  // Mark unread if not on chat tab\n  if (activeTab !== \"chat\") {\n    setHasUnread(true)\n  }\n}\n\n// Clear unread when switching to chat\nconst handleTabChange = (tab) =\u003e {\n  setActiveTab(tab)\n  if (tab === \"chat\") {\n    setHasUnread(false)\n  }\n}\n\n// Tab bar rendering\n\u003cdiv className=\"flex border-b\"\u003e\n  \u003cbutton\n    className={cn(\"flex-1 py-2\", activeTab === \"details\" \u0026\u0026 \"border-b-2\")}\n    onClick={() =\u003e handleTabChange(\"details\")}\n  \u003e\n    Details\n  \u003c/button\u003e\n  \u003cbutton\n    className={cn(\"flex-1 py-2 relative\", activeTab === \"chat\" \u0026\u0026 \"border-b-2\")}\n    onClick={() =\u003e handleTabChange(\"chat\")}\n  \u003e\n    Chat\n    {hasUnread \u0026\u0026 (\n      \u003cspan className=\"absolute top-1 right-1/4 h-2 w-2 bg-destructive rounded-full\" /\u003e\n    )}\n  \u003c/button\u003e\n\u003c/div\u003e\n```\n\n## Behavior Details\n\n| State | Action | Result |\n|-------|--------|--------|\n| On Chat tab | AI responds | No badge (user sees it) |\n| On Details tab | AI responds | Badge appears |\n| Badge visible | Switch to Chat | Badge clears |\n| Badge visible | Switch to Details | Badge stays |\n| On Chat tab | Switch to Details then back | No badge |\n\n## Visual Design\n\n- Small red dot (not a number badge)\n- Positioned near tab text\n- Matches destructive color for visibility\n- Animates in with slight fade/scale? (optional)\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Streaming messages working (Phase 2)\n- Only relevant on mobile (already have tab UI)\n\n## Acceptance Criteria\n\n- [ ] Badge appears when AI responds on Details tab\n- [ ] Badge clears when switching to Chat tab\n- [ ] Badge only shows on mobile layout\n- [ ] Badge positioned correctly relative to tab\n- [ ] Badge uses consistent styling (red dot)\n- [ ] No badge when already on Chat tab","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T10:38:27.794788-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Mobile unread indicator added with red pulsing dot on Chat tab when AI responds on Details tab","dependencies":[{"issue_id":"maestro-fyp.4.3","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:38:27.796975-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4.3","depends_on_id":"maestro-fyp.2.3","type":"blocks","created_at":"2025-12-30T10:39:26.333965-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.4.4","title":"Improve loading and empty states","description":"## Task\n\nAdd comprehensive loading states and empty states throughout the Issue View.\n\n## Why\n\nUsers need feedback about what is happening:\n- Is data loading?\n- Is the AI thinking?\n- Why is this section empty?\n\nGood loading/empty states reduce confusion and perceived wait time.\n\n## Loading States to Add\n\n### 1. Issue Details Loading\nCurrently: Nothing while fetching\nGoal: Skeleton loader\n\n```tsx\n{isLoading ? (\n  \u003cdiv className=\"space-y-4\"\u003e\n    \u003cSkeleton className=\"h-6 w-3/4\" /\u003e  {/* Title */}\n    \u003cSkeleton className=\"h-4 w-1/4\" /\u003e  {/* Metadata */}\n    \u003cSkeleton className=\"h-24 w-full\" /\u003e {/* Body */}\n  \u003c/div\u003e\n) : (\n  \u003cIssueDetails issue={issue} /\u003e\n)}\n```\n\n### 2. Session Starting\nCurrently: Nothing\nGoal: \"Starting conversation...\" with spinner\n\n```tsx\n{isCreatingSession \u0026\u0026 (\n  \u003cdiv className=\"flex items-center justify-center py-8\"\u003e\n    \u003cLoader2 className=\"h-4 w-4 animate-spin mr-2\" /\u003e\n    \u003cspan className=\"text-muted-foreground\"\u003eStarting conversation...\u003c/span\u003e\n  \u003c/div\u003e\n)}\n```\n\n### 3. AI Responding\nCurrently: Nothing (or basic spinner)\nGoal: Typing indicator (pulsing dots)\n\n```tsx\n{isTyping \u0026\u0026 (\n  \u003cdiv className=\"flex items-center gap-1 text-muted-foreground\"\u003e\n    \u003cspan className=\"animate-pulse\"\u003e●\u003c/span\u003e\n    \u003cspan className=\"animate-pulse delay-100\"\u003e●\u003c/span\u003e\n    \u003cspan className=\"animate-pulse delay-200\"\u003e●\u003c/span\u003e\n  \u003c/div\u003e\n)}\n```\n\n### 4. Streaming Response\nAlready streaming text, but should:\n- Disable input while streaming\n- Show cursor at end of text\n\n## Empty States to Add\n\n### 1. No Issue Description\n```tsx\n\u003cp className=\"text-sm text-muted-foreground italic\"\u003e\n  No description provided.\n\u003c/p\u003e\n```\n\n### 2. No Comments\nEither hide section or:\n```tsx\n\u003cp className=\"text-sm text-muted-foreground\"\u003e\n  No comments yet.\n\u003c/p\u003e\n```\n\n### 3. No Chat History (New Session)\n```tsx\n\u003cdiv className=\"flex flex-col items-center justify-center h-full text-center p-8\"\u003e\n  \u003cMessageSquare className=\"h-12 w-12 text-muted-foreground/50 mb-4\" /\u003e\n  \u003ch3 className=\"font-medium\"\u003eStart a conversation\u003c/h3\u003e\n  \u003cp className=\"text-sm text-muted-foreground mt-1\"\u003e\n    Ask the agent about this issue to start exploring.\n  \u003c/p\u003e\n\u003c/div\u003e\n```\n\n## Button Loading States\n\n### Create Issue\n```tsx\n\u003cButton disabled={isCreating}\u003e\n  {isCreating ? (\n    \u003c\u003e\n      \u003cLoader2 className=\"h-4 w-4 animate-spin mr-2\" /\u003e\n      Creating...\n    \u003c/\u003e\n  ) : (\n    \"Create Issue\"\n  )}\n\u003c/Button\u003e\n```\n\n### Send Message\nInput disabled, button shows spinner\n\n### Save Summary (in modal)\n```tsx\n\u003cButton disabled={isPosting}\u003e\n  {isPosting ? \"Posting...\" : \"Post to Issue\"}\n\u003c/Button\u003e\n```\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n- Possibly create `src/components/ui/skeleton.tsx` if not exists\n\n## Dependencies\n\n- Chat integration working (Phase 2) for typing states\n\n## Acceptance Criteria\n\n- [ ] Issue details show skeleton while loading\n- [ ] \"Starting conversation...\" shown during session creation\n- [ ] Typing indicator shown while AI generating\n- [ ] Input disabled during streaming\n- [ ] No description shows placeholder text\n- [ ] No comments handled gracefully\n- [ ] Empty chat shows helpful prompt\n- [ ] All buttons show loading state when appropriate\n- [ ] Loading states match app visual style","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T10:38:48.027519-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Loading states improved with skeletons, empty states, typing indicators, and session error banner","dependencies":[{"issue_id":"maestro-fyp.4.4","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:38:48.030715-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4.4","depends_on_id":"maestro-fyp.2.1","type":"blocks","created_at":"2025-12-30T10:39:26.367831-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-fyp.4.5","title":"Add contextual error handling","description":"## Task\n\nAdd inline error handling for specific failure scenarios that do not warrant a global banner.\n\n## Why\n\nNot all errors are equal:\n- OpenCode server down = global banner (affects all features)\n- Single API call failed = contextual inline error\n- Network hiccup = toast with retry\n\nMatching error severity to UI treatment reduces alarm fatigue.\n\n## Error Scenarios\n\n### Issue Fetch Failed\nShow inline error in Issue Details panel:\n\n```tsx\n{issueError \u0026\u0026 (\n  \u003cdiv className=\"rounded-md bg-destructive/10 p-4\"\u003e\n    \u003cdiv className=\"flex items-start gap-3\"\u003e\n      \u003cAlertCircle className=\"h-5 w-5 text-destructive mt-0.5\" /\u003e\n      \u003cdiv className=\"flex-1\"\u003e\n        \u003cp className=\"text-sm font-medium text-destructive\"\u003e\n          Failed to load issue\n        \u003c/p\u003e\n        \u003cp className=\"text-sm text-muted-foreground mt-1\"\u003e\n          {issueError.message}\n        \u003c/p\u003e\n        \u003cButton \n          variant=\"outline\" \n          size=\"sm\" \n          className=\"mt-3\"\n          onClick={refetchIssue}\n        \u003e\n          Try again\n        \u003c/Button\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n)}\n```\n\n### Session Creation Failed\nShow inline error in Chat area:\n\n```tsx\n{sessionError \u0026\u0026 (\n  \u003cdiv className=\"flex flex-col items-center justify-center h-full p-8\"\u003e\n    \u003cAlertCircle className=\"h-12 w-12 text-destructive/50 mb-4\" /\u003e\n    \u003ch3 className=\"font-medium\"\u003eCould not start conversation\u003c/h3\u003e\n    \u003cp className=\"text-sm text-muted-foreground mt-1 text-center\"\u003e\n      {sessionError.message}\n    \u003c/p\u003e\n    \u003cButton className=\"mt-4\" onClick={retrySession}\u003e\n      Try again\n    \u003c/Button\u003e\n  \u003c/div\u003e\n)}\n```\n\n### Message Send Failed\nKeep message in input, show toast with retry:\n\n```tsx\ntry {\n  await sendMessage(content)\n  setInput(\"\")\n} catch (error) {\n  // Do NOT clear input\n  toast({\n    variant: \"destructive\",\n    title: \"Message failed to send\",\n    description: \"Check your connection and try again.\",\n    action: (\n      \u003cButton size=\"sm\" variant=\"outline\" onClick={() =\u003e sendMessage(content)}\u003e\n        Retry\n      \u003c/Button\u003e\n    ),\n  })\n}\n```\n\n### Issue Not Found (404)\nNavigate to 404 page with helpful link:\n\n```tsx\n// src/app/project/[id]/issue/[issueNumber]/not-found.tsx\n\nexport default function IssueNotFound() {\n  return (\n    \u003cdiv className=\"flex flex-col items-center justify-center min-h-screen\"\u003e\n      \u003ch1 className=\"text-4xl font-bold\"\u003eIssue Not Found\u003c/h1\u003e\n      \u003cp className=\"text-muted-foreground mt-2\"\u003e\n        This issue may have been deleted or you do not have access.\n      \u003c/p\u003e\n      \u003cButton asChild className=\"mt-4\"\u003e\n        \u003cLink href={`/project/${projectId}`}\u003e\n          Back to Project\n        \u003c/Link\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  )\n}\n```\n\n### Comment Post Failed\nError toast with the comment preserved:\n\n```tsx\ntry {\n  await postComment(summary)\n  closeModal()\n  toast({ title: \"Summary posted to issue\" })\n} catch (error) {\n  toast({\n    variant: \"destructive\",\n    title: \"Failed to post comment\",\n    description: error.message,\n  })\n  // Modal stays open with content preserved\n}\n```\n\n## Error Recovery Patterns\n\n1. **Inline + Retry** - For fetch failures (issue, session)\n2. **Toast + Retry** - For transient failures (send message)\n3. **Preserve Input** - Never lose user-typed content\n4. **Navigate Away** - For unrecoverable (404, auth)\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n- Create `src/app/project/[id]/issue/[issueNumber]/not-found.tsx`\n- Possibly add toast component if not exists\n\n## Dependencies\n\n- Basic functionality working (Phase 2-3)\n\n## Acceptance Criteria\n\n- [ ] Issue fetch error shows inline with retry\n- [ ] Session error shows centered with retry\n- [ ] Message send error keeps input, shows toast\n- [ ] 404 issue shows helpful page\n- [ ] Comment post error keeps modal open\n- [ ] All errors have actionable next steps\n- [ ] No user input ever lost on error","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T10:39:08.713154-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Contextual error handling added with inline errors, retry buttons, input preservation on failure","dependencies":[{"issue_id":"maestro-fyp.4.5","depends_on_id":"maestro-fyp.4","type":"parent-child","created_at":"2025-12-30T10:39:08.716595-06:00","created_by":"daemon"},{"issue_id":"maestro-fyp.4.5","depends_on_id":"maestro-fyp.2.1","type":"blocks","created_at":"2025-12-30T10:39:26.401642-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88","title":"Planning Mode: AI-Assisted Task Decomposition (GH Issue #6)","description":"## Overview\n\nBuild the Planning Mode experience - the critical bridge between Ideation and Swarm Execution in Maestro's workflow. When a user enters planning mode from an issue page, we create an isolated development environment (git worktree) and run AI-assisted planning to decompose the GitHub issue into actionable, parallelizable beads.\n\n---\n\n## Strategic Context: Why Planning Mode Matters\n\nMaestro's core value proposition is the **Ideation → Planning → Swarm** workflow:\n1. **Ideation**: Explore ideas conversationally with an AI agent\n2. **Planning** (THIS FEATURE): Break issues into concrete, parallelizable tasks\n3. **Swarm**: Execute tasks in parallel with multiple agents\n\n**Planning Mode is the linchpin.** Without it, users cannot:\n- Transform vague requirements into concrete tasks\n- Establish dependency relationships between tasks\n- Identify which files each task will touch (critical for swarm file reservations)\n- Iteratively refine the plan before committing resources to execution\n\n**Key Insight**: The quality of planning directly determines swarm success. A poorly planned epic leads to agent conflicts, redundant work, and failed executions. Planning Mode must support iterative refinement until the plan is 'right'.\n\n---\n\n## Technical Architecture Decisions\n\n### 1. Git Worktree Isolation\n**Why worktrees instead of branches?**\n- Clean separation: planning changes don't pollute the main working directory\n- Parallel safety: the user (or other agents) can continue working in the main repo\n- Automatic cleanup: worktree can be deleted without affecting main repo\n- Branch tie-in: each worktree has its own branch, ready for PR when complete\n\n**Location**: `~/.maestro/worktrees/{project-slug}/issue-{number}/`\nThis centralized location:\n- Prevents worktrees from cluttering the main project directory\n- Makes cleanup and management straightforward\n- Allows Maestro to track all active planning sessions across projects\n\n### 2. CLI-First Beads Integration\n**Why CLI (`bd`) instead of MCP?**\n- **Simplicity**: No additional server to run; CLI is always available\n- **Consistency**: Matches how developers interact with beads manually\n- **Reliability**: No connection management, reconnection logic, etc.\n- **Observability**: CLI output is easily logged and debugged\n\n**Trade-off accepted**: Slightly higher latency than MCP, but simpler implementation and fewer failure modes.\n\n### 3. Slash Commands as Prompts\n**Why send `/turn_gh_issue_into_beads` as a regular message, not a separate API?**\n- OpenCode's agent already handles slash commands in message text\n- Keeps the interface simple: one way to send messages\n- The slash command is essentially a 'macro' that triggers specific agent behavior\n- Allows natural follow-up: user can continue the conversation after the command\n\n### 4. Full Tool Access for Planning Sessions\nPlanning agents need:\n- **bash**: Execute `bd` commands, run git operations\n- **write/edit**: Create and modify bead files (via CLI)\n- **read**: Analyze codebase structure for task breakdown\n\nThis is more permissive than a pure 'discussion' session but necessary for the agent to actually create/modify beads.\n\n---\n\n## User Experience Design\n\n### Entry Flow\n1. User is on Issue Page (already discussing/viewing a GitHub issue)\n2. User clicks 'Start Planning' button in header\n3. Confirmation modal explains what will happen\n4. On confirm: navigate to Planning Page, begin environment setup\n\n### Planning Page Layout (Desktop)\n```\n┌────────────────────────────┬────────────────────────────┐\n│  LEFT PANE                 │  RIGHT PANE                │\n│  - Setup progress          │  - View toggle (List/Graph)│\n│  - Chat interface          │  - Plan visualization      │\n│                            │  - Detail panel            │\n└────────────────────────────┴────────────────────────────┘\n```\n\n### Planning Page Layout (Mobile \u003c 1024px)\n- Tab 1: Setup/Chat\n- Tab 2: Plan UI\n- Unread indicator when plan changes while on chat tab\n\n### Refinement Model\nTwo modes of refinement:\n1. **Holistic** (slash commands): `/turn_gh_issue_into_beads`, `/improve_beads`\n2. **Granular** (free-form chat): Select a bead, chat about it specifically\n\n---\n\n## Implementation Phases\n\n### Phase 1: Entry Point\n- Add 'Start Planning' button to issue page\n- Build confirmation modal\n- Create navigation to planning route\n\n### Phase 2: Worktree Service\n- Create `WorktreeService` for worktree lifecycle management\n- Handle branch creation, conflict detection, cleanup\n\n### Phase 3: Planning Page \u0026 Setup Pipeline\n- Create planning page with split-pane layout\n- Build SSE-based setup progress UI\n- Implement setup pipeline: worktree → deps → session → initial prompt\n\n### Phase 4: OpenCode Integration\n- Extend OpenCode service for full-access sessions\n- Extend session storage for planning session type\n- Create planning-specific API endpoints\n\n### Phase 5: Beads Integration\n- Build CLI wrapper for `bd` commands\n- Implement file watcher for real-time updates\n- Create beads data hooks\n\n### Phase 6: Plan UI\n- Build list view (MVP) with tree structure\n- Create bead detail panel with view/edit\n- Implement bead selection and navigation\n\n### Phase 7: Chat \u0026 Refinement\n- Integrate chat component with planning context\n- Support slash command execution\n- Connect bead selection to chat context\n\n### Phase 8: Resume \u0026 State Management\n- Detect existing worktrees on navigation\n- Reconnect to existing sessions\n- Load saved bead state\n\n### Phase 9: Testing \u0026 Polish\n- Cross-browser testing\n- Mobile device testing\n- Error scenario testing\n\n---\n\n## Success Criteria\n\n1. User can enter planning mode from any issue with a GitHub issue loaded\n2. Worktree is created automatically with correct branch naming\n3. Setup progress is visible in real-time via SSE\n4. AI agent successfully creates initial bead breakdown via slash command\n5. User can view beads in list format with hierarchy\n6. User can select beads and view/edit details\n7. User can refine plan via free-form chat\n8. Session can be resumed after navigation away\n9. Works on mobile (\u003c 1024px) with tabbed interface\n10. All error states are handled gracefully with recovery options\n\n---\n\n## Dependencies\n\n- **beads CLI (`bd`)**: Must be installed and configured\n- **git worktree support**: Project must be a git repository\n- **bun**: For dependency installation in worktrees\n- **OpenCode server**: Running via `opencode serve`\n\n---\n\n## Risk Assessment\n\n**High Risk:**\n- Worktree creation edge cases (branch conflicts, permissions)\n- Session state management across page reloads\n\n**Medium Risk:**\n- SSE streaming reliability for setup progress\n- Beads file watching accuracy\n\n**Low Risk:**\n- UI component implementation (following established patterns)\n- API endpoint creation (following existing patterns)\n\n---\n\n## References\n- GitHub Issue: #6\n- SCOPE.md: Project overview and workflow\n- Existing patterns: Issue page, Solo chat, Session management","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-30T23:00:07.676082-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:57.165223-06:00","close_reason":"Completed","deleted_at":"2025-12-31T08:43:57.165223-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-g88.1","title":"Phase 1.1: Add 'Start Planning' Button to Issue Page Header","description":"## Task Overview\n\nAdd a 'Start Planning' button to the issue page header that initiates the planning workflow. This is the entry point for the entire planning mode feature.\n\n---\n\n## Background \u0026 Context\n\nThe issue page (`/project/{id}/issue/{issueNumber}`) currently serves as a discussion interface where users can chat with an AI about a GitHub issue. Planning mode extends this by allowing users to transform the discussion into an actionable plan.\n\n**Current header structure** (from `src/app/project/[id]/issue/[issueNumber]/page.tsx`):\n- External link button (opens GitHub issue)\n- Refresh button\n- New session button\n- More options dropdown\n\nThe 'Start Planning' button should fit naturally alongside these existing actions.\n\n---\n\n## Implementation Details\n\n### Button Placement\nAdd the button to the header action group, positioned logically:\n```\n[External Link] [Refresh] [Start Planning] [New Session] [More ▼]\n```\n\n### Button Appearance\n- Use `Button` from shadcn/ui with `variant='outline'`\n- Icon: Consider using a planning/task icon (e.g., `ListTodo` from lucide-react)\n- Text: 'Plan' or 'Start Planning' (depends on available space)\n- On mobile: Icon-only with tooltip\n\n### Enabled State Logic\nThe button should only be **enabled** when:\n1. A GitHub issue has been loaded (i.e., `issueData` is present)\n2. The issue data includes a valid issue number\n\nIf no GitHub issue is associated, the button should be:\n- Visually disabled (dimmed)\n- Show tooltip explaining: 'Create a GitHub issue first to start planning'\n\n### Click Handler\nOn click, trigger the confirmation modal (Task 1.2). Pass:\n- Project ID\n- Issue number\n- Issue title (for display in modal)\n\n---\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx` - Add button to header\n\n---\n\n## Acceptance Criteria\n\n- [ ] Button appears in issue page header\n- [ ] Button uses consistent styling with existing actions\n- [ ] Button is disabled when no GitHub issue is loaded\n- [ ] Disabled state shows helpful tooltip\n- [ ] Click triggers confirmation modal (once Task 1.2 is complete)\n- [ ] Works on both desktop and mobile layouts\n- [ ] Icon-only on mobile with preserved accessibility\n\n---\n\n## Testing Notes\n\n- Test with issue that has GitHub issue loaded\n- Test with issue that has no GitHub issue (should be disabled)\n- Test button appearance at various viewport widths\n- Verify button is keyboard accessible","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:00:26.413139-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.1","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:00:26.416886-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.10","title":"Phase 3.2: Create Beads API Endpoints","description":"## Task Overview\n\nCreate API endpoints that expose beads operations to the frontend, using the BeadsService to execute CLI commands.\n\n---\n\n## Background \u0026 Context\n\nThe frontend needs to:\n1. Fetch the current bead tree for display\n2. Update bead properties (status, priority, etc.)\n3. React to bead changes in real-time\n\nThis task creates the HTTP API layer. Real-time updates will be handled separately via file watching.\n\n---\n\n## Endpoints\n\n### GET `/api/projects/{id}/planning/{issueNumber}/beads`\n\nFetch all beads for the planning session as a tree structure.\n\n**Response:**\n```json\n{\n  \"tree\": {\n    \"root\": {\n      \"id\": \"maestro-g88\",\n      \"title\": \"Planning Mode Feature\",\n      \"type\": \"epic\",\n      \"status\": \"open\",\n      \"priority\": 1\n    },\n    \"children\": [\n      {\n        \"root\": {\n          \"id\": \"maestro-g88.1\",\n          \"title\": \"Add Start Planning Button\",\n          \"type\": \"task\",\n          \"status\": \"open\",\n          \"priority\": 1,\n          \"parent\": \"maestro-g88\"\n        },\n        \"children\": []\n      }\n    ]\n  },\n  \"flat\": [/* all beads as flat array */]\n}\n```\n\n**Error Response:**\n```json\n{\n  \"error\": \"Worktree not found\",\n  \"code\": \"WORKTREE_NOT_FOUND\"\n}\n```\n\n---\n\n### GET `/api/projects/{id}/planning/{issueNumber}/beads/{beadId}`\n\nFetch a single bead's details.\n\n**Response:**\n```json\n{\n  \"bead\": {\n    \"id\": \"maestro-g88.1\",\n    \"title\": \"Add Start Planning Button\",\n    \"description\": \"## Task Overview\\n\\nAdd a 'Start Planning' button...\",\n    \"type\": \"task\",\n    \"status\": \"open\",\n    \"priority\": 1,\n    \"parent\": \"maestro-g88\",\n    \"files\": [\"src/app/project/[id]/issue/[issueNumber]/page.tsx\"],\n    \"blockedBy\": [],\n    \"blocks\": [\"maestro-g88.2\"]\n  }\n}\n```\n\n---\n\n### PATCH `/api/projects/{id}/planning/{issueNumber}/beads/{beadId}`\n\nUpdate a bead's properties.\n\n**Request Body:**\n```json\n{\n  \"status\": \"in_progress\",\n  \"priority\": 0,\n  \"title\": \"Updated title\"\n}\n```\n\n**Response:**\n```json\n{\n  \"bead\": { /* updated bead */ }\n}\n```\n\n---\n\n### POST `/api/projects/{id}/planning/{issueNumber}/beads`\n\nCreate a new bead (typically done by AI, but exposed for manual creation).\n\n**Request Body:**\n```json\n{\n  \"title\": \"New subtask\",\n  \"type\": \"task\",\n  \"parent\": \"maestro-g88.1\",\n  \"priority\": 2,\n  \"description\": \"...\"\n}\n```\n\n**Response:**\n```json\n{\n  \"bead\": { /* created bead */ }\n}\n```\n\n---\n\n### DELETE `/api/projects/{id}/planning/{issueNumber}/beads/{beadId}`\n\nClose/delete a bead.\n\n**Request Body (optional):**\n```json\n{\n  \"reason\": \"Merged with task 2\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true\n}\n```\n\n---\n\n## Implementation\n\n### Route Structure\n\n```\nsrc/app/api/projects/[id]/planning/[issueNumber]/beads/\n├── route.ts           # GET (list), POST (create)\n└── [beadId]/\n    └── route.ts       # GET (single), PATCH (update), DELETE (close)\n```\n\n### Common Handler Pattern\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/beads/route.ts\n\nimport { beadsService } from '@/lib/services/beads';\nimport { worktreeService } from '@/lib/services/worktree';\nimport { configService } from '@/lib/services/config';\n\nexport async function GET(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  // Get project and worktree\n  const project = await configService.getProject(projectId);\n  if (!project) {\n    return Response.json({ error: 'Project not found' }, { status: 404 });\n  }\n  \n  const worktree = await worktreeService.getWorktree(project.path, issueNumber);\n  if (!worktree) {\n    return Response.json({ error: 'Worktree not found' }, { status: 404 });\n  }\n  \n  try {\n    const beads = await beadsService.list(worktree.path);\n    \n    // Find the epic for this issue\n    const epic = beads.find(b =\u003e \n      b.type === 'epic' \u0026\u0026 \n      b.title.includes(`#${issueNumber}`) // Heuristic, may need refinement\n    );\n    \n    if (!epic) {\n      return Response.json({ tree: null, flat: beads });\n    }\n    \n    const tree = await beadsService.getTree(worktree.path, epic.id);\n    \n    return Response.json({ tree, flat: beads });\n  } catch (error) {\n    return Response.json(\n      { error: error.message, code: error.code },\n      { status: 500 }\n    );\n  }\n}\n```\n\n---\n\n## Epic Detection Heuristic\n\nThe initial planning prompt creates an epic titled like:\n`\"Planning Mode Feature (GH Issue #6)\"`\n\nWe need to find this epic to build the tree. Options:\n1. Store epic ID in session metadata\n2. Search by title pattern\n3. Store in worktree metadata\n\nFor MVP, use title pattern matching. Refine later if needed.\n\n---\n\n## Files to Create\n\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/route.ts`\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/[beadId]/route.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] GET /beads returns tree and flat list of beads\n- [ ] GET /beads/{id} returns single bead with full details\n- [ ] PATCH /beads/{id} updates bead properties\n- [ ] POST /beads creates new bead\n- [ ] DELETE /beads/{id} closes bead\n- [ ] Proper 404 handling for missing project/worktree/bead\n- [ ] Error responses include code and message\n- [ ] Epic detection finds correct root bead\n\n---\n\n## Dependencies\n\n- Requires: BeadsService (3.1)\n- Requires: WorktreeService (2.1)\n\n---\n\n## Testing Notes\n\n- Test with no beads (should return empty tree)\n- Test CRUD operations\n- Test error cases (invalid bead ID, missing worktree)\n- Verify epic detection works correctly","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:05:51.523427-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.10","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:05:51.525688-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.10","depends_on_id":"maestro-g88.9","type":"blocks","created_at":"2025-12-30T23:14:46.393022-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.11","title":"Phase 3.3: Implement Beads File Watching for Real-Time Updates","description":"## Task Overview\n\nImplement file system watching on the `.beads/` directory to detect when the AI agent creates or modifies beads, enabling real-time UI updates.\n\n---\n\n## Background \u0026 Context\n\n### The Real-Time Challenge\n\nWhen the AI agent runs `bd create` or `bd update`, the beads database changes. The frontend needs to reflect these changes immediately.\n\n### Options Considered\n\n1. **Polling**: Simple but wastes resources, has latency\n2. **File watching**: Reactive, efficient, but needs careful implementation\n3. **SSE from agent**: Complex, requires agent cooperation\n\n**Decision**: File watching with polling fallback.\n\n---\n\n## Implementation Approach\n\n### Server-Side File Watcher\n\nCreate an SSE endpoint that watches the `.beads/` directory and emits events when changes occur.\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts\n\nimport { watch } from 'fs';\nimport { beadsService } from '@/lib/services/beads';\n\nexport async function GET(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const worktree = await getWorktreeForPlanning(params.id, params.issueNumber);\n  if (!worktree) {\n    return new Response('Worktree not found', { status: 404 });\n  }\n  \n  const beadsDir = path.join(worktree.path, '.beads');\n  \n  const stream = new ReadableStream({\n    start(controller) {\n      const encoder = new TextEncoder();\n      \n      function sendBeads() {\n        beadsService.list(worktree.path).then(beads =\u003e {\n          controller.enqueue(\n            encoder.encode(`data: ${JSON.stringify({ type: 'update', beads })}\\n\\n`)\n          );\n        });\n      }\n      \n      // Send initial state\n      sendBeads();\n      \n      // Watch for changes\n      const watcher = watch(beadsDir, { recursive: true }, (eventType, filename) =\u003e {\n        // Debounce rapid changes\n        sendBeads();\n      });\n      \n      // Cleanup on disconnect\n      request.signal.addEventListener('abort', () =\u003e {\n        watcher.close();\n        controller.close();\n      });\n    }\n  });\n  \n  return new Response(stream, {\n    headers: {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n    },\n  });\n}\n```\n\n---\n\n## Debouncing\n\nMultiple file changes can occur rapidly (e.g., during `bd sync`). Debounce to avoid flooding the frontend:\n\n```typescript\nlet debounceTimer: NodeJS.Timeout | null = null;\n\nfunction debouncedSendBeads() {\n  if (debounceTimer) {\n    clearTimeout(debounceTimer);\n  }\n  \n  debounceTimer = setTimeout(() =\u003e {\n    sendBeads();\n    debounceTimer = null;\n  }, 100);  // 100ms debounce\n}\n```\n\n---\n\n## Frontend Hook\n\n```typescript\n// src/lib/hooks/useBeadsWatch.ts\n\nexport function useBeadsWatch(projectId: string, issueNumber: number) {\n  const [beads, setBeads] = useState\u003cBead[]\u003e([]);\n  const [isConnected, setIsConnected] = useState(false);\n  const [error, setError] = useState\u003cError | null\u003e(null);\n  \n  useEffect(() =\u003e {\n    const eventSource = new EventSource(\n      `/api/projects/${projectId}/planning/${issueNumber}/beads/watch`\n    );\n    \n    eventSource.onopen = () =\u003e {\n      setIsConnected(true);\n      setError(null);\n    };\n    \n    eventSource.onmessage = (event) =\u003e {\n      const data = JSON.parse(event.data);\n      if (data.type === 'update') {\n        setBeads(data.beads);\n      }\n    };\n    \n    eventSource.onerror = (event) =\u003e {\n      setIsConnected(false);\n      setError(new Error('Connection lost'));\n      // Attempt reconnect after delay\n      setTimeout(() =\u003e {\n        eventSource.close();\n        // Hook will re-run and create new connection\n      }, 5000);\n    };\n    \n    return () =\u003e {\n      eventSource.close();\n    };\n  }, [projectId, issueNumber]);\n  \n  return { beads, isConnected, error };\n}\n```\n\n---\n\n## Polling Fallback\n\nIf file watching is unreliable (e.g., on certain filesystems), fall back to polling:\n\n```typescript\nconst POLL_INTERVAL = 5000;  // 5 seconds\n\n// In the SSE handler, if fs.watch fails:\nlet lastHash = '';\n\nconst pollInterval = setInterval(async () =\u003e {\n  const beads = await beadsService.list(worktree.path);\n  const hash = JSON.stringify(beads);\n  \n  if (hash !== lastHash) {\n    lastHash = hash;\n    controller.enqueue(\n      encoder.encode(`data: ${JSON.stringify({ type: 'update', beads })}\\n\\n`)\n    );\n  }\n}, POLL_INTERVAL);\n\nrequest.signal.addEventListener('abort', () =\u003e {\n  clearInterval(pollInterval);\n});\n```\n\n---\n\n## Connection Status UI\n\nIndicate connection status in the UI:\n\n```tsx\nfunction PlanningPage() {\n  const { beads, isConnected, error } = useBeadsWatch(projectId, issueNumber);\n  \n  return (\n    \u003cdiv\u003e\n      {!isConnected \u0026\u0026 (\n        \u003cBanner variant=\"warning\"\u003e\n          Live updates paused. Reconnecting...\n        \u003c/Banner\u003e\n      )}\n      {/* rest of UI */}\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Files to Create\n\n- `src/app/api/projects/[id]/planning/[issueNumber]/beads/watch/route.ts`\n- `src/lib/hooks/useBeadsWatch.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] SSE endpoint streams bead updates when files change\n- [ ] Changes are debounced to prevent flooding\n- [ ] Frontend hook consumes SSE and updates state\n- [ ] Connection status is tracked and displayed\n- [ ] Reconnection logic handles disconnects\n- [ ] Polling fallback works if file watching fails\n- [ ] Proper cleanup when component unmounts\n- [ ] Stream closes when request is aborted\n\n---\n\n## Dependencies\n\n- Requires: BeadsService (3.1)\n- Requires: Beads API Endpoints (3.2)\n\n---\n\n## Testing Notes\n\n- Test with AI agent creating beads rapidly\n- Test disconnect/reconnect scenarios\n- Test with multiple browser tabs (should all update)\n- Verify cleanup (no leaked file watchers)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T23:06:24.440496-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.11","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:06:24.442855-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.11","depends_on_id":"maestro-g88.10","type":"blocks","created_at":"2025-12-30T23:14:46.462999-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.11","depends_on_id":"maestro-g88.4","type":"blocks","created_at":"2025-12-31T07:52:31.314182-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.12","title":"Phase 4.1: Build BeadsList Component (Tree View)","description":"## Task Overview\n\nCreate the main list view component that displays beads in a hierarchical tree structure with expand/collapse, status indicators, and selection.\n\n---\n\n## Background \u0026 Context\n\n### MVP: List View Only\n\nThe GitHub issue specifies list view as MVP, with graph view as Phase 2. This task implements the tree/list visualization.\n\n### Design Goals\n\n1. **Hierarchical**: Show Epic → Tasks → Subtasks structure\n2. **Scannable**: Status indicators, priorities at a glance\n3. **Interactive**: Click to select, expand/collapse children\n4. **Real-time**: Updates as beads change\n\n---\n\n## Visual Design\n\n```\n┌─────────────────────────────────────────────────────────┐\n│  📋  Planning Mode Feature (GH Issue #6)        [Epic]  │\n│      ○ open • P1                                        │\n├─────────────────────────────────────────────────────────┤\n│  ▼ Phase 1: Entry Point                                 │\n│    │                                                    │\n│    ├─ ● 1.1 Add Start Planning Button         ○ open   │\n│    ├─ ● 1.2 Build Confirmation Modal          ○ open   │\n│    └─ ● 1.3 Create Planning Page Route        ○ open   │\n│                                                         │\n│  ▶ Phase 2: Worktree Service (5 tasks)                 │\n│                                                         │\n│  ▶ Phase 3: Beads Integration (3 tasks)                │\n└─────────────────────────────────────────────────────────┘\n```\n\n---\n\n## Component Structure\n\n```typescript\n// src/components/planning/BeadsList.tsx\n\ninterface BeadsListProps {\n  tree: BeadTree;\n  selectedId: string | null;\n  onSelect: (beadId: string) =\u003e void;\n  onExpand: (beadId: string) =\u003e void;\n}\n\nexport function BeadsList({ tree, selectedId, onSelect, onExpand }: BeadsListProps) {\n  return (\n    \u003cdiv className=\"beads-list\"\u003e\n      \u003cBeadNode \n        bead={tree.root} \n        children={tree.children}\n        depth={0}\n        selectedId={selectedId}\n        onSelect={onSelect}\n        onExpand={onExpand}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## BeadNode Component\n\n```typescript\n// src/components/planning/BeadNode.tsx\n\ninterface BeadNodeProps {\n  bead: Bead;\n  children: BeadTree[];\n  depth: number;\n  selectedId: string | null;\n  onSelect: (beadId: string) =\u003e void;\n  onExpand: (beadId: string) =\u003e void;\n}\n\nexport function BeadNode({ bead, children, depth, selectedId, onSelect, onExpand }: BeadNodeProps) {\n  const [isExpanded, setIsExpanded] = useState(depth === 0);  // Root expanded by default\n  \n  const hasChildren = children.length \u003e 0;\n  const isSelected = bead.id === selectedId;\n  \n  return (\n    \u003cdiv className={cn('bead-node', { 'depth-0': depth === 0 })}\u003e\n      \u003cdiv \n        className={cn(\n          'bead-row flex items-center gap-2 px-2 py-1.5 rounded-md cursor-pointer',\n          'hover:bg-accent',\n          isSelected \u0026\u0026 'bg-accent'\n        )}\n        style={{ paddingLeft: `${depth * 16 + 8}px` }}\n        onClick={() =\u003e onSelect(bead.id)}\n      \u003e\n        {/* Expand/collapse toggle */}\n        {hasChildren ? (\n          \u003cbutton \n            className=\"shrink-0\"\n            onClick={(e) =\u003e { \n              e.stopPropagation(); \n              setIsExpanded(!isExpanded); \n            }}\n          \u003e\n            {isExpanded ? \u003cChevronDown /\u003e : \u003cChevronRight /\u003e}\n          \u003c/button\u003e\n        ) : (\n          \u003cspan className=\"w-4\" /\u003e  {/* Spacing for alignment */}\n        )}\n        \n        {/* Status indicator */}\n        \u003cStatusIndicator status={bead.status} /\u003e\n        \n        {/* Title */}\n        \u003cspan className=\"flex-1 truncate\"\u003e{bead.title}\u003c/span\u003e\n        \n        {/* Type badge */}\n        \u003cTypeBadge type={bead.type} /\u003e\n        \n        {/* Priority (if not default) */}\n        {bead.priority !== 2 \u0026\u0026 \u003cPriorityBadge priority={bead.priority} /\u003e}\n      \u003c/div\u003e\n      \n      {/* Children */}\n      {isExpanded \u0026\u0026 hasChildren \u0026\u0026 (\n        \u003cdiv className=\"bead-children\"\u003e\n          {children.map(child =\u003e (\n            \u003cBeadNode \n              key={child.root.id}\n              bead={child.root}\n              children={child.children}\n              depth={depth + 1}\n              selectedId={selectedId}\n              onSelect={onSelect}\n              onExpand={onExpand}\n            /\u003e\n          ))}\n        \u003c/div\u003e\n      )}\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Status Indicator\n\n```typescript\n// src/components/planning/StatusIndicator.tsx\n\nfunction StatusIndicator({ status }: { status: Bead['status'] }) {\n  const config = {\n    open: { color: 'text-muted-foreground', icon: Circle },\n    in_progress: { color: 'text-blue-500', icon: CircleDot },\n    closed: { color: 'text-green-500', icon: CheckCircle2 },\n  };\n  \n  const { color, icon: Icon } = config[status];\n  \n  return \u003cIcon className={cn('h-4 w-4', color)} /\u003e;\n}\n```\n\n---\n\n## Type Badge\n\n```typescript\n// src/components/planning/TypeBadge.tsx\n\nfunction TypeBadge({ type }: { type: Bead['type'] }) {\n  const config = {\n    epic: { label: 'Epic', variant: 'default' as const },\n    task: { label: 'Task', variant: 'secondary' as const },\n    bug: { label: 'Bug', variant: 'destructive' as const },\n    feature: { label: 'Feature', variant: 'default' as const },\n    question: { label: '?', variant: 'outline' as const },\n    docs: { label: 'Docs', variant: 'outline' as const },\n  };\n  \n  const { label, variant } = config[type];\n  \n  // Only show for epic type in the tree (others are implicit)\n  if (type !== 'epic') return null;\n  \n  return \u003cBadge variant={variant}\u003e{label}\u003c/Badge\u003e;\n}\n```\n\n---\n\n## Priority Badge\n\n```typescript\nfunction PriorityBadge({ priority }: { priority: Bead['priority'] }) {\n  const config = {\n    0: { label: 'P0', className: 'bg-red-500 text-white' },\n    1: { label: 'P1', className: 'bg-orange-500 text-white' },\n    3: { label: 'P3', className: 'bg-gray-400 text-white' },\n    4: { label: 'P4', className: 'bg-gray-300 text-gray-600' },\n  };\n  \n  // P2 is default, don't show\n  if (priority === 2) return null;\n  \n  const { label, className } = config[priority];\n  \n  return (\n    \u003cspan className={cn('text-xs px-1.5 py-0.5 rounded font-mono', className)}\u003e\n      {label}\n    \u003c/span\u003e\n  );\n}\n```\n\n---\n\n## Keyboard Navigation\n\nSupport keyboard navigation for accessibility:\n\n```typescript\n// In BeadsList\nfunction handleKeyDown(e: KeyboardEvent) {\n  switch (e.key) {\n    case 'ArrowDown':\n      // Select next visible bead\n      break;\n    case 'ArrowUp':\n      // Select previous visible bead\n      break;\n    case 'ArrowRight':\n      // Expand if has children, else select first child\n      break;\n    case 'ArrowLeft':\n      // Collapse if expanded, else select parent\n      break;\n    case 'Enter':\n    case ' ':\n      // Toggle expand/collapse\n      break;\n  }\n}\n```\n\n---\n\n## Files to Create\n\n- `src/components/planning/BeadsList.tsx`\n- `src/components/planning/BeadNode.tsx`\n- `src/components/planning/StatusIndicator.tsx`\n- `src/components/planning/TypeBadge.tsx`\n- `src/components/planning/PriorityBadge.tsx`\n\n---\n\n## Acceptance Criteria\n\n- [ ] Tree structure renders with proper indentation\n- [ ] Expand/collapse works for nodes with children\n- [ ] Selection highlights the selected node\n- [ ] Status indicators show correct colors/icons\n- [ ] Type badges display for epics\n- [ ] Priority badges show for non-default priorities\n- [ ] Keyboard navigation works\n- [ ] Works on mobile (touch targets large enough)\n- [ ] Animates expand/collapse smoothly\n\n---\n\n## Dependencies\n\n- Requires: Beads API Endpoints (3.2)\n- Requires: useBeadsWatch hook (3.3)\n\n---\n\n## Testing Notes\n\n- Test with deep nesting (4+ levels)\n- Test with many beads (50+)\n- Test keyboard navigation\n- Test on touch devices","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:07:09.476432-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.12","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:07:09.478807-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.12","depends_on_id":"maestro-g88.10","type":"blocks","created_at":"2025-12-30T23:14:51.805178-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.12","depends_on_id":"maestro-g88.11","type":"blocks","created_at":"2025-12-31T07:52:30.170726-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.13","title":"Phase 4.2: Build BeadDetail Panel Component","description":"## Task Overview\n\nCreate the detail panel that displays when a bead is selected, showing full information and providing edit capabilities.\n\n---\n\n## Background \u0026 Context\n\nWhen a user selects a bead in the list, they need to:\n1. View the full description and metadata\n2. Edit properties (status, priority, title)\n3. See dependencies and associated files\n4. Access actions like 'Chat about this' or 'Delete'\n\n---\n\n## Visual Design\n\n```\n┌─────────────────────────────────────────────────────┐\n│  Phase 1.1: Add Start Planning Button               │\n│  ─────────────────────────────────────────────────  │\n│                                                     │\n│  Status: ○ open    │  Priority: P1   │  Type: task │\n│  [Edit ▼]          │  [Edit ▼]       │             │\n│                                                     │\n│  ───────────────────────────────────────────────── │\n│                                                     │\n│  ## Task Overview                                   │\n│                                                     │\n│  Add a 'Start Planning' button to the issue page    │\n│  header that initiates the planning workflow.       │\n│                                                     │\n│  ### Files to Modify                                │\n│  - src/app/project/[id]/issue/[issueNumber]/page.tsx│\n│                                                     │\n│  ### Acceptance Criteria                            │\n│  - [ ] Button appears in header                     │\n│  - [ ] Button is disabled when no GitHub issue...   │\n│                                                     │\n│  ───────────────────────────────────────────────── │\n│                                                     │\n│  Dependencies:                                      │\n│  Blocks: 1.2 Build Confirmation Modal              │\n│                                                     │\n│  ───────────────────────────────────────────────── │\n│                                                     │\n│  [Chat about this]  [Edit]  [Delete]               │\n└─────────────────────────────────────────────────────┘\n```\n\n---\n\n## Component API\n\n```typescript\n// src/components/planning/BeadDetail.tsx\n\ninterface BeadDetailProps {\n  bead: Bead;\n  onUpdate: (updates: UpdateBeadOptions) =\u003e Promise\u003cvoid\u003e;\n  onClose: () =\u003e void;\n  onChatAbout: (beadId: string) =\u003e void;\n}\n\nexport function BeadDetail({ bead, onUpdate, onClose, onChatAbout }: BeadDetailProps) {\n  const [isEditing, setIsEditing] = useState(false);\n  \n  return (\n    \u003cdiv className=\"bead-detail p-4 border-l bg-card\"\u003e\n      \u003cHeader bead={bead} onClose={onClose} /\u003e\n      \u003cMetadataRow bead={bead} onUpdate={onUpdate} /\u003e\n      \u003cSeparator /\u003e\n      \u003cDescription description={bead.description} /\u003e\n      \u003cSeparator /\u003e\n      \u003cDependencies bead={bead} /\u003e\n      \u003cSeparator /\u003e\n      \u003cActions \n        beadId={bead.id} \n        onChatAbout={onChatAbout}\n        onEdit={() =\u003e setIsEditing(true)}\n        onDelete={handleDelete}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Header Section\n\n```typescript\nfunction Header({ bead, onClose }: { bead: Bead; onClose: () =\u003e void }) {\n  return (\n    \u003cdiv className=\"flex items-start justify-between gap-2 mb-4\"\u003e\n      \u003ch3 className=\"font-semibold text-lg leading-tight\"\u003e{bead.title}\u003c/h3\u003e\n      \u003cButton variant=\"ghost\" size=\"icon\" onClick={onClose}\u003e\n        \u003cX className=\"h-4 w-4\" /\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Metadata Row with Inline Edit\n\n```typescript\nfunction MetadataRow({ bead, onUpdate }: { bead: Bead; onUpdate: Function }) {\n  return (\n    \u003cdiv className=\"flex flex-wrap gap-4 mb-4\"\u003e\n      {/* Status dropdown */}\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cspan className=\"text-sm text-muted-foreground\"\u003eStatus:\u003c/span\u003e\n        \u003cSelect \n          value={bead.status} \n          onValueChange={(status) =\u003e onUpdate({ status })}\n        \u003e\n          \u003cSelectTrigger className=\"w-32\"\u003e\n            \u003cStatusIndicator status={bead.status} /\u003e\n            \u003cspan className=\"ml-2\"\u003e{bead.status}\u003c/span\u003e\n          \u003c/SelectTrigger\u003e\n          \u003cSelectContent\u003e\n            \u003cSelectItem value=\"open\"\u003eOpen\u003c/SelectItem\u003e\n            \u003cSelectItem value=\"in_progress\"\u003eIn Progress\u003c/SelectItem\u003e\n            \u003cSelectItem value=\"closed\"\u003eClosed\u003c/SelectItem\u003e\n          \u003c/SelectContent\u003e\n        \u003c/Select\u003e\n      \u003c/div\u003e\n      \n      {/* Priority dropdown */}\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cspan className=\"text-sm text-muted-foreground\"\u003ePriority:\u003c/span\u003e\n        \u003cSelect \n          value={String(bead.priority)} \n          onValueChange={(p) =\u003e onUpdate({ priority: parseInt(p) })}\n        \u003e\n          \u003cSelectTrigger className=\"w-20\"\u003e\n            \u003cspan\u003eP{bead.priority}\u003c/span\u003e\n          \u003c/SelectTrigger\u003e\n          \u003cSelectContent\u003e\n            \u003cSelectItem value=\"0\"\u003eP0 - Critical\u003c/SelectItem\u003e\n            \u003cSelectItem value=\"1\"\u003eP1 - High\u003c/SelectItem\u003e\n            \u003cSelectItem value=\"2\"\u003eP2 - Medium\u003c/SelectItem\u003e\n            \u003cSelectItem value=\"3\"\u003eP3 - Low\u003c/SelectItem\u003e\n            \u003cSelectItem value=\"4\"\u003eP4 - Backlog\u003c/SelectItem\u003e\n          \u003c/SelectContent\u003e\n        \u003c/Select\u003e\n      \u003c/div\u003e\n      \n      {/* Type badge (read-only) */}\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cspan className=\"text-sm text-muted-foreground\"\u003eType:\u003c/span\u003e\n        \u003cBadge variant=\"outline\"\u003e{bead.type}\u003c/Badge\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Description with Markdown\n\n```typescript\nimport ReactMarkdown from 'react-markdown';\n\nfunction Description({ description }: { description?: string }) {\n  if (!description) {\n    return (\n      \u003cp className=\"text-muted-foreground italic\"\u003eNo description\u003c/p\u003e\n    );\n  }\n  \n  return (\n    \u003cdiv className=\"prose prose-sm dark:prose-invert max-w-none\"\u003e\n      \u003cReactMarkdown\u003e{description}\u003c/ReactMarkdown\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nNote: May need to install `react-markdown` if not already present.\n\n---\n\n## Dependencies Section\n\n```typescript\nfunction Dependencies({ bead }: { bead: Bead }) {\n  const hasBlocks = bead.blocks \u0026\u0026 bead.blocks.length \u003e 0;\n  const hasBlockedBy = bead.blockedBy \u0026\u0026 bead.blockedBy.length \u003e 0;\n  \n  if (!hasBlocks \u0026\u0026 !hasBlockedBy) {\n    return null;\n  }\n  \n  return (\n    \u003cdiv className=\"space-y-2\"\u003e\n      \u003ch4 className=\"text-sm font-medium\"\u003eDependencies\u003c/h4\u003e\n      \n      {hasBlockedBy \u0026\u0026 (\n        \u003cdiv className=\"text-sm\"\u003e\n          \u003cspan className=\"text-muted-foreground\"\u003eBlocked by: \u003c/span\u003e\n          {bead.blockedBy.map(id =\u003e (\n            \u003cBeadLink key={id} beadId={id} /\u003e\n          ))}\n        \u003c/div\u003e\n      )}\n      \n      {hasBlocks \u0026\u0026 (\n        \u003cdiv className=\"text-sm\"\u003e\n          \u003cspan className=\"text-muted-foreground\"\u003eBlocks: \u003c/span\u003e\n          {bead.blocks.map(id =\u003e (\n            \u003cBeadLink key={id} beadId={id} /\u003e\n          ))}\n        \u003c/div\u003e\n      )}\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Actions Section\n\n```typescript\nfunction Actions({ beadId, onChatAbout, onEdit, onDelete }) {\n  return (\n    \u003cdiv className=\"flex gap-2 mt-4\"\u003e\n      \u003cButton variant=\"outline\" size=\"sm\" onClick={() =\u003e onChatAbout(beadId)}\u003e\n        \u003cMessageSquare className=\"h-4 w-4 mr-2\" /\u003e\n        Chat about this\n      \u003c/Button\u003e\n      \n      \u003cButton variant=\"outline\" size=\"sm\" onClick={onEdit}\u003e\n        \u003cPencil className=\"h-4 w-4 mr-2\" /\u003e\n        Edit\n      \u003c/Button\u003e\n      \n      \u003cButton variant=\"outline\" size=\"sm\" className=\"text-destructive\" onClick={onDelete}\u003e\n        \u003cTrash className=\"h-4 w-4 mr-2\" /\u003e\n        Delete\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Delete Confirmation\n\n```typescript\nfunction handleDelete(beadId: string) {\n  // Use Alert Dialog for confirmation\n  // \"Are you sure you want to delete this task? This action cannot be undone.\"\n  // On confirm: call onDelete(beadId) and close detail panel\n}\n```\n\n---\n\n## Files to Create\n\n- `src/components/planning/BeadDetail.tsx`\n- `src/components/planning/BeadLink.tsx` (link to another bead by ID)\n\n---\n\n## Acceptance Criteria\n\n- [ ] Panel displays when bead is selected\n- [ ] Title, status, priority, type visible at a glance\n- [ ] Status and priority editable via dropdowns\n- [ ] Description renders markdown properly\n- [ ] Dependencies section shows blocks/blocked-by\n- [ ] 'Chat about this' button works (Task 5.3)\n- [ ] 'Delete' shows confirmation before deleting\n- [ ] Close button dismisses panel\n- [ ] Optimistic updates for status/priority changes\n- [ ] Mobile-friendly layout\n\n---\n\n## Dependencies\n\n- Requires: Beads API Endpoints (3.2) for updates\n- Requires: BeadsList (4.1) for selection\n\n---\n\n## Testing Notes\n\n- Test editing status and priority\n- Test markdown rendering edge cases\n- Test delete confirmation flow\n- Test with very long descriptions","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:07:56.344265-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.13","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:07:56.346697-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.13","depends_on_id":"maestro-g88.10","type":"blocks","created_at":"2025-12-30T23:14:51.875367-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.14","title":"Phase 4.3: Integrate Plan UI into Planning Page","description":"## Task Overview\n\nWire up the BeadsList and BeadDetail components into the planning page's right pane, replacing the placeholder components created in Phase 1.3.\n\n---\n\n## Background \u0026 Context\n\nPhase 1.3 created the planning page with placeholder components. This task integrates the real Plan UI components into the right pane.\n\n---\n\n## Implementation Details\n\n### Right Pane Structure\n\n```tsx\n// In PlanningRightPane.tsx\n\nfunction PlanningRightPane({ \n  projectId, \n  issueNumber \n}: { \n  projectId: string; \n  issueNumber: number; \n}) {\n  const { beads, isConnected, error } = useBeadsWatch(projectId, issueNumber);\n  const [selectedBeadId, setSelectedBeadId] = useState\u003cstring | null\u003e(null);\n  \n  // Build tree from flat beads\n  const tree = useMemo(() =\u003e buildBeadTree(beads), [beads]);\n  \n  // Get selected bead\n  const selectedBead = selectedBeadId \n    ? beads.find(b =\u003e b.id === selectedBeadId) \n    : null;\n  \n  const handleUpdate = async (updates: UpdateBeadOptions) =\u003e {\n    await fetch(`/api/projects/${projectId}/planning/${issueNumber}/beads/${selectedBeadId}`, {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(updates),\n    });\n    // Optimistic update or wait for file watcher\n  };\n  \n  return (\n    \u003cdiv className=\"flex flex-col h-full\"\u003e\n      {/* View toggle (future: List | Graph) */}\n      \u003cdiv className=\"flex items-center justify-between p-2 border-b\"\u003e\n        \u003ch3 className=\"font-medium\"\u003ePlan\u003c/h3\u003e\n        {!isConnected \u0026\u0026 (\n          \u003cBadge variant=\"outline\" className=\"text-yellow-600\"\u003e\n            Offline\n          \u003c/Badge\u003e\n        )}\n      \u003c/div\u003e\n      \n      {/* Main content */}\n      \u003cdiv className=\"flex flex-1 overflow-hidden\"\u003e\n        {/* Beads list */}\n        \u003cdiv className=\"flex-1 overflow-auto\"\u003e\n          {tree ? (\n            \u003cBeadsList \n              tree={tree}\n              selectedId={selectedBeadId}\n              onSelect={setSelectedBeadId}\n            /\u003e\n          ) : (\n            \u003cEmptyState message=\"No beads yet. The AI is analyzing your issue...\" /\u003e\n          )}\n        \u003c/div\u003e\n        \n        {/* Detail panel (conditional) */}\n        {selectedBead \u0026\u0026 (\n          \u003cdiv className=\"w-80 border-l overflow-auto\"\u003e\n            \u003cBeadDetail \n              bead={selectedBead}\n              onUpdate={handleUpdate}\n              onClose={() =\u003e setSelectedBeadId(null)}\n              onChatAbout={handleChatAbout}\n            /\u003e\n          \u003c/div\u003e\n        )}\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Tree Building Logic\n\n```typescript\nfunction buildBeadTree(beads: Bead[]): BeadTree | null {\n  if (beads.length === 0) return null;\n  \n  // Find the epic (root)\n  const epic = beads.find(b =\u003e b.type === 'epic' \u0026\u0026 !b.parent);\n  if (!epic) return null;\n  \n  const beadMap = new Map(beads.map(b =\u003e [b.id, b]));\n  \n  function buildNode(bead: Bead): BeadTree {\n    const children = beads\n      .filter(b =\u003e b.parent === bead.id)\n      .sort((a, b) =\u003e {\n        // Sort by priority, then by ID\n        if (a.priority !== b.priority) return a.priority - b.priority;\n        return a.id.localeCompare(b.id);\n      })\n      .map(buildNode);\n    \n    return { root: bead, children };\n  }\n  \n  return buildNode(epic);\n}\n```\n\n---\n\n## Mobile Layout Integration\n\nFor mobile (\u003c 1024px), the right pane content appears in the 'Plan' tab:\n\n```tsx\n// In page.tsx mobile section\n\n\u003cTabs defaultValue=\"chat\"\u003e\n  \u003cTabsList\u003e\n    \u003cTabsTrigger value=\"chat\"\u003eSetup/Chat\u003c/TabsTrigger\u003e\n    \u003cTabsTrigger value=\"plan\"\u003e\n      Plan\n      {hasNewBeads \u0026\u0026 \u003cspan className=\"ml-1 h-2 w-2 rounded-full bg-blue-500\" /\u003e}\n    \u003c/TabsTrigger\u003e\n  \u003c/TabsList\u003e\n  \n  \u003cTabsContent value=\"chat\"\u003e\n    \u003cPlanningLeftPane ... /\u003e\n  \u003c/TabsContent\u003e\n  \n  \u003cTabsContent value=\"plan\"\u003e\n    \u003cPlanningRightPane ... /\u003e\n  \u003c/TabsContent\u003e\n\u003c/Tabs\u003e\n```\n\n---\n\n## Unread Indicator Logic\n\nTrack when beads change while viewing the chat tab:\n\n```typescript\nconst [lastViewedBeadsHash, setLastViewedBeadsHash] = useState('');\nconst currentBeadsHash = useMemo(() =\u003e JSON.stringify(beads), [beads]);\nconst hasNewBeads = currentBeadsHash !== lastViewedBeadsHash;\n\n// When switching to plan tab\nfunction handleTabChange(value: string) {\n  if (value === 'plan') {\n    setLastViewedBeadsHash(currentBeadsHash);\n  }\n}\n```\n\n---\n\n## Empty State\n\n```tsx\nfunction EmptyState({ message }: { message: string }) {\n  return (\n    \u003cdiv className=\"flex flex-col items-center justify-center h-full p-8 text-center\"\u003e\n      \u003cListTodo className=\"h-12 w-12 text-muted-foreground mb-4\" /\u003e\n      \u003cp className=\"text-muted-foreground\"\u003e{message}\u003c/p\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Files to Modify\n\n- `src/app/project/[id]/planning/[issueNumber]/page.tsx`\n- `src/components/planning/PlanningRightPane.tsx`\n\n---\n\n## Acceptance Criteria\n\n- [ ] BeadsList renders in right pane on desktop\n- [ ] BeadDetail appears when bead is selected\n- [ ] Selection state managed correctly\n- [ ] Real-time updates from useBeadsWatch reflected\n- [ ] Empty state shown when no beads\n- [ ] Mobile tabs show Plan content correctly\n- [ ] Unread indicator shows when beads change while on chat tab\n- [ ] Optimistic updates for bead edits\n\n---\n\n## Dependencies\n\n- Requires: BeadsList (4.1)\n- Requires: BeadDetail (4.2)\n- Requires: useBeadsWatch (3.3)\n- Requires: Planning Page Layout (1.3)\n\n---\n\n## Testing Notes\n\n- Test with no beads initially, then beads arriving\n- Test selection persistence across bead updates\n- Test mobile tab switching with unread indicator\n- Test resize behavior of split pane","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:08:36.756804-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.14","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:08:36.75942-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.14","depends_on_id":"maestro-g88.12","type":"blocks","created_at":"2025-12-30T23:14:51.910029-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.14","depends_on_id":"maestro-g88.13","type":"blocks","created_at":"2025-12-30T23:14:51.943761-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.14","depends_on_id":"maestro-g88.3","type":"blocks","created_at":"2025-12-30T23:14:51.978142-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.14","depends_on_id":"maestro-g88.11","type":"blocks","created_at":"2025-12-31T07:52:30.745091-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.15","title":"Phase 5.1: Build Planning Chat Component","description":"## Task Overview\n\nCreate the chat component for the planning page that allows users to refine the plan through conversation with the AI agent.\n\n---\n\n## Background \u0026 Context\n\n### Refinement Model (from GH Issue #6)\n\nTwo modes of refinement:\n1. **Holistic (Slash Commands)**: `/turn_gh_issue_into_beads`, `/improve_beads`\n2. **Granular (Free-form)**: Natural conversation about specific beads\n\nThe chat component supports both by treating all input as messages to the OpenCode session.\n\n---\n\n## Visual Design\n\n```\n┌─────────────────────────────────────────────────────┐\n│  Chat                                               │\n│  ─────────────────────────────────────────────────  │\n│                                                     │\n│  ┌─────────────────────────────────────────────┐   │\n│  │ System: Planning session started for issue #6   │\n│  └─────────────────────────────────────────────┘   │\n│                                                     │\n│  ┌─────────────────────────────────────────────┐   │\n│  │ You: /turn_gh_issue_into_beads 6               │\n│  └─────────────────────────────────────────────┘   │\n│                                                     │\n│  ┌─────────────────────────────────────────────┐   │\n│  │ Agent: I'll analyze issue #6 and create a      │\n│  │ task breakdown...                              │\n│  │ [Tool: bd create --title=\"Phase 1.1...\" ]      │\n│  │ Created task maestro-g88.1                     │\n│  └─────────────────────────────────────────────┘   │\n│                                                     │\n│  ─────────────────────────────────────────────────  │\n│                                                     │\n│  💡 Re: Phase 1.1: Add Start Planning Button       │ ← Context indicator\n│                                                     │\n│  ┌─────────────────────────────────────────────┐   │\n│  │ Break this into smaller steps               │   │\n│  └─────────────────────────────────────────────┘   │\n│  [Send]                                             │\n└─────────────────────────────────────────────────────┘\n```\n\n---\n\n## Component API\n\n```typescript\n// src/components/planning/PlanningChat.tsx\n\ninterface PlanningChatProps {\n  projectId: string;\n  issueNumber: number;\n  sessionId: string | null;\n  worktreePath: string | null;\n  selectedBead: Bead | null;  // For context injection\n  onClearContext: () =\u003e void;\n}\n\nexport function PlanningChat({\n  projectId,\n  issueNumber,\n  sessionId,\n  worktreePath,\n  selectedBead,\n  onClearContext,\n}: PlanningChatProps) {\n  const [messages, setMessages] = useState\u003cMessage[]\u003e([]);\n  const [input, setInput] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  \n  // ... implementation\n}\n```\n\n---\n\n## SSE Message Streaming\n\nReuse patterns from existing chat implementation:\n\n```typescript\nasync function sendMessage(text: string) {\n  // Inject bead context if selected\n  let messageText = text;\n  if (selectedBead) {\n    messageText = `[Context: Task \"${selectedBead.title}\" (ID: ${selectedBead.id})]\\n\\n${text}`;\n  }\n  \n  // Add user message to UI\n  setMessages(prev =\u003e [...prev, { role: 'user', content: text }]);\n  setIsLoading(true);\n  \n  // Start streaming response\n  const response = await fetch(`/api/projects/${projectId}/planning/${issueNumber}/chat`, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ message: messageText }),\n  });\n  \n  // Handle SSE stream...\n}\n```\n\n---\n\n## Context Indicator\n\nWhen a bead is selected for 'Chat about this':\n\n```tsx\n{selectedBead \u0026\u0026 (\n  \u003cdiv className=\"flex items-center gap-2 px-3 py-2 bg-accent/50 rounded-t-md\"\u003e\n    \u003cLightbulb className=\"h-4 w-4 text-yellow-500\" /\u003e\n    \u003cspan className=\"text-sm\"\u003eRe: {selectedBead.title}\u003c/span\u003e\n    \u003cButton variant=\"ghost\" size=\"icon\" className=\"h-5 w-5 ml-auto\" onClick={onClearContext}\u003e\n      \u003cX className=\"h-3 w-3\" /\u003e\n    \u003c/Button\u003e\n  \u003c/div\u003e\n)}\n```\n\n---\n\n## Tool Execution Display\n\nShow when the agent executes tools (like `bd create`):\n\n```tsx\nfunction ToolExecution({ tool, args, result }: ToolExecutionProps) {\n  return (\n    \u003cdiv className=\"bg-muted rounded p-2 text-sm font-mono my-2\"\u003e\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cTerminal className=\"h-4 w-4\" /\u003e\n        \u003cspan className=\"text-muted-foreground\"\u003eTool: {tool}\u003c/span\u003e\n      \u003c/div\u003e\n      \u003cdiv className=\"mt-1 text-xs text-muted-foreground\"\u003e\n        {args}\n      \u003c/div\u003e\n      {result \u0026\u0026 (\n        \u003cdiv className=\"mt-1 text-green-600 dark:text-green-400\"\u003e\n          {result}\n        \u003c/div\u003e\n      )}\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Slash Command Suggestions\n\nProvide quick access to common slash commands:\n\n```tsx\nfunction SlashCommandSuggestions({ onSelect }: { onSelect: (cmd: string) =\u003e void }) {\n  const commands = [\n    { cmd: '/improve_beads', desc: 'Holistically improve the current plan' },\n    { cmd: '/turn_gh_issue_into_beads', desc: 'Re-generate task breakdown' },\n  ];\n  \n  return (\n    \u003cdiv className=\"flex gap-2 mb-2\"\u003e\n      {commands.map(({ cmd, desc }) =\u003e (\n        \u003cButton \n          key={cmd}\n          variant=\"outline\" \n          size=\"sm\"\n          onClick={() =\u003e onSelect(cmd)}\n          title={desc}\n        \u003e\n          {cmd}\n        \u003c/Button\u003e\n      ))}\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## API Endpoint\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/chat/route.ts\n\nexport async function POST(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const { message } = await request.json();\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  // Get planning session\n  const session = await sessionStorage.getPlanningSession(projectId, issueNumber);\n  if (!session) {\n    return new Response('Planning session not found', { status: 404 });\n  }\n  \n  // Stream response via SSE\n  const stream = new ReadableStream({\n    async start(controller) {\n      const encoder = new TextEncoder();\n      \n      // Use full-access send with streaming\n      for await (const part of openCodeService.streamPlanningResponse(\n        session.worktreePath,\n        session.sessionId,\n        message\n      )) {\n        controller.enqueue(encoder.encode(`data: ${JSON.stringify(part)}\\n\\n`));\n      }\n      \n      controller.close();\n    }\n  });\n  \n  return new Response(stream, {\n    headers: {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n    },\n  });\n}\n```\n\n---\n\n## Files to Create\n\n- `src/components/planning/PlanningChat.tsx`\n- `src/components/planning/SlashCommandSuggestions.tsx`\n- `src/components/planning/ToolExecution.tsx`\n- `src/app/api/projects/[id]/planning/[issueNumber]/chat/route.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] Chat displays message history\n- [ ] User can send messages via input field\n- [ ] Responses stream in real-time via SSE\n- [ ] Context indicator shows when bead is selected\n- [ ] Tool executions rendered specially\n- [ ] Slash command suggestions accessible\n- [ ] Loading state during response generation\n- [ ] Works before session is ready (disabled state)\n- [ ] Mobile-friendly input area\n\n---\n\n## Dependencies\n\n- Requires: Extended OpenCode Service (2.3)\n- Requires: Extended Session Storage (2.2)\n- Requires: Setup Pipeline (2.4) for session creation\n\n---\n\n## Testing Notes\n\n- Test sending slash commands\n- Test with bead context selected\n- Test SSE streaming reliability\n- Test before session is ready\n- Test on mobile keyboard","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:09:23.871711-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.15","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:09:23.874117-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.15","depends_on_id":"maestro-g88.6","type":"blocks","created_at":"2025-12-30T23:14:57.813536-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.15","depends_on_id":"maestro-g88.23","type":"blocks","created_at":"2025-12-31T07:46:32.162037-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.16","title":"Phase 5.2: Integrate Chat into Left Pane with Setup Progress","description":"## Task Overview\n\nIntegrate the SetupProgress and PlanningChat components into the planning page's left pane, managing the transition from setup to chat mode.\n\n---\n\n## Background \u0026 Context\n\nThe left pane has two modes:\n1. **Setup Mode**: During initial environment setup\n2. **Chat Mode**: After setup completes\n\nThe pane should smoothly transition between these and maintain chat history.\n\n---\n\n## Visual Flow\n\n```\nSetup in Progress:\n┌─────────────────────────────────────────────────────┐\n│  Setting up planning environment...                 │\n│                                                     │\n│  ✓  Creating git worktree          (1.2s)          │\n│  ✓  Installing dependencies         (5.3s)          │\n│  ◐  Starting AI session...                          │\n│  ○  Analyzing issue                                 │\n└─────────────────────────────────────────────────────┘\n\nAfter Setup:\n┌─────────────────────────────────────────────────────┐\n│  ✓ Setup complete                    [Collapse ▴]  │\n│  ─────────────────────────────────────────────────  │\n│                                                     │\n│  Chat                                               │\n│  ┌─────────────────────────────────────────────┐   │\n│  │ System: Created epic with 15 subtasks           │\n│  └─────────────────────────────────────────────┘   │\n│                                                     │\n│  ...chat continues...                               │\n└─────────────────────────────────────────────────────┘\n```\n\n---\n\n## Component Structure\n\n```tsx\n// src/components/planning/PlanningLeftPane.tsx\n\ninterface PlanningLeftPaneProps {\n  projectId: string;\n  issueNumber: number;\n  issueTitle: string;\n  selectedBead: Bead | null;\n  onClearContext: () =\u003e void;\n}\n\nexport function PlanningLeftPane({\n  projectId,\n  issueNumber,\n  issueTitle,\n  selectedBead,\n  onClearContext,\n}: PlanningLeftPaneProps) {\n  const [setupState, setSetupState] = useState\u003c'pending' | 'in_progress' | 'completed' | 'error'\u003e('pending');\n  const [sessionInfo, setSessionInfo] = useState\u003c{ sessionId: string; worktreePath: string } | null\u003e(null);\n  const [setupCollapsed, setSetupCollapsed] = useState(false);\n  \n  // Check for existing session on mount\n  useEffect(() =\u003e {\n    checkExistingSession();\n  }, [projectId, issueNumber]);\n  \n  async function checkExistingSession() {\n    const response = await fetch(`/api/projects/${projectId}/planning/${issueNumber}/status`);\n    const data = await response.json();\n    \n    if (data.sessionId \u0026\u0026 data.worktreePath) {\n      setSessionInfo({ sessionId: data.sessionId, worktreePath: data.worktreePath });\n      setSetupState('completed');\n    } else {\n      setSetupState('pending');\n    }\n  }\n  \n  function handleSetupComplete(result: { sessionId: string; worktreePath: string }) {\n    setSessionInfo(result);\n    setSetupState('completed');\n    setSetupCollapsed(true);  // Auto-collapse after completion\n  }\n  \n  return (\n    \u003cdiv className=\"flex flex-col h-full\"\u003e\n      {/* Setup Progress (collapsible after completion) */}\n      {setupState !== 'completed' ? (\n        \u003cSetupProgress\n          projectId={projectId}\n          issueNumber={issueNumber}\n          issueTitle={issueTitle}\n          onComplete={handleSetupComplete}\n          onError={() =\u003e setSetupState('error')}\n        /\u003e\n      ) : (\n        \u003cCollapsible open={!setupCollapsed} onOpenChange={(open) =\u003e setSetupCollapsed(!open)}\u003e\n          \u003cCollapsibleTrigger asChild\u003e\n            \u003cbutton className=\"flex items-center justify-between w-full p-2 text-sm\"\u003e\n              \u003cspan className=\"flex items-center gap-2\"\u003e\n                \u003cCheckCircle className=\"h-4 w-4 text-green-500\" /\u003e\n                Setup complete\n              \u003c/span\u003e\n              {setupCollapsed ? \u003cChevronDown /\u003e : \u003cChevronUp /\u003e}\n            \u003c/button\u003e\n          \u003c/CollapsibleTrigger\u003e\n          \u003cCollapsibleContent\u003e\n            \u003cSetupSummary \n              branch={sessionInfo?.branch}\n              worktreePath={sessionInfo?.worktreePath}\n            /\u003e\n          \u003c/CollapsibleContent\u003e\n        \u003c/Collapsible\u003e\n      )}\n      \n      {/* Divider */}\n      \u003cSeparator /\u003e\n      \n      {/* Chat Section */}\n      \u003cdiv className=\"flex-1 overflow-hidden\"\u003e\n        \u003cPlanningChat\n          projectId={projectId}\n          issueNumber={issueNumber}\n          sessionId={sessionInfo?.sessionId ?? null}\n          worktreePath={sessionInfo?.worktreePath ?? null}\n          selectedBead={selectedBead}\n          onClearContext={onClearContext}\n        /\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Setup Summary\n\nShow minimal info after setup completes:\n\n```tsx\nfunction SetupSummary({ branch, worktreePath }: { branch?: string; worktreePath?: string }) {\n  return (\n    \u003cdiv className=\"p-2 text-xs text-muted-foreground space-y-1\"\u003e\n      \u003cdiv\u003eBranch: \u003ccode\u003e{branch}\u003c/code\u003e\u003c/div\u003e\n      \u003cdiv\u003eWorktree: \u003ccode className=\"truncate\"\u003e{worktreePath}\u003c/code\u003e\u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Status Check Endpoint\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/status/route.ts\n\nexport async function GET(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  // Get project\n  const project = await configService.getProject(projectId);\n  if (!project) {\n    return Response.json({ error: 'Project not found' }, { status: 404 });\n  }\n  \n  // Check worktree\n  const worktree = await worktreeService.getWorktree(project.path, issueNumber);\n  if (!worktree) {\n    return Response.json({ exists: false });\n  }\n  \n  // Check session\n  const session = await sessionStorage.getPlanningSession(projectId, issueNumber);\n  const sessionAlive = session ? await openCodeService.isSessionAlive(session.sessionId) : false;\n  \n  return Response.json({\n    exists: true,\n    worktreePath: worktree.path,\n    branch: worktree.branch,\n    depsInstalled: worktree.depsInstalled,\n    sessionId: sessionAlive ? session.sessionId : null,\n    sessionAlive,\n  });\n}\n```\n\n---\n\n## Auto-Start Setup\n\nWhen landing on the planning page without existing session, automatically start setup:\n\n```tsx\nuseEffect(() =\u003e {\n  if (setupState === 'pending') {\n    // Auto-start setup after brief delay\n    const timer = setTimeout(() =\u003e {\n      setSetupState('in_progress');\n    }, 500);\n    return () =\u003e clearTimeout(timer);\n  }\n}, [setupState]);\n```\n\n---\n\n## Files to Create\n\n- `src/components/planning/PlanningLeftPane.tsx`\n- `src/components/planning/SetupSummary.tsx`\n- `src/app/api/projects/[id]/planning/[issueNumber]/status/route.ts`\n\n## Files to Modify\n\n- `src/app/project/[id]/planning/[issueNumber]/page.tsx` - Wire up left pane\n\n---\n\n## Acceptance Criteria\n\n- [ ] Setup progress shows during initial setup\n- [ ] Auto-collapses after setup completes\n- [ ] Chat section expands to fill available space\n- [ ] Status endpoint returns correct worktree/session info\n- [ ] Existing session detected on page load\n- [ ] Smooth transition from setup to chat\n- [ ] Setup can be expanded again to view details\n\n---\n\n## Dependencies\n\n- Requires: SetupProgress (2.5)\n- Requires: PlanningChat (5.1)\n- Requires: Planning Page Layout (1.3)\n\n---\n\n## Testing Notes\n\n- Test fresh start (no existing session)\n- Test resume (existing session)\n- Test with dead session (needs new session)\n- Test collapse/expand behavior","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:10:05.399582-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.16","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:10:05.401837-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.16","depends_on_id":"maestro-g88.15","type":"blocks","created_at":"2025-12-30T23:14:57.848046-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.16","depends_on_id":"maestro-g88.8","type":"blocks","created_at":"2025-12-30T23:14:57.881844-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.16","depends_on_id":"maestro-g88.3","type":"blocks","created_at":"2025-12-30T23:14:57.915551-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.17","title":"Phase 5.3: Implement 'Chat About This' Bead Context Feature","description":"## Task Overview\n\nImplement the 'Chat about this' feature that allows users to select a bead from the list and have a contextual conversation about it.\n\n---\n\n## Background \u0026 Context\n\nFrom GH Issue #6 Refinement Model:\n\n\u003e **Granular Refinement (Free-form Chat)**\n\u003e For targeted changes to specific beads:\n\u003e \n\u003e User selects a bead in the UI, then chats naturally:\n\u003e - \"This task is too big, break it into smaller pieces\"\n\u003e - \"Combine task 2 and 3, they're really the same thing\"\n\u003e - \"Add a subtask for writing tests\"\n\u003e - \"Change the priority to P0, this is blocking\"\n\u003e - \"What files would this task touch?\"\n\n---\n\n## User Flow\n\n1. User clicks 'Chat about this' button in BeadDetail panel\n2. Selected bead context appears above chat input\n3. User types their message\n4. Message is sent with bead context prefixed\n5. Agent responds with full knowledge of the bead\n6. User can clear context or select a different bead\n\n---\n\n## State Management\n\n```tsx\n// In Planning Page\n\nconst [chatContextBead, setChatContextBead] = useState\u003cBead | null\u003e(null);\n\nfunction handleChatAbout(beadId: string) {\n  const bead = beads.find(b =\u003e b.id === beadId);\n  setChatContextBead(bead);\n  \n  // On mobile, switch to chat tab\n  if (isMobile) {\n    setActiveTab('chat');\n  }\n  \n  // Focus the chat input\n  chatInputRef.current?.focus();\n}\n\nfunction handleClearContext() {\n  setChatContextBead(null);\n}\n```\n\n---\n\n## Context Injection\n\nWhen sending a message with bead context:\n\n```typescript\nfunction buildContextualMessage(userMessage: string, bead: Bead): string {\n  return `[Context: Working on bead \"${bead.title}\" (ID: ${bead.id})]\n\nBead Details:\n- Type: ${bead.type}\n- Status: ${bead.status}\n- Priority: P${bead.priority}\n${bead.description ? `- Description excerpt: ${bead.description.substring(0, 200)}...` : ''}\n\nUser request: ${userMessage}`;\n}\n```\n\nThis provides the agent with enough context to understand:\n1. Which bead the user is referring to\n2. Current state of the bead\n3. What the user wants to do\n\n---\n\n## Context Indicator UI\n\n```tsx\n// In PlanningChat component\n\nfunction ContextIndicator({ \n  bead, \n  onClear \n}: { \n  bead: Bead; \n  onClear: () =\u003e void; \n}) {\n  return (\n    \u003cdiv className=\"flex items-center gap-2 px-3 py-2 bg-accent/50 rounded-t-lg border-b\"\u003e\n      \u003cdiv className=\"flex items-center gap-2 flex-1 min-w-0\"\u003e\n        \u003cMessageSquarePlus className=\"h-4 w-4 shrink-0 text-primary\" /\u003e\n        \u003cspan className=\"text-sm font-medium truncate\"\u003e{bead.title}\u003c/span\u003e\n        \u003cBadge variant=\"outline\" className=\"shrink-0\"\u003e{bead.type}\u003c/Badge\u003e\n      \u003c/div\u003e\n      \u003cButton \n        variant=\"ghost\" \n        size=\"icon\" \n        className=\"h-6 w-6 shrink-0\" \n        onClick={onClear}\n        title=\"Clear context\"\n      \u003e\n        \u003cX className=\"h-3 w-3\" /\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Keyboard Shortcut\n\nAllow clearing context with Escape:\n\n```tsx\nuseEffect(() =\u003e {\n  function handleKeyDown(e: KeyboardEvent) {\n    if (e.key === 'Escape' \u0026\u0026 chatContextBead) {\n      handleClearContext();\n    }\n  }\n  \n  window.addEventListener('keydown', handleKeyDown);\n  return () =\u003e window.removeEventListener('keydown', handleKeyDown);\n}, [chatContextBead]);\n```\n\n---\n\n## Switching Context\n\nWhen user clicks 'Chat about this' on a different bead while one is already selected:\n\n```typescript\nfunction handleChatAbout(beadId: string) {\n  const bead = beads.find(b =\u003e b.id === beadId);\n  \n  // If switching context, just replace\n  setChatContextBead(bead);\n  \n  // Could optionally show a toast: \"Now chatting about: {bead.title}\"\n}\n```\n\n---\n\n## Mobile Flow\n\nOn mobile, after clicking 'Chat about this':\n1. Switch to Chat tab automatically\n2. Show context indicator\n3. Focus input\n\n```tsx\nfunction handleChatAbout(beadId: string) {\n  const bead = beads.find(b =\u003e b.id === beadId);\n  setChatContextBead(bead);\n  \n  // Mobile: switch tabs\n  if (window.innerWidth \u003c 1024) {\n    setActiveTab('chat');\n  }\n}\n```\n\n---\n\n## Files to Modify\n\n- `src/app/project/[id]/planning/[issueNumber]/page.tsx` - Add context state management\n- `src/components/planning/PlanningChat.tsx` - Add context indicator\n- `src/components/planning/BeadDetail.tsx` - Wire up 'Chat about this' button\n- `src/components/planning/PlanningLeftPane.tsx` - Pass context props\n\n---\n\n## Acceptance Criteria\n\n- [ ] 'Chat about this' button sets bead as chat context\n- [ ] Context indicator appears above chat input\n- [ ] X button clears context\n- [ ] Escape key clears context\n- [ ] Messages sent with context include bead info\n- [ ] Mobile switches to chat tab when context is set\n- [ ] Switching beads updates context\n- [ ] Agent responses reference the bead appropriately\n\n---\n\n## Dependencies\n\n- Requires: PlanningChat (5.1)\n- Requires: BeadDetail (4.2)\n- Requires: Integrate Chat into Left Pane (5.2)\n\n---\n\n## Testing Notes\n\n- Test setting context from detail panel\n- Test clearing context via button and keyboard\n- Test mobile tab switch behavior\n- Test that agent receives proper context","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T23:10:40.003521-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.17","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:10:40.00605-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.17","depends_on_id":"maestro-g88.15","type":"blocks","created_at":"2025-12-30T23:14:57.949288-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.17","depends_on_id":"maestro-g88.13","type":"blocks","created_at":"2025-12-30T23:14:57.982333-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.18","title":"Phase 6.1: Implement Session Resume and Recovery Logic","description":"## Task Overview\n\nImplement robust session resume logic that handles various states when a user returns to a planning page, including recovering from dead sessions.\n\n---\n\n## Background \u0026 Context\n\nFrom GH Issue #6 Resume Behavior:\n\n\u003e When navigating back to a planning page:\n\u003e 1. Check if worktree exists at `~/.maestro/worktrees/{project-slug}/issue-{number}/`\n\u003e 2. If exists:\n\u003e    - Skip worktree creation step (show as completed)\n\u003e    - Check if `node_modules` exists → skip deps install if yes\n\u003e    - Check if OpenCode session is alive via `isSessionAlive()`\n\u003e    - If session alive → reconnect; if dead → create new session\n\u003e 3. Load current bead state from `.beads/` via CLI\n\u003e 4. Show where user left off\n\n---\n\n## State Machine\n\n```\n┌──────────────────────────────────────────────────────────┐\n│                    PLANNING PAGE LOAD                     │\n└──────────────────────────────────────────────────────────┘\n                            │\n                            ▼\n                    ┌───────────────┐\n                    │ Check Status  │\n                    │   Endpoint    │\n                    └───────────────┘\n                            │\n            ┌───────────────┼───────────────┐\n            ▼               ▼               ▼\n    ┌──────────────┐ ┌──────────────┐ ┌──────────────┐\n    │ No Worktree  │ │  Worktree +  │ │  Worktree +  │\n    │  (Fresh)     │ │ Live Session │ │ Dead Session │\n    └──────────────┘ └──────────────┘ └──────────────┘\n            │               │               │\n            ▼               ▼               ▼\n    ┌──────────────┐ ┌──────────────┐ ┌──────────────┐\n    │ Start Full   │ │  Reconnect   │ │  Create New  │\n    │   Setup      │ │   Session    │ │   Session    │\n    └──────────────┘ └──────────────┘ └──────────────┘\n            │               │               │\n            └───────────────┴───────────────┘\n                            │\n                            ▼\n                    ┌───────────────┐\n                    │  Load Beads   │\n                    │  Show Chat    │\n                    └───────────────┘\n```\n\n---\n\n## Session Alive Check\n\n**IMPORTANT:** The existing `isSessionAlive` method in OpenCodeService takes BOTH projectPath and sessionId:\n\n```typescript\n// Existing method in src/lib/services/opencode.ts - DO NOT CHANGE SIGNATURE\nasync isSessionAlive(projectPath: string, sessionId: string): Promise\u003cboolean\u003e\n```\n\nFor planning sessions, use the worktreePath as the projectPath:\n\n```typescript\n// Usage in status check\nconst isAlive = await openCodeService.isSessionAlive(\n  session.worktreePath,  // Use worktree path, not original project path\n  session.sessionId\n);\n```\n\n---\n\n## Resume Flow Implementation\n\n```typescript\n// In PlanningLeftPane or custom hook\n\ninterface ResumeState {\n  status: 'checking' | 'fresh' | 'resuming' | 'recovered' | 'ready' | 'error';\n  worktree: WorktreeInfo | null;\n  session: { id: string; isNew: boolean } | null;\n  error: Error | null;\n}\n\nasync function initializePlanningSession(\n  projectId: string,\n  issueNumber: number\n): Promise\u003cResumeState\u003e {\n  // Step 1: Check status endpoint\n  const statusResponse = await fetch(\n    `/api/projects/${projectId}/planning/${issueNumber}/status`\n  );\n  const status = await statusResponse.json();\n  \n  // Case 1: No worktree exists - fresh start\n  if (!status.exists) {\n    return {\n      status: 'fresh',\n      worktree: null,\n      session: null,\n      error: null,\n    };\n  }\n  \n  // Case 2: Worktree exists, session alive - resume\n  if (status.sessionAlive) {\n    return {\n      status: 'ready',\n      worktree: {\n        path: status.worktreePath,\n        branch: status.branch,\n        depsInstalled: status.depsInstalled,\n      },\n      session: { id: status.sessionId, isNew: false },\n      error: null,\n    };\n  }\n  \n  // Case 3: Worktree exists, session dead - recover\n  const recoverResponse = await fetch(\n    `/api/projects/${projectId}/planning/${issueNumber}/session`,\n    { method: 'POST' }\n  );\n  \n  if (!recoverResponse.ok) {\n    return {\n      status: 'error',\n      worktree: null,\n      session: null,\n      error: new Error('Failed to recover session'),\n    };\n  }\n  \n  const { sessionId } = await recoverResponse.json();\n  \n  return {\n    status: 'recovered',\n    worktree: {\n      path: status.worktreePath,\n      branch: status.branch,\n      depsInstalled: status.depsInstalled,\n    },\n    session: { id: sessionId, isNew: true },\n    error: null,\n  };\n}\n```\n\n---\n\n## Session Creation Endpoint\n\nFor recovering dead sessions:\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/session/route.ts\n\nexport async function POST(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  // Get project and worktree\n  const project = await configService.getProject(projectId);\n  const worktree = await worktreeService.getWorktree(project.path, issueNumber);\n  \n  if (!worktree) {\n    return Response.json({ error: 'No worktree found' }, { status: 404 });\n  }\n  \n  // Create new session in worktree context\n  const sessionId = await openCodeService.createPlanningSession(worktree.path);\n  \n  // Update session storage\n  await sessionStorage.saveSession(\n    projectId,\n    project.path,\n    issueNumber,\n    sessionId,\n    { sessionType: 'planning', worktreePath: worktree.path }\n  );\n  \n  return Response.json({ sessionId });\n}\n\nexport async function GET(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  const session = await sessionStorage.getPlanningSession(projectId, issueNumber);\n  \n  if (!session) {\n    return Response.json({ error: 'No session found' }, { status: 404 });\n  }\n  \n  // Use worktreePath for session alive check\n  const isAlive = await openCodeService.isSessionAlive(\n    session.worktreePath,\n    session.sessionId\n  );\n  \n  return Response.json({\n    sessionId: session.sessionId,\n    isAlive,\n    worktreePath: session.worktreePath,\n    createdAt: session.createdAt,\n  });\n}\n```\n\n---\n\n## UI Feedback for Recovery\n\n```tsx\nfunction RecoveryNotice({ onDismiss }: { onDismiss: () =\u003e void }) {\n  return (\n    \u003cdiv className=\"flex items-center gap-2 px-3 py-2 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-200 rounded-md mb-4\"\u003e\n      \u003cAlertCircle className=\"h-4 w-4\" /\u003e\n      \u003cspan className=\"text-sm\"\u003ePrevious session expired. Created new session.\u003c/span\u003e\n      \u003cButton variant=\"ghost\" size=\"icon\" className=\"h-5 w-5 ml-auto\" onClick={onDismiss}\u003e\n        \u003cX className=\"h-3 w-3\" /\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Chat History Persistence\n\nWhen recovering a session, the old chat history is lost. For MVP, accept that new sessions start fresh but beads are preserved (beads are stored in .beads/ directory, not tied to session).\n\n---\n\n## Files to Create\n\n- `src/app/api/projects/[id]/planning/[issueNumber]/session/route.ts`\n- `src/lib/hooks/usePlanningSession.ts`\n\n## Files to Modify\n\n- `src/components/planning/PlanningLeftPane.tsx` - Use resume logic\n\n---\n\n## Acceptance Criteria\n\n- [ ] Fresh start (no worktree) triggers full setup\n- [ ] Existing worktree + live session reconnects smoothly\n- [ ] Dead session is detected and new session created\n- [ ] Recovery notice shown when session was recreated\n- [ ] Beads are loaded from existing worktree\n- [ ] No duplicate worktree creation\n- [ ] Error states handled gracefully\n\n---\n\n## Dependencies\n\n- Requires: Status endpoint (from Task 5.2)\n- Requires: Session storage extension (Task 2.2)\n- Requires: OpenCode service extension (Task 2.3)\n\n---\n\n## Testing Notes\n\n- Test fresh start\n- Test page reload with live session\n- Test after session timeout/death\n- Test after OpenCode server restart\n- Test with corrupted session storage","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:11:41.544152-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.18","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:11:41.546389-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.18","depends_on_id":"maestro-g88.5","type":"blocks","created_at":"2025-12-30T23:15:04.222278-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.18","depends_on_id":"maestro-g88.6","type":"blocks","created_at":"2025-12-30T23:15:04.25685-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.18","depends_on_id":"maestro-g88.16","type":"blocks","created_at":"2025-12-30T23:15:04.290897-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.19","title":"Phase 6.2: Add Planning Sessions to Sidebar Navigation","description":"## Task Overview\n\nAdd planning sessions to the sidebar navigation so users can easily access and resume their in-progress planning sessions.\n\n---\n\n## Background \u0026 Context\n\nFrom GH Issue #6 Navigation \u0026 Visibility:\n\n\u003e **Left Sidebar Enhancement**\n\u003e - Planning sessions appear in sidebar under the project\n\u003e - Visual indicator: 📋 or planning icon\n\u003e - Shows: \"Planning #6: {issue title truncated}\"\n\u003e - Click to navigate back to planning page\n\n---\n\n## Visual Design\n\n```\nSidebar (Project Section):\n┌─────────────────────────────────────┐\n│  📁 maestro                         │\n│  ─────────────────────────────────  │\n│  📋 Planning #6: Planning Mode...   │ ← Active planning\n│  📋 Planning #3: Add dark mode...   │\n│  ─────────────────────────────────  │\n│  💬 Recent Chats                    │\n│     Issue #5: Responsive Design     │\n│     Solo: Quick refactor            │\n│  ─────────────────────────────────  │\n│  [+ New Issue]  [Solo Chat]         │\n└─────────────────────────────────────┘\n```\n\n---\n\n## Data Source\n\nFetch active planning sessions from session storage:\n\n```typescript\n// In sidebar or via API\n\nasync function getActivePlanningSessions(projectId: string): Promise\u003cPlanningSessionInfo[]\u003e {\n  const sessions = await sessionStorage.listPlanningSessions(projectId);\n  \n  // Filter to only alive sessions\n  const aliveSessions = await Promise.all(\n    sessions.map(async (session) =\u003e {\n      const isAlive = await openCodeService.isSessionAlive(session.sessionId);\n      if (!isAlive) return null;\n      \n      // Get issue title from somewhere (GitHub API or cached)\n      const issueTitle = await getIssueTitle(projectId, session.issueNumber);\n      \n      return {\n        issueNumber: session.issueNumber,\n        issueTitle,\n        worktreePath: session.worktreePath,\n        createdAt: session.createdAt,\n      };\n    })\n  );\n  \n  return aliveSessions.filter(Boolean);\n}\n```\n\n---\n\n## API Endpoint\n\n```typescript\n// src/app/api/projects/[id]/planning/route.ts\n\nexport async function GET(\n  request: Request,\n  { params }: { params: { id: string } }\n) {\n  const projectId = params.id;\n  const sessions = await getActivePlanningSessions(projectId);\n  \n  return Response.json({ sessions });\n}\n```\n\n---\n\n## Sidebar Integration\n\n```tsx\n// In sidebar component\n\nconst { data: planningSessions } = useSWR(\n  `/api/projects/${projectId}/planning`,\n  fetcher\n);\n\n// Render section\n{planningSessions \u0026\u0026 planningSessions.length \u003e 0 \u0026\u0026 (\n  \u003cSidebarGroup\u003e\n    \u003cSidebarGroupLabel\u003eActive Planning\u003c/SidebarGroupLabel\u003e\n    \u003cSidebarGroupContent\u003e\n      {planningSessions.map((session) =\u003e (\n        \u003cSidebarMenuItem key={session.issueNumber}\u003e\n          \u003cSidebarMenuButton asChild\u003e\n            \u003cLink href={`/project/${projectId}/planning/${session.issueNumber}`}\u003e\n              \u003cClipboardList className=\"h-4 w-4\" /\u003e\n              \u003cspan className=\"truncate\"\u003e\n                #{session.issueNumber}: {session.issueTitle}\n              \u003c/span\u003e\n            \u003c/Link\u003e\n          \u003c/SidebarMenuButton\u003e\n        \u003c/SidebarMenuItem\u003e\n      ))}\n    \u003c/SidebarGroupContent\u003e\n  \u003c/SidebarGroup\u003e\n)}\n```\n\n---\n\n## Active Indicator\n\nHighlight the current planning session in sidebar:\n\n```tsx\nconst pathname = usePathname();\nconst isActive = pathname === `/project/${projectId}/planning/${session.issueNumber}`;\n\n\u003cSidebarMenuButton asChild isActive={isActive}\u003e\n  ...\n\u003c/SidebarMenuButton\u003e\n```\n\n---\n\n## Session Cleanup\n\nConsider adding a way to close/cleanup planning sessions:\n\n1. Right-click context menu with \"End Planning\"\n2. This could close the session and delete the worktree\n3. Or just hide from sidebar without cleanup\n\nFor MVP, sessions naturally disappear when they expire or worktree is deleted.\n\n---\n\n## Files to Create\n\n- `src/app/api/projects/[id]/planning/route.ts`\n\n## Files to Modify\n\n- `src/components/app-sidebar.tsx` - Add planning sessions section\n\n---\n\n## Acceptance Criteria\n\n- [ ] Planning sessions appear in sidebar under project\n- [ ] Shows issue number and truncated title\n- [ ] Click navigates to planning page\n- [ ] Active session is highlighted\n- [ ] Updates when new planning session starts\n- [ ] Empty state (no active planning) is clean\n- [ ] Mobile sidebar shows planning sessions\n\n---\n\n## Dependencies\n\n- Requires: Session storage extension (2.2)\n- Requires: Planning page exists (1.3)\n\n---\n\n## Testing Notes\n\n- Test with 0, 1, and multiple planning sessions\n- Test navigation from sidebar\n- Test with very long issue titles\n- Test after session expiration (should disappear)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T23:12:11.156738-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.19","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:12:11.159025-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.19","depends_on_id":"maestro-g88.5","type":"blocks","created_at":"2025-12-30T23:15:04.324445-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.19","depends_on_id":"maestro-g88.3","type":"blocks","created_at":"2025-12-30T23:15:04.357114-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.2","title":"Phase 1.2: Build Planning Confirmation Modal","description":"## Task Overview\n\nCreate a confirmation modal that explains what will happen when the user starts planning mode, and allows them to confirm or cancel.\n\n---\n\n## Background \u0026 Context\n\nStarting planning mode has side effects:\n1. Creates a git worktree (disk space, git operations)\n2. Installs dependencies (potentially slow)\n3. Starts an AI session that will modify beads\n\nUsers should understand these implications before proceeding. The modal also serves as a 'last chance' to back out if they clicked accidentally.\n\n---\n\n## Implementation Details\n\n### Modal Content\n\n**Header:**\n'Start Planning for #{issueNumber}'\n\n**Body:**\n```\nThis will set up an isolated environment for planning this issue:\n\n• Create a git worktree for safe, isolated changes\n• Install dependencies in the worktree\n• Start an AI session to break down the issue into tasks\n\nThe AI will analyze the issue and codebase to create an initial task breakdown. You can refine the plan before execution.\n```\n\n**Footer:**\n- Cancel button (secondary/outline)\n- 'Start Planning' button (primary)\n\n### Modal Component\n\nUse shadcn `Dialog` component. Create a new component:\n`src/components/planning/StartPlanningModal.tsx`\n\nProps interface:\n```typescript\ninterface StartPlanningModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n  projectId: string;\n  issueNumber: number;\n  issueTitle: string;\n  onConfirm: () =\u003e void;\n}\n```\n\n### UX Considerations\n\n- Modal should be closeable via:\n  - Cancel button\n  - Clicking outside (default Dialog behavior)\n  - Escape key\n- 'Start Planning' button should show loading state during navigation\n- Consider adding a 'Don't show again' checkbox (future enhancement)\n\n---\n\n## Files to Create\n\n- `src/components/planning/StartPlanningModal.tsx`\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx` - Wire up modal state\n\n---\n\n## Acceptance Criteria\n\n- [ ] Modal appears when 'Start Planning' button is clicked\n- [ ] Modal shows issue number in header\n- [ ] Modal explains the three steps that will happen\n- [ ] Cancel button closes modal without side effects\n- [ ] 'Start Planning' button triggers navigation to planning page\n- [ ] Modal is accessible (focus trap, keyboard navigation)\n- [ ] Works on mobile viewports\n\n---\n\n## Dependencies\n\n- Requires Task 1.1 (button that triggers the modal)\n\n---\n\n## Testing Notes\n\n- Verify modal accessibility with keyboard-only navigation\n- Test modal appearance on mobile (should be centered, not full-screen)\n- Verify proper cleanup when modal is dismissed","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:00:49.49038-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.2","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:00:49.493449-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.2","depends_on_id":"maestro-g88.1","type":"blocks","created_at":"2025-12-30T23:14:38.619005-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.20","title":"Phase 7.1: Error Handling and Edge Cases","description":"## Task Overview\n\nImplement comprehensive error handling throughout the planning mode feature, covering all edge cases identified in the GH issue.\n\n---\n\n## Background \u0026 Context\n\nFrom GH Issue #6 Error Handling section, there are three categories of errors to handle:\n\n### 1. Worktree Creation Errors\n| Error | Recovery |\n|-------|----------|\n| Branch already exists | Check for existing worktree, offer to resume or create new |\n| Disk full | Show error, user must free space |\n| Git conflict | Show git error message, suggest manual resolution |\n| Permission denied | Show error, check directory permissions |\n\n### 2. Dependency Installation Errors\n| Error | Recovery |\n|-------|----------|\n| `bun install` fails | Show error log, offer retry button |\n| Network timeout | Show error, offer retry |\n| Lock file conflict | Show error, suggest manual resolution |\n\n### 3. Session Errors\n| Error | Recovery |\n|-------|----------|\n| OpenCode not running | Show connection error, check OpenCode status |\n| Session dies mid-setup | Detect on reconnect, create new session |\n| Slash command fails | Show error in chat, user can retry or refine |\n\n---\n\n## Error UI Components\n\n### Error Banner\n\n```tsx\n// src/components/planning/PlanningError.tsx\n\ninterface PlanningErrorProps {\n  type: 'worktree' | 'deps' | 'session' | 'general';\n  error: Error;\n  onRetry?: () =\u003e void;\n  onDismiss?: () =\u003e void;\n}\n\nexport function PlanningError({ type, error, onRetry, onDismiss }: PlanningErrorProps) {\n  const { title, suggestion } = getErrorInfo(type, error);\n  \n  return (\n    \u003cAlert variant=\"destructive\"\u003e\n      \u003cAlertCircle className=\"h-4 w-4\" /\u003e\n      \u003cAlertTitle\u003e{title}\u003c/AlertTitle\u003e\n      \u003cAlertDescription\u003e\n        \u003cp\u003e{error.message}\u003c/p\u003e\n        {suggestion \u0026\u0026 \u003cp className=\"mt-2 text-sm\"\u003e{suggestion}\u003c/p\u003e}\n        \u003cdiv className=\"mt-4 flex gap-2\"\u003e\n          {onRetry \u0026\u0026 (\n            \u003cButton size=\"sm\" onClick={onRetry}\u003e\n              \u003cRefreshCw className=\"h-4 w-4 mr-2\" /\u003e\n              Retry\n            \u003c/Button\u003e\n          )}\n          \u003cButton size=\"sm\" variant=\"outline\" onClick={onDismiss}\u003e\n            Dismiss\n          \u003c/Button\u003e\n        \u003c/div\u003e\n      \u003c/AlertDescription\u003e\n    \u003c/Alert\u003e\n  );\n}\n\nfunction getErrorInfo(type: string, error: Error) {\n  const mapping = {\n    worktree: {\n      title: 'Failed to create worktree',\n      suggestion: error.message.includes('branch') \n        ? 'A branch with this name already exists. You may need to delete it or choose a different approach.'\n        : error.message.includes('permission')\n        ? 'Check that you have write permissions to the worktree directory.'\n        : null,\n    },\n    deps: {\n      title: 'Failed to install dependencies',\n      suggestion: 'Try running `bun install` manually in the worktree directory.',\n    },\n    session: {\n      title: 'Failed to connect to OpenCode',\n      suggestion: 'Make sure OpenCode is running: `opencode serve`',\n    },\n    general: {\n      title: 'Something went wrong',\n      suggestion: null,\n    },\n  };\n  \n  return mapping[type] || mapping.general;\n}\n```\n\n---\n\n## Specific Error Handlers\n\n### Branch Already Exists\n\n```typescript\nasync function handleBranchExists(projectPath: string, branchName: string): Promise\u003c'resume' | 'new' | 'cancel'\u003e {\n  // Check if there's an existing worktree for this branch\n  const existingWorktree = await worktreeService.findWorktreeForBranch(projectPath, branchName);\n  \n  if (existingWorktree) {\n    // Prompt user: \"A planning session for this issue already exists. Resume?\"\n    return 'resume';\n  }\n  \n  // Branch exists but no worktree - ask what to do\n  // Options: Create worktree from existing branch, or create new branch with suffix\n  return 'new';\n}\n```\n\n### OpenCode Not Running\n\n```typescript\nasync function checkOpenCodeHealth(): Promise\u003c{ ok: boolean; error?: string }\u003e {\n  try {\n    // Use health endpoint if available\n    const response = await fetch('/api/health/opencode');\n    const data = await response.json();\n    return { ok: data.connected };\n  } catch (error) {\n    return { ok: false, error: 'Cannot reach OpenCode server' };\n  }\n}\n\n// In setup flow\nconst health = await checkOpenCodeHealth();\nif (!health.ok) {\n  throw new PlanningError('session', 'OpenCode is not running', {\n    suggestion: 'Start OpenCode with: opencode serve',\n    recoverable: false,\n  });\n}\n```\n\n---\n\n## Global Error Boundary\n\n```tsx\n// In planning page layout\n\nexport default function PlanningLayout({ children }) {\n  return (\n    \u003cErrorBoundary\n      fallback={({ error, resetErrorBoundary }) =\u003e (\n        \u003cdiv className=\"flex flex-col items-center justify-center h-screen p-8\"\u003e\n          \u003cAlertCircle className=\"h-12 w-12 text-destructive mb-4\" /\u003e\n          \u003ch1 className=\"text-xl font-semibold mb-2\"\u003ePlanning Error\u003c/h1\u003e\n          \u003cp className=\"text-muted-foreground mb-4\"\u003e{error.message}\u003c/p\u003e\n          \u003cButton onClick={resetErrorBoundary}\u003eTry Again\u003c/Button\u003e\n        \u003c/div\u003e\n      )}\n    \u003e\n      {children}\n    \u003c/ErrorBoundary\u003e\n  );\n}\n```\n\n---\n\n## Retry Logic\n\nImplement exponential backoff for retryable operations:\n\n```typescript\nasync function withRetry\u003cT\u003e(\n  fn: () =\u003e Promise\u003cT\u003e,\n  options: { maxAttempts: number; backoff: number }\n): Promise\u003cT\u003e {\n  let lastError: Error;\n  \n  for (let attempt = 1; attempt \u003c= options.maxAttempts; attempt++) {\n    try {\n      return await fn();\n    } catch (error) {\n      lastError = error;\n      \n      if (attempt \u003c options.maxAttempts) {\n        await delay(options.backoff * attempt);\n      }\n    }\n  }\n  \n  throw lastError;\n}\n\n// Usage\nconst sessionId = await withRetry(\n  () =\u003e openCodeService.createPlanningSession(worktreePath),\n  { maxAttempts: 3, backoff: 1000 }\n);\n```\n\n---\n\n## User-Facing Error Messages\n\nTranslate technical errors to user-friendly messages:\n\n```typescript\nfunction getUserFriendlyMessage(error: Error): string {\n  const patterns = [\n    { match: /ENOENT/, message: 'File or directory not found' },\n    { match: /EACCES/, message: 'Permission denied' },\n    { match: /ENOSPC/, message: 'Disk is full' },\n    { match: /ETIMEDOUT/, message: 'Connection timed out' },\n    { match: /fatal: A branch named .* already exists/, message: 'Branch already exists' },\n    { match: /bun install.*failed/, message: 'Failed to install dependencies' },\n  ];\n  \n  for (const { match, message } of patterns) {\n    if (match.test(error.message)) {\n      return message;\n    }\n  }\n  \n  return error.message;\n}\n```\n\n---\n\n## Files to Create\n\n- `src/components/planning/PlanningError.tsx`\n- `src/lib/utils/error-handling.ts`\n\n## Files to Modify\n\n- `src/app/project/[id]/planning/[issueNumber]/page.tsx` - Add error boundary\n- `src/components/planning/SetupProgress.tsx` - Improve error UI\n- `src/lib/services/worktree.ts` - Add specific error types\n\n---\n\n## Acceptance Criteria\n\n- [ ] Worktree creation errors show helpful messages\n- [ ] Dependency install errors offer retry\n- [ ] Session errors suggest checking OpenCode\n- [ ] Branch conflict offers resume or create new\n- [ ] Disk full error is clear\n- [ ] Permission denied error suggests fix\n- [ ] Error boundary catches unexpected errors\n- [ ] All errors are user-friendly (no raw stack traces)\n\n---\n\n## Testing Notes\n\n- Test each error scenario manually\n- Test retry logic with flaky operations\n- Test error boundary with thrown errors\n- Verify error messages are helpful","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:12:59.393545-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.20","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:12:59.395881-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.20","depends_on_id":"maestro-g88.4","type":"blocks","created_at":"2025-12-30T23:15:09.997732-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.20","depends_on_id":"maestro-g88.7","type":"blocks","created_at":"2025-12-30T23:15:10.033826-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.21","title":"Phase 7.2: Mobile Responsiveness and Touch Optimization","description":"## Task Overview\n\nEnsure the planning mode feature works flawlessly on mobile devices, with proper touch targets, responsive layouts, and mobile-specific UX patterns.\n\n---\n\n## Background \u0026 Context\n\nFrom GH Issue #6:\n\n\u003e **Mobile Layout (\u003c 1024px)**\n\u003e On mobile (\u003c 1024px), use a tabbed interface similar to the existing issue page:\n\u003e - **Tab 1: \"Setup/Chat\"** - Shows setup progress and chat interface\n\u003e - **Tab 2: \"Plan\"** - Shows the plan UI (list view, since graph is hard on mobile)\n\u003e - Unread indicator dot on Plan tab when changes occur during chat\n\n---\n\n## Mobile Layout Implementation\n\n### Tabbed Interface\n\n```tsx\n// Planning page mobile view\n\nfunction PlanningPageMobile({ projectId, issueNumber, issueTitle }) {\n  const [activeTab, setActiveTab] = useState\u003c'chat' | 'plan'\u003e('chat');\n  const { beads, isConnected } = useBeadsWatch(projectId, issueNumber);\n  const [lastSeenBeadsCount, setLastSeenBeadsCount] = useState(0);\n  \n  const hasUnseenChanges = beads.length !== lastSeenBeadsCount \u0026\u0026 activeTab === 'chat';\n  \n  useEffect(() =\u003e {\n    if (activeTab === 'plan') {\n      setLastSeenBeadsCount(beads.length);\n    }\n  }, [activeTab, beads.length]);\n  \n  return (\n    \u003cdiv className=\"flex flex-col h-screen\"\u003e\n      {/* Header */}\n      \u003cPlanningHeader projectId={projectId} issueNumber={issueNumber} /\u003e\n      \n      {/* Tab Bar */}\n      \u003cdiv className=\"flex border-b\"\u003e\n        \u003cbutton\n          className={cn(\n            \"flex-1 py-3 text-sm font-medium\",\n            activeTab === 'chat' \u0026\u0026 \"border-b-2 border-primary\"\n          )}\n          onClick={() =\u003e setActiveTab('chat')}\n        \u003e\n          Setup/Chat\n        \u003c/button\u003e\n        \u003cbutton\n          className={cn(\n            \"flex-1 py-3 text-sm font-medium relative\",\n            activeTab === 'plan' \u0026\u0026 \"border-b-2 border-primary\"\n          )}\n          onClick={() =\u003e setActiveTab('plan')}\n        \u003e\n          Plan\n          {hasUnseenChanges \u0026\u0026 (\n            \u003cspan className=\"absolute top-2 right-[calc(50%-20px)] h-2 w-2 rounded-full bg-blue-500\" /\u003e\n          )}\n        \u003c/button\u003e\n      \u003c/div\u003e\n      \n      {/* Tab Content */}\n      \u003cdiv className=\"flex-1 overflow-hidden\"\u003e\n        {activeTab === 'chat' ? (\n          \u003cPlanningLeftPane {...props} /\u003e\n        ) : (\n          \u003cPlanningRightPane {...props} /\u003e\n        )}\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n---\n\n## Touch Target Sizing\n\nEnsure all interactive elements are at least 44x44px:\n\n```css\n/* In globals.css or component styles */\n\n@media (pointer: coarse) {\n  .bead-row {\n    min-height: 48px;\n    padding: 12px;\n  }\n  \n  .touch-target {\n    min-width: 44px;\n    min-height: 44px;\n  }\n}\n```\n\n```tsx\n// Ensure buttons have adequate tap targets\n\n\u003cButton className=\"h-11 min-w-[44px]\" ...\u003e\n  \u003cIcon className=\"h-5 w-5\" /\u003e\n\u003c/Button\u003e\n```\n\n---\n\n## Mobile-Specific Adjustments\n\n### 1. BeadsList on Mobile\n\n- Larger tap targets for expand/collapse\n- Swipe actions (future: swipe to view details)\n- Bottom sheet for detail panel instead of side panel\n\n```tsx\n// On mobile, detail panel becomes a bottom sheet\n{isMobile \u0026\u0026 selectedBead \u0026\u0026 (\n  \u003cSheet open={!!selectedBead} onOpenChange={() =\u003e setSelectedBead(null)}\u003e\n    \u003cSheetContent side=\"bottom\" className=\"h-[70vh]\"\u003e\n      \u003cBeadDetail bead={selectedBead} ... /\u003e\n    \u003c/SheetContent\u003e\n  \u003c/Sheet\u003e\n)}\n```\n\n### 2. Chat Input on Mobile\n\n- Full-width input\n- Send button always visible (not icon-only)\n- Auto-scroll on keyboard open\n\n```tsx\n\u003cdiv className=\"fixed bottom-0 left-0 right-0 p-2 bg-background border-t safe-area-inset-bottom\"\u003e\n  \u003cdiv className=\"flex gap-2\"\u003e\n    \u003cInput \n      className=\"flex-1\" \n      placeholder=\"Type a message...\" \n      autoComplete=\"off\"\n    /\u003e\n    \u003cButton\u003eSend\u003c/Button\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n### 3. Setup Progress on Mobile\n\n- Full-screen overlay during initial setup\n- Clear progress indicators\n- Accessible retry buttons\n\n---\n\n## Responsive Breakpoint\n\nUse consistent breakpoint:\n\n```tsx\n// Custom hook\nfunction useIsMobile() {\n  const [isMobile, setIsMobile] = useState(false);\n  \n  useEffect(() =\u003e {\n    const check = () =\u003e setIsMobile(window.innerWidth \u003c 1024);\n    check();\n    window.addEventListener('resize', check);\n    return () =\u003e window.removeEventListener('resize', check);\n  }, []);\n  \n  return isMobile;\n}\n\n// In component\nconst isMobile = useIsMobile();\n\nreturn isMobile ? \u003cMobileLayout /\u003e : \u003cDesktopLayout /\u003e;\n```\n\n---\n\n## Safe Area Insets\n\nHandle notch/home indicator on modern phones:\n\n```css\n.safe-area-inset-bottom {\n  padding-bottom: env(safe-area-inset-bottom, 0);\n}\n\n.safe-area-inset-top {\n  padding-top: env(safe-area-inset-top, 0);\n}\n```\n\n---\n\n## Viewport Height Fix\n\nHandle mobile browser chrome (URL bar):\n\n```tsx\n// In layout or page\nuseEffect(() =\u003e {\n  function setVh() {\n    const vh = window.innerHeight * 0.01;\n    document.documentElement.style.setProperty('--vh', `${vh}px`);\n  }\n  \n  setVh();\n  window.addEventListener('resize', setVh);\n  return () =\u003e window.removeEventListener('resize', setVh);\n}, []);\n```\n\n```css\n.h-screen-mobile {\n  height: calc(var(--vh, 1vh) * 100);\n}\n```\n\n---\n\n## Files to Modify\n\n- `src/app/project/[id]/planning/[issueNumber]/page.tsx` - Add mobile layout\n- `src/components/planning/BeadsList.tsx` - Mobile touch targets\n- `src/components/planning/BeadDetail.tsx` - Bottom sheet variant\n- `src/components/planning/PlanningChat.tsx` - Mobile input\n\n---\n\n## Acceptance Criteria\n\n- [ ] Tabbed interface at \u003c 1024px\n- [ ] Unread indicator on Plan tab\n- [ ] Touch targets minimum 44px\n- [ ] Bottom sheet for bead details on mobile\n- [ ] Chat input fixed at bottom with safe area\n- [ ] No layout shift on keyboard open\n- [ ] Works at 320px viewport width\n- [ ] Works on iOS Safari (notch handling)\n- [ ] Works on Android Chrome\n\n---\n\n## Testing Notes\n\n- Test on real devices (not just DevTools)\n- Test iPhone SE (small screen)\n- Test iPad in portrait (near breakpoint)\n- Test with keyboard open\n- Test with screen reader","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:13:39.321523-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.21","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:13:39.324027-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.21","depends_on_id":"maestro-g88.14","type":"blocks","created_at":"2025-12-30T23:15:10.067427-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.21","depends_on_id":"maestro-g88.16","type":"blocks","created_at":"2025-12-30T23:15:10.10162-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.22","title":"Phase 7.3: End-to-End Testing and Final Polish","description":"## Task Overview\n\nComprehensive end-to-end testing of the planning mode feature, covering all user flows, edge cases, and final polish items.\n\n---\n\n## Test Scenarios\n\n### Happy Path: Fresh Start\n\n1. Navigate to issue page with GitHub issue loaded\n2. Click 'Start Planning' button\n3. Confirm in modal\n4. Observe setup progress (worktree → deps → session → initial planning)\n5. See beads appear in list as AI creates them\n6. Select a bead, view details\n7. Chat about a bead ('Break this into smaller tasks')\n8. Observe bead updates in real-time\n9. Navigate away and back - session should resume\n\n### Resume Path: Existing Session\n\n1. Navigate directly to /project/{id}/planning/{issueNumber}\n2. Should detect existing worktree/session\n3. Skip setup steps\n4. Load existing beads\n5. Chat should work immediately\n\n### Recovery Path: Dead Session\n\n1. Stop OpenCode server while on planning page\n2. Try to send a message (should fail gracefully)\n3. Restart OpenCode\n4. Page should recover (create new session)\n5. Beads should still be intact\n\n### Error Path: Various Failures\n\n1. Test with branch that already exists\n2. Test with disk full (simulate)\n3. Test with no network (deps install fail)\n4. Test with OpenCode not running\n\n---\n\n## Manual Test Checklist\n\n### Entry Point\n- [ ] Button visible only when GitHub issue is loaded\n- [ ] Button disabled state is clear\n- [ ] Modal explains what will happen\n- [ ] Cancel closes modal without side effects\n\n### Setup Progress\n- [ ] All 4 steps show correctly\n- [ ] Duration shows for completed steps\n- [ ] Error state shows retry option\n- [ ] Progress is live (not static)\n\n### Plan UI (List View)\n- [ ] Tree renders with proper hierarchy\n- [ ] Expand/collapse works\n- [ ] Selection highlights correctly\n- [ ] Status icons are correct colors\n- [ ] Priority badges show for non-default\n\n### Detail Panel\n- [ ] Shows all bead information\n- [ ] Status dropdown updates bead\n- [ ] Priority dropdown updates bead\n- [ ] Markdown description renders\n- [ ] Dependencies shown correctly\n- [ ] 'Chat about this' sets context\n- [ ] Delete shows confirmation\n\n### Chat\n- [ ] Messages send and receive\n- [ ] SSE streaming works\n- [ ] Tool executions render\n- [ ] Context indicator shows\n- [ ] Slash command suggestions work\n\n### Mobile\n- [ ] Tabs switch correctly\n- [ ] Unread indicator appears\n- [ ] Touch targets are adequate\n- [ ] Bottom sheet for details\n- [ ] Keyboard doesn't break layout\n\n### Resume/Recovery\n- [ ] Page reload resumes session\n- [ ] Dead session detected\n- [ ] New session created on recovery\n- [ ] Beads preserved after recovery\n\n---\n\n## Performance Testing\n\n- [ ] Setup SSE doesn't leak resources\n- [ ] Beads file watcher doesn't leak\n- [ ] Chat SSE doesn't accumulate\n- [ ] Memory usage reasonable after extended use\n- [ ] No unnecessary re-renders\n\n---\n\n## Accessibility Testing\n\n- [ ] All buttons keyboard accessible\n- [ ] Focus management on modal open/close\n- [ ] Screen reader announces status changes\n- [ ] Color contrast meets WCAG AA\n- [ ] No focus traps\n\n---\n\n## Browser Testing\n\n- [ ] Chrome (latest)\n- [ ] Firefox (latest)\n- [ ] Safari (latest)\n- [ ] Mobile Safari (iOS)\n- [ ] Mobile Chrome (Android)\n\n---\n\n## Final Polish Items\n\n1. **Loading states**: All async operations show loading\n2. **Empty states**: Clear messaging when no data\n3. **Transitions**: Smooth animations where appropriate\n4. **Error messages**: All errors are user-friendly\n5. **Cleanup**: No console errors or warnings\n\n---\n\n## Documentation\n\n- [ ] Update SCOPE.md if architecture changed\n- [ ] Code comments on complex logic\n- [ ] Type exports for external use\n\n---\n\n## Acceptance Criteria\n\n- [ ] All happy path scenarios pass\n- [ ] All error scenarios handled gracefully\n- [ ] Works across all target browsers\n- [ ] Mobile experience is polished\n- [ ] No accessibility violations\n- [ ] No console errors in normal operation\n- [ ] Performance is acceptable\n\n---\n\n## Dependencies\n\n- Requires: All previous tasks completed\n\n---\n\n## Notes\n\nThis is the final task before the feature is considered complete. Take time to test thoroughly and fix any issues discovered.","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T23:14:11.316071-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.22","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:14:11.318352-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.22","depends_on_id":"maestro-g88.20","type":"blocks","created_at":"2025-12-30T23:15:10.135738-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.22","depends_on_id":"maestro-g88.21","type":"blocks","created_at":"2025-12-30T23:15:10.169818-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.22","depends_on_id":"maestro-g88.18","type":"blocks","created_at":"2025-12-30T23:15:10.204225-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.22","depends_on_id":"maestro-g88.17","type":"blocks","created_at":"2025-12-30T23:15:10.23837-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.23","title":"Phase 5.0: Create Planning Chat API Endpoint","description":"## Task Overview\n\nCreate the `/api/projects/{id}/planning/{issueNumber}/chat` endpoint that handles sending messages to the planning session with SSE streaming responses.\n\n---\n\n## Background \u0026 Context\n\nThe planning page needs a way to send chat messages and receive streaming responses. This is the API counterpart to the PlanningChat UI component (Task 5.1).\n\nUnlike the regular issue chat, planning chat:\n1. Uses full tool access (bash, write, edit)\n2. Operates in the worktree directory context\n3. May include bead context injection\n\n---\n\n## API Endpoint\n\n### POST `/api/projects/{id}/planning/{issueNumber}/chat`\n\n**Request Body:**\n```json\n{\n  \"message\": \"Break this task into smaller pieces\",\n  \"beadContext\": {\n    \"id\": \"maestro-g88.1\",\n    \"title\": \"Add Start Planning Button\"\n  }\n}\n```\n\n**Response:** SSE stream (same format as existing issue chat)\n\n---\n\n## Implementation\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/chat/route.ts\n\nimport { sessionStorage } from '@/lib/services/sessions';\nimport { openCodeService } from '@/lib/services/opencode';\nimport { configService } from '@/lib/services/config';\n\nexport async function POST(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const { message, beadContext } = await request.json();\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  // Validate project exists\n  const project = await configService.getProject(projectId);\n  if (!project) {\n    return Response.json({ error: 'Project not found' }, { status: 404 });\n  }\n  \n  // Get planning session (uses getPlanningSession from Task 2.2)\n  const session = await sessionStorage.getPlanningSession(projectId, issueNumber);\n  if (!session) {\n    return Response.json({ error: 'No planning session found' }, { status: 404 });\n  }\n  \n  // Build message with optional bead context\n  const fullMessage = beadContext \n    ? buildContextualMessage(message, beadContext)\n    : message;\n  \n  // Stream response using streamPlanningResponse from Task 2.3\n  // NOTE: Method name is streamPlanningResponse, NOT streamMessageWithFullAccess\n  const stream = await openCodeService.streamPlanningResponse(\n    session.worktreePath,\n    session.sessionId,\n    fullMessage\n  );\n  \n  return new Response(stream, {\n    headers: {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n    },\n  });\n}\n\nfunction buildContextualMessage(message: string, beadContext: { id: string; title: string }): string {\n  return `[Context: Working on bead \"${beadContext.title}\" (ID: ${beadContext.id})]\n\nUser request: ${message}`;\n}\n```\n\n---\n\n## Error Handling\n\n```typescript\n// Handle common errors\ntry {\n  const stream = await openCodeService.streamPlanningResponse(...);\n  return new Response(stream, { ... });\n} catch (error) {\n  if (error.message.includes('session not found')) {\n    return Response.json({ \n      error: 'Session expired', \n      code: 'SESSION_EXPIRED' \n    }, { status: 410 });\n  }\n  \n  if (error.message.includes('ECONNREFUSED')) {\n    return Response.json({ \n      error: 'OpenCode is not running', \n      code: 'OPENCODE_UNAVAILABLE' \n    }, { status: 503 });\n  }\n  \n  throw error;\n}\n```\n\n---\n\n## Files to Create\n\n- `src/app/api/projects/[id]/planning/[issueNumber]/chat/route.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] Endpoint accepts POST with message body\n- [ ] Returns SSE stream of response parts\n- [ ] Uses worktree path as context directory (from session.worktreePath)\n- [ ] Supports optional bead context injection\n- [ ] Uses `streamPlanningResponse` method from OpenCode service (Task 2.3)\n- [ ] Uses `getPlanningSession` method from session storage (Task 2.2)\n- [ ] Handles missing project gracefully (404)\n- [ ] Handles missing session gracefully (404)\n- [ ] Handles OpenCode errors gracefully (503)\n\n---\n\n## Dependencies\n\n- Requires: Extended Session Storage (2.2) - for `getPlanningSession`\n- Requires: Extended OpenCode Service (2.3) - for `streamPlanningResponse`\n\n---\n\n## Testing Notes\n\n- Test sending message without bead context\n- Test sending message with bead context\n- Test with expired/dead session\n- Verify SSE streaming works correctly\n- Test with OpenCode not running","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-31T07:46:27.895634-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.23","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-31T07:46:27.897869-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.23","depends_on_id":"maestro-g88.5","type":"blocks","created_at":"2025-12-31T07:46:32.088677-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.23","depends_on_id":"maestro-g88.6","type":"blocks","created_at":"2025-12-31T07:46:32.126364-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.3","title":"Phase 1.3: Create Planning Page Route and Basic Layout","description":"## Task Overview\n\nCreate the planning page route and implement the basic split-pane layout structure that will house the setup progress, chat, and plan visualization.\n\n---\n\n## Background \u0026 Context\n\nThe planning page is the main workspace for the planning workflow. It needs to support:\n1. Setup progress display (during initial setup)\n2. Chat interface (for refinement conversations)\n3. Plan visualization (list/graph of beads)\n4. Detail panel (for viewing/editing selected beads)\n\nThis task establishes the page structure and layout. Subsequent tasks will implement the individual components.\n\n---\n\n## Route Structure\n\n```\n/project/{id}/planning/{issueNumber}\n```\n\nFile path: `src/app/project/[id]/planning/[issueNumber]/page.tsx`\n\n---\n\n## Layout Design\n\n### Desktop Layout (\u003e= 1024px)\n\nSplit-pane layout with resizable divider:\n```\n┌─────────────────────────────┬─────────────────────────────┐\n│  LEFT PANE (40%)            │  RIGHT PANE (60%)           │\n│                             │                             │\n│  [Setup Progress Section]   │  [View Toggle: List | Graph]│\n│  ─────────────────────────  │  ─────────────────────────  │\n│  [Chat Section]             │  [Plan Visualization]       │\n│                             │  ─────────────────────────  │\n│                             │  [Detail Panel]             │\n│                             │                             │\n└─────────────────────────────┴─────────────────────────────┘\n```\n\n- Initial split: 40% left, 60% right\n- Resizable via drag handle (follow Issue page pattern)\n- Minimum widths to prevent unusable panes\n\n### Mobile Layout (\u003c 1024px)\n\nTabbed interface:\n```\n┌─────────────────────────────────────────────────────────┐\n│  [Setup/Chat Tab] [Plan Tab •]                          │\n├─────────────────────────────────────────────────────────┤\n│                                                         │\n│  [Active Tab Content]                                   │\n│                                                         │\n└─────────────────────────────────────────────────────────┘\n```\n\n- Tab 1: 'Setup/Chat' - shows setup progress and chat\n- Tab 2: 'Plan' - shows list view and detail panel\n- Unread indicator (•) on Plan tab when beads change while viewing Chat\n\n---\n\n## Component Structure\n\n```\npage.tsx\n├── PlanningHeader (breadcrumb, issue title, actions)\n├── \u003cDesktop: Split Pane\u003e\n│   ├── LeftPane\n│   │   ├── SetupProgress (placeholder)\n│   │   └── ChatSection (placeholder)\n│   └── RightPane\n│       ├── ViewToggle (placeholder)\n│       ├── PlanVisualization (placeholder)\n│       └── DetailPanel (placeholder)\n└── \u003cMobile: Tabs\u003e\n    ├── Tab 'Setup/Chat'\n    │   ├── SetupProgress (placeholder)\n    │   └── ChatSection (placeholder)\n    └── Tab 'Plan'\n        ├── PlanVisualization (placeholder)\n        └── DetailPanel (placeholder)\n```\n\nInitial implementation uses placeholder components that display 'Coming soon' or similar. Real components are implemented in later tasks.\n\n---\n\n## Header Design\n\nThe header should display:\n- Breadcrumb: Project Name \u003e Planning \u003e Issue #N\n- Issue title (truncated if long)\n- Actions: Back to Issue, Help/Info\n\n---\n\n## State Management\n\nThis task creates the basic structure. State management will be added in later tasks, but consider:\n- Selected bead ID\n- Current tab (mobile)\n- Setup status\n- Pane sizes\n\nCreate a custom hook `usePlanningSession` that will eventually manage this state.\n\n---\n\n## Files to Create\n\n- `src/app/project/[id]/planning/[issueNumber]/page.tsx`\n- `src/components/planning/PlanningHeader.tsx`\n- `src/components/planning/PlanningLeftPane.tsx`\n- `src/components/planning/PlanningRightPane.tsx`\n\n---\n\n## Patterns to Follow\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx` - Split pane with resize\n- Existing mobile tab patterns in the codebase\n- shadcn `Tabs` component for mobile view\n\n---\n\n## Acceptance Criteria\n\n- [ ] Route `/project/{id}/planning/{issueNumber}` renders correctly\n- [ ] Desktop layout shows split-pane with resizable divider\n- [ ] Mobile layout shows tabbed interface\n- [ ] Header displays breadcrumb and issue info\n- [ ] Placeholder components render in correct positions\n- [ ] Responsive breakpoint at lg: (1024px)\n- [ ] Navigation from confirmation modal lands on this page\n\n---\n\n## Testing Notes\n\n- Test resize behavior on desktop\n- Test tab switching on mobile\n- Verify layout at exact 1024px breakpoint\n- Test with very long issue titles (should truncate)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:01:16.698616-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.3","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:01:16.700892-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.3","depends_on_id":"maestro-g88.2","type":"blocks","created_at":"2025-12-30T23:14:38.653668-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.4","title":"Phase 2.1: Create WorktreeService - Core Infrastructure","description":"## Task Overview\n\nCreate the `WorktreeService` that manages git worktree lifecycle for planning sessions. This is foundational infrastructure that other components depend on.\n\n---\n\n## Background \u0026 Context\n\n### Why Git Worktrees?\n\nGit worktrees allow multiple working directories to share a single git repository. For planning mode, this provides:\n\n1. **Isolation**: Planning changes don't pollute the main working directory\n2. **Parallel safety**: User or other agents can continue working in main repo\n3. **Clean branches**: Each worktree has its own branch, perfect for feature work\n4. **Easy cleanup**: Delete worktree without affecting main repo\n\n### Directory Structure\n\n```\n~/.maestro/\n├── config.json              # Project configurations\n├── sessions.json            # Session mappings\n├── worktree-metadata/       # Worktree metadata (CENTRALIZED, not in worktrees)\n│   └── {project-slug}/\n│       └── issue-{number}.json\n└── worktrees/               # Actual worktree directories\n    └── {project-slug}/\n        └── issue-{number}/\n            ├── .git           # Worktree git link (auto-created by git)\n            ├── node_modules/  # After deps install\n            └── ...            # Project files\n```\n\n**Why separate metadata?** Storing metadata inside the worktree could cause git issues (untracked files). Centralized metadata is cleaner and easier to manage.\n\n### Project Slug Derivation\n\nTo create unique, filesystem-safe paths:\n1. Get git remote URL: `git remote get-url origin`\n2. Extract repo name: `github.com/user/my-repo` → `my-repo`\n3. Fallback: Use directory basename if no remote\n\n---\n\n## Implementation Details\n\n### Service Interface\n\n```typescript\n// src/lib/services/worktree.ts\n\nexport interface WorktreeInfo {\n  path: string;           // Full path to worktree\n  branch: string;         // Branch name (e.g., 'feature/issue-6-planning-mode')\n  issueNumber: number;\n  projectPath: string;    // Original project path\n  createdAt: string;      // ISO timestamp\n  depsInstalled: boolean; // Whether node_modules exists\n}\n\nexport class WorktreeService {\n  private baseDir = path.join(os.homedir(), '.maestro', 'worktrees');\n  private metadataDir = path.join(os.homedir(), '.maestro', 'worktree-metadata');\n  \n  // Core operations\n  async createWorktree(projectPath: string, issueNumber: number, issueTitle: string): Promise\u003cWorktreeInfo\u003e;\n  async getWorktree(projectPath: string, issueNumber: number): Promise\u003cWorktreeInfo | null\u003e;\n  async deleteWorktree(projectPath: string, issueNumber: number): Promise\u003cvoid\u003e;\n  \n  // Status checks\n  async worktreeExists(projectPath: string, issueNumber: number): Promise\u003cboolean\u003e;\n  async areDepsInstalled(projectPath: string, issueNumber: number): Promise\u003cboolean\u003e;\n  \n  // Markers\n  async markDepsInstalled(projectPath: string, issueNumber: number): Promise\u003cvoid\u003e;\n  \n  // Utilities\n  async getProjectSlug(projectPath: string): Promise\u003cstring\u003e;\n  async getWorktreePath(projectPath: string, issueNumber: number): Promise\u003cstring\u003e;\n  getBranchName(issueNumber: number, issueTitle: string): string;\n  \n  // Git helpers (REQUIRED - used in createWorktree)\n  async getDefaultBranch(projectPath: string): Promise\u003cstring\u003e;\n  async branchExists(projectPath: string, branchName: string): Promise\u003cboolean\u003e;\n  async findWorktreeForBranch(projectPath: string, branchName: string): Promise\u003cWorktreeInfo | null\u003e;\n  \n  // Internal\n  private async getMetadataPath(projectPath: string, issueNumber: number): Promise\u003cstring\u003e;\n  private async storeWorktreeMetadata(info: WorktreeInfo): Promise\u003cvoid\u003e;\n  private async loadWorktreeMetadata(projectPath: string, issueNumber: number): Promise\u003cWorktreeInfo | null\u003e;\n}\n```\n\n### Git Helper Implementations\n\n```typescript\n/**\n * Get the default branch for a repository (usually 'main' or 'master')\n */\nasync getDefaultBranch(projectPath: string): Promise\u003cstring\u003e {\n  try {\n    // Try to get from remote HEAD\n    const { stdout } = await execAsync(\n      'git symbolic-ref refs/remotes/origin/HEAD --short',\n      { cwd: projectPath }\n    );\n    // Returns something like 'origin/main', extract just 'main'\n    return stdout.trim().replace('origin/', '');\n  } catch {\n    // Fallback: check if 'main' or 'master' exists\n    try {\n      await execAsync('git rev-parse --verify main', { cwd: projectPath });\n      return 'main';\n    } catch {\n      return 'master';\n    }\n  }\n}\n\n/**\n * Check if a branch exists in the repository\n */\nasync branchExists(projectPath: string, branchName: string): Promise\u003cboolean\u003e {\n  try {\n    await execAsync(`git rev-parse --verify ${branchName}`, { cwd: projectPath });\n    return true;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Find an existing worktree for a given branch\n */\nasync findWorktreeForBranch(projectPath: string, branchName: string): Promise\u003cWorktreeInfo | null\u003e {\n  try {\n    const { stdout } = await execAsync('git worktree list --porcelain', { cwd: projectPath });\n    const lines = stdout.split('\\n');\n    \n    for (let i = 0; i \u003c lines.length; i++) {\n      if (lines[i].startsWith('worktree ')) {\n        const worktreePath = lines[i].replace('worktree ', '');\n        // Check next few lines for branch info\n        const branchLine = lines.slice(i, i + 5).find(l =\u003e l.startsWith('branch '));\n        if (branchLine \u0026\u0026 branchLine.includes(branchName)) {\n          // Found it - load metadata\n          const slug = await this.getProjectSlug(projectPath);\n          const issueMatch = worktreePath.match(/issue-(\\d+)/);\n          if (issueMatch) {\n            return this.loadWorktreeMetadata(projectPath, parseInt(issueMatch[1]));\n          }\n        }\n      }\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n```\n\n### Branch Naming\n\n```typescript\ngetBranchName(issueNumber: number, issueTitle: string): string {\n  // Slugify title: 'Planning Mode Feature' → 'planning-mode-feature'\n  const slug = issueTitle\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-|-$/g, '')\n    .substring(0, 50); // Limit length\n  \n  return `feature/issue-${issueNumber}-${slug}`;\n}\n```\n\n### Worktree Creation Flow\n\n```typescript\nasync createWorktree(projectPath: string, issueNumber: number, issueTitle: string): Promise\u003cWorktreeInfo\u003e {\n  const slug = await this.getProjectSlug(projectPath);\n  const worktreePath = path.join(this.baseDir, slug, `issue-${issueNumber}`);\n  const branchName = this.getBranchName(issueNumber, issueTitle);\n  \n  // 1. Ensure parent directories exist\n  await fs.mkdir(path.dirname(worktreePath), { recursive: true });\n  await fs.mkdir(path.join(this.metadataDir, slug), { recursive: true });\n  \n  // 2. Get default branch name\n  const defaultBranch = await this.getDefaultBranch(projectPath);\n  \n  // 3. Check if branch already exists\n  const branchAlreadyExists = await this.branchExists(projectPath, branchName);\n  \n  if (branchAlreadyExists) {\n    // Check if worktree already exists for this branch\n    const existingWorktree = await this.findWorktreeForBranch(projectPath, branchName);\n    if (existingWorktree) {\n      // Resume existing worktree\n      return existingWorktree;\n    }\n    // Create worktree from existing branch\n    await execAsync(`git worktree add \"${worktreePath}\" ${branchName}`, { cwd: projectPath });\n  } else {\n    // Create new branch and worktree\n    await execAsync(`git worktree add -b ${branchName} \"${worktreePath}\" ${defaultBranch}`, { cwd: projectPath });\n  }\n  \n  // 4. Store metadata (in centralized location, not in worktree)\n  const info: WorktreeInfo = {\n    path: worktreePath,\n    branch: branchName,\n    issueNumber,\n    projectPath,\n    createdAt: new Date().toISOString(),\n    depsInstalled: false,\n  };\n  \n  await this.storeWorktreeMetadata(info);\n  \n  return info;\n}\n```\n\n### Metadata Storage\n\nStore worktree metadata in `~/.maestro/worktree-metadata/{slug}/issue-{number}.json`:\n\n```json\n{\n  \"path\": \"/Users/erik/.maestro/worktrees/maestro/issue-6\",\n  \"branch\": \"feature/issue-6-planning-mode\",\n  \"issueNumber\": 6,\n  \"projectPath\": \"/Users/erik/dev/maestro\",\n  \"createdAt\": \"2024-01-15T10:30:00.000Z\",\n  \"depsInstalled\": true\n}\n```\n\n---\n\n## Error Handling\n\n### Conflict Scenarios\n\n| Scenario | Detection | Resolution |\n|----------|-----------|------------|\n| Branch exists, worktree exists | Check `git worktree list` | Return existing worktree |\n| Branch exists, no worktree | Check branch list | Create worktree from branch |\n| Branch merged/deleted | Try checkout, catch error | Offer to create fresh branch |\n| Worktree path occupied | Check `fs.exists` | Error with clear message |\n| No git repo | Check `.git` exists | Error: 'Not a git repository' |\n\n### Error Types\n\n```typescript\nexport class WorktreeError extends Error {\n  constructor(\n    message: string,\n    public code: 'NOT_GIT_REPO' | 'BRANCH_CONFLICT' | 'PATH_OCCUPIED' | 'GIT_ERROR',\n    public details?: string\n  ) {\n    super(message);\n    this.name = 'WorktreeError';\n  }\n}\n```\n\n---\n\n## Files to Create\n\n- `src/lib/services/worktree.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] `createWorktree` creates worktree with correct branch naming\n- [ ] `getWorktree` returns info for existing worktree or null\n- [ ] `worktreeExists` correctly detects existing worktrees\n- [ ] `deleteWorktree` cleans up worktree, branch, and metadata\n- [ ] Branch naming follows `feature/issue-{n}-{slug}` pattern\n- [ ] Project slug derived from git remote or directory name\n- [ ] Handles branch-already-exists case gracefully\n- [ ] Metadata stored in centralized location (not in worktree)\n- [ ] `getDefaultBranch` correctly detects main/master\n- [ ] `branchExists` correctly checks branch existence\n- [ ] `findWorktreeForBranch` finds existing worktrees\n- [ ] Proper error handling with clear error codes\n\n---\n\n## Testing Notes\n\n- Test with fresh project (no existing worktrees)\n- Test resuming existing worktree\n- Test branch name slugification edge cases\n- Test with projects that have no git remote\n- Test cleanup (worktree deletion + metadata cleanup)\n- Test with repos using 'main' vs 'master' as default branch","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T23:02:05.342059-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.4","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:02:05.344659-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.5","title":"Phase 2.2: Extend Session Storage for Planning Sessions","description":"## Task Overview\n\nExtend the existing session storage service to support planning sessions, which have additional metadata compared to regular discussion sessions.\n\n---\n\n## Background \u0026 Context\n\nThe current session storage (`src/lib/services/sessions.ts`) uses an **array-based storage** pattern (not key-value) stored in `~/.maestro/sessions.json`:\n\n```typescript\ninterface SessionStore {\n  version: 1;\n  mappings: SessionMapping[];  // Array, not a key-value map\n}\n```\n\nFor planning sessions, we need to extend SessionMapping with additional fields.\n\n---\n\n## Current Implementation\n\n```typescript\ninterface SessionMapping {\n  projectId: string;       // Project UUID (from Maestro config)\n  projectPath: string;     // Project absolute path (for verification)\n  issueNumber: number;     // GitHub issue number  \n  sessionId: string;       // OpenCode session ID\n  createdAt: string;       // ISO timestamp\n  lastAccessedAt: string;  // ISO timestamp\n}\n```\n\n---\n\n## Extended Interface\n\n```typescript\nexport type SessionType = 'discussion' | 'planning';\n\nexport interface SessionMapping {\n  projectId: string;\n  projectPath: string;\n  issueNumber: number;\n  sessionId: string;\n  sessionType: SessionType;           // NEW - defaults to 'discussion' for backwards compat\n  worktreePath?: string;              // NEW - only for planning sessions\n  createdAt: string;\n  lastAccessedAt: string;\n}\n\n// Helper type for planning sessions\nexport interface PlanningSessionMapping extends SessionMapping {\n  sessionType: 'planning';\n  worktreePath: string;  // Required for planning\n}\n```\n\n---\n\n## API Extensions\n\n### IMPORTANT: Maintain Backward Compatibility\n\nThe existing `saveSession` method signature MUST remain unchanged for backward compatibility:\n\n```typescript\n// EXISTING - DO NOT CHANGE\nasync saveSession(\n  projectId: string,\n  projectPath: string,\n  issueNumber: number,\n  sessionId: string\n): Promise\u003cSessionMapping\u003e\n```\n\nAdd a NEW method for planning sessions:\n\n```typescript\n// NEW METHOD for planning sessions\nasync savePlanningSession(\n  projectId: string,\n  projectPath: string,\n  issueNumber: number,\n  sessionId: string,\n  worktreePath: string\n): Promise\u003cPlanningSessionMapping\u003e {\n  const store = await this.readStore();\n  const now = new Date().toISOString();\n  \n  // Find existing planning session for this issue\n  const existingIndex = store.mappings.findIndex(\n    (m) =\u003e m.projectId === projectId \u0026\u0026 \n           m.issueNumber === issueNumber \u0026\u0026\n           m.sessionType === 'planning'\n  );\n  \n  const mapping: PlanningSessionMapping = {\n    projectId,\n    projectPath,\n    issueNumber,\n    sessionId,\n    sessionType: 'planning',\n    worktreePath,\n    createdAt: existingIndex \u003e= 0 ? store.mappings[existingIndex].createdAt : now,\n    lastAccessedAt: now,\n  };\n  \n  if (existingIndex \u003e= 0) {\n    store.mappings[existingIndex] = mapping;\n  } else {\n    store.mappings.push(mapping);\n  }\n  \n  await this.writeStore(store);\n  return mapping;\n}\n```\n\n### Updated Query Methods\n\n```typescript\nclass SessionStorageService {\n  // Existing method - add sessionType filter for backwards compatibility\n  async getSession(projectId: string, issueNumber: number): Promise\u003cSessionMapping | null\u003e {\n    const store = await this.readStore();\n    return store.mappings.find(\n      (m) =\u003e m.projectId === projectId \u0026\u0026 \n             m.issueNumber === issueNumber \u0026\u0026\n             (m.sessionType === 'discussion' || !m.sessionType)  // Default to discussion\n    ) ?? null;\n  }\n  \n  // NEW: Get planning session specifically\n  async getPlanningSession(projectId: string, issueNumber: number): Promise\u003cPlanningSessionMapping | null\u003e {\n    const store = await this.readStore();\n    const session = store.mappings.find(\n      (m) =\u003e m.projectId === projectId \u0026\u0026 \n             m.issueNumber === issueNumber \u0026\u0026\n             m.sessionType === 'planning'\n    );\n    return session as PlanningSessionMapping | null;\n  }\n  \n  // NEW: List all planning sessions for a project\n  async listPlanningSessions(projectId: string): Promise\u003cPlanningSessionMapping[]\u003e {\n    const store = await this.readStore();\n    return store.mappings.filter(\n      (m) =\u003e m.projectId === projectId \u0026\u0026 m.sessionType === 'planning'\n    ) as PlanningSessionMapping[];\n  }\n}\n```\n\n---\n\n## Backwards Compatibility\n\nSessions without `sessionType` are treated as 'discussion' sessions:\n\n```typescript\n// In getSession and other methods:\n(m.sessionType === 'discussion' || !m.sessionType)\n```\n\nThis allows the same issue to have both a discussion session AND a planning session simultaneously.\n\n---\n\n## Files to Modify\n\n- `src/lib/services/sessions.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] `SessionMapping` interface extended with `sessionType` and `worktreePath`\n- [ ] NEW `savePlanningSession` method for planning-specific saves\n- [ ] EXISTING `saveSession` signature unchanged (backward compatible)\n- [ ] `getPlanningSession` method returns typed planning sessions\n- [ ] Sessions are filtered by type (allowing same issue to have both types)\n- [ ] Existing sessions without `sessionType` work as 'discussion' (backwards compatible)\n- [ ] `listPlanningSessions` returns all planning sessions for a project\n- [ ] TypeScript types properly distinguish planning vs discussion sessions\n\n---\n\n## Testing Notes\n\n- Test existing session without `sessionType` field (should be treated as discussion)\n- Test creating both discussion and planning sessions for same issue\n- Test `listPlanningSessions` with multiple planning sessions\n- Verify existing code using `saveSession` continues to work unchanged","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:02:30.374173-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.5","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:02:30.376357-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.6","title":"Phase 2.3: Extend OpenCode Service for Full-Access Sessions","description":"## Task Overview\n\nAdd methods to the OpenCode service that enable 'full access' sessions - sessions where the AI agent has all tools enabled (bash, write, edit), as required for planning mode.\n\n---\n\n## Background \u0026 Context\n\n### Current Session Types\n\nRegular discussion sessions use limited tool access:\n- Read-only file access\n- No bash execution\n- No file modification\n\n### Planning Session Requirements\n\nPlanning agents need full tool access:\n- **bash**: Execute `bd` CLI commands to manage beads\n- **write**: Create new bead files (via CLI output)\n- **edit**: Modify existing beads\n- **read**: Analyze codebase for task breakdown\n\nThe key insight from GH Issue #6: slash commands like `/turn_gh_issue_into_beads` are sent as regular message text, not as a separate API. The agent handles them.\n\n---\n\n## Implementation Details\n\n### New Method: `sendPlanningMessageAsync`\n\n```typescript\n// In src/lib/services/opencode.ts\n\n/**\n * Send a message with full tool access (bash, write, edit, read).\n * Used for planning sessions where the agent needs to create/modify beads.\n * \n * @param worktreePath - The working directory (worktree path for planning)\n * @param sessionId - The OpenCode session ID\n * @param message - The message text (can include slash commands like /turn_gh_issue_into_beads)\n * @returns Promise that resolves when message is sent (not when response is complete)\n */\nasync sendPlanningMessageAsync(\n  worktreePath: string,\n  sessionId: string,\n  message: string\n): Promise\u003cvoid\u003e {\n  await this.client.session.promptAsync({\n    path: { id: sessionId },\n    query: { directory: worktreePath },\n    body: {\n      model: DEFAULT_MODEL,\n      tools: {\n        bash: true,\n        write: true,\n        edit: true,\n      },\n      parts: [{ type: 'text', text: message }],\n    },\n  });\n}\n```\n\n### New Method: `createPlanningSession`\n\n```typescript\n/**\n * Create a new session configured for planning mode.\n * The session is created in the context of a worktree directory.\n * \n * @param worktreePath - Path to the git worktree\n * @param title - Optional session title\n * @returns The created session ID\n */\nasync createPlanningSession(worktreePath: string, title?: string): Promise\u003c{ id: string }\u003e {\n  const result = await this.client.session.create({\n    query: { directory: worktreePath },\n    body: {\n      title: title || 'Planning Session',\n    },\n  });\n\n  if (!result.data?.id) {\n    throw new Error(\"Failed to create planning session: no session ID returned\");\n  }\n\n  return { id: result.data.id };\n}\n```\n\n### New Method: `streamPlanningResponse` (Used by Chat API)\n\nFor SSE streaming of planning responses:\n\n```typescript\n/**\n * Send a message to a planning session and stream the response.\n * Returns a ReadableStream suitable for SSE responses.\n * \n * IMPORTANT: This is the method used by the /chat API endpoint.\n * \n * @param worktreePath - The working directory (worktree path)\n * @param sessionId - The OpenCode session ID\n * @param message - The message text\n */\nasync streamPlanningResponse(\n  worktreePath: string,\n  sessionId: string,\n  message: string\n): Promise\u003cReadableStream\u003e {\n  const response = await this.client.session.prompt({\n    path: { id: sessionId },\n    query: { directory: worktreePath },\n    body: {\n      model: DEFAULT_MODEL,\n      tools: {\n        bash: true,\n        write: true,\n        edit: true,\n      },\n      parts: [{ type: 'text', text: message }],\n    },\n  });\n  \n  // Return the response stream for SSE\n  // Note: Exact implementation depends on SDK response handling\n  // May need to convert response to SSE format\n  return this.convertToSSEStream(response);\n}\n\nprivate convertToSSEStream(response: any): ReadableStream {\n  // Convert SDK response to SSE format\n  // Implementation depends on @opencode-ai/sdk response structure\n  const encoder = new TextEncoder();\n  \n  return new ReadableStream({\n    async start(controller) {\n      // Handle response parts and emit as SSE events\n      if (response.data?.parts) {\n        for (const part of response.data.parts) {\n          const event = `data: ${JSON.stringify(part)}\\n\\n`;\n          controller.enqueue(encoder.encode(event));\n        }\n      }\n      controller.close();\n    }\n  });\n}\n```\n\n---\n\n## Tool Configuration Reference\n\nFrom OpenCode SDK, the tools object structure:\n\n```typescript\ninterface ToolsConfig {\n  bash?: boolean;    // Shell command execution\n  write?: boolean;   // Create new files\n  edit?: boolean;    // Modify existing files\n  read?: boolean;    // Read file contents (usually enabled by default)\n  glob?: boolean;    // File pattern matching\n  grep?: boolean;    // Content search\n  // ... other tools\n}\n```\n\nFor planning, we enable bash + write + edit. Read/glob/grep are typically enabled by default.\n\n---\n\n## Files to Modify\n\n- `src/lib/services/opencode.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] `sendPlanningMessageAsync` sends messages with all tools enabled\n- [ ] `createPlanningSession` creates session with worktree as directory context\n- [ ] `streamPlanningResponse` returns ReadableStream for SSE\n- [ ] Sessions use worktree path as directory context\n- [ ] Tool configuration includes bash, write, edit\n- [ ] Methods integrate with existing error handling patterns\n- [ ] TypeScript types are correct\n\n---\n\n## Testing Notes\n\n- Test sending a message with `/turn_gh_issue_into_beads` command\n- Verify agent can execute `bd` commands\n- Test session creation with worktree path\n- Verify tool access is properly enabled\n- Test streaming response format","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:03:03.49832-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.6","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:03:03.50077-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.7","title":"Phase 2.4: Build Setup Pipeline with SSE Progress Streaming","description":"## Task Overview\n\nImplement the setup pipeline that runs when entering planning mode. This pipeline creates the worktree, installs dependencies, creates the session, and sends the initial planning prompt. Progress is streamed to the frontend via Server-Sent Events (SSE).\n\n---\n\n## Background \u0026 Context\n\nWhen a user confirms 'Start Planning', several sequential operations must occur:\n\n1. **Create worktree** - Git operations to set up isolated environment\n2. **Install dependencies** - Run `bun install` in the worktree\n3. **Create session** - Create OpenCode session pointed at worktree\n4. **Send initial prompt** - `/turn_gh_issue_into_beads {issueNumber}`\n\nEach step can take several seconds. Users need real-time visibility into progress.\n\n---\n\n## Pipeline Steps\n\n### Step 1: Create Worktree\n\n```typescript\ninterface PipelineStep {\n  id: string;\n  name: string;\n  status: 'pending' | 'in_progress' | 'completed' | 'error';\n  message?: string;\n  startedAt?: string;\n  completedAt?: string;\n  error?: string;\n}\n\n// Step: create_worktree\n{\n  id: 'create_worktree',\n  name: 'Creating git worktree',\n  status: 'in_progress',\n  message: 'Setting up isolated development environment...'\n}\n```\n\n### Step 2: Install Dependencies\n\n```typescript\n// Step: install_deps\n{\n  id: 'install_deps',\n  name: 'Installing dependencies',\n  status: 'in_progress',\n  message: 'Running bun install...'\n}\n```\n\n### Step 3: Create Session\n\n```typescript\n// Step: create_session\n{\n  id: 'create_session',\n  name: 'Starting AI session',\n  status: 'in_progress',\n  message: 'Connecting to OpenCode...'\n}\n```\n\n### Step 4: Initial Planning\n\n```typescript\n// Step: initial_planning\n{\n  id: 'initial_planning',\n  name: 'Analyzing issue',\n  status: 'in_progress',\n  message: 'Breaking down issue into tasks...'\n}\n```\n\n---\n\n## API Endpoint\n\n### POST `/api/projects/{id}/planning/{issueNumber}/start`\n\n**Request Body:**\n```json\n{\n  \"issueTitle\": \"Planning Mode Feature\"\n}\n```\n\n**Response:** SSE stream with events:\n\n```\nevent: step\ndata: {\"id\":\"create_worktree\",\"status\":\"in_progress\",\"name\":\"Creating git worktree\"}\n\nevent: step\ndata: {\"id\":\"create_worktree\",\"status\":\"completed\",\"duration\":1234}\n\nevent: step\ndata: {\"id\":\"install_deps\",\"status\":\"in_progress\",\"name\":\"Installing dependencies\"}\n\nevent: step\ndata: {\"id\":\"install_deps\",\"status\":\"completed\",\"duration\":5678}\n\nevent: step\ndata: {\"id\":\"create_session\",\"status\":\"in_progress\",\"name\":\"Starting AI session\"}\n\nevent: step\ndata: {\"id\":\"create_session\",\"status\":\"completed\",\"sessionId\":\"abc123\"}\n\nevent: step\ndata: {\"id\":\"initial_planning\",\"status\":\"in_progress\",\"name\":\"Analyzing issue\"}\n\nevent: complete\ndata: {\"sessionId\":\"abc123\",\"worktreePath\":\"/Users/.../issue-6\"}\n```\n\n**Error Event:**\n```\nevent: error\ndata: {\"step\":\"install_deps\",\"error\":\"bun install failed\",\"details\":\"...\"}\n```\n\n---\n\n## Implementation\n\n### Route Handler\n\n```typescript\n// src/app/api/projects/[id]/planning/[issueNumber]/start/route.ts\n\nexport async function POST(\n  request: Request,\n  { params }: { params: { id: string; issueNumber: string } }\n) {\n  const { issueTitle } = await request.json();\n  const projectId = params.id;\n  const issueNumber = parseInt(params.issueNumber);\n  \n  // Get project path from config\n  const project = await configService.getProject(projectId);\n  if (!project) {\n    return new Response('Project not found', { status: 404 });\n  }\n  \n  // Create SSE stream\n  const stream = new ReadableStream({\n    async start(controller) {\n      const encoder = new TextEncoder();\n      \n      function sendEvent(event: string, data: object) {\n        controller.enqueue(encoder.encode(`event: ${event}\\ndata: ${JSON.stringify(data)}\\n\\n`));\n      }\n      \n      try {\n        // Step 1: Create worktree\n        sendEvent('step', { id: 'create_worktree', status: 'in_progress', name: 'Creating git worktree' });\n        const worktreeInfo = await worktreeService.createWorktree(project.path, issueNumber, issueTitle);\n        sendEvent('step', { id: 'create_worktree', status: 'completed' });\n        \n        // Step 2: Install dependencies\n        sendEvent('step', { id: 'install_deps', status: 'in_progress', name: 'Installing dependencies' });\n        await execAsync('bun install', { cwd: worktreeInfo.path });\n        await worktreeService.markDepsInstalled(project.path, issueNumber);\n        sendEvent('step', { id: 'install_deps', status: 'completed' });\n        \n        // Step 3: Create session\n        sendEvent('step', { id: 'create_session', status: 'in_progress', name: 'Starting AI session' });\n        const sessionId = await openCodeService.createPlanningSession(worktreeInfo.path);\n        await sessionStorage.setSession({\n          projectId,\n          projectPath: project.path,\n          issueNumber,\n          sessionId,\n          sessionType: 'planning',\n          worktreePath: worktreeInfo.path,\n          createdAt: new Date().toISOString(),\n          lastAccessedAt: new Date().toISOString(),\n        });\n        sendEvent('step', { id: 'create_session', status: 'completed', sessionId });\n        \n        // Step 4: Send initial planning prompt\n        sendEvent('step', { id: 'initial_planning', status: 'in_progress', name: 'Analyzing issue' });\n        await openCodeService.sendMessageWithFullAccessAsync(\n          worktreeInfo.path,\n          sessionId,\n          `/turn_gh_issue_into_beads ${issueNumber}`\n        );\n        sendEvent('step', { id: 'initial_planning', status: 'completed' });\n        \n        // Complete\n        sendEvent('complete', { sessionId, worktreePath: worktreeInfo.path });\n        \n      } catch (error) {\n        sendEvent('error', { \n          error: error.message,\n          details: error.stack \n        });\n      } finally {\n        controller.close();\n      }\n    }\n  });\n  \n  return new Response(stream, {\n    headers: {\n      'Content-Type': 'text/event-stream',\n      'Cache-Control': 'no-cache',\n      'Connection': 'keep-alive',\n    },\n  });\n}\n```\n\n---\n\n## Resume Logic\n\nThe endpoint should detect existing state:\n\n```typescript\n// At the start of the handler\nconst existingWorktree = await worktreeService.getWorktree(project.path, issueNumber);\n\nif (existingWorktree) {\n  // Skip worktree creation, check deps, etc.\n  sendEvent('step', { id: 'create_worktree', status: 'completed', skipped: true });\n  \n  if (existingWorktree.depsInstalled) {\n    sendEvent('step', { id: 'install_deps', status: 'completed', skipped: true });\n  }\n  \n  // Check for existing session\n  const existingSession = await sessionStorage.getPlanningSession(projectId, issueNumber);\n  if (existingSession \u0026\u0026 await openCodeService.isSessionAlive(existingSession.sessionId)) {\n    sendEvent('step', { id: 'create_session', status: 'completed', skipped: true, sessionId: existingSession.sessionId });\n    // Skip initial planning too\n    sendEvent('step', { id: 'initial_planning', status: 'completed', skipped: true });\n    sendEvent('complete', { sessionId: existingSession.sessionId, worktreePath: existingWorktree.path });\n    return;\n  }\n}\n```\n\n---\n\n## Files to Create\n\n- `src/app/api/projects/[id]/planning/[issueNumber]/start/route.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] SSE stream sends step-by-step progress updates\n- [ ] Each step shows status transitions: pending → in_progress → completed/error\n- [ ] Worktree created with correct branch naming\n- [ ] Dependencies installed in worktree\n- [ ] OpenCode session created and stored\n- [ ] Initial `/turn_gh_issue_into_beads` command sent\n- [ ] Resume logic skips completed steps\n- [ ] Errors are caught and sent as error events\n- [ ] Stream properly closed on completion or error\n\n---\n\n## Dependencies\n\n- Requires: WorktreeService (2.1)\n- Requires: Extended Session Storage (2.2)\n- Requires: Extended OpenCode Service (2.3)\n\n---\n\n## Testing Notes\n\n- Test full flow with new issue\n- Test resume flow with existing worktree\n- Test error handling (e.g., simulate bun install failure)\n- Test SSE parsing in frontend\n- Monitor for resource leaks (unclosed streams)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:03:50.314294-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.7","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:03:50.316713-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.7","depends_on_id":"maestro-g88.4","type":"blocks","created_at":"2025-12-30T23:14:42.188805-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.7","depends_on_id":"maestro-g88.5","type":"blocks","created_at":"2025-12-30T23:14:42.224754-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.7","depends_on_id":"maestro-g88.6","type":"blocks","created_at":"2025-12-30T23:14:42.260006-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.8","title":"Phase 2.5: Build SetupProgress UI Component","description":"## Task Overview\n\nCreate the `SetupProgress` component that displays real-time progress of the planning setup pipeline, consuming SSE events and rendering visual feedback.\n\n---\n\n## Background \u0026 Context\n\nWhen users start planning, they see a multi-step setup process:\n1. Creating git worktree\n2. Installing dependencies\n3. Starting AI session\n4. Analyzing issue\n\nEach step needs visual feedback: spinner during progress, checkmark on success, X on failure.\n\n---\n\n## Visual Design\n\n```\n┌────────────────────────────────────────────────┐\n│  Setting up planning environment...            │\n│                                                │\n│  ✓  Creating git worktree          (1.2s)     │\n│  ✓  Installing dependencies         (5.3s)     │\n│  ◐  Starting AI session...                     │\n│  ○  Analyzing issue                            │\n│                                                │\n│  ─────────────────────────────────────────     │\n│  Branch: feature/issue-6-planning-mode         │\n│  Worktree: ~/.maestro/worktrees/maestro/...    │\n└────────────────────────────────────────────────┘\n\nOn error:\n┌────────────────────────────────────────────────┐\n│  Setup encountered an error                    │\n│                                                │\n│  ✓  Creating git worktree          (1.2s)     │\n│  ✗  Installing dependencies                    │\n│     Error: bun install failed                  │\n│     Exit code 1                                │\n│                                                │\n│  [Retry]  [View Details]                       │\n└────────────────────────────────────────────────┘\n```\n\n---\n\n## Component API\n\n```typescript\n// src/components/planning/SetupProgress.tsx\n\ninterface SetupStep {\n  id: string;\n  name: string;\n  status: 'pending' | 'in_progress' | 'completed' | 'error' | 'skipped';\n  duration?: number;  // milliseconds\n  error?: string;\n  skipped?: boolean;\n}\n\ninterface SetupProgressProps {\n  projectId: string;\n  issueNumber: number;\n  issueTitle: string;\n  onComplete: (result: { sessionId: string; worktreePath: string }) =\u003e void;\n  onError: (error: { step: string; error: string }) =\u003e void;\n}\n\nexport function SetupProgress({ \n  projectId, \n  issueNumber, \n  issueTitle, \n  onComplete, \n  onError \n}: SetupProgressProps) {\n  const [steps, setSteps] = useState\u003cSetupStep[]\u003e([\n    { id: 'create_worktree', name: 'Creating git worktree', status: 'pending' },\n    { id: 'install_deps', name: 'Installing dependencies', status: 'pending' },\n    { id: 'create_session', name: 'Starting AI session', status: 'pending' },\n    { id: 'initial_planning', name: 'Analyzing issue', status: 'pending' },\n  ]);\n  const [error, setError] = useState\u003c{ step: string; error: string } | null\u003e(null);\n  const [metadata, setMetadata] = useState\u003c{ branch?: string; worktreePath?: string }\u003e({});\n  \n  useEffect(() =\u003e {\n    const startSetup = async () =\u003e {\n      const response = await fetch(`/api/projects/${projectId}/planning/${issueNumber}/start`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ issueTitle }),\n      });\n      \n      const reader = response.body?.getReader();\n      const decoder = new TextDecoder();\n      \n      // Parse SSE stream...\n    };\n    \n    startSetup();\n  }, [projectId, issueNumber, issueTitle]);\n  \n  // ... render logic\n}\n```\n\n---\n\n## SSE Parsing\n\n```typescript\nfunction parseSSEEvents(chunk: string): Array\u003c{ event: string; data: object }\u003e {\n  const events: Array\u003c{ event: string; data: object }\u003e = [];\n  const lines = chunk.split('\\n');\n  \n  let currentEvent = '';\n  let currentData = '';\n  \n  for (const line of lines) {\n    if (line.startsWith('event: ')) {\n      currentEvent = line.slice(7);\n    } else if (line.startsWith('data: ')) {\n      currentData = line.slice(6);\n    } else if (line === '' \u0026\u0026 currentEvent \u0026\u0026 currentData) {\n      events.push({ event: currentEvent, data: JSON.parse(currentData) });\n      currentEvent = '';\n      currentData = '';\n    }\n  }\n  \n  return events;\n}\n```\n\n---\n\n## Visual Elements\n\n### Step Icons\n\n```tsx\nfunction StepIcon({ status }: { status: SetupStep['status'] }) {\n  switch (status) {\n    case 'pending':\n      return \u003cCircle className=\"h-4 w-4 text-muted-foreground\" /\u003e;\n    case 'in_progress':\n      return \u003cLoader2 className=\"h-4 w-4 animate-spin text-primary\" /\u003e;\n    case 'completed':\n    case 'skipped':\n      return \u003cCheckCircle2 className=\"h-4 w-4 text-green-500\" /\u003e;\n    case 'error':\n      return \u003cXCircle className=\"h-4 w-4 text-destructive\" /\u003e;\n  }\n}\n```\n\n### Duration Display\n\n```tsx\nfunction formatDuration(ms: number): string {\n  if (ms \u003c 1000) return `${ms}ms`;\n  return `${(ms / 1000).toFixed(1)}s`;\n}\n\n// Render: (1.2s) or (skipped)\n{step.duration \u0026\u0026 \u003cspan className=\"text-muted-foreground\"\u003e({formatDuration(step.duration)})\u003c/span\u003e}\n{step.skipped \u0026\u0026 \u003cspan className=\"text-muted-foreground\"\u003e(skipped)\u003c/span\u003e}\n```\n\n---\n\n## Error Handling UI\n\nWhen an error occurs:\n1. Show error icon on failed step\n2. Display error message below the step\n3. Show 'Retry' button to restart from failed step\n4. Show 'View Details' to expand full error stack\n\n```tsx\n{error \u0026\u0026 (\n  \u003cdiv className=\"mt-4 rounded-md bg-destructive/10 p-3\"\u003e\n    \u003cp className=\"text-sm text-destructive\"\u003e{error.error}\u003c/p\u003e\n    \u003cdiv className=\"mt-2 flex gap-2\"\u003e\n      \u003cButton size=\"sm\" onClick={retry}\u003eRetry\u003c/Button\u003e\n      \u003cButton size=\"sm\" variant=\"outline\" onClick={() =\u003e setShowDetails(true)}\u003e\n        View Details\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n)}\n```\n\n---\n\n## Retry Logic\n\nOn retry, restart the SSE request. The backend handles resume logic automatically (skipping completed steps).\n\n---\n\n## Files to Create\n\n- `src/components/planning/SetupProgress.tsx`\n\n---\n\n## Acceptance Criteria\n\n- [ ] Displays all 4 setup steps with appropriate icons\n- [ ] Real-time updates as SSE events arrive\n- [ ] Shows duration for completed steps\n- [ ] Handles 'skipped' status for resume scenarios\n- [ ] Error state displays error message and retry button\n- [ ] `onComplete` called with session info when done\n- [ ] `onError` called when pipeline fails\n- [ ] Proper loading states during SSE connection\n- [ ] Accessible (screen reader announces step changes)\n\n---\n\n## Dependencies\n\n- Requires: Setup Pipeline API (2.4)\n\n---\n\n## Testing Notes\n\n- Test with slow network (SSE delays)\n- Test error scenarios (each step can fail)\n- Test resume flow (steps show as skipped)\n- Test accessibility with screen reader","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:04:26.897655-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.8","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:04:26.899579-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.8","depends_on_id":"maestro-g88.7","type":"blocks","created_at":"2025-12-30T23:14:42.294266-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-g88.9","title":"Phase 3.1: Create Beads CLI Wrapper Service","description":"## Task Overview\n\nCreate a service that wraps the `bd` CLI commands, providing a clean TypeScript API for beads operations from the frontend.\n\n---\n\n## Background \u0026 Context\n\n### Why CLI Instead of MCP?\n\nThe GitHub issue explicitly recommends CLI-first approach:\n- **Simplicity**: No additional server to run\n- **Consistency**: Matches how developers use beads manually\n- **Reliability**: No connection management complexity\n- **Observability**: CLI output is easily logged\n\n### Key Commands Needed\n\n| Command | Purpose |\n|---------|---------|\n| `bd list --json` | Get all beads for display |\n| `bd show \u003cid\u003e --json` | Get single bead details |\n| `bd ready` | Get tasks ready to work |\n| `bd create --title=\"...\" --type=task --parent=\u003cepic\u003e` | Create new bead |\n| `bd update \u003cid\u003e --status=... --priority=...` | Update bead properties |\n| `bd close \u003cid\u003e` | Mark bead complete |\n| `bd dep add \u003cissue\u003e \u003cdepends-on\u003e` | Add dependency |\n\n---\n\n## Implementation Details\n\n### Service Interface\n\n```typescript\n// src/lib/services/beads.ts\n\nexport interface Bead {\n  id: string;              // e.g., \"maestro-g88\"\n  title: string;\n  description?: string;\n  type: 'epic' | 'task' | 'bug' | 'feature' | 'question' | 'docs';\n  status: 'open' | 'in_progress' | 'closed';\n  priority: 0 | 1 | 2 | 3 | 4;  // P0=critical, P4=backlog\n  parent?: string;         // Parent bead ID\n  children?: string[];     // Child bead IDs\n  blocks?: string[];       // IDs of beads this blocks\n  blockedBy?: string[];    // IDs of beads blocking this\n  files?: string[];        // Associated file paths\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface BeadTree {\n  root: Bead;              // The epic\n  children: BeadTree[];    // Nested structure\n}\n\nexport interface CreateBeadOptions {\n  title: string;\n  type: Bead['type'];\n  priority?: Bead['priority'];\n  parent?: string;\n  description?: string;\n}\n\nexport interface UpdateBeadOptions {\n  status?: Bead['status'];\n  priority?: Bead['priority'];\n  title?: string;\n  description?: string;\n}\n\nexport class BeadsService {\n  // Read operations - ALL take worktreePath as first argument\n  async list(worktreePath: string): Promise\u003cBead[]\u003e;\n  async get(worktreePath: string, id: string): Promise\u003cBead | null\u003e;\n  async getReady(worktreePath: string): Promise\u003cBead[]\u003e;\n  async getTree(worktreePath: string, epicId: string): Promise\u003cBeadTree\u003e;\n  \n  // Write operations (typically done by AI, but exposed for UI)\n  async create(worktreePath: string, options: CreateBeadOptions): Promise\u003cBead\u003e;\n  async update(worktreePath: string, id: string, updates: UpdateBeadOptions): Promise\u003cBead\u003e;\n  async close(worktreePath: string, id: string, reason?: string): Promise\u003cvoid\u003e;\n  \n  // Dependency operations\n  async addDependency(worktreePath: string, beadId: string, dependsOnId: string): Promise\u003cvoid\u003e;\n  async removeDependency(worktreePath: string, beadId: string, dependsOnId: string): Promise\u003cvoid\u003e;\n}\n```\n\n---\n\n## CLI Execution\n\n```typescript\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\n\nconst execAsync = promisify(exec);\n\nasync function runBeadsCommand(worktreePath: string, command: string): Promise\u003cstring\u003e {\n  try {\n    const { stdout, stderr } = await execAsync(`bd ${command}`, {\n      cwd: worktreePath,\n      env: { ...process.env },\n      timeout: 30000,  // 30 second timeout\n    });\n    \n    if (stderr) {\n      console.warn('bd stderr:', stderr);\n    }\n    \n    return stdout.trim();\n  } catch (error: any) {\n    throw new BeadsError(\n      `bd command failed: bd ${command}`,\n      error.code || 'COMMAND_FAILED',\n      error.stderr || error.message\n    );\n  }\n}\n```\n\n---\n\n## Parsing JSON Output\n\n```typescript\nasync list(worktreePath: string): Promise\u003cBead[]\u003e {\n  const output = await runBeadsCommand(worktreePath, 'list --json');\n  \n  // Handle empty list\n  if (!output || output === '[]') {\n    return [];\n  }\n  \n  try {\n    const raw = JSON.parse(output);\n    return raw.map(normalizeBeadFromCLI);\n  } catch (error) {\n    throw new BeadsError('Failed to parse bd list output', 'PARSE_ERROR', output);\n  }\n}\n\n// Normalize CLI output to our Bead interface\nfunction normalizeBeadFromCLI(raw: any): Bead {\n  return {\n    id: raw.id,\n    title: raw.title,\n    description: raw.description || undefined,\n    type: raw.issue_type || raw.type || 'task',\n    status: raw.status || 'open',\n    priority: typeof raw.priority === 'number' ? raw.priority : 2,\n    parent: raw.parent || undefined,\n    children: raw.children || [],\n    blocks: raw.blocks || [],\n    blockedBy: raw.blocked_by || raw.blockedBy || [],\n    files: raw.files || [],\n    createdAt: raw.created_at || raw.createdAt || new Date().toISOString(),\n    updatedAt: raw.updated_at || raw.updatedAt || new Date().toISOString(),\n  };\n}\n```\n\n---\n\n## Tree Building\n\n```typescript\nasync getTree(worktreePath: string, epicId: string): Promise\u003cBeadTree\u003e {\n  const allBeads = await this.list(worktreePath);\n  const beadMap = new Map(allBeads.map(b =\u003e [b.id, b]));\n  \n  const epic = beadMap.get(epicId);\n  if (!epic) {\n    throw new BeadsError(`Epic not found: ${epicId}`, 'NOT_FOUND');\n  }\n  \n  function buildTree(bead: Bead): BeadTree {\n    const children = allBeads\n      .filter(b =\u003e b.parent === bead.id)\n      .map(buildTree);\n    \n    return { root: bead, children };\n  }\n  \n  return buildTree(epic);\n}\n```\n\n---\n\n## Error Handling\n\n```typescript\nexport class BeadsError extends Error {\n  constructor(\n    message: string,\n    public code: 'COMMAND_FAILED' | 'PARSE_ERROR' | 'NOT_FOUND' | 'TIMEOUT',\n    public details?: string\n  ) {\n    super(message);\n    this.name = 'BeadsError';\n  }\n}\n```\n\n---\n\n## Files to Create\n\n- `src/lib/services/beads.ts`\n\n---\n\n## Acceptance Criteria\n\n- [ ] `list` returns all beads as typed array\n- [ ] `get` returns single bead or null\n- [ ] `getTree` builds hierarchical structure from epic\n- [ ] `create` creates bead via `bd create` command\n- [ ] `update` updates bead properties\n- [ ] `close` marks bead as closed\n- [ ] Proper error handling with typed errors\n- [ ] JSON parsing handles edge cases (empty, malformed)\n- [ ] Commands run in worktree directory context (first param is worktreePath)\n\n---\n\n## Dependencies\n\n- Requires: WorktreeService (2.1) - to know the worktree path\n\n---\n\n## Testing Notes\n\n- Test with empty beads database\n- Test with complex hierarchy (epic → tasks → subtasks)\n- Test error scenarios (invalid bead ID, parse errors)\n- Verify commands work in worktree context","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T23:05:14.89883-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.119254-06:00","close_reason":"Closed","dependencies":[{"issue_id":"maestro-g88.9","depends_on_id":"maestro-g88","type":"parent-child","created_at":"2025-12-30T23:05:14.901699-06:00","created_by":"daemon"},{"issue_id":"maestro-g88.9","depends_on_id":"maestro-g88.4","type":"blocks","created_at":"2025-12-31T07:52:38.469467-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:03.119254-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm","title":"Project List: Add and Manage Projects via Remote Filesystem Browser","description":"## Overview\n\nImplement the project list view - the main entry point to Maestro. This replaces the current mock data with a real persistence layer and adds a custom folder browser for adding projects from the server's filesystem.\n\n## Background \u0026 Context\n\n### Why This Matters\nMaestro is a mobile-friendly web frontend for OpenCode that runs on a user's dev machine and is accessed remotely via Tailscale. The project list is the **first screen users see** and the **foundation for all other features**. Without real project persistence, nothing else in Maestro can function.\n\n### Technical Constraint: Remote Access\nBecause Maestro runs as a Next.js server on the dev machine but is accessed from remote clients (phone, tablet, another laptop via Tailscale):\n- **Browser file picker APIs won't work** - they open on the client device, not the server\n- **We need a custom server-side folder browser** that exposes the server's filesystem\n- **All storage is server-side** - config lives at `~/.maestro/config.json` on the dev machine\n\n### Current State\n- `src/app/page.tsx` displays mock projects from `src/lib/data/mock.ts`\n- `src/components/ui/sidebar.tsx` also uses mock data\n- No API routes exist yet\n- No persistence layer exists\n\n### Target State\n- Real project storage in `~/.maestro/config.json`\n- Full CRUD API for projects\n- Filesystem browsing API (constrained to home directory)\n- Folder browser modal for adding projects\n- Project card management (edit name, remove, relocate missing)\n- Proper loading/error states throughout\n\n## Task Structure (10 Tasks)\n\n### Foundation Layer (P0) - Sequential start\n1. **Foundation: Dependencies \u0026 React Query Setup** - Install dependencies, add shadcn components, set up QueryClientProvider\n2. **Config Service** - Create `~/.maestro/config.json` persistence layer with type-safe CRUD operations\n\n### API Layer (P0) - Can parallelize after Config Service\n3. **Projects API** - All 4 endpoints: GET, POST, PATCH, DELETE /api/projects\n4. **Filesystem Browse API** - GET /api/filesystem/browse endpoint for folder picker\n\n### Data Layer (P1) - Bridges backend to frontend\n5. **React Query Hooks** - useProjects, useAddProject, useUpdateProject, useDeleteProject, useFilesystem\n\n### UI Layer (P1) - Core user-facing features\n6. **FolderBrowserModal** - Complete modal with directory list, breadcrumbs, and add project form\n7. **Project List Page** - Replace mock data, add loading/error/empty states, header Add button\n\n### Polish Layer (P2) - Enhanced UX (can parallelize 28 \u0026 31)\n8. **ProjectCard Component** - Extract card with dropdown menu, edit name dialog\n9. **Missing Project Detection \u0026 Relocate** - Warning UI for missing projects, relocate dialog\n10. **Sidebar Integration** - Fetch from API, wire + button to folder browser\n\n## Dependency Graph (Corrected)\n```\n[22. Foundation] \n      |\n      v\n[23. Config Service]\n      |\n      +---------------+\n      |               |\n      v               v\n[24. Projects API] [25. Filesystem API]\n      |               |\n      +-------+-------+\n              |\n              v\n      [26. React Query Hooks]\n              |\n              v\n      [27. FolderBrowserModal]\n              |\n      +-------+-------+\n      |               |\n      v               v\n[28. Project List] [31. Sidebar]\n      |\n      v\n[29. ProjectCard]\n      |\n      v\n[30. Missing/Relocate]\n```\n\n## Parallelization Opportunities\n- **Wave 3**: Tasks 24 and 25 can run in parallel (both depend only on 23)\n- **Wave 6**: Tasks 28 and 31 can run in parallel (both depend on 26 and 27)\n\n## Key Design Decisions\n\n### UUID-based Project IDs\nProjects get UUID v4 identifiers used in routing (`/project/[id]`). This decouples the URL from the filesystem path, allowing projects to be relocated without breaking links.\n\n### Display Name Derivation\nWhen no custom name is set, derive from path: `/Users/erik/dev/my-project` -\u003e `my-project`.\n\n### Security Boundary\nAll filesystem operations constrained to user's home directory. No browsing `/etc`, `/usr`, etc.\n\n### FolderBrowserModal Reuse\nThe modal supports both \"Add Project\" and \"Relocate Project\" modes via props, avoiding code duplication.\n\n### Symlink Resolution\nPaths are resolved via `fs.realpath()` before storing to avoid issues when symlinks change.\n\n## References\n- GitHub Issue: #1\n- SCOPE.md: Project overview and architecture\n- AGENTS.md: Development workflow guidelines","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-30T07:55:02.722791-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:57.165223-06:00","close_reason":"Completed","deleted_at":"2025-12-31T08:43:57.165223-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-slm.1","title":"1.1 Create config service for ~/.maestro/config.json","description":"## Purpose\nCreate the persistence layer for Maestro's project configuration. This service handles reading/writing `~/.maestro/config.json` and provides type-safe access to project data.\n\n## Why a Dedicated Service?\n1. **Single source of truth** - All config access goes through one place\n2. **Auto-initialization** - Creates `~/.maestro/` and `config.json` on first use\n3. **Type safety** - TypeScript interfaces for all data structures\n4. **Error handling** - Graceful handling of missing/corrupted files\n5. **Path utilities** - Centralized logic for home directory, path display, etc.\n\n## Config File Location\n```\n~/.maestro/config.json\n```\nUse `os.homedir()` to resolve `~`. This is the home of the user running the Next.js server.\n\n## Config Schema\n```typescript\n// src/lib/types/config.ts\ninterface MaestroConfig {\n  projects: ProjectConfig[];\n}\n\ninterface ProjectConfig {\n  id: string;          // UUID v4\n  path: string;        // Absolute path: /Users/erik/dev/project\n  name: string | null; // Custom display name, null = derive from path\n  addedAt: string;     // ISO 8601 timestamp\n}\n```\n\n## Service API\n```typescript\n// src/lib/services/config.ts\nclass ConfigService {\n  // Core operations\n  async getConfig(): Promise\u003cMaestroConfig\u003e\n  async saveConfig(config: MaestroConfig): Promise\u003cvoid\u003e\n  \n  // Project helpers\n  async getProjects(): Promise\u003cProjectConfig[]\u003e\n  async getProject(id: string): Promise\u003cProjectConfig | null\u003e\n  async addProject(path: string, name?: string): Promise\u003cProjectConfig\u003e\n  async updateProject(id: string, updates: Partial\u003cProjectConfig\u003e): Promise\u003cProjectConfig\u003e\n  async deleteProject(id: string): Promise\u003cvoid\u003e\n  \n  // Path utilities\n  getHomeDir(): string\n  toDisplayPath(absolutePath: string): string  // /Users/erik/dev → ~/dev\n  toAbsolutePath(displayPath: string): string  // ~/dev → /Users/erik/dev\n  deriveDisplayName(path: string): string      // /Users/erik/dev/foo → foo\n  isWithinHome(path: string): boolean          // Security check\n}\n```\n\n## Implementation Notes\n\n### Auto-initialization\n```typescript\nasync getConfig(): Promise\u003cMaestroConfig\u003e {\n  const configPath = path.join(os.homedir(), '.maestro', 'config.json');\n  try {\n    const content = await fs.readFile(configPath, 'utf-8');\n    return JSON.parse(content);\n  } catch (err) {\n    if (err.code === 'ENOENT') {\n      // First run - create default config\n      const defaultConfig = { projects: [] };\n      await this.saveConfig(defaultConfig);\n      return defaultConfig;\n    }\n    throw err;\n  }\n}\n```\n\n### Directory Creation\n```typescript\nasync saveConfig(config: MaestroConfig): Promise\u003cvoid\u003e {\n  const dir = path.join(os.homedir(), '.maestro');\n  await fs.mkdir(dir, { recursive: true }); // No-op if exists\n  await fs.writeFile(\n    path.join(dir, 'config.json'),\n    JSON.stringify(config, null, 2)\n  );\n}\n```\n\n### UUID Generation\nUse `crypto.randomUUID()` (built into Node.js 19+) or install `uuid` package.\n\n## Edge Cases\n- **Corrupted JSON**: Throw clear error, let API layer handle (could offer reset option later)\n- **Permission denied**: Throw, user needs to fix permissions\n- **Concurrent writes**: Last write wins (acceptable for v1, single user)\n- **Symlinks in path**: Resolve with `fs.realpath()` before storing\n\n## Acceptance Criteria\n- [ ] `~/.maestro/` directory created automatically\n- [ ] `config.json` created with empty projects array on first access\n- [ ] All CRUD operations work correctly\n- [ ] Path utility functions work correctly\n- [ ] Security check rejects paths outside home directory\n- [ ] Type definitions exported for use by API routes\n\n## Dependencies\n- Task 7.2 (React Query) should ideally be done first, but this can proceed in parallel as it's server-side only\n\n## Files\n- `src/lib/types/config.ts` (new) - Type definitions\n- `src/lib/services/config.ts` (new) - Service implementation","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:02.793402-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: consolidated into new task structure for better cohesion","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.10","title":"4.1 Update project list page to fetch from API","description":"## Purpose\nUpdate the project list page (`src/app/page.tsx`) to fetch real data from the API instead of using mock data. This is the core integration that makes the project list functional.\n\n## Current State\n```typescript\n// Current - uses mock data\nimport { mockProjects } from \"@/lib/data/mock\";\n// ...\n{mockProjects.map((project) =\u003e (\n```\n\n## Target State\n```typescript\n// Target - fetches from API\nimport { useProjects } from \"@/lib/hooks/useProjects\";\n// ...\nconst { data: projects, isLoading, error } = useProjects();\n// Handle loading, error, empty states\n// Map over real projects\n```\n\n## Changes Required\n\n### 1. Import useProjects hook\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\n```\n\n### 2. Replace mock data with hook\n```typescript\nexport default function ProjectListPage() {\n  const { data: projects, isLoading, error, refetch } = useProjects();\n  \n  // ... render based on state\n}\n```\n\n### 3. Update project card rendering\nThe API returns a slightly different shape than mock data:\n- `displayName` instead of `name` (computed field)\n- `displayPath` instead of `path` for display\n- `status` field for missing detection\n- No `activeSwarms`, `inProgress`, `lastActivity` yet (placeholders)\n\n```typescript\n{projects?.map((project) =\u003e (\n  \u003cLink \n    key={project.id} \n    href={`/project/${project.id}`}\n    className={cn(\n      \"flex items-center gap-3 px-3 py-2.5 hover:bg-secondary/50 transition-colors\",\n      project.status === \"missing\" \u0026\u0026 \"opacity-60\"\n    )}\n  \u003e\n    {/* ... */}\n    \u003cspan className=\"font-medium text-sm\"\u003e{project.displayName}\u003c/span\u003e\n    \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n      {project.displayPath}\n    \u003c/p\u003e\n    {/* ... */}\n  \u003c/Link\u003e\n))}\n```\n\n### 4. Handle loading state\nShow skeleton cards while loading:\n```typescript\nif (isLoading) {\n  return (\n    \u003cdiv className=\"border border-border rounded-md overflow-hidden divide-y divide-border\"\u003e\n      {[1, 2, 3].map((i) =\u003e (\n        \u003cProjectCardSkeleton key={i} /\u003e\n      ))}\n    \u003c/div\u003e\n  );\n}\n```\n\n### 5. Handle error state\nShow error with retry:\n```typescript\nif (error) {\n  return (\n    \u003cdiv className=\"text-center py-8\"\u003e\n      \u003cp className=\"text-destructive mb-2\"\u003eFailed to load projects\u003c/p\u003e\n      \u003cButton variant=\"outline\" onClick={() =\u003e refetch()}\u003e\n        Retry\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### 6. Handle empty state\nWhen no projects exist:\n```typescript\nif (!projects?.length) {\n  return \u003cNoProjectsEmptyState onAddProject={openFolderBrowser} /\u003e;\n}\n```\n\n(Empty state component is separate task 4.2)\n\n## Placeholder Data\nUntil we integrate with OpenCode for activity data, use static placeholders:\n- `activeSwarms`: 0 (or hide indicator)\n- `inProgress`: 0 (or hide indicator)\n- `lastActivity`: Show `addedAt` date formatted, or hide\n\n## Type Updates\nCreate or update types to match API response:\n```typescript\n// Can use types from useProjects hook\ninterface Project {\n  id: string;\n  path: string;\n  displayPath: string;\n  name: string | null;\n  displayName: string;\n  addedAt: string;\n  status: \"active\" | \"missing\";\n}\n```\n\n## Acceptance Criteria\n- [ ] Fetches projects from GET /api/projects\n- [ ] Renders project cards with displayName and displayPath\n- [ ] Handles loading state with skeletons\n- [ ] Handles error state with retry button\n- [ ] Empty check (for task 4.2 empty state)\n- [ ] Clicking project navigates to /project/[id]\n- [ ] Missing projects shown with different styling\n- [ ] Remove import of mockProjects\n\n## Dependencies\n- **Requires**: Task 7.1 (useProjects hook)\n- **Requires**: Task 7.2 (React Query provider)\n- **Requires**: Tasks 1.2 (GET /api/projects endpoint)\n\n## Files\n- `src/app/page.tsx` (modify)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.30898-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Project List Page task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.11","title":"4.2 Add empty state to project list page","description":"## Purpose\nCreate a compelling empty state for when users first open Maestro with no projects configured. This is the first impression for new users and should guide them to add their first project.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────┐\n│                                                 │\n│                   [folder icon]                 │\n│                                                 │\n│              No projects yet                    │\n│                                                 │\n│     Add a project folder to get started         │\n│                                                 │\n│            [ + Add Project ]                    │\n│                                                 │\n└─────────────────────────────────────────────────┘\n```\n\n## Component\n```typescript\n// src/components/empty-states/NoProjects.tsx\nimport { Folder, Plus } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface NoProjectsProps {\n  onAddProject: () =\u003e void;\n}\n\nexport function NoProjects({ onAddProject }: NoProjectsProps) {\n  return (\n    \u003cdiv className=\"flex flex-col items-center justify-center py-16 px-4 text-center\"\u003e\n      {/* Icon */}\n      \u003cdiv className=\"w-16 h-16 rounded-full bg-secondary flex items-center justify-center mb-6\"\u003e\n        \u003cFolder className=\"h-8 w-8 text-muted-foreground\" /\u003e\n      \u003c/div\u003e\n      \n      {/* Heading */}\n      \u003ch2 className=\"text-lg font-semibold mb-2\"\u003eNo projects yet\u003c/h2\u003e\n      \n      {/* Description */}\n      \u003cp className=\"text-sm text-muted-foreground mb-6 max-w-sm\"\u003e\n        Add a project folder to get started. Maestro will help you manage ideas, \n        plan tasks, and run agent swarms.\n      \u003c/p\u003e\n      \n      {/* CTA */}\n      \u003cButton onClick={onAddProject}\u003e\n        \u003cPlus className=\"h-4 w-4 mr-2\" /\u003e\n        Add Project\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Integration with page.tsx\n```typescript\n// In ProjectListPage\nconst [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n\n// ...\n\nif (!projects?.length) {\n  return (\n    \u003c\u003e\n      \u003cNoProjects onAddProject={() =\u003e setFolderBrowserOpen(true)} /\u003e\n      \u003cFolderBrowserModal \n        open={folderBrowserOpen} \n        onOpenChange={setFolderBrowserOpen}\n      /\u003e\n    \u003c/\u003e\n  );\n}\n```\n\n## Design Considerations\n\n### Illustration vs Icon\nFor v1, use a simple folder icon. Could upgrade to a custom illustration later, but icon is faster to implement and still looks good.\n\n### Copy\n- Keep it short and friendly\n- \"No projects yet\" - clear state\n- \"Add a project folder to get started\" - clear action\n- Additional context about what Maestro does - helps new users understand value\n\n### Button\n- Use primary button for strong CTA\n- Include icon for visual clarity\n- Same action as header \"Add Project\" button\n\n## Mobile Behavior\n- Centered layout works well on all screen sizes\n- Adequate padding on mobile\n- Touch-friendly button\n\n## Accessibility\n- Heading hierarchy (h2)\n- Button has clear label\n- Icon is decorative (no aria-label needed)\n\n## Acceptance Criteria\n- [ ] Shows when projects array is empty\n- [ ] Displays folder icon\n- [ ] Shows \"No projects yet\" heading\n- [ ] Shows helpful description text\n- [ ] \"Add Project\" button opens folder browser modal\n- [ ] Centered layout\n- [ ] Mobile-friendly\n\n## Dependencies\n- **Requires**: Task 3.3 (FolderBrowserModal)\n- **Used by**: Task 4.1 (project list page integration)\n\n## Files\n- `src/components/empty-states/NoProjects.tsx` (new)\n- `src/app/page.tsx` (integrate)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.369725-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Project List Page task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.12","title":"4.3 Add loading and error states to project list","description":"## Purpose\nAdd proper loading and error states to the project list page. Good loading/error UX is essential for a polished feel and helps users understand system state.\n\n## Loading State\n\n### Skeleton Cards\nShow placeholder cards that match the shape of real project cards:\n```typescript\nfunction ProjectCardSkeleton() {\n  return (\n    \u003cdiv className=\"flex items-center gap-3 px-3 py-2.5 animate-pulse\"\u003e\n      {/* Icon placeholder */}\n      \u003cdiv className=\"w-8 h-8 rounded-md bg-secondary\" /\u003e\n      \n      {/* Content placeholder */}\n      \u003cdiv className=\"flex-1 space-y-2\"\u003e\n        \u003cdiv className=\"h-4 w-32 bg-secondary rounded\" /\u003e\n        \u003cdiv className=\"h-3 w-48 bg-secondary rounded\" /\u003e\n      \u003c/div\u003e\n      \n      {/* Right side placeholder */}\n      \u003cdiv className=\"h-4 w-4 bg-secondary rounded\" /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Integration\n```typescript\nif (isLoading) {\n  return (\n    \u003cdiv className=\"border border-border rounded-md overflow-hidden divide-y divide-border\"\u003e\n      \u003cProjectCardSkeleton /\u003e\n      \u003cProjectCardSkeleton /\u003e\n      \u003cProjectCardSkeleton /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nShow 3 skeleton cards as a reasonable default. This provides visual structure while loading without being jarring.\n\n## Error State\n\n### Error Display\n```typescript\nfunction ProjectListError({ message, onRetry }: { message: string; onRetry: () =\u003e void }) {\n  return (\n    \u003cdiv className=\"border border-border rounded-md p-8 text-center\"\u003e\n      {/* Error icon */}\n      \u003cdiv className=\"w-12 h-12 rounded-full bg-destructive/10 flex items-center justify-center mx-auto mb-4\"\u003e\n        \u003cAlertCircle className=\"h-6 w-6 text-destructive\" /\u003e\n      \u003c/div\u003e\n      \n      {/* Message */}\n      \u003ch3 className=\"font-medium mb-1\"\u003eFailed to load projects\u003c/h3\u003e\n      \u003cp className=\"text-sm text-muted-foreground mb-4\"\u003e{message}\u003c/p\u003e\n      \n      {/* Retry */}\n      \u003cButton variant=\"outline\" onClick={onRetry}\u003e\n        \u003cRefreshCw className=\"h-4 w-4 mr-2\" /\u003e\n        Try Again\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n### Integration\n```typescript\nif (error) {\n  return (\n    \u003cProjectListError \n      message={error.message} \n      onRetry={() =\u003e refetch()} \n    /\u003e\n  );\n}\n```\n\n## Error Scenarios\n- **Network error**: \"Failed to fetch\" - server might be down\n- **Server error**: 500 response - show generic message\n- **Config error**: Could indicate corrupted config file\n\nFor all cases, the retry button is the primary action. If errors persist, users should check the server logs.\n\n## Refetching State\nWhen data exists but is being refetched (background refresh), don't show loading state - keep showing current data. React Query handles this automatically with `isLoading` (initial load) vs `isFetching` (refetch).\n\n```typescript\n// Only show skeleton on initial load, not refetch\nif (isLoading) {\n  return \u003cSkeletonState /\u003e;\n}\n\n// Show error only if no cached data\nif (error \u0026\u0026 !projects) {\n  return \u003cErrorState /\u003e;\n}\n```\n\n## Page-Level Integration\n```typescript\nexport default function ProjectListPage() {\n  const { data: projects, isLoading, error, refetch } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n\n  return (\n    \u003cdiv className=\"min-h-screen bg-background\"\u003e\n      {/* Header - always shown */}\n      \u003cheader\u003e...\u003c/header\u003e\n      \n      \u003cmain className=\"max-w-3xl mx-auto p-4\"\u003e\n        \u003cdiv className=\"mb-6\"\u003e\n          \u003ch1\u003eProjects\u003c/h1\u003e\n          \u003cp\u003eSelect a project to view swarms and sessions\u003c/p\u003e\n        \u003c/div\u003e\n        \n        {isLoading ? (\n          \u003cProjectListSkeleton /\u003e\n        ) : error \u0026\u0026 !projects ? (\n          \u003cProjectListError message={error.message} onRetry={refetch} /\u003e\n        ) : !projects?.length ? (\n          \u003cNoProjects onAddProject={() =\u003e setFolderBrowserOpen(true)} /\u003e\n        ) : (\n          \u003cProjectList projects={projects} /\u003e\n        )}\n      \u003c/main\u003e\n      \n      \u003cFolderBrowserModal \n        open={folderBrowserOpen}\n        onOpenChange={setFolderBrowserOpen}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Acceptance Criteria\n- [ ] Loading skeleton shown during initial fetch\n- [ ] Skeleton matches shape of real cards\n- [ ] Error state shown when API fails\n- [ ] Error message displayed\n- [ ] Retry button triggers refetch\n- [ ] Refetch doesn't show loading state (keeps stale data)\n- [ ] Proper state hierarchy: loading → error → empty → data\n\n## Dependencies\n- **Requires**: Task 4.1 (page using useProjects)\n- **Related**: Task 4.2 (empty state)\n\n## Files\n- `src/app/page.tsx` (add loading/error states)\n- Could extract: `src/components/project-list/ProjectCardSkeleton.tsx`\n- Could extract: `src/components/project-list/ProjectListError.tsx`","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.429006-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Project List Page task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.13","title":"4.4 Add 'Add Project' button to header - opens folder browser modal","description":"## Purpose\nAdd an \"Add Project\" button to the project list page header that opens the folder browser modal. This provides a consistent, always-visible entry point for adding projects.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────────────────┐\n│  ⚡ Maestro                              [Search] [+ Add]   │\n└─────────────────────────────────────────────────────────────┘\n```\n\nThe button should be:\n- Visible in the header at all times\n- Compact but recognizable\n- Consistent with the empty state CTA\n\n## Current Header\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b border-border bg-card\"\u003e\n  \u003cdiv className=\"flex h-12 items-center justify-between px-4\"\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cZap /\u003e\n      \u003cspan\u003eMaestro\u003c/span\u003e\n    \u003c/div\u003e\n    \u003cdiv className=\"flex items-center gap-1\"\u003e\n      \u003cbutton\u003e[Search]\u003c/button\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\u003c/header\u003e\n```\n\n## Updated Header\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b border-border bg-card\"\u003e\n  \u003cdiv className=\"flex h-12 items-center justify-between px-4\"\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cZap /\u003e\n      \u003cspan\u003eMaestro\u003c/span\u003e\n    \u003c/div\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cbutton className=\"search-button\"\u003e[Search]\u003c/button\u003e\n      \u003cButton \n        size=\"sm\" \n        onClick={() =\u003e setFolderBrowserOpen(true)}\n      \u003e\n        \u003cPlus className=\"h-4 w-4 mr-1\" /\u003e\n        \u003cspan className=\"hidden sm:inline\"\u003eAdd\u003c/span\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\u003c/header\u003e\n```\n\n## Button Design\n- **Size**: Small (`size=\"sm\"`) to fit header\n- **Icon**: Plus icon always visible\n- **Text**: \"Add\" visible on larger screens, hidden on mobile (icon only)\n- **Style**: Primary button for emphasis\n\n## Mobile Behavior\nOn mobile:\n- Button shows only icon (plus)\n- Maintains adequate touch target (min 44x44 via padding)\n- Positioned where thumb can reach\n\n```typescript\n\u003cButton \n  size=\"sm\" \n  onClick={() =\u003e setFolderBrowserOpen(true)}\n  className=\"h-8 px-2 sm:px-3\"\n\u003e\n  \u003cPlus className=\"h-4 w-4\" /\u003e\n  \u003cspan className=\"hidden sm:inline ml-1\"\u003eAdd\u003c/span\u003e\n\u003c/Button\u003e\n```\n\n## State Management\nThe folder browser modal state is managed at the page level:\n```typescript\nexport default function ProjectListPage() {\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  \n  return (\n    \u003c\u003e\n      \u003cheader\u003e\n        {/* ... */}\n        \u003cButton onClick={() =\u003e setFolderBrowserOpen(true)}\u003e\n          Add\n        \u003c/Button\u003e\n      \u003c/header\u003e\n      \n      {/* ... main content ... */}\n      \n      \u003cFolderBrowserModal \n        open={folderBrowserOpen}\n        onOpenChange={setFolderBrowserOpen}\n        onSuccess={() =\u003e {\n          // Optionally scroll to new project, show toast, etc.\n        }}\n      /\u003e\n    \u003c/\u003e\n  );\n}\n```\n\n## Success Callback\nAfter successfully adding a project:\n- Modal closes automatically\n- Projects list refetches (React Query invalidation)\n- Optionally show a success toast\n- New project appears at top of list (sorted by addedAt)\n\n## Acceptance Criteria\n- [ ] \"Add\" button visible in header\n- [ ] Button shows icon + text on desktop\n- [ ] Button shows icon only on mobile\n- [ ] Clicking opens folder browser modal\n- [ ] Modal closes on successful add\n- [ ] Project list updates after add\n- [ ] Button accessible via keyboard\n\n## Dependencies\n- **Requires**: Task 3.3 (FolderBrowserModal)\n- **Requires**: Task 7.1 (hooks for refetch after add)\n- **Part of**: Task 4.1 (overall page update)\n\n## Files\n- `src/app/page.tsx` (update header)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.487865-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Project List Page task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.14","title":"5.1 Add project card dropdown menu (edit name, remove)","description":"## Purpose\nAdd a dropdown menu to each project card that provides actions: \"Edit Name\" and \"Remove\". This enables users to manage existing projects without navigating away from the list.\n\n## Visual Design\n```\n┌──────────────────────────────────────────────────────────────┐\n│  📁 my-project                                          [⋮] │\n│     ~/dev/my-project                                        │\n└──────────────────────────────────────────────────────────────┘\n                                                           │\n                                                  ┌────────┴────────┐\n                                                  │  ✏️ Edit Name   │\n                                                  │  🗑️ Remove      │\n                                                  └─────────────────┘\n```\n\n## Component Structure\n```\nproject-card/\n├── ProjectCard.tsx       # Main card component\n├── ProjectCardMenu.tsx   # Dropdown menu\n├── EditNameDialog.tsx    # Edit dialog (Task 5.2)\n└── RelocateDialog.tsx    # Relocate dialog (Task 5.4)\n```\n\n## ProjectCard Component\nExtract the project card from page.tsx into a reusable component:\n```typescript\n// src/components/project-card/ProjectCard.tsx\ninterface ProjectCardProps {\n  project: Project;\n  onEdit: () =\u003e void;\n  onRemove: () =\u003e void;\n  onRelocate?: () =\u003e void;  // Only for missing projects\n}\n\nexport function ProjectCard({ project, onEdit, onRemove, onRelocate }: ProjectCardProps) {\n  const isMissing = project.status === \"missing\";\n  \n  return (\n    \u003cdiv className={cn(\n      \"flex items-center gap-3 px-3 py-2.5 transition-colors\",\n      isMissing ? \"opacity-60\" : \"hover:bg-secondary/50\"\n    )}\u003e\n      {/* Card content as link (except menu) */}\n      \u003cLink \n        href={isMissing ? \"#\" : `/project/${project.id}`}\n        className=\"flex items-center gap-3 flex-1 min-w-0\"\n        onClick={isMissing ? (e) =\u003e e.preventDefault() : undefined}\n      \u003e\n        \u003cdiv className=\"flex items-center justify-center w-8 h-8 rounded-md bg-secondary\"\u003e\n          \u003cFolder className=\"h-4 w-4 text-muted-foreground\" /\u003e\n        \u003c/div\u003e\n        \n        \u003cdiv className=\"flex-1 min-w-0\"\u003e\n          \u003cdiv className=\"flex items-center gap-2\"\u003e\n            \u003cspan className=\"font-medium text-sm\"\u003e{project.displayName}\u003c/span\u003e\n            {isMissing \u0026\u0026 (\n              \u003cspan className=\"text-xs text-warning\"\u003eMissing\u003c/span\u003e\n            )}\n          \u003c/div\u003e\n          \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n            {project.displayPath}\n          \u003c/p\u003e\n        \u003c/div\u003e\n      \u003c/Link\u003e\n      \n      {/* Menu - not part of link */}\n      \u003cProjectCardMenu \n        project={project}\n        onEdit={onEdit}\n        onRemove={onRemove}\n        onRelocate={onRelocate}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## ProjectCardMenu Component\n```typescript\n// src/components/project-card/ProjectCardMenu.tsx\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { MoreVertical, Pencil, Trash2, FolderSearch } from \"lucide-react\";\n\ninterface ProjectCardMenuProps {\n  project: Project;\n  onEdit: () =\u003e void;\n  onRemove: () =\u003e void;\n  onRelocate?: () =\u003e void;\n}\n\nexport function ProjectCardMenu({ project, onEdit, onRemove, onRelocate }: ProjectCardMenuProps) {\n  const isMissing = project.status === \"missing\";\n  \n  return (\n    \u003cDropdownMenu\u003e\n      \u003cDropdownMenuTrigger asChild\u003e\n        \u003cbutton \n          className=\"h-8 w-8 flex items-center justify-center rounded-md hover:bg-secondary transition-colors\"\n          onClick={(e) =\u003e e.preventDefault()}  // Don't trigger card link\n        \u003e\n          \u003cMoreVertical className=\"h-4 w-4 text-muted-foreground\" /\u003e\n        \u003c/button\u003e\n      \u003c/DropdownMenuTrigger\u003e\n      \u003cDropdownMenuContent align=\"end\"\u003e\n        {isMissing \u0026\u0026 onRelocate \u0026\u0026 (\n          \u003cDropdownMenuItem onClick={onRelocate}\u003e\n            \u003cFolderSearch className=\"h-4 w-4 mr-2\" /\u003e\n            Relocate\n          \u003c/DropdownMenuItem\u003e\n        )}\n        \u003cDropdownMenuItem onClick={onEdit}\u003e\n          \u003cPencil className=\"h-4 w-4 mr-2\" /\u003e\n          Edit Name\n        \u003c/DropdownMenuItem\u003e\n        \u003cDropdownMenuItem \n          onClick={onRemove}\n          className=\"text-destructive focus:text-destructive\"\n        \u003e\n          \u003cTrash2 className=\"h-4 w-4 mr-2\" /\u003e\n          Remove\n        \u003c/DropdownMenuItem\u003e\n      \u003c/DropdownMenuContent\u003e\n    \u003c/DropdownMenu\u003e\n  );\n}\n```\n\n## Menu Actions\n| Action | Condition | Behavior |\n|--------|-----------|----------|\n| Relocate | Missing projects only | Opens folder browser to select new location |\n| Edit Name | Always | Opens edit dialog |\n| Remove | Always | Immediately removes (no confirmation) |\n\n## No Confirmation for Remove\nRemove doesn't require confirmation because:\n1. **Non-destructive** - Only removes from Maestro, not from disk\n2. **Easily reversible** - Can re-add the project immediately\n3. **Reduces friction** - One click to clean up\n\n## shadcn Components Needed\nThis task requires the DropdownMenu component from shadcn/ui:\n```bash\nnpx shadcn-ui@latest add dropdown-menu\n```\n\n## Integration with Page\n```typescript\n// In page.tsx\nconst [editingProject, setEditingProject] = useState\u003cProject | null\u003e(null);\nconst [relocatingProject, setRelocatingProject] = useState\u003cProject | null\u003e(null);\nconst deleteProject = useDeleteProject();\n\n// ...\n\n{projects?.map((project) =\u003e (\n  \u003cProjectCard\n    key={project.id}\n    project={project}\n    onEdit={() =\u003e setEditingProject(project)}\n    onRemove={() =\u003e deleteProject.mutate(project.id)}\n    onRelocate={project.status === \"missing\" ? () =\u003e setRelocatingProject(project) : undefined}\n  /\u003e\n))}\n\n{/* Edit dialog */}\n\u003cEditNameDialog \n  project={editingProject}\n  open={!!editingProject}\n  onOpenChange={(open) =\u003e !open \u0026\u0026 setEditingProject(null)}\n/\u003e\n\n{/* Relocate dialog */}\n\u003cRelocateDialog\n  project={relocatingProject}\n  open={!!relocatingProject}\n  onOpenChange={(open) =\u003e !open \u0026\u0026 setRelocatingProject(null)}\n/\u003e\n```\n\n## Acceptance Criteria\n- [ ] Three-dot menu icon on each project card\n- [ ] Menu opens on click without navigating to project\n- [ ] \"Edit Name\" option present for all projects\n- [ ] \"Remove\" option present for all projects\n- [ ] \"Relocate\" option present only for missing projects\n- [ ] Remove immediately deletes (no confirmation)\n- [ ] Menu closes after action\n- [ ] Touch-friendly (adequate tap target)\n\n## Dependencies\n- **Requires**: Task 7.1 (useDeleteProject hook)\n- **Requires**: shadcn DropdownMenu component\n- **Enables**: Tasks 5.2, 5.3, 5.4 (dialogs)\n\n## Files\n- `src/components/project-card/ProjectCard.tsx` (new)\n- `src/components/project-card/ProjectCardMenu.tsx` (new)\n- `src/components/ui/dropdown-menu.tsx` (shadcn - may need to add)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.54657-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into ProjectCard component task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.15","title":"5.2 Implement edit project name functionality","description":"## Purpose\nImplement the edit project name dialog that allows users to change a project's display name. This is a simple modal with a text input and save/cancel buttons.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────┐\n│  Edit Project Name                          [X] │\n├─────────────────────────────────────────────────┤\n│                                                 │\n│  Display Name                                   │\n│  ┌─────────────────────────────────────────┐   │\n│  │ My Custom Name                          │   │\n│  └─────────────────────────────────────────┘   │\n│                                                 │\n│  Leave empty to use folder name                 │\n│                                                 │\n├─────────────────────────────────────────────────┤\n│                    [Cancel]  [Save]             │\n└─────────────────────────────────────────────────┘\n```\n\n## Props\n```typescript\ninterface EditNameDialogProps {\n  project: Project | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n}\n```\n\n## Implementation\n```typescript\n// src/components/project-card/EditNameDialog.tsx\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useUpdateProject } from \"@/lib/hooks/useProjects\";\nimport { useState, useEffect } from \"react\";\n\nexport function EditNameDialog({ project, open, onOpenChange }: EditNameDialogProps) {\n  const [name, setName] = useState(\"\");\n  const [error, setError] = useState\u003cstring | null\u003e(null);\n  const updateProject = useUpdateProject();\n  \n  // Initialize with current name when dialog opens\n  useEffect(() =\u003e {\n    if (project \u0026\u0026 open) {\n      // Use custom name if set, otherwise show derived name as placeholder\n      setName(project.name || \"\");\n      setError(null);\n    }\n  }, [project, open]);\n  \n  const handleSave = async () =\u003e {\n    if (!project) return;\n    \n    setError(null);\n    try {\n      await updateProject.mutateAsync({\n        id: project.id,\n        name: name.trim() || null,  // Empty string → null (use derived)\n      });\n      onOpenChange(false);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Failed to update name\");\n    }\n  };\n  \n  const derivedName = project?.path.split(\"/\").pop() || \"\";\n  \n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent className=\"sm:max-w-md\"\u003e\n        \u003cDialogHeader\u003e\n          \u003cDialogTitle\u003eEdit Project Name\u003c/DialogTitle\u003e\n        \u003c/DialogHeader\u003e\n        \n        \u003cdiv className=\"space-y-4 py-4\"\u003e\n          \u003cdiv className=\"space-y-2\"\u003e\n            \u003cLabel htmlFor=\"name\"\u003eDisplay Name\u003c/Label\u003e\n            \u003cInput\n              id=\"name\"\n              value={name}\n              onChange={(e) =\u003e setName(e.target.value)}\n              placeholder={derivedName}\n            /\u003e\n            \u003cp className=\"text-xs text-muted-foreground\"\u003e\n              Leave empty to use folder name ({derivedName})\n            \u003c/p\u003e\n          \u003c/div\u003e\n          \n          {error \u0026\u0026 (\n            \u003cp className=\"text-sm text-destructive\"\u003e{error}\u003c/p\u003e\n          )}\n        \u003c/div\u003e\n        \n        \u003cDialogFooter\u003e\n          \u003cButton variant=\"outline\" onClick={() =\u003e onOpenChange(false)}\u003e\n            Cancel\n          \u003c/Button\u003e\n          \u003cButton \n            onClick={handleSave}\n            disabled={updateProject.isPending}\n          \u003e\n            {updateProject.isPending ? \"Saving...\" : \"Save\"}\n          \u003c/Button\u003e\n        \u003c/DialogFooter\u003e\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  );\n}\n```\n\n## Behavior Details\n\n### Name Initialization\n- If project has custom name: Show it in input\n- If project uses derived name: Show empty input with derived name as placeholder\n\n### Saving Empty Name\n- Empty string or whitespace-only → sets `name: null` in API\n- This reverts to derived name from path\n- Clear UX: \"Leave empty to use folder name\"\n\n### Validation\n- No client-side validation needed (any string is valid)\n- Server validates and returns error if needed\n- Show error message inline\n\n### Keyboard Support\n- Enter to save\n- Escape to cancel\n- Auto-focus input on open\n\n## shadcn Components Needed\n- Dialog (may already have from FolderBrowserModal)\n- Input\n- Label\n- Button\n\n## Acceptance Criteria\n- [ ] Dialog opens with current name pre-filled\n- [ ] Placeholder shows derived name\n- [ ] Can save custom name\n- [ ] Can clear name to revert to derived\n- [ ] Shows loading state while saving\n- [ ] Shows error messages inline\n- [ ] Closes on successful save\n- [ ] Cancel closes without saving\n- [ ] Enter key submits form\n\n## Dependencies\n- **Requires**: Task 7.1 (useUpdateProject hook)\n- **Requires**: Task 1.4 (PATCH endpoint)\n- **Used by**: Task 5.1 (ProjectCardMenu)\n\n## Files\n- `src/components/project-card/EditNameDialog.tsx` (new)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.603572-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into ProjectCard component task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.16","title":"5.3 Implement missing project detection and warning UI","description":"## Purpose\nDetect and visually indicate when a project's path no longer exists on the filesystem. This helps users understand why a project might not be accessible and guides them to fix it.\n\n## Why Projects Go Missing\n- Project directory was moved or renamed\n- External drive was disconnected\n- Project was deleted from disk\n- Path was changed outside of Maestro\n\n## Visual Treatment\nMissing projects should be clearly distinguished from active ones:\n\n```\nActive project:\n┌──────────────────────────────────────────────────────────────┐\n│  📁 my-project                                          [⋮] │\n│     ~/dev/my-project                              2 min ago │\n└──────────────────────────────────────────────────────────────┘\n\nMissing project:\n┌──────────────────────────────────────────────────────────────┐\n│  📁 old-project                      ⚠️ Missing         [⋮] │\n│     ~/dev/old-project                                       │\n└──────────────────────────────────────────────────────────────┘\n  (dimmed/muted styling)\n```\n\n## Implementation\n\n### API Already Handles Detection\nThe GET /api/projects endpoint already validates each path and returns `status: \"active\" | \"missing\"`. No additional API work needed.\n\n### ProjectCard Updates\n```typescript\n// In ProjectCard.tsx\nconst isMissing = project.status === \"missing\";\n\nreturn (\n  \u003cdiv className={cn(\n    \"flex items-center gap-3 px-3 py-2.5 transition-colors\",\n    isMissing \n      ? \"opacity-60 bg-secondary/20\" \n      : \"hover:bg-secondary/50\"\n  )}\u003e\n    {/* Icon with warning indicator */}\n    \u003cdiv className=\"relative\"\u003e\n      \u003cdiv className={cn(\n        \"flex items-center justify-center w-8 h-8 rounded-md\",\n        isMissing ? \"bg-warning/10\" : \"bg-secondary\"\n      )}\u003e\n        \u003cFolder className={cn(\n          \"h-4 w-4\",\n          isMissing ? \"text-warning\" : \"text-muted-foreground\"\n        )} /\u003e\n      \u003c/div\u003e\n      {isMissing \u0026\u0026 (\n        \u003cAlertTriangle className=\"h-3 w-3 text-warning absolute -top-1 -right-1\" /\u003e\n      )}\n    \u003c/div\u003e\n    \n    \u003cdiv className=\"flex-1 min-w-0\"\u003e\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cspan className={cn(\n          \"font-medium text-sm\",\n          isMissing \u0026\u0026 \"text-muted-foreground\"\n        )}\u003e\n          {project.displayName}\n        \u003c/span\u003e\n        {isMissing \u0026\u0026 (\n          \u003cspan className=\"inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium bg-warning/10 text-warning\"\u003e\n            \u003cAlertTriangle className=\"h-3 w-3\" /\u003e\n            Missing\n          \u003c/span\u003e\n        )}\n      \u003c/div\u003e\n      \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n        {project.displayPath}\n      \u003c/p\u003e\n    \u003c/div\u003e\n    \n    {/* ... rest of card ... */}\n  \u003c/div\u003e\n);\n```\n\n### Click Behavior\nMissing projects should NOT navigate to `/project/[id]` - there's nothing to show. Instead:\n- Click on card content: Does nothing or shows inline message\n- Click on menu: Opens menu with Relocate/Remove options\n\n```typescript\n// Prevent navigation for missing projects\n\u003cLink\n  href={isMissing ? \"#\" : `/project/${project.id}`}\n  onClick={isMissing ? (e) =\u003e e.preventDefault() : undefined}\n  className={cn(isMissing \u0026\u0026 \"cursor-default\")}\n\u003e\n```\n\n### Menu Options for Missing Projects\nThe menu should show \"Relocate\" as the primary action for missing projects:\n```typescript\n// In ProjectCardMenu\n{isMissing \u0026\u0026 (\n  \u003cDropdownMenuItem onClick={onRelocate} className=\"font-medium\"\u003e\n    \u003cFolderSearch className=\"h-4 w-4 mr-2\" /\u003e\n    Relocate\n  \u003c/DropdownMenuItem\u003e\n)}\n```\n\n## Alternative Approaches Considered\n\n### Inline Relocate Button\nCould show a \"Relocate\" button directly on the card instead of in the menu. Decided against because:\n- Clutters the UI\n- Inconsistent with active project cards\n- Menu works well for infrequent action\n\n### Auto-hide Missing Projects\nCould hide missing projects by default. Decided against because:\n- User might not realize project is gone\n- No way to know something needs fixing\n- Better to show problem and offer fix\n\n### Toast on Detection\nCould show toast when missing project detected. Decided against because:\n- Could be annoying on every page load\n- Visual indicator is sufficient\n- User can fix when they want to\n\n## Acceptance Criteria\n- [ ] Missing projects have dimmed/muted styling\n- [ ] Warning icon or badge indicates \"Missing\" status\n- [ ] Click doesn't navigate to project page\n- [ ] Menu shows \"Relocate\" option prominently\n- [ ] Menu still shows \"Remove\" option\n- [ ] Clear visual distinction from active projects\n\n## Dependencies\n- **Requires**: Task 1.2 (API returns status field)\n- **Part of**: Task 5.1 (ProjectCard component)\n- **Enables**: Task 5.4 (Relocate functionality)\n\n## Files\n- `src/components/project-card/ProjectCard.tsx` (update)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.662499-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Missing Project Detection task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.17","title":"5.4 Implement relocate project functionality for missing projects","description":"## Purpose\nAllow users to \"relocate\" a missing project by selecting a new path via the folder browser. This preserves the project's ID and any associated data while updating where Maestro looks for it.\n\n## Use Case\n1. User moved `~/dev/my-project` to `~/dev/projects/my-project`\n2. Maestro shows project as \"Missing\"\n3. User clicks Relocate\n4. Folder browser opens, navigated to `~/dev` (parent of old path, or default if parent gone)\n5. User navigates to `~/dev/projects/my-project`\n6. User clicks \"Update Location\"\n7. Project is now tracked at new path, same ID preserved\n\n## Why Preserve ID?\nThe project ID is a UUID used in routing (`/project/[id]`). By keeping the same ID:\n- Bookmarks to the project still work\n- Any future features using project ID (settings, history) stay linked\n- Cleaner than delete + re-add\n\n## Visual Design\nThe relocate dialog is similar to the add project modal, but:\n- Different title: \"Relocate Project\" instead of \"Select Project Folder\"\n- Shows the old path for context\n- Button says \"Update Location\" instead of \"Add Project\"\n- No custom name input (keep existing name)\n\n```\n┌─────────────────────────────────────────────────┐\n│  Relocate Project                           [X] │\n├─────────────────────────────────────────────────┤\n│  Current path (missing):                        │\n│  ~/dev/old-location/my-project                  │\n├─────────────────────────────────────────────────┤\n│  ~ / dev / projects / my-project            [↑] │  ← Breadcrumbs\n├─────────────────────────────────────────────────┤\n│  📁 api-gateway              git                │\n│  📁 frontend                 git                │\n│                                                 │\n├─────────────────────────────────────────────────┤\n│                [Cancel]  [Update Location]      │\n└─────────────────────────────────────────────────┘\n```\n\n## Implementation\n```typescript\n// src/components/project-card/RelocateDialog.tsx\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { FolderBrowser } from \"@/components/folder-browser/FolderBrowser\";\nimport { Breadcrumbs } from \"@/components/folder-browser/Breadcrumbs\";\nimport { useUpdateProject } from \"@/lib/hooks/useProjects\";\nimport { useFilesystem } from \"@/lib/hooks/useFilesystem\";\nimport { AlertTriangle } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport path from \"path\";\n\ninterface RelocateDialogProps {\n  project: Project | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n}\n\nexport function RelocateDialog({ project, open, onOpenChange }: RelocateDialogProps) {\n  const [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e();\n  const [error, setError] = useState\u003cstring | null\u003e(null);\n  \n  const updateProject = useUpdateProject();\n  const { data: filesystem, isLoading } = useFilesystem(currentPath);\n  \n  // Set initial path when dialog opens\n  useEffect(() =\u003e {\n    if (project \u0026\u0026 open) {\n      // Try to start at parent of old path\n      // API will fall back to ~/dev or ~ if parent doesn't exist\n      const parentPath = project.path.split(\"/\").slice(0, -1).join(\"/\");\n      setCurrentPath(parentPath || undefined);\n      setError(null);\n    }\n  }, [project, open]);\n  \n  const handleRelocate = async () =\u003e {\n    if (!project || !filesystem?.currentPath) return;\n    \n    setError(null);\n    try {\n      await updateProject.mutateAsync({\n        id: project.id,\n        path: filesystem.currentPath,\n      });\n      onOpenChange(false);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Failed to relocate project\");\n    }\n  };\n  \n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent className=\"max-w-lg max-h-[80vh] flex flex-col p-0\"\u003e\n        \u003cDialogHeader className=\"px-4 py-3 border-b\"\u003e\n          \u003cDialogTitle\u003eRelocate Project\u003c/DialogTitle\u003e\n        \u003c/DialogHeader\u003e\n        \n        {/* Old path context */}\n        {project \u0026\u0026 (\n          \u003cdiv className=\"px-4 py-3 bg-secondary/30 border-b\"\u003e\n            \u003cdiv className=\"flex items-center gap-2 text-sm text-muted-foreground\"\u003e\n              \u003cAlertTriangle className=\"h-4 w-4 text-warning\" /\u003e\n              \u003cspan\u003eCurrent path (missing):\u003c/span\u003e\n            \u003c/div\u003e\n            \u003cp className=\"text-sm font-mono mt-1\"\u003e{project.displayPath}\u003c/p\u003e\n          \u003c/div\u003e\n        )}\n        \n        {/* Breadcrumbs */}\n        {filesystem \u0026\u0026 (\n          \u003cBreadcrumbs\n            currentPath={filesystem.currentPath}\n            displayPath={filesystem.displayPath}\n            onNavigate={setCurrentPath}\n            parent={filesystem.parent}\n            canGoUp={filesystem.canGoUp}\n          /\u003e\n        )}\n        \n        {/* Directory List */}\n        \u003cdiv className=\"flex-1 overflow-y-auto min-h-[200px]\"\u003e\n          \u003cFolderBrowser\n            currentPath={currentPath}\n            onNavigate={setCurrentPath}\n          /\u003e\n        \u003c/div\u003e\n        \n        {/* Error */}\n        {error \u0026\u0026 (\n          \u003cdiv className=\"px-4 py-2 text-sm text-destructive border-t\"\u003e\n            {error}\n          \u003c/div\u003e\n        )}\n        \n        {/* Actions */}\n        \u003cdiv className=\"flex justify-end gap-2 px-4 py-3 border-t\"\u003e\n          \u003cButton variant=\"outline\" onClick={() =\u003e onOpenChange(false)}\u003e\n            Cancel\n          \u003c/Button\u003e\n          \u003cButton \n            onClick={handleRelocate}\n            disabled={!filesystem?.currentPath || updateProject.isPending}\n          \u003e\n            {updateProject.isPending ? \"Updating...\" : \"Update Location\"}\n          \u003c/Button\u003e\n        \u003c/div\u003e\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  );\n}\n```\n\n## Error Handling\nThe PATCH endpoint handles validation:\n- **404**: New path doesn't exist → show error, stay in dialog\n- **400**: New path is not a directory → show error\n- **403**: New path outside home → show error\n- **409**: New path already tracked by another project → show error\n\nShow all errors inline, keep dialog open for retry.\n\n## Reusability Note\nThis dialog is very similar to FolderBrowserModal. Consider:\n1. Keep separate (clearer code, slightly different UX)\n2. Create shared base component (DRYer, more complex)\n\nFor v1, keeping separate is fine. Can refactor later if needed.\n\n## Acceptance Criteria\n- [ ] Opens from \"Relocate\" menu item on missing projects\n- [ ] Shows old path for context\n- [ ] Starts navigation at parent of old path (if exists)\n- [ ] Can navigate filesystem to find new location\n- [ ] \"Update Location\" calls PATCH API with new path\n- [ ] Shows loading state during update\n- [ ] Shows error messages inline\n- [ ] Closes on successful update\n- [ ] Project list refreshes with new path\n- [ ] Project status changes to \"active\" if path valid\n\n## Dependencies\n- **Requires**: Task 7.1 (useUpdateProject hook)\n- **Requires**: Task 1.4 (PATCH /api/projects/:id endpoint)\n- **Requires**: Task 3.1, 3.2 (FolderBrowser, Breadcrumbs components)\n- **Used by**: Task 5.1, 5.3 (ProjectCard menu)\n\n## Files\n- `src/components/project-card/RelocateDialog.tsx` (new)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.719655-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Missing Project Detection task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.18","title":"6.1 Update sidebar to fetch projects from API","description":"## Purpose\nUpdate the sidebar to fetch projects from the API instead of using mock data. The sidebar shows all projects in the left navigation, allowing users to switch between projects.\n\n## Current State\n```typescript\n// In sidebar.tsx\nimport { mockProjects } from \"@/lib/data/mock\";\n// ...\n{mockProjects.map((project) =\u003e (\n```\n\n## Target State\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\n// ...\nconst { data: projects } = useProjects();\n// ...\n{projects?.map((project) =\u003e (\n```\n\n## Changes Required\n\n### 1. Import and use hook\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\n\nexport function Sidebar() {\n  const { data: projects, isLoading } = useProjects();\n  // ...\n}\n```\n\n### 2. Update project mapping\n```typescript\n{projects?.map((project) =\u003e {\n  const isCurrentProject = project.id === currentProjectId;\n  const isMissing = project.status === \"missing\";\n\n  return (\n    \u003cTreeItem\n      key={project.id}\n      icon={\n        isCurrentProject ? (\n          \u003cFolderOpen className=\"h-4 w-4 text-primary\" /\u003e\n        ) : isMissing ? (\n          \u003cFolder className=\"h-4 w-4 text-warning\" /\u003e\n        ) : (\n          \u003cFolder className=\"h-4 w-4\" /\u003e\n        )\n      }\n      label={project.displayName}\n      defaultOpen={isCurrentProject}\n      statusIndicator={isMissing ? \"warning\" : hasActiveSwarm ? \"active\" : undefined}\n    \u003e\n      {/* ... epics and sessions for current project ... */}\n    \u003c/TreeItem\u003e\n  );\n})}\n```\n\n### 3. Handle loading state\nFor sidebar, a subtle loading state is appropriate:\n```typescript\n{isLoading ? (\n  // Show minimal skeleton or loading indicator\n  \u003cdiv className=\"px-4 py-2 text-xs text-muted-foreground\"\u003e\n    Loading projects...\n  \u003c/div\u003e\n) : projects?.length ? (\n  // Show projects\n) : (\n  // Empty state - maybe just show nothing, or prompt to add\n  \u003cdiv className=\"px-4 py-2 text-xs text-muted-foreground\"\u003e\n    No projects\n  \u003c/div\u003e\n)}\n```\n\n### 4. Show missing projects with warning\nMissing projects should be visible in sidebar with a visual indicator so users know to fix them:\n```typescript\nstatusIndicator={isMissing ? \"warning\" : /* ... */}\n```\n\nThe TreeItem component already supports a \"warning\" status indicator.\n\n## Missing Projects in Sidebar\nDecision: **Show missing projects** with warning indicator.\n\nRationale:\n- User should be aware of the problem\n- Can click and see \"Missing\" state, then fix\n- Hiding would make the problem invisible\n\n## Activity Data\nThe sidebar currently shows:\n- Active swarms count (from mock)\n- In progress count (from mock)\n\nUntil OpenCode integration is complete, these will show 0 or be hidden:\n```typescript\nconst hasActiveSwarm = false; // TODO: Get from OpenCode\n```\n\n## Epics and Sessions\nThe sidebar shows epics and sessions for the current project. These still use mock data for now (separate feature work). This task only updates the project list portion.\n\n## Acceptance Criteria\n- [ ] Fetches projects from API using useProjects hook\n- [ ] Renders project tree items with displayName\n- [ ] Current project is highlighted and expanded\n- [ ] Missing projects show warning indicator\n- [ ] Loading state while fetching\n- [ ] Empty state when no projects\n- [ ] Remove mockProjects import\n\n## Dependencies\n- **Requires**: Task 7.1 (useProjects hook)\n- **Requires**: Task 7.2 (React Query provider)\n- **Requires**: Task 1.2 (GET /api/projects endpoint)\n\n## Files\n- `src/components/ui/sidebar.tsx` (modify)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.779159-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Sidebar Integration task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.19","title":"6.2 Wire sidebar '+' button to open folder browser modal","description":"## Purpose\nWire the \"+\" button in the sidebar's Projects header to open the folder browser modal. This provides a consistent entry point for adding projects from anywhere in the app.\n\n## Current State\n```typescript\n// In sidebar.tsx\n\u003cdiv className=\"flex items-center justify-between px-2 py-1\"\u003e\n  \u003cspan className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\"\u003e\n    Projects\n  \u003c/span\u003e\n  \u003cbutton className=\"h-5 w-5 rounded hover:bg-secondary flex items-center justify-center\"\u003e\n    \u003cPlus className=\"h-3 w-3 text-muted-foreground\" /\u003e\n  \u003c/button\u003e\n\u003c/div\u003e\n```\n\nThe button exists but does nothing.\n\n## Challenge: Modal State Across Components\nThe FolderBrowserModal is rendered at the page level (in page.tsx), but the sidebar is a separate component. We need a way to open the modal from the sidebar.\n\n## Solutions\n\n### Option 1: Context (Recommended)\nCreate a context to manage the folder browser modal state:\n```typescript\n// src/contexts/FolderBrowserContext.tsx\ninterface FolderBrowserContextType {\n  openFolderBrowser: () =\u003e void;\n}\n\nconst FolderBrowserContext = createContext\u003cFolderBrowserContextType | null\u003e(null);\n\nexport function useFolderBrowser() {\n  const context = useContext(FolderBrowserContext);\n  if (!context) throw new Error(\"useFolderBrowser must be used within FolderBrowserProvider\");\n  return context;\n}\n\n// In layout or page\n\u003cFolderBrowserContext.Provider value={{ openFolderBrowser: () =\u003e setModalOpen(true) }}\u003e\n  \u003cSidebar /\u003e\n  {/* ... */}\n  \u003cFolderBrowserModal open={modalOpen} onOpenChange={setModalOpen} /\u003e\n\u003c/FolderBrowserContext.Provider\u003e\n```\n\n### Option 2: Callback Prop\nPass a callback through component hierarchy:\n```typescript\n// In layout\n\u003cSidebar onAddProject={() =\u003e setModalOpen(true)} /\u003e\n```\n\nThis works but requires prop drilling through layout → sidebar.\n\n### Option 3: Portal Modal in Sidebar\nRender the modal from within the sidebar:\n```typescript\n// In sidebar.tsx\nconst [modalOpen, setModalOpen] = useState(false);\n\nreturn (\n  \u003c\u003e\n    {/* sidebar content */}\n    \u003cFolderBrowserModal open={modalOpen} onOpenChange={setModalOpen} /\u003e\n  \u003c/\u003e\n);\n```\n\nThis is simplest but means multiple modal instances if main page also has one.\n\n## Recommended Approach: Option 3 (Simple)\nFor v1, render the modal directly in the sidebar. Multiple modal instances aren't a problem since only one is open at a time, and they share the same React Query cache for instant updates.\n\n```typescript\n// src/components/ui/sidebar.tsx\nimport { FolderBrowserModal } from \"@/components/folder-browser/FolderBrowserModal\";\nimport { useState } from \"react\";\n\nexport function Sidebar() {\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  const { data: projects } = useProjects();\n  \n  return (\n    \u003cdiv className=\"w-64 h-screen flex flex-col border-r border-border bg-card\"\u003e\n      {/* ... header, search ... */}\n      \n      \u003cnav className=\"flex-1 overflow-y-auto px-2 py-2\"\u003e\n        {/* Projects Section */}\n        \u003cdiv className=\"mb-2\"\u003e\n          \u003cdiv className=\"flex items-center justify-between px-2 py-1\"\u003e\n            \u003cspan className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\"\u003e\n              Projects\n            \u003c/span\u003e\n            \u003cbutton \n              onClick={() =\u003e setFolderBrowserOpen(true)}\n              className=\"h-5 w-5 rounded hover:bg-secondary flex items-center justify-center\"\n            \u003e\n              \u003cPlus className=\"h-3 w-3 text-muted-foreground\" /\u003e\n            \u003c/button\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n        \n        {/* ... project tree ... */}\n      \u003c/nav\u003e\n      \n      {/* ... bottom actions ... */}\n      \n      {/* Folder Browser Modal */}\n      \u003cFolderBrowserModal \n        open={folderBrowserOpen} \n        onOpenChange={setFolderBrowserOpen}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Accessibility\nThe \"+\" button should be properly labeled:\n```typescript\n\u003cbutton \n  onClick={() =\u003e setFolderBrowserOpen(true)}\n  className=\"...\"\n  aria-label=\"Add project\"\n\u003e\n  \u003cPlus className=\"h-3 w-3 text-muted-foreground\" /\u003e\n\u003c/button\u003e\n```\n\n## Success Behavior\nAfter adding a project:\n1. Modal closes\n2. useProjects hook refetches (React Query invalidation)\n3. New project appears in sidebar immediately\n4. No need to refresh page\n\n## Acceptance Criteria\n- [ ] \"+\" button in sidebar opens folder browser modal\n- [ ] Can add project from sidebar\n- [ ] Project list updates after add\n- [ ] Modal closes on success\n- [ ] Button has proper aria-label\n- [ ] Works consistently with main page add button\n\n## Dependencies\n- **Requires**: Task 3.3 (FolderBrowserModal)\n- **Requires**: Task 6.1 (Sidebar fetches from API)\n\n## Files\n- `src/components/ui/sidebar.tsx` (update)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T07:55:03.837573-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Sidebar Integration task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.2","title":"1.2 Implement GET /api/projects endpoint","description":"## Purpose\nImplement the `GET /api/projects` endpoint that returns all saved projects with computed fields and validation status.\n\n## Why This Endpoint?\nThis is the primary data source for the project list UI. It must:\n1. Return all projects from config\n2. Compute display-friendly fields (displayPath, displayName)\n3. Validate each project's path still exists\n4. Sort by most recently added\n\n## Response Schema\n```typescript\ninterface ProjectsResponse {\n  projects: Project[];\n}\n\ninterface Project {\n  id: string;\n  path: string;              // Absolute: /Users/erik/dev/project\n  displayPath: string;       // Friendly: ~/dev/project\n  name: string | null;       // Custom name or null\n  displayName: string;       // name ?? derived from path\n  addedAt: string;           // ISO 8601\n  status: \"active\" | \"missing\";\n}\n```\n\n## Implementation\n```typescript\n// src/app/api/projects/route.ts\nimport { NextResponse } from \"next/server\";\nimport { configService } from \"@/lib/services/config\";\nimport fs from \"fs/promises\";\n\nexport async function GET() {\n  try {\n    const projects = await configService.getProjects();\n    \n    const enrichedProjects = await Promise.all(\n      projects.map(async (p) =\u003e {\n        // Check if path exists\n        let status: \"active\" | \"missing\" = \"active\";\n        try {\n          await fs.access(p.path);\n        } catch {\n          status = \"missing\";\n        }\n        \n        return {\n          id: p.id,\n          path: p.path,\n          displayPath: configService.toDisplayPath(p.path),\n          name: p.name,\n          displayName: p.name ?? configService.deriveDisplayName(p.path),\n          addedAt: p.addedAt,\n          status,\n        };\n      })\n    );\n    \n    // Sort by addedAt descending (most recent first)\n    enrichedProjects.sort((a, b) =\u003e \n      new Date(b.addedAt).getTime() - new Date(a.addedAt).getTime()\n    );\n    \n    return NextResponse.json({ projects: enrichedProjects });\n  } catch (error) {\n    console.error(\"Failed to fetch projects:\", error);\n    return NextResponse.json(\n      { error: \"Failed to fetch projects\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\n## Performance Note\nPath validation (`fs.access`) is done for each project on every request. For typical use cases (\u003c 20 projects), this is fine. If it becomes slow, we could:\n- Cache validation results briefly\n- Validate asynchronously and update status in background\n- Only validate on explicit refresh\n\nFor v1, keep it simple - validate on every request.\n\n## Acceptance Criteria\n- [ ] Returns all projects from config\n- [ ] Computes displayPath correctly (~ notation)\n- [ ] Computes displayName correctly (custom or derived)\n- [ ] Detects missing projects (path doesn't exist)\n- [ ] Sorts by addedAt descending\n- [ ] Returns empty array when no projects (not error)\n- [ ] Returns 500 on unexpected errors\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service)\n\n## Files\n- `src/app/api/projects/route.ts` (new)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:02.851831-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into consolidated Projects API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.20","title":"7.1 Create shared React Query hooks for projects API","description":"## Purpose\nCreate shared React Query hooks that encapsulate all API interactions for projects and filesystem browsing. These hooks provide a consistent, type-safe interface for components to fetch and mutate data.\n\n## Why Custom Hooks?\n1. **DRY** - Don't repeat query keys, fetch logic, error handling\n2. **Type safety** - Return types match API response schemas\n3. **Optimistic updates** - Centralized cache invalidation logic\n4. **Testing** - Easy to mock in component tests\n\n## Hook API Design\n\n### useProjects\n```typescript\n// src/lib/hooks/useProjects.ts\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\n\ninterface Project {\n  id: string;\n  path: string;\n  displayPath: string;\n  name: string | null;\n  displayName: string;\n  addedAt: string;\n  status: \"active\" | \"missing\";\n}\n\nexport function useProjects() {\n  return useQuery({\n    queryKey: [\"projects\"],\n    queryFn: async (): Promise\u003cProject[]\u003e =\u003e {\n      const res = await fetch(\"/api/projects\");\n      if (!res.ok) throw new Error(\"Failed to fetch projects\");\n      const data = await res.json();\n      return data.projects;\n    },\n  });\n}\n\nexport function useProject(id: string) {\n  const { data: projects } = useProjects();\n  return projects?.find(p =\u003e p.id === id);\n}\n```\n\n### useAddProject\n```typescript\nexport function useAddProject() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (input: { path: string; name?: string }) =\u003e {\n      const res = await fetch(\"/api/projects\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(input),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to add project\");\n      }\n      return res.json();\n    },\n    onSuccess: () =\u003e {\n      queryClient.invalidateQueries({ queryKey: [\"projects\"] });\n    },\n  });\n}\n```\n\n### useUpdateProject\n```typescript\nexport function useUpdateProject() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ id, ...updates }: { id: string; name?: string | null; path?: string }) =\u003e {\n      const res = await fetch(`/api/projects/${id}`, {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(updates),\n      });\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to update project\");\n      }\n      return res.json();\n    },\n    onSuccess: () =\u003e {\n      queryClient.invalidateQueries({ queryKey: [\"projects\"] });\n    },\n  });\n}\n```\n\n### useDeleteProject\n```typescript\nexport function useDeleteProject() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (id: string) =\u003e {\n      const res = await fetch(`/api/projects/${id}`, {\n        method: \"DELETE\",\n      });\n      if (!res.ok \u0026\u0026 res.status !== 204) {\n        throw new Error(\"Failed to delete project\");\n      }\n    },\n    onSuccess: () =\u003e {\n      queryClient.invalidateQueries({ queryKey: [\"projects\"] });\n    },\n  });\n}\n```\n\n### useFilesystem\n```typescript\n// src/lib/hooks/useFilesystem.ts\ninterface Directory {\n  name: string;\n  path: string;\n  isGitRepo: boolean;\n}\n\ninterface BrowseResult {\n  currentPath: string;\n  displayPath: string;\n  parent: string | null;\n  canGoUp: boolean;\n  directories: Directory[];\n}\n\nexport function useFilesystem(path?: string) {\n  return useQuery({\n    queryKey: [\"filesystem\", path],\n    queryFn: async (): Promise\u003cBrowseResult\u003e =\u003e {\n      const url = path \n        ? `/api/filesystem/browse?path=${encodeURIComponent(path)}`\n        : \"/api/filesystem/browse\";\n      const res = await fetch(url);\n      if (!res.ok) {\n        const error = await res.json();\n        throw new Error(error.error || \"Failed to browse directory\");\n      }\n      return res.json();\n    },\n    // Keep previous data while navigating to avoid flash\n    placeholderData: (previousData) =\u003e previousData,\n  });\n}\n```\n\n## Error Handling Pattern\nAll hooks throw errors that can be caught by error boundaries or handled by the component:\n```typescript\nconst { data, error, isLoading } = useProjects();\n\nif (error) {\n  return \u003cErrorState message={error.message} onRetry={() =\u003e refetch()} /\u003e;\n}\n```\n\n## Cache Invalidation Strategy\n- After add/update/delete, invalidate the entire projects list\n- For filesystem browsing, each path is cached independently\n- Use `placeholderData` to keep showing old data while new data loads\n\n## Type Exports\nExport all types so components have full type safety:\n```typescript\nexport type { Project, Directory, BrowseResult };\n```\n\n## Acceptance Criteria\n- [ ] useProjects fetches and returns project list\n- [ ] useProject(id) returns single project from cache\n- [ ] useAddProject mutation works with cache invalidation\n- [ ] useUpdateProject mutation works with cache invalidation\n- [ ] useDeleteProject mutation works with cache invalidation\n- [ ] useFilesystem fetches directory contents\n- [ ] All hooks have proper TypeScript types\n- [ ] Error messages propagate from API responses\n\n## Dependencies\n- **Requires**: Task 7.2 (React Query provider)\n- **Requires**: Tasks 1.2, 1.3, 2.1 (API endpoints must exist)\n\n## Files\n- `src/lib/hooks/useProjects.ts` (new)\n- `src/lib/hooks/useFilesystem.ts` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.894727-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: now standalone React Query Hooks task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.21","title":"7.2 Set up React Query provider","description":"## Purpose\nSet up React Query (TanStack Query) as the data fetching and caching layer for all API interactions. This is a foundational task that must be completed before any UI components can consume API data.\n\n## Why React Query?\n1. **Automatic caching** - Projects list is fetched once and cached; subsequent navigations are instant\n2. **Background refetching** - Stale data is refreshed automatically when window regains focus\n3. **Optimistic updates** - Edit/delete operations feel instant while we sync with server\n4. **Loading/error states** - Standardized handling across all API calls\n5. **Request deduplication** - Multiple components requesting same data = one network call\n\n## Implementation Details\n\n### Install dependencies\n```bash\nbun add @tanstack/react-query\n```\n\n### Create providers.tsx\n```typescript\n// src/app/providers.tsx\n\"use client\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\n\nexport function Providers({ children }: { children: React.ReactNode }) {\n  const [queryClient] = useState(() =\u003e new QueryClient({\n    defaultOptions: {\n      queries: {\n        staleTime: 60 * 1000, // 1 minute before refetch\n        retry: 1,\n      },\n    },\n  }));\n  \n  return (\n    \u003cQueryClientProvider client={queryClient}\u003e\n      {children}\n    \u003c/QueryClientProvider\u003e\n  );\n}\n```\n\n### Update layout.tsx\nWrap the app with Providers in the root layout.\n\n## Considerations\n- Use `useState` for QueryClient to avoid recreating on each render (App Router requirement)\n- Set reasonable `staleTime` - projects don't change often, but we want fresh data on focus\n- Single retry is enough - if server is down, failing fast is better than hanging\n\n## Acceptance Criteria\n- [ ] @tanstack/react-query installed\n- [ ] Providers component created with QueryClientProvider\n- [ ] Root layout wraps children with Providers\n- [ ] Can use `useQuery` in any client component\n\n## Dependencies\nNone - this is a foundational task.\n\n## Files\n- `src/app/providers.tsx` (new)\n- `src/app/layout.tsx` (modify)\n- `package.json` (dependency added)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:03.954086-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into Foundation task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.22","title":"1. Foundation: Dependencies \u0026 React Query Setup","description":"## Purpose\nSet up the foundational dependencies and infrastructure needed by all other tasks. This is the first task to complete.\n\n## Dependencies to Install\n```bash\nbun add @tanstack/react-query\n```\n\n## shadcn Components to Add\n```bash\nnpx shadcn@latest add dialog dropdown-menu input label scroll-area alert\n```\n\nThese components are used by:\n- **Dialog**: FolderBrowserModal, EditNameDialog, RelocateDialog\n- **DropdownMenu**: ProjectCard menu\n- **Input**: Name input in dialogs, path input in folder browser\n- **Label**: Form labels in dialogs\n- **ScrollArea**: Mobile-friendly scrollable directory list in folder browser\n- **Alert**: Error state displays\n\n## React Query Provider Setup\n\n### Create providers.tsx\n```typescript\n// src/app/providers.tsx\n\"use client\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\n\nexport function Providers({ children }: { children: React.ReactNode }) {\n  const [queryClient] = useState(() =\u003e new QueryClient({\n    defaultOptions: {\n      queries: {\n        staleTime: 5 * 60 * 1000, // 5 minutes - projects change rarely\n        retry: 1,\n        refetchOnWindowFocus: true, // Refetch when user switches back from file operations\n      },\n    },\n  }));\n  \n  return (\n    \u003cQueryClientProvider client={queryClient}\u003e\n      {children}\n    \u003c/QueryClientProvider\u003e\n  );\n}\n```\n\n### Update layout.tsx\nWrap the app with Providers in the root layout:\n```typescript\nimport { Providers } from \"./providers\";\n\nexport default function RootLayout({ children }) {\n  return (\n    \u003chtml\u003e\n      \u003cbody\u003e\n        \u003cProviders\u003e{children}\u003c/Providers\u003e\n      \u003c/body\u003e\n    \u003c/html\u003e\n  );\n}\n```\n\n## Why These Choices\n- **React Query**: Automatic caching, background refetching, optimistic updates, request deduplication\n- **useState for QueryClient**: Required for App Router to avoid recreating on each render\n- **staleTime 5 minutes**: Projects change rarely; no need for frequent refetching\n- **refetchOnWindowFocus**: Ensures fresh data when user returns from filesystem operations\n- **retry 1**: Fail fast if server is down\n\n## Acceptance Criteria\n- [ ] @tanstack/react-query installed\n- [ ] shadcn Dialog component added\n- [ ] shadcn DropdownMenu component added  \n- [ ] shadcn Input component added\n- [ ] shadcn Label component added\n- [ ] shadcn ScrollArea component added\n- [ ] shadcn Alert component added\n- [ ] Providers component created with QueryClientProvider\n- [ ] Root layout wraps children with Providers\n- [ ] Can use `useQuery` in any client component\n\n## Files\n- `package.json` (dependencies)\n- `src/app/providers.tsx` (new)\n- `src/app/layout.tsx` (modify)\n- `src/components/ui/dialog.tsx` (new - shadcn)\n- `src/components/ui/dropdown-menu.tsx` (new - shadcn)\n- `src/components/ui/input.tsx` (new - shadcn)\n- `src/components/ui/label.tsx` (new - shadcn)\n- `src/components/ui/scroll-area.tsx` (new - shadcn)\n- `src/components/ui/alert.tsx` (new - shadcn)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T08:13:15.413668-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Installed @tanstack/react-query, added shadcn components (dialog, dropdown-menu, input, label, scroll-area, alert), created Providers component with QueryClientProvider, updated root layout to wrap children with Providers. Build passes.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.23","title":"2. Config Service for ~/.maestro/config.json","description":"## Purpose\nCreate the persistence layer for Maestro's project configuration. This service handles reading/writing `~/.maestro/config.json` and provides type-safe access to project data.\n\n## Config File Location\n```\n~/.maestro/config.json\n```\nUse `os.homedir()` to resolve `~`. This is the home of the user running the Next.js server.\n\n## Config Schema\n```typescript\n// src/lib/types/config.ts\ninterface MaestroConfig {\n  projects: ProjectConfig[];\n}\n\ninterface ProjectConfig {\n  id: string;          // UUID v4\n  path: string;        // Absolute path: /Users/erik/dev/project\n  name: string | null; // Custom display name, null = derive from path\n  addedAt: string;     // ISO 8601 timestamp\n}\n```\n\n## Service API\n```typescript\n// src/lib/services/config.ts\nclass ConfigService {\n  // Core operations\n  async getConfig(): Promise\u003cMaestroConfig\u003e\n  async saveConfig(config: MaestroConfig): Promise\u003cvoid\u003e\n  \n  // Project helpers\n  async getProjects(): Promise\u003cProjectConfig[]\u003e\n  async getProject(id: string): Promise\u003cProjectConfig | null\u003e\n  async projectExists(id: string): Promise\u003cboolean\u003e  // Quick existence check\n  async addProject(path: string, name?: string): Promise\u003cProjectConfig\u003e\n  async updateProject(id: string, updates: Partial\u003cPick\u003cProjectConfig, \"name\" | \"path\"\u003e\u003e): Promise\u003cProjectConfig\u003e\n  async deleteProject(id: string): Promise\u003cvoid\u003e\n  \n  // Path utilities\n  getHomeDir(): string\n  toDisplayPath(absolutePath: string): string  // /Users/erik/dev -\u003e ~/dev\n  toAbsolutePath(displayPath: string): string  // ~/dev -\u003e /Users/erik/dev\n  deriveDisplayName(path: string): string      // /Users/erik/dev/foo -\u003e foo\n  isWithinHome(path: string): boolean          // Security check\n  getParentPath(path: string): string | null   // Get parent directory, null if at home\n}\n\n// Export singleton instance\nexport const configService = new ConfigService();\n```\n\n## Implementation Notes\n\n### Auto-initialization\n```typescript\nasync getConfig(): Promise\u003cMaestroConfig\u003e {\n  const configPath = path.join(os.homedir(), \".maestro\", \"config.json\");\n  try {\n    const content = await fs.readFile(configPath, \"utf-8\");\n    return JSON.parse(content);\n  } catch (err) {\n    if (err.code === \"ENOENT\") {\n      const defaultConfig = { projects: [] };\n      await this.saveConfig(defaultConfig);\n      return defaultConfig;\n    }\n    throw err;\n  }\n}\n```\n\n### Directory Creation\n```typescript\nasync saveConfig(config: MaestroConfig): Promise\u003cvoid\u003e {\n  const dir = path.join(os.homedir(), \".maestro\");\n  await fs.mkdir(dir, { recursive: true });\n  await fs.writeFile(\n    path.join(dir, \"config.json\"),\n    JSON.stringify(config, null, 2)\n  );\n}\n```\n\n### UUID Generation\nUse `crypto.randomUUID()` (built into Node.js).\n\n### Symlink Resolution\n**IMPORTANT**: Resolve symlinks BEFORE storing paths to avoid issues when symlinks change:\n```typescript\nasync addProject(inputPath: string, name?: string): Promise\u003cProjectConfig\u003e {\n  // Resolve symlinks to get the real path\n  const realPath = await fs.realpath(inputPath);\n  // Then validate and store realPath\n}\n```\n\n### Path Utilities\n```typescript\ntoDisplayPath(absolutePath: string): string {\n  const home = this.getHomeDir();\n  if (absolutePath.startsWith(home)) {\n    return \"~\" + absolutePath.slice(home.length);\n  }\n  return absolutePath;\n}\n\ntoAbsolutePath(displayPath: string): string {\n  if (displayPath.startsWith(\"~/\") || displayPath === \"~\") {\n    return path.join(this.getHomeDir(), displayPath.slice(1));\n  }\n  return displayPath;\n}\n\nisWithinHome(testPath: string): boolean {\n  const resolved = path.resolve(testPath);\n  const home = this.getHomeDir();\n  // Handle both with and without trailing separator\n  return resolved === home || resolved.startsWith(home + path.sep);\n}\n\ngetParentPath(filePath: string): string | null {\n  const parent = path.dirname(filePath);\n  // Stop at home directory\n  if (!this.isWithinHome(parent) || parent === filePath) {\n    return null;\n  }\n  return parent;\n}\n```\n\n## Error Handling\nDefine specific error types for clear API responses:\n```typescript\nexport class ConfigError extends Error {\n  constructor(\n    message: string,\n    public code: \"ENOENT\" | \"EACCES\" | \"PARSE_ERROR\" | \"VALIDATION\"\n  ) {\n    super(message);\n    this.name = \"ConfigError\";\n  }\n}\n```\n\n## Edge Cases\n- **Corrupted JSON**: Throw ConfigError with code \"PARSE_ERROR\", let API layer handle\n- **Permission denied**: Throw ConfigError with code \"EACCES\", user needs to fix permissions\n- **Concurrent writes**: Last write wins (acceptable for v1, single user)\n- **Symlinks in path**: Resolve with `fs.realpath()` before storing\n\n## Acceptance Criteria\n- [ ] `~/.maestro/` directory created automatically on first access\n- [ ] `config.json` created with empty projects array on first access\n- [ ] All CRUD operations work correctly (add, get, update, delete)\n- [ ] `projectExists()` helper for quick validation\n- [ ] Path utility functions work correctly (toDisplayPath, toAbsolutePath, deriveDisplayName)\n- [ ] `getParentPath()` utility for relocate flow navigation\n- [ ] Security check rejects paths outside home directory\n- [ ] Symlinks resolved before storing\n- [ ] Type definitions exported for use by API routes\n- [ ] Singleton instance exported as `configService`\n- [ ] Clear error types for different failure modes\n\n## Files\n- `src/lib/types/config.ts` (new)\n- `src/lib/services/config.ts` (new)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T08:13:36.967567-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Created config types (MaestroConfig, ProjectConfig, ConfigError) and ConfigService class with full CRUD operations, path utilities, and security checks. Singleton instance exported as configService. TypeScript checks pass.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.24","title":"3. Projects API: GET, POST, PATCH, DELETE endpoints","description":"## Purpose\nImplement all four CRUD endpoints for projects. These are the backbone of the project management feature.\n\n## Endpoints Overview\n\n| Method | Path | Purpose |\n|--------|------|---------|\n| GET | /api/projects | List all projects with computed fields |\n| POST | /api/projects | Add a new project |\n| PATCH | /api/projects/[id] | Update name or relocate path |\n| DELETE | /api/projects/[id] | Remove project from tracking |\n\n---\n\n## GET /api/projects\n\nReturns all projects with computed fields and validation status.\n\n### Response Schema\n```typescript\ninterface ProjectsResponse {\n  projects: Project[];\n}\n\ninterface Project {\n  id: string;\n  path: string;              // Absolute: /Users/erik/dev/project\n  displayPath: string;       // Friendly: ~/dev/project\n  name: string | null;       // Custom name or null\n  displayName: string;       // name ?? derived from path\n  addedAt: string;           // ISO 8601\n  status: \"active\" | \"missing\";\n}\n```\n\n### Implementation\n- Fetch all projects from config service\n- For each project, check if path exists (`fs.access`)\n- Compute displayPath, displayName, status\n- Sort by addedAt descending (most recent first)\n- Return empty array when no projects (not error)\n\n---\n\n## POST /api/projects\n\nAdd a new project.\n\n### Request\n```json\n{\n  \"path\": \"/Users/erik/dev/my-project\",\n  \"name\": \"My Project\"\n}\n```\n\n`name` is optional (omit or set to null to derive from path).\n\n### Validation (in order)\n1. `path` required and non-empty string\n2. Path must be within home directory (security) -\u003e 403\n3. Resolve symlinks with `fs.realpath()`\n4. Path must exist -\u003e 404\n5. Path must be a directory -\u003e 400\n6. Path must not already be tracked -\u003e 409\n\n### Response\n- 201 with created project object on success\n- Error responses with `{ error: \"message\" }`\n\n---\n\n## PATCH /api/projects/[id]\n\nUpdate name or relocate path.\n\n### Request\n```json\n{\n  \"name\": \"New Name\",\n  \"path\": \"/new/path\"\n}\n```\n\nAt least one field required. Both optional.\n\n### Validation\n- Project must exist -\u003e 404\n- If path provided: same validation as POST (exists, is directory, in home, not duplicate)\n- If path is same as current: no-op (not an error, just return current state)\n- Empty name or whitespace-only -\u003e treat as null (use derived)\n\n### Response\n- 200 with updated project object\n- Error responses with `{ error: \"message\" }`\n\n---\n\n## DELETE /api/projects/[id]\n\nRemove project from tracking (not from disk).\n\n### Response\n- 204 No Content on success\n- 204 even if project doesn't exist (idempotent)\n\n---\n\n## Shared Response Type\n```typescript\n// Used in GET list item, POST response, PATCH response\ninterface Project {\n  id: string;\n  path: string;\n  displayPath: string;\n  name: string | null;\n  displayName: string;\n  addedAt: string;\n  status: \"active\" | \"missing\";\n}\n```\n\n## Error Response Format\nAll errors return:\n```json\n{\n  \"error\": \"Human-readable error message\"\n}\n```\n\n## Acceptance Criteria\n- [ ] GET /api/projects returns all projects with computed fields\n- [ ] GET returns empty array (not error) when no projects\n- [ ] GET detects missing projects (status: \"missing\")\n- [ ] POST validates all requirements (path exists, is directory, in home, not duplicate)\n- [ ] POST resolves symlinks before storing\n- [ ] POST returns 201 with created project\n- [ ] PATCH can update name only\n- [ ] PATCH can update path only (relocate)\n- [ ] PATCH can update both\n- [ ] PATCH with same path value is a no-op (not error)\n- [ ] PATCH returns 404 for unknown ID\n- [ ] DELETE returns 204 (idempotent)\n- [ ] All error responses have consistent format\n\n## Files\n- `src/app/api/projects/route.ts` (new) - GET, POST\n- `src/app/api/projects/[id]/route.ts` (new) - PATCH, DELETE","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T08:13:58.737043-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Implemented GET, POST /api/projects and PATCH, DELETE /api/projects/[id] endpoints with computed fields (displayPath, displayName, status), path validation, symlink resolution, missing project detection, and consistent error format.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.25","title":"4. Filesystem Browse API endpoint","description":"## Purpose\nImplement the `GET /api/filesystem/browse` endpoint for the folder picker UI. This enables users to navigate the server's filesystem to select project directories.\n\n## Why Custom Browsing?\nMaestro runs on the dev machine but is accessed remotely (via Tailscale). Browser file picker APIs open on the **client** device, not the server. We need a custom API that exposes the server's filesystem in a controlled way.\n\n## Security Constraints\n**Critical**: This endpoint exposes the filesystem. Security measures:\n1. **Home directory only** - Cannot browse outside `~`\n2. **Directories only** - Don't list files\n3. **Hidden directories filtered** - No `.git`, `.config`, `.ssh`, etc.\n4. **Permission errors handled gracefully** - Skip unreadable dirs\n\n## Query Parameters\n| Param | Required | Default | Description |\n|-------|----------|---------|-------------|\n| `path` | No | `~/dev` or `~` | Directory to list |\n\nIf `path` not provided:\n- Try `~/dev` first (common convention)\n- Fall back to `~` if `~/dev` doesn't exist\n\n## Response Schema\n```typescript\ninterface BrowseResponse {\n  currentPath: string;    // Absolute: /Users/erik/dev\n  displayPath: string;    // Friendly: ~/dev\n  parent: string | null;  // Parent path, null if at home\n  canGoUp: boolean;       // false if at home directory\n  directories: Directory[];\n}\n\ninterface Directory {\n  name: string;           // Directory name\n  path: string;           // Absolute path\n  isGitRepo: boolean;     // Has .git subdirectory\n}\n```\n\n## Implementation\n```typescript\n// src/app/api/filesystem/browse/route.ts\nconst HIDDEN_PATTERNS = [\n  /^\\./,                 // Hidden dirs (., .git, .config, etc)\n  /^node_modules$/,\n  /^__pycache__$/,\n  /^\\.cache$/,\n  /^vendor$/,\n  /^\\.?venv$/,\n  /^.next$/,            // Next.js build output\n  /^dist$/,             // Common build output\n  /^build$/,            // Common build output\n  /^target$/,           // Rust/Maven build output\n  /^coverage$/,         // Test coverage\n  /^\\.nyc_output$/,    // NYC coverage\n];\n\nfunction shouldHide(name: string): boolean {\n  return HIDDEN_PATTERNS.some(pattern =\u003e pattern.test(name));\n}\n\n// Add timeout wrapper for filesystem operations\nasync function withTimeout\u003cT\u003e(promise: Promise\u003cT\u003e, ms: number): Promise\u003cT\u003e {\n  const timeout = new Promise\u003cnever\u003e((_, reject) =\u003e\n    setTimeout(() =\u003e reject(new Error('Filesystem timeout')), ms)\n  );\n  return Promise.race([promise, timeout]);\n}\n\nexport async function GET(request: Request) {\n  // 1. Determine path (from query or default)\n  // 2. Security check: must be within home\n  // 3. Validate path exists and is directory (with 5s timeout)\n  // 4. Read directory entries (with 5s timeout)\n  // 5. Filter to visible directories\n  // 6. Check each for .git subdirectory\n  // 7. Sort alphabetically (case-insensitive)\n  // 8. Compute parent/canGoUp using configService.getParentPath()\n  // 9. Return response\n}\n```\n\n## Git Repo Detection\nCheck for `.git` subdirectory to identify git repos. This helps users visually distinguish project directories from regular folders.\n\n## Error Responses\n| Status | Condition |\n|--------|-----------|\n| 400 | Invalid path parameter |\n| 403 | Path outside home directory |\n| 404 | Path does not exist |\n| 500 | Filesystem timeout (network drive issues) |\n\n## Edge Cases\n- **Permission denied on subdirectory**: Skip it, don't fail request\n- **Symlink directory**: Follow it, check resolved path is within home\n- **Race condition (dir deleted while reading)**: Skip missing entries\n- **Network drive timeout**: Fail after 5 seconds with clear error\n\n## Acceptance Criteria\n- [ ] Returns directories at requested path\n- [ ] Defaults to ~/dev (or ~ if no ~/dev)\n- [ ] Hides hidden directories (starting with .)\n- [ ] Hides node_modules, __pycache__, vendor, venv\n- [ ] Hides build output directories (.next, dist, build, target, coverage)\n- [ ] Shows isGitRepo indicator for git repos\n- [ ] Provides parent path for navigation (using configService.getParentPath())\n- [ ] Returns canGoUp: false at home directory\n- [ ] Returns 403 for paths outside home\n- [ ] Returns 404 for non-existent paths\n- [ ] Handles permission errors gracefully (skips unreadable)\n- [ ] Directories sorted alphabetically (case-insensitive)\n- [ ] 5 second timeout for filesystem operations\n\n## Files\n- `src/app/api/filesystem/browse/route.ts` (new)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T08:14:22.590412-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Implemented GET /api/filesystem/browse endpoint with security constraints (home directory only), hidden directory filtering, git repo detection, 5s timeout, and proper error handling.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.26","title":"5. React Query Hooks for Projects and Filesystem","description":"Completed: Created React Query hooks for Projects and Filesystem APIs","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T08:14:44.110157-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Created api.ts types (Project, Directory, BrowseResult), useProjects.ts hooks (useProjects, useProject, useAddProject, useUpdateProject, useDeleteProject), and useFilesystem.ts hook. All with proper TypeScript types, error handling, and cache invalidation.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.27","title":"6. FolderBrowserModal with Directory List and Breadcrumbs","description":"## Purpose\nCreate the complete folder browser modal for adding projects (and later, relocating). This is a cohesive UI component that includes the modal wrapper, directory list, breadcrumb navigation, and add project form.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────┐\n│  Select Project Folder                      [X] │\n├─────────────────────────────────────────────────┤\n│  ~ / dev / my-project                       [↑] │  \u003c- Breadcrumbs\n├─────────────────────────────────────────────────┤\n│  📁 api-gateway              git                │\n│  📁 frontend                 git                │\n│  📁 scripts                                     │\n│                                                 │\n│              (ScrollArea - scrollable)          │\n├─────────────────────────────────────────────────┤\n│  Name: [my-project              ] (optional)    │\n├─────────────────────────────────────────────────┤\n│                    [Cancel]  [Add Project]      │\n└─────────────────────────────────────────────────┘\n```\n\n## Component Structure\n```\nfolder-browser/\n├── FolderBrowserModal.tsx   # Main modal with state management\n├── DirectoryList.tsx        # Scrollable directory list (uses ScrollArea)\n├── Breadcrumbs.tsx          # Path navigation\n└── index.ts                 # Exports\n```\n\n## Props - FolderBrowserModal\n```typescript\ninterface FolderBrowserModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n  \n  // For \"Relocate\" mode (Task 9)\n  mode?: \"add\" | \"relocate\";\n  initialPath?: string;\n  projectToRelocate?: Project;\n  \n  onSuccess?: () =\u003e void;\n}\n```\n\n## State Management\nThe modal manages navigation state and calls the API:\n```typescript\nconst [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e(initialPath);\nconst [customName, setCustomName] = useState(\"\");\nconst [error, setError] = useState\u003cstring | null\u003e(null);\n\nconst { data: filesystem, isLoading, error: fetchError } = useFilesystem(currentPath);\nconst addProject = useAddProject();\nconst updateProject = useUpdateProject();\n```\n\n## DirectoryList Component\n```typescript\ninterface DirectoryListProps {\n  directories: Directory[];\n  onNavigate: (path: string) =\u003e void;\n  isLoading?: boolean;\n}\n```\n\nFeatures:\n- Wrapped in `\u003cScrollArea\u003e` for mobile-friendly scrolling\n- Click directory -\u003e navigate into it\n- Git indicator badge for repos\n- Loading skeleton while fetching\n- Empty state when no subdirectories\n- 44px+ touch targets for mobile\n\n## Breadcrumbs Component\n```typescript\ninterface BreadcrumbsProps {\n  currentPath: string;       // Absolute path for building segment paths\n  displayPath: string;       // ~/dev/project for display\n  onNavigate: (path: string) =\u003e void;\n  parent: string | null;\n  canGoUp: boolean;\n}\n```\n\nFeatures:\n- Clickable path segments (except current)\n- Up button (disabled at home)\n- Horizontal scroll on mobile with overflow-x-auto\n- Home icon for ~ segment\n\n## Mobile-Responsive Dialog\n```typescript\n\u003cDialogContent className=\"max-w-none h-full sm:max-w-lg sm:h-auto sm:max-h-[80vh]\"\u003e\n```\n\nThis makes the modal full-screen on mobile, constrained on desktop.\n\n## Keyboard Accessibility\n- **Enter** on directory item: Navigate into it\n- **Escape**: Close modal (default Dialog behavior)\n- **Arrow keys**: Navigate directory list items\n- **Tab**: Move between interactive elements\n\n## Dual Mode Support\nThe modal supports both adding and relocating:\n\n**Add Mode (default)**:\n- Title: \"Select Project Folder\"\n- Shows name input\n- Button: \"Add Project\" (disabled until directory selected)\n- Calls useAddProject\n\n**Relocate Mode**:\n- Title: \"Relocate Project\"\n- Shows old path context (warning banner)\n- No name input (keep existing)\n- Button: \"Update Location\"\n- Calls useUpdateProject with new path\n\n```typescript\n// In modal\nconst handleSubmit = async () =\u003e {\n  if (!filesystem?.currentPath) return;\n  \n  setError(null);\n  try {\n    if (mode === \"relocate\" \u0026\u0026 projectToRelocate) {\n      await updateProject.mutateAsync({\n        id: projectToRelocate.id,\n        path: filesystem.currentPath,\n      });\n    } else {\n      await addProject.mutateAsync({\n        path: filesystem.currentPath,\n        name: customName.trim() || undefined,\n      });\n    }\n    onOpenChange(false);\n    onSuccess?.();\n  } catch (err) {\n    setError(err instanceof Error ? err.message : \"An error occurred\");\n  }\n};\n```\n\n## Button States\n- **Add/Update button disabled when**: No directory selected, or mutation in progress\n- **Show loading spinner**: When mutation is pending\n\n## Error Handling\n- Browse errors: Show in directory list area with retry button\n- Add/Update errors: Show inline below form (red Alert component)\n- Clear error when navigating or retrying\n\n## Acceptance Criteria\n- [ ] Modal opens/closes correctly\n- [ ] Full-screen on mobile, constrained on desktop\n- [ ] Breadcrumbs show current path with clickable segments\n- [ ] Up button navigates to parent (disabled at home)\n- [ ] Directory list wrapped in ScrollArea\n- [ ] Directory list shows folders with git indicators\n- [ ] Click directory navigates into it\n- [ ] Loading skeleton while fetching directories\n- [ ] Empty state when no subdirectories\n- [ ] Name input with folder name as placeholder (add mode only)\n- [ ] Add button disabled until directory selected\n- [ ] Add mode: calls POST /api/projects\n- [ ] Relocate mode: calls PATCH /api/projects/[id] with path\n- [ ] Shows loading state on submit button\n- [ ] Shows errors inline (Alert component)\n- [ ] Closes on success\n- [ ] Keyboard accessible (Enter, Escape, Tab)\n\n## Files\n- `src/components/folder-browser/FolderBrowserModal.tsx` (new)\n- `src/components/folder-browser/DirectoryList.tsx` (new)\n- `src/components/folder-browser/Breadcrumbs.tsx` (new)\n- `src/components/folder-browser/index.ts` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T08:15:12.42384-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Created FolderBrowserModal, DirectoryList, and Breadcrumbs components with full functionality including add/relocate modes, navigation, loading states, error handling, and mobile-responsive design. TypeScript and build pass.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.28","title":"7. Project List Page: API Integration and States","description":"## Purpose\nUpdate the main project list page to fetch real data from the API, replacing mock data. This includes all UI states: loading, error, empty, and the \"Add Project\" button.\n\n## Current State\n```typescript\n// src/app/page.tsx\nimport { mockProjects } from \"@/lib/data/mock\";\n// Uses mockProjects.map(...)\n```\n\n## Target State\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\nimport { FolderBrowserModal } from \"@/components/folder-browser\";\n\nexport default function ProjectListPage() {\n  const { data: projects, isLoading, error, refetch } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  \n  // Render based on state...\n}\n```\n\n## Page Structure\n```\n┌─────────────────────────────────────────────────────────────┐\n│  ⚡ Maestro                              [Search] [+ Add]   │  \u003c- Header\n├─────────────────────────────────────────────────────────────┤\n│  Projects                                                   │\n│  Select a project to view swarms and sessions               │\n├─────────────────────────────────────────────────────────────┤\n│  ┌─────────────────────────────────────────────────────┐   │\n│  │  📁 my-project                                  [⋮] │   │  \u003c- Project cards\n│  │     ~/dev/my-project                                │   │\n│  ├─────────────────────────────────────────────────────┤   │\n│  │  📁 another-project                             [⋮] │   │\n│  │     ~/dev/another                                   │   │\n│  └─────────────────────────────────────────────────────┘   │\n└─────────────────────────────────────────────────────────────┘\n```\n\n## State Rendering Logic\n```typescript\nif (isLoading) {\n  return \u003cProjectListSkeleton /\u003e;\n}\n\nif (error \u0026\u0026 !projects) {\n  return \u003cProjectListError message={error.message} onRetry={refetch} /\u003e;\n}\n\nif (!projects?.length) {\n  return \u003cNoProjectsEmptyState onAddProject={() =\u003e setFolderBrowserOpen(true)} /\u003e;\n}\n\nreturn \u003cProjectList projects={projects} /\u003e;\n```\n\n## Loading State - Skeleton Cards\n```typescript\nfunction ProjectCardSkeleton() {\n  return (\n    \u003cdiv className=\"flex items-center gap-3 px-3 py-2.5 animate-pulse\"\u003e\n      \u003cdiv className=\"w-8 h-8 rounded-md bg-secondary\" /\u003e\n      \u003cdiv className=\"flex-1 space-y-2\"\u003e\n        \u003cdiv className=\"h-4 w-32 bg-secondary rounded\" /\u003e\n        \u003cdiv className=\"h-3 w-48 bg-secondary rounded\" /\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\nShow 3 skeletons as default.\n\n## Error State\n```typescript\nfunction ProjectListError({ message, onRetry }) {\n  return (\n    \u003cdiv className=\"border rounded-md p-8 text-center\"\u003e\n      \u003cAlertCircle className=\"h-6 w-6 text-destructive mx-auto mb-4\" /\u003e\n      \u003ch3 className=\"font-medium mb-1\"\u003eFailed to load projects\u003c/h3\u003e\n      \u003cp className=\"text-sm text-muted-foreground mb-4\"\u003e{message}\u003c/p\u003e\n      \u003cButton variant=\"outline\" onClick={onRetry}\u003e\n        \u003cRefreshCw className=\"h-4 w-4 mr-2\" /\u003e\n        Try Again\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Empty State\n```typescript\nfunction NoProjectsEmptyState({ onAddProject }) {\n  return (\n    \u003cdiv className=\"flex flex-col items-center py-16 text-center\"\u003e\n      \u003cdiv className=\"w-16 h-16 rounded-full bg-secondary flex items-center justify-center mb-6\"\u003e\n        \u003cFolder className=\"h-8 w-8 text-muted-foreground\" /\u003e\n      \u003c/div\u003e\n      \u003ch2 className=\"text-lg font-semibold mb-2\"\u003eNo projects yet\u003c/h2\u003e\n      \u003cp className=\"text-sm text-muted-foreground mb-6 max-w-sm\"\u003e\n        Add a project folder to get started.\n      \u003c/p\u003e\n      \u003cButton onClick={onAddProject}\u003e\n        \u003cPlus className=\"h-4 w-4 mr-2\" /\u003e\n        Add Project\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Header Add Button\nUpdate header to include Add button:\n```typescript\n\u003cheader className=\"sticky top-0 z-50 border-b bg-card\"\u003e\n  \u003cdiv className=\"flex h-12 items-center justify-between px-4\"\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cZap /\u003e\n      \u003cspan\u003eMaestro\u003c/span\u003e\n    \u003c/div\u003e\n    \u003cdiv className=\"flex items-center gap-2\"\u003e\n      \u003cbutton className=\"search-button\"\u003e...\u003c/button\u003e\n      \u003cButton size=\"sm\" onClick={() =\u003e setFolderBrowserOpen(true)}\u003e\n        \u003cPlus className=\"h-4 w-4\" /\u003e\n        \u003cspan className=\"hidden sm:inline ml-1\"\u003eAdd\u003c/span\u003e\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n\u003c/header\u003e\n```\n\nMobile: Icon only. Desktop: Icon + \"Add\".\n\n## Interim Project Cards\nFor this task, render simple cards inline. The full ProjectCard component with menu will replace this in Task 8.\n\n```typescript\n{projects.map((project) =\u003e {\n  const isMissing = project.status === \"missing\";\n  return (\n    \u003cLink \n      key={project.id}\n      href={isMissing ? undefined : `/project/${project.id}`}\n      className={cn(\n        \"flex items-center gap-3 px-3 py-2.5\",\n        isMissing ? \"opacity-60 cursor-default\" : \"hover:bg-secondary/50\"\n      )}\n    \u003e\n      \u003cFolder className={cn(\"h-4 w-4\", isMissing \u0026\u0026 \"text-warning\")} /\u003e\n      \u003cdiv className=\"flex-1 min-w-0\"\u003e\n        \u003cdiv className=\"flex items-center gap-2\"\u003e\n          \u003cspan className=\"font-medium text-sm\"\u003e{project.displayName}\u003c/span\u003e\n          {isMissing \u0026\u0026 (\n            \u003cspan className=\"text-xs px-1.5 py-0.5 rounded bg-warning/10 text-warning\"\u003e\n              Missing\n            \u003c/span\u003e\n          )}\n        \u003c/div\u003e\n        \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n          {project.displayPath}\n        \u003c/p\u003e\n      \u003c/div\u003e\n      {!isMissing \u0026\u0026 \u003cChevronRight className=\"h-4 w-4 text-muted-foreground\" /\u003e}\n    \u003c/Link\u003e\n  );\n})}\n```\n\nNote: Missing projects show warning badge but no navigation. The menu and edit functionality comes in Task 8.\n\n## Modal Placement\nThe FolderBrowserModal lives inside the page component:\n```typescript\nreturn (\n  \u003cdiv\u003e\n    {/* ... page content ... */}\n    \u003cFolderBrowserModal \n      open={folderBrowserOpen}\n      onOpenChange={setFolderBrowserOpen}\n    /\u003e\n  \u003c/div\u003e\n);\n```\n\n## Acceptance Criteria\n- [ ] Fetches projects from API using useProjects\n- [ ] Loading skeleton shown during initial fetch (3 cards)\n- [ ] Error state with retry button\n- [ ] Empty state with Add Project CTA\n- [ ] Projects rendered with displayName and displayPath\n- [ ] Missing projects show warning badge and dimmed styling\n- [ ] Clicking active project navigates to /project/[id]\n- [ ] Clicking missing project does NOT navigate\n- [ ] Header has Add button (icon-only on mobile, icon+text on desktop)\n- [ ] Add button opens FolderBrowserModal\n- [ ] Project list updates after adding project\n- [ ] Remove mockProjects import\n\n## Files\n- `src/app/page.tsx` (major update)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T08:15:42.972344-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Updated page.tsx to use useProjects hook, added loading skeleton, error state with retry, empty state with Add CTA, missing project handling (yellow badge, not clickable), and integrated FolderBrowserModal. Removed mockProjects import.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.29","title":"8. ProjectCard Component with Menu and Edit Name","description":"## Purpose\nExtract the project card into a reusable component with a dropdown menu for actions: Edit Name and Remove. This enables inline project management.\n\n## Visual Design\n```\n┌──────────────────────────────────────────────────────────────┐\n│  📁 my-project                                          [⋮] │\n│     ~/dev/my-project                                        │\n└──────────────────────────────────────────────────────────────┘\n                                                           │\n                                                  ┌────────┴────────┐\n                                                  │  ✏️ Edit Name   │\n                                                  │  🗑️ Remove      │\n                                                  └─────────────────┘\n```\n\n## Component Structure\n```\nproject-card/\n├── ProjectCard.tsx       # Main card component\n├── ProjectCardMenu.tsx   # Dropdown menu\n├── EditNameDialog.tsx    # Edit name modal\n└── index.ts\n```\n\n## ProjectCard Props\n```typescript\ninterface ProjectCardProps {\n  project: Project;\n  onEdit: () =\u003e void;\n  onRemove: () =\u003e void;\n  onRelocate?: () =\u003e void;  // Only for missing projects (Task 9)\n}\n```\n\n## ProjectCard Implementation\nThe card content is a Link, but the menu button sits outside the Link to prevent navigation when clicking the menu.\n\n```typescript\nexport function ProjectCard({ project, onEdit, onRemove, onRelocate }: ProjectCardProps) {\n  const isMissing = project.status === \"missing\";\n  \n  return (\n    \u003cdiv className={cn(\n      \"flex items-center gap-3 px-3 py-2.5 transition-colors\",\n      isMissing ? \"opacity-60\" : \"hover:bg-secondary/50\"\n    )}\u003e\n      {/* Card content as conditional link */}\n      {isMissing ? (\n        \u003cdiv className=\"flex items-center gap-3 flex-1 min-w-0\"\u003e\n          {/* content */}\n        \u003c/div\u003e\n      ) : (\n        \u003cLink \n          href={`/project/${project.id}`}\n          className=\"flex items-center gap-3 flex-1 min-w-0\"\n        \u003e\n          {/* same content */}\n        \u003c/Link\u003e\n      )}\n      \n      {/* Menu - NOT part of link */}\n      \u003cProjectCardMenu\n        isMissing={isMissing}\n        onEdit={onEdit}\n        onRemove={onRemove}\n        onRelocate={onRelocate}\n      /\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## ProjectCardMenu\n```typescript\ninterface ProjectCardMenuProps {\n  isMissing: boolean;\n  onEdit: () =\u003e void;\n  onRemove: () =\u003e void;\n  onRelocate?: () =\u003e void;\n}\n\nfunction ProjectCardMenu({ isMissing, onEdit, onRemove, onRelocate }) {\n  return (\n    \u003cDropdownMenu\u003e\n      \u003cDropdownMenuTrigger asChild\u003e\n        \u003cbutton \n          className=\"h-8 w-8 flex items-center justify-center rounded-md hover:bg-secondary\"\n          onClick={(e) =\u003e e.stopPropagation()}\n        \u003e\n          \u003cMoreVertical className=\"h-4 w-4 text-muted-foreground\" /\u003e\n        \u003c/button\u003e\n      \u003c/DropdownMenuTrigger\u003e\n      \u003cDropdownMenuContent align=\"end\"\u003e\n        {isMissing \u0026\u0026 onRelocate \u0026\u0026 (\n          \u003cDropdownMenuItem onClick={onRelocate} className=\"font-medium\"\u003e\n            \u003cFolderSearch className=\"h-4 w-4 mr-2\" /\u003e\n            Relocate\n          \u003c/DropdownMenuItem\u003e\n        )}\n        \u003cDropdownMenuItem onClick={onEdit}\u003e\n          \u003cPencil className=\"h-4 w-4 mr-2\" /\u003e\n          Edit Name\n        \u003c/DropdownMenuItem\u003e\n        \u003cDropdownMenuItem onClick={onRemove} className=\"text-destructive\"\u003e\n          \u003cTrash2 className=\"h-4 w-4 mr-2\" /\u003e\n          Remove\n        \u003c/DropdownMenuItem\u003e\n      \u003c/DropdownMenuContent\u003e\n    \u003c/DropdownMenu\u003e\n  );\n}\n```\n\n## EditNameDialog\n```typescript\ninterface EditNameDialogProps {\n  project: Project | null;\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n}\n\nfunction EditNameDialog({ project, open, onOpenChange }) {\n  const [name, setName] = useState(\"\");\n  const updateProject = useUpdateProject();\n  \n  useEffect(() =\u003e {\n    if (project \u0026\u0026 open) {\n      setName(project.name || \"\");\n    }\n  }, [project, open]);\n  \n  const handleSave = async () =\u003e {\n    if (!project) return;\n    await updateProject.mutateAsync({\n      id: project.id,\n      name: name.trim() || null,  // null reverts to derived name\n    });\n    onOpenChange(false);\n  };\n  \n  const derivedName = project?.path.split(\"/\").pop() || \"\";\n  \n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent className=\"sm:max-w-md\"\u003e\n        \u003cDialogHeader\u003e\n          \u003cDialogTitle\u003eEdit Project Name\u003c/DialogTitle\u003e\n        \u003c/DialogHeader\u003e\n        \u003cdiv className=\"space-y-4 py-4\"\u003e\n          \u003cdiv className=\"space-y-2\"\u003e\n            \u003cLabel htmlFor=\"name\"\u003eDisplay Name\u003c/Label\u003e\n            \u003cInput\n              id=\"name\"\n              value={name}\n              onChange={(e) =\u003e setName(e.target.value)}\n              placeholder={derivedName}\n            /\u003e\n            \u003cp className=\"text-xs text-muted-foreground\"\u003e\n              Leave empty to use folder name ({derivedName})\n            \u003c/p\u003e\n          \u003c/div\u003e\n        \u003c/div\u003e\n        \u003cDialogFooter\u003e\n          \u003cButton variant=\"outline\" onClick={() =\u003e onOpenChange(false)}\u003e\n            Cancel\n          \u003c/Button\u003e\n          \u003cButton onClick={handleSave} disabled={updateProject.isPending}\u003e\n            {updateProject.isPending ? \"Saving...\" : \"Save\"}\n          \u003c/Button\u003e\n        \u003c/DialogFooter\u003e\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  );\n}\n```\n\n## Remove Action\nRemove calls useDeleteProject directly - no confirmation needed (non-destructive, only removes from tracking):\n```typescript\nconst deleteProject = useDeleteProject();\n// ...\nonRemove={() =\u003e deleteProject.mutate(project.id)}\n```\n\nThe project is removed from the list immediately when the mutation succeeds (React Query invalidates the cache).\n\n## Integration with Page\n```typescript\n// In page.tsx\nconst [editingProject, setEditingProject] = useState\u003cProject | null\u003e(null);\nconst deleteProject = useDeleteProject();\n\n{projects.map((project) =\u003e (\n  \u003cProjectCard\n    key={project.id}\n    project={project}\n    onEdit={() =\u003e setEditingProject(project)}\n    onRemove={() =\u003e deleteProject.mutate(project.id)}\n    // onRelocate handled in Task 9\n  /\u003e\n))}\n\n\u003cEditNameDialog \n  project={editingProject}\n  open={!!editingProject}\n  onOpenChange={(open) =\u003e !open \u0026\u0026 setEditingProject(null)}\n/\u003e\n```\n\n## Acceptance Criteria\n- [ ] ProjectCard renders project info (displayName, displayPath)\n- [ ] Active projects are clickable links\n- [ ] Missing projects are NOT clickable (handled in Task 9 for full styling)\n- [ ] Three-dot menu icon on each card\n- [ ] Menu opens without navigating to project (e.stopPropagation)\n- [ ] Menu shows \"Edit Name\" and \"Remove\" options\n- [ ] \"Edit Name\" opens EditNameDialog\n- [ ] EditNameDialog pre-fills current name (or empty if using derived)\n- [ ] Can save new name\n- [ ] Empty name input reverts to derived name\n- [ ] \"Remove\" immediately deletes (no confirmation)\n- [ ] Project list updates after edit/remove\n- [ ] Menu closes after action\n- [ ] Touch-friendly tap targets (8x8 minimum for menu button)\n\n## Files\n- `src/components/project-card/ProjectCard.tsx` (new)\n- `src/components/project-card/ProjectCardMenu.tsx` (new)\n- `src/components/project-card/EditNameDialog.tsx` (new)\n- `src/components/project-card/index.ts` (new)\n- `src/app/page.tsx` (integrate - replace inline cards with ProjectCard)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T08:16:08.491404-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Created ProjectCard, ProjectCardMenu, and EditNameDialog components. Updated page.tsx to use them. Menu has Edit Name and Remove options, supports Relocate for missing projects. Edit dialog pre-fills and updates via useUpdateProject. Build passes.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.3","title":"1.3 Implement POST /api/projects endpoint","description":"## Purpose\nImplement the `POST /api/projects` endpoint for adding new projects to Maestro.\n\n## Why Validation Matters\nThis endpoint is the gatekeeper for project integrity. It must validate:\n1. Path is provided and non-empty\n2. Path exists on the filesystem\n3. Path is a directory (not a file)\n4. Path is within user's home directory (security)\n5. Path isn't already tracked (no duplicates)\n\n## Request Schema\n```typescript\ninterface AddProjectRequest {\n  path: string;       // Required: absolute path\n  name?: string;      // Optional: custom display name\n}\n```\n\n## Response Schema\nOn success, returns the created project (same shape as GET response item):\n```typescript\ninterface Project {\n  id: string;\n  path: string;\n  displayPath: string;\n  name: string | null;\n  displayName: string;\n  addedAt: string;\n  status: \"active\";\n}\n```\n\n## Error Responses\n| Status | Condition | Response |\n|--------|-----------|----------|\n| 400 | Missing or empty path | `{ error: \"Path is required\" }` |\n| 400 | Path is not a directory | `{ error: \"Path is not a directory\" }` |\n| 403 | Path outside home directory | `{ error: \"Path must be within home directory\" }` |\n| 404 | Path does not exist | `{ error: \"Path does not exist\" }` |\n| 409 | Duplicate path | `{ error: \"Project already exists\" }` |\n\n## Implementation\n```typescript\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const { path: inputPath, name } = body;\n    \n    // Validate path provided\n    if (!inputPath || typeof inputPath !== \"string\" || !inputPath.trim()) {\n      return NextResponse.json(\n        { error: \"Path is required\" },\n        { status: 400 }\n      );\n    }\n    \n    const absolutePath = configService.toAbsolutePath(inputPath.trim());\n    \n    // Security: must be within home\n    if (!configService.isWithinHome(absolutePath)) {\n      return NextResponse.json(\n        { error: \"Path must be within home directory\" },\n        { status: 403 }\n      );\n    }\n    \n    // Check path exists\n    try {\n      await fs.access(absolutePath);\n    } catch {\n      return NextResponse.json(\n        { error: \"Path does not exist\" },\n        { status: 404 }\n      );\n    }\n    \n    // Check it's a directory\n    const stat = await fs.stat(absolutePath);\n    if (!stat.isDirectory()) {\n      return NextResponse.json(\n        { error: \"Path is not a directory\" },\n        { status: 400 }\n      );\n    }\n    \n    // Check for duplicates\n    const existing = await configService.getProjects();\n    if (existing.some(p =\u003e p.path === absolutePath)) {\n      return NextResponse.json(\n        { error: \"Project already exists\" },\n        { status: 409 }\n      );\n    }\n    \n    // Add project\n    const project = await configService.addProject(\n      absolutePath,\n      name?.trim() || undefined\n    );\n    \n    return NextResponse.json({\n      id: project.id,\n      path: project.path,\n      displayPath: configService.toDisplayPath(project.path),\n      name: project.name,\n      displayName: project.name ?? configService.deriveDisplayName(project.path),\n      addedAt: project.addedAt,\n      status: \"active\",\n    }, { status: 201 });\n    \n  } catch (error) {\n    console.error(\"Failed to add project:\", error);\n    return NextResponse.json(\n      { error: \"Failed to add project\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\n## Edge Cases\n- **Path with trailing slash**: Normalize before storing\n- **Path with ~**: Expand to absolute before validation/storage\n- **Symlink path**: Follow symlink, check resolved path is within home\n- **Empty name string**: Treat as null (use derived name)\n- **Whitespace-only name**: Treat as null\n\n## Acceptance Criteria\n- [ ] Validates all required fields\n- [ ] Returns 400 for missing/invalid path\n- [ ] Returns 403 for paths outside home directory\n- [ ] Returns 404 for non-existent paths\n- [ ] Returns 400 for file paths (not directories)\n- [ ] Returns 409 for duplicate paths\n- [ ] Returns 201 with created project on success\n- [ ] Generated UUID is used in response\n- [ ] Timestamp is set correctly\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service)\n- **Can parallel with**: Task 1.2 (GET endpoint)\n\n## Files\n- `src/app/api/projects/route.ts` (add POST handler)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:02.92336-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into consolidated Projects API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.30","title":"9. Missing Project Detection and Relocate Flow","description":"## Purpose\nEnhance the project card to show warning status for missing projects (path no longer exists) and provide a \"Relocate\" action to point Maestro to the project's new location.\n\n## Why Projects Go Missing\n- Directory was moved or renamed\n- External drive disconnected\n- Project deleted from disk\n- Path changed outside Maestro\n\n## Visual Treatment - Missing Projects\n```\nActive project:\n┌──────────────────────────────────────────────────────────────┐\n│  📁 my-project                                          [⋮] │\n│     ~/dev/my-project                                        │\n└──────────────────────────────────────────────────────────────┘\n\nMissing project:\n┌──────────────────────────────────────────────────────────────┐\n│  📁 old-project                    ⚠️ Missing           [⋮] │\n│     ~/dev/old-project                                       │\n└──────────────────────────────────────────────────────────────┘\n  (dimmed styling, warning colors)\n```\n\n## ProjectCard Updates for Missing Status\nExtend the ProjectCard component from Task 8:\n\n```typescript\nconst isMissing = project.status === \"missing\";\n\nreturn (\n  \u003cdiv className={cn(\n    \"flex items-center gap-3 px-3 py-2.5 transition-colors\",\n    isMissing \n      ? \"opacity-60 bg-secondary/20\" \n      : \"hover:bg-secondary/50\"\n  )}\u003e\n    {/* Icon with warning indicator */}\n    \u003cdiv className=\"relative\"\u003e\n      \u003cdiv className={cn(\n        \"flex items-center justify-center w-8 h-8 rounded-md\",\n        isMissing ? \"bg-warning/10\" : \"bg-secondary\"\n      )}\u003e\n        \u003cFolder className={cn(\n          \"h-4 w-4\",\n          isMissing ? \"text-warning\" : \"text-muted-foreground\"\n        )} /\u003e\n      \u003c/div\u003e\n      {isMissing \u0026\u0026 (\n        \u003cAlertTriangle className=\"h-3 w-3 text-warning absolute -top-1 -right-1\" /\u003e\n      )}\n    \u003c/div\u003e\n    \n    \u003cdiv className=\"flex-1 min-w-0\"\u003e\n      \u003cdiv className=\"flex items-center gap-2\"\u003e\n        \u003cspan className={cn(\"font-medium text-sm\", isMissing \u0026\u0026 \"text-muted-foreground\")}\u003e\n          {project.displayName}\n        \u003c/span\u003e\n        {isMissing \u0026\u0026 (\n          \u003cspan className=\"text-xs px-1.5 py-0.5 rounded bg-warning/10 text-warning\"\u003e\n            Missing\n          \u003c/span\u003e\n        )}\n      \u003c/div\u003e\n      \u003cp className=\"text-xs text-muted-foreground font-mono truncate\"\u003e\n        {project.displayPath}\n      \u003c/p\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n);\n```\n\n## Click Behavior for Missing Projects\nMissing projects do NOT navigate to `/project/[id]`. The content is not wrapped in a Link:\n\n```typescript\n// In ProjectCard - already handled via conditional Link in Task 8\n{isMissing ? (\n  \u003cdiv className=\"flex items-center gap-3 flex-1 min-w-0 cursor-default\"\u003e\n    {/* content */}\n  \u003c/div\u003e\n) : (\n  \u003cLink href={`/project/${project.id}`} className=\"...\"\u003e\n    {/* content */}\n  \u003c/Link\u003e\n)}\n```\n\n## Menu Updates for Missing Projects\nThe \"Relocate\" option is shown for missing projects (already stubbed in Task 8):\n\n```typescript\n{isMissing \u0026\u0026 onRelocate \u0026\u0026 (\n  \u003cDropdownMenuItem onClick={onRelocate} className=\"font-medium\"\u003e\n    \u003cFolderSearch className=\"h-4 w-4 mr-2\" /\u003e\n    Relocate\n  \u003c/DropdownMenuItem\u003e\n)}\n```\n\n## Relocate Using FolderBrowserModal\nReuse FolderBrowserModal in \"relocate\" mode:\n\n```typescript\n// In page.tsx\nconst [relocatingProject, setRelocatingProject] = useState\u003cProject | null\u003e(null);\n\n{projects.map((project) =\u003e (\n  \u003cProjectCard\n    project={project}\n    onEdit={() =\u003e setEditingProject(project)}\n    onRemove={() =\u003e deleteProject.mutate(project.id)}\n    onRelocate={project.status === \"missing\" \n      ? () =\u003e setRelocatingProject(project) \n      : undefined}\n  /\u003e\n))}\n\n// FolderBrowserModal for relocation\n\u003cFolderBrowserModal\n  open={!!relocatingProject}\n  onOpenChange={(open) =\u003e !open \u0026\u0026 setRelocatingProject(null)}\n  mode=\"relocate\"\n  projectToRelocate={relocatingProject ?? undefined}\n  initialPath={getRelocateInitialPath(relocatingProject)}\n/\u003e\n```\n\n## getRelocateInitialPath Helper\nUse configService.getParentPath() with fallback chain:\n```typescript\nfunction getRelocateInitialPath(project: Project | null): string | undefined {\n  if (!project) return undefined;\n  \n  // Try parent of old path, then ~/dev, then ~ \n  // This is handled server-side by the browse API default\n  // Just pass the parent path, API will handle fallbacks\n  const parts = project.path.split('/');\n  parts.pop();\n  return parts.join('/') || undefined;\n}\n```\n\nNote: If the parent path doesn't exist, the filesystem browse API will fall back to ~/dev or ~.\n\n## Relocate Mode in FolderBrowserModal\n(Specified in Task 6, but summarized here for context)\n\nWhen `mode=\"relocate\"`:\n- Title: \"Relocate Project\"\n- Shows old path context with warning banner:\n```typescript\n{projectToRelocate \u0026\u0026 (\n  \u003cdiv className=\"px-4 py-3 bg-warning/10 border-b\"\u003e\n    \u003cdiv className=\"flex items-center gap-2 text-sm\"\u003e\n      \u003cAlertTriangle className=\"h-4 w-4 text-warning\" /\u003e\n      \u003cspan\u003eCurrent path (missing):\u003c/span\u003e\n    \u003c/div\u003e\n    \u003cp className=\"text-sm font-mono mt-1\"\u003e{projectToRelocate.displayPath}\u003c/p\u003e\n  \u003c/div\u003e\n)}\n```\n- No name input\n- Button: \"Update Location\"\n- Calls PATCH with new path\n\n## Acceptance Criteria\n- [ ] Missing projects have dimmed/muted styling (opacity-60, bg-secondary/20)\n- [ ] Warning icon overlay on folder icon for missing projects\n- [ ] \"Missing\" badge next to project name\n- [ ] Click on missing project does NOT navigate\n- [ ] Menu shows \"Relocate\" as first option for missing projects\n- [ ] Relocate opens FolderBrowserModal in relocate mode\n- [ ] Modal shows old path context with warning styling\n- [ ] Modal starts navigated to parent of old path (or fallback)\n- [ ] Can navigate and select new location\n- [ ] \"Update Location\" calls PATCH API with new path\n- [ ] Project becomes active after successful relocate\n- [ ] Error messages shown inline in modal\n\n## Files\n- `src/components/project-card/ProjectCard.tsx` (update with full missing styling)\n- `src/app/page.tsx` (integrate relocate state and modal)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T08:16:38.407937-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Wired up relocate flow in page.tsx with getRelocateInitialPath helper, relocatingProject state, onRelocate callback for missing projects, and FolderBrowserModal in relocate mode. Build passes.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.31","title":"10. Sidebar: API Integration and Add Project Button","description":"## Purpose\nUpdate the sidebar to fetch projects from the API instead of mock data, and wire the \"+\" button to open the folder browser modal.\n\n## Current State\n```typescript\n// In sidebar.tsx\nimport { mockProjects } from \"@/lib/data/mock\";\n// Uses mockProjects.map(...)\n```\n\n## Target State\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\nimport { FolderBrowserModal } from \"@/components/folder-browser\";\n\nexport function Sidebar() {\n  const { data: projects, isLoading } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  // ...\n}\n```\n\n## Sidebar Structure\n```\n┌─────────────────────────────────────┐\n│  ⚡ Maestro                         │\n├─────────────────────────────────────┤\n│  [🔍 Search...]                     │\n├─────────────────────────────────────┤\n│  PROJECTS                       [+] │  \u003c- Wire this button\n│  ▶ my-project                       │\n│  ▶ another-project                  │\n│  ▶ old-project          ⚠️         │  \u003c- Missing indicator\n├─────────────────────────────────────┤\n│  ...                                │\n└─────────────────────────────────────┘\n```\n\n## Changes Required\n\n### 1. Import and use hooks\n```typescript\nimport { useProjects } from \"@/lib/hooks/useProjects\";\nimport { FolderBrowserModal } from \"@/components/folder-browser\";\n\nexport function Sidebar() {\n  const { data: projects, isLoading } = useProjects();\n  const [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n  // ...\n}\n```\n\n### 2. Update project rendering\n```typescript\n{isLoading ? (\n  \u003cdiv className=\"px-4 py-2 text-xs text-muted-foreground\"\u003e\n    Loading...\n  \u003c/div\u003e\n) : projects?.length ? (\n  projects.map((project) =\u003e {\n    const isMissing = project.status === \"missing\";\n    return (\n      \u003cTreeItem\n        key={project.id}\n        icon={\u003cFolder className={cn(\"h-4 w-4\", isMissing \u0026\u0026 \"text-warning\")} /\u003e}\n        label={project.displayName}\n        href={isMissing ? undefined : `/project/${project.id}`}\n        statusIndicator={isMissing ? \"warning\" : undefined}\n      /\u003e\n    );\n  })\n) : (\n  \u003cdiv className=\"px-4 py-2 text-xs text-muted-foreground\"\u003e\n    No projects\n  \u003c/div\u003e\n)}\n```\n\n### 3. Update TreeItem to handle undefined href\nThe TreeItem component needs to gracefully handle `href={undefined}`:\n```typescript\n// In TreeItem component\n{href ? (\n  \u003cLink href={href}\u003e{content}\u003c/Link\u003e\n) : (\n  \u003cdiv className=\"cursor-default\"\u003e{content}\u003c/div\u003e\n)}\n```\n\n### 4. Wire \"+\" button\n```typescript\nconst [folderBrowserOpen, setFolderBrowserOpen] = useState(false);\n\n// In the Projects header\n\u003cdiv className=\"flex items-center justify-between px-2 py-1\"\u003e\n  \u003cspan className=\"text-xs font-medium text-muted-foreground uppercase tracking-wider\"\u003e\n    Projects\n  \u003c/span\u003e\n  \u003cbutton \n    onClick={() =\u003e setFolderBrowserOpen(true)}\n    className=\"h-5 w-5 rounded hover:bg-secondary flex items-center justify-center\"\n    aria-label=\"Add project\"\n  \u003e\n    \u003cPlus className=\"h-3 w-3 text-muted-foreground\" /\u003e\n  \u003c/button\u003e\n\u003c/div\u003e\n\n// At end of sidebar component, inside the return\n\u003cFolderBrowserModal \n  open={folderBrowserOpen} \n  onOpenChange={setFolderBrowserOpen}\n/\u003e\n```\n\n### 5. Show missing projects with warning\nMissing projects are visible in sidebar with warning indicator so users know to fix them:\n```typescript\nstatusIndicator={isMissing ? \"warning\" : undefined}\n```\n\nThe existing TreeItem component already supports `statusIndicator=\"warning\"`.\n\n## Multiple Modal Instances\nThe sidebar renders its own FolderBrowserModal instance, separate from the page's modal. This is acceptable because:\n- Only one modal is open at a time (user can only click one button)\n- They share the same React Query cache\n- Updates reflect everywhere immediately via cache invalidation\n\nIf we wanted to ensure exactly one modal instance, we could lift state to a context provider. But for v1, separate instances work fine.\n\n## Epics and Sessions\nThe sidebar shows epics/sessions for the current project. These still use mock data (separate feature). This task only updates the **project list** portion of the sidebar.\n\n## Acceptance Criteria\n- [ ] Fetches projects from API using useProjects hook\n- [ ] Shows \"Loading...\" text while fetching\n- [ ] Shows \"No projects\" when empty\n- [ ] Renders projects with displayName\n- [ ] Missing projects show warning indicator\n- [ ] Missing projects are not clickable (no navigation)\n- [ ] TreeItem handles href={undefined} gracefully\n- [ ] \"+\" button opens folder browser modal\n- [ ] Can add project from sidebar\n- [ ] Project list updates after adding\n- [ ] Remove mockProjects import\n- [ ] Button has aria-label=\"Add project\" for accessibility\n\n## Files\n- `src/components/ui/sidebar.tsx` (update)","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T08:17:01.971053-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Completed: Updated sidebar to use useProjects hook, added loading/empty states, wired + button to FolderBrowserModal, missing projects show warning indicator and are not clickable. Kept mockEpics/mockSoloSessions for epic/session features.","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32","title":"Integrate AI Elements into Chat Interface","description":"## Overview\n\nIntegrate Vercel's AI Elements component library into Maestro's chat interface to provide a polished, modern AI chat experience with proper message rendering, markdown support, code blocks, and rich input controls.\n\n## Background\n\nAI Elements (https://ai-sdk.dev/elements) is a component library built on shadcn/ui that provides pre-built, customizable React components specifically designed for AI applications. Key features:\n- Professional message rendering with markdown support\n- Syntax-highlighted code blocks\n- Collapsible reasoning/thinking displays\n- Source citations\n- Rich prompt input with model selection and attachments\n- Copy/regenerate message actions\n\n## Current State\n\nThe Issue Discussion page (`src/app/project/[id]/issue/[issueNumber]/page.tsx`) has:\n- Custom chat implementation with manual SSE streaming\n- Basic message bubbles (user/assistant distinction)\n- Works with OpenCode SDK backend via custom API routes\n- Session management with auto-reconnection\n- ~773 lines of code mixing UI and logic\n\n## Integration Strategy\n\nSince AI Elements components are installed as source code (not library imports), we can adapt them to work with our existing OpenCode backend rather than requiring Vercel AI SDK's `useChat` hook.\n\n**Approach:**\n1. Install AI Elements components into the project\n2. Create adapter layer that bridges OpenCode SDK streaming to component props\n3. Progressively replace custom message rendering with AI Elements components\n4. Enhance input experience with PromptInput component\n5. Add markdown rendering and code block support to messages\n\n## Key Technical Considerations\n\n1. **Backend Compatibility**: Keep existing OpenCode SDK integration, adapt frontend only\n2. **Streaming Format**: Current SSE `data: {\"delta\": \"...\"}` format needs to feed into component state\n3. **Message Parts**: AI Elements uses `parts` array for messages (text, reasoning, sources), adapt our flat `content` string\n4. **Styling**: AI Elements uses Tailwind CSS 4 and CSS variables - verify compatibility\n\n## Dependencies\n\n- AI Elements CLI (`npx ai-elements@latest`)\n- shadcn/ui already installed in project\n- React 19 (already using)\n- Tailwind CSS 4 (already using)\n\n## Out of Scope\n\n- Changing the OpenCode backend integration\n- Adding new AI features (reasoning, sources) - just UI preparation\n- Modifying the session/chat API routes","status":"tombstone","priority":1,"issue_type":"epic","created_at":"2025-12-30T12:18:06.495285-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:57.165223-06:00","close_reason":"Completed","dependencies":[{"issue_id":"maestro-slm.32","depends_on_id":"maestro-slm","type":"parent-child","created_at":"2025-12-30T12:18:06.495838-06:00","created_by":"daemon"}],"deleted_at":"2025-12-31T08:43:57.165223-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"maestro-slm.32.1","title":"Install AI Elements components via CLI","description":"## Task\n\nRun the AI Elements CLI to install all components into the project.\n\n## Why\n\nAI Elements components are installed as source code into `@/components/ai-elements/`. This is the foundation for all subsequent UI work. Components are fully customizable once installed.\n\n## Implementation\n\n```bash\nnpx ai-elements@latest\n```\n\nThis will:\n1. Detect existing shadcn/ui configuration\n2. Install all AI Elements components to `src/components/ai-elements/`\n3. Add any missing shadcn/ui dependencies\n\n## Components to Verify After Installation\n\nKey components we'll use:\n- `message.tsx` - Message container and content\n- `conversation.tsx` - Conversation wrapper\n- `prompt-input.tsx` - Rich input component\n- `code-block.tsx` - Syntax-highlighted code\n- `loader.tsx` - Loading states\n\nOptional components for future use:\n- `reasoning.tsx` - For AI thinking/reasoning display\n- `sources.tsx` - For citations\n- `message-actions.tsx` - Copy/regenerate buttons\n\n## Files Created\n\nAfter installation, verify these exist:\n- `src/components/ai-elements/message.tsx`\n- `src/components/ai-elements/conversation.tsx`\n- `src/components/ai-elements/prompt-input.tsx`\n- `src/components/ai-elements/code-block.tsx`\n- `src/components/ai-elements/loader.tsx`\n\n## Potential Issues\n\n1. **Tailwind CSS 4 compatibility** - AI Elements targets Tailwind 4, we're using it\n2. **React 19** - AI Elements uses React 19 (no forwardRef), we're on React 19\n3. **shadcn component conflicts** - May need to update existing components\n\n## Acceptance Criteria\n\n- [ ] AI Elements CLI runs successfully\n- [ ] Components installed to `src/components/ai-elements/`\n- [ ] No TypeScript errors in installed components\n- [ ] `bun run build` still succeeds","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T12:18:17.81655-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"AI Elements CLI installed successfully. 30 components added to src/components/ai-elements/. Added CardAction export to card.tsx. Build passes.","dependencies":[{"issue_id":"maestro-slm.32.1","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:18:17.819276-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.10","title":"Add dependencies between AI Elements integration tasks","description":"## Task\n\nSet up the dependency graph between the AI Elements integration tasks to ensure proper execution order.\n\n## Dependencies to Add\n\n1. **[deleted:[deleted:maestro-slm].32].1** (Install AI Elements) - No dependencies, can start immediately\n\n2. **[deleted:[deleted:maestro-slm].32].2** (Type adapter) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].1 (need components installed to understand types)\n\n3. **[deleted:[deleted:maestro-slm].32].3** (Replace message rendering) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].1 (need Message component)\n   - [deleted:[deleted:maestro-slm].32].2 (need type adapter)\n\n4. **[deleted:[deleted:maestro-slm].32].4** (Conversation wrapper) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].3 (need messages converted first)\n\n5. **[deleted:[deleted:maestro-slm].32].5** (Loader component) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].1 (need Loader component)\n\n6. **[deleted:[deleted:maestro-slm].32].6** (Markdown rendering) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].3 (need messages using AI Elements)\n\n7. **[deleted:[deleted:maestro-slm].32].7** (Message actions) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].3 (need Message component in use)\n\n8. **[deleted:[deleted:maestro-slm].32].8** (PromptInput) - Depends on:\n   - [deleted:[deleted:maestro-slm].32].1 (need PromptInput component)\n\n9. **[deleted:[deleted:maestro-slm].32].9** (Extract hook) - No strict deps, can parallel\n\n## Commands\n\n```bash\n# Type adapter depends on install\nbd dep add [deleted:[deleted:maestro-slm].32].2 [deleted:[deleted:maestro-slm].32].1\n\n# Message rendering depends on install and adapter\nbd dep add [deleted:[deleted:maestro-slm].32].3 [deleted:[deleted:maestro-slm].32].1\nbd dep add [deleted:[deleted:maestro-slm].32].3 [deleted:[deleted:maestro-slm].32].2\n\n# Conversation depends on message rendering\nbd dep add [deleted:[deleted:maestro-slm].32].4 [deleted:[deleted:maestro-slm].32].3\n\n# Loader depends on install\nbd dep add [deleted:[deleted:maestro-slm].32].5 [deleted:[deleted:maestro-slm].32].1\n\n# Markdown depends on message rendering\nbd dep add [deleted:[deleted:maestro-slm].32].6 [deleted:[deleted:maestro-slm].32].3\n\n# Actions depends on message rendering\nbd dep add [deleted:[deleted:maestro-slm].32].7 [deleted:[deleted:maestro-slm].32].3\n\n# PromptInput depends on install\nbd dep add [deleted:[deleted:maestro-slm].32].8 [deleted:[deleted:maestro-slm].32].1\n```\n\n## Execution Order\n\nBased on dependencies, recommended order:\n1. Install AI Elements (.32.1) ← START HERE\n2. Type adapter (.32.2) + Loader (.32.5) + PromptInput (.32.8) + Hook (.32.9) - can parallel\n3. Message rendering (.32.3)\n4. Conversation (.32.4) + Markdown (.32.6) + Actions (.32.7) - can parallel","status":"tombstone","priority":2,"issue_type":"chore","created_at":"2025-12-30T12:20:10.640538-06:00","created_by":"erikjohansson","updated_at":"2025-12-31T08:43:03.137774-06:00","close_reason":"Dependencies configured between all AI Elements integration tasks","dependencies":[{"issue_id":"maestro-slm.32.10","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:20:10.643401-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"chore"}
{"id":"maestro-slm.32.2","title":"Create ChatMessage type adapter for AI Elements","description":"## Task\n\nCreate a type adapter that converts our current `ChatMessage` interface to the format AI Elements expects.\n\n## Why\n\nAI Elements components use a `parts` array structure for messages, while our current implementation uses a flat `content` string. We need an adapter layer to bridge this gap without changing our backend.\n\n## Current Message Type\n\n```typescript\ninterface ChatMessage {\n  id: string;\n  role: \"user\" | \"assistant\";\n  content: string;\n  timestamp: string;\n}\n```\n\n## AI Elements Message Type\n\nAI Elements expects messages with a `parts` array:\n```typescript\ninterface AIMessage {\n  id: string;\n  role: \"user\" | \"assistant\";\n  parts: MessagePart[];\n}\n\ntype MessagePart = \n  | { type: \"text\"; text: string }\n  | { type: \"reasoning\"; text: string }\n  | { type: \"source-url\"; url: string };\n```\n\n## Implementation\n\nCreate `src/lib/utils/message-adapter.ts`:\n\n```typescript\nimport type { ChatMessage } from \"@/app/project/[id]/issue/[issueNumber]/page\";\n\nexport interface AIElementsMessage {\n  id: string;\n  role: \"user\" | \"assistant\";\n  parts: Array\u003c{ type: \"text\"; text: string }\u003e;\n}\n\nexport function toAIElementsMessage(msg: ChatMessage): AIElementsMessage {\n  return {\n    id: msg.id,\n    role: msg.role,\n    parts: [{ type: \"text\", text: msg.content }],\n  };\n}\n\nexport function toAIElementsMessages(messages: ChatMessage[]): AIElementsMessage[] {\n  return messages.map(toAIElementsMessage);\n}\n```\n\n## Future Extension Points\n\nThe adapter is designed to be extended when we add:\n- Reasoning/thinking support (parse special markers in content)\n- Source citations (extract URLs from content)\n- Code blocks (parse markdown code fences)\n\n## Files to Create\n\n- `src/lib/utils/message-adapter.ts`\n\n## Acceptance Criteria\n\n- [ ] Type adapter created with proper TypeScript types\n- [ ] Converts flat content to parts array\n- [ ] Helper functions for single and batch conversion\n- [ ] Export types for use in components","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T12:18:35.216756-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Created message-adapter.ts with toAIElementsMessage and toAIElementsMessages functions. Type-safe conversion from ChatMessage to AI Elements parts format.","dependencies":[{"issue_id":"maestro-slm.32.2","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:18:35.217424-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.2","depends_on_id":"maestro-slm.32.1","type":"blocks","created_at":"2025-12-30T12:20:16.385917-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.3","title":"Replace message rendering with AI Elements Message component","description":"## Task\n\nReplace the custom message rendering in the Issue View page with AI Elements' Message component.\n\n## Why\n\nAI Elements provides professional message rendering with:\n- Proper avatar/role indicators\n- Better visual hierarchy\n- Extensible structure for future features (actions, reasoning)\n- Consistent styling with other AI apps\n\n## Current Implementation\n\n```tsx\n// In page.tsx lines ~648-672\nmessages.map((msg) =\u003e (\n  \u003cdiv\n    key={msg.id}\n    className={`flex ${msg.role === \"user\" ? \"justify-end\" : \"justify-start\"}`}\n  \u003e\n    \u003cdiv className={`max-w-[85%] ${msg.role === \"user\" ? \"order-1\" : \"\"}`}\u003e\n      \u003cdiv\n        className={`rounded-md px-3 py-2 text-sm ${\n          msg.role === \"user\"\n            ? \"bg-primary text-primary-foreground\"\n            : \"bg-secondary\"\n        }`}\n      \u003e\n        \u003cp className=\"whitespace-pre-wrap\"\u003e{msg.content}\u003c/p\u003e\n      \u003c/div\u003e\n      \u003cp className={`text-[10px] text-muted-foreground mt-1...`}\u003e\n        {msg.timestamp}\n      \u003c/p\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n))\n```\n\n## New Implementation\n\n```tsx\nimport {\n  Message,\n  MessageContent,\n  MessageResponse,\n} from \"@/components/ai-elements/message\";\nimport { toAIElementsMessages } from \"@/lib/utils/message-adapter\";\n\n// In render:\n{toAIElementsMessages(messages).map((message) =\u003e (\n  \u003cMessage key={message.id} from={message.role}\u003e\n    \u003cMessageContent\u003e\n      {message.parts.map((part, i) =\u003e {\n        if (part.type === \"text\") {\n          return \u003cMessageResponse key={i}\u003e{part.text}\u003c/MessageResponse\u003e;\n        }\n        return null;\n      })}\n    \u003c/MessageContent\u003e\n  \u003c/Message\u003e\n))}\n```\n\n## Styling Considerations\n\nAI Elements uses Tailwind classes that should match our existing theme:\n- May need to adjust colors/spacing in message.tsx\n- User messages should use primary color\n- Assistant messages should use secondary background\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Task: Install AI Elements components\n- Task: Create ChatMessage type adapter\n\n## Acceptance Criteria\n\n- [ ] Messages render using AI Elements components\n- [ ] User/assistant distinction maintained\n- [ ] Timestamps still displayed\n- [ ] Streaming still works (empty content shows loader)\n- [ ] Visual appearance is consistent or improved","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T12:18:45.210534-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Replaced message rendering with AI Elements Message/MessageContent/MessageResponse components. User messages styled with primary color override. Timestamps preserved.","dependencies":[{"issue_id":"maestro-slm.32.3","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:18:45.2141-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.3","depends_on_id":"maestro-slm.32.1","type":"blocks","created_at":"2025-12-30T12:20:16.420378-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.3","depends_on_id":"maestro-slm.32.2","type":"blocks","created_at":"2025-12-30T12:20:16.454153-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.4","title":"Add Conversation wrapper component to chat panel","description":"## Task\n\nWrap the messages area with AI Elements' Conversation component to get proper scrolling behavior and layout.\n\n## Why\n\nThe Conversation component provides:\n- Auto-scroll to bottom on new messages\n- Scroll-to-bottom button when scrolled up\n- Proper overflow handling\n- Consistent structure for chat UIs\n\n## Current Implementation\n\n```tsx\n// In page.tsx\n\u003cdiv className=\"flex-1 overflow-y-auto\"\u003e\n  \u003cdiv className=\"max-w-3xl mx-auto p-4 space-y-4\"\u003e\n    {/* messages */}\n    \u003cdiv ref={messagesEndRef} /\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\nWe have manual scroll-to-bottom via ref and useEffect.\n\n## New Implementation\n\n```tsx\nimport {\n  Conversation,\n  ConversationContent,\n  ConversationScrollButton,\n} from \"@/components/ai-elements/conversation\";\n\n// In render:\n\u003cConversation className=\"flex-1\"\u003e\n  \u003cConversationContent\u003e\n    {/* AI Elements Message components */}\n  \u003c/ConversationContent\u003e\n  \u003cConversationScrollButton /\u003e\n\u003c/Conversation\u003e\n```\n\n## Benefits\n\n1. **ConversationScrollButton** - Shows \"scroll to bottom\" button when user scrolls up\n2. **Auto-scroll** - Handles scroll-to-bottom automatically\n3. **Cleaner code** - Remove manual scrollToBottom useEffect and ref\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Task: Install AI Elements components\n- Task: Replace message rendering with AI Elements Message\n\n## Acceptance Criteria\n\n- [ ] Chat wrapped in Conversation component\n- [ ] Scroll-to-bottom button appears when scrolled up\n- [ ] Auto-scroll on new messages works\n- [ ] Can remove manual scrollToBottom logic\n- [ ] Messages area maintains proper height/overflow","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T12:18:56.143777-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Wrapped chat with Conversation/ConversationContent/ConversationScrollButton. Auto-scroll built-in, removed manual scroll logic.","dependencies":[{"issue_id":"maestro-slm.32.4","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:18:56.146158-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.4","depends_on_id":"maestro-slm.32.3","type":"blocks","created_at":"2025-12-30T12:20:16.487213-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.5","title":"Replace loader with AI Elements Loader component","description":"## Task\n\nReplace the custom typing indicator (bouncing dots) with AI Elements' Loader component.\n\n## Why\n\nConsistency with AI Elements design language and potentially better animations/states.\n\n## Current Implementation\n\n```tsx\n// In page.tsx lines ~675-685\n{isStreaming \u0026\u0026 messages[messages.length - 1]?.content === \"\" \u0026\u0026 (\n  \u003cdiv className=\"flex justify-start\"\u003e\n    \u003cdiv className=\"bg-secondary rounded-md px-3 py-2\"\u003e\n      \u003cdiv className=\"flex gap-1 items-center\"\u003e\n        \u003cspan className=\"w-2 h-2 bg-muted-foreground rounded-full animate-bounce\" style={{ animationDelay: \"0ms\" }} /\u003e\n        \u003cspan className=\"w-2 h-2 bg-muted-foreground rounded-full animate-bounce\" style={{ animationDelay: \"150ms\" }} /\u003e\n        \u003cspan className=\"w-2 h-2 bg-muted-foreground rounded-full animate-bounce\" style={{ animationDelay: \"300ms\" }} /\u003e\n      \u003c/div\u003e\n    \u003c/div\u003e\n  \u003c/div\u003e\n)}\n```\n\n## New Implementation\n\n```tsx\nimport { Loader } from \"@/components/ai-elements/loader\";\n\n// In render:\n{isStreaming \u0026\u0026 messages[messages.length - 1]?.content === \"\" \u0026\u0026 (\n  \u003cLoader /\u003e\n)}\n```\n\n## Considerations\n\n- Check if Loader component matches our visual style\n- May need to customize the loader in `src/components/ai-elements/loader.tsx`\n- Ensure it integrates well within the Conversation/Message structure\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Task: Install AI Elements components\n\n## Acceptance Criteria\n\n- [ ] Typing indicator uses AI Elements Loader\n- [ ] Shows at correct times (streaming with empty content)\n- [ ] Visually consistent with rest of chat","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T12:19:03.157102-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Replaced bouncing dots with AI Elements Loader component. Both typing indicator and initial loading use Loader with size=20.","dependencies":[{"issue_id":"maestro-slm.32.5","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:19:03.159442-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.5","depends_on_id":"maestro-slm.32.1","type":"blocks","created_at":"2025-12-30T12:20:16.520277-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.6","title":"Add markdown rendering to message responses","description":"## Task\n\nEnable markdown rendering in AI responses using either AI Elements' built-in markdown support or integrating with our existing react-markdown setup.\n\n## Why\n\nAI responses frequently contain:\n- Code snippets with syntax highlighting\n- Lists and bullet points\n- Headers for organization\n- Links to documentation\n- Tables\n\nCurrently we just render plain text with `whitespace-pre-wrap`, losing all formatting.\n\n## Options\n\n### Option A: Use AI Elements CodeBlock for code\nAI Elements has a `code-block` component for syntax-highlighted code. We can:\n1. Parse markdown in content to find code blocks\n2. Render regular text with MessageResponse\n3. Render code blocks with CodeBlock component\n\n### Option B: Use react-markdown (already installed)\nWe already have `react-markdown` and `remark-gfm` installed (used in issue body rendering). We can wrap the response content with ReactMarkdown:\n\n```tsx\nimport ReactMarkdown from \"react-markdown\";\nimport remarkGfm from \"remark-gfm\";\n\n\u003cMessageResponse\u003e\n  \u003cReactMarkdown remarkPlugins={[remarkGfm]}\u003e\n    {part.text}\n  \u003c/ReactMarkdown\u003e\n\u003c/MessageResponse\u003e\n```\n\n### Recommended: Option B with AI Elements code-block\n\nCombine both approaches:\n1. Use ReactMarkdown for general markdown\n2. Override the `code` component to use AI Elements CodeBlock\n\n```tsx\nimport { CodeBlock } from \"@/components/ai-elements/code-block\";\n\nconst markdownComponents = {\n  code: ({ inline, className, children }) =\u003e {\n    if (inline) {\n      return \u003ccode className=\"...\"\u003e{children}\u003c/code\u003e;\n    }\n    const language = className?.replace(\"language-\", \"\") || \"text\";\n    return \u003cCodeBlock language={language}\u003e{String(children)}\u003c/CodeBlock\u003e;\n  }\n};\n\n\u003cReactMarkdown \n  remarkPlugins={[remarkGfm]}\n  components={markdownComponents}\n\u003e\n  {part.text}\n\u003c/ReactMarkdown\u003e\n```\n\n## Styling\n\nReuse the prose classes from issue body rendering:\n```\nprose prose-sm dark:prose-invert max-w-none\n```\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n- Potentially create `src/components/chat/MarkdownMessage.tsx`\n\n## Dependencies\n\n- Task: Install AI Elements components\n- Task: Replace message rendering with AI Elements Message\n\n## Acceptance Criteria\n\n- [ ] Markdown in AI responses renders correctly\n- [ ] Code blocks have syntax highlighting\n- [ ] Lists, headers, links render properly\n- [ ] Inline code styled appropriately\n- [ ] Tables render (GFM support)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T12:19:18.142616-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Markdown already handled by Streamdown in MessageResponse. Added @source directive to globals.css for proper styling.","dependencies":[{"issue_id":"maestro-slm.32.6","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:19:18.145086-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.6","depends_on_id":"maestro-slm.32.3","type":"blocks","created_at":"2025-12-30T12:20:16.553232-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.7","title":"Add MessageActions with copy button","description":"## Task\n\nAdd copy and regenerate actions to assistant messages using AI Elements MessageActions component.\n\n## Why\n\nUsers frequently want to:\n- Copy AI responses (especially code snippets)\n- Regenerate a response if unsatisfied\n\nThese are standard features in modern AI chat interfaces (ChatGPT, Claude, etc.).\n\n## Implementation\n\n```tsx\nimport {\n  Message,\n  MessageContent,\n  MessageResponse,\n  MessageActions,\n  MessageAction,\n} from \"@/components/ai-elements/message\";\nimport { CopyIcon, RefreshCcwIcon } from \"lucide-react\";\n\n// In message rendering:\n\u003cMessage from={message.role}\u003e\n  \u003cMessageContent\u003e\n    \u003cMessageResponse\u003e{part.text}\u003c/MessageResponse\u003e\n  \u003c/MessageContent\u003e\n  {message.role === \"assistant\" \u0026\u0026 (\n    \u003cMessageActions\u003e\n      \u003cMessageAction\n        onClick={() =\u003e navigator.clipboard.writeText(part.text)}\n        label=\"Copy\"\n      \u003e\n        \u003cCopyIcon className=\"size-3\" /\u003e\n      \u003c/MessageAction\u003e\n      \u003cMessageAction\n        onClick={() =\u003e handleRegenerate(message.id)}\n        label=\"Retry\"\n      \u003e\n        \u003cRefreshCcwIcon className=\"size-3\" /\u003e\n      \u003c/MessageAction\u003e\n    \u003c/MessageActions\u003e\n  )}\n\u003c/Message\u003e\n```\n\n## Regenerate Functionality\n\nFor regenerate, we need to:\n1. Remove the last assistant message\n2. Resend the last user message\n3. This may require storing the user message that triggered each response\n\n**Note**: Regenerate can be deferred if complex. Copy is the priority.\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Task: Install AI Elements components\n- Task: Replace message rendering with AI Elements Message\n\n## Acceptance Criteria\n\n- [ ] Copy button appears on assistant messages\n- [ ] Clicking copy copies message content to clipboard\n- [ ] Visual feedback on copy (toast or icon change)\n- [ ] (Optional) Regenerate button triggers message resend","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T12:19:26.309911-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Added copy button to assistant messages with visual feedback (icon changes to checkmark for 2s).","dependencies":[{"issue_id":"maestro-slm.32.7","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:19:26.312923-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.7","depends_on_id":"maestro-slm.32.3","type":"blocks","created_at":"2025-12-30T12:20:16.587064-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.8","title":"Upgrade input to AI Elements PromptInput component","description":"## Task\n\nReplace the basic text input with AI Elements' PromptInput component for a richer input experience.\n\n## Why\n\nPromptInput provides:\n- Better visual design matching modern AI interfaces\n- Expandable textarea for longer prompts\n- Framework for future features (attachments, model selection)\n- Consistent styling with Message components\n\n## Current Implementation\n\n```tsx\n// In page.tsx lines ~721-745\n\u003cdiv className=\"border-t border-border bg-card px-4 py-3\"\u003e\n  \u003cdiv className=\"max-w-3xl mx-auto flex gap-2\"\u003e\n    \u003cinput\n      type=\"text\"\n      value={message}\n      onChange={(e) =\u003e setMessage(e.target.value)}\n      onKeyDown={(e) =\u003e e.key === \"Enter\" \u0026\u0026 !e.shiftKey \u0026\u0026 handleSend()}\n      placeholder=\"Ask the agent about this issue...\"\n      className=\"flex-1 h-9 px-3 rounded-md border border-border bg-background text-sm focus-ring disabled:opacity-50\"\n      disabled={isSending || isStreaming}\n    /\u003e\n    \u003cButton variant=\"outline\" onClick={() =\u003e setShowSaveModal(true)} ... /\u003e\n    \u003cButton onClick={handleSend} disabled={!message.trim() || isSending || isStreaming}\u003e\n      \u003cSend className=\"h-4 w-4\" /\u003e\n    \u003c/Button\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n```\n\n## New Implementation\n\n```tsx\nimport {\n  PromptInput,\n  PromptInputBody,\n  PromptInputTextarea,\n  PromptInputFooter,\n  PromptInputSubmit,\n  PromptInputTools,\n  PromptInputButton,\n} from \"@/components/ai-elements/prompt-input\";\nimport { FileText } from \"lucide-react\";\n\nconst handleSubmit = (msg: PromptInputMessage) =\u003e {\n  if (!msg.text?.trim()) return;\n  handleSend(msg.text);\n};\n\n\u003cPromptInput onSubmit={handleSubmit} className=\"border-t bg-card\"\u003e\n  \u003cPromptInputBody\u003e\n    \u003cPromptInputTextarea\n      value={message}\n      onChange={(e) =\u003e setMessage(e.target.value)}\n      placeholder=\"Ask the agent about this issue...\"\n      disabled={isSending || isStreaming}\n    /\u003e\n  \u003c/PromptInputBody\u003e\n  \u003cPromptInputFooter\u003e\n    \u003cPromptInputTools\u003e\n      \u003cPromptInputButton\n        variant=\"ghost\"\n        onClick={() =\u003e setShowSaveModal(true)}\n        disabled={!sessionId || messages.length \u003c 2}\n      \u003e\n        \u003cFileText className=\"h-4 w-4\" /\u003e\n        \u003cspan className=\"hidden sm:inline\"\u003eSave\u003c/span\u003e\n      \u003c/PromptInputButton\u003e\n    \u003c/PromptInputTools\u003e\n    \u003cPromptInputSubmit \n      disabled={!message.trim()} \n      status={isStreaming ? \"streaming\" : isSending ? \"submitted\" : undefined}\n    /\u003e\n  \u003c/PromptInputFooter\u003e\n\u003c/PromptInput\u003e\n```\n\n## Considerations\n\n1. **Enter key behavior**: PromptInput may handle Enter differently, verify\n2. **Status mapping**: Map our isSending/isStreaming to PromptInput's status prop\n3. **Save button placement**: Keep the save summary button accessible\n4. **Max width**: Maintain max-w-3xl constraint for readability\n\n## Files to Modify\n\n- `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- Task: Install AI Elements components\n\n## Acceptance Criteria\n\n- [ ] Input uses PromptInput component\n- [ ] Enter to send still works\n- [ ] Disabled states work correctly\n- [ ] Save summary button still accessible\n- [ ] Looks polished and consistent","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T12:19:42.856953-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Upgraded to PromptInput component. Auto-expanding textarea, status-aware submit button, and PromptInputButton for Save Summary.","dependencies":[{"issue_id":"maestro-slm.32.8","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:19:42.859172-06:00","created_by":"daemon"},{"issue_id":"maestro-slm.32.8","depends_on_id":"maestro-slm.32.1","type":"blocks","created_at":"2025-12-30T12:20:16.620196-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.32.9","title":"Extract chat logic into custom useChatSession hook","description":"## Task\n\nExtract the chat-related state and logic from the Issue View page into a reusable custom hook.\n\n## Why\n\nThe page component is currently ~773 lines with mixed concerns:\n- Issue fetching and display\n- Session management\n- Message state and streaming\n- UI state (tabs, modals, resizing)\n\nExtracting chat logic will:\n1. Make the code more maintainable\n2. Enable reuse in Solo Sessions page\n3. Separate concerns for easier testing\n4. Prepare for potential AI SDK migration\n\n## Current State in page.tsx\n\n```typescript\n// State scattered throughout:\nconst [message, setMessage] = useState(\"\");\nconst [messages, setMessages] = useState\u003cChatMessage[]\u003e([]);\nconst [isSending, setIsSending] = useState(false);\nconst [isStreaming, setIsStreaming] = useState(false);\nconst [sessionId, setSessionId] = useState\u003cstring | null\u003e(null);\nconst [sessionError, setSessionError] = useState\u003cstring | null\u003e(null);\nconst [reconnecting, setReconnecting] = useState(false);\n\n// Functions:\nconst getOrCreateSession = async () =\u003e { ... }\nconst retrySession = async () =\u003e { ... }\nconst handleSend = async () =\u003e { ... }\n```\n\n## New Hook API\n\n```typescript\n// src/lib/hooks/useChatSession.ts\n\ninterface UseChatSessionOptions {\n  projectId: string;\n  issueNumber: string;\n}\n\ninterface UseChatSessionReturn {\n  // State\n  messages: ChatMessage[];\n  input: string;\n  setInput: (value: string) =\u003e void;\n  \n  // Status\n  isLoading: boolean;      // Initial session creation\n  isSending: boolean;      // Message being sent\n  isStreaming: boolean;    // Response streaming\n  isReconnecting: boolean; // Session recovery\n  error: string | null;\n  \n  // Session\n  sessionId: string | null;\n  \n  // Actions\n  sendMessage: () =\u003e Promise\u003cvoid\u003e;\n  retrySession: () =\u003e Promise\u003cvoid\u003e;\n  clearError: () =\u003e void;\n}\n\nexport function useChatSession(options: UseChatSessionOptions): UseChatSessionReturn {\n  // All the chat logic extracted here\n}\n```\n\n## Usage in Page\n\n```tsx\nexport default function IssueViewPage() {\n  const params = useParams();\n  const projectId = params.id as string;\n  const issueNumber = params.issueNumber as string;\n  \n  const chat = useChatSession({ projectId, issueNumber });\n  \n  // ... rest of component uses chat.messages, chat.sendMessage, etc.\n}\n```\n\n## Implementation Notes\n\n1. Move all session/message state into hook\n2. Move getOrCreateSession, handleSend logic\n3. Keep SSE streaming logic in hook\n4. Return clean interface for component\n\n## Files to Create/Modify\n\n- Create: `src/lib/hooks/useChatSession.ts`\n- Modify: `src/app/project/[id]/issue/[issueNumber]/page.tsx`\n\n## Dependencies\n\n- None (can be done in parallel with UI tasks)\n\n## Acceptance Criteria\n\n- [ ] Hook encapsulates all chat state and logic\n- [ ] Page component significantly simplified\n- [ ] All existing functionality preserved\n- [ ] Types exported for reuse\n- [ ] Hook is testable in isolation","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-30T12:19:56.296324-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T21:00:37.505179-06:00","close_reason":"Extracted chat logic to useChatSession hook. Page reduced from 773 to 565 lines (27% reduction). Hook provides clean API with onStreamChunk callback.","dependencies":[{"issue_id":"maestro-slm.32.9","depends_on_id":"maestro-slm.32","type":"parent-child","created_at":"2025-12-30T12:19:56.29856-06:00","created_by":"daemon"}],"deleted_at":"2025-12-30T21:00:37.505179-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.4","title":"1.4 Implement PATCH /api/projects/[id] endpoint","description":"## Purpose\nImplement the `PATCH /api/projects/[id]` endpoint for updating project name or relocating its path.\n\n## Use Cases\n1. **Rename**: User wants to change the display name\n2. **Revert to derived name**: User sets name to null\n3. **Relocate**: Project was moved on disk, user points Maestro to new location\n\n## Request Schema\n```typescript\ninterface UpdateProjectRequest {\n  name?: string | null;  // New display name, null to use derived\n  path?: string;         // New path (for relocation)\n}\n```\n\nAt least one field must be provided.\n\n## Response Schema\nReturns the updated project (same shape as GET response item).\n\n## Error Responses\n| Status | Condition | Response |\n|--------|-----------|----------|\n| 400 | No fields to update | `{ error: \"No fields to update\" }` |\n| 400 | Invalid path (if provided) | `{ error: \"Path is not a directory\" }` |\n| 403 | Path outside home (if provided) | `{ error: \"Path must be within home directory\" }` |\n| 404 | Project ID not found | `{ error: \"Project not found\" }` |\n| 404 | New path doesn't exist | `{ error: \"Path does not exist\" }` |\n| 409 | New path already tracked | `{ error: \"A project with this path already exists\" }` |\n\n## Implementation\n```typescript\n// src/app/api/projects/[id]/route.ts\nimport { NextResponse } from \"next/server\";\nimport { configService } from \"@/lib/services/config\";\nimport fs from \"fs/promises\";\n\nexport async function PATCH(\n  request: Request,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { id } = params;\n    const body = await request.json();\n    const { name, path: newPath } = body;\n    \n    // Check project exists\n    const project = await configService.getProject(id);\n    if (!project) {\n      return NextResponse.json(\n        { error: \"Project not found\" },\n        { status: 404 }\n      );\n    }\n    \n    // Build updates\n    const updates: Partial\u003cProjectConfig\u003e = {};\n    \n    // Handle name update\n    if (\"name\" in body) {\n      // Explicit null or empty string → null (use derived)\n      updates.name = name?.trim() || null;\n    }\n    \n    // Handle path update (relocation)\n    if (newPath) {\n      const absolutePath = configService.toAbsolutePath(newPath.trim());\n      \n      if (!configService.isWithinHome(absolutePath)) {\n        return NextResponse.json(\n          { error: \"Path must be within home directory\" },\n          { status: 403 }\n        );\n      }\n      \n      try {\n        await fs.access(absolutePath);\n      } catch {\n        return NextResponse.json(\n          { error: \"Path does not exist\" },\n          { status: 404 }\n        );\n      }\n      \n      const stat = await fs.stat(absolutePath);\n      if (!stat.isDirectory()) {\n        return NextResponse.json(\n          { error: \"Path is not a directory\" },\n          { status: 400 }\n        );\n      }\n      \n      // Check not duplicate (unless it's the same project)\n      const existing = await configService.getProjects();\n      const duplicate = existing.find(p =\u003e p.path === absolutePath \u0026\u0026 p.id !== id);\n      if (duplicate) {\n        return NextResponse.json(\n          { error: \"A project with this path already exists\" },\n          { status: 409 }\n        );\n      }\n      \n      updates.path = absolutePath;\n    }\n    \n    if (Object.keys(updates).length === 0) {\n      return NextResponse.json(\n        { error: \"No fields to update\" },\n        { status: 400 }\n      );\n    }\n    \n    const updated = await configService.updateProject(id, updates);\n    \n    return NextResponse.json({\n      id: updated.id,\n      path: updated.path,\n      displayPath: configService.toDisplayPath(updated.path),\n      name: updated.name,\n      displayName: updated.name ?? configService.deriveDisplayName(updated.path),\n      addedAt: updated.addedAt,\n      status: \"active\",\n    });\n    \n  } catch (error) {\n    console.error(\"Failed to update project:\", error);\n    return NextResponse.json(\n      { error: \"Failed to update project\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\n## Relocation Workflow\nWhen a project goes missing:\n1. User sees warning in UI\n2. User clicks \"Relocate\"\n3. Folder browser opens (ideally at parent of old path if it exists, else ~/dev)\n4. User selects new location\n5. PATCH request with new path\n6. Project is now tracked at new location with same ID\n\nThe ID stays constant, preserving any bookmarks or links to `/project/[id]`.\n\n## Acceptance Criteria\n- [ ] Can update name only\n- [ ] Can update path only\n- [ ] Can update both name and path\n- [ ] Setting name to null reverts to derived name\n- [ ] Path validation (exists, is directory, in home, not duplicate)\n- [ ] Returns 404 for unknown project ID\n- [ ] Returns 400 when no updates provided\n- [ ] ID and addedAt are preserved on update\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service)\n- **Requires**: Tasks 1.2 \u0026 1.3 (to have projects to update)\n\n## Files\n- `src/app/api/projects/[id]/route.ts` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:02.980937-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into consolidated Projects API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.5","title":"1.5 Implement DELETE /api/projects/[id] endpoint","description":"## Purpose\nImplement the `DELETE /api/projects/[id]` endpoint for removing projects from Maestro's tracking.\n\n## Important: Non-Destructive\nThis endpoint **only removes the project from Maestro's config**. It does NOT:\n- Delete any files on disk\n- Remove git history\n- Affect the project in any way\n\nThis is why no confirmation is required in the UI - it's trivially reversible by re-adding the project.\n\n## Response\n- **204 No Content**: Project successfully removed\n- **404 Not Found**: Project ID doesn't exist (still return 204 for idempotency? Design choice.)\n\nFor simplicity, return 204 even if project doesn't exist. This makes the operation idempotent - calling delete multiple times has the same effect as calling it once.\n\n## Implementation\n```typescript\n// src/app/api/projects/[id]/route.ts (add to existing file)\n\nexport async function DELETE(\n  request: Request,\n  { params }: { params: { id: string } }\n) {\n  try {\n    const { id } = params;\n    \n    await configService.deleteProject(id);\n    \n    return new NextResponse(null, { status: 204 });\n    \n  } catch (error) {\n    console.error(\"Failed to delete project:\", error);\n    return NextResponse.json(\n      { error: \"Failed to delete project\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\nThe `configService.deleteProject(id)` should be idempotent - if project doesn't exist, it simply does nothing.\n\n## Use Cases\n1. **User removes a project they no longer want to track**\n2. **User removes a missing project** (can't relocate, just wants it gone)\n3. **Cleanup after project was deleted from disk** (via terminal, not Maestro)\n\n## Acceptance Criteria\n- [ ] Returns 204 on successful deletion\n- [ ] Returns 204 even if project doesn't exist (idempotent)\n- [ ] Project is removed from config.json\n- [ ] No files are deleted from disk\n- [ ] Returns 500 on unexpected errors (disk full, permissions, etc.)\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service)\n- **Can parallel with**: Task 1.4 (PATCH endpoint)\n\n## Files\n- `src/app/api/projects/[id]/route.ts` (add DELETE handler)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.038099-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into consolidated Projects API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.6","title":"2.1 Implement GET /api/filesystem/browse endpoint","description":"## Purpose\nImplement the `GET /api/filesystem/browse` endpoint for the folder picker UI. This enables users to navigate the server's filesystem to select project directories.\n\n## Why Custom Browsing?\nMaestro runs on the dev machine but is accessed remotely (via Tailscale from phone/tablet). Browser file picker APIs (`\u003cinput type=\"file\"\u003e`) open on the **client** device, not the server. We need a custom API that exposes the server's filesystem in a controlled way.\n\n## Security Constraints\n**Critical**: This endpoint exposes the filesystem. Security measures:\n1. **Home directory only** - Cannot browse outside `~`\n2. **Directories only** - Don't list files (irrelevant for project selection)\n3. **Hidden directories filtered** - No `.git`, `.config`, `.ssh`, etc.\n4. **Permission errors handled gracefully** - Skip unreadable dirs, don't fail\n\n## Query Parameters\n| Param | Required | Default | Description |\n|-------|----------|---------|-------------|\n| `path` | No | `~/dev` or `~` | Directory to list |\n\nIf `path` is not provided:\n- Try `~/dev` first (common convention)\n- Fall back to `~` if `~/dev` doesn't exist\n\n## Response Schema\n```typescript\ninterface BrowseResponse {\n  currentPath: string;    // Absolute: /Users/erik/dev\n  displayPath: string;    // Friendly: ~/dev\n  parent: string | null;  // Parent path, null if at home\n  canGoUp: boolean;       // false if at home directory\n  directories: Directory[];\n}\n\ninterface Directory {\n  name: string;           // Directory name\n  path: string;           // Absolute path\n  isGitRepo: boolean;     // Has .git subdirectory\n}\n```\n\n## Implementation\n```typescript\n// src/app/api/filesystem/browse/route.ts\nimport { NextResponse } from \"next/server\";\nimport { configService } from \"@/lib/services/config\";\nimport fs from \"fs/promises\";\nimport path from \"path\";\n\n// Directories to hide from listing\nconst HIDDEN_PATTERNS = [\n  /^\\./, // Hidden files/dirs (., .git, .config, etc.)\n  /^node_modules$/,\n  /^__pycache__$/,\n  /^\\.cache$/,\n  /^vendor$/,\n  /^\\.venv$/,\n  /^venv$/,\n];\n\nfunction shouldHide(name: string): boolean {\n  return HIDDEN_PATTERNS.some(pattern =\u003e pattern.test(name));\n}\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const homeDir = configService.getHomeDir();\n    \n    // Determine path to browse\n    let browsePath = searchParams.get(\"path\");\n    \n    if (!browsePath) {\n      // Default: ~/dev if exists, else ~\n      const devPath = path.join(homeDir, \"dev\");\n      try {\n        await fs.access(devPath);\n        browsePath = devPath;\n      } catch {\n        browsePath = homeDir;\n      }\n    } else {\n      browsePath = configService.toAbsolutePath(browsePath);\n    }\n    \n    // Security: must be within home\n    if (!configService.isWithinHome(browsePath)) {\n      return NextResponse.json(\n        { error: \"Path must be within home directory\" },\n        { status: 403 }\n      );\n    }\n    \n    // Check path exists\n    try {\n      await fs.access(browsePath);\n    } catch {\n      return NextResponse.json(\n        { error: \"Path does not exist\" },\n        { status: 404 }\n      );\n    }\n    \n    // Check it's a directory\n    const stat = await fs.stat(browsePath);\n    if (!stat.isDirectory()) {\n      return NextResponse.json(\n        { error: \"Path is not a directory\" },\n        { status: 400 }\n      );\n    }\n    \n    // Read directory contents\n    const entries = await fs.readdir(browsePath, { withFileTypes: true });\n    \n    // Filter to visible directories only\n    const directories: Directory[] = [];\n    \n    for (const entry of entries) {\n      if (!entry.isDirectory()) continue;\n      if (shouldHide(entry.name)) continue;\n      \n      const entryPath = path.join(browsePath, entry.name);\n      \n      // Check if it's a git repo\n      let isGitRepo = false;\n      try {\n        await fs.access(path.join(entryPath, \".git\"));\n        isGitRepo = true;\n      } catch {\n        // Not a git repo, that's fine\n      }\n      \n      directories.push({\n        name: entry.name,\n        path: entryPath,\n        isGitRepo,\n      });\n    }\n    \n    // Sort alphabetically\n    directories.sort((a, b) =\u003e a.name.localeCompare(b.name));\n    \n    // Compute parent info\n    const parentPath = path.dirname(browsePath);\n    const isAtHome = browsePath === homeDir;\n    \n    return NextResponse.json({\n      currentPath: browsePath,\n      displayPath: configService.toDisplayPath(browsePath),\n      parent: isAtHome ? null : parentPath,\n      canGoUp: !isAtHome,\n      directories,\n    });\n    \n  } catch (error) {\n    console.error(\"Failed to browse filesystem:\", error);\n    return NextResponse.json(\n      { error: \"Failed to browse directory\" },\n      { status: 500 }\n    );\n  }\n}\n```\n\n## Git Repo Detection\nWe check for `.git` subdirectory to identify git repos. This helps users visually distinguish project directories from regular folders in the picker.\n\nNote: We intentionally skip `.git` in the listing (hidden pattern) but check for its existence to set `isGitRepo`.\n\n## Performance Considerations\n- Most dev directories have \u003c 50 items after filtering - performance is fine\n- Git detection adds one `fs.access` per directory - negligible overhead\n- For directories with many items, consider pagination (future enhancement)\n\n## Edge Cases\n- **Permission denied on subdirectory**: Skip it, don't fail the whole request\n- **Symlink directory**: Follow it, check resolved path is within home\n- **Race condition (dir deleted while reading)**: Skip missing entries gracefully\n- **Very deep nesting**: No limit enforced, but UI should handle long paths\n\n## Acceptance Criteria\n- [ ] Returns directories at requested path\n- [ ] Defaults to ~/dev (or ~ if no ~/dev)\n- [ ] Hides hidden directories (starting with .)\n- [ ] Hides node_modules, __pycache__, etc.\n- [ ] Shows isGitRepo indicator for git repos\n- [ ] Provides parent path for navigation\n- [ ] Returns canGoUp: false at home directory\n- [ ] Returns 403 for paths outside home\n- [ ] Returns 404 for non-existent paths\n- [ ] Handles permission errors gracefully\n\n## Dependencies\n- **Requires**: Task 1.1 (Config service for path utilities)\n- **Independent from**: Project CRUD endpoints\n\n## Files\n- `src/app/api/filesystem/browse/route.ts` (new)","status":"tombstone","priority":0,"issue_type":"task","created_at":"2025-12-30T07:55:03.095579-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: now standalone Filesystem API task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.7","title":"3.1 Create FolderBrowser component - directory list with navigation","description":"## Purpose\nCreate the core FolderBrowser component that displays a navigable list of directories from the server filesystem. This is the main content area of the folder browser modal.\n\n## Component Structure\n```\nFolderBrowser/\n├── FolderBrowser.tsx      # Main component, manages navigation state\n├── DirectoryList.tsx      # Renders list of directories\n└── (Breadcrumbs.tsx)      # Separate task\n```\n\n## FolderBrowser Props\n```typescript\ninterface FolderBrowserProps {\n  onSelect?: (path: string) =\u003e void;  // Called when user clicks \"Select\" \n  initialPath?: string;               // Starting path (default: ~/dev or ~)\n}\n```\n\n## State Management\n```typescript\nconst [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e(initialPath);\nconst { data, isLoading, error } = useFilesystem(currentPath);\n```\n\nThe component maintains the current path and uses the useFilesystem hook to fetch directory contents. Navigation is handled by updating the currentPath state.\n\n## DirectoryList Component\n```typescript\ninterface DirectoryListProps {\n  directories: Directory[];\n  onNavigate: (path: string) =\u003e void;\n  isLoading?: boolean;\n}\n\nfunction DirectoryList({ directories, onNavigate, isLoading }: DirectoryListProps) {\n  if (isLoading) {\n    return \u003cDirectoryListSkeleton /\u003e;\n  }\n  \n  if (directories.length === 0) {\n    return (\n      \u003cdiv className=\"text-center py-8 text-muted-foreground\"\u003e\n        No subdirectories found\n      \u003c/div\u003e\n    );\n  }\n  \n  return (\n    \u003cdiv className=\"divide-y divide-border\"\u003e\n      {directories.map((dir) =\u003e (\n        \u003cbutton\n          key={dir.path}\n          onClick={() =\u003e onNavigate(dir.path)}\n          className=\"w-full flex items-center gap-3 px-3 py-2.5 hover:bg-secondary/50 transition-colors text-left\"\n        \u003e\n          \u003cFolder className=\"h-4 w-4 text-muted-foreground\" /\u003e\n          \u003cspan className=\"flex-1 truncate\"\u003e{dir.name}\u003c/span\u003e\n          {dir.isGitRepo \u0026\u0026 (\n            \u003cspan className=\"text-xs text-muted-foreground bg-secondary px-1.5 py-0.5 rounded\"\u003e\n              git\n            \u003c/span\u003e\n          )}\n          \u003cChevronRight className=\"h-4 w-4 text-muted-foreground\" /\u003e\n        \u003c/button\u003e\n      ))}\n    \u003c/div\u003e\n  );\n}\n```\n\n## Navigation Flow\n1. User clicks a directory → `onNavigate(dir.path)` → updates `currentPath`\n2. useFilesystem refetches with new path\n3. UI updates to show new directory contents\n4. Breadcrumbs update (separate component, same currentPath state)\n\n## Mobile Considerations\n- **Touch targets**: Minimum 44px height for directory items\n- **Scroll area**: Directory list should scroll independently, not the whole modal\n- **Loading state**: Show skeleton while navigating to prevent layout shift\n\n## Error Handling\n```typescript\nif (error) {\n  return (\n    \u003cdiv className=\"p-4 text-center\"\u003e\n      \u003cp className=\"text-destructive mb-2\"\u003eFailed to load directory\u003c/p\u003e\n      \u003cp className=\"text-sm text-muted-foreground mb-4\"\u003e{error.message}\u003c/p\u003e\n      \u003cButton variant=\"outline\" onClick={() =\u003e refetch()}\u003e\n        Retry\n      \u003c/Button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Git Repo Indicator\nDirectories with `isGitRepo: true` show a small \"git\" badge. This helps users identify project directories vs regular folders.\n\n## Accessibility\n- Directory items are buttons with proper focus states\n- Keyboard navigation works (Tab, Enter)\n- Screen reader announces directory names and git status\n\n## Acceptance Criteria\n- [ ] Displays directories from useFilesystem hook\n- [ ] Clicking a directory navigates into it\n- [ ] Shows git repo indicator for git directories\n- [ ] Shows loading skeleton while fetching\n- [ ] Shows empty state when no subdirectories\n- [ ] Shows error state with retry option\n- [ ] Touch-friendly (44px+ tap targets)\n- [ ] Scrollable directory list\n\n## Dependencies\n- **Requires**: Task 7.1 (useFilesystem hook)\n- **Requires**: Task 2.1 (filesystem API endpoint)\n\n## Files\n- `src/components/folder-browser/FolderBrowser.tsx` (new)\n- `src/components/folder-browser/DirectoryList.tsx` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.14827-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into FolderBrowserModal task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.8","title":"3.2 Create FolderBrowser breadcrumb navigation","description":"## Purpose\nCreate the breadcrumb navigation component for the folder browser. Shows the current path as clickable segments, allowing users to jump to any parent directory.\n\n## Visual Design\n```\n┌─────────────────────────────────────────┐\n│  ~ / dev / projects / my-app        [↑] │\n└─────────────────────────────────────────┘\n```\n\n- Each segment is clickable\n- Current directory (last segment) is not clickable, just highlighted\n- \"Up\" button navigates to parent (same as clicking second-to-last segment)\n- On mobile, breadcrumbs scroll horizontally\n\n## Props\n```typescript\ninterface BreadcrumbsProps {\n  displayPath: string;       // e.g., \"~/dev/projects/my-app\"\n  onNavigate: (path: string) =\u003e void;\n  parent: string | null;     // Absolute path of parent, null if at home\n  canGoUp: boolean;\n}\n```\n\n## Implementation\n```typescript\n// src/components/folder-browser/Breadcrumbs.tsx\nimport { ChevronUp, Home } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nexport function Breadcrumbs({ displayPath, onNavigate, parent, canGoUp }: BreadcrumbsProps) {\n  // Parse displayPath into segments\n  // \"~/dev/projects\" → [\"~\", \"dev\", \"projects\"]\n  const segments = displayPath.split(\"/\").filter(Boolean);\n  \n  // Build absolute paths for each segment\n  // We need to map display paths back to absolute paths for navigation\n  // This requires knowing the home directory or receiving absolute paths\n  // For simplicity, receive absolutePath as well or compute from displayPath\n  \n  return (\n    \u003cdiv className=\"flex items-center gap-1 px-3 py-2 border-b border-border overflow-x-auto\"\u003e\n      {/* Scrollable breadcrumb container */}\n      \u003cdiv className=\"flex items-center gap-1 min-w-0 flex-1\"\u003e\n        {segments.map((segment, index) =\u003e {\n          const isLast = index === segments.length - 1;\n          const isHome = segment === \"~\";\n          \n          // Compute path for this segment\n          // \"~/dev/projects\" at index 1 (\"dev\") → \"~/dev\" → need absolute\n          // This is tricky - see implementation note below\n          \n          return (\n            \u003cdiv key={index} className=\"flex items-center\"\u003e\n              {index \u003e 0 \u0026\u0026 (\n                \u003cspan className=\"text-muted-foreground mx-1\"\u003e/\u003c/span\u003e\n              )}\n              {isLast ? (\n                \u003cspan className=\"font-medium truncate\"\u003e{segment}\u003c/span\u003e\n              ) : (\n                \u003cbutton\n                  onClick={() =\u003e onNavigate(pathForSegment)}\n                  className=\"text-muted-foreground hover:text-foreground transition-colors truncate\"\n                \u003e\n                  {isHome ? \u003cHome className=\"h-3.5 w-3.5\" /\u003e : segment}\n                \u003c/button\u003e\n              )}\n            \u003c/div\u003e\n          );\n        })}\n      \u003c/div\u003e\n      \n      {/* Up button */}\n      \u003cbutton\n        onClick={() =\u003e parent \u0026\u0026 onNavigate(parent)}\n        disabled={!canGoUp}\n        className={cn(\n          \"h-8 w-8 flex items-center justify-center rounded-md transition-colors\",\n          canGoUp \n            ? \"hover:bg-secondary text-muted-foreground hover:text-foreground\" \n            : \"text-muted-foreground/30 cursor-not-allowed\"\n        )}\n        aria-label=\"Go to parent directory\"\n      \u003e\n        \u003cChevronUp className=\"h-4 w-4\" /\u003e\n      \u003c/button\u003e\n    \u003c/div\u003e\n  );\n}\n```\n\n## Path Mapping Challenge\nThe displayPath is `~/dev/projects` but we need absolute paths for navigation. Solutions:\n\n1. **Pass absolutePath as prop** (recommended)\n   - FolderBrowser has both from useFilesystem response\n   - Breadcrumbs receives both and uses absolute for onClick\n\n2. **Reconstruct from segments**\n   - Replace `~` with home directory\n   - Join segments with `/`\n   - More brittle, assumes path format\n\nGoing with option 1:\n```typescript\ninterface BreadcrumbsProps {\n  currentPath: string;       // Absolute: /Users/erik/dev/projects\n  displayPath: string;       // Display: ~/dev/projects\n  onNavigate: (path: string) =\u003e void;\n  parent: string | null;\n  canGoUp: boolean;\n}\n```\n\nThen compute segment paths by walking back from currentPath.\n\n## Mobile Behavior\n- Container has `overflow-x-auto` for horizontal scroll\n- No explicit scroll indicators (browser native)\n- Current directory (last segment) should be visible - consider `scrollIntoView` on mount\n- Minimum touch target height maintained\n\n## Accessibility\n- Each segment is a button with proper focus state\n- Up button has aria-label\n- Disabled state properly announced\n\n## Acceptance Criteria\n- [ ] Shows path segments from displayPath\n- [ ] Clicking segment navigates to that directory\n- [ ] Last segment (current dir) is not clickable\n- [ ] Up button navigates to parent\n- [ ] Up button disabled at home directory\n- [ ] Horizontally scrollable on narrow screens\n- [ ] Home icon for ~ segment (optional, can be text)\n\n## Dependencies\n- **Used by**: Task 3.1 (FolderBrowser component)\n- **Requires**: Task 7.1 (useFilesystem hook data)\n\n## Files\n- `src/components/folder-browser/Breadcrumbs.tsx` (new)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.198729-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into FolderBrowserModal task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"maestro-slm.9","title":"3.3 Create FolderBrowserModal with add project form","description":"## Purpose\nCreate the modal wrapper that contains the folder browser and the \"Add Project\" form. This is the complete UI for adding a new project to Maestro.\n\n## Visual Design\n```\n┌─────────────────────────────────────────────────┐\n│  Select Project Folder                      [X] │  ← Header with close button\n├─────────────────────────────────────────────────┤\n│  ~ / dev / my-project                       [↑] │  ← Breadcrumbs\n├─────────────────────────────────────────────────┤\n│  ┌─────────────────────────────────────────┐   │\n│  │ [Paste path here...                   ] │   │  ← Path input (power user)\n│  └─────────────────────────────────────────┘   │\n├─────────────────────────────────────────────────┤\n│  📁 api-gateway              git                │  ← Directory list\n│  📁 frontend                 git                │\n│  📁 scripts                                     │\n│                                                 │\n│              (scrollable area)                  │\n├─────────────────────────────────────────────────┤\n│  Name: [my-project              ] (optional)    │  ← Custom name input\n├─────────────────────────────────────────────────┤\n│                    [Cancel]  [Add Project]      │  ← Actions\n└─────────────────────────────────────────────────┘\n```\n\n## Props\n```typescript\ninterface FolderBrowserModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) =\u003e void;\n  initialPath?: string;      // For \"Relocate\" flow, start at specific path\n  onSuccess?: () =\u003e void;    // Called after successful add\n}\n```\n\n## State\n```typescript\nconst [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e(initialPath);\nconst [selectedPath, setSelectedPath] = useState\u003cstring | null\u003e(null);\nconst [customName, setCustomName] = useState(\"\");\nconst [pathInput, setPathInput] = useState(\"\");\nconst [error, setError] = useState\u003cstring | null\u003e(null);\n\nconst { data: filesystem } = useFilesystem(currentPath);\nconst addProject = useAddProject();\n```\n\n## Interaction Flow\n\n### Navigating Directories\n1. User clicks directory in list\n2. `setCurrentPath(dir.path)` - navigates into directory\n3. useFilesystem refetches\n4. Breadcrumbs update\n\n### Selecting Current Directory\nThe current directory (shown in breadcrumbs) is implicitly selected. User can:\n1. Navigate to the project folder\n2. Optionally enter a custom name\n3. Click \"Add Project\"\n\n### Path Input (Power User Feature)\n- User can paste an absolute path directly\n- On Enter or blur, navigate to that path\n- Validates path via API (will show error if invalid)\n- Optional feature - can be omitted for v1\n\n### Custom Name\n- Text input pre-populated with current directory name\n- Empty → use derived name (no custom name stored)\n- User can edit to set custom display name\n\n## Implementation\n```typescript\n// src/components/folder-browser/FolderBrowserModal.tsx\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { FolderBrowser } from \"./FolderBrowser\";\nimport { Breadcrumbs } from \"./Breadcrumbs\";\nimport { useAddProject } from \"@/lib/hooks/useProjects\";\nimport { useFilesystem } from \"@/lib/hooks/useFilesystem\";\n\nexport function FolderBrowserModal({ open, onOpenChange, initialPath, onSuccess }: FolderBrowserModalProps) {\n  const [currentPath, setCurrentPath] = useState\u003cstring | undefined\u003e(initialPath);\n  const [customName, setCustomName] = useState(\"\");\n  const [error, setError] = useState\u003cstring | null\u003e(null);\n  \n  const { data: filesystem, isLoading, error: browseError } = useFilesystem(currentPath);\n  const addProject = useAddProject();\n  \n  // Update custom name placeholder when path changes\n  useEffect(() =\u003e {\n    if (filesystem?.currentPath) {\n      const dirName = filesystem.currentPath.split(\"/\").pop() || \"\";\n      setCustomName(dirName);\n    }\n  }, [filesystem?.currentPath]);\n  \n  const handleAddProject = async () =\u003e {\n    if (!filesystem?.currentPath) return;\n    \n    setError(null);\n    try {\n      await addProject.mutateAsync({\n        path: filesystem.currentPath,\n        name: customName.trim() || undefined,\n      });\n      onOpenChange(false);\n      onSuccess?.();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : \"Failed to add project\");\n    }\n  };\n  \n  return (\n    \u003cDialog open={open} onOpenChange={onOpenChange}\u003e\n      \u003cDialogContent className=\"max-w-lg max-h-[80vh] flex flex-col p-0\"\u003e\n        \u003cDialogHeader className=\"px-4 py-3 border-b\"\u003e\n          \u003cDialogTitle\u003eSelect Project Folder\u003c/DialogTitle\u003e\n        \u003c/DialogHeader\u003e\n        \n        {/* Breadcrumbs */}\n        {filesystem \u0026\u0026 (\n          \u003cBreadcrumbs\n            currentPath={filesystem.currentPath}\n            displayPath={filesystem.displayPath}\n            onNavigate={setCurrentPath}\n            parent={filesystem.parent}\n            canGoUp={filesystem.canGoUp}\n          /\u003e\n        )}\n        \n        {/* Directory List */}\n        \u003cdiv className=\"flex-1 overflow-y-auto min-h-[200px]\"\u003e\n          \u003cFolderBrowser\n            currentPath={currentPath}\n            onNavigate={setCurrentPath}\n          /\u003e\n        \u003c/div\u003e\n        \n        {/* Custom Name Input */}\n        \u003cdiv className=\"px-4 py-3 border-t\"\u003e\n          \u003clabel className=\"text-sm text-muted-foreground mb-1.5 block\"\u003e\n            Display name (optional)\n          \u003c/label\u003e\n          \u003cInput\n            value={customName}\n            onChange={(e) =\u003e setCustomName(e.target.value)}\n            placeholder=\"Use folder name\"\n          /\u003e\n        \u003c/div\u003e\n        \n        {/* Error */}\n        {error \u0026\u0026 (\n          \u003cdiv className=\"px-4 py-2 text-sm text-destructive\"\u003e\n            {error}\n          \u003c/div\u003e\n        )}\n        \n        {/* Actions */}\n        \u003cdiv className=\"flex justify-end gap-2 px-4 py-3 border-t\"\u003e\n          \u003cButton variant=\"outline\" onClick={() =\u003e onOpenChange(false)}\u003e\n            Cancel\n          \u003c/Button\u003e\n          \u003cButton \n            onClick={handleAddProject}\n            disabled={!filesystem?.currentPath || addProject.isPending}\n          \u003e\n            {addProject.isPending ? \"Adding...\" : \"Add Project\"}\n          \u003c/Button\u003e\n        \u003c/div\u003e\n      \u003c/DialogContent\u003e\n    \u003c/Dialog\u003e\n  );\n}\n```\n\n## Mobile Behavior\n- Full screen modal on small screens (`sm:max-w-lg`)\n- Directory list takes available space, scrolls\n- Actions sticky at bottom\n- Touch-friendly inputs and buttons\n\n## Error Handling\n- Browse errors: Show in directory list area with retry\n- Add project errors: Show inline below name input\n- Clear error when navigating or retrying\n\n## Acceptance Criteria\n- [ ] Opens as modal dialog\n- [ ] Shows breadcrumbs with navigation\n- [ ] Shows directory list with navigation\n- [ ] Custom name input with folder name as placeholder\n- [ ] \"Add Project\" calls API with current path and name\n- [ ] Shows loading state during add\n- [ ] Shows error messages inline\n- [ ] Closes on success\n- [ ] Calls onSuccess callback on success\n- [ ] Cancel closes without action\n- [ ] Mobile-friendly layout\n\n## Dependencies\n- **Requires**: Task 3.1 (FolderBrowser component)\n- **Requires**: Task 3.2 (Breadcrumbs component)\n- **Requires**: Task 7.1 (useAddProject hook)\n- **Requires**: shadcn Dialog component (may need to add)\n\n## Files\n- `src/components/folder-browser/FolderBrowserModal.tsx` (new)\n- May need: `src/components/ui/dialog.tsx` (shadcn component)","status":"tombstone","priority":1,"issue_type":"task","created_at":"2025-12-30T07:55:03.250446-06:00","created_by":"erikjohansson","updated_at":"2025-12-30T09:18:37.940855-06:00","close_reason":"Restructuring: merged into FolderBrowserModal task","deleted_at":"2025-12-30T09:18:37.940855-06:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
